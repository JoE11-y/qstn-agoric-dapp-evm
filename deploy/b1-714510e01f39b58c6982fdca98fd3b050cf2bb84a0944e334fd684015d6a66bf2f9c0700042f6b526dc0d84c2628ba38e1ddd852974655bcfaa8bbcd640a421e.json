{
  "moduleFormat": "endoZipBase64",
  "endoZipBase64": "UEsDBAoAAAAAAAAAAADuKUXjQgIAAEICAAAUAAAAY29tcGFydG1lbnQtbWFwLmpzb257CiAgInRhZ3MiOiBbXSwKICAiZW50cnkiOiB7CiAgICAiY29tcGFydG1lbnQiOiAiZGVwbG95LXYxLjAuMCIsCiAgICAibW9kdWxlIjogIi4vZGlzdC9xc3RuLnJvdXRlci5idW5kbGUuanMiCiAgfSwKICAiY29tcGFydG1lbnRzIjogewogICAgImRlcGxveS12MS4wLjAiOiB7CiAgICAgICJuYW1lIjogImRlcGxveSIsCiAgICAgICJsYWJlbCI6ICJkZXBsb3ktdjEuMC4wIiwKICAgICAgImxvY2F0aW9uIjogImRlcGxveS12MS4wLjAiLAogICAgICAibW9kdWxlcyI6IHsKICAgICAgICAiLi9kaXN0L3FzdG4ucm91dGVyLmJ1bmRsZS5qcyI6IHsKICAgICAgICAgICJsb2NhdGlvbiI6ICJkaXN0L3FzdG4ucm91dGVyLmJ1bmRsZS5qcyIsCiAgICAgICAgICAicGFyc2VyIjogInByZS1tanMtanNvbiIsCiAgICAgICAgICAic2hhNTEyIjogImZhNDFkZWQ0YTliYjM2YTg1NGYzYjNjNzJjMmZmNGYyMzNlZDIwODI1N2UzZTk0MTU3YjM2N2ZlZmVjMWZjZjVkMmMzZTQ5NjI1NzJjMjMzMDFjM2I2MGY0ZmE4ZGU4YTk2NWQxODU5ZmY4MjZlNTg4YjI3NjYxYTEwZjJiNDA1IgogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfVBLAwQKAAAAAAAAAAAALtaMrS8WDgAvFg4AKAAAAGRlcGxveS12MS4wLjAvZGlzdC9xc3RuLnJvdXRlci5idW5kbGUuanN7ImltcG9ydHMiOltdLCJleHBvcnRzIjpbImNvbnRyYWN0Iiwic3RhcnQiXSwicmVleHBvcnRzIjpbXSwiX19zeW5jTW9kdWxlUHJvZ3JhbV9fIjoiKHtpbXBvcnRzOiRozY9faW1wb3J0cyxsaXZlVmFyOiRozY9fbGl2ZSxvbmNlVmFyOiRozY9fb25jZSxpbXBvcnQ6JGjNj19pbXBvcnQsaW1wb3J0TWV0YTokaM2PX19fX21ldGF9KT0+KGZ1bmN0aW9uKCl7J3VzZSBzdHJpY3QnOyRozY9faW1wb3J0cyhbXSk7JGjNj19saXZlLmNvbnRyYWN0KCk7JGjNj19saXZlLnN0YXJ0KCk7dmFyIF9fY3JlYXRlID0gT2JqZWN0LmNyZWF0ZTtcbnZhciBfX2RlZlByb3AgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7XG52YXIgX19nZXRPd25Qcm9wRGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7XG52YXIgX19nZXRPd25Qcm9wTmFtZXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcztcbnZhciBfX2dldFByb3RvT2YgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Y7XG52YXIgX19oYXNPd25Qcm9wID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTtcbnZhciBfX2NvbW1vbkpTID0gKGNiLCBtb2QpID0+IGZ1bmN0aW9uIF9fcmVxdWlyZSgpIHtcbiAgcmV0dXJuIG1vZCB8fCAoMCwgY2JbX19nZXRPd25Qcm9wTmFtZXMoY2IpWzBdXSkoKG1vZCA9IHsgZXhwb3J0czoge30gfSkuZXhwb3J0cywgbW9kKSwgbW9kLmV4cG9ydHM7XG59O1xudmFyIF9fY29weVByb3BzID0gKHRvLCBmcm9tLCBleGNlcHQsIGRlc2MpID0+IHtcbiAgaWYgKGZyb20gJiYgdHlwZW9mIGZyb20gPT09IFwib2JqZWN0XCIgfHwgdHlwZW9mIGZyb20gPT09IFwiZnVuY3Rpb25cIikge1xuICAgIGZvciAobGV0IGtleSBvZiBfX2dldE93blByb3BOYW1lcyhmcm9tKSlcbiAgICAgIGlmICghX19oYXNPd25Qcm9wLmNhbGwodG8sIGtleSkgJiYga2V5ICE9PSBleGNlcHQpXG4gICAgICAgIF9fZGVmUHJvcCh0bywga2V5LCB7IGdldDogKCkgPT4gZnJvbVtrZXldLCBlbnVtZXJhYmxlOiAhKGRlc2MgPSBfX2dldE93blByb3BEZXNjKGZyb20sIGtleSkpIHx8IGRlc2MuZW51bWVyYWJsZSB9KTtcbiAgfVxuICByZXR1cm4gdG87XG59O1xudmFyIF9fdG9FU00gPSAobW9kLCBpc05vZGVNb2RlLCB0YXJnZXQpID0+ICh0YXJnZXQgPSBtb2QgIT0gbnVsbCA/IF9fY3JlYXRlKF9fZ2V0UHJvdG9PZihtb2QpKSA6IHt9LCBfX2NvcHlQcm9wcyhcbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgaXNOb2RlTW9kZSB8fCAhbW9kIHx8ICFtb2QuX19lc01vZHVsZSA/IF9fZGVmUHJvcCh0YXJnZXQsIFwiZGVmYXVsdFwiLCB7IHZhbHVlOiBtb2QsIGVudW1lcmFibGU6IHRydWUgfSkgOiB0YXJnZXQsXG4gIG1vZFxuKSk7XG5cbi8vXG52YXIgcmVxdWlyZV9hc2NpaSA9IF9fY29tbW9uSlMoe1xuICBcIi4uL25vZGVfbW9kdWxlcy9AY29zbWpzL2VuY29kaW5nL2J1aWxkL2FzY2lpLmpzXCIoZXhwb3J0cykge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbiAgICBleHBvcnRzLnRvQXNjaWkgPSB0b0FzY2lpO1xuICAgIGV4cG9ydHMuZnJvbUFzY2lpID0gZnJvbUFzY2lpO1xuICAgIGZ1bmN0aW9uIHRvQXNjaWkoaW5wdXQpIHtcbiAgICAgIGNvbnN0IHRvTnVtcyA9IChzdHIpID0+IHN0ci5zcGxpdChcIlwiKS5tYXAoKHgpID0+IHtcbiAgICAgICAgY29uc3QgY2hhckNvZGUgPSB4LmNoYXJDb2RlQXQoMCk7XG4gICAgICAgIGlmIChjaGFyQ29kZSA8IDMyIHx8IGNoYXJDb2RlID4gMTI2KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZW5jb2RlIGNoYXJhY3RlciB0aGF0IGlzIG91dCBvZiBwcmludGFibGUgQVNDSUkgcmFuZ2U6ICR7Y2hhckNvZGV9YCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNoYXJDb2RlO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gVWludDhBcnJheS5mcm9tKHRvTnVtcyhpbnB1dCkpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBmcm9tQXNjaWkoZGF0YSkge1xuICAgICAgY29uc3QgZnJvbU51bXMgPSAobGlzdE9mTnVtYmVycykgPT4gbGlzdE9mTnVtYmVycy5tYXAoKHgpID0+IHtcbiAgICAgICAgaWYgKHggPCAzMiB8fCB4ID4gMTI2KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZGVjb2RlIGNoYXJhY3RlciB0aGF0IGlzIG91dCBvZiBwcmludGFibGUgQVNDSUkgcmFuZ2U6ICR7eH1gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSh4KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGZyb21OdW1zKEFycmF5LmZyb20oZGF0YSkpLmpvaW4oXCJcIik7XG4gICAgfVxuICB9XG59KTtcblxuLy9cbnZhciByZXF1aXJlX2Jhc2U2NF9qcyA9IF9fY29tbW9uSlMoe1xuICBcIi4uL25vZGVfbW9kdWxlcy9iYXNlNjQtanMvaW5kZXguanNcIihleHBvcnRzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgZXhwb3J0cy5ieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aDtcbiAgICBleHBvcnRzLnRvQnl0ZUFycmF5ID0gdG9CeXRlQXJyYXk7XG4gICAgZXhwb3J0cy5mcm9tQnl0ZUFycmF5ID0gZnJvbUJ5dGVBcnJheTtcbiAgICB2YXIgbG9va3VwID0gW107XG4gICAgdmFyIHJldkxvb2t1cCA9IFtdO1xuICAgIHZhciBBcnIgPSB0eXBlb2YgVWludDhBcnJheSAhPT0gXCJ1bmRlZmluZWRcIiA/IFVpbnQ4QXJyYXkgOiBBcnJheTtcbiAgICB2YXIgY29kZSA9IFwiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrL1wiO1xuICAgIGZvciAoaTIgPSAwLCBsZW4gPSBjb2RlLmxlbmd0aDsgaTIgPCBsZW47ICsraTIpIHtcbiAgICAgIGxvb2t1cFtpMl0gPSBjb2RlW2kyXTtcbiAgICAgIHJldkxvb2t1cFtjb2RlLmNoYXJDb2RlQXQoaTIpXSA9IGkyO1xuICAgIH1cbiAgICB2YXIgaTI7XG4gICAgdmFyIGxlbjtcbiAgICByZXZMb29rdXBbXCItXCIuY2hhckNvZGVBdCgwKV0gPSA2MjtcbiAgICByZXZMb29rdXBbXCJfXCIuY2hhckNvZGVBdCgwKV0gPSA2MztcbiAgICBmdW5jdGlvbiBnZXRMZW5zKGI2NCkge1xuICAgICAgdmFyIGxlbjIgPSBiNjQubGVuZ3RoO1xuICAgICAgaWYgKGxlbjIgJSA0ID4gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHN0cmluZy4gTGVuZ3RoIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA0XCIpO1xuICAgICAgfVxuICAgICAgdmFyIHZhbGlkTGVuID0gYjY0LmluZGV4T2YoXCI9XCIpO1xuICAgICAgaWYgKHZhbGlkTGVuID09PSAtMSkgdmFsaWRMZW4gPSBsZW4yO1xuICAgICAgdmFyIHBsYWNlSG9sZGVyc0xlbiA9IHZhbGlkTGVuID09PSBsZW4yID8gMCA6IDQgLSB2YWxpZExlbiAlIDQ7XG4gICAgICByZXR1cm4gW3ZhbGlkTGVuLCBwbGFjZUhvbGRlcnNMZW5dO1xuICAgIH1cbiAgICBmdW5jdGlvbiBieXRlTGVuZ3RoKGI2NCkge1xuICAgICAgdmFyIGxlbnMgPSBnZXRMZW5zKGI2NCk7XG4gICAgICB2YXIgdmFsaWRMZW4gPSBsZW5zWzBdO1xuICAgICAgdmFyIHBsYWNlSG9sZGVyc0xlbiA9IGxlbnNbMV07XG4gICAgICByZXR1cm4gKHZhbGlkTGVuICsgcGxhY2VIb2xkZXJzTGVuKSAqIDMgLyA0IC0gcGxhY2VIb2xkZXJzTGVuO1xuICAgIH1cbiAgICBmdW5jdGlvbiBfYnl0ZUxlbmd0aChiNjQsIHZhbGlkTGVuLCBwbGFjZUhvbGRlcnNMZW4pIHtcbiAgICAgIHJldHVybiAodmFsaWRMZW4gKyBwbGFjZUhvbGRlcnNMZW4pICogMyAvIDQgLSBwbGFjZUhvbGRlcnNMZW47XG4gICAgfVxuICAgIGZ1bmN0aW9uIHRvQnl0ZUFycmF5KGI2NCkge1xuICAgICAgdmFyIHRtcDtcbiAgICAgIHZhciBsZW5zID0gZ2V0TGVucyhiNjQpO1xuICAgICAgdmFyIHZhbGlkTGVuID0gbGVuc1swXTtcbiAgICAgIHZhciBwbGFjZUhvbGRlcnNMZW4gPSBsZW5zWzFdO1xuICAgICAgdmFyIGFyciA9IG5ldyBBcnIoX2J5dGVMZW5ndGgoYjY0LCB2YWxpZExlbiwgcGxhY2VIb2xkZXJzTGVuKSk7XG4gICAgICB2YXIgY3VyQnl0ZSA9IDA7XG4gICAgICB2YXIgbGVuMiA9IHBsYWNlSG9sZGVyc0xlbiA+IDAgPyB2YWxpZExlbiAtIDQgOiB2YWxpZExlbjtcbiAgICAgIHZhciBpMztcbiAgICAgIGZvciAoaTMgPSAwOyBpMyA8IGxlbjI7IGkzICs9IDQpIHtcbiAgICAgICAgdG1wID0gcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkzKV0gPDwgMTggfCByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTMgKyAxKV0gPDwgMTIgfCByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTMgKyAyKV0gPDwgNiB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMyArIDMpXTtcbiAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgPj4gMTYgJiAyNTU7XG4gICAgICAgIGFycltjdXJCeXRlKytdID0gdG1wID4+IDggJiAyNTU7XG4gICAgICAgIGFycltjdXJCeXRlKytdID0gdG1wICYgMjU1O1xuICAgICAgfVxuICAgICAgaWYgKHBsYWNlSG9sZGVyc0xlbiA9PT0gMikge1xuICAgICAgICB0bXAgPSByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTMpXSA8PCAyIHwgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkzICsgMSldID4+IDQ7XG4gICAgICAgIGFycltjdXJCeXRlKytdID0gdG1wICYgMjU1O1xuICAgICAgfVxuICAgICAgaWYgKHBsYWNlSG9sZGVyc0xlbiA9PT0gMSkge1xuICAgICAgICB0bXAgPSByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTMpXSA8PCAxMCB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMyArIDEpXSA8PCA0IHwgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkzICsgMildID4+IDI7XG4gICAgICAgIGFycltjdXJCeXRlKytdID0gdG1wID4+IDggJiAyNTU7XG4gICAgICAgIGFycltjdXJCeXRlKytdID0gdG1wICYgMjU1O1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFycjtcbiAgICB9XG4gICAgZnVuY3Rpb24gdHJpcGxldFRvQmFzZTY0KG51bSkge1xuICAgICAgcmV0dXJuIGxvb2t1cFtudW0gPj4gMTggJiA2M10gKyBsb29rdXBbbnVtID4+IDEyICYgNjNdICsgbG9va3VwW251bSA+PiA2ICYgNjNdICsgbG9va3VwW251bSAmIDYzXTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZW5jb2RlQ2h1bmsodWludDgsIHN0YXJ0MiwgZW5kKSB7XG4gICAgICB2YXIgdG1wO1xuICAgICAgdmFyIG91dHB1dCA9IFtdO1xuICAgICAgZm9yICh2YXIgaTMgPSBzdGFydDI7IGkzIDwgZW5kOyBpMyArPSAzKSB7XG4gICAgICAgIHRtcCA9ICh1aW50OFtpM10gPDwgMTYgJiAxNjcxMTY4MCkgKyAodWludDhbaTMgKyAxXSA8PCA4ICYgNjUyODApICsgKHVpbnQ4W2kzICsgMl0gJiAyNTUpO1xuICAgICAgICBvdXRwdXQucHVzaCh0cmlwbGV0VG9CYXNlNjQodG1wKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gb3V0cHV0LmpvaW4oXCJcIik7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21CeXRlQXJyYXkodWludDgpIHtcbiAgICAgIHZhciB0bXA7XG4gICAgICB2YXIgbGVuMiA9IHVpbnQ4Lmxlbmd0aDtcbiAgICAgIHZhciBleHRyYUJ5dGVzID0gbGVuMiAlIDM7XG4gICAgICB2YXIgcGFydHMgPSBbXTtcbiAgICAgIHZhciBtYXhDaHVua0xlbmd0aCA9IDE2MzgzO1xuICAgICAgZm9yICh2YXIgaTMgPSAwLCBsZW4yMiA9IGxlbjIgLSBleHRyYUJ5dGVzOyBpMyA8IGxlbjIyOyBpMyArPSBtYXhDaHVua0xlbmd0aCkge1xuICAgICAgICBwYXJ0cy5wdXNoKGVuY29kZUNodW5rKHVpbnQ4LCBpMywgaTMgKyBtYXhDaHVua0xlbmd0aCA+IGxlbjIyID8gbGVuMjIgOiBpMyArIG1heENodW5rTGVuZ3RoKSk7XG4gICAgICB9XG4gICAgICBpZiAoZXh0cmFCeXRlcyA9PT0gMSkge1xuICAgICAgICB0bXAgPSB1aW50OFtsZW4yIC0gMV07XG4gICAgICAgIHBhcnRzLnB1c2goXG4gICAgICAgICAgbG9va3VwW3RtcCA+PiAyXSArIGxvb2t1cFt0bXAgPDwgNCAmIDYzXSArIFwiPT1cIlxuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChleHRyYUJ5dGVzID09PSAyKSB7XG4gICAgICAgIHRtcCA9ICh1aW50OFtsZW4yIC0gMl0gPDwgOCkgKyB1aW50OFtsZW4yIC0gMV07XG4gICAgICAgIHBhcnRzLnB1c2goXG4gICAgICAgICAgbG9va3VwW3RtcCA+PiAxMF0gKyBsb29rdXBbdG1wID4+IDQgJiA2M10gKyBsb29rdXBbdG1wIDw8IDIgJiA2M10gKyBcIj1cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHBhcnRzLmpvaW4oXCJcIik7XG4gICAgfVxuICB9XG59KTtcblxuLy9cbnZhciByZXF1aXJlX2Jhc2U2NCA9IF9fY29tbW9uSlMoe1xuICBcIi4uL25vZGVfbW9kdWxlcy9AY29zbWpzL2VuY29kaW5nL2J1aWxkL2Jhc2U2NC5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICB2YXIgX19jcmVhdGVCaW5kaW5nID0gZXhwb3J0cyAmJiBleHBvcnRzLl9fY3JlYXRlQmluZGluZyB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvMiwgbTIsIGssIGsyKSB7XG4gICAgICBpZiAoazIgPT09IHZvaWQgMCkgazIgPSBrO1xuICAgICAgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG0yLCBrKTtcbiAgICAgIGlmICghZGVzYyB8fCAoXCJnZXRcIiBpbiBkZXNjID8gIW0yLl9fZXNNb2R1bGUgOiBkZXNjLndyaXRhYmxlIHx8IGRlc2MuY29uZmlndXJhYmxlKSkge1xuICAgICAgICBkZXNjID0geyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBtMltrXTtcbiAgICAgICAgfSB9O1xuICAgICAgfVxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8yLCBrMiwgZGVzYyk7XG4gICAgfSkgOiAoZnVuY3Rpb24obzIsIG0yLCBrLCBrMikge1xuICAgICAgaWYgKGsyID09PSB2b2lkIDApIGsyID0gaztcbiAgICAgIG8yW2syXSA9IG0yW2tdO1xuICAgIH0pKTtcbiAgICB2YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gZXhwb3J0cyAmJiBleHBvcnRzLl9fc2V0TW9kdWxlRGVmYXVsdCB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvMiwgdjIpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvMiwgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYyIH0pO1xuICAgIH0pIDogZnVuY3Rpb24obzIsIHYyKSB7XG4gICAgICBvMltcImRlZmF1bHRcIl0gPSB2MjtcbiAgICB9KTtcbiAgICB2YXIgX19pbXBvcnRTdGFyID0gZXhwb3J0cyAmJiBleHBvcnRzLl9faW1wb3J0U3RhciB8fCAvKiAgICAgICAgICAgKi8gKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG93bktleXMyNSA9IGZ1bmN0aW9uKG8yKSB7XG4gICAgICAgIG93bktleXMyNSA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHx8IGZ1bmN0aW9uKG8zKSB7XG4gICAgICAgICAgdmFyIGFyID0gW107XG4gICAgICAgICAgZm9yICh2YXIgayBpbiBvMykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvMywgaykpIGFyW2FyLmxlbmd0aF0gPSBrO1xuICAgICAgICAgIHJldHVybiBhcjtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIG93bktleXMyNShvMik7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKG1vZCkge1xuICAgICAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgICAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgICAgIGlmIChtb2QgIT0gbnVsbCkge1xuICAgICAgICAgIGZvciAodmFyIGsgPSBvd25LZXlzMjUobW9kKSwgaTIgPSAwOyBpMiA8IGsubGVuZ3RoOyBpMisrKSBpZiAoa1tpMl0gIT09IFwiZGVmYXVsdFwiKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGtbaTJdKTtcbiAgICAgICAgfVxuICAgICAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfTtcbiAgICB9KSgpO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbiAgICBleHBvcnRzLnRvQmFzZTY0ID0gdG9CYXNlNjQ7XG4gICAgZXhwb3J0cy5mcm9tQmFzZTY0ID0gZnJvbUJhc2U2NDtcbiAgICB2YXIgYmFzZTY0anMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZV9iYXNlNjRfanMoKSk7XG4gICAgZnVuY3Rpb24gdG9CYXNlNjQoZGF0YSkge1xuICAgICAgcmV0dXJuIGJhc2U2NGpzLmZyb21CeXRlQXJyYXkoZGF0YSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21CYXNlNjQoYmFzZTY0U3RyaW5nKSB7XG4gICAgICBpZiAoIWJhc2U2NFN0cmluZy5tYXRjaCgvXlthLXpBLVowLTkrL10qPXswLDJ9JC8pKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgYmFzZTY0IHN0cmluZyBmb3JtYXRcIik7XG4gICAgICB9XG4gICAgICByZXR1cm4gYmFzZTY0anMudG9CeXRlQXJyYXkoYmFzZTY0U3RyaW5nKTtcbiAgICB9XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfYmVjaDMyID0gX19jb21tb25KUyh7XG4gIFwiLi4vbm9kZV9tb2R1bGVzL2JlY2gzMi9pbmRleC5qc1wiKGV4cG9ydHMsIG1vZHVsZSkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIHZhciBBTFBIQUJFVDIgPSBcInFwenJ5OXg4Z2YydHZkdzBzM2puNTRraGNlNm11YTdsXCI7XG4gICAgdmFyIEFMUEhBQkVUX01BUCA9IHt9O1xuICAgIGZvciAoeiA9IDA7IHogPCBBTFBIQUJFVDIubGVuZ3RoOyB6KyspIHtcbiAgICAgIHggPSBBTFBIQUJFVDIuY2hhckF0KHopO1xuICAgICAgaWYgKEFMUEhBQkVUX01BUFt4XSAhPT0gdm9pZCAwKSB0aHJvdyBuZXcgVHlwZUVycm9yKHggKyBcIiBpcyBhbWJpZ3VvdXNcIik7XG4gICAgICBBTFBIQUJFVF9NQVBbeF0gPSB6O1xuICAgIH1cbiAgICB2YXIgeDtcbiAgICB2YXIgejtcbiAgICBmdW5jdGlvbiBwb2x5bW9kU3RlcChwcmUpIHtcbiAgICAgIHZhciBiMyA9IHByZSA+PiAyNTtcbiAgICAgIHJldHVybiAocHJlICYgMzM1NTQ0MzEpIDw8IDUgXiAtKGIzID4+IDAgJiAxKSAmIDk5NjgyNTAxMCBeIC0oYjMgPj4gMSAmIDEpICYgNjQyODEzNTQ5IF4gLShiMyA+PiAyICYgMSkgJiA1MTM4NzQ0MjYgXiAtKGIzID4+IDMgJiAxKSAmIDEwMjc3NDg4MjkgXiAtKGIzID4+IDQgJiAxKSAmIDcwNTk3OTA1OTtcbiAgICB9XG4gICAgZnVuY3Rpb24gcHJlZml4Q2hrKHByZWZpeCkge1xuICAgICAgdmFyIGNoayA9IDE7XG4gICAgICBmb3IgKHZhciBpMiA9IDA7IGkyIDwgcHJlZml4Lmxlbmd0aDsgKytpMikge1xuICAgICAgICB2YXIgYzIgPSBwcmVmaXguY2hhckNvZGVBdChpMik7XG4gICAgICAgIGlmIChjMiA8IDMzIHx8IGMyID4gMTI2KSByZXR1cm4gXCJJbnZhbGlkIHByZWZpeCAoXCIgKyBwcmVmaXggKyBcIilcIjtcbiAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKSBeIGMyID4+IDU7XG4gICAgICB9XG4gICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspO1xuICAgICAgZm9yIChpMiA9IDA7IGkyIDwgcHJlZml4Lmxlbmd0aDsgKytpMikge1xuICAgICAgICB2YXIgdjIgPSBwcmVmaXguY2hhckNvZGVBdChpMik7XG4gICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoaykgXiB2MiAmIDMxO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNoaztcbiAgICB9XG4gICAgZnVuY3Rpb24gZW5jb2RlKHByZWZpeCwgd29yZHMsIExJTUlUKSB7XG4gICAgICBMSU1JVCA9IExJTUlUIHx8IDkwO1xuICAgICAgaWYgKHByZWZpeC5sZW5ndGggKyA3ICsgd29yZHMubGVuZ3RoID4gTElNSVQpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJFeGNlZWRzIGxlbmd0aCBsaW1pdFwiKTtcbiAgICAgIHByZWZpeCA9IHByZWZpeC50b0xvd2VyQ2FzZSgpO1xuICAgICAgdmFyIGNoayA9IHByZWZpeENoayhwcmVmaXgpO1xuICAgICAgaWYgKHR5cGVvZiBjaGsgPT09IFwic3RyaW5nXCIpIHRocm93IG5ldyBFcnJvcihjaGspO1xuICAgICAgdmFyIHJlc3VsdCA9IHByZWZpeCArIFwiMVwiO1xuICAgICAgZm9yICh2YXIgaTIgPSAwOyBpMiA8IHdvcmRzLmxlbmd0aDsgKytpMikge1xuICAgICAgICB2YXIgeDIgPSB3b3Jkc1tpMl07XG4gICAgICAgIGlmICh4MiA+PiA1ICE9PSAwKSB0aHJvdyBuZXcgRXJyb3IoXCJOb24gNS1iaXQgd29yZFwiKTtcbiAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKSBeIHgyO1xuICAgICAgICByZXN1bHQgKz0gQUxQSEFCRVQyLmNoYXJBdCh4Mik7XG4gICAgICB9XG4gICAgICBmb3IgKGkyID0gMDsgaTIgPCA2OyArK2kyKSB7XG4gICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoayk7XG4gICAgICB9XG4gICAgICBjaGsgXj0gMTtcbiAgICAgIGZvciAoaTIgPSAwOyBpMiA8IDY7ICsraTIpIHtcbiAgICAgICAgdmFyIHYyID0gY2hrID4+ICg1IC0gaTIpICogNSAmIDMxO1xuICAgICAgICByZXN1bHQgKz0gQUxQSEFCRVQyLmNoYXJBdCh2Mik7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBmdW5jdGlvbiBfX2RlY29kZShzdHIsIExJTUlUKSB7XG4gICAgICBMSU1JVCA9IExJTUlUIHx8IDkwO1xuICAgICAgaWYgKHN0ci5sZW5ndGggPCA4KSByZXR1cm4gc3RyICsgXCIgdG9vIHNob3J0XCI7XG4gICAgICBpZiAoc3RyLmxlbmd0aCA+IExJTUlUKSByZXR1cm4gXCJFeGNlZWRzIGxlbmd0aCBsaW1pdFwiO1xuICAgICAgdmFyIGxvd2VyZWQgPSBzdHIudG9Mb3dlckNhc2UoKTtcbiAgICAgIHZhciB1cHBlcmVkID0gc3RyLnRvVXBwZXJDYXNlKCk7XG4gICAgICBpZiAoc3RyICE9PSBsb3dlcmVkICYmIHN0ciAhPT0gdXBwZXJlZCkgcmV0dXJuIFwiTWl4ZWQtY2FzZSBzdHJpbmcgXCIgKyBzdHI7XG4gICAgICBzdHIgPSBsb3dlcmVkO1xuICAgICAgdmFyIHNwbGl0ID0gc3RyLmxhc3RJbmRleE9mKFwiMVwiKTtcbiAgICAgIGlmIChzcGxpdCA9PT0gLTEpIHJldHVybiBcIk5vIHNlcGFyYXRvciBjaGFyYWN0ZXIgZm9yIFwiICsgc3RyO1xuICAgICAgaWYgKHNwbGl0ID09PSAwKSByZXR1cm4gXCJNaXNzaW5nIHByZWZpeCBmb3IgXCIgKyBzdHI7XG4gICAgICB2YXIgcHJlZml4ID0gc3RyLnNsaWNlKDAsIHNwbGl0KTtcbiAgICAgIHZhciB3b3JkQ2hhcnMgPSBzdHIuc2xpY2Uoc3BsaXQgKyAxKTtcbiAgICAgIGlmICh3b3JkQ2hhcnMubGVuZ3RoIDwgNikgcmV0dXJuIFwiRGF0YSB0b28gc2hvcnRcIjtcbiAgICAgIHZhciBjaGsgPSBwcmVmaXhDaGsocHJlZml4KTtcbiAgICAgIGlmICh0eXBlb2YgY2hrID09PSBcInN0cmluZ1wiKSByZXR1cm4gY2hrO1xuICAgICAgdmFyIHdvcmRzID0gW107XG4gICAgICBmb3IgKHZhciBpMiA9IDA7IGkyIDwgd29yZENoYXJzLmxlbmd0aDsgKytpMikge1xuICAgICAgICB2YXIgYzIgPSB3b3JkQ2hhcnMuY2hhckF0KGkyKTtcbiAgICAgICAgdmFyIHYyID0gQUxQSEFCRVRfTUFQW2MyXTtcbiAgICAgICAgaWYgKHYyID09PSB2b2lkIDApIHJldHVybiBcIlVua25vd24gY2hhcmFjdGVyIFwiICsgYzI7XG4gICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoaykgXiB2MjtcbiAgICAgICAgaWYgKGkyICsgNiA+PSB3b3JkQ2hhcnMubGVuZ3RoKSBjb250aW51ZTtcbiAgICAgICAgd29yZHMucHVzaCh2Mik7XG4gICAgICB9XG4gICAgICBpZiAoY2hrICE9PSAxKSByZXR1cm4gXCJJbnZhbGlkIGNoZWNrc3VtIGZvciBcIiArIHN0cjtcbiAgICAgIHJldHVybiB7IHByZWZpeCwgd29yZHMgfTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZGVjb2RlVW5zYWZlKCkge1xuICAgICAgdmFyIHJlcyA9IF9fZGVjb2RlLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodHlwZW9mIHJlcyA9PT0gXCJvYmplY3RcIikgcmV0dXJuIHJlcztcbiAgICB9XG4gICAgZnVuY3Rpb24gZGVjb2RlKHN0cikge1xuICAgICAgdmFyIHJlcyA9IF9fZGVjb2RlLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodHlwZW9mIHJlcyA9PT0gXCJvYmplY3RcIikgcmV0dXJuIHJlcztcbiAgICAgIHRocm93IG5ldyBFcnJvcihyZXMpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBjb252ZXJ0KGRhdGEsIGluQml0cywgb3V0Qml0cywgcGFkKSB7XG4gICAgICB2YXIgdmFsdWUgPSAwO1xuICAgICAgdmFyIGJpdHMgPSAwO1xuICAgICAgdmFyIG1heFYgPSAoMSA8PCBvdXRCaXRzKSAtIDE7XG4gICAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgICBmb3IgKHZhciBpMiA9IDA7IGkyIDwgZGF0YS5sZW5ndGg7ICsraTIpIHtcbiAgICAgICAgdmFsdWUgPSB2YWx1ZSA8PCBpbkJpdHMgfCBkYXRhW2kyXTtcbiAgICAgICAgYml0cyArPSBpbkJpdHM7XG4gICAgICAgIHdoaWxlIChiaXRzID49IG91dEJpdHMpIHtcbiAgICAgICAgICBiaXRzIC09IG91dEJpdHM7XG4gICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUgPj4gYml0cyAmIG1heFYpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAocGFkKSB7XG4gICAgICAgIGlmIChiaXRzID4gMCkge1xuICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlIDw8IG91dEJpdHMgLSBiaXRzICYgbWF4Vik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChiaXRzID49IGluQml0cykgcmV0dXJuIFwiRXhjZXNzIHBhZGRpbmdcIjtcbiAgICAgICAgaWYgKHZhbHVlIDw8IG91dEJpdHMgLSBiaXRzICYgbWF4VikgcmV0dXJuIFwiTm9uLXplcm8gcGFkZGluZ1wiO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgZnVuY3Rpb24gdG9Xb3Jkc1Vuc2FmZShieXRlcykge1xuICAgICAgdmFyIHJlcyA9IGNvbnZlcnQoYnl0ZXMsIDgsIDUsIHRydWUpO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVzKSkgcmV0dXJuIHJlcztcbiAgICB9XG4gICAgZnVuY3Rpb24gdG9Xb3JkcyhieXRlcykge1xuICAgICAgdmFyIHJlcyA9IGNvbnZlcnQoYnl0ZXMsIDgsIDUsIHRydWUpO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVzKSkgcmV0dXJuIHJlcztcbiAgICAgIHRocm93IG5ldyBFcnJvcihyZXMpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBmcm9tV29yZHNVbnNhZmUod29yZHMpIHtcbiAgICAgIHZhciByZXMgPSBjb252ZXJ0KHdvcmRzLCA1LCA4LCBmYWxzZSk7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXMpKSByZXR1cm4gcmVzO1xuICAgIH1cbiAgICBmdW5jdGlvbiBmcm9tV29yZHMod29yZHMpIHtcbiAgICAgIHZhciByZXMgPSBjb252ZXJ0KHdvcmRzLCA1LCA4LCBmYWxzZSk7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXMpKSByZXR1cm4gcmVzO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcyk7XG4gICAgfVxuICAgIG1vZHVsZS5leHBvcnRzID0ge1xuICAgICAgZGVjb2RlVW5zYWZlLFxuICAgICAgZGVjb2RlLFxuICAgICAgZW5jb2RlLFxuICAgICAgdG9Xb3Jkc1Vuc2FmZSxcbiAgICAgIHRvV29yZHMsXG4gICAgICBmcm9tV29yZHNVbnNhZmUsXG4gICAgICBmcm9tV29yZHNcbiAgICB9O1xuICB9XG59KTtcblxuLy9cbnZhciByZXF1aXJlX2JlY2gzMjIgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi9ub2RlX21vZHVsZXMvQGNvc21qcy9lbmNvZGluZy9idWlsZC9iZWNoMzIuanNcIihleHBvcnRzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgdmFyIF9fY3JlYXRlQmluZGluZyA9IGV4cG9ydHMgJiYgZXhwb3J0cy5fX2NyZWF0ZUJpbmRpbmcgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obzIsIG0yLCBrLCBrMikge1xuICAgICAgaWYgKGsyID09PSB2b2lkIDApIGsyID0gaztcbiAgICAgIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihtMiwgayk7XG4gICAgICBpZiAoIWRlc2MgfHwgKFwiZ2V0XCIgaW4gZGVzYyA/ICFtMi5fX2VzTW9kdWxlIDogZGVzYy53cml0YWJsZSB8fCBkZXNjLmNvbmZpZ3VyYWJsZSkpIHtcbiAgICAgICAgZGVzYyA9IHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gbTJba107XG4gICAgICAgIH0gfTtcbiAgICAgIH1cbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvMiwgazIsIGRlc2MpO1xuICAgIH0pIDogKGZ1bmN0aW9uKG8yLCBtMiwgaywgazIpIHtcbiAgICAgIGlmIChrMiA9PT0gdm9pZCAwKSBrMiA9IGs7XG4gICAgICBvMltrMl0gPSBtMltrXTtcbiAgICB9KSk7XG4gICAgdmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IGV4cG9ydHMgJiYgZXhwb3J0cy5fX3NldE1vZHVsZURlZmF1bHQgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obzIsIHYyKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobzIsIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2MiB9KTtcbiAgICB9KSA6IGZ1bmN0aW9uKG8yLCB2Mikge1xuICAgICAgbzJbXCJkZWZhdWx0XCJdID0gdjI7XG4gICAgfSk7XG4gICAgdmFyIF9faW1wb3J0U3RhciA9IGV4cG9ydHMgJiYgZXhwb3J0cy5fX2ltcG9ydFN0YXIgfHwgLyogICAgICAgICAgICovIChmdW5jdGlvbigpIHtcbiAgICAgIHZhciBvd25LZXlzMjUgPSBmdW5jdGlvbihvMikge1xuICAgICAgICBvd25LZXlzMjUgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyB8fCBmdW5jdGlvbihvMykge1xuICAgICAgICAgIHZhciBhciA9IFtdO1xuICAgICAgICAgIGZvciAodmFyIGsgaW4gbzMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobzMsIGspKSBhclthci5sZW5ndGhdID0gaztcbiAgICAgICAgICByZXR1cm4gYXI7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBvd25LZXlzMjUobzIpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBmdW5jdGlvbihtb2QpIHtcbiAgICAgICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgICAgICBpZiAobW9kICE9IG51bGwpIHtcbiAgICAgICAgICBmb3IgKHZhciBrID0gb3duS2V5czI1KG1vZCksIGkyID0gMDsgaTIgPCBrLmxlbmd0aDsgaTIrKykgaWYgKGtbaTJdICE9PSBcImRlZmF1bHRcIikgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrW2kyXSk7XG4gICAgICAgIH1cbiAgICAgICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH07XG4gICAgfSkoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy50b0JlY2gzMiA9IHRvQmVjaDMyO1xuICAgIGV4cG9ydHMuZnJvbUJlY2gzMiA9IGZyb21CZWNoMzIyO1xuICAgIGV4cG9ydHMubm9ybWFsaXplQmVjaDMyID0gbm9ybWFsaXplQmVjaDMyO1xuICAgIHZhciBiZWNoMzIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZV9iZWNoMzIoKSk7XG4gICAgZnVuY3Rpb24gdG9CZWNoMzIocHJlZml4LCBkYXRhLCBsaW1pdDIpIHtcbiAgICAgIGNvbnN0IGFkZHJlc3MgPSBiZWNoMzIuZW5jb2RlKHByZWZpeCwgYmVjaDMyLnRvV29yZHMoZGF0YSksIGxpbWl0Mik7XG4gICAgICByZXR1cm4gYWRkcmVzcztcbiAgICB9XG4gICAgZnVuY3Rpb24gZnJvbUJlY2gzMjIoYWRkcmVzcywgbGltaXQyID0gSW5maW5pdHkpIHtcbiAgICAgIGNvbnN0IGRlY29kZWRBZGRyZXNzID0gYmVjaDMyLmRlY29kZShhZGRyZXNzLCBsaW1pdDIpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJlZml4OiBkZWNvZGVkQWRkcmVzcy5wcmVmaXgsXG4gICAgICAgIGRhdGE6IG5ldyBVaW50OEFycmF5KGJlY2gzMi5mcm9tV29yZHMoZGVjb2RlZEFkZHJlc3Mud29yZHMpKVxuICAgICAgfTtcbiAgICB9XG4gICAgZnVuY3Rpb24gbm9ybWFsaXplQmVjaDMyKGFkZHJlc3MpIHtcbiAgICAgIGNvbnN0IHsgcHJlZml4LCBkYXRhIH0gPSBmcm9tQmVjaDMyMihhZGRyZXNzKTtcbiAgICAgIHJldHVybiB0b0JlY2gzMihwcmVmaXgsIGRhdGEpO1xuICAgIH1cbiAgfVxufSk7XG5cbi8vXG52YXIgcmVxdWlyZV9oZXggPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi9ub2RlX21vZHVsZXMvQGNvc21qcy9lbmNvZGluZy9idWlsZC9oZXguanNcIihleHBvcnRzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMudG9IZXggPSB0b0hleDtcbiAgICBleHBvcnRzLmZyb21IZXggPSBmcm9tSGV4MjtcbiAgICBmdW5jdGlvbiB0b0hleChkYXRhKSB7XG4gICAgICBsZXQgb3V0ID0gXCJcIjtcbiAgICAgIGZvciAoY29uc3QgYnl0ZSBvZiBkYXRhKSB7XG4gICAgICAgIG91dCArPSAoXCIwXCIgKyBieXRlLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG4gICAgZnVuY3Rpb24gZnJvbUhleDIoaGV4c3RyaW5nKSB7XG4gICAgICBpZiAoaGV4c3RyaW5nLmxlbmd0aCAlIDIgIT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaGV4IHN0cmluZyBsZW5ndGggbXVzdCBiZSBhIG11bHRpcGxlIG9mIDJcIik7XG4gICAgICB9XG4gICAgICBjb25zdCBvdXQgPSBuZXcgVWludDhBcnJheShoZXhzdHJpbmcubGVuZ3RoIC8gMik7XG4gICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgb3V0Lmxlbmd0aDsgaTIrKykge1xuICAgICAgICBjb25zdCBqID0gMiAqIGkyO1xuICAgICAgICBjb25zdCBoZXhCeXRlQXNTdHJpbmcgPSBoZXhzdHJpbmcuc2xpY2UoaiwgaiArIDIpO1xuICAgICAgICBpZiAoIWhleEJ5dGVBc1N0cmluZy5tYXRjaCgvWzAtOWEtZl17Mn0vaSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJoZXggc3RyaW5nIGNvbnRhaW5zIGludmFsaWQgY2hhcmFjdGVyc1wiKTtcbiAgICAgICAgfVxuICAgICAgICBvdXRbaTJdID0gcGFyc2VJbnQoaGV4Qnl0ZUFzU3RyaW5nLCAxNik7XG4gICAgICB9XG4gICAgICByZXR1cm4gb3V0O1xuICAgIH1cbiAgfVxufSk7XG5cbi8vXG52YXIgcmVxdWlyZV9yZmMzMzM5ID0gX19jb21tb25KUyh7XG4gIFwiLi4vbm9kZV9tb2R1bGVzL0Bjb3NtanMvZW5jb2RpbmcvYnVpbGQvcmZjMzMzOS5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy5mcm9tUmZjMzMzOSA9IGZyb21SZmMzMzM5O1xuICAgIGV4cG9ydHMudG9SZmMzMzM5ID0gdG9SZmMzMzM5O1xuICAgIHZhciByZmMzMzM5TWF0Y2hlciA9IC9eKFxcZHs0fSktKFxcZHsyfSktKFxcZHsyfSlbVCBdKFxcZHsyfSk6KFxcZHsyfSk6KFxcZHsyfSkoXFwuXFxkezEsOX0pPygoPzpbKy1dXFxkezJ9OlxcZHsyfSl8WikkLztcbiAgICBmdW5jdGlvbiBwYWRkZWQoaW50ZWdlciwgbGVuZ3RoID0gMikge1xuICAgICAgcmV0dXJuIGludGVnZXIudG9TdHJpbmcoKS5wYWRTdGFydChsZW5ndGgsIFwiMFwiKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZnJvbVJmYzMzMzkoc3RyKSB7XG4gICAgICBjb25zdCBtYXRjaGVzMiA9IHJmYzMzMzlNYXRjaGVyLmV4ZWMoc3RyKTtcbiAgICAgIGlmICghbWF0Y2hlczIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0ZSBzdHJpbmcgaXMgbm90IGluIFJGQzMzMzkgZm9ybWF0XCIpO1xuICAgICAgfVxuICAgICAgY29uc3QgeWVhciA9ICttYXRjaGVzMlsxXTtcbiAgICAgIGNvbnN0IG1vbnRoID0gK21hdGNoZXMyWzJdO1xuICAgICAgY29uc3QgZGF5ID0gK21hdGNoZXMyWzNdO1xuICAgICAgY29uc3QgaG91ciA9ICttYXRjaGVzMls0XTtcbiAgICAgIGNvbnN0IG1pbnV0ZSA9ICttYXRjaGVzMls1XTtcbiAgICAgIGNvbnN0IHNlY29uZCA9ICttYXRjaGVzMls2XTtcbiAgICAgIGNvbnN0IG1pbGxpU2Vjb25kcyA9IG1hdGNoZXMyWzddID8gTWF0aC5mbG9vcigrbWF0Y2hlczJbN10gKiAxZTMpIDogMDtcbiAgICAgIGxldCB0ek9mZnNldFNpZ247XG4gICAgICBsZXQgdHpPZmZzZXRIb3VycztcbiAgICAgIGxldCB0ek9mZnNldE1pbnV0ZXM7XG4gICAgICBpZiAobWF0Y2hlczJbOF0gPT09IFwiWlwiKSB7XG4gICAgICAgIHR6T2Zmc2V0U2lnbiA9IDE7XG4gICAgICAgIHR6T2Zmc2V0SG91cnMgPSAwO1xuICAgICAgICB0ek9mZnNldE1pbnV0ZXMgPSAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdHpPZmZzZXRTaWduID0gbWF0Y2hlczJbOF0uc3Vic3RyaW5nKDAsIDEpID09PSBcIi1cIiA/IC0xIDogMTtcbiAgICAgICAgdHpPZmZzZXRIb3VycyA9ICttYXRjaGVzMls4XS5zdWJzdHJpbmcoMSwgMyk7XG4gICAgICAgIHR6T2Zmc2V0TWludXRlcyA9ICttYXRjaGVzMls4XS5zdWJzdHJpbmcoNCwgNik7XG4gICAgICB9XG4gICAgICBjb25zdCB0ek9mZnNldCA9IHR6T2Zmc2V0U2lnbiAqICh0ek9mZnNldEhvdXJzICogNjAgKyB0ek9mZnNldE1pbnV0ZXMpICogNjA7XG4gICAgICBjb25zdCBkYXRlID0gLyogICAgICAgICAgICovIG5ldyBEYXRlKCk7XG4gICAgICBkYXRlLnNldFVUQ0Z1bGxZZWFyKHllYXIsIG1vbnRoIC0gMSwgZGF5KTtcbiAgICAgIGRhdGUuc2V0VVRDSG91cnMoaG91ciwgbWludXRlLCBzZWNvbmQsIG1pbGxpU2Vjb25kcyk7XG4gICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkgLSB0ek9mZnNldCAqIDFlMyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHRvUmZjMzMzOShkYXRlKSB7XG4gICAgICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRVVENGdWxsWWVhcigpO1xuICAgICAgY29uc3QgbW9udGggPSBwYWRkZWQoZGF0ZS5nZXRVVENNb250aCgpICsgMSk7XG4gICAgICBjb25zdCBkYXkgPSBwYWRkZWQoZGF0ZS5nZXRVVENEYXRlKCkpO1xuICAgICAgY29uc3QgaG91ciA9IHBhZGRlZChkYXRlLmdldFVUQ0hvdXJzKCkpO1xuICAgICAgY29uc3QgbWludXRlID0gcGFkZGVkKGRhdGUuZ2V0VVRDTWludXRlcygpKTtcbiAgICAgIGNvbnN0IHNlY29uZCA9IHBhZGRlZChkYXRlLmdldFVUQ1NlY29uZHMoKSk7XG4gICAgICBjb25zdCBtcyA9IHBhZGRlZChkYXRlLmdldFVUQ01pbGxpc2Vjb25kcygpLCAzKTtcbiAgICAgIHJldHVybiBgJHt5ZWFyfS0ke21vbnRofS0ke2RheX1UJHtob3VyfToke21pbnV0ZX06JHtzZWNvbmR9LiR7bXN9WmA7XG4gICAgfVxuICB9XG59KTtcblxuLy9cbnZhciByZXF1aXJlX3V0ZjggPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi9ub2RlX21vZHVsZXMvQGNvc21qcy9lbmNvZGluZy9idWlsZC91dGY4LmpzXCIoZXhwb3J0cykge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbiAgICBleHBvcnRzLnRvVXRmOCA9IHRvVXRmODtcbiAgICBleHBvcnRzLmZyb21VdGY4ID0gZnJvbVV0Zjg7XG4gICAgZnVuY3Rpb24gdG9VdGY4KHN0cikge1xuICAgICAgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzdHIpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBmcm9tVXRmOChkYXRhLCBsb3NzeSA9IGZhbHNlKSB7XG4gICAgICBjb25zdCBmYXRhbCA9ICFsb3NzeTtcbiAgICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoXCJ1dGYtOFwiLCB7IGZhdGFsIH0pLmRlY29kZShkYXRhKTtcbiAgICB9XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfYnVpbGQgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi9ub2RlX21vZHVsZXMvQGNvc21qcy9lbmNvZGluZy9idWlsZC9pbmRleC5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy50b1V0ZjggPSBleHBvcnRzLmZyb21VdGY4ID0gZXhwb3J0cy50b1JmYzMzMzkgPSBleHBvcnRzLmZyb21SZmMzMzM5ID0gZXhwb3J0cy50b0hleCA9IGV4cG9ydHMuZnJvbUhleCA9IGV4cG9ydHMudG9CZWNoMzIgPSBleHBvcnRzLm5vcm1hbGl6ZUJlY2gzMiA9IGV4cG9ydHMuZnJvbUJlY2gzMiA9IGV4cG9ydHMudG9CYXNlNjQgPSBleHBvcnRzLmZyb21CYXNlNjQgPSBleHBvcnRzLnRvQXNjaWkgPSBleHBvcnRzLmZyb21Bc2NpaSA9IHZvaWQgMDtcbiAgICB2YXIgYXNjaWlfMSA9IHJlcXVpcmVfYXNjaWkoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJmcm9tQXNjaWlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGFzY2lpXzEuZnJvbUFzY2lpO1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9Bc2NpaVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYXNjaWlfMS50b0FzY2lpO1xuICAgIH0gfSk7XG4gICAgdmFyIGJhc2U2NF8xID0gcmVxdWlyZV9iYXNlNjQoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJmcm9tQmFzZTY0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBiYXNlNjRfMS5mcm9tQmFzZTY0O1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9CYXNlNjRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGJhc2U2NF8xLnRvQmFzZTY0O1xuICAgIH0gfSk7XG4gICAgdmFyIGJlY2gzMl8xID0gcmVxdWlyZV9iZWNoMzIyKCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiZnJvbUJlY2gzMlwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYmVjaDMyXzEuZnJvbUJlY2gzMjtcbiAgICB9IH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIm5vcm1hbGl6ZUJlY2gzMlwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYmVjaDMyXzEubm9ybWFsaXplQmVjaDMyO1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9CZWNoMzJcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGJlY2gzMl8xLnRvQmVjaDMyO1xuICAgIH0gfSk7XG4gICAgdmFyIGhleF8xID0gcmVxdWlyZV9oZXgoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJmcm9tSGV4XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBoZXhfMS5mcm9tSGV4O1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9IZXhcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGhleF8xLnRvSGV4O1xuICAgIH0gfSk7XG4gICAgdmFyIHJmYzMzMzlfMSA9IHJlcXVpcmVfcmZjMzMzOSgpO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcImZyb21SZmMzMzM5XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiByZmMzMzM5XzEuZnJvbVJmYzMzMzk7XG4gICAgfSB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJ0b1JmYzMzMzlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHJmYzMzMzlfMS50b1JmYzMzMzk7XG4gICAgfSB9KTtcbiAgICB2YXIgdXRmOF8xID0gcmVxdWlyZV91dGY4KCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiZnJvbVV0ZjhcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHV0ZjhfMS5mcm9tVXRmODtcbiAgICB9IH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcInRvVXRmOFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdXRmOF8xLnRvVXRmODtcbiAgICB9IH0pO1xuICB9XG59KTtcblxuLy9cbnZhciBnbG9iYWxBc3NlcnQgPSBnbG9iYWxUaGlzLmFzc2VydDtcbmlmIChnbG9iYWxBc3NlcnQgPT09IHZvaWQgMCkge1xuICB0aHJvdyBFcnJvcihcbiAgICBgQ2Fubm90IGluaXRpYWxpemUgQGVuZG8vZXJyb3JzLCBtaXNzaW5nIGdsb2JhbFRoaXMuYXNzZXJ0LCBpbXBvcnQgJ3NlcycgYmVmb3JlICdAZW5kby9lcnJvcnMnYFxuICApO1xufVxudmFyIG1pc3NpbmcgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIFtcbiAgICBcInR5cGVvZlwiLFxuICAgIFwiZXJyb3JcIixcbiAgICBcImZhaWxcIixcbiAgICBcImVxdWFsXCIsXG4gICAgXCJzdHJpbmdcIixcbiAgICBcIm5vdGVcIixcbiAgICBcImRldGFpbHNcIixcbiAgICBcIkZhaWxcIixcbiAgICBcInF1b3RlXCIsXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICBcIm1ha2VBc3NlcnRcIlxuICBdLmZpbHRlcigobmFtZSkgPT4gZ2xvYmFsQXNzZXJ0W25hbWVdID09PSB2b2lkIDApXG4pO1xuaWYgKG1pc3NpbmcubGVuZ3RoID4gMCkge1xuICB0aHJvdyBFcnJvcihcbiAgICBgQ2Fubm90IGluaXRpYWxpemUgQGVuZG8vZXJyb3JzLCBtaXNzaW5nIGdsb2JhbFRoaXMuYXNzZXJ0IG1ldGhvZHMgJHttaXNzaW5nLmpvaW4oXG4gICAgICBcIiwgXCJcbiAgICApfWBcbiAgKTtcbn1cbnZhciB7XG4gIGJhcmUsXG4gIGRldGFpbHM6IHJlZGFjdGVkLFxuICBlcnJvcjogbWFrZUVycm9yLFxuICBGYWlsOiB0aHJvd1JlZGFjdGVkLFxuICBtYWtlQXNzZXJ0OiBfb21pdHRlZE1ha2VBc3NlcnQsXG4gIG5vdGUsXG4gIHF1b3RlLFxuICAuLi5hc3NlcnRpb25zXG59ID0gZ2xvYmFsQXNzZXJ0O1xudmFyIGFzc2VydDIgPSAodmFsdWUsIG9wdERldGFpbHMsIGVyckNvbnRydWN0b3IsIG9wdGlvbnMpID0+IGdsb2JhbEFzc2VydCh2YWx1ZSwgb3B0RGV0YWlscywgZXJyQ29udHJ1Y3Rvciwgb3B0aW9ucyk7XG5PYmplY3QuYXNzaWduKGFzc2VydDIsIGFzc2VydGlvbnMpO1xudmFyIGJhcmVPclF1b3RlID0gYmFyZSB8fCBxdW90ZTtcblxuLy9cbnZhciBpZGVudENoZWNrZXIgPSAoY29uZCwgX2RldGFpbHMpID0+IGNvbmQ7XG5oYXJkZW4oaWRlbnRDaGVja2VyKTtcblxuLy9cbnZhciBsb2NhbFRoaXMgPSBnbG9iYWxUaGlzO1xudmFyIHsgT2JqZWN0OiBPYmplY3QyLCBSZWZsZWN0OiBSZWZsZWN0MiwgQXJyYXk6IEFycmF5MiwgU3RyaW5nOiBTdHJpbmcyLCBKU09OOiBKU09OMiwgRXJyb3I6IEVycm9yMiB9ID0gbG9jYWxUaGlzO1xudmFyIHsgZnJlZXplIH0gPSBPYmplY3QyO1xudmFyIHsgYXBwbHkgfSA9IFJlZmxlY3QyO1xudmFyIHVuY3VycnlUaGlzID0gKGZuKSA9PiAocmVjZWl2ZXIsIC4uLmFyZ3MpID0+IGFwcGx5KGZuLCByZWNlaXZlciwgYXJncyk7XG52YXIgYXJyYXlQdXNoID0gdW5jdXJyeVRoaXMoQXJyYXkyLnByb3RvdHlwZS5wdXNoKTtcbnZhciBhcnJheUluY2x1ZGVzID0gdW5jdXJyeVRoaXMoQXJyYXkyLnByb3RvdHlwZS5pbmNsdWRlcyk7XG52YXIgc3RyaW5nU3BsaXQgPSB1bmN1cnJ5VGhpcyhTdHJpbmcyLnByb3RvdHlwZS5zcGxpdCk7XG52YXIgcSA9IEpTT04yLnN0cmluZ2lmeTtcbnZhciBGYWlsID0gKGxpdGVyYWxzLCAuLi5hcmdzKSA9PiB7XG4gIGxldCBtc2cgPSBsaXRlcmFsc1swXTtcbiAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGFyZ3MubGVuZ3RoOyBpMiArPSAxKSB7XG4gICAgbXNnID0gYCR7bXNnfSR7YXJnc1tpMl19JHtsaXRlcmFsc1tpMiArIDFdfWA7XG4gIH1cbiAgdGhyb3cgRXJyb3IyKG1zZyk7XG59O1xudmFyIG1ha2VFbnZpcm9ubWVudENhcHRvciA9IChhR2xvYmFsLCBkcm9wTmFtZXMgPSBmYWxzZSkgPT4ge1xuICBjb25zdCBjYXB0dXJlZEVudmlyb25tZW50T3B0aW9uTmFtZXMgPSBbXTtcbiAgY29uc3QgZ2V0RW52aXJvbm1lbnRPcHRpb24yID0gKG9wdGlvbk5hbWUsIGRlZmF1bHRTZXR0aW5nLCBvcHRPdGhlclZhbHVlcyA9IHZvaWQgMCkgPT4ge1xuICAgIHR5cGVvZiBvcHRpb25OYW1lID09PSBcInN0cmluZ1wiIHx8IEZhaWxgRW52aXJvbm1lbnQgb3B0aW9uIG5hbWUgJHtxKG9wdGlvbk5hbWUpfSBtdXN0IGJlIGEgc3RyaW5nLmA7XG4gICAgdHlwZW9mIGRlZmF1bHRTZXR0aW5nID09PSBcInN0cmluZ1wiIHx8IEZhaWxgRW52aXJvbm1lbnQgb3B0aW9uIGRlZmF1bHQgc2V0dGluZyAke3EoXG4gICAgICBkZWZhdWx0U2V0dGluZ1xuICAgICl9IG11c3QgYmUgYSBzdHJpbmcuYDtcbiAgICBsZXQgc2V0dGluZyA9IGRlZmF1bHRTZXR0aW5nO1xuICAgIGNvbnN0IGdsb2JhbFByb2Nlc3MgPSBhR2xvYmFsLnByb2Nlc3MgfHwgdm9pZCAwO1xuICAgIGNvbnN0IGdsb2JhbEVudiA9IHR5cGVvZiBnbG9iYWxQcm9jZXNzID09PSBcIm9iamVjdFwiICYmIGdsb2JhbFByb2Nlc3MuZW52IHx8IHZvaWQgMDtcbiAgICBpZiAodHlwZW9mIGdsb2JhbEVudiA9PT0gXCJvYmplY3RcIikge1xuICAgICAgaWYgKG9wdGlvbk5hbWUgaW4gZ2xvYmFsRW52KSB7XG4gICAgICAgIGlmICghZHJvcE5hbWVzKSB7XG4gICAgICAgICAgYXJyYXlQdXNoKGNhcHR1cmVkRW52aXJvbm1lbnRPcHRpb25OYW1lcywgb3B0aW9uTmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb3B0aW9uVmFsdWUgPSBnbG9iYWxFbnZbb3B0aW9uTmFtZV07XG4gICAgICAgIHR5cGVvZiBvcHRpb25WYWx1ZSA9PT0gXCJzdHJpbmdcIiB8fCBGYWlsYEVudmlyb25tZW50IG9wdGlvbiBuYW1lZCAke3EoXG4gICAgICAgICAgb3B0aW9uTmFtZVxuICAgICAgICApfSwgaWYgcHJlc2VudCwgbXVzdCBoYXZlIGEgY29ycmVzcG9uZGluZyBzdHJpbmcgdmFsdWUsIGdvdCAke3EoXG4gICAgICAgICAgb3B0aW9uVmFsdWVcbiAgICAgICAgKX1gO1xuICAgICAgICBzZXR0aW5nID0gb3B0aW9uVmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIG9wdE90aGVyVmFsdWVzID09PSB2b2lkIDAgfHwgc2V0dGluZyA9PT0gZGVmYXVsdFNldHRpbmcgfHwgYXJyYXlJbmNsdWRlcyhvcHRPdGhlclZhbHVlcywgc2V0dGluZykgfHwgRmFpbGBVbnJlY29nbml6ZWQgJHtxKG9wdGlvbk5hbWUpfSB2YWx1ZSAke3EoXG4gICAgICBzZXR0aW5nXG4gICAgKX0uIEV4cGVjdGVkIG9uZSBvZiAke3EoW2RlZmF1bHRTZXR0aW5nLCAuLi5vcHRPdGhlclZhbHVlc10pfWA7XG4gICAgcmV0dXJuIHNldHRpbmc7XG4gIH07XG4gIGZyZWV6ZShnZXRFbnZpcm9ubWVudE9wdGlvbjIpO1xuICBjb25zdCBnZXRFbnZpcm9ubWVudE9wdGlvbnNMaXN0MiA9IChvcHRpb25OYW1lKSA9PiB7XG4gICAgY29uc3Qgb3B0aW9uID0gZ2V0RW52aXJvbm1lbnRPcHRpb24yKG9wdGlvbk5hbWUsIFwiXCIpO1xuICAgIHJldHVybiBmcmVlemUob3B0aW9uID09PSBcIlwiID8gW10gOiBzdHJpbmdTcGxpdChvcHRpb24sIFwiLFwiKSk7XG4gIH07XG4gIGZyZWV6ZShnZXRFbnZpcm9ubWVudE9wdGlvbnNMaXN0Mik7XG4gIGNvbnN0IGVudmlyb25tZW50T3B0aW9uc0xpc3RIYXMyID0gKG9wdGlvbk5hbWUsIGVsZW1lbnQpID0+IGFycmF5SW5jbHVkZXMoZ2V0RW52aXJvbm1lbnRPcHRpb25zTGlzdDIob3B0aW9uTmFtZSksIGVsZW1lbnQpO1xuICBjb25zdCBnZXRDYXB0dXJlZEVudmlyb25tZW50T3B0aW9uTmFtZXMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGZyZWV6ZShbLi4uY2FwdHVyZWRFbnZpcm9ubWVudE9wdGlvbk5hbWVzXSk7XG4gIH07XG4gIGZyZWV6ZShnZXRDYXB0dXJlZEVudmlyb25tZW50T3B0aW9uTmFtZXMpO1xuICByZXR1cm4gZnJlZXplKHtcbiAgICBnZXRFbnZpcm9ubWVudE9wdGlvbjogZ2V0RW52aXJvbm1lbnRPcHRpb24yLFxuICAgIGdldEVudmlyb25tZW50T3B0aW9uc0xpc3Q6IGdldEVudmlyb25tZW50T3B0aW9uc0xpc3QyLFxuICAgIGVudmlyb25tZW50T3B0aW9uc0xpc3RIYXM6IGVudmlyb25tZW50T3B0aW9uc0xpc3RIYXMyLFxuICAgIGdldENhcHR1cmVkRW52aXJvbm1lbnRPcHRpb25OYW1lc1xuICB9KTtcbn07XG5mcmVlemUobWFrZUVudmlyb25tZW50Q2FwdG9yKTtcbnZhciB7XG4gIGdldEVudmlyb25tZW50T3B0aW9uLFxuICBnZXRFbnZpcm9ubWVudE9wdGlvbnNMaXN0LFxuICBlbnZpcm9ubWVudE9wdGlvbnNMaXN0SGFzXG59ID0gbWFrZUVudmlyb25tZW50Q2FwdG9yKGxvY2FsVGhpcywgdHJ1ZSk7XG5cbi8vXG52YXIgeyBxdW90ZTogcTIsIEZhaWw6IEZhaWwyIH0gPSBhc3NlcnQ7XG52YXIgeyBoYXNPd24sIGZyZWV6ZTogZnJlZXplMiwgZW50cmllcyB9ID0gT2JqZWN0O1xudmFyIGlzSlNPTlJlY29yZCA9ICh2YWwpID0+IHR5cGVvZiB2YWwgPT09IFwib2JqZWN0XCIgJiYgdmFsICE9PSBudWxsICYmICFBcnJheS5pc0FycmF5KHZhbCk7XG52YXIgc2ltcGxpZnlUYWcgPSAodGFnKSA9PiB7XG4gIGZvciAoY29uc3QgcHJlZml4IG9mIFtcIkFsbGVnZWQ6IFwiLCBcIkRlYnVnTmFtZTogXCJdKSB7XG4gICAgaWYgKHRhZy5zdGFydHNXaXRoKHByZWZpeCkpIHtcbiAgICAgIHJldHVybiB0YWcuc2xpY2UocHJlZml4Lmxlbmd0aCk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0YWc7XG59O1xudmFyIG1ha2VNZXNzYWdlQnJlYWtwb2ludFRlc3RlciA9IChvcHRpb25OYW1lKSA9PiB7XG4gIGxldCBicmVha3BvaW50cyA9IEpTT04ucGFyc2UoZ2V0RW52aXJvbm1lbnRPcHRpb24ob3B0aW9uTmFtZSwgXCJudWxsXCIpKTtcbiAgaWYgKGJyZWFrcG9pbnRzID09PSBudWxsKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBsZXQgYnJlYWtwb2ludHNUYWJsZTtcbiAgY29uc3QgZ2V0QnJlYWtwb2ludHMgPSAoKSA9PiBicmVha3BvaW50cztcbiAgZnJlZXplMihnZXRCcmVha3BvaW50cyk7XG4gIGNvbnN0IHNldEJyZWFrcG9pbnRzID0gKG5ld0JyZWFrcG9pbnRzID0gYnJlYWtwb2ludHMpID0+IHtcbiAgICBpc0pTT05SZWNvcmQobmV3QnJlYWtwb2ludHMpIHx8IEZhaWwyYEV4cGVjdGVkICR7cTIob3B0aW9uTmFtZSl9IG9wdGlvbiB0byBiZSBhIEpTT04gYnJlYWtwb2ludHMgcmVjb3JkYDtcbiAgICBjb25zdCBuZXdCcmVha3BvaW50c1RhYmxlID0geyBfX3Byb3RvX186IG51bGwgfTtcbiAgICBmb3IgKGNvbnN0IFt0YWcsIG1ldGhvZEJQc10gb2YgZW50cmllcyhuZXdCcmVha3BvaW50cykpIHtcbiAgICAgIHRhZyA9PT0gc2ltcGxpZnlUYWcodGFnKSB8fCBGYWlsMmBKdXN0IHVzZSBzaW1wbGUgdGFnICR7cTIoc2ltcGxpZnlUYWcodGFnKSl9IHJhdGhlciB0aGFuICR7cTIodGFnKX1gO1xuICAgICAgaXNKU09OUmVjb3JkKG1ldGhvZEJQcykgfHwgRmFpbDJgRXhwZWN0ZWQgJHtxMihvcHRpb25OYW1lKX0gb3B0aW9uJ3MgJHtxMihcbiAgICAgICAgdGFnXG4gICAgICApfSB0byBiZSBhIEpTT04gbWV0aG9kcyBicmVha3BvaW50cyByZWNvcmRgO1xuICAgICAgZm9yIChjb25zdCBbbWV0aG9kTmFtZSwgY291bnRdIG9mIGVudHJpZXMobWV0aG9kQlBzKSkge1xuICAgICAgICBjb3VudCA9PT0gXCIqXCIgfHwgdHlwZW9mIGNvdW50ID09PSBcIm51bWJlclwiICYmIE51bWJlci5pc1NhZmVJbnRlZ2VyKGNvdW50KSAmJiBjb3VudCA+PSAwIHx8IEZhaWwyYEV4cGVjdGVkICR7cTIob3B0aW9uTmFtZSl9IG9wdGlvbidzICR7cTIodGFnKX0uJHtxMihcbiAgICAgICAgICBtZXRob2ROYW1lXG4gICAgICAgICl9IHRvIGJlIFwiKlwiIG9yIGEgbm9uLW5lZ2F0aXZlIGludGVnZXJgO1xuICAgICAgICBjb25zdCBjbGFzc0JQcyA9IGhhc093bihuZXdCcmVha3BvaW50c1RhYmxlLCBtZXRob2ROYW1lKSA/IG5ld0JyZWFrcG9pbnRzVGFibGVbbWV0aG9kTmFtZV0gOiBuZXdCcmVha3BvaW50c1RhYmxlW21ldGhvZE5hbWVdID0ge1xuICAgICAgICAgIC8vXG4gICAgICAgICAgX19wcm90b19fOiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIGNsYXNzQlBzW3RhZ10gPSBjb3VudDtcbiAgICAgIH1cbiAgICB9XG4gICAgYnJlYWtwb2ludHMgPSBuZXdCcmVha3BvaW50cztcbiAgICBicmVha3BvaW50c1RhYmxlID0gbmV3QnJlYWtwb2ludHNUYWJsZTtcbiAgfTtcbiAgZnJlZXplMihzZXRCcmVha3BvaW50cyk7XG4gIGNvbnN0IHNob3VsZEJyZWFrcG9pbnQgPSAocmVjaXBpZW50LCBtZXRob2ROYW1lKSA9PiB7XG4gICAgaWYgKG1ldGhvZE5hbWUgPT09IHZvaWQgMCB8fCBtZXRob2ROYW1lID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGNsYXNzQlBzID0gYnJlYWtwb2ludHNUYWJsZVttZXRob2ROYW1lXSB8fCBicmVha3BvaW50c1RhYmxlW1wiKlwiXTtcbiAgICBpZiAoY2xhc3NCUHMgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBsZXQgdGFnID0gc2ltcGxpZnlUYWcocmVjaXBpZW50W1N5bWJvbC50b1N0cmluZ1RhZ10pO1xuICAgIGxldCBjb3VudCA9IGNsYXNzQlBzW3RhZ107XG4gICAgaWYgKGNvdW50ID09PSB2b2lkIDApIHtcbiAgICAgIHRhZyA9IFwiKlwiO1xuICAgICAgY291bnQgPSBjbGFzc0JQc1t0YWddO1xuICAgICAgaWYgKGNvdW50ID09PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoY291bnQgPT09IFwiKlwiKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGNvdW50ID09PSAwKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgYXNzZXJ0KHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiAmJiBjb3VudCA+PSAxKTtcbiAgICBjbGFzc0JQc1t0YWddID0gY291bnQgLSAxO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgZnJlZXplMihzaG91bGRCcmVha3BvaW50KTtcbiAgY29uc3QgYnJlYWtwb2ludFRlc3RlciA9IGZyZWV6ZTIoe1xuICAgIGdldEJyZWFrcG9pbnRzLFxuICAgIHNldEJyZWFrcG9pbnRzLFxuICAgIHNob3VsZEJyZWFrcG9pbnRcbiAgfSk7XG4gIGJyZWFrcG9pbnRUZXN0ZXIuc2V0QnJlYWtwb2ludHMoKTtcbiAgcmV0dXJuIGJyZWFrcG9pbnRUZXN0ZXI7XG59O1xuZnJlZXplMihtYWtlTWVzc2FnZUJyZWFrcG9pbnRUZXN0ZXIpO1xuXG4vL1xudmFyIHsgZGV0YWlsczogWCwgcXVvdGU6IHEzLCBGYWlsOiBGYWlsMyB9ID0gYXNzZXJ0O1xudmFyIHsgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycywgZ2V0UHJvdG90eXBlT2YsIGZyZWV6ZTogZnJlZXplMyB9ID0gT2JqZWN0O1xudmFyIHsgYXBwbHk6IGFwcGx5Miwgb3duS2V5cyB9ID0gUmVmbGVjdDtcbnZhciBvbkRlbGl2ZXJ5ID0gbWFrZU1lc3NhZ2VCcmVha3BvaW50VGVzdGVyKFwiRU5ET19ERUxJVkVSWV9CUkVBS1BPSU5UU1wiKTtcbnZhciBpc1ByaW1pdGl2ZSA9ICh2YWwpID0+ICF2YWwgfHwgdHlwZW9mIHZhbCAhPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgdmFsICE9PSBcImZ1bmN0aW9uXCI7XG52YXIgY29tcGFyZVN0cmluZ2lmaWVkID0gKGEyLCBiMykgPT4ge1xuICBpZiAodHlwZW9mIGEyID09PSB0eXBlb2YgYjMpIHtcbiAgICBjb25zdCBsZWZ0ID0gU3RyaW5nKGEyKTtcbiAgICBjb25zdCByaWdodCA9IFN0cmluZyhiMyk7XG4gICAgcmV0dXJuIGxlZnQgPCByaWdodCA/IC0xIDogbGVmdCA+IHJpZ2h0ID8gMSA6IDA7XG4gIH1cbiAgaWYgKHR5cGVvZiBhMiA9PT0gXCJzeW1ib2xcIikge1xuICAgIGFzc2VydCh0eXBlb2YgYjMgPT09IFwic3RyaW5nXCIpO1xuICAgIHJldHVybiAtMTtcbiAgfVxuICBhc3NlcnQodHlwZW9mIGEyID09PSBcInN0cmluZ1wiKTtcbiAgYXNzZXJ0KHR5cGVvZiBiMyA9PT0gXCJzeW1ib2xcIik7XG4gIHJldHVybiAxO1xufTtcbnZhciBnZXRNZXRob2ROYW1lcyA9ICh2YWwpID0+IHtcbiAgbGV0IGxheWVyID0gdmFsO1xuICBjb25zdCBuYW1lcyA9IC8qICAgICAgICAgICAqLyBuZXcgU2V0KCk7XG4gIHdoaWxlIChsYXllciAhPT0gbnVsbCAmJiBsYXllciAhPT0gT2JqZWN0LnByb3RvdHlwZSkge1xuICAgIGNvbnN0IGRlc2NzID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhsYXllcik7XG4gICAgZm9yIChjb25zdCBuYW1lIG9mIG93bktleXMoZGVzY3MpKSB7XG4gICAgICBpZiAodHlwZW9mIHZhbFtuYW1lXSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIG5hbWVzLmFkZChuYW1lKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGlzUHJpbWl0aXZlKHZhbCkpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBsYXllciA9IGdldFByb3RvdHlwZU9mKGxheWVyKTtcbiAgfVxuICByZXR1cm4gaGFyZGVuKFsuLi5uYW1lc10uc29ydChjb21wYXJlU3RyaW5naWZpZWQpKTtcbn07XG5mcmVlemUzKGdldE1ldGhvZE5hbWVzKTtcblxuLy9cbnZhciB7IGlzQXJyYXkgfSA9IEFycmF5O1xudmFyIHsgcHJvdG90eXBlOiBmdW5jdGlvblByb3RvdHlwZSB9ID0gRnVuY3Rpb247XG52YXIge1xuICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsXG4gIGdldFByb3RvdHlwZU9mOiBnZXRQcm90b3R5cGVPZjIsXG4gIGhhc093bjogaGFzT3duMixcbiAgaXNGcm96ZW4sXG4gIHByb3RvdHlwZTogb2JqZWN0UHJvdG90eXBlXG59ID0gT2JqZWN0O1xudmFyIHsgYXBwbHk6IGFwcGx5MyB9ID0gUmVmbGVjdDtcbnZhciB7IHRvU3RyaW5nVGFnOiB0b1N0cmluZ1RhZ1N5bWJvbCB9ID0gU3ltYm9sO1xudmFyIHR5cGVkQXJyYXlQcm90b3R5cGUgPSBnZXRQcm90b3R5cGVPZjIoVWludDhBcnJheS5wcm90b3R5cGUpO1xudmFyIHR5cGVkQXJyYXlUb1N0cmluZ1RhZ0Rlc2MgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoXG4gIHR5cGVkQXJyYXlQcm90b3R5cGUsXG4gIHRvU3RyaW5nVGFnU3ltYm9sXG4pO1xuYXNzZXJ0KHR5cGVkQXJyYXlUb1N0cmluZ1RhZ0Rlc2MpO1xudmFyIGdldFR5cGVkQXJyYXlUb1N0cmluZ1RhZyA9IHR5cGVkQXJyYXlUb1N0cmluZ1RhZ0Rlc2MuZ2V0O1xuYXNzZXJ0KHR5cGVvZiBnZXRUeXBlZEFycmF5VG9TdHJpbmdUYWcgPT09IFwiZnVuY3Rpb25cIik7XG52YXIgaXNQcmltaXRpdmUyID0gKHZhbCkgPT4gKFxuICAvL1xuICAvL1xuICAvL1xuICAhdmFsIHx8IHR5cGVvZiB2YWwgIT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIHZhbCAhPT0gXCJmdW5jdGlvblwiXG4pO1xuaGFyZGVuKGlzUHJpbWl0aXZlMik7XG52YXIgaXNPYmplY3QgPSAodmFsKSA9PiAoXG4gIC8vXG4gIC8vXG4gIC8vXG4gICEhdmFsICYmICh0eXBlb2YgdmFsID09PSBcIm9iamVjdFwiIHx8IHR5cGVvZiB2YWwgPT09IFwiZnVuY3Rpb25cIilcbik7XG5oYXJkZW4oaXNPYmplY3QpO1xudmFyIGlzVHlwZWRBcnJheSA9IChvYmplY3QpID0+IHtcbiAgY29uc3QgdGFnID0gYXBwbHkzKGdldFR5cGVkQXJyYXlUb1N0cmluZ1RhZywgb2JqZWN0LCBbXSk7XG4gIHJldHVybiB0YWcgIT09IHZvaWQgMDtcbn07XG5oYXJkZW4oaXNUeXBlZEFycmF5KTtcbnZhciBQQVNTX1NUWUxFID0gU3ltYm9sLmZvcihcInBhc3NTdHlsZVwiKTtcbnZhciBhc3NlcnRDaGVja2VyID0gKGNvbmQsIGRldGFpbHMpID0+IHtcbiAgYXNzZXJ0KGNvbmQsIGRldGFpbHMpO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5oYXJkZW4oYXNzZXJ0Q2hlY2tlcik7XG52YXIgQ1ggPSAoY2hlY2spID0+IHtcbiAgY29uc3QgcmVqZWN0ID0gKFQsIC4uLnN1YnMpID0+IGNoZWNrKGZhbHNlLCByZWRhY3RlZChULCAuLi5zdWJzKSk7XG4gIHJldHVybiByZWplY3Q7XG59O1xuaGFyZGVuKENYKTtcbnZhciBnZXRPd25EYXRhRGVzY3JpcHRvciA9IChjYW5kaWRhdGUsIHByb3BOYW1lLCBzaG91bGRCZUVudW1lcmFibGUsIGNoZWNrKSA9PiB7XG4gIGNvbnN0IGRlc2MgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGNhbmRpZGF0ZSwgcHJvcE5hbWUpXG4gICk7XG4gIHJldHVybiAoZGVzYyAhPT0gdm9pZCAwIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYCR7cXVvdGUocHJvcE5hbWUpfSBwcm9wZXJ0eSBleHBlY3RlZDogJHtjYW5kaWRhdGV9YCkgJiYgKGhhc093bjIoZGVzYywgXCJ2YWx1ZVwiKSB8fCAhIWNoZWNrICYmIENYKFxuICAgIGNoZWNrXG4gIClgJHtxdW90ZShwcm9wTmFtZSl9IG11c3Qgbm90IGJlIGFuIGFjY2Vzc29yIHByb3BlcnR5OiAke2NhbmRpZGF0ZX1gKSAmJiAoc2hvdWxkQmVFbnVtZXJhYmxlID8gZGVzYy5lbnVtZXJhYmxlIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgY2hlY2tcbiAgKWAke3F1b3RlKHByb3BOYW1lKX0gbXVzdCBiZSBhbiBlbnVtZXJhYmxlIHByb3BlcnR5OiAke2NhbmRpZGF0ZX1gIDogIWRlc2MuZW51bWVyYWJsZSB8fCAhIWNoZWNrICYmIENYKFxuICAgIGNoZWNrXG4gIClgJHtxdW90ZShwcm9wTmFtZSl9IG11c3Qgbm90IGJlIGFuIGVudW1lcmFibGUgcHJvcGVydHk6ICR7Y2FuZGlkYXRlfWApID8gZGVzYyA6IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgdm9pZCAwXG4gICk7XG59O1xuaGFyZGVuKGdldE93bkRhdGFEZXNjcmlwdG9yKTtcbnZhciBnZXRUYWcgPSAodGFnUmVjb3JkKSA9PiB0YWdSZWNvcmRbU3ltYm9sLnRvU3RyaW5nVGFnXTtcbmhhcmRlbihnZXRUYWcpO1xudmFyIGNoZWNrUGFzc1N0eWxlID0gKG9iaiwgcGFzc1N0eWxlLCBleHBlY3RlZFBhc3NTdHlsZSwgY2hlY2spID0+IHtcbiAgcmV0dXJuIHBhc3NTdHlsZSA9PT0gZXhwZWN0ZWRQYXNzU3R5bGUgfHwgISFjaGVjayAmJiBDWChjaGVjaylgRXhwZWN0ZWQgJHtxdW90ZShleHBlY3RlZFBhc3NTdHlsZSl9LCBub3QgJHtxdW90ZShwYXNzU3R5bGUpfTogJHtvYmp9YDtcbn07XG5oYXJkZW4oY2hlY2tQYXNzU3R5bGUpO1xudmFyIG1ha2VDaGVja1RhZ1JlY29yZCA9IChjaGVja1Byb3RvKSA9PiB7XG4gIGNvbnN0IGNoZWNrVGFnUmVjb3JkMiA9ICh0YWdSZWNvcmQsIGV4cGVjdGVkUGFzc1N0eWxlLCBjaGVjaykgPT4ge1xuICAgIHJldHVybiAoIWlzUHJpbWl0aXZlMih0YWdSZWNvcmQpIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYEEgbm9uLW9iamVjdCBjYW5ub3QgYmUgYSB0YWdSZWNvcmQ6ICR7dGFnUmVjb3JkfWApICYmIChpc0Zyb3plbih0YWdSZWNvcmQpIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYEEgdGFnUmVjb3JkIG11c3QgYmUgZnJvemVuOiAke3RhZ1JlY29yZH1gKSAmJiAoIWlzQXJyYXkodGFnUmVjb3JkKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBBbiBhcnJheSBjYW5ub3QgYmUgYSB0YWdSZWNvcmQ6ICR7dGFnUmVjb3JkfWApICYmIGNoZWNrUGFzc1N0eWxlKFxuICAgICAgdGFnUmVjb3JkLFxuICAgICAgZ2V0T3duRGF0YURlc2NyaXB0b3IodGFnUmVjb3JkLCBQQVNTX1NUWUxFLCBmYWxzZSwgY2hlY2spLnZhbHVlLFxuICAgICAgZXhwZWN0ZWRQYXNzU3R5bGUsXG4gICAgICBjaGVja1xuICAgICkgJiYgKHR5cGVvZiBnZXRPd25EYXRhRGVzY3JpcHRvcih0YWdSZWNvcmQsIFN5bWJvbC50b1N0cmluZ1RhZywgZmFsc2UsIGNoZWNrKS52YWx1ZSA9PT0gXCJzdHJpbmdcIiB8fCAhIWNoZWNrICYmIENYKFxuICAgICAgY2hlY2tcbiAgICApYEEgW1N5bWJvbC50b1N0cmluZ1RhZ10tbmFtZWQgcHJvcGVydHkgbXVzdCBiZSBhIHN0cmluZzogJHt0YWdSZWNvcmR9YCkgJiYgY2hlY2tQcm90byh0YWdSZWNvcmQsIGdldFByb3RvdHlwZU9mMih0YWdSZWNvcmQpLCBjaGVjayk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oY2hlY2tUYWdSZWNvcmQyKTtcbn07XG52YXIgY2hlY2tUYWdSZWNvcmQgPSBtYWtlQ2hlY2tUYWdSZWNvcmQoXG4gICh2YWwsIHByb3RvLCBjaGVjaykgPT4gcHJvdG8gPT09IG9iamVjdFByb3RvdHlwZSB8fCAhIWNoZWNrICYmIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBBIHRhZ1JlY29yZCBtdXN0IGluaGVyaXQgZnJvbSBPYmplY3QucHJvdG90eXBlOiAke3ZhbH1gKVxuKTtcbmhhcmRlbihjaGVja1RhZ1JlY29yZCk7XG52YXIgY2hlY2tGdW5jdGlvblRhZ1JlY29yZCA9IG1ha2VDaGVja1RhZ1JlY29yZChcbiAgKHZhbCwgcHJvdG8sIGNoZWNrKSA9PiBwcm90byA9PT0gZnVuY3Rpb25Qcm90b3R5cGUgfHwgcHJvdG8gIT09IG51bGwgJiYgZ2V0UHJvdG90eXBlT2YyKHByb3RvKSA9PT0gZnVuY3Rpb25Qcm90b3R5cGUgfHwgISFjaGVjayAmJiBjaGVjayhcbiAgICBmYWxzZSxcbiAgICByZWRhY3RlZGBGb3IgZnVuY3Rpb25zLCBhIHRhZ1JlY29yZCBtdXN0IGluaGVyaXQgZnJvbSBGdW5jdGlvbi5wcm90b3R5cGU6ICR7dmFsfWBcbiAgKVxuKTtcbmhhcmRlbihjaGVja0Z1bmN0aW9uVGFnUmVjb3JkKTtcblxuLy9cbnZhciBjYW5CZU1ldGhvZCA9IChmdW5jKSA9PiB0eXBlb2YgZnVuYyA9PT0gXCJmdW5jdGlvblwiICYmICEoUEFTU19TVFlMRSBpbiBmdW5jKTtcbmhhcmRlbihjYW5CZU1ldGhvZCk7XG52YXIgY2FuQmVNZXRob2ROYW1lID0gKGtleSkgPT4gKFxuICAvL1xuICB0eXBlb2Yga2V5ID09PSBcInN0cmluZ1wiIHx8IHR5cGVvZiBrZXkgPT09IFwic3ltYm9sXCIgfHwgdHlwZW9mIGtleSA9PT0gXCJudW1iZXJcIlxuKTtcbmhhcmRlbihjYW5CZU1ldGhvZE5hbWUpO1xudmFyIGdldFJlbW90YWJsZU1ldGhvZE5hbWVzID0gKGJlaGF2aW9yTWV0aG9kcykgPT4gZ2V0TWV0aG9kTmFtZXMoYmVoYXZpb3JNZXRob2RzKTtcbmhhcmRlbihnZXRSZW1vdGFibGVNZXRob2ROYW1lcyk7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzMiB9ID0gUmVmbGVjdDtcbnZhciB7IGlzQXJyYXk6IGlzQXJyYXkyIH0gPSBBcnJheTtcbnZhciB7XG4gIGdldFByb3RvdHlwZU9mOiBnZXRQcm90b3R5cGVPZjMsXG4gIGlzRnJvemVuOiBpc0Zyb3plbjIsXG4gIHByb3RvdHlwZTogb2JqZWN0UHJvdG90eXBlMixcbiAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczIsXG4gIGhhc093bjogaGFzT3duM1xufSA9IE9iamVjdDtcbnZhciBjaGVja0lmYWNlID0gKGlmYWNlLCBjaGVjaykgPT4ge1xuICByZXR1cm4gKFxuICAgIC8vXG4gICAgKHR5cGVvZiBpZmFjZSA9PT0gXCJzdHJpbmdcIiB8fCAhIWNoZWNrICYmIENYKFxuICAgICAgY2hlY2tcbiAgICApYEZvciBub3csIGludGVyZmFjZSAke2lmYWNlfSBtdXN0IGJlIGEgc3RyaW5nOyB1bmltcGxlbWVudGVkYCkgJiYgKGlmYWNlID09PSBcIlJlbW90YWJsZVwiIHx8IGlmYWNlLnN0YXJ0c1dpdGgoXCJBbGxlZ2VkOiBcIikgfHwgaWZhY2Uuc3RhcnRzV2l0aChcIkRlYnVnTmFtZTogXCIpIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYEZvciBub3csIGlmYWNlICR7cXVvdGUoXG4gICAgICBpZmFjZVxuICAgICl9IG11c3QgYmUgXCJSZW1vdGFibGVcIiBvciBiZWdpbiB3aXRoIFwiQWxsZWdlZDogXCIgb3IgXCJEZWJ1Z05hbWU6IFwiOyB1bmltcGxlbWVudGVkYClcbiAgKTtcbn07XG52YXIgYXNzZXJ0SWZhY2UgPSAoaWZhY2UpID0+IGNoZWNrSWZhY2UoaWZhY2UsIGFzc2VydENoZWNrZXIpO1xuaGFyZGVuKGFzc2VydElmYWNlKTtcbnZhciBjaGVja1JlbW90YWJsZVByb3RvT2YgPSAob3JpZ2luYWwsIGNoZWNrKSA9PiB7XG4gICFpc1ByaW1pdGl2ZTIob3JpZ2luYWwpIHx8IHRocm93UmVkYWN0ZWRgUmVtb3RhYmxlcyBtdXN0IGJlIG9iamVjdHMgb3IgZnVuY3Rpb25zOiAke29yaWdpbmFsfWA7XG4gIGNvbnN0IHByb3RvID0gZ2V0UHJvdG90eXBlT2YzKG9yaWdpbmFsKTtcbiAgaWYgKHByb3RvID09PSBvYmplY3RQcm90b3R5cGUyIHx8IHByb3RvID09PSBudWxsIHx8IHByb3RvID09PSBGdW5jdGlvbi5wcm90b3R5cGUpIHtcbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChjaGVjaylgUmVtb3RhYmxlcyBtdXN0IGJlIGV4cGxpY2l0bHkgZGVjbGFyZWQ6ICR7cXVvdGUob3JpZ2luYWwpfWA7XG4gIH1cbiAgaWYgKHR5cGVvZiBvcmlnaW5hbCA9PT0gXCJvYmplY3RcIikge1xuICAgIGNvbnN0IHByb3RvUHJvdG8gPSBnZXRQcm90b3R5cGVPZjMocHJvdG8pO1xuICAgIGlmIChwcm90b1Byb3RvICE9PSBvYmplY3RQcm90b3R5cGUyICYmIHByb3RvUHJvdG8gIT09IG51bGwpIHtcbiAgICAgIHJldHVybiBjaGVja1JlbW90YWJsZShwcm90bywgY2hlY2spO1xuICAgIH1cbiAgICBpZiAoIWNoZWNrVGFnUmVjb3JkKHByb3RvLCBcInJlbW90YWJsZVwiLCBjaGVjaykpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0gZWxzZSBpZiAodHlwZW9mIG9yaWdpbmFsID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICBpZiAoIWNoZWNrRnVuY3Rpb25UYWdSZWNvcmQocHJvdG8sIFwicmVtb3RhYmxlXCIsIGNoZWNrKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICBjb25zdCBwYXNzU3R5bGVLZXkgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgIFBBU1NfU1RZTEVcbiAgKTtcbiAgY29uc3QgdGFnS2V5ID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICBTeW1ib2wudG9TdHJpbmdUYWdcbiAgKTtcbiAgY29uc3Qge1xuICAgIC8vXG4gICAgW1xuICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICBwYXNzU3R5bGVLZXlcbiAgICBdOiBfcGFzc1N0eWxlRGVzYyxcbiAgICBbXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHRhZ0tleVxuICAgIF06IHsgdmFsdWU6IGlmYWNlIH0sXG4gICAgLi4ucmVzdERlc2NzXG4gIH0gPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzMihwcm90byk7XG4gIHJldHVybiAob3duS2V5czIocmVzdERlc2NzKS5sZW5ndGggPT09IDAgfHwgISFjaGVjayAmJiBDWChcbiAgICBjaGVja1xuICApYFVuZXhwZWN0ZWQgcHJvcGVydGllcyBvbiBSZW1vdGFibGUgUHJvdG8gJHtvd25LZXlzMihyZXN0RGVzY3MpfWApICYmIGNoZWNrSWZhY2UoaWZhY2UsIGNoZWNrKTtcbn07XG52YXIgY29uZmlybWVkUmVtb3RhYmxlcyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xudmFyIGNoZWNrUmVtb3RhYmxlID0gKHZhbCwgY2hlY2spID0+IHtcbiAgaWYgKGNvbmZpcm1lZFJlbW90YWJsZXMuaGFzKHZhbCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoIWlzRnJvemVuMih2YWwpKSB7XG4gICAgcmV0dXJuICEhY2hlY2sgJiYgQ1goY2hlY2spYGNhbm5vdCBzZXJpYWxpemUgbm9uLWZyb3plbiBvYmplY3RzIGxpa2UgJHt2YWx9YDtcbiAgfVxuICBpZiAoIVJlbW90YWJsZUhlbHBlci5jYW5CZVZhbGlkKHZhbCwgY2hlY2spKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IHJlc3VsdCA9IGNoZWNrUmVtb3RhYmxlUHJvdG9PZih2YWwsIGNoZWNrKTtcbiAgaWYgKHJlc3VsdCkge1xuICAgIGNvbmZpcm1lZFJlbW90YWJsZXMuYWRkKHZhbCk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgZ2V0SW50ZXJmYWNlT2YgPSAodmFsKSA9PiB7XG4gIGlmIChpc1ByaW1pdGl2ZTIodmFsKSB8fCB2YWxbUEFTU19TVFlMRV0gIT09IFwicmVtb3RhYmxlXCIgfHwgIWNoZWNrUmVtb3RhYmxlKHZhbCkpIHtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG4gIHJldHVybiBnZXRUYWcodmFsKTtcbn07XG5oYXJkZW4oZ2V0SW50ZXJmYWNlT2YpO1xudmFyIFJlbW90YWJsZUhlbHBlciA9IGhhcmRlbih7XG4gIHN0eWxlTmFtZTogXCJyZW1vdGFibGVcIixcbiAgY2FuQmVWYWxpZDogKGNhbmRpZGF0ZSwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgICBjb25zdCB2YWxpZFR5cGUgPSAoIWlzUHJpbWl0aXZlMihjYW5kaWRhdGUpIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYGNhbm5vdCBzZXJpYWxpemUgbm9uLW9iamVjdHMgYXMgUmVtb3RhYmxlICR7Y2FuZGlkYXRlfWApICYmICghaXNBcnJheTIoY2FuZGlkYXRlKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBjYW5ub3Qgc2VyaWFsaXplIGFycmF5cyBhcyBSZW1vdGFibGUgJHtjYW5kaWRhdGV9YCk7XG4gICAgaWYgKCF2YWxpZFR5cGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgZGVzY3MgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzMihjYW5kaWRhdGUpO1xuICAgIGlmICh0eXBlb2YgY2FuZGlkYXRlID09PSBcIm9iamVjdFwiKSB7XG4gICAgICByZXR1cm4gb3duS2V5czIoZGVzY3MpLmV2ZXJ5KChrZXkpID0+IHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAvL1xuICAgICAgICAgIChoYXNPd24zKGRlc2NzW1xuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICBrZXlcbiAgICAgICAgICBdLCBcInZhbHVlXCIpIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYGNhbm5vdCBzZXJpYWxpemUgUmVtb3RhYmxlcyB3aXRoIGFjY2Vzc29ycyBsaWtlICR7cXVvdGUoXG4gICAgICAgICAgICBTdHJpbmcoa2V5KVxuICAgICAgICAgICl9IGluICR7Y2FuZGlkYXRlfWApICYmIChrZXkgPT09IFN5bWJvbC50b1N0cmluZ1RhZyAmJiBjaGVja0lmYWNlKGNhbmRpZGF0ZVtrZXldLCBjaGVjaykgfHwgKGNhbkJlTWV0aG9kKGNhbmRpZGF0ZVtrZXldKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBjYW5ub3Qgc2VyaWFsaXplIFJlbW90YWJsZXMgd2l0aCBub24tbWV0aG9kcyBsaWtlICR7cXVvdGUoXG4gICAgICAgICAgICBTdHJpbmcoa2V5KVxuICAgICAgICAgICl9IGluICR7Y2FuZGlkYXRlfWApICYmIChrZXkgIT09IFBBU1NfU1RZTEUgfHwgISFjaGVjayAmJiBDWChjaGVjaylgQSBwYXNzLWJ5LXJlbW90ZSBjYW5ub3Qgc2hhZG93ICR7cXVvdGUoUEFTU19TVFlMRSl9YCkpXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBjYW5kaWRhdGUgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgY29uc3Qge1xuICAgICAgICBuYW1lOiBuYW1lRGVzYyxcbiAgICAgICAgbGVuZ3RoOiBsZW5ndGhEZXNjLFxuICAgICAgICAvL1xuICAgICAgICBbU3ltYm9sLnRvU3RyaW5nVGFnXTogdG9TdHJpbmdUYWdEZXNjLFxuICAgICAgICAuLi5yZXN0RGVzY3NcbiAgICAgIH0gPSBkZXNjcztcbiAgICAgIGNvbnN0IHJlc3RLZXlzID0gb3duS2V5czIocmVzdERlc2NzKTtcbiAgICAgIHJldHVybiAobmFtZURlc2MgJiYgdHlwZW9mIG5hbWVEZXNjLnZhbHVlID09PSBcInN0cmluZ1wiIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYEZhciBmdW5jdGlvbiBuYW1lIG11c3QgYmUgYSBzdHJpbmcsIGluICR7Y2FuZGlkYXRlfWApICYmIChsZW5ndGhEZXNjICYmIHR5cGVvZiBsZW5ndGhEZXNjLnZhbHVlID09PSBcIm51bWJlclwiIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgICAgIGNoZWNrXG4gICAgICApYEZhciBmdW5jdGlvbiBsZW5ndGggbXVzdCBiZSBhIG51bWJlciwgaW4gJHtjYW5kaWRhdGV9YCkgJiYgKHRvU3RyaW5nVGFnRGVzYyA9PT0gdm9pZCAwIHx8ICh0eXBlb2YgdG9TdHJpbmdUYWdEZXNjLnZhbHVlID09PSBcInN0cmluZ1wiIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgICAgIGNoZWNrXG4gICAgICApYEZhciBmdW5jdGlvbiBAQHRvU3RyaW5nVGFnIG11c3QgYmUgYSBzdHJpbmcsIGluICR7Y2FuZGlkYXRlfWApICYmIGNoZWNrSWZhY2UodG9TdHJpbmdUYWdEZXNjLnZhbHVlLCBjaGVjaykpICYmIChyZXN0S2V5cy5sZW5ndGggPT09IDAgfHwgISFjaGVjayAmJiBDWChcbiAgICAgICAgY2hlY2tcbiAgICAgIClgRmFyIGZ1bmN0aW9ucyB1bmV4cGVjdGVkIHByb3BlcnRpZXMgYmVzaWRlcyAubmFtZSBhbmQgLmxlbmd0aCAke3Jlc3RLZXlzfWApO1xuICAgIH1cbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChjaGVjaylgdW5yZWNvZ25pemVkIHR5cGVvZiAke2NhbmRpZGF0ZX1gO1xuICB9LFxuICBhc3NlcnRSZXN0VmFsaWQ6IChjYW5kaWRhdGUpID0+IGNoZWNrUmVtb3RhYmxlKGNhbmRpZGF0ZSwgYXNzZXJ0Q2hlY2tlciksXG4gIGV2ZXJ5OiAoX3Bhc3NhYmxlLCBfZm4pID0+IHRydWVcbn0pO1xuXG4vL1xudmFyIHsgcHJvdG90eXBlOiBmdW5jdGlvblByb3RvdHlwZTIgfSA9IEZ1bmN0aW9uO1xudmFyIHtcbiAgZ2V0UHJvdG90eXBlT2Y6IGdldFByb3RvdHlwZU9mNCxcbiAgc2V0UHJvdG90eXBlT2YsXG4gIGNyZWF0ZSxcbiAgaXNGcm96ZW46IGlzRnJvemVuMyxcbiAgcHJvdG90eXBlOiBvYmplY3RQcm90b3R5cGUzXG59ID0gT2JqZWN0O1xudmFyIG1ha2VSZW1vdGFibGVQcm90byA9IChyZW1vdGFibGUsIGlmYWNlKSA9PiB7XG4gIGxldCBvbGRQcm90byA9IGdldFByb3RvdHlwZU9mNChyZW1vdGFibGUpO1xuICBpZiAodHlwZW9mIHJlbW90YWJsZSA9PT0gXCJvYmplY3RcIikge1xuICAgIGlmIChvbGRQcm90byA9PT0gbnVsbCkge1xuICAgICAgb2xkUHJvdG8gPSBvYmplY3RQcm90b3R5cGUzO1xuICAgIH1cbiAgICBvbGRQcm90byA9PT0gb2JqZWN0UHJvdG90eXBlMyB8fCB0aHJvd1JlZGFjdGVkYEZvciBub3csIHJlbW90YWJsZXMgY2Fubm90IGluaGVyaXQgZnJvbSBhbnl0aGluZyB1bnVzdWFsLCBpbiAke3JlbW90YWJsZX1gO1xuICB9IGVsc2UgaWYgKHR5cGVvZiByZW1vdGFibGUgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIG9sZFByb3RvICE9PSBudWxsIHx8IHRocm93UmVkYWN0ZWRgT3JpZ2luYWwgZnVuY3Rpb24gbXVzdCBub3QgaW5oZXJpdCBmcm9tIG51bGw6ICR7cmVtb3RhYmxlfWA7XG4gICAgb2xkUHJvdG8gPT09IGZ1bmN0aW9uUHJvdG90eXBlMiB8fCBnZXRQcm90b3R5cGVPZjQob2xkUHJvdG8pID09PSBmdW5jdGlvblByb3RvdHlwZTIgfHwgdGhyb3dSZWRhY3RlZGBGYXIgZnVuY3Rpb25zIG11c3Qgb3JpZ2luYWxseSBpbmhlcml0IGZyb20gRnVuY3Rpb24ucHJvdG90eXBlLCBpbiAke3JlbW90YWJsZX1gO1xuICB9IGVsc2Uge1xuICAgIHRocm93UmVkYWN0ZWRgdW5yZWNvZ25pemVkIHR5cGVvZiAke3JlbW90YWJsZX1gO1xuICB9XG4gIHJldHVybiBoYXJkZW4oXG4gICAgY3JlYXRlKG9sZFByb3RvLCB7XG4gICAgICBbUEFTU19TVFlMRV06IHsgdmFsdWU6IFwicmVtb3RhYmxlXCIgfSxcbiAgICAgIFtTeW1ib2wudG9TdHJpbmdUYWddOiB7IHZhbHVlOiBpZmFjZSB9XG4gICAgfSlcbiAgKTtcbn07XG52YXIgYXNzZXJ0Q2FuQmVSZW1vdGFibGUgPSAoY2FuZGlkYXRlKSA9PiBSZW1vdGFibGVIZWxwZXIuY2FuQmVWYWxpZChjYW5kaWRhdGUsIGFzc2VydENoZWNrZXIpO1xudmFyIFJlbW90YWJsZSA9IChpZmFjZSA9IFwiUmVtb3RhYmxlXCIsIHByb3BzID0gdm9pZCAwLCByZW1vdGFibGUgPSAoXG4gIC8qICAgICAgICAgICAgKi9cbiAge31cbikpID0+IHtcbiAgYXNzZXJ0SWZhY2UoaWZhY2UpO1xuICBhc3NlcnQoaWZhY2UpO1xuICBwcm9wcyA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgUmVtb3RhYmxlIHByb3BzIG5vdCB5ZXQgaW1wbGVtZW50ZWQgJHtwcm9wc31gO1xuICBhc3NlcnRDYW5CZVJlbW90YWJsZShyZW1vdGFibGUpO1xuICAhKFBBU1NfU1RZTEUgaW4gcmVtb3RhYmxlKSB8fCB0aHJvd1JlZGFjdGVkYFJlbW90YWJsZSAke3JlbW90YWJsZX0gaXMgYWxyZWFkeSBtYXJrZWQgYXMgYSAke3F1b3RlKFxuICAgIHJlbW90YWJsZVtQQVNTX1NUWUxFXVxuICApfWA7XG4gIGhhcmRlbi5pc0Zha2UgfHwgLy9cbiAgIWlzRnJvemVuMyhyZW1vdGFibGUpIHx8IHRocm93UmVkYWN0ZWRgUmVtb3RhYmxlICR7cmVtb3RhYmxlfSBpcyBhbHJlYWR5IGZyb3plbmA7XG4gIGNvbnN0IHJlbW90YWJsZVByb3RvID0gbWFrZVJlbW90YWJsZVByb3RvKHJlbW90YWJsZSwgaWZhY2UpO1xuICBjb25zdCBtdXRhdGVIYXJkZW5BbmRDaGVjayA9ICh0YXJnZXQpID0+IHtcbiAgICBzZXRQcm90b3R5cGVPZih0YXJnZXQsIHJlbW90YWJsZVByb3RvKTtcbiAgICBoYXJkZW4odGFyZ2V0KTtcbiAgICBhc3NlcnRDYW5CZVJlbW90YWJsZSh0YXJnZXQpO1xuICB9O1xuICBtdXRhdGVIYXJkZW5BbmRDaGVjayh7fSk7XG4gIG11dGF0ZUhhcmRlbkFuZENoZWNrKHJlbW90YWJsZSk7XG4gIGFzc2VydChpZmFjZSAhPT0gdm9pZCAwKTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICByZW1vdGFibGVcbiAgKTtcbn07XG5oYXJkZW4oUmVtb3RhYmxlKTtcbnZhciBHRVRfTUVUSE9EX05BTUVTID0gXCJfX2dldE1ldGhvZE5hbWVzX19cIjtcbnZhciBnZXRNZXRob2ROYW1lc01ldGhvZCA9IGhhcmRlbih7XG4gIFtHRVRfTUVUSE9EX05BTUVTXSgpIHtcbiAgICByZXR1cm4gZ2V0TWV0aG9kTmFtZXModGhpcyk7XG4gIH1cbn0pW0dFVF9NRVRIT0RfTkFNRVNdO1xudmFyIGdldE1ldGhvZE5hbWVzRGVzY3JpcHRvciA9IGhhcmRlbih7XG4gIHZhbHVlOiBnZXRNZXRob2ROYW1lc01ldGhvZCxcbiAgZW51bWVyYWJsZTogZmFsc2UsXG4gIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gIHdyaXRhYmxlOiBmYWxzZVxufSk7XG52YXIgRmFyID0gKGZhck5hbWUsIHJlbW90YWJsZSA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCByNiA9IHJlbW90YWJsZSA9PT0gdm9pZCAwID8gKFxuICAgIC8qICAgICAgICAgICAgKi9cbiAgICB7fVxuICApIDogcmVtb3RhYmxlO1xuICBpZiAodHlwZW9mIHI2ID09PSBcIm9iamVjdFwiICYmICEoR0VUX01FVEhPRF9OQU1FUyBpbiByNikpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocjYsIEdFVF9NRVRIT0RfTkFNRVMsIGdldE1ldGhvZE5hbWVzRGVzY3JpcHRvcik7XG4gIH1cbiAgcmV0dXJuIFJlbW90YWJsZShgQWxsZWdlZDogJHtmYXJOYW1lfWAsIHZvaWQgMCwgcjYpO1xufTtcbmhhcmRlbihGYXIpO1xudmFyIFRvRmFyRnVuY3Rpb24gPSAoZmFyTmFtZSwgZnVuYykgPT4ge1xuICBpZiAoZ2V0SW50ZXJmYWNlT2YoZnVuYykgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiBmdW5jO1xuICB9XG4gIHJldHVybiBGYXIoZmFyTmFtZSwgKC4uLmFyZ3MpID0+IGZ1bmMoLi4uYXJncykpO1xufTtcbmhhcmRlbihUb0ZhckZ1bmN0aW9uKTtcblxuLy9cbnZhciBtYXBJdGVyYWJsZSA9IChiYXNlSXRlcmFibGUsIGZ1bmMpID0+IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgRmFyKFwibWFwcGVkIGl0ZXJhYmxlXCIsIHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgY29uc3QgYmFzZUl0ZXJhdG9yID0gYmFzZUl0ZXJhYmxlW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgIHJldHVybiBGYXIoXCJtYXBwZWQgaXRlcmF0b3JcIiwge1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyB2YWx1ZTogYmFzZVZhbHVlLCBkb25lIH0gPSBiYXNlSXRlcmF0b3IubmV4dCgpO1xuICAgICAgICAgIGNvbnN0IHZhbHVlID0gZG9uZSA/IGJhc2VWYWx1ZSA6IGZ1bmMoYmFzZVZhbHVlKTtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgdmFsdWUsIGRvbmUgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSlcbik7XG5oYXJkZW4obWFwSXRlcmFibGUpO1xudmFyIGZpbHRlckl0ZXJhYmxlID0gKGJhc2VJdGVyYWJsZSwgcHJlZCkgPT4gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICBGYXIoXCJmaWx0ZXJlZCBpdGVyYWJsZVwiLCB7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGNvbnN0IGJhc2VJdGVyYXRvciA9IGJhc2VJdGVyYWJsZVtTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICByZXR1cm4gRmFyKFwiZmlsdGVyZWQgaXRlcmF0b3JcIiwge1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgZm9yICg7IDsgKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBiYXNlSXRlcmF0b3IubmV4dCgpO1xuICAgICAgICAgICAgY29uc3QgeyB2YWx1ZSwgZG9uZSB9ID0gcmVzdWx0O1xuICAgICAgICAgICAgaWYgKGRvbmUgfHwgcHJlZCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSlcbik7XG5oYXJkZW4oZmlsdGVySXRlcmFibGUpO1xuXG4vL1xudmFyIHsgZ2V0UHJvdG90eXBlT2Y6IGdldFByb3RvdHlwZU9mNSwgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczMsIGhhc093bjogaGFzT3duNCwgZW50cmllczogZW50cmllczIgfSA9IE9iamVjdDtcbnZhciBlcnJvckNvbnN0cnVjdG9ycyA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKFxuICAvL1xuICAvL1xuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgW1xuICAgIFtcIkVycm9yXCIsIEVycm9yXSxcbiAgICBbXCJFdmFsRXJyb3JcIiwgRXZhbEVycm9yXSxcbiAgICBbXCJSYW5nZUVycm9yXCIsIFJhbmdlRXJyb3JdLFxuICAgIFtcIlJlZmVyZW5jZUVycm9yXCIsIFJlZmVyZW5jZUVycm9yXSxcbiAgICBbXCJTeW50YXhFcnJvclwiLCBTeW50YXhFcnJvcl0sXG4gICAgW1wiVHlwZUVycm9yXCIsIFR5cGVFcnJvcl0sXG4gICAgW1wiVVJJRXJyb3JcIiwgVVJJRXJyb3JdXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgXVxuKTtcbmlmICh0eXBlb2YgQWdncmVnYXRlRXJyb3IgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgZXJyb3JDb25zdHJ1Y3RvcnMuc2V0KFwiQWdncmVnYXRlRXJyb3JcIiwgQWdncmVnYXRlRXJyb3IpO1xufVxudmFyIGdldEVycm9yQ29uc3RydWN0b3IgPSAobmFtZSkgPT4gZXJyb3JDb25zdHJ1Y3RvcnMuZ2V0KG5hbWUpO1xuaGFyZGVuKGdldEVycm9yQ29uc3RydWN0b3IpO1xudmFyIGNoZWNrRXJyb3JMaWtlID0gKGNhbmRpZGF0ZSwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgcmV0dXJuIGNhbmRpZGF0ZSBpbnN0YW5jZW9mIEVycm9yIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYEVycm9yIGV4cGVjdGVkOiAke2NhbmRpZGF0ZX1gO1xufTtcbmhhcmRlbihjaGVja0Vycm9yTGlrZSk7XG52YXIgaXNFcnJvckxpa2UgPSAoY2FuZGlkYXRlKSA9PiBjaGVja0Vycm9yTGlrZShjYW5kaWRhdGUpO1xuaGFyZGVuKGlzRXJyb3JMaWtlKTtcbnZhciBjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvclByb3BlcnR5RGVzYyA9IChwcm9wTmFtZSwgZGVzYywgcGFzc1N0eWxlT2ZSZWN1ciwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgaWYgKGRlc2MuZW51bWVyYWJsZSkge1xuICAgIHJldHVybiAhIWNoZWNrICYmIENYKGNoZWNrKWBQYXNzYWJsZSBFcnJvciAke3F1b3RlKFxuICAgICAgcHJvcE5hbWVcbiAgICApfSBvd24gcHJvcGVydHkgbXVzdCBub3QgYmUgZW51bWVyYWJsZTogJHtkZXNjfWA7XG4gIH1cbiAgaWYgKCFoYXNPd240KGRlc2MsIFwidmFsdWVcIikpIHtcbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChjaGVjaylgUGFzc2FibGUgRXJyb3IgJHtxdW90ZShcbiAgICAgIHByb3BOYW1lXG4gICAgKX0gb3duIHByb3BlcnR5IG11c3QgYmUgYSBkYXRhIHByb3BlcnR5OiAke2Rlc2N9YDtcbiAgfVxuICBjb25zdCB7IHZhbHVlIH0gPSBkZXNjO1xuICBzd2l0Y2ggKHByb3BOYW1lKSB7XG4gICAgY2FzZSBcIm1lc3NhZ2VcIjpcbiAgICBjYXNlIFwic3RhY2tcIjoge1xuICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBQYXNzYWJsZSBFcnJvciAke3F1b3RlKFxuICAgICAgICBwcm9wTmFtZVxuICAgICAgKX0gb3duIHByb3BlcnR5IG11c3QgYmUgYSBzdHJpbmc6ICR7dmFsdWV9YDtcbiAgICB9XG4gICAgY2FzZSBcImNhdXNlXCI6IHtcbiAgICAgIHJldHVybiBjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvcih2YWx1ZSwgcGFzc1N0eWxlT2ZSZWN1ciwgY2hlY2spO1xuICAgIH1cbiAgICBjYXNlIFwiZXJyb3JzXCI6IHtcbiAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkgfHwgcGFzc1N0eWxlT2ZSZWN1cih2YWx1ZSkgIT09IFwiY29weUFycmF5XCIpIHtcbiAgICAgICAgcmV0dXJuICEhY2hlY2sgJiYgQ1goY2hlY2spYFBhc3NhYmxlIEVycm9yICR7cXVvdGUoXG4gICAgICAgICAgcHJvcE5hbWVcbiAgICAgICAgKX0gb3duIHByb3BlcnR5IG11c3QgYmUgYSBjb3B5QXJyYXk6ICR7dmFsdWV9YDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWx1ZS5ldmVyeShcbiAgICAgICAgKGVycikgPT4gKFxuICAgICAgICAgIC8vXG4gICAgICAgICAgY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3IoZXJyLCBwYXNzU3R5bGVPZlJlY3VyLCBjaGVjaylcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIHJldHVybiAhIWNoZWNrICYmIENYKGNoZWNrKWBQYXNzYWJsZSBFcnJvciBoYXMgZXh0cmEgdW5wYXNzZWQgcHJvcGVydHkgJHtxdW90ZShwcm9wTmFtZSl9YDtcbn07XG5oYXJkZW4oY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MpO1xudmFyIGNoZWNrUmVjdXJzaXZlbHlQYXNzYWJsZUVycm9yID0gKGNhbmRpZGF0ZSwgcGFzc1N0eWxlT2ZSZWN1ciwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgaWYgKCFjaGVja0Vycm9yTGlrZShjYW5kaWRhdGUsIGNoZWNrKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCBwcm90byA9IGdldFByb3RvdHlwZU9mNShjYW5kaWRhdGUpO1xuICBjb25zdCB7IG5hbWUgfSA9IHByb3RvO1xuICBjb25zdCBlcnJDb25zdHJ1Y3RvciA9IGdldEVycm9yQ29uc3RydWN0b3IobmFtZSk7XG4gIGlmIChlcnJDb25zdHJ1Y3RvciA9PT0gdm9pZCAwIHx8IGVyckNvbnN0cnVjdG9yLnByb3RvdHlwZSAhPT0gcHJvdG8pIHtcbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChcbiAgICAgIGNoZWNrXG4gICAgKWBQYXNzYWJsZSBFcnJvciBtdXN0IGluaGVyaXQgZnJvbSBhbiBlcnJvciBjbGFzcyAucHJvdG90eXBlOiAke2NhbmRpZGF0ZX1gO1xuICB9XG4gIGNvbnN0IGRlc2NzID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczMoY2FuZGlkYXRlKTtcbiAgaWYgKCEoXCJtZXNzYWdlXCIgaW4gZGVzY3MpKSB7XG4gICAgcmV0dXJuICEhY2hlY2sgJiYgQ1goXG4gICAgICBjaGVja1xuICAgIClgUGFzc2FibGUgRXJyb3IgbXVzdCBoYXZlIGFuIG93biBcIm1lc3NhZ2VcIiBzdHJpbmcgcHJvcGVydHk6ICR7Y2FuZGlkYXRlfWA7XG4gIH1cbiAgcmV0dXJuIGVudHJpZXMyKGRlc2NzKS5ldmVyeShcbiAgICAoW3Byb3BOYW1lLCBkZXNjXSkgPT4gY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MoXG4gICAgICBwcm9wTmFtZSxcbiAgICAgIGRlc2MsXG4gICAgICBwYXNzU3R5bGVPZlJlY3VyLFxuICAgICAgY2hlY2tcbiAgICApXG4gICk7XG59O1xuaGFyZGVuKGNoZWNrUmVjdXJzaXZlbHlQYXNzYWJsZUVycm9yKTtcbnZhciBFcnJvckhlbHBlciA9IGhhcmRlbih7XG4gIHN0eWxlTmFtZTogXCJlcnJvclwiLFxuICBjYW5CZVZhbGlkOiBjaGVja0Vycm9yTGlrZSxcbiAgYXNzZXJ0UmVzdFZhbGlkOiAoY2FuZGlkYXRlLCBwYXNzU3R5bGVPZlJlY3VyKSA9PiBjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvcihjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIsIGFzc2VydENoZWNrZXIpXG59KTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXMzIH0gPSBSZWZsZWN0O1xudmFyIHdlbGxLbm93blN5bWJvbE5hbWVzID0gbmV3IE1hcChcbiAgb3duS2V5czMoU3ltYm9sKS5maWx0ZXIoXG4gICAgKG5hbWUpID0+IHR5cGVvZiBuYW1lID09PSBcInN0cmluZ1wiICYmIHR5cGVvZiBTeW1ib2xbbmFtZV0gPT09IFwic3ltYm9sXCJcbiAgKS5maWx0ZXIoKG5hbWUpID0+IHtcbiAgICAhbmFtZS5zdGFydHNXaXRoKFwiQEBcIikgfHwgdGhyb3dSZWRhY3RlZGBEaWQgbm90IGV4cGVjdCBTeW1ib2wgdG8gaGF2ZSBhIHN5bWJvbC12YWx1ZWQgcHJvcGVydHkgbmFtZSBzdGFydGluZyB3aXRoIFwiQEBcIiAke3F1b3RlKFxuICAgICAgbmFtZVxuICAgICl9YDtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSkubWFwKChuYW1lKSA9PiBbU3ltYm9sW25hbWVdLCBgQEAke25hbWV9YF0pXG4pO1xudmFyIGlzUGFzc2FibGVTeW1ib2wgPSAoc3ltKSA9PiB0eXBlb2Ygc3ltID09PSBcInN5bWJvbFwiICYmICh0eXBlb2YgU3ltYm9sLmtleUZvcihzeW0pID09PSBcInN0cmluZ1wiIHx8IHdlbGxLbm93blN5bWJvbE5hbWVzLmhhcyhzeW0pKTtcbmhhcmRlbihpc1Bhc3NhYmxlU3ltYm9sKTtcbnZhciBhc3NlcnRQYXNzYWJsZVN5bWJvbCA9IChzeW0pID0+IGlzUGFzc2FibGVTeW1ib2woc3ltKSB8fCB0aHJvd1JlZGFjdGVkYE9ubHkgcmVnaXN0ZXJlZCBzeW1ib2xzIG9yIHdlbGwta25vd24gc3ltYm9scyBhcmUgcGFzc2FibGU6ICR7cXVvdGUoc3ltKX1gO1xuaGFyZGVuKGFzc2VydFBhc3NhYmxlU3ltYm9sKTtcbnZhciBuYW1lRm9yUGFzc2FibGVTeW1ib2wgPSAoc3ltKSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBTeW1ib2wua2V5Rm9yKHN5bSk7XG4gIGlmIChuYW1lID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gd2VsbEtub3duU3ltYm9sTmFtZXMuZ2V0KHN5bSk7XG4gIH1cbiAgaWYgKG5hbWUuc3RhcnRzV2l0aChcIkBAXCIpKSB7XG4gICAgcmV0dXJuIGBAQCR7bmFtZX1gO1xuICB9XG4gIHJldHVybiBuYW1lO1xufTtcbmhhcmRlbihuYW1lRm9yUGFzc2FibGVTeW1ib2wpO1xudmFyIEF0QXRQcmVmaXhQYXR0ZXJuID0gL15AQCguKikkLztcbmhhcmRlbihBdEF0UHJlZml4UGF0dGVybik7XG52YXIgcGFzc2FibGVTeW1ib2xGb3JOYW1lID0gKG5hbWUpID0+IHtcbiAgdHlwZW9mIG5hbWUgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKG5hbWUpfSBtdXN0IGJlIGEgc3RyaW5nLCBub3QgJHtxdW90ZSh0eXBlb2YgbmFtZSl9YDtcbiAgY29uc3QgbWF0Y2ggPSBBdEF0UHJlZml4UGF0dGVybi5leGVjKG5hbWUpO1xuICBpZiAobWF0Y2gpIHtcbiAgICBjb25zdCBzdWZmaXggPSBtYXRjaFsxXTtcbiAgICBpZiAoc3VmZml4LnN0YXJ0c1dpdGgoXCJAQFwiKSkge1xuICAgICAgcmV0dXJuIFN5bWJvbC5mb3Ioc3VmZml4KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgc3ltID0gU3ltYm9sW3N1ZmZpeF07XG4gICAgICBpZiAodHlwZW9mIHN5bSA9PT0gXCJzeW1ib2xcIikge1xuICAgICAgICByZXR1cm4gc3ltO1xuICAgICAgfVxuICAgICAgdGhyb3dSZWRhY3RlZGBSZXNlcnZlZCBmb3Igd2VsbCBrbm93biBzeW1ib2wgJHtxdW90ZShzdWZmaXgpfTogJHtxdW90ZShuYW1lKX1gO1xuICAgIH1cbiAgfVxuICByZXR1cm4gU3ltYm9sLmZvcihuYW1lKTtcbn07XG5oYXJkZW4ocGFzc2FibGVTeW1ib2xGb3JOYW1lKTtcblxuLy9cbnZhciBoYXNXZWxsRm9ybWVkU3RyaW5nTWV0aG9kID0gISFTdHJpbmcucHJvdG90eXBlLmlzV2VsbEZvcm1lZDtcbnZhciBpc1dlbGxGb3JtZWRTdHJpbmcgPSBoYXNXZWxsRm9ybWVkU3RyaW5nTWV0aG9kID8gKHN0cikgPT4gdHlwZW9mIHN0ciA9PT0gXCJzdHJpbmdcIiAmJiBzdHIuaXNXZWxsRm9ybWVkKCkgOiAoc3RyKSA9PiB7XG4gIGlmICh0eXBlb2Ygc3RyICE9PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZvciAoY29uc3QgY2ggb2Ygc3RyKSB7XG4gICAgY29uc3QgY3AgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGNoLmNvZGVQb2ludEF0KDApXG4gICAgKTtcbiAgICBpZiAoY3AgPj0gNTUyOTYgJiYgY3AgPD0gNTczNDMpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xuaGFyZGVuKGlzV2VsbEZvcm1lZFN0cmluZyk7XG52YXIgYXNzZXJ0V2VsbEZvcm1lZFN0cmluZyA9IChzdHIpID0+IHtcbiAgaXNXZWxsRm9ybWVkU3RyaW5nKHN0cikgfHwgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCB3ZWxsLWZvcm1lZCB1bmljb2RlIHN0cmluZzogJHtzdHJ9YDtcbn07XG5oYXJkZW4oYXNzZXJ0V2VsbEZvcm1lZFN0cmluZyk7XG52YXIgT05MWV9XRUxMX0ZPUk1FRF9TVFJJTkdTX1BBU1NBQkxFID0gZ2V0RW52aXJvbm1lbnRPcHRpb24oXCJPTkxZX1dFTExfRk9STUVEX1NUUklOR1NfUEFTU0FCTEVcIiwgXCJkaXNhYmxlZFwiLCBbXG4gIFwiZW5hYmxlZFwiXG5dKSA9PT0gXCJlbmFibGVkXCI7XG52YXIgYXNzZXJ0UGFzc2FibGVTdHJpbmcgPSAoc3RyKSA9PiB7XG4gIHR5cGVvZiBzdHIgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCBzdHJpbmcgJHtzdHJ9YDtcbiAgIU9OTFlfV0VMTF9GT1JNRURfU1RSSU5HU19QQVNTQUJMRSB8fCBhc3NlcnRXZWxsRm9ybWVkU3RyaW5nKHN0cik7XG59O1xuaGFyZGVuKGFzc2VydFBhc3NhYmxlU3RyaW5nKTtcblxuLy9cbnZhciBtYWtlUmVsZWFzaW5nRXhlY3V0b3JLaXQgPSAoKSA9PiB7XG4gIGxldCBpbnRlcm5hbFJlc29sdmU7XG4gIGxldCBpbnRlcm5hbFJlamVjdDtcbiAgY29uc3QgcmVzb2x2ZTIgPSAodmFsdWUpID0+IHtcbiAgICBpZiAoaW50ZXJuYWxSZXNvbHZlKSB7XG4gICAgICBpbnRlcm5hbFJlc29sdmUodmFsdWUpO1xuICAgICAgaW50ZXJuYWxSZXNvbHZlID0gbnVsbDtcbiAgICAgIGludGVybmFsUmVqZWN0ID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgYXNzZXJ0KGludGVybmFsUmVzb2x2ZSA9PT0gbnVsbCk7XG4gICAgfVxuICB9O1xuICBjb25zdCByZWplY3QgPSAocmVhc29uKSA9PiB7XG4gICAgaWYgKGludGVybmFsUmVqZWN0KSB7XG4gICAgICBpbnRlcm5hbFJlamVjdChyZWFzb24pO1xuICAgICAgaW50ZXJuYWxSZXNvbHZlID0gbnVsbDtcbiAgICAgIGludGVybmFsUmVqZWN0ID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgYXNzZXJ0KGludGVybmFsUmVqZWN0ID09PSBudWxsKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGV4ZWN1dG9yID0gKHJlcywgcmVqKSA9PiB7XG4gICAgYXNzZXJ0KGludGVybmFsUmVzb2x2ZSA9PT0gdm9pZCAwICYmIGludGVybmFsUmVqZWN0ID09PSB2b2lkIDApO1xuICAgIGludGVybmFsUmVzb2x2ZSA9IHJlcztcbiAgICBpbnRlcm5hbFJlamVjdCA9IHJlajtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IHJlc29sdmU6IHJlc29sdmUyLCByZWplY3QsIGV4ZWN1dG9yIH0pO1xufTtcbmhhcmRlbihtYWtlUmVsZWFzaW5nRXhlY3V0b3JLaXQpO1xuXG4vL1xudmFyIGlzUHJpbWl0aXZlMyA9ICh2YWwpID0+ICF2YWwgfHwgdHlwZW9mIHZhbCAhPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgdmFsICE9PSBcImZ1bmN0aW9uXCI7XG52YXIga25vd25Qcm9taXNlcyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xudmFyIG1hcmtTZXR0bGVkID0gKHJlY29yZCkgPT4ge1xuICBpZiAoIXJlY29yZCB8fCByZWNvcmQuc2V0dGxlZCkge1xuICAgIHJldHVybiAvKiAgICAgICAgICAgKi8gbmV3IFNldCgpO1xuICB9XG4gIGNvbnN0IHsgZGVmZXJyZWRzIH0gPSByZWNvcmQ7XG4gIE9iamVjdC5hc3NpZ24ocmVjb3JkLCB7XG4gICAgZGVmZXJyZWRzOiB2b2lkIDAsXG4gICAgc2V0dGxlZDogdHJ1ZVxuICB9KTtcbiAgT2JqZWN0LmZyZWV6ZShyZWNvcmQpO1xuICByZXR1cm4gZGVmZXJyZWRzO1xufTtcbnZhciBnZXRNZW1vUmVjb3JkID0gKHZhbHVlKSA9PiB7XG4gIGlmIChpc1ByaW1pdGl2ZTModmFsdWUpKSB7XG4gICAgcmV0dXJuIGhhcmRlbih7IHNldHRsZWQ6IHRydWUgfSk7XG4gIH1cbiAgbGV0IHJlY29yZCA9IGtub3duUHJvbWlzZXMuZ2V0KHZhbHVlKTtcbiAgaWYgKCFyZWNvcmQpIHtcbiAgICByZWNvcmQgPSB7IGRlZmVycmVkczogLyogICAgICAgICAgICovIG5ldyBTZXQoKSwgc2V0dGxlZDogZmFsc2UgfTtcbiAgICBrbm93blByb21pc2VzLnNldCh2YWx1ZSwgcmVjb3JkKTtcbiAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oXG4gICAgICAodmFsKSA9PiB7XG4gICAgICAgIGZvciAoY29uc3QgeyByZXNvbHZlOiByZXNvbHZlMiB9IG9mIG1hcmtTZXR0bGVkKHJlY29yZCkpIHtcbiAgICAgICAgICByZXNvbHZlMih2YWwpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgKGVycikgPT4ge1xuICAgICAgICBmb3IgKGNvbnN0IHsgcmVqZWN0IH0gb2YgbWFya1NldHRsZWQocmVjb3JkKSkge1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgfVxuICByZXR1cm4gcmVjb3JkO1xufTtcbnZhciB7IHJhY2UgfSA9IHtcbiAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAqL1xuICByYWNlKHZhbHVlczgpIHtcbiAgICBsZXQgZGVmZXJyZWQ7XG4gICAgY29uc3QgY2FjaGVkVmFsdWVzID0gW107XG4gICAgY29uc3QgQyA9IHRoaXM7XG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IEMoKHJlc29sdmUyLCByZWplY3QpID0+IHtcbiAgICAgIGRlZmVycmVkID0geyByZXNvbHZlOiByZXNvbHZlMiwgcmVqZWN0IH07XG4gICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHZhbHVlczgpIHtcbiAgICAgICAgY2FjaGVkVmFsdWVzLnB1c2godmFsdWUpO1xuICAgICAgICBjb25zdCB7IHNldHRsZWQsIGRlZmVycmVkcyB9ID0gZ2V0TWVtb1JlY29yZCh2YWx1ZSk7XG4gICAgICAgIGlmIChzZXR0bGVkKSB7XG4gICAgICAgICAgQy5yZXNvbHZlKHZhbHVlKS50aGVuKHJlc29sdmUyLCByZWplY3QpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRlZmVycmVkcy5hZGQoZGVmZXJyZWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdC5maW5hbGx5KCgpID0+IHtcbiAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgY2FjaGVkVmFsdWVzKSB7XG4gICAgICAgIGNvbnN0IHsgZGVmZXJyZWRzIH0gPSBnZXRNZW1vUmVjb3JkKHZhbHVlKTtcbiAgICAgICAgaWYgKGRlZmVycmVkcykge1xuICAgICAgICAgIGRlZmVycmVkcy5kZWxldGUoZGVmZXJyZWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn07XG5cbi8vXG5mdW5jdGlvbiBpc1Byb21pc2UobWF5YmVQcm9taXNlKSB7XG4gIHJldHVybiBQcm9taXNlLnJlc29sdmUobWF5YmVQcm9taXNlKSA9PT0gbWF5YmVQcm9taXNlO1xufVxuaGFyZGVuKGlzUHJvbWlzZSk7XG5cbi8vXG52YXIgQmVzdFBpcGVsaW5hYmxlUHJvbWlzZSA9IGdsb2JhbFRoaXMuSGFuZGxlZFByb21pc2UgfHwgUHJvbWlzZTtcbmZ1bmN0aW9uIG1ha2VQcm9taXNlS2l0KCkge1xuICBjb25zdCB7IHJlc29sdmU6IHJlc29sdmUyLCByZWplY3QsIGV4ZWN1dG9yIH0gPSBtYWtlUmVsZWFzaW5nRXhlY3V0b3JLaXQoKTtcbiAgY29uc3QgcHJvbWlzZSA9IG5ldyBCZXN0UGlwZWxpbmFibGVQcm9taXNlKGV4ZWN1dG9yKTtcbiAgcmV0dXJuIGhhcmRlbih7IHByb21pc2UsIHJlc29sdmU6IHJlc29sdmUyLCByZWplY3QgfSk7XG59XG5oYXJkZW4obWFrZVByb21pc2VLaXQpO1xuZnVuY3Rpb24gcmFjZVByb21pc2VzKHZhbHVlczgpIHtcbiAgcmV0dXJuIGhhcmRlbihyYWNlLmNhbGwoQmVzdFBpcGVsaW5hYmxlUHJvbWlzZSwgdmFsdWVzOCkpO1xufVxuaGFyZGVuKHJhY2VQcm9taXNlcyk7XG5cbi8vXG52YXIgeyBnZXRQcm90b3R5cGVPZjogZ2V0UHJvdG90eXBlT2Y2IH0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzNCB9ID0gUmVmbGVjdDtcbnZhciB7IGlzQXJyYXk6IGlzQXJyYXkzLCBwcm90b3R5cGU6IGFycmF5UHJvdG90eXBlIH0gPSBBcnJheTtcbnZhciBDb3B5QXJyYXlIZWxwZXIgPSBoYXJkZW4oe1xuICBzdHlsZU5hbWU6IFwiY29weUFycmF5XCIsXG4gIGNhbkJlVmFsaWQ6IChjYW5kaWRhdGUsIGNoZWNrID0gdm9pZCAwKSA9PiBpc0FycmF5MyhjYW5kaWRhdGUpIHx8ICEhY2hlY2sgJiYgY2hlY2soZmFsc2UsIHJlZGFjdGVkYEFycmF5IGV4cGVjdGVkOiAke2NhbmRpZGF0ZX1gKSxcbiAgYXNzZXJ0UmVzdFZhbGlkOiAoY2FuZGlkYXRlLCBwYXNzU3R5bGVPZlJlY3VyKSA9PiB7XG4gICAgZ2V0UHJvdG90eXBlT2Y2KGNhbmRpZGF0ZSkgPT09IGFycmF5UHJvdG90eXBlIHx8IGFzc2VydC5mYWlsKHJlZGFjdGVkYE1hbGZvcm1lZCBhcnJheTogJHtjYW5kaWRhdGV9YCwgVHlwZUVycm9yKTtcbiAgICBjb25zdCBsZW4gPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGdldE93bkRhdGFEZXNjcmlwdG9yKGNhbmRpZGF0ZSwgXCJsZW5ndGhcIiwgZmFsc2UsIGFzc2VydENoZWNrZXIpLnZhbHVlXG4gICAgKTtcbiAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgbGVuOyBpMiArPSAxKSB7XG4gICAgICBwYXNzU3R5bGVPZlJlY3VyKFxuICAgICAgICBnZXRPd25EYXRhRGVzY3JpcHRvcihjYW5kaWRhdGUsIGkyLCB0cnVlLCBhc3NlcnRDaGVja2VyKS52YWx1ZVxuICAgICAgKTtcbiAgICB9XG4gICAgb3duS2V5czQoY2FuZGlkYXRlKS5sZW5ndGggPT09IGxlbiArIDEgfHwgYXNzZXJ0LmZhaWwocmVkYWN0ZWRgQXJyYXlzIG11c3Qgbm90IGhhdmUgbm9uLWluZGV4ZXM6ICR7Y2FuZGlkYXRlfWAsIFR5cGVFcnJvcik7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHsgZ2V0UHJvdG90eXBlT2Y6IGdldFByb3RvdHlwZU9mNywgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IyIH0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzNSwgYXBwbHk6IGFwcGx5NCB9ID0gUmVmbGVjdDtcbnZhciBhZGFwdEltbXV0YWJsZUFycmF5QnVmZmVyID0gKCkgPT4ge1xuICBjb25zdCBhbkFycmF5QnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKDApO1xuICBpZiAoYW5BcnJheUJ1ZmZlci5zbGljZVRvSW1tdXRhYmxlID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4ge1xuICAgICAgaW1tdXRhYmxlQXJyYXlCdWZmZXJQcm90b3R5cGU6IG51bGwsXG4gICAgICBpbW11dGFibGVHZXR0ZXI6ICgpID0+IGZhbHNlXG4gICAgfTtcbiAgfVxuICBjb25zdCBhbkltbXV0YWJsZUFycmF5QnVmZmVyID0gYW5BcnJheUJ1ZmZlci5zbGljZVRvSW1tdXRhYmxlKCk7XG4gIGNvbnN0IGltbXV0YWJsZUFycmF5QnVmZmVyUHJvdG90eXBlMiA9IGdldFByb3RvdHlwZU9mNyhhbkltbXV0YWJsZUFycmF5QnVmZmVyKTtcbiAgY29uc3QgaW1tdXRhYmxlR2V0dGVyMiA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAvL1xuICAgIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjIoaW1tdXRhYmxlQXJyYXlCdWZmZXJQcm90b3R5cGUyLCBcImltbXV0YWJsZVwiKS5nZXRcbiAgKTtcbiAgcmV0dXJuIHsgaW1tdXRhYmxlQXJyYXlCdWZmZXJQcm90b3R5cGU6IGltbXV0YWJsZUFycmF5QnVmZmVyUHJvdG90eXBlMiwgaW1tdXRhYmxlR2V0dGVyOiBpbW11dGFibGVHZXR0ZXIyIH07XG59O1xudmFyIHsgaW1tdXRhYmxlQXJyYXlCdWZmZXJQcm90b3R5cGUsIGltbXV0YWJsZUdldHRlciB9ID0gYWRhcHRJbW11dGFibGVBcnJheUJ1ZmZlcigpO1xudmFyIEJ5dGVBcnJheUhlbHBlciA9IGhhcmRlbih7XG4gIHN0eWxlTmFtZTogXCJieXRlQXJyYXlcIixcbiAgY2FuQmVWYWxpZDogKGNhbmRpZGF0ZSwgY2hlY2sgPSB2b2lkIDApID0+IGNhbmRpZGF0ZSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyICYmIC8vXG4gIGNhbmRpZGF0ZS5pbW11dGFibGUgfHwgISFjaGVjayAmJiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgSW1tdXRhYmxlIEFycmF5QnVmZmVyIGV4cGVjdGVkOiAke2NhbmRpZGF0ZX1gKSxcbiAgYXNzZXJ0UmVzdFZhbGlkOiAoY2FuZGlkYXRlLCBfcGFzc1N0eWxlT2ZSZWN1cikgPT4ge1xuICAgIGdldFByb3RvdHlwZU9mNyhjYW5kaWRhdGUpID09PSBpbW11dGFibGVBcnJheUJ1ZmZlclByb3RvdHlwZSB8fCBhc3NlcnQuZmFpbChyZWRhY3RlZGBNYWxmb3JtZWQgQnl0ZUFycmF5ICR7Y2FuZGlkYXRlfWAsIFR5cGVFcnJvcik7XG4gICAgYXBwbHk0KGltbXV0YWJsZUdldHRlciwgY2FuZGlkYXRlLCBbXSkgfHwgdGhyb3dSZWRhY3RlZGBNdXN0IGJlIGFuIGltbXV0YWJsZSBBcnJheUJ1ZmZlcjogJHtjYW5kaWRhdGV9YDtcbiAgICBvd25LZXlzNShjYW5kaWRhdGUpLmxlbmd0aCA9PT0gMCB8fCBhc3NlcnQuZmFpbChcbiAgICAgIHJlZGFjdGVkYEJ5dGVBcnJheXMgbXVzdCBub3QgaGF2ZSBvd24gcHJvcGVydGllczogJHtjYW5kaWRhdGV9YCxcbiAgICAgIFR5cGVFcnJvclxuICAgICk7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czYgfSA9IFJlZmxlY3Q7XG52YXIgeyBnZXRQcm90b3R5cGVPZjogZ2V0UHJvdG90eXBlT2Y4LCBwcm90b3R5cGU6IG9iamVjdFByb3RvdHlwZTQgfSA9IE9iamVjdDtcbnZhciBjaGVja09iamVjdFByb3RvdHlwZSA9IChjYW5kaWRhdGUsIGNoZWNrID0gdm9pZCAwKSA9PiB7XG4gIHJldHVybiBnZXRQcm90b3R5cGVPZjgoY2FuZGlkYXRlKSA9PT0gb2JqZWN0UHJvdG90eXBlNCB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBSZWNvcmRzIG11c3QgaW5oZXJpdCBmcm9tIE9iamVjdC5wcm90b3R5cGU6ICR7Y2FuZGlkYXRlfWA7XG59O1xudmFyIGNoZWNrUHJvcGVydHlDYW5CZVZhbGlkID0gKGNhbmRpZGF0ZSwga2V5LCB2YWx1ZSwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgcmV0dXJuICh0eXBlb2Yga2V5ID09PSBcInN0cmluZ1wiIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgY2hlY2tcbiAgKWBSZWNvcmRzIGNhbiBvbmx5IGhhdmUgc3RyaW5nLW5hbWVkIHByb3BlcnRpZXM6ICR7Y2FuZGlkYXRlfWApICYmICghY2FuQmVNZXRob2QodmFsdWUpIHx8ICEhY2hlY2sgJiYgLy9cbiAgQ1goXG4gICAgY2hlY2tcbiAgKWBSZWNvcmRzIGNhbm5vdCBjb250YWluIG5vbi1mYXIgZnVuY3Rpb25zIGJlY2F1c2UgdGhleSBtYXkgYmUgbWV0aG9kcyBvZiBhbiBpbXBsaWNpdCBSZW1vdGFibGU6ICR7Y2FuZGlkYXRlfWApO1xufTtcbnZhciBDb3B5UmVjb3JkSGVscGVyID0gaGFyZGVuKHtcbiAgc3R5bGVOYW1lOiBcImNvcHlSZWNvcmRcIixcbiAgY2FuQmVWYWxpZDogKGNhbmRpZGF0ZSwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgICByZXR1cm4gY2hlY2tPYmplY3RQcm90b3R5cGUoY2FuZGlkYXRlLCBjaGVjaykgJiYgLy9cbiAgICAvL1xuICAgIG93bktleXM2KGNhbmRpZGF0ZSkuZXZlcnkoXG4gICAgICAoa2V5KSA9PiBjaGVja1Byb3BlcnR5Q2FuQmVWYWxpZChjYW5kaWRhdGUsIGtleSwgY2FuZGlkYXRlW2tleV0sIGNoZWNrKVxuICAgICk7XG4gIH0sXG4gIGFzc2VydFJlc3RWYWxpZDogKGNhbmRpZGF0ZSwgcGFzc1N0eWxlT2ZSZWN1cikgPT4ge1xuICAgIGZvciAoY29uc3QgbmFtZSBvZiBvd25LZXlzNihjYW5kaWRhdGUpKSB7XG4gICAgICBjb25zdCB7IHZhbHVlIH0gPSBnZXRPd25EYXRhRGVzY3JpcHRvcihcbiAgICAgICAgY2FuZGlkYXRlLFxuICAgICAgICBuYW1lLFxuICAgICAgICB0cnVlLFxuICAgICAgICBhc3NlcnRDaGVja2VyXG4gICAgICApO1xuICAgICAgcGFzc1N0eWxlT2ZSZWN1cih2YWx1ZSk7XG4gICAgfVxuICB9XG59KTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXM3IH0gPSBSZWZsZWN0O1xudmFyIHsgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczQgfSA9IE9iamVjdDtcbnZhciBUYWdnZWRIZWxwZXIgPSBoYXJkZW4oe1xuICBzdHlsZU5hbWU6IFwidGFnZ2VkXCIsXG4gIGNhbkJlVmFsaWQ6IChjYW5kaWRhdGUsIGNoZWNrID0gdm9pZCAwKSA9PiBjaGVja1Bhc3NTdHlsZShjYW5kaWRhdGUsIGNhbmRpZGF0ZVtQQVNTX1NUWUxFXSwgXCJ0YWdnZWRcIiwgY2hlY2spLFxuICBhc3NlcnRSZXN0VmFsaWQ6IChjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIpID0+IHtcbiAgICBjaGVja1RhZ1JlY29yZChjYW5kaWRhdGUsIFwidGFnZ2VkXCIsIGFzc2VydENoZWNrZXIpO1xuICAgIGNvbnN0IHBhc3NTdHlsZUtleSA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIFBBU1NfU1RZTEVcbiAgICApO1xuICAgIGNvbnN0IHRhZ0tleSA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIFN5bWJvbC50b1N0cmluZ1RhZ1xuICAgICk7XG4gICAgY29uc3Qge1xuICAgICAgLy9cbiAgICAgIFtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgIHBhc3NTdHlsZUtleVxuICAgICAgXTogX3Bhc3NTdHlsZURlc2MsXG4gICAgICBbXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB0YWdLZXlcbiAgICAgIF06IF9sYWJlbERlc2MsXG4gICAgICBwYXlsb2FkOiBfcGF5bG9hZERlc2MsXG4gICAgICAvL1xuICAgICAgLi4ucmVzdERlc2NzXG4gICAgfSA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM0KGNhbmRpZGF0ZSk7XG4gICAgb3duS2V5czcocmVzdERlc2NzKS5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBVbmV4cGVjdGVkIHByb3BlcnRpZXMgb24gdGFnZ2VkIHJlY29yZCAke293bktleXM3KHJlc3REZXNjcyl9YDtcbiAgICBwYXNzU3R5bGVPZlJlY3VyKFxuICAgICAgZ2V0T3duRGF0YURlc2NyaXB0b3IoY2FuZGlkYXRlLCBcInBheWxvYWRcIiwgdHJ1ZSwgYXNzZXJ0Q2hlY2tlcikudmFsdWVcbiAgICApO1xuICB9XG59KTtcblxuLy9cbnZhciB7IGlzRnJvemVuOiBpc0Zyb3plbjQsIGdldFByb3RvdHlwZU9mOiBnZXRQcm90b3R5cGVPZjksIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yMywgaGFzT3duOiBoYXNPd241IH0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzOCB9ID0gUmVmbGVjdDtcbnZhciB7IHRvU3RyaW5nVGFnIH0gPSBTeW1ib2w7XG52YXIgY2hlY2tQcm9taXNlT3duS2V5cyA9IChwciwgY2hlY2spID0+IHtcbiAgY29uc3Qga2V5czUgPSBvd25LZXlzOChwcik7XG4gIGlmIChrZXlzNS5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCB1bmtub3duS2V5cyA9IGtleXM1LmZpbHRlcihcbiAgICAoa2V5KSA9PiB0eXBlb2Yga2V5ICE9PSBcInN5bWJvbFwiIHx8ICFoYXNPd241KFByb21pc2UucHJvdG90eXBlLCBrZXkpXG4gICk7XG4gIGlmICh1bmtub3duS2V5cy5sZW5ndGggIT09IDApIHtcbiAgICByZXR1cm4gQ1goXG4gICAgICBjaGVja1xuICAgIClgJHtwcn0gLSBNdXN0IG5vdCBoYXZlIGFueSBvd24gcHJvcGVydGllczogJHtxdW90ZSh1bmtub3duS2V5cyl9YDtcbiAgfVxuICBjb25zdCBjaGVja1NhZmVPd25LZXkgPSAoa2V5KSA9PiB7XG4gICAgaWYgKGtleSA9PT0gdG9TdHJpbmdUYWcpIHtcbiAgICAgIGNvbnN0IHRhZ0Rlc2MgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IzKHByLCB0b1N0cmluZ1RhZyk7XG4gICAgICBhc3NlcnQodGFnRGVzYyAhPT0gdm9pZCAwKTtcbiAgICAgIHJldHVybiAoaGFzT3duNSh0YWdEZXNjLCBcInZhbHVlXCIpIHx8IENYKFxuICAgICAgICBjaGVja1xuICAgICAgKWBPd24gQEB0b1N0cmluZ1RhZyBtdXN0IGJlIGEgZGF0YSBwcm9wZXJ0eSwgbm90IGFuIGFjY2Vzc29yOiAke3F1b3RlKHRhZ0Rlc2MpfWApICYmICh0eXBlb2YgdGFnRGVzYy52YWx1ZSA9PT0gXCJzdHJpbmdcIiB8fCBDWChcbiAgICAgICAgY2hlY2tcbiAgICAgIClgT3duIEBAdG9TdHJpbmdUYWcgdmFsdWUgbXVzdCBiZSBhIHN0cmluZzogJHtxdW90ZSh0YWdEZXNjLnZhbHVlKX1gKSAmJiAoIXRhZ0Rlc2MuZW51bWVyYWJsZSB8fCBDWChjaGVjaylgT3duIEBAdG9TdHJpbmdUYWcgbXVzdCBub3QgYmUgZW51bWVyYWJsZTogJHtxdW90ZSh0YWdEZXNjKX1gKTtcbiAgICB9XG4gICAgY29uc3QgdmFsID0gcHJba2V5XTtcbiAgICBpZiAodmFsID09PSB2b2lkIDAgfHwgdHlwZW9mIHZhbCA9PT0gXCJudW1iZXJcIikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgdmFsID09PSBcIm9iamVjdFwiICYmIHZhbCAhPT0gbnVsbCAmJiBpc0Zyb3plbjQodmFsKSAmJiBnZXRQcm90b3R5cGVPZjkodmFsKSA9PT0gT2JqZWN0LnByb3RvdHlwZSkge1xuICAgICAgY29uc3Qgc3ViS2V5cyA9IG93bktleXM4KHZhbCk7XG4gICAgICBpZiAoc3ViS2V5cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoc3ViS2V5cy5sZW5ndGggPT09IDEgJiYgc3ViS2V5c1swXSA9PT0gXCJkZXN0cm95ZWRcIiAmJiB2YWwuZGVzdHJveWVkID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIENYKFxuICAgICAgY2hlY2tcbiAgICApYFVuZXhwZWN0ZWQgTm9kZSBhc3luY19ob29rcyBhZGRpdGlvbnMgdG8gcHJvbWlzZTogJHtwcn0uJHtxdW90ZShcbiAgICAgIFN0cmluZyhrZXkpXG4gICAgKX0gaXMgJHt2YWx9YDtcbiAgfTtcbiAgcmV0dXJuIGtleXM1LmV2ZXJ5KGNoZWNrU2FmZU93bktleSk7XG59O1xudmFyIGNoZWNrU2FmZVByb21pc2UgPSAocHIsIGNoZWNrKSA9PiB7XG4gIHJldHVybiAoaXNGcm96ZW40KHByKSB8fCBDWChjaGVjaylgJHtwcn0gLSBNdXN0IGJlIGZyb3plbmApICYmIChpc1Byb21pc2UocHIpIHx8IENYKGNoZWNrKWAke3ByfSAtIE11c3QgYmUgYSBwcm9taXNlYCkgJiYgKGdldFByb3RvdHlwZU9mOShwcikgPT09IFByb21pc2UucHJvdG90eXBlIHx8IENYKGNoZWNrKWAke3ByfSAtIE11c3QgaW5oZXJpdCBmcm9tIFByb21pc2UucHJvdG90eXBlOiAke3F1b3RlKFxuICAgIGdldFByb3RvdHlwZU9mOShwcilcbiAgKX1gKSAmJiBjaGVja1Byb21pc2VPd25LZXlzKFxuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICBwcixcbiAgICBjaGVja1xuICApO1xufTtcbmhhcmRlbihjaGVja1NhZmVQcm9taXNlKTtcbnZhciBpc1NhZmVQcm9taXNlID0gKHByKSA9PiBjaGVja1NhZmVQcm9taXNlKHByLCAoeCkgPT4geCk7XG5oYXJkZW4oaXNTYWZlUHJvbWlzZSk7XG52YXIgYXNzZXJ0U2FmZVByb21pc2UgPSAocHIpID0+IGNoZWNrU2FmZVByb21pc2UocHIsIGFzc2VydENoZWNrZXIpO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czkgfSA9IFJlZmxlY3Q7XG52YXIgeyBpc0Zyb3plbjogaXNGcm96ZW41LCBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzOiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzNSwgdmFsdWVzIH0gPSBPYmplY3Q7XG52YXIgbWFrZUhlbHBlclRhYmxlID0gKHBhc3NTdHlsZUhlbHBlcnMpID0+IHtcbiAgY29uc3QgSGVscGVyVGFibGUgPSB7XG4gICAgX19wcm90b19fOiBudWxsLFxuICAgIGNvcHlBcnJheTogdm9pZCAwLFxuICAgIGJ5dGVBcnJheTogdm9pZCAwLFxuICAgIGNvcHlSZWNvcmQ6IHZvaWQgMCxcbiAgICB0YWdnZWQ6IHZvaWQgMCxcbiAgICBlcnJvcjogdm9pZCAwLFxuICAgIHJlbW90YWJsZTogdm9pZCAwXG4gIH07XG4gIGZvciAoY29uc3QgaGVscGVyIG9mIHBhc3NTdHlsZUhlbHBlcnMpIHtcbiAgICBjb25zdCB7IHN0eWxlTmFtZSB9ID0gaGVscGVyO1xuICAgIHN0eWxlTmFtZSBpbiBIZWxwZXJUYWJsZSB8fCB0aHJvd1JlZGFjdGVkYFVucmVjb2duaXplZCBoZWxwZXI6ICR7cXVvdGUoc3R5bGVOYW1lKX1gO1xuICAgIEhlbHBlclRhYmxlW3N0eWxlTmFtZV0gPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYGNvbmZsaWN0aW5nIGhlbHBlcnMgZm9yICR7cXVvdGUoc3R5bGVOYW1lKX1gO1xuICAgIEhlbHBlclRhYmxlW3N0eWxlTmFtZV0gPSBoZWxwZXI7XG4gIH1cbiAgZm9yIChjb25zdCBzdHlsZU5hbWUgb2Ygb3duS2V5czkoSGVscGVyVGFibGUpKSB7XG4gICAgSGVscGVyVGFibGVbc3R5bGVOYW1lXSAhPT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgbWlzc2luZyBoZWxwZXIgZm9yICR7cXVvdGUoc3R5bGVOYW1lKX1gO1xuICB9XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICBoYXJkZW4oSGVscGVyVGFibGUpXG4gICk7XG59O1xudmFyIGFzc2VydFZhbGlkID0gKGhlbHBlciwgY2FuZGlkYXRlLCBwYXNzU3R5bGVPZlJlY3VyKSA9PiB7XG4gIGhlbHBlci5jYW5CZVZhbGlkKGNhbmRpZGF0ZSwgYXNzZXJ0Q2hlY2tlcik7XG4gIGhlbHBlci5hc3NlcnRSZXN0VmFsaWQoY2FuZGlkYXRlLCBwYXNzU3R5bGVPZlJlY3VyKTtcbn07XG52YXIgbWFrZVBhc3NTdHlsZU9mID0gKHBhc3NTdHlsZUhlbHBlcnMpID0+IHtcbiAgY29uc3QgSGVscGVyVGFibGUgPSBtYWtlSGVscGVyVGFibGUocGFzc1N0eWxlSGVscGVycyk7XG4gIGNvbnN0IHJlbW90YWJsZUhlbHBlciA9IEhlbHBlclRhYmxlLnJlbW90YWJsZTtcbiAgY29uc3QgcGFzc1N0eWxlTWVtbyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBjb25zdCBwYXNzU3R5bGVPZjIgPSAocGFzc2FibGUpID0+IHtcbiAgICBjb25zdCBpblByb2dyZXNzID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgICBjb25zdCBwYXNzU3R5bGVPZlJlY3VyID0gKGlubmVyKSA9PiB7XG4gICAgICBjb25zdCBpbm5lcklzT2JqZWN0ID0gIWlzUHJpbWl0aXZlMihpbm5lcik7XG4gICAgICBpZiAoaW5uZXJJc09iamVjdCkge1xuICAgICAgICBjb25zdCBpbm5lclN0eWxlID0gcGFzc1N0eWxlTWVtby5nZXQoaW5uZXIpO1xuICAgICAgICBpZiAoaW5uZXJTdHlsZSkge1xuICAgICAgICAgIHJldHVybiBpbm5lclN0eWxlO1xuICAgICAgICB9XG4gICAgICAgICFpblByb2dyZXNzLmhhcyhpbm5lcikgfHwgdGhyb3dSZWRhY3RlZGBQYXNzLWJ5LWNvcHkgZGF0YSBjYW5ub3QgYmUgY3ljbGljICR7aW5uZXJ9YDtcbiAgICAgICAgaW5Qcm9ncmVzcy5hZGQoaW5uZXIpO1xuICAgICAgfVxuICAgICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2ZJbnRlcm5hbChpbm5lcik7XG4gICAgICBpZiAoaW5uZXJJc09iamVjdCkge1xuICAgICAgICBwYXNzU3R5bGVNZW1vLnNldChpbm5lciwgcGFzc1N0eWxlKTtcbiAgICAgICAgaW5Qcm9ncmVzcy5kZWxldGUoaW5uZXIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHBhc3NTdHlsZTtcbiAgICB9O1xuICAgIGNvbnN0IHBhc3NTdHlsZU9mSW50ZXJuYWwgPSAoaW5uZXIpID0+IHtcbiAgICAgIGNvbnN0IHR5cGVzdHIgPSB0eXBlb2YgaW5uZXI7XG4gICAgICBzd2l0Y2ggKHR5cGVzdHIpIHtcbiAgICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgICAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgICAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgICAgIGNhc2UgXCJiaWdpbnRcIjoge1xuICAgICAgICAgIHJldHVybiB0eXBlc3RyO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJzdHJpbmdcIjoge1xuICAgICAgICAgIGFzc2VydFBhc3NhYmxlU3RyaW5nKGlubmVyKTtcbiAgICAgICAgICByZXR1cm4gXCJzdHJpbmdcIjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgICBhc3NlcnRQYXNzYWJsZVN5bWJvbChpbm5lcik7XG4gICAgICAgICAgcmV0dXJuIFwic3ltYm9sXCI7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcIm9iamVjdFwiOiB7XG4gICAgICAgICAgaWYgKGlubmVyID09PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gXCJudWxsXCI7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghaXNGcm96ZW41KGlubmVyKSkge1xuICAgICAgICAgICAgYXNzZXJ0LmZhaWwoXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIGlzVHlwZWRBcnJheShpbm5lcikgPyByZWRhY3RlZGBDYW5ub3QgcGFzcyBtdXRhYmxlIHR5cGVkIGFycmF5cyBsaWtlICR7aW5uZXJ9LmAgOiByZWRhY3RlZGBDYW5ub3QgcGFzcyBub24tZnJvemVuIG9iamVjdHMgbGlrZSAke2lubmVyfS4gVXNlIGhhcmRlbigpYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGlzUHJvbWlzZShpbm5lcikpIHtcbiAgICAgICAgICAgIGFzc2VydFNhZmVQcm9taXNlKGlubmVyKTtcbiAgICAgICAgICAgIHJldHVybiBcInByb21pc2VcIjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdHlwZW9mIGlubmVyLnRoZW4gIT09IFwiZnVuY3Rpb25cIiB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCBwYXNzIG5vbi1wcm9taXNlIHRoZW5hYmxlc2A7XG4gICAgICAgICAgY29uc3QgcGFzc1N0eWxlVGFnID0gaW5uZXJbUEFTU19TVFlMRV07XG4gICAgICAgICAgaWYgKHBhc3NTdHlsZVRhZyAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgICBhc3NlcnQudHlwZW9mKHBhc3NTdHlsZVRhZywgXCJzdHJpbmdcIik7XG4gICAgICAgICAgICBjb25zdCBoZWxwZXIgPSBIZWxwZXJUYWJsZVtwYXNzU3R5bGVUYWddO1xuICAgICAgICAgICAgaGVscGVyICE9PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBVbnJlY29nbml6ZWQgUGFzc1N0eWxlOiAke3F1b3RlKHBhc3NTdHlsZVRhZyl9YDtcbiAgICAgICAgICAgIGFzc2VydFZhbGlkKGhlbHBlciwgaW5uZXIsIHBhc3NTdHlsZU9mUmVjdXIpO1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgIHBhc3NTdHlsZVRhZ1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9yIChjb25zdCBoZWxwZXIgb2YgcGFzc1N0eWxlSGVscGVycykge1xuICAgICAgICAgICAgaWYgKGhlbHBlci5jYW5CZVZhbGlkKGlubmVyKSkge1xuICAgICAgICAgICAgICBoZWxwZXIuYXNzZXJ0UmVzdFZhbGlkKGlubmVyLCBwYXNzU3R5bGVPZlJlY3VyKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5zdHlsZU5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGFzc2VydFZhbGlkKHJlbW90YWJsZUhlbHBlciwgaW5uZXIsIHBhc3NTdHlsZU9mUmVjdXIpO1xuICAgICAgICAgIHJldHVybiBcInJlbW90YWJsZVwiO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJmdW5jdGlvblwiOiB7XG4gICAgICAgICAgaXNGcm96ZW41KGlubmVyKSB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCBwYXNzIG5vbi1mcm96ZW4gb2JqZWN0cyBsaWtlICR7aW5uZXJ9LiBVc2UgaGFyZGVuKClgO1xuICAgICAgICAgIHR5cGVvZiBpbm5lci50aGVuICE9PSBcImZ1bmN0aW9uXCIgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgcGFzcyBub24tcHJvbWlzZSB0aGVuYWJsZXNgO1xuICAgICAgICAgIGFzc2VydFZhbGlkKHJlbW90YWJsZUhlbHBlciwgaW5uZXIsIHBhc3NTdHlsZU9mUmVjdXIpO1xuICAgICAgICAgIHJldHVybiBcInJlbW90YWJsZVwiO1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICB0aHJvdyBhc3NlcnQuZmFpbChyZWRhY3RlZGBVbnJlY29nbml6ZWQgdHlwZW9mICR7cXVvdGUodHlwZXN0cil9YCwgVHlwZUVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIHBhc3NTdHlsZU9mUmVjdXIocGFzc2FibGUpO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHBhc3NTdHlsZU9mMik7XG59O1xudmFyIFBhc3NTdHlsZU9mRW5kb3dtZW50U3ltYm9sID0gU3ltYm9sLmZvcihcIkBlbmRvIHBhc3NTdHlsZU9mXCIpO1xudmFyIHBhc3NTdHlsZU9mID0gZ2xvYmFsVGhpcyAmJiBnbG9iYWxUaGlzW1Bhc3NTdHlsZU9mRW5kb3dtZW50U3ltYm9sXSB8fCBtYWtlUGFzc1N0eWxlT2YoW1xuICBDb3B5QXJyYXlIZWxwZXIsXG4gIEJ5dGVBcnJheUhlbHBlcixcbiAgQ29weVJlY29yZEhlbHBlcixcbiAgVGFnZ2VkSGVscGVyLFxuICBFcnJvckhlbHBlcixcbiAgUmVtb3RhYmxlSGVscGVyXG5dKTtcbnZhciBhc3NlcnRQYXNzYWJsZSA9ICh2YWwpID0+IHtcbiAgcGFzc1N0eWxlT2YodmFsKTtcbn07XG5oYXJkZW4oYXNzZXJ0UGFzc2FibGUpO1xudmFyIGlzUGFzc2FibGUgPSAoc3BlY2ltZW4pID0+IHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gcGFzc1N0eWxlT2Yoc3BlY2ltZW4pICE9PSB2b2lkIDA7XG4gIH0gY2F0Y2ggKF8pIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5oYXJkZW4oaXNQYXNzYWJsZSk7XG52YXIgaXNQYXNzYWJsZUVycm9yUHJvcGVydHlEZXNjID0gKG5hbWUsIGRlc2MpID0+IGNoZWNrUmVjdXJzaXZlbHlQYXNzYWJsZUVycm9yUHJvcGVydHlEZXNjKG5hbWUsIGRlc2MsIHBhc3NTdHlsZU9mKTtcbnZhciB0b1Bhc3NhYmxlRXJyb3IgPSAoZXJyKSA9PiB7XG4gIGhhcmRlbihlcnIpO1xuICBpZiAoY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3IoZXJyLCBwYXNzU3R5bGVPZikpIHtcbiAgICByZXR1cm4gZXJyO1xuICB9XG4gIGNvbnN0IHsgbmFtZSwgbWVzc2FnZSB9ID0gZXJyO1xuICBjb25zdCB7IGNhdXNlOiBjYXVzZURlc2MsIGVycm9yczogZXJyb3JzRGVzYyB9ID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczUoZXJyKTtcbiAgbGV0IGNhdXNlO1xuICBsZXQgZXJyb3JzO1xuICBpZiAoY2F1c2VEZXNjICYmIGlzUGFzc2FibGVFcnJvclByb3BlcnR5RGVzYyhcImNhdXNlXCIsIGNhdXNlRGVzYykpIHtcbiAgICBjYXVzZSA9IGNhdXNlRGVzYy52YWx1ZTtcbiAgfVxuICBpZiAoZXJyb3JzRGVzYyAmJiBpc1Bhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MoXCJlcnJvcnNcIiwgZXJyb3JzRGVzYykpIHtcbiAgICBlcnJvcnMgPSBlcnJvcnNEZXNjLnZhbHVlO1xuICB9XG4gIGNvbnN0IGVyckNvbnN0cnVjdG9yID0gZ2V0RXJyb3JDb25zdHJ1Y3RvcihgJHtuYW1lfWApIHx8IEVycm9yO1xuICBjb25zdCBuZXdFcnJvciA9IG1ha2VFcnJvcihgJHttZXNzYWdlfWAsIGVyckNvbnN0cnVjdG9yLCB7XG4gICAgLy9cbiAgICBjYXVzZSxcbiAgICBlcnJvcnNcbiAgfSk7XG4gIGhhcmRlbihuZXdFcnJvcik7XG4gIG5vdGUobmV3RXJyb3IsIHJlZGFjdGVkYGNvcGllZCBmcm9tIGVycm9yICR7ZXJyfWApO1xuICBwYXNzU3R5bGVPZihuZXdFcnJvcikgPT09IFwiZXJyb3JcIiB8fCB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkICR7bmV3RXJyb3J9IHRvIGJlIGEgcGFzc2FibGUgZXJyb3JgO1xuICByZXR1cm4gbmV3RXJyb3I7XG59O1xuaGFyZGVuKHRvUGFzc2FibGVFcnJvcik7XG52YXIgdG9UaHJvd2FibGUgPSAoc3BlY2ltZW4pID0+IHtcbiAgaGFyZGVuKHNwZWNpbWVuKTtcbiAgaWYgKGlzRXJyb3JMaWtlKHNwZWNpbWVuKSkge1xuICAgIHJldHVybiB0b1Bhc3NhYmxlRXJyb3IoXG4gICAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgICAgc3BlY2ltZW5cbiAgICApO1xuICB9XG4gIGlmICghaXNQcmltaXRpdmUyKHNwZWNpbWVuKSkge1xuICAgIGNvbnN0IHBhc3NTdHlsZSA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgcGFzc1N0eWxlT2Yoc3BlY2ltZW4pXG4gICAgKTtcbiAgICBzd2l0Y2ggKHBhc3NTdHlsZSkge1xuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnRzID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHNwZWNpbWVuXG4gICAgICAgICk7XG4gICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBlbGVtZW50cykge1xuICAgICAgICAgIGVsZW1lbnQgPT09IHRvVGhyb3dhYmxlKGVsZW1lbnQpIHx8IHRocm93UmVkYWN0ZWRgbmVzdGVkIHRvVGhyb3dhYmxlIGNvZXJjaW9uIG5vdCB5ZXQgc3VwcG9ydGVkICR7ZWxlbWVudH1gO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICBjb25zdCByZWMgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHNwZWNpbWVuXG4gICAgICAgICk7XG4gICAgICAgIGZvciAoY29uc3QgdmFsIG9mIHZhbHVlcyhyZWMpKSB7XG4gICAgICAgICAgdmFsID09PSB0b1Rocm93YWJsZSh2YWwpIHx8IHRocm93UmVkYWN0ZWRgbmVzdGVkIHRvVGhyb3dhYmxlIGNvZXJjaW9uIG5vdCB5ZXQgc3VwcG9ydGVkICR7dmFsfWA7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgY29uc3QgdGcgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHNwZWNpbWVuXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHsgcGF5bG9hZCB9ID0gdGc7XG4gICAgICAgIHBheWxvYWQgPT09IHRvVGhyb3dhYmxlKHBheWxvYWQpIHx8IHRocm93UmVkYWN0ZWRgbmVzdGVkIHRvVGhyb3dhYmxlIGNvZXJjaW9uIG5vdCB5ZXQgc3VwcG9ydGVkICR7cGF5bG9hZH1gO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgIGNvbnN0IGVyID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgc3BlY2ltZW5cbiAgICAgICAgKTtcbiAgICAgICAgZXIgPT09IHRvVGhyb3dhYmxlKGVyKSB8fCB0aHJvd1JlZGFjdGVkYG5lc3RlZCB0b1Rocm93YWJsZSBjb2VyY2lvbiBub3QgeWV0IHN1cHBvcnRlZCAke2VyfWA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEEgJHtxdW90ZShwYXNzU3R5bGUpfSBpcyBub3QgdGhyb3dhYmxlOiAke3NwZWNpbWVufWA7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgc3BlY2ltZW5cbiAgKTtcbn07XG5oYXJkZW4odG9UaHJvd2FibGUpO1xuXG4vL1xudmFyIHsgY3JlYXRlOiBjcmVhdGUyLCBwcm90b3R5cGU6IG9iamVjdFByb3RvdHlwZTUgfSA9IE9iamVjdDtcbnZhciBtYWtlVGFnZ2VkID0gKHRhZywgcGF5bG9hZCkgPT4ge1xuICB0eXBlb2YgdGFnID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgVGhlIHRhZyBvZiBhIHRhZ2dlZCByZWNvcmQgbXVzdCBiZSBhIHN0cmluZzogJHt0YWd9YDtcbiAgYXNzZXJ0UGFzc2FibGUoaGFyZGVuKHBheWxvYWQpKTtcbiAgcmV0dXJuIGhhcmRlbihcbiAgICBjcmVhdGUyKG9iamVjdFByb3RvdHlwZTUsIHtcbiAgICAgIFtQQVNTX1NUWUxFXTogeyB2YWx1ZTogXCJ0YWdnZWRcIiB9LFxuICAgICAgW1N5bWJvbC50b1N0cmluZ1RhZ106IHsgdmFsdWU6IHRhZyB9LFxuICAgICAgcGF5bG9hZDogeyB2YWx1ZTogcGF5bG9hZCwgZW51bWVyYWJsZTogdHJ1ZSB9XG4gICAgfSlcbiAgKTtcbn07XG5oYXJkZW4obWFrZVRhZ2dlZCk7XG5cbi8vXG52YXIgaXNDb3B5QXJyYXkgPSAoYXJyKSA9PiBwYXNzU3R5bGVPZihhcnIpID09PSBcImNvcHlBcnJheVwiO1xuaGFyZGVuKGlzQ29weUFycmF5KTtcbnZhciBpc0J5dGVBcnJheSA9IChhcnIpID0+IHBhc3NTdHlsZU9mKGFycikgPT09IFwiYnl0ZUFycmF5XCI7XG5oYXJkZW4oaXNCeXRlQXJyYXkpO1xudmFyIGlzUmVjb3JkID0gKHJlY29yZCkgPT4gcGFzc1N0eWxlT2YocmVjb3JkKSA9PT0gXCJjb3B5UmVjb3JkXCI7XG5oYXJkZW4oaXNSZWNvcmQpO1xudmFyIGlzUmVtb3RhYmxlID0gKHJlbW90YWJsZSkgPT4gcGFzc1N0eWxlT2YocmVtb3RhYmxlKSA9PT0gXCJyZW1vdGFibGVcIjtcbmhhcmRlbihpc1JlbW90YWJsZSk7XG52YXIgYXNzZXJ0Q29weUFycmF5ID0gKGFyciwgb3B0TmFtZU9mQXJyYXkgPSBcIkFsbGVnZWQgYXJyYXlcIikgPT4ge1xuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihhcnIpO1xuICBwYXNzU3R5bGUgPT09IFwiY29weUFycmF5XCIgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKG9wdE5hbWVPZkFycmF5KX0gJHthcnJ9IG11c3QgYmUgYSBwYXNzLWJ5LWNvcHkgYXJyYXksIG5vdCAke3F1b3RlKFxuICAgIHBhc3NTdHlsZVxuICApfWA7XG59O1xuaGFyZGVuKGFzc2VydENvcHlBcnJheSk7XG52YXIgYXNzZXJ0Qnl0ZUFycmF5ID0gKGFyciwgb3B0TmFtZU9mQXJyYXkgPSBcIkFsbGVnZWQgYnl0ZUFycmF5XCIpID0+IHtcbiAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YoYXJyKTtcbiAgcGFzc1N0eWxlID09PSBcImJ5dGVBcnJheVwiIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShcbiAgICBvcHROYW1lT2ZBcnJheVxuICApfSAke2Fycn0gbXVzdCBiZSBhIHBhc3MtYnktY29weSBiaW5hcnkgZGF0YSwgbm90ICR7cXVvdGUocGFzc1N0eWxlKX1gO1xufTtcbmhhcmRlbihhc3NlcnRCeXRlQXJyYXkpO1xudmFyIGFzc2VydFJlY29yZCA9IChyZWNvcmQsIG9wdE5hbWVPZlJlY29yZCA9IFwiQWxsZWdlZCByZWNvcmRcIikgPT4ge1xuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihyZWNvcmQpO1xuICBwYXNzU3R5bGUgPT09IFwiY29weVJlY29yZFwiIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShvcHROYW1lT2ZSZWNvcmQpfSAke3JlY29yZH0gbXVzdCBiZSBhIHBhc3MtYnktY29weSByZWNvcmQsIG5vdCAke3F1b3RlKFxuICAgIHBhc3NTdHlsZVxuICApfWA7XG59O1xuaGFyZGVuKGFzc2VydFJlY29yZCk7XG52YXIgYXNzZXJ0UmVtb3RhYmxlID0gKHJlbW90YWJsZSwgb3B0TmFtZU9mUmVtb3RhYmxlID0gXCJBbGxlZ2VkIHJlbW90YWJsZVwiKSA9PiB7XG4gIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHJlbW90YWJsZSk7XG4gIHBhc3NTdHlsZSA9PT0gXCJyZW1vdGFibGVcIiB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUob3B0TmFtZU9mUmVtb3RhYmxlKX0gJHtyZW1vdGFibGV9IG11c3QgYmUgYSByZW1vdGFibGUsIG5vdCAke3F1b3RlKFxuICAgIHBhc3NTdHlsZVxuICApfWA7XG59O1xuaGFyZGVuKGFzc2VydFJlbW90YWJsZSk7XG52YXIgY2hlY2tBdG9tID0gKHZhbCwgY2hlY2spID0+IHtcbiAgbGV0IHBhc3NTdHlsZTtcbiAgdHJ5IHtcbiAgICBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZih2YWwpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICByZXR1cm4gY2hlY2sgIT09IGlkZW50Q2hlY2tlciAmJiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgTm90IGV2ZW4gUGFzc2FibGU6ICR7cXVvdGUoZXJyKX06ICR7dmFsfWApO1xuICB9XG4gIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgIGNhc2UgXCJudWxsXCI6XG4gICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgY2FzZSBcImJpZ2ludFwiOlxuICAgIGNhc2UgXCJzdHJpbmdcIjpcbiAgICBjYXNlIFwiYnl0ZUFycmF5XCI6XG4gICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgcmV0dXJuIGNoZWNrICE9PSBpZGVudENoZWNrZXIgJiYgY2hlY2soZmFsc2UsIHJlZGFjdGVkYEEgJHtxdW90ZShwYXNzU3R5bGUpfSBjYW5ub3QgYmUgYW4gYXRvbTogJHt2YWx9YCk7XG4gICAgfVxuICB9XG59O1xudmFyIGlzQXRvbSA9ICh2YWwpID0+IGNoZWNrQXRvbSh2YWwsIGlkZW50Q2hlY2tlcik7XG5oYXJkZW4oaXNBdG9tKTtcbnZhciBhc3NlcnRBdG9tID0gKHZhbCkgPT4ge1xuICBjaGVja0F0b20odmFsLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0QXRvbSk7XG5cbi8vXG52YXIgaGlkZGVuUHJpb3JFcnJvcjtcbnZhciBoaWRkZW5DdXJyZW50VHVybiA9IDA7XG52YXIgaGlkZGVuQ3VycmVudEV2ZW50ID0gMDtcbnZhciBWRVJCT1NFID0gZW52aXJvbm1lbnRPcHRpb25zTGlzdEhhcyhcIkRFQlVHXCIsIFwidHJhY2stdHVybnNcIik7XG52YXIgRU5BQkxFRCA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICBnZXRFbnZpcm9ubWVudE9wdGlvbihcIlRSQUNLX1RVUk5TXCIsIFwiZGlzYWJsZWRcIiwgW1wiZW5hYmxlZFwiXSkgPT09IFwiZW5hYmxlZFwiXG4pO1xudmFyIGFkZFJlamVjdGlvbk5vdGUgPSAoZGV0YWlsc05vdGUpID0+IChyZWFzb24pID0+IHtcbiAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgZ2xvYmFsVGhpcy5hc3NlcnQubm90ZShyZWFzb24sIGRldGFpbHNOb3RlKTtcbiAgfVxuICBpZiAoVkVSQk9TRSkge1xuICAgIGNvbnNvbGUubG9nKFwiUkVKRUNURUQgYXQgdG9wIG9mIGV2ZW50IGxvb3BcIiwgcmVhc29uKTtcbiAgfVxufTtcbnZhciB3cmFwRnVuY3Rpb24gPSAoZnVuYywgc2VuZGluZ0Vycm9yLCBYNSkgPT4gKC4uLmFyZ3MpID0+IHtcbiAgaGlkZGVuUHJpb3JFcnJvciA9IHNlbmRpbmdFcnJvcjtcbiAgaGlkZGVuQ3VycmVudFR1cm4gKz0gMTtcbiAgaGlkZGVuQ3VycmVudEV2ZW50ID0gMDtcbiAgdHJ5IHtcbiAgICBsZXQgcmVzdWx0O1xuICAgIHRyeSB7XG4gICAgICByZXN1bHQgPSBmdW5jKC4uLmFyZ3MpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgIGdsb2JhbFRoaXMuYXNzZXJ0Lm5vdGUoXG4gICAgICAgICAgZXJyLFxuICAgICAgICAgIFg1YFRocm93biBmcm9tOiAke2hpZGRlblByaW9yRXJyb3J9OiR7aGlkZGVuQ3VycmVudFR1cm59LiR7aGlkZGVuQ3VycmVudEV2ZW50fWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChWRVJCT1NFKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiVEhST1dOIHRvIHRvcCBvZiBldmVudCBsb29wXCIsIGVycik7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIGNvbnN0IGRldGFpbHNOb3RlID0gWDVgUmVqZWN0aW9uIGZyb206ICR7aGlkZGVuUHJpb3JFcnJvcn06JHtoaWRkZW5DdXJyZW50VHVybn0uJHtoaWRkZW5DdXJyZW50RXZlbnR9YDtcbiAgICBQcm9taXNlLnJlc29sdmUocmVzdWx0KS5jYXRjaChhZGRSZWplY3Rpb25Ob3RlKGRldGFpbHNOb3RlKSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBmaW5hbGx5IHtcbiAgICBoaWRkZW5QcmlvckVycm9yID0gdm9pZCAwO1xuICB9XG59O1xudmFyIHRyYWNrVHVybnMgPSAoZnVuY3MpID0+IHtcbiAgaWYgKCFFTkFCTEVEIHx8IHR5cGVvZiBnbG9iYWxUaGlzID09PSBcInVuZGVmaW5lZFwiIHx8ICFnbG9iYWxUaGlzLmFzc2VydCkge1xuICAgIHJldHVybiBmdW5jcztcbiAgfVxuICBjb25zdCB7IGRldGFpbHM6IFg1LCBub3RlOiBhbm5vdGF0ZUVycm9yIH0gPSBnbG9iYWxUaGlzLmFzc2VydDtcbiAgaGlkZGVuQ3VycmVudEV2ZW50ICs9IDE7XG4gIGNvbnN0IHNlbmRpbmdFcnJvciA9IEVycm9yKFxuICAgIGBFdmVudDogJHtoaWRkZW5DdXJyZW50VHVybn0uJHtoaWRkZW5DdXJyZW50RXZlbnR9YFxuICApO1xuICBpZiAoaGlkZGVuUHJpb3JFcnJvciAhPT0gdm9pZCAwKSB7XG4gICAgYW5ub3RhdGVFcnJvcihzZW5kaW5nRXJyb3IsIFg1YENhdXNlZCBieTogJHtoaWRkZW5QcmlvckVycm9yfWApO1xuICB9XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAqL1xuICAgIGZ1bmNzLm1hcCgoZnVuYykgPT4gZnVuYyAmJiB3cmFwRnVuY3Rpb24oZnVuYywgc2VuZGluZ0Vycm9yLCBYNSkpXG4gICk7XG59O1xuXG4vL1xudmFyIHsgZGV0YWlsczogWDIsIHF1b3RlOiBxNCwgRmFpbDogRmFpbDQsIGVycm9yOiBtYWtlRXJyb3IyIH0gPSBhc3NlcnQ7XG52YXIgeyBhc3NpZ24sIGZyZWV6ZTogZnJlZXplNCB9ID0gT2JqZWN0O1xudmFyIG9uU2VuZCA9IG1ha2VNZXNzYWdlQnJlYWtwb2ludFRlc3RlcihcIkVORE9fU0VORF9CUkVBS1BPSU5UU1wiKTtcbnZhciBiYXNlRnJlZXphYmxlUHJveHlIYW5kbGVyID0ge1xuICBzZXQoX3RhcmdldCwgX3Byb3AsIF92YWx1ZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbiAgaXNFeHRlbnNpYmxlKF90YXJnZXQpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIHNldFByb3RvdHlwZU9mKF90YXJnZXQsIF92YWx1ZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbiAgZGVsZXRlUHJvcGVydHkoX3RhcmdldCwgX3Byb3ApIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG52YXIgbWFrZUVQcm94eUhhbmRsZXIgPSAocmVjaXBpZW50LCBIYW5kbGVkUHJvbWlzZTIpID0+IGhhcmRlbih7XG4gIC4uLmJhc2VGcmVlemFibGVQcm94eUhhbmRsZXIsXG4gIGdldDogKF90YXJnZXQsIHByb3BlcnR5S2V5LCByZWNlaXZlcikgPT4ge1xuICAgIHJldHVybiBoYXJkZW4oXG4gICAgICB7XG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBbcHJvcGVydHlLZXldKC4uLmFyZ3MpIHtcbiAgICAgICAgICBpZiAodGhpcyAhPT0gcmVjZWl2ZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBIYW5kbGVkUHJvbWlzZTIucmVqZWN0KFxuICAgICAgICAgICAgICBtYWtlRXJyb3IyKFxuICAgICAgICAgICAgICAgIFgyYFVuZXhwZWN0ZWQgcmVjZWl2ZXIgZm9yIFwiJHtxNChwcm9wZXJ0eUtleSl9XCIgbWV0aG9kIG9mIEUoJHtxNChcbiAgICAgICAgICAgICAgICAgIHJlY2lwaWVudFxuICAgICAgICAgICAgICAgICl9KWBcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG9uU2VuZCAmJiBvblNlbmQuc2hvdWxkQnJlYWtwb2ludChyZWNpcGllbnQsIHByb3BlcnR5S2V5KSkge1xuICAgICAgICAgICAgZGVidWdnZXI7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBIYW5kbGVkUHJvbWlzZTIuYXBwbHlNZXRob2QocmVjaXBpZW50LCBwcm9wZXJ0eUtleSwgYXJncyk7XG4gICAgICAgIH1cbiAgICAgICAgLy9cbiAgICAgIH1bcHJvcGVydHlLZXldXG4gICAgKTtcbiAgfSxcbiAgYXBwbHk6IChfdGFyZ2V0LCBfdGhpc0FyZywgYXJnQXJyYXkgPSBbXSkgPT4ge1xuICAgIGlmIChvblNlbmQgJiYgb25TZW5kLnNob3VsZEJyZWFrcG9pbnQocmVjaXBpZW50LCB2b2lkIDApKSB7XG4gICAgICBkZWJ1Z2dlcjtcbiAgICB9XG4gICAgcmV0dXJuIEhhbmRsZWRQcm9taXNlMi5hcHBseUZ1bmN0aW9uKHJlY2lwaWVudCwgYXJnQXJyYXkpO1xuICB9LFxuICBoYXM6IChfdGFyZ2V0LCBfcCkgPT4ge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59KTtcbnZhciBtYWtlRVNlbmRPbmx5UHJveHlIYW5kbGVyID0gKHJlY2lwaWVudCwgSGFuZGxlZFByb21pc2UyKSA9PiBoYXJkZW4oe1xuICAuLi5iYXNlRnJlZXphYmxlUHJveHlIYW5kbGVyLFxuICBnZXQ6IChfdGFyZ2V0LCBwcm9wZXJ0eUtleSwgcmVjZWl2ZXIpID0+IHtcbiAgICByZXR1cm4gaGFyZGVuKFxuICAgICAge1xuICAgICAgICAvL1xuICAgICAgICAvL1xuICAgICAgICAvL1xuICAgICAgICAvL1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBbcHJvcGVydHlLZXldKC4uLmFyZ3MpIHtcbiAgICAgICAgICB0aGlzID09PSByZWNlaXZlciB8fCBGYWlsNGBVbmV4cGVjdGVkIHJlY2VpdmVyIGZvciBcIiR7cTQoXG4gICAgICAgICAgICBwcm9wZXJ0eUtleVxuICAgICAgICAgICl9XCIgbWV0aG9kIG9mIEUuc2VuZE9ubHkoJHtxNChyZWNpcGllbnQpfSlgO1xuICAgICAgICAgIGlmIChvblNlbmQgJiYgb25TZW5kLnNob3VsZEJyZWFrcG9pbnQocmVjaXBpZW50LCBwcm9wZXJ0eUtleSkpIHtcbiAgICAgICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICAgIH1cbiAgICAgICAgICBIYW5kbGVkUHJvbWlzZTIuYXBwbHlNZXRob2RTZW5kT25seShyZWNpcGllbnQsIHByb3BlcnR5S2V5LCBhcmdzKTtcbiAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICB9XG4gICAgICAgIC8vXG4gICAgICB9W3Byb3BlcnR5S2V5XVxuICAgICk7XG4gIH0sXG4gIGFwcGx5OiAoX3RhcmdldCwgX3RoaXNBcmcsIGFyZ3NBcnJheSA9IFtdKSA9PiB7XG4gICAgaWYgKG9uU2VuZCAmJiBvblNlbmQuc2hvdWxkQnJlYWtwb2ludChyZWNpcGllbnQsIHZvaWQgMCkpIHtcbiAgICAgIGRlYnVnZ2VyO1xuICAgIH1cbiAgICBIYW5kbGVkUHJvbWlzZTIuYXBwbHlGdW5jdGlvblNlbmRPbmx5KHJlY2lwaWVudCwgYXJnc0FycmF5KTtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9LFxuICBoYXM6IChfdGFyZ2V0LCBfcCkgPT4ge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59KTtcbnZhciBtYWtlRUdldFByb3h5SGFuZGxlciA9ICh4LCBIYW5kbGVkUHJvbWlzZTIpID0+IGhhcmRlbih7XG4gIC4uLmJhc2VGcmVlemFibGVQcm94eUhhbmRsZXIsXG4gIGhhczogKF90YXJnZXQsIF9wcm9wKSA9PiB0cnVlLFxuICBnZXQ6IChfdGFyZ2V0LCBwcm9wKSA9PiBIYW5kbGVkUHJvbWlzZTIuZ2V0KHgsIHByb3ApXG59KTtcbnZhciBmdW5jVGFyZ2V0ID0gZnJlZXplNCgoKSA9PiB7XG59KTtcbnZhciBvYmpUYXJnZXQgPSBmcmVlemU0KHsgX19wcm90b19fOiBudWxsIH0pO1xudmFyIG1ha2VFID0gKEhhbmRsZWRQcm9taXNlMikgPT4ge1xuICByZXR1cm4gaGFyZGVuKFxuICAgIGFzc2lnbihcbiAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIC8vXG4gICAgICAoeCkgPT4gbmV3IFByb3h5KGZ1bmNUYXJnZXQsIG1ha2VFUHJveHlIYW5kbGVyKHgsIEhhbmRsZWRQcm9taXNlMikpLFxuICAgICAge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgLy9cbiAgICAgICAgZ2V0OiAoeCkgPT4gbmV3IFByb3h5KG9ialRhcmdldCwgbWFrZUVHZXRQcm94eUhhbmRsZXIoeCwgSGFuZGxlZFByb21pc2UyKSksXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHJlc29sdmU6IEhhbmRsZWRQcm9taXNlMi5yZXNvbHZlLFxuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBzZW5kT25seTogKHgpID0+IChcbiAgICAgICAgICAvL1xuICAgICAgICAgIG5ldyBQcm94eShmdW5jVGFyZ2V0LCBtYWtlRVNlbmRPbmx5UHJveHlIYW5kbGVyKHgsIEhhbmRsZWRQcm9taXNlMikpXG4gICAgICAgICksXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHdoZW46ICh4LCBvbmZ1bGZpbGxlZCwgb25yZWplY3RlZCkgPT4gSGFuZGxlZFByb21pc2UyLnJlc29sdmUoeCkudGhlbihcbiAgICAgICAgICAuLi50cmFja1R1cm5zKFtvbmZ1bGZpbGxlZCwgb25yZWplY3RlZF0pXG4gICAgICAgIClcbiAgICAgIH1cbiAgICApXG4gICk7XG59O1xudmFyIEVfZGVmYXVsdCA9IG1ha2VFO1xuXG4vL1xudmFyIGhwID0gSGFuZGxlZFByb21pc2U7XG52YXIgRSA9IEVfZGVmYXVsdChocCk7XG5cbi8vXG52YXIgeyBvd25LZXlzOiBvd25LZXlzMTAgfSA9IFJlZmxlY3Q7XG52YXIgeyBmcm9tRW50cmllcyB9ID0gT2JqZWN0O1xudmFyIGRlZXBseUZ1bGZpbGxlZCA9IGFzeW5jICh2YWwpID0+IHtcbiAgaWYgKGlzQXRvbSh2YWwpKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHZhbFxuICAgICk7XG4gIH1cbiAgaWYgKGlzUHJvbWlzZSh2YWwpKSB7XG4gICAgcmV0dXJuIEUud2hlbih2YWwsIChub25wKSA9PiBkZWVwbHlGdWxmaWxsZWQobm9ucCkpO1xuICB9XG4gIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHZhbCk7XG4gIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgY29uc3QgcmVjID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHZhbFxuICAgICAgKTtcbiAgICAgIGNvbnN0IG5hbWVzID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBvd25LZXlzMTAocmVjKVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHZhbFBzID0gbmFtZXMubWFwKChuYW1lKSA9PiBkZWVwbHlGdWxmaWxsZWQocmVjW25hbWVdKSk7XG4gICAgICByZXR1cm4gRS53aGVuKFxuICAgICAgICBQcm9taXNlLmFsbCh2YWxQcyksXG4gICAgICAgICh2YWxzKSA9PiBoYXJkZW4oZnJvbUVudHJpZXModmFscy5tYXAoKGMyLCBpMikgPT4gW25hbWVzW2kyXSwgYzJdKSkpXG4gICAgICApO1xuICAgIH1cbiAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgIGNvbnN0IGFyciA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHZhbFxuICAgICAgKTtcbiAgICAgIGNvbnN0IHZhbFBzID0gYXJyLm1hcCgocDIpID0+IGRlZXBseUZ1bGZpbGxlZChwMikpO1xuICAgICAgcmV0dXJuIEUud2hlbihQcm9taXNlLmFsbCh2YWxQcyksICh2YWxzKSA9PiBoYXJkZW4odmFscykpO1xuICAgIH1cbiAgICBjYXNlIFwiYnl0ZUFycmF5XCI6IHtcbiAgICAgIGNvbnN0IGJ5dGVBcnJheSA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApO1xuICAgICAgcmV0dXJuIGJ5dGVBcnJheTtcbiAgICB9XG4gICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICBjb25zdCB0Z2QgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApO1xuICAgICAgY29uc3QgdGFnID0gZ2V0VGFnKHRnZCk7XG4gICAgICByZXR1cm4gRS53aGVuKFxuICAgICAgICBkZWVwbHlGdWxmaWxsZWQodGdkLnBheWxvYWQpLFxuICAgICAgICAocGF5bG9hZCkgPT4gbWFrZVRhZ2dlZCh0YWcsIHBheWxvYWQpXG4gICAgICApO1xuICAgIH1cbiAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgIGNvbnN0IHJlbSA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHZhbFxuICAgICAgKTtcbiAgICAgIHJldHVybiByZW07XG4gICAgfVxuICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICBjb25zdCBlcnIgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgIHZhbFxuICAgICAgKTtcbiAgICAgIHJldHVybiBlcnI7XG4gICAgfVxuICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgIGNvbnN0IHByb20gPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB2YWxcbiAgICAgICk7XG4gICAgICByZXR1cm4gRS53aGVuKHByb20sIChub25wKSA9PiBkZWVwbHlGdWxmaWxsZWQobm9ucCkpO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICB0aHJvdyBhc3NlcnQuZmFpbChyZWRhY3RlZGBVbmV4cGVjdGVkIHBhc3NTdHlsZSAke3F1b3RlKHBhc3NTdHlsZSl9YCwgVHlwZUVycm9yKTtcbiAgICB9XG4gIH1cbn07XG5oYXJkZW4oZGVlcGx5RnVsZmlsbGVkKTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXMxMSB9ID0gUmVmbGVjdDtcbnZhciB7IGlzQXJyYXk6IGlzQXJyYXk0IH0gPSBBcnJheTtcbnZhciB7XG4gIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM6IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM2LFxuICBkZWZpbmVQcm9wZXJ0aWVzLFxuICBpcyxcbiAgZW50cmllczogZW50cmllczMsXG4gIGZyb21FbnRyaWVzOiBmcm9tRW50cmllczIsXG4gIGZyZWV6ZTogZnJlZXplNSxcbiAgaGFzT3duOiBoYXNPd242XG59ID0gT2JqZWN0O1xudmFyIFFDTEFTUyA9IFwiQHFjbGFzc1wiO1xudmFyIGhhc1FDbGFzcyA9IChlbmNvZGVkKSA9PiBoYXNPd242KGVuY29kZWQsIFFDTEFTUyk7XG52YXIgcWNsYXNzTWF0Y2hlcyA9IChlbmNvZGVkLCBxY2xhc3MpID0+ICFpc1ByaW1pdGl2ZTIoZW5jb2RlZCkgJiYgIWlzQXJyYXk0KGVuY29kZWQpICYmIGhhc1FDbGFzcyhlbmNvZGVkKSAmJiBlbmNvZGVkW1FDTEFTU10gPT09IHFjbGFzcztcbnZhciBkb250RW5jb2RlUmVtb3RhYmxlVG9DYXBEYXRhID0gKHJlbSkgPT4gdGhyb3dSZWRhY3RlZGByZW1vdGFibGUgdW5leHBlY3RlZDogJHtyZW19YDtcbnZhciBkb250RW5jb2RlUHJvbWlzZVRvQ2FwRGF0YSA9IChwcm9tKSA9PiB0aHJvd1JlZGFjdGVkYHByb21pc2UgdW5leHBlY3RlZDogJHtwcm9tfWA7XG52YXIgZG9udEVuY29kZUVycm9yVG9DYXBEYXRhID0gKGVycikgPT4gdGhyb3dSZWRhY3RlZGBlcnJvciBvYmplY3QgdW5leHBlY3RlZDogJHtlcnJ9YDtcbnZhciBtYWtlRW5jb2RlVG9DYXBEYXRhID0gKGVuY29kZU9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgZW5jb2RlUmVtb3RhYmxlVG9DYXBEYXRhID0gZG9udEVuY29kZVJlbW90YWJsZVRvQ2FwRGF0YSxcbiAgICBlbmNvZGVQcm9taXNlVG9DYXBEYXRhID0gZG9udEVuY29kZVByb21pc2VUb0NhcERhdGEsXG4gICAgZW5jb2RlRXJyb3JUb0NhcERhdGEgPSBkb250RW5jb2RlRXJyb3JUb0NhcERhdGFcbiAgfSA9IGVuY29kZU9wdGlvbnM7XG4gIGNvbnN0IGVuY29kZVRvQ2FwRGF0YVJlY3VyID0gKHBhc3NhYmxlKSA9PiB7XG4gICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YocGFzc2FibGUpO1xuICAgIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwibnVsbFwiOlxuICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgIGNhc2UgXCJzdHJpbmdcIjoge1xuICAgICAgICByZXR1cm4gcGFzc2FibGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwidW5kZWZpbmVkXCI6IHtcbiAgICAgICAgcmV0dXJuIHsgW1FDTEFTU106IFwidW5kZWZpbmVkXCIgfTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJudW1iZXJcIjoge1xuICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKHBhc3NhYmxlKSkge1xuICAgICAgICAgIHJldHVybiB7IFtRQ0xBU1NdOiBcIk5hTlwiIH07XG4gICAgICAgIH0gZWxzZSBpZiAocGFzc2FibGUgPT09IEluZmluaXR5KSB7XG4gICAgICAgICAgcmV0dXJuIHsgW1FDTEFTU106IFwiSW5maW5pdHlcIiB9O1xuICAgICAgICB9IGVsc2UgaWYgKHBhc3NhYmxlID09PSAtSW5maW5pdHkpIHtcbiAgICAgICAgICByZXR1cm4geyBbUUNMQVNTXTogXCItSW5maW5pdHlcIiB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpcyhwYXNzYWJsZSwgLTApID8gMCA6IHBhc3NhYmxlO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJpZ2ludFwiOiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgW1FDTEFTU106IFwiYmlnaW50XCIsXG4gICAgICAgICAgZGlnaXRzOiBTdHJpbmcocGFzc2FibGUpXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgYXNzZXJ0UGFzc2FibGVTeW1ib2wocGFzc2FibGUpO1xuICAgICAgICBjb25zdCBuYW1lID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIG5hbWVGb3JQYXNzYWJsZVN5bWJvbChwYXNzYWJsZSlcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBbUUNMQVNTXTogXCJzeW1ib2xcIixcbiAgICAgICAgICBuYW1lXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGlmIChoYXNPd242KHBhc3NhYmxlLCBRQ0xBU1MpKSB7XG4gICAgICAgICAgY29uc3QgeyBbUUNMQVNTXTogcWNsYXNzVmFsdWUsIC4uLnJlc3QgfSA9IHBhc3NhYmxlO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgICAgICAgIFtRQ0xBU1NdOiBcImhpbGJlcnRcIixcbiAgICAgICAgICAgIG9yaWdpbmFsOiBlbmNvZGVUb0NhcERhdGFSZWN1cihxY2xhc3NWYWx1ZSlcbiAgICAgICAgICB9O1xuICAgICAgICAgIGlmIChvd25LZXlzMTEocmVzdCkubGVuZ3RoID49IDEpIHtcbiAgICAgICAgICAgIHJlc3VsdC5yZXN0ID0gZW5jb2RlVG9DYXBEYXRhUmVjdXIoZnJlZXplNShyZXN0KSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmFtZXMgPSBvd25LZXlzMTEocGFzc2FibGUpLnNvcnQoKTtcbiAgICAgICAgcmV0dXJuIGZyb21FbnRyaWVzMihcbiAgICAgICAgICBuYW1lcy5tYXAoKG5hbWUpID0+IFtuYW1lLCBlbmNvZGVUb0NhcERhdGFSZWN1cihwYXNzYWJsZVtuYW1lXSldKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIHJldHVybiBwYXNzYWJsZS5tYXAoZW5jb2RlVG9DYXBEYXRhUmVjdXIpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJ5dGVBcnJheVwiOiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgbWFyc2FsIG9mIGJ5dGVBcnJheSBub3QgeWV0IGltcGxlbWVudGVkOiAke3Bhc3NhYmxlfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBbUUNMQVNTXTogXCJ0YWdnZWRcIixcbiAgICAgICAgICB0YWc6IGdldFRhZyhwYXNzYWJsZSksXG4gICAgICAgICAgcGF5bG9hZDogZW5jb2RlVG9DYXBEYXRhUmVjdXIocGFzc2FibGUucGF5bG9hZClcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJyZW1vdGFibGVcIjoge1xuICAgICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2RlUmVtb3RhYmxlVG9DYXBEYXRhKFxuICAgICAgICAgIHBhc3NhYmxlLFxuICAgICAgICAgIGVuY29kZVRvQ2FwRGF0YVJlY3VyXG4gICAgICAgICk7XG4gICAgICAgIGlmIChxY2xhc3NNYXRjaGVzKGVuY29kZWQsIFwic2xvdFwiKSkge1xuICAgICAgICAgIHJldHVybiBlbmNvZGVkO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IFJlbW90YWJsZSBlbmNvZGluZyBtdXN0IGJlIGFuIG9iamVjdCB3aXRoICR7cXVvdGUoXG4gICAgICAgICAgUUNMQVNTXG4gICAgICAgICl9ICR7cXVvdGUoXCJzbG90XCIpfTogJHtlbmNvZGVkfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIGNvbnN0IGVuY29kZWQgPSBlbmNvZGVQcm9taXNlVG9DYXBEYXRhKHBhc3NhYmxlLCBlbmNvZGVUb0NhcERhdGFSZWN1cik7XG4gICAgICAgIGlmIChxY2xhc3NNYXRjaGVzKGVuY29kZWQsIFwic2xvdFwiKSkge1xuICAgICAgICAgIHJldHVybiBlbmNvZGVkO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IFByb21pc2UgZW5jb2RpbmcgbXVzdCBiZSBhbiBvYmplY3Qgd2l0aCAke3F1b3RlKFxuICAgICAgICAgIFFDTEFTUyxcbiAgICAgICAgICBcInNsb3RcIlxuICAgICAgICApfTogJHtlbmNvZGVkfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZXJyb3JcIjoge1xuICAgICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2RlRXJyb3JUb0NhcERhdGEocGFzc2FibGUsIGVuY29kZVRvQ2FwRGF0YVJlY3VyKTtcbiAgICAgICAgaWYgKHFjbGFzc01hdGNoZXMoZW5jb2RlZCwgXCJlcnJvclwiKSkge1xuICAgICAgICAgIHJldHVybiBlbmNvZGVkO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IEVycm9yIGVuY29kaW5nIG11c3QgYmUgYW4gb2JqZWN0IHdpdGggJHtxdW90ZShcbiAgICAgICAgICBRQ0xBU1MsXG4gICAgICAgICAgXCJlcnJvclwiXG4gICAgICAgICl9OiAke2VuY29kZWR9YDtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgYXNzZXJ0LmZhaWwoXG4gICAgICAgICAgcmVkYWN0ZWRgaW50ZXJuYWw6IFVucmVjb2duaXplZCBwYXNzU3R5bGUgJHtxdW90ZShwYXNzU3R5bGUpfWAsXG4gICAgICAgICAgVHlwZUVycm9yXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBlbmNvZGVUb0NhcERhdGEgPSAocGFzc2FibGUpID0+IHtcbiAgICBpZiAoaXNFcnJvckxpa2UocGFzc2FibGUpKSB7XG4gICAgICByZXR1cm4gaGFyZGVuKGVuY29kZUVycm9yVG9DYXBEYXRhKHBhc3NhYmxlLCBlbmNvZGVUb0NhcERhdGFSZWN1cikpO1xuICAgIH1cbiAgICByZXR1cm4gaGFyZGVuKGVuY29kZVRvQ2FwRGF0YVJlY3VyKHBhc3NhYmxlKSk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oZW5jb2RlVG9DYXBEYXRhKTtcbn07XG5oYXJkZW4obWFrZUVuY29kZVRvQ2FwRGF0YSk7XG52YXIgZG9udERlY29kZVJlbW90YWJsZU9yUHJvbWlzZUZyb21DYXBEYXRhID0gKHNsb3RFbmNvZGluZykgPT4gdGhyb3dSZWRhY3RlZGByZW1vdGFibGUgb3IgcHJvbWlzZSB1bmV4cGVjdGVkOiAke3Nsb3RFbmNvZGluZ31gO1xudmFyIGRvbnREZWNvZGVFcnJvckZyb21DYXBEYXRhID0gKGVycm9yRW5jb2RpbmcpID0+IHRocm93UmVkYWN0ZWRgZXJyb3IgdW5leHBlY3RlZDogJHtlcnJvckVuY29kaW5nfWA7XG52YXIgbWFrZURlY29kZUZyb21DYXBEYXRhID0gKGRlY29kZU9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgZGVjb2RlUmVtb3RhYmxlRnJvbUNhcERhdGEgPSBkb250RGVjb2RlUmVtb3RhYmxlT3JQcm9taXNlRnJvbUNhcERhdGEsXG4gICAgZGVjb2RlUHJvbWlzZUZyb21DYXBEYXRhID0gZG9udERlY29kZVJlbW90YWJsZU9yUHJvbWlzZUZyb21DYXBEYXRhLFxuICAgIGRlY29kZUVycm9yRnJvbUNhcERhdGEgPSBkb250RGVjb2RlRXJyb3JGcm9tQ2FwRGF0YVxuICB9ID0gZGVjb2RlT3B0aW9ucztcbiAgZGVjb2RlUmVtb3RhYmxlRnJvbUNhcERhdGEgPT09IGRlY29kZVByb21pc2VGcm9tQ2FwRGF0YSB8fCB0aHJvd1JlZGFjdGVkYEFuIGltcGxlbWVudGF0aW9uIHJlc3RyaWN0aW9uIGZvciBub3c6IElmIGVpdGhlciBkZWNvZGVSZW1vdGFibGVGcm9tQ2FwRGF0YSBvciBkZWNvZGVQcm9taXNlRnJvbUNhcERhdGEgaXMgcHJvdmlkZWQsIGJvdGggbXVzdCBiZSBwcm92aWRlZCBhbmQgdGhleSBtdXN0IGJlIHRoZSBzYW1lOiAke3F1b3RlKFxuICAgIGRlY29kZVJlbW90YWJsZUZyb21DYXBEYXRhXG4gICl9IHZzICR7cXVvdGUoZGVjb2RlUHJvbWlzZUZyb21DYXBEYXRhKX1gO1xuICBjb25zdCBkZWNvZGVGcm9tQ2FwRGF0YSA9IChqc29uRW5jb2RlZCkgPT4ge1xuICAgIGlmIChpc1ByaW1pdGl2ZTIoanNvbkVuY29kZWQpKSB7XG4gICAgICByZXR1cm4ganNvbkVuY29kZWQ7XG4gICAgfVxuICAgIGlmIChpc0FycmF5NChqc29uRW5jb2RlZCkpIHtcbiAgICAgIHJldHVybiBqc29uRW5jb2RlZC5tYXAoKGVuY29kZWRWYWwpID0+IGRlY29kZUZyb21DYXBEYXRhKGVuY29kZWRWYWwpKTtcbiAgICB9IGVsc2UgaWYgKGhhc1FDbGFzcyhqc29uRW5jb2RlZCkpIHtcbiAgICAgIGNvbnN0IHFjbGFzcyA9IGpzb25FbmNvZGVkW1FDTEFTU107XG4gICAgICB0eXBlb2YgcWNsYXNzID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgaW52YWxpZCAke3F1b3RlKFFDTEFTUyl9IHR5cGVvZiAke3F1b3RlKHR5cGVvZiBxY2xhc3MpfWA7XG4gICAgICBzd2l0Y2ggKHFjbGFzcykge1xuICAgICAgICAvL1xuICAgICAgICBjYXNlIFwidW5kZWZpbmVkXCI6IHtcbiAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJOYU5cIjoge1xuICAgICAgICAgIHJldHVybiBOYU47XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcIkluZmluaXR5XCI6IHtcbiAgICAgICAgICByZXR1cm4gSW5maW5pdHk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcIi1JbmZpbml0eVwiOiB7XG4gICAgICAgICAgcmV0dXJuIC1JbmZpbml0eTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgICBjb25zdCB7IGRpZ2l0cyB9ID0ganNvbkVuY29kZWQ7XG4gICAgICAgICAgdHlwZW9mIGRpZ2l0cyA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYGludmFsaWQgZGlnaXRzIHR5cGVvZiAke3F1b3RlKHR5cGVvZiBkaWdpdHMpfWA7XG4gICAgICAgICAgcmV0dXJuIEJpZ0ludChkaWdpdHMpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJAQGFzeW5jSXRlcmF0b3JcIjoge1xuICAgICAgICAgIHJldHVybiBTeW1ib2wuYXN5bmNJdGVyYXRvcjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgICBjb25zdCB7IG5hbWUgfSA9IGpzb25FbmNvZGVkO1xuICAgICAgICAgIHJldHVybiBwYXNzYWJsZVN5bWJvbEZvck5hbWUobmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgICAgY29uc3QgeyB0YWcsIHBheWxvYWQgfSA9IGpzb25FbmNvZGVkO1xuICAgICAgICAgIHJldHVybiBtYWtlVGFnZ2VkKHRhZywgZGVjb2RlRnJvbUNhcERhdGEocGF5bG9hZCkpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJzbG90XCI6IHtcbiAgICAgICAgICBjb25zdCBkZWNvZGVkID0gZGVjb2RlUmVtb3RhYmxlRnJvbUNhcERhdGEoXG4gICAgICAgICAgICBqc29uRW5jb2RlZCxcbiAgICAgICAgICAgIGRlY29kZUZyb21DYXBEYXRhXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gZGVjb2RlZDtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiZXJyb3JcIjoge1xuICAgICAgICAgIGNvbnN0IGRlY29kZWQgPSBkZWNvZGVFcnJvckZyb21DYXBEYXRhKFxuICAgICAgICAgICAganNvbkVuY29kZWQsXG4gICAgICAgICAgICBkZWNvZGVGcm9tQ2FwRGF0YVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHBhc3NTdHlsZU9mKGRlY29kZWQpID09PSBcImVycm9yXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBkZWNvZGVkO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBkZWNvZGVFcnJvckZyb21DYXBEYXRhIG9wdGlvbiBtdXN0IHJldHVybiBhbiBlcnJvcjogJHtkZWNvZGVkfWA7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImhpbGJlcnRcIjoge1xuICAgICAgICAgIGNvbnN0IHsgb3JpZ2luYWwsIHJlc3QgfSA9IGpzb25FbmNvZGVkO1xuICAgICAgICAgIGhhc093bjYoanNvbkVuY29kZWQsIFwib3JpZ2luYWxcIikgfHwgdGhyb3dSZWRhY3RlZGBJbnZhbGlkIEhpbGJlcnQgSG90ZWwgZW5jb2RpbmcgJHtqc29uRW5jb2RlZH1gO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHsgW1FDTEFTU106IGRlY29kZUZyb21DYXBEYXRhKG9yaWdpbmFsKSB9O1xuICAgICAgICAgIGlmIChoYXNPd242KGpzb25FbmNvZGVkLCBcInJlc3RcIikpIHtcbiAgICAgICAgICAgIGNvbnN0IGlzTm9uRW1wdHlPYmplY3QgPSB0eXBlb2YgcmVzdCA9PT0gXCJvYmplY3RcIiAmJiByZXN0ICE9PSBudWxsICYmIG93bktleXMxMShyZXN0KS5sZW5ndGggPj0gMTtcbiAgICAgICAgICAgIGlmICghaXNOb25FbXB0eU9iamVjdCkge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3QgZW5jb2RpbmcgbXVzdCBiZSBhIG5vbi1lbXB0eSBvYmplY3Q6ICR7cmVzdH1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdE9iaiA9IGRlY29kZUZyb21DYXBEYXRhKHJlc3QpO1xuICAgICAgICAgICAgIWhhc093bjYocmVzdE9iaiwgUUNMQVNTKSB8fCB0aHJvd1JlZGFjdGVkYFJlc3QgbXVzdCBub3QgY29udGFpbiBpdHMgb3duIGRlZmluaXRpb24gb2YgJHtxdW90ZShRQ0xBU1MpfWA7XG4gICAgICAgICAgICBkZWZpbmVQcm9wZXJ0aWVzKHJlc3VsdCwgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczYocmVzdE9iaikpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIC8vXG4gICAgICAgIGNhc2UgXCJpYmlkXCI6IHtcbiAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFRoZSBjYXBEYXRhIHByb3RvY29sIG5vIGxvbmdlciBzdXBwb3J0cyAke3F1b3RlKFFDTEFTUyl9ICR7cXVvdGUoXG4gICAgICAgICAgICBxY2xhc3NcbiAgICAgICAgICApfWA7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHRocm93IGFzc2VydC5mYWlsKFxuICAgICAgICAgICAgcmVkYWN0ZWRgdW5yZWNvZ25pemVkICR7cXVvdGUoUUNMQVNTKX0gJHtxdW90ZShxY2xhc3MpfWAsXG4gICAgICAgICAgICBUeXBlRXJyb3JcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGFzc2VydCh0eXBlb2YganNvbkVuY29kZWQgPT09IFwib2JqZWN0XCIgJiYganNvbkVuY29kZWQgIT09IG51bGwpO1xuICAgICAgY29uc3QgZGVjb2RlRW50cnkgPSAoW25hbWUsIGVuY29kZWRWYWxdKSA9PiB7XG4gICAgICAgIHR5cGVvZiBuYW1lID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgUHJvcGVydHkgJHtxdW90ZShuYW1lKX0gb2YgJHtqc29uRW5jb2RlZH0gbXVzdCBiZSBhIHN0cmluZ2A7XG4gICAgICAgIHJldHVybiBbbmFtZSwgZGVjb2RlRnJvbUNhcERhdGEoZW5jb2RlZFZhbCldO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGRlY29kZWRFbnRyaWVzID0gZW50cmllczMoanNvbkVuY29kZWQpLm1hcChkZWNvZGVFbnRyeSk7XG4gICAgICByZXR1cm4gZnJvbUVudHJpZXMyKGRlY29kZWRFbnRyaWVzKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBoYXJkZW4oZGVjb2RlRnJvbUNhcERhdGEpO1xufTtcblxuLy9cbmZ1bmN0aW9uIGlzTmF0KGFsbGVnZWROdW0pIHtcbiAgaWYgKHR5cGVvZiBhbGxlZ2VkTnVtID09PSBcImJpZ2ludFwiKSB7XG4gICAgcmV0dXJuIGFsbGVnZWROdW0gPj0gMDtcbiAgfVxuICBpZiAodHlwZW9mIGFsbGVnZWROdW0gIT09IFwibnVtYmVyXCIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIE51bWJlci5pc1NhZmVJbnRlZ2VyKGFsbGVnZWROdW0pICYmIGFsbGVnZWROdW0gPj0gMDtcbn1cbmZ1bmN0aW9uIE5hdChhbGxlZ2VkTnVtKSB7XG4gIGlmICh0eXBlb2YgYWxsZWdlZE51bSA9PT0gXCJiaWdpbnRcIikge1xuICAgIGlmIChhbGxlZ2VkTnVtIDwgMG4pIHtcbiAgICAgIHRocm93IFJhbmdlRXJyb3IoYCR7YWxsZWdlZE51bX0gaXMgbmVnYXRpdmVgKTtcbiAgICB9XG4gICAgcmV0dXJuIGFsbGVnZWROdW07XG4gIH1cbiAgaWYgKHR5cGVvZiBhbGxlZ2VkTnVtID09PSBcIm51bWJlclwiKSB7XG4gICAgaWYgKCFOdW1iZXIuaXNTYWZlSW50ZWdlcihhbGxlZ2VkTnVtKSkge1xuICAgICAgdGhyb3cgUmFuZ2VFcnJvcihgJHthbGxlZ2VkTnVtfSBpcyBub3QgYSBzYWZlIGludGVnZXJgKTtcbiAgICB9XG4gICAgaWYgKGFsbGVnZWROdW0gPCAwKSB7XG4gICAgICB0aHJvdyBSYW5nZUVycm9yKGAke2FsbGVnZWROdW19IGlzIG5lZ2F0aXZlYCk7XG4gICAgfVxuICAgIHJldHVybiBCaWdJbnQoYWxsZWdlZE51bSk7XG4gIH1cbiAgdGhyb3cgVHlwZUVycm9yKFxuICAgIGAke2FsbGVnZWROdW19IGlzIGEgJHt0eXBlb2YgYWxsZWdlZE51bX0gYnV0IG11c3QgYmUgYSBiaWdpbnQgb3IgYSBudW1iZXJgXG4gICk7XG59XG5cbi8vXG52YXIgeyBlbnRyaWVzOiBlbnRyaWVzNCwgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMyB9ID0gT2JqZWN0O1xudmFyIG9iamVjdE1hcCA9IChvcmlnaW5hbCwgbWFwRm4pID0+IHtcbiAgY29uc3QgZW50cyA9IGVudHJpZXM0KG9yaWdpbmFsKTtcbiAgY29uc3QgbWFwRW50cyA9IGVudHMubWFwKFxuICAgIChbaywgdjJdKSA9PiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIFtrLCBtYXBGbih2MiwgayldXG4gICAgKVxuICApO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGhhcmRlbihmcm9tRW50cmllczMobWFwRW50cykpXG4gICk7XG59O1xuaGFyZGVuKG9iamVjdE1hcCk7XG5cbi8vXG52YXIgeyBvd25LZXlzOiBvd25LZXlzMTIgfSA9IFJlZmxlY3Q7XG52YXIgeyBpc0FycmF5OiBpc0FycmF5NSB9ID0gQXJyYXk7XG52YXIgeyBpczogaXMyLCBlbnRyaWVzOiBlbnRyaWVzNSwgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzNCwgaGFzT3duOiBoYXNPd243IH0gPSBPYmplY3Q7XG52YXIgQkFORyA9IFwiIVwiLmNoYXJDb2RlQXQoMCk7XG52YXIgREFTSCA9IFwiLVwiLmNoYXJDb2RlQXQoMCk7XG52YXIgc3RhcnRzU3BlY2lhbCA9IChlbmNvZGVkU3RyKSA9PiB7XG4gIGlmIChlbmNvZGVkU3RyID09PSBcIlwiKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IGNvZGUgPSBlbmNvZGVkU3RyLmNoYXJDb2RlQXQoMCk7XG4gIHJldHVybiBCQU5HIDw9IGNvZGUgJiYgY29kZSA8PSBEQVNIO1xufTtcbnZhciBkb250RW5jb2RlUmVtb3RhYmxlVG9TbWFsbGNhcHMgPSAocmVtKSA9PiB0aHJvd1JlZGFjdGVkYHJlbW90YWJsZSB1bmV4cGVjdGVkOiAke3JlbX1gO1xudmFyIGRvbnRFbmNvZGVQcm9taXNlVG9TbWFsbGNhcHMgPSAocHJvbSkgPT4gdGhyb3dSZWRhY3RlZGBwcm9taXNlIHVuZXhwZWN0ZWQ6ICR7cHJvbX1gO1xudmFyIGRvbnRFbmNvZGVFcnJvclRvU21hbGxjYXBzID0gKGVycikgPT4gdGhyb3dSZWRhY3RlZGBlcnJvciBvYmplY3QgdW5leHBlY3RlZDogJHtxdW90ZShlcnIpfWA7XG52YXIgbWFrZUVuY29kZVRvU21hbGxjYXBzID0gKGVuY29kZU9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgZW5jb2RlUmVtb3RhYmxlVG9TbWFsbGNhcHMgPSBkb250RW5jb2RlUmVtb3RhYmxlVG9TbWFsbGNhcHMsXG4gICAgZW5jb2RlUHJvbWlzZVRvU21hbGxjYXBzID0gZG9udEVuY29kZVByb21pc2VUb1NtYWxsY2FwcyxcbiAgICBlbmNvZGVFcnJvclRvU21hbGxjYXBzID0gZG9udEVuY29kZUVycm9yVG9TbWFsbGNhcHNcbiAgfSA9IGVuY29kZU9wdGlvbnM7XG4gIGNvbnN0IGFzc2VydEVuY29kZWRFcnJvciA9IChlbmNvZGluZykgPT4ge1xuICAgIHR5cGVvZiBlbmNvZGluZyA9PT0gXCJvYmplY3RcIiAmJiBoYXNPd243KGVuY29kaW5nLCBcIiNlcnJvclwiKSB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBFcnJvciBlbmNvZGluZyBtdXN0IGhhdmUgXCIjZXJyb3JcIiBwcm9wZXJ0eTogJHtxdW90ZShcbiAgICAgIGVuY29kaW5nXG4gICAgKX1gO1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBlbmNvZGluZ1tcIiNlcnJvclwiXTtcbiAgICB0eXBlb2YgbWVzc2FnZSA9PT0gXCJzdHJpbmdcIiAmJiAoIXN0YXJ0c1NwZWNpYWwobWVzc2FnZSkgfHwgbWVzc2FnZS5jaGFyQXQoMCkgPT09IFwiIVwiKSB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBFcnJvciBlbmNvZGluZyBtdXN0IGhhdmUgc3RyaW5nIG1lc3NhZ2U6ICR7cXVvdGUobWVzc2FnZSl9YDtcbiAgfTtcbiAgY29uc3QgZW5jb2RlVG9TbWFsbGNhcHNSZWN1ciA9IChwYXNzYWJsZSkgPT4ge1xuICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHBhc3NhYmxlKTtcbiAgICBzd2l0Y2ggKHBhc3NTdHlsZSkge1xuICAgICAgY2FzZSBcIm51bGxcIjpcbiAgICAgIGNhc2UgXCJib29sZWFuXCI6IHtcbiAgICAgICAgcmV0dXJuIHBhc3NhYmxlO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN0cmluZ1wiOiB7XG4gICAgICAgIGlmIChzdGFydHNTcGVjaWFsKHBhc3NhYmxlKSkge1xuICAgICAgICAgIHJldHVybiBgISR7cGFzc2FibGV9YDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFzc2FibGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwidW5kZWZpbmVkXCI6IHtcbiAgICAgICAgcmV0dXJuIFwiI3VuZGVmaW5lZFwiO1xuICAgICAgfVxuICAgICAgY2FzZSBcIm51bWJlclwiOiB7XG4gICAgICAgIGlmIChOdW1iZXIuaXNOYU4ocGFzc2FibGUpKSB7XG4gICAgICAgICAgcmV0dXJuIFwiI05hTlwiO1xuICAgICAgICB9IGVsc2UgaWYgKHBhc3NhYmxlID09PSBJbmZpbml0eSkge1xuICAgICAgICAgIHJldHVybiBcIiNJbmZpbml0eVwiO1xuICAgICAgICB9IGVsc2UgaWYgKHBhc3NhYmxlID09PSAtSW5maW5pdHkpIHtcbiAgICAgICAgICByZXR1cm4gXCIjLUluZmluaXR5XCI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlzMihwYXNzYWJsZSwgLTApID8gMCA6IHBhc3NhYmxlO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJpZ2ludFwiOiB7XG4gICAgICAgIGNvbnN0IHN0ciA9IFN0cmluZyhwYXNzYWJsZSk7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgcGFzc2FibGUgPCAwbiA/IHN0ciA6IGArJHtzdHJ9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICAgIGFzc2VydFBhc3NhYmxlU3ltYm9sKHBhc3NhYmxlKTtcbiAgICAgICAgY29uc3QgbmFtZSA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBuYW1lRm9yUGFzc2FibGVTeW1ib2wocGFzc2FibGUpXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBgJSR7bmFtZX1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICBjb25zdCBuYW1lcyA9IG93bktleXMxMihwYXNzYWJsZSkuc29ydCgpO1xuICAgICAgICByZXR1cm4gZnJvbUVudHJpZXM0KFxuICAgICAgICAgIG5hbWVzLm1hcCgobmFtZSkgPT4gW1xuICAgICAgICAgICAgZW5jb2RlVG9TbWFsbGNhcHNSZWN1cihuYW1lKSxcbiAgICAgICAgICAgIGVuY29kZVRvU21hbGxjYXBzUmVjdXIocGFzc2FibGVbbmFtZV0pXG4gICAgICAgICAgXSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgICByZXR1cm4gcGFzc2FibGUubWFwKGVuY29kZVRvU21hbGxjYXBzUmVjdXIpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJ5dGVBcnJheVwiOiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgbWFyc2FsIG9mIGJ5dGVBcnJheSBub3QgeWV0IGltcGxlbWVudGVkOiAke3Bhc3NhYmxlfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBcIiN0YWdcIjogZW5jb2RlVG9TbWFsbGNhcHNSZWN1cihnZXRUYWcocGFzc2FibGUpKSxcbiAgICAgICAgICBwYXlsb2FkOiBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyKHBhc3NhYmxlLnBheWxvYWQpXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gZW5jb2RlUmVtb3RhYmxlVG9TbWFsbGNhcHMoXG4gICAgICAgICAgcGFzc2FibGUsXG4gICAgICAgICAgZW5jb2RlVG9TbWFsbGNhcHNSZWN1clxuICAgICAgICApO1xuICAgICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gXCJzdHJpbmdcIiAmJiByZXN1bHQuY2hhckF0KDApID09PSBcIiRcIikge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogUmVtb3RhYmxlIGVuY29kaW5nIG11c3Qgc3RhcnQgd2l0aCBcIiRcIjogJHtyZXN1bHR9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gZW5jb2RlUHJvbWlzZVRvU21hbGxjYXBzKFxuICAgICAgICAgIHBhc3NhYmxlLFxuICAgICAgICAgIGVuY29kZVRvU21hbGxjYXBzUmVjdXJcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHR5cGVvZiByZXN1bHQgPT09IFwic3RyaW5nXCIgJiYgcmVzdWx0LmNoYXJBdCgwKSA9PT0gXCImXCIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IFByb21pc2UgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiJlwiOiAke3Jlc3VsdH1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gZW5jb2RlRXJyb3JUb1NtYWxsY2FwcyhwYXNzYWJsZSwgZW5jb2RlVG9TbWFsbGNhcHNSZWN1cik7XG4gICAgICAgIGFzc2VydEVuY29kZWRFcnJvcihyZXN1bHQpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyBhc3NlcnQuZmFpbChcbiAgICAgICAgICByZWRhY3RlZGBpbnRlcm5hbDogVW5yZWNvZ25pemVkIHBhc3NTdHlsZSAke3F1b3RlKHBhc3NTdHlsZSl9YCxcbiAgICAgICAgICBUeXBlRXJyb3JcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IGVuY29kZVRvU21hbGxjYXBzID0gKHBhc3NhYmxlKSA9PiB7XG4gICAgaWYgKGlzRXJyb3JMaWtlKHBhc3NhYmxlKSkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gaGFyZGVuKFxuICAgICAgICBlbmNvZGVFcnJvclRvU21hbGxjYXBzKHBhc3NhYmxlLCBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyKVxuICAgICAgKTtcbiAgICAgIGFzc2VydEVuY29kZWRFcnJvcihyZXN1bHQpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgcmV0dXJuIGhhcmRlbihlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyKHBhc3NhYmxlKSk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oZW5jb2RlVG9TbWFsbGNhcHMpO1xufTtcbmhhcmRlbihtYWtlRW5jb2RlVG9TbWFsbGNhcHMpO1xudmFyIGRvbnREZWNvZGVSZW1vdGFibGVGcm9tU21hbGxjYXBzID0gKGVuY29kaW5nKSA9PiB0aHJvd1JlZGFjdGVkYHJlbW90YWJsZSB1bmV4cGVjdGVkOiAke2VuY29kaW5nfWA7XG52YXIgZG9udERlY29kZVByb21pc2VGcm9tU21hbGxjYXBzID0gKGVuY29kaW5nKSA9PiB0aHJvd1JlZGFjdGVkYHByb21pc2UgdW5leHBlY3RlZDogJHtlbmNvZGluZ31gO1xudmFyIGRvbnREZWNvZGVFcnJvckZyb21TbWFsbGNhcHMgPSAoZW5jb2RpbmcpID0+IHRocm93UmVkYWN0ZWRgZXJyb3IgdW5leHBlY3RlZDogJHtxdW90ZShlbmNvZGluZyl9YDtcbnZhciBtYWtlRGVjb2RlRnJvbVNtYWxsY2FwcyA9IChkZWNvZGVPcHRpb25zID0ge30pID0+IHtcbiAgY29uc3Qge1xuICAgIGRlY29kZVJlbW90YWJsZUZyb21TbWFsbGNhcHMgPSBkb250RGVjb2RlUmVtb3RhYmxlRnJvbVNtYWxsY2FwcyxcbiAgICBkZWNvZGVQcm9taXNlRnJvbVNtYWxsY2FwcyA9IGRvbnREZWNvZGVQcm9taXNlRnJvbVNtYWxsY2FwcyxcbiAgICBkZWNvZGVFcnJvckZyb21TbWFsbGNhcHMgPSBkb250RGVjb2RlRXJyb3JGcm9tU21hbGxjYXBzXG4gIH0gPSBkZWNvZGVPcHRpb25zO1xuICBjb25zdCBkZWNvZGVGcm9tU21hbGxjYXBzID0gKGVuY29kaW5nKSA9PiB7XG4gICAgc3dpdGNoICh0eXBlb2YgZW5jb2RpbmcpIHtcbiAgICAgIGNhc2UgXCJib29sZWFuXCI6XG4gICAgICBjYXNlIFwibnVtYmVyXCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kaW5nO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN0cmluZ1wiOiB7XG4gICAgICAgIGlmICghc3RhcnRzU3BlY2lhbChlbmNvZGluZykpIHtcbiAgICAgICAgICByZXR1cm4gZW5jb2Rpbmc7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYzIgPSBlbmNvZGluZy5jaGFyQXQoMCk7XG4gICAgICAgIHN3aXRjaCAoYzIpIHtcbiAgICAgICAgICBjYXNlIFwiIVwiOiB7XG4gICAgICAgICAgICByZXR1cm4gZW5jb2Rpbmcuc2xpY2UoMSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgXCIlXCI6IHtcbiAgICAgICAgICAgIHJldHVybiBwYXNzYWJsZVN5bWJvbEZvck5hbWUoZW5jb2Rpbmcuc2xpY2UoMSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwiI1wiOiB7XG4gICAgICAgICAgICBzd2l0Y2ggKGVuY29kaW5nKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCIjdW5kZWZpbmVkXCI6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNhc2UgXCIjTmFOXCI6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gTmFOO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNhc2UgXCIjSW5maW5pdHlcIjoge1xuICAgICAgICAgICAgICAgIHJldHVybiBJbmZpbml0eTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjYXNlIFwiIy1JbmZpbml0eVwiOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC1JbmZpbml0eTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgYXNzZXJ0LmZhaWwoXG4gICAgICAgICAgICAgICAgICByZWRhY3RlZGB1bmtub3duIGNvbnN0YW50IFwiJHtxdW90ZShlbmNvZGluZyl9XCJgLFxuICAgICAgICAgICAgICAgICAgVHlwZUVycm9yXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwiK1wiOlxuICAgICAgICAgIGNhc2UgXCItXCI6IHtcbiAgICAgICAgICAgIHJldHVybiBCaWdJbnQoZW5jb2RpbmcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwiJFwiOiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBkZWNvZGVSZW1vdGFibGVGcm9tU21hbGxjYXBzKFxuICAgICAgICAgICAgICBlbmNvZGluZyxcbiAgICAgICAgICAgICAgZGVjb2RlRnJvbVNtYWxsY2Fwc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChwYXNzU3R5bGVPZihyZXN1bHQpICE9PSBcInJlbW90YWJsZVwiKSB7XG4gICAgICAgICAgICAgIHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGRlY29kZVJlbW90YWJsZUZyb21TbWFsbGNhcHMgb3B0aW9uIG11c3QgcmV0dXJuIGEgcmVtb3RhYmxlOiAke3Jlc3VsdH1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBcIiZcIjoge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZGVjb2RlUHJvbWlzZUZyb21TbWFsbGNhcHMoXG4gICAgICAgICAgICAgIGVuY29kaW5nLFxuICAgICAgICAgICAgICBkZWNvZGVGcm9tU21hbGxjYXBzXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKHBhc3NTdHlsZU9mKHJlc3VsdCkgIT09IFwicHJvbWlzZVwiKSB7XG4gICAgICAgICAgICAgIHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGRlY29kZVByb21pc2VGcm9tU21hbGxjYXBzIG9wdGlvbiBtdXN0IHJldHVybiBhIHByb21pc2U6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgIH1cbiAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFNwZWNpYWwgY2hhciAke3F1b3RlKFxuICAgICAgICAgICAgICBjMlxuICAgICAgICAgICAgKX0gcmVzZXJ2ZWQgZm9yIGZ1dHVyZSB1c2U6ICR7ZW5jb2Rpbmd9YDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNhc2UgXCJvYmplY3RcIjoge1xuICAgICAgICBpZiAoZW5jb2RpbmcgPT09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gZW5jb2Rpbmc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzQXJyYXk1KGVuY29kaW5nKSkge1xuICAgICAgICAgIHJldHVybiBlbmNvZGluZy5tYXAoKHZhbCkgPT4gZGVjb2RlRnJvbVNtYWxsY2Fwcyh2YWwpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGFzT3duNyhlbmNvZGluZywgXCIjdGFnXCIpKSB7XG4gICAgICAgICAgY29uc3QgeyBcIiN0YWdcIjogdGFnLCBwYXlsb2FkLCAuLi5yZXN0IH0gPSBlbmNvZGluZztcbiAgICAgICAgICB0eXBlb2YgdGFnID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgVmFsdWUgb2YgXCIjdGFnXCIsIHRoZSB0YWcsIG11c3QgYmUgYSBzdHJpbmc6ICR7ZW5jb2Rpbmd9YDtcbiAgICAgICAgICBvd25LZXlzMTIocmVzdCkubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgI3RhZyByZWNvcmQgdW5leHBlY3RlZCBwcm9wZXJ0aWVzOiAke3F1b3RlKG93bktleXMxMihyZXN0KSl9YDtcbiAgICAgICAgICByZXR1cm4gbWFrZVRhZ2dlZChcbiAgICAgICAgICAgIGRlY29kZUZyb21TbWFsbGNhcHModGFnKSxcbiAgICAgICAgICAgIGRlY29kZUZyb21TbWFsbGNhcHMocGF5bG9hZClcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChoYXNPd243KGVuY29kaW5nLCBcIiNlcnJvclwiKSkge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGRlY29kZUVycm9yRnJvbVNtYWxsY2FwcyhcbiAgICAgICAgICAgIGVuY29kaW5nLFxuICAgICAgICAgICAgZGVjb2RlRnJvbVNtYWxsY2Fwc1xuICAgICAgICAgICk7XG4gICAgICAgICAgcGFzc1N0eWxlT2YocmVzdWx0KSA9PT0gXCJlcnJvclwiIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGRlY29kZUVycm9yRnJvbVNtYWxsY2FwcyBvcHRpb24gbXVzdCByZXR1cm4gYW4gZXJyb3I6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkZWNvZGVFbnRyeSA9IChbZW5jb2RlZE5hbWUsIGVuY29kZWRWYWxdKSA9PiB7XG4gICAgICAgICAgdHlwZW9mIGVuY29kZWROYW1lID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgUHJvcGVydHkgbmFtZSAke3F1b3RlKFxuICAgICAgICAgICAgZW5jb2RlZE5hbWVcbiAgICAgICAgICApfSBvZiAke2VuY29kaW5nfSBtdXN0IGJlIGEgc3RyaW5nYDtcbiAgICAgICAgICBlbmNvZGVkTmFtZS5jaGFyQXQoMCkgIT09IFwiI1wiIHx8IHRocm93UmVkYWN0ZWRgVW5yZWNvZ25pemVkIHJlY29yZCB0eXBlICR7cXVvdGUoZW5jb2RlZE5hbWUpfTogJHtlbmNvZGluZ31gO1xuICAgICAgICAgIGNvbnN0IG5hbWUgPSBkZWNvZGVGcm9tU21hbGxjYXBzKGVuY29kZWROYW1lKTtcbiAgICAgICAgICB0eXBlb2YgbmFtZSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYERlY29kZWQgcHJvcGVydHkgbmFtZSAke25hbWV9IGZyb20gJHtlbmNvZGluZ30gbXVzdCBiZSBhIHN0cmluZ2A7XG4gICAgICAgICAgcmV0dXJuIFtuYW1lLCBkZWNvZGVGcm9tU21hbGxjYXBzKGVuY29kZWRWYWwpXTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZGVjb2RlZEVudHJpZXMgPSBlbnRyaWVzNShlbmNvZGluZykubWFwKGRlY29kZUVudHJ5KTtcbiAgICAgICAgcmV0dXJuIGZyb21FbnRyaWVzNChkZWNvZGVkRW50cmllcyk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IGFzc2VydC5mYWlsKFxuICAgICAgICAgIHJlZGFjdGVkYGludGVybmFsOiB1bnJlY29nbml6ZWQgSlNPTiB0eXBlb2YgJHtxdW90ZShcbiAgICAgICAgICAgIHR5cGVvZiBlbmNvZGluZ1xuICAgICAgICAgICl9OiAke2VuY29kaW5nfWAsXG4gICAgICAgICAgVHlwZUVycm9yXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gaGFyZGVuKGRlY29kZUZyb21TbWFsbGNhcHMpO1xufTtcblxuLy9cbnZhciB7IGRlZmluZVByb3BlcnRpZXM6IGRlZmluZVByb3BlcnRpZXMyLCBoYXNPd246IGhhc093bjggfSA9IE9iamVjdDtcbnZhciB7IGlzQXJyYXk6IGlzQXJyYXk2IH0gPSBBcnJheTtcbnZhciB7IG93bktleXM6IG93bktleXMxMyB9ID0gUmVmbGVjdDtcbnZhciBkZWZhdWx0VmFsVG9TbG90Rm4gPSAoeCkgPT4geDtcbnZhciBkZWZhdWx0U2xvdFRvVmFsRm4gPSAoeCwgXykgPT4geDtcbnZhciBtYWtlTWFyc2hhbCA9IChjb252ZXJ0VmFsVG9TbG90ID0gZGVmYXVsdFZhbFRvU2xvdEZuLCBjb252ZXJ0U2xvdFRvVmFsID0gZGVmYXVsdFNsb3RUb1ZhbEZuLCB7XG4gIGVycm9yVGFnZ2luZyA9IFwib25cIixcbiAgbWFyc2hhbE5hbWUgPSBcImFub24tbWFyc2hhbFwiLFxuICAvL1xuICAvL1xuICBlcnJvcklkTnVtID0gMWU0LFxuICAvL1xuICAvL1xuICBtYXJzaGFsU2F2ZUVycm9yID0gKGVycikgPT4gY29uc29sZS5sb2coXCJUZW1wb3JhcnkgbG9nZ2luZyBvZiBzZW50IGVycm9yXCIsIGVyciksXG4gIC8vXG4gIC8vXG4gIHNlcmlhbGl6ZUJvZHlGb3JtYXQgPSBcImNhcGRhdGFcIlxufSA9IHt9KSA9PiB7XG4gIGFzc2VydC50eXBlb2YobWFyc2hhbE5hbWUsIFwic3RyaW5nXCIpO1xuICBlcnJvclRhZ2dpbmcgPT09IFwib25cIiB8fCBlcnJvclRhZ2dpbmcgPT09IFwib2ZmXCIgfHwgdGhyb3dSZWRhY3RlZGBUaGUgZXJyb3JUYWdnaW5nIG9wdGlvbiBjYW4gb25seSBiZSBcIm9uXCIgb3IgXCJvZmZcIiAke2Vycm9yVGFnZ2luZ31gO1xuICBjb25zdCBuZXh0RXJyb3JJZCA9ICgpID0+IHtcbiAgICBlcnJvcklkTnVtICs9IDE7XG4gICAgcmV0dXJuIGBlcnJvcjoke21hcnNoYWxOYW1lfSMke2Vycm9ySWROdW19YDtcbiAgfTtcbiAgY29uc3QgdG9DYXBEYXRhMiA9IChyb290KSA9PiB7XG4gICAgY29uc3Qgc2xvdHMgPSBbXTtcbiAgICBjb25zdCBzbG90TWFwID0gLyogICAgICAgICAgICovIG5ldyBNYXAoKTtcbiAgICBjb25zdCBlbmNvZGVTbG90Q29tbW9uID0gKHBhc3NhYmxlKSA9PiB7XG4gICAgICBsZXQgaW5kZXggPSBzbG90TWFwLmdldChwYXNzYWJsZSk7XG4gICAgICBpZiAoaW5kZXggIT09IHZvaWQgMCkge1xuICAgICAgICBhc3NlcnQudHlwZW9mKGluZGV4LCBcIm51bWJlclwiKTtcbiAgICAgICAgcmV0dXJuIGhhcmRlbih7IGluZGV4LCByZXBlYXQ6IHRydWUgfSk7XG4gICAgICB9XG4gICAgICBpbmRleCA9IHNsb3RzLmxlbmd0aDtcbiAgICAgIGNvbnN0IHNsb3QgPSBjb252ZXJ0VmFsVG9TbG90KHBhc3NhYmxlKTtcbiAgICAgIHNsb3RzLnB1c2goc2xvdCk7XG4gICAgICBzbG90TWFwLnNldChwYXNzYWJsZSwgaW5kZXgpO1xuICAgICAgcmV0dXJuIGhhcmRlbih7IGluZGV4LCByZXBlYXQ6IGZhbHNlIH0pO1xuICAgIH07XG4gICAgY29uc3QgZW5jb2RlRXJyb3JDb21tb24gPSAoZXJyLCBlbmNvZGVSZWN1cikgPT4ge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IGVuY29kZVJlY3VyKGAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgYXNzZXJ0LnR5cGVvZihtZXNzYWdlLCBcInN0cmluZ1wiKTtcbiAgICAgIGNvbnN0IG5hbWUgPSBlbmNvZGVSZWN1cihgJHtlcnIubmFtZX1gKTtcbiAgICAgIGFzc2VydC50eXBlb2YobmFtZSwgXCJzdHJpbmdcIik7XG4gICAgICBpZiAoZXJyb3JUYWdnaW5nID09PSBcIm9uXCIpIHtcbiAgICAgICAgY29uc3QgZXJyb3JJZCA9IGVuY29kZVJlY3VyKG5leHRFcnJvcklkKCkpO1xuICAgICAgICBhc3NlcnQudHlwZW9mKGVycm9ySWQsIFwic3RyaW5nXCIpO1xuICAgICAgICBub3RlKGVyciwgcmVkYWN0ZWRgU2VudCBhcyAke2Vycm9ySWR9YCk7XG4gICAgICAgIG1hcnNoYWxTYXZlRXJyb3IoZXJyKTtcbiAgICAgICAgcmV0dXJuIGhhcmRlbih7IGVycm9ySWQsIG1lc3NhZ2UsIG5hbWUgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gaGFyZGVuKHsgbWVzc2FnZSwgbmFtZSB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGlmIChzZXJpYWxpemVCb2R5Rm9ybWF0ID09PSBcImNhcGRhdGFcIikge1xuICAgICAgY29uc3QgZW5jb2RlU2xvdFRvQ2FwRGF0YSA9IChwYXNzYWJsZSwgaWZhY2UgPSB2b2lkIDApID0+IHtcbiAgICAgICAgY29uc3QgeyBpbmRleCwgcmVwZWF0IH0gPSBlbmNvZGVTbG90Q29tbW9uKHBhc3NhYmxlKTtcbiAgICAgICAgaWYgKHJlcGVhdCA9PT0gdHJ1ZSB8fCBpZmFjZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IFtRQ0xBU1NdOiBcInNsb3RcIiwgaW5kZXggfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IFtRQ0xBU1NdOiBcInNsb3RcIiwgaWZhY2UsIGluZGV4IH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgY29uc3QgZW5jb2RlUmVtb3RhYmxlVG9DYXBEYXRhID0gKHZhbCwgX2VuY29kZVJlY3VyKSA9PiBlbmNvZGVTbG90VG9DYXBEYXRhKHZhbCwgZ2V0SW50ZXJmYWNlT2YodmFsKSk7XG4gICAgICBjb25zdCBlbmNvZGVQcm9taXNlVG9DYXBEYXRhID0gKHByb21pc2UsIF9lbmNvZGVSZWN1cikgPT4gZW5jb2RlU2xvdFRvQ2FwRGF0YShwcm9taXNlKTtcbiAgICAgIGNvbnN0IGVuY29kZUVycm9yVG9DYXBEYXRhID0gKGVyciwgZW5jb2RlUmVjdXIpID0+IHtcbiAgICAgICAgY29uc3QgZXJyRGF0YSA9IGVuY29kZUVycm9yQ29tbW9uKGVyciwgZW5jb2RlUmVjdXIpO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHsgW1FDTEFTU106IFwiZXJyb3JcIiwgLi4uZXJyRGF0YSB9KTtcbiAgICAgIH07XG4gICAgICBjb25zdCBlbmNvZGVUb0NhcERhdGEgPSBtYWtlRW5jb2RlVG9DYXBEYXRhKHtcbiAgICAgICAgZW5jb2RlUmVtb3RhYmxlVG9DYXBEYXRhLFxuICAgICAgICBlbmNvZGVQcm9taXNlVG9DYXBEYXRhLFxuICAgICAgICBlbmNvZGVFcnJvclRvQ2FwRGF0YVxuICAgICAgfSk7XG4gICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2RlVG9DYXBEYXRhKHJvb3QpO1xuICAgICAgY29uc3QgYm9keSA9IEpTT04uc3RyaW5naWZ5KGVuY29kZWQpO1xuICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgIGJvZHksXG4gICAgICAgIHNsb3RzXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHNlcmlhbGl6ZUJvZHlGb3JtYXQgPT09IFwic21hbGxjYXBzXCIpIHtcbiAgICAgIGNvbnN0IGVuY29kZVNsb3RUb1NtYWxsY2FwcyA9IChwcmVmaXgsIHBhc3NhYmxlLCBpZmFjZSA9IHZvaWQgMCkgPT4ge1xuICAgICAgICBjb25zdCB7IGluZGV4LCByZXBlYXQgfSA9IGVuY29kZVNsb3RDb21tb24ocGFzc2FibGUpO1xuICAgICAgICBpZiAocmVwZWF0ID09PSB0cnVlIHx8IGlmYWNlID09PSB2b2lkIDApIHtcbiAgICAgICAgICByZXR1cm4gYCR7cHJlZml4fSR7aW5kZXh9YDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYCR7cHJlZml4fSR7aW5kZXh9LiR7aWZhY2V9YDtcbiAgICAgIH07XG4gICAgICBjb25zdCBlbmNvZGVSZW1vdGFibGVUb1NtYWxsY2FwcyA9IChyZW1vdGFibGUsIF9lbmNvZGVSZWN1cikgPT4gZW5jb2RlU2xvdFRvU21hbGxjYXBzKFwiJFwiLCByZW1vdGFibGUsIGdldEludGVyZmFjZU9mKHJlbW90YWJsZSkpO1xuICAgICAgY29uc3QgZW5jb2RlUHJvbWlzZVRvU21hbGxjYXBzID0gKHByb21pc2UsIF9lbmNvZGVSZWN1cikgPT4gZW5jb2RlU2xvdFRvU21hbGxjYXBzKFwiJlwiLCBwcm9taXNlKTtcbiAgICAgIGNvbnN0IGVuY29kZUVycm9yVG9TbWFsbGNhcHMgPSAoZXJyLCBlbmNvZGVSZWN1cikgPT4ge1xuICAgICAgICBjb25zdCBlcnJEYXRhID0gZW5jb2RlRXJyb3JDb21tb24oZXJyLCBlbmNvZGVSZWN1cik7XG4gICAgICAgIGNvbnN0IHsgbWVzc2FnZSwgLi4ucmVzdCB9ID0gZXJyRGF0YTtcbiAgICAgICAgcmV0dXJuIGhhcmRlbih7IFwiI2Vycm9yXCI6IG1lc3NhZ2UsIC4uLnJlc3QgfSk7XG4gICAgICB9O1xuICAgICAgY29uc3QgZW5jb2RlVG9TbWFsbGNhcHMgPSBtYWtlRW5jb2RlVG9TbWFsbGNhcHMoe1xuICAgICAgICBlbmNvZGVSZW1vdGFibGVUb1NtYWxsY2FwcyxcbiAgICAgICAgZW5jb2RlUHJvbWlzZVRvU21hbGxjYXBzLFxuICAgICAgICBlbmNvZGVFcnJvclRvU21hbGxjYXBzXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGVuY29kZWQgPSBlbmNvZGVUb1NtYWxsY2Fwcyhyb290KTtcbiAgICAgIGNvbnN0IHNtYWxsY2Fwc0JvZHkgPSBKU09OLnN0cmluZ2lmeShlbmNvZGVkKTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAvL1xuICAgICAgICAvL1xuICAgICAgICBib2R5OiBgIyR7c21hbGxjYXBzQm9keX1gLFxuICAgICAgICBzbG90c1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgVW5yZWNvZ25pemVkIHNlcmlhbGl6ZUJvZHlGb3JtYXQ6ICR7cXVvdGUoc2VyaWFsaXplQm9keUZvcm1hdCl9YDtcbiAgICB9XG4gIH07XG4gIGNvbnN0IG1ha2VGdWxsUmV2aXZlID0gKHNsb3RzKSA9PiB7XG4gICAgY29uc3QgdmFsTWFwID0gLyogICAgICAgICAgICovIG5ldyBNYXAoKTtcbiAgICBjb25zdCBkZWNvZGVTbG90Q29tbW9uID0gKHNsb3REYXRhKSA9PiB7XG4gICAgICBjb25zdCB7IGlmYWNlID0gdm9pZCAwLCBpbmRleCwgLi4ucmVzdCB9ID0gc2xvdERhdGE7XG4gICAgICBvd25LZXlzMTMocmVzdCkubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBlbmNvZGVkIHNsb3QgcHJvcGVydGllcyAke3F1b3RlKG93bktleXMxMyhyZXN0KSl9YDtcbiAgICAgIGNvbnN0IGV4dGFudCA9IHZhbE1hcC5nZXQoaW5kZXgpO1xuICAgICAgaWYgKGV4dGFudCkge1xuICAgICAgICByZXR1cm4gZXh0YW50O1xuICAgICAgfVxuICAgICAgY29uc3Qgc2xvdCA9IHNsb3RzW051bWJlcihOYXQoaW5kZXgpKV07XG4gICAgICBjb25zdCB2YWwgPSBjb252ZXJ0U2xvdFRvVmFsKHNsb3QsIGlmYWNlKTtcbiAgICAgIHZhbE1hcC5zZXQoaW5kZXgsIHZhbCk7XG4gICAgICByZXR1cm4gdmFsO1xuICAgIH07XG4gICAgY29uc3QgZGVjb2RlRXJyb3JDb21tb24gPSAoZXJyRGF0YSwgZGVjb2RlUmVjdXIpID0+IHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgZXJyb3JJZCA9IHZvaWQgMCxcbiAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgbmFtZSxcbiAgICAgICAgY2F1c2UgPSB2b2lkIDAsXG4gICAgICAgIGVycm9ycyA9IHZvaWQgMCxcbiAgICAgICAgLi4ucmVzdFxuICAgICAgfSA9IGVyckRhdGE7XG4gICAgICBjb25zdCBkTmFtZSA9IGRlY29kZVJlY3VyKG5hbWUpO1xuICAgICAgY29uc3QgZE1lc3NhZ2UgPSBkZWNvZGVSZWN1cihtZXNzYWdlKTtcbiAgICAgIGNvbnN0IGRFcnJvcklkID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZXJyb3JJZCAmJiBkZWNvZGVSZWN1cihlcnJvcklkKVxuICAgICAgKTtcbiAgICAgIGlmICh0eXBlb2YgZE5hbWUgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIGVycm9yIG5hbWUgdHlwZW9mICR7cXVvdGUodHlwZW9mIGROYW1lKX1gO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGVvZiBkTWVzc2FnZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludmFsaWQgZXJyb3IgbWVzc2FnZSB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgZE1lc3NhZ2UpfWA7XG4gICAgICB9XG4gICAgICBjb25zdCBlcnJDb25zdHJ1Y3RvciA9IGdldEVycm9yQ29uc3RydWN0b3IoZE5hbWUpIHx8IEVycm9yO1xuICAgICAgY29uc3QgZXJyb3JOYW1lID0gZEVycm9ySWQgPT09IHZvaWQgMCA/IGBSZW1vdGUke2VyckNvbnN0cnVjdG9yLm5hbWV9YCA6IGBSZW1vdGUke2VyckNvbnN0cnVjdG9yLm5hbWV9KCR7ZEVycm9ySWR9KWA7XG4gICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICBlcnJvck5hbWUsXG4gICAgICAgIHNhbml0aXplOiBmYWxzZVxuICAgICAgfTtcbiAgICAgIGlmIChjYXVzZSkge1xuICAgICAgICBvcHRpb25zLmNhdXNlID0gZGVjb2RlUmVjdXIoY2F1c2UpO1xuICAgICAgfVxuICAgICAgaWYgKGVycm9ycykge1xuICAgICAgICBvcHRpb25zLmVycm9ycyA9IGRlY29kZVJlY3VyKGVycm9ycyk7XG4gICAgICB9XG4gICAgICBjb25zdCByYXdFcnJvciA9IG1ha2VFcnJvcihkTWVzc2FnZSwgZXJyQ29uc3RydWN0b3IsIG9wdGlvbnMpO1xuICAgICAgY29uc3QgZGVzY3MgPSBvYmplY3RNYXAocmVzdCwgKGRhdGEpID0+ICh7XG4gICAgICAgIHZhbHVlOiBkZWNvZGVSZWN1cihkYXRhKSxcbiAgICAgICAgd3JpdGFibGU6IGZhbHNlLFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZVxuICAgICAgfSkpO1xuICAgICAgZGVmaW5lUHJvcGVydGllczIocmF3RXJyb3IsIGRlc2NzKTtcbiAgICAgIGhhcmRlbihyYXdFcnJvcik7XG4gICAgICByZXR1cm4gdG9QYXNzYWJsZUVycm9yKHJhd0Vycm9yKTtcbiAgICB9O1xuICAgIGNvbnN0IGRlY29kZVJlbW90YWJsZU9yUHJvbWlzZUZyb21DYXBEYXRhID0gKHJhd1RyZWUsIF9kZWNvZGVSZWN1cikgPT4ge1xuICAgICAgY29uc3QgeyBbUUNMQVNTXTogXywgLi4uc2xvdERhdGEgfSA9IHJhd1RyZWU7XG4gICAgICByZXR1cm4gZGVjb2RlU2xvdENvbW1vbihzbG90RGF0YSk7XG4gICAgfTtcbiAgICBjb25zdCBkZWNvZGVFcnJvckZyb21DYXBEYXRhID0gKHJhd1RyZWUsIGRlY29kZVJlY3VyKSA9PiB7XG4gICAgICBjb25zdCB7IFtRQ0xBU1NdOiBfLCAuLi5lcnJEYXRhIH0gPSByYXdUcmVlO1xuICAgICAgcmV0dXJuIGRlY29kZUVycm9yQ29tbW9uKGVyckRhdGEsIGRlY29kZVJlY3VyKTtcbiAgICB9O1xuICAgIGNvbnN0IHJldml2ZUZyb21DYXBEYXRhID0gbWFrZURlY29kZUZyb21DYXBEYXRhKHtcbiAgICAgIGRlY29kZVJlbW90YWJsZUZyb21DYXBEYXRhOiBkZWNvZGVSZW1vdGFibGVPclByb21pc2VGcm9tQ2FwRGF0YSxcbiAgICAgIGRlY29kZVByb21pc2VGcm9tQ2FwRGF0YTogZGVjb2RlUmVtb3RhYmxlT3JQcm9taXNlRnJvbUNhcERhdGEsXG4gICAgICBkZWNvZGVFcnJvckZyb21DYXBEYXRhXG4gICAgfSk7XG4gICAgY29uc3QgbWFrZURlY29kZVNsb3RGcm9tU21hbGxjYXBzID0gKHByZWZpeCkgPT4ge1xuICAgICAgcmV0dXJuIChzdHJpbmdFbmNvZGluZywgX2RlY29kZVJlY3VyKSA9PiB7XG4gICAgICAgIGFzc2VydChzdHJpbmdFbmNvZGluZy5jaGFyQXQoMCkgPT09IHByZWZpeCk7XG4gICAgICAgIGNvbnN0IGkyID0gc3RyaW5nRW5jb2RpbmcuaW5kZXhPZihcIi5cIik7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gTnVtYmVyKHN0cmluZ0VuY29kaW5nLnNsaWNlKDEsIGkyIDwgMCA/IHZvaWQgMCA6IGkyKSk7XG4gICAgICAgIGNvbnN0IGlmYWNlID0gaTIgPCAwID8gdm9pZCAwIDogc3RyaW5nRW5jb2Rpbmcuc2xpY2UoaTIgKyAxKTtcbiAgICAgICAgcmV0dXJuIGRlY29kZVNsb3RDb21tb24oeyBpZmFjZSwgaW5kZXggfSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgY29uc3QgZGVjb2RlUmVtb3RhYmxlRnJvbVNtYWxsY2FwcyA9IG1ha2VEZWNvZGVTbG90RnJvbVNtYWxsY2FwcyhcIiRcIik7XG4gICAgY29uc3QgZGVjb2RlUHJvbWlzZUZyb21TbWFsbGNhcHMgPSBtYWtlRGVjb2RlU2xvdEZyb21TbWFsbGNhcHMoXCImXCIpO1xuICAgIGNvbnN0IGRlY29kZUVycm9yRnJvbVNtYWxsY2FwcyA9IChlbmNvZGluZywgZGVjb2RlUmVjdXIpID0+IHtcbiAgICAgIGNvbnN0IHsgXCIjZXJyb3JcIjogbWVzc2FnZSwgLi4ucmVzdEVyckRhdGEgfSA9IGVuY29kaW5nO1xuICAgICAgIWhhc093bjgocmVzdEVyckRhdGEsIFwibWVzc2FnZVwiKSB8fCB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgZW5jb2RlZCBlcnJvciBwcm9wZXJ0eSAke3F1b3RlKFwibWVzc2FnZVwiKX1gO1xuICAgICAgcmV0dXJuIGRlY29kZUVycm9yQ29tbW9uKHsgbWVzc2FnZSwgLi4ucmVzdEVyckRhdGEgfSwgZGVjb2RlUmVjdXIpO1xuICAgIH07XG4gICAgY29uc3QgcmV2aXZlRnJvbVNtYWxsY2FwcyA9IG1ha2VEZWNvZGVGcm9tU21hbGxjYXBzKHtcbiAgICAgIC8vXG4gICAgICBkZWNvZGVSZW1vdGFibGVGcm9tU21hbGxjYXBzLFxuICAgICAgLy9cbiAgICAgIGRlY29kZVByb21pc2VGcm9tU21hbGxjYXBzLFxuICAgICAgZGVjb2RlRXJyb3JGcm9tU21hbGxjYXBzXG4gICAgfSk7XG4gICAgcmV0dXJuIGhhcmRlbih7IHJldml2ZUZyb21DYXBEYXRhLCByZXZpdmVGcm9tU21hbGxjYXBzIH0pO1xuICB9O1xuICBjb25zdCBmcm9tQ2FwRGF0YSA9IChkYXRhKSA9PiB7XG4gICAgY29uc3QgeyBib2R5LCBzbG90cyB9ID0gZGF0YTtcbiAgICB0eXBlb2YgYm9keSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYHVuc2VyaWFsaXplKCkgZ2l2ZW4gbm9uLWNhcGRhdGEgKC5ib2R5IGlzICR7Ym9keX0sIG5vdCBzdHJpbmcpYDtcbiAgICBpc0FycmF5NihkYXRhLnNsb3RzKSB8fCB0aHJvd1JlZGFjdGVkYHVuc2VyaWFsaXplKCkgZ2l2ZW4gbm9uLWNhcGRhdGEgKC5zbG90cyBhcmUgbm90IEFycmF5KWA7XG4gICAgY29uc3QgeyByZXZpdmVGcm9tQ2FwRGF0YSwgcmV2aXZlRnJvbVNtYWxsY2FwcyB9ID0gbWFrZUZ1bGxSZXZpdmUoc2xvdHMpO1xuICAgIGxldCByZXN1bHQ7XG4gICAgaWYgKGJvZHkuY2hhckF0KDApID09PSBcIiNcIikge1xuICAgICAgY29uc3Qgc21hbGxjYXBzQm9keSA9IGJvZHkuc2xpY2UoMSk7XG4gICAgICBjb25zdCBlbmNvZGluZyA9IGhhcmRlbihKU09OLnBhcnNlKHNtYWxsY2Fwc0JvZHkpKTtcbiAgICAgIHJlc3VsdCA9IGhhcmRlbihyZXZpdmVGcm9tU21hbGxjYXBzKGVuY29kaW5nKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHJhd1RyZWUgPSBoYXJkZW4oSlNPTi5wYXJzZShib2R5KSk7XG4gICAgICByZXN1bHQgPSBoYXJkZW4ocmV2aXZlRnJvbUNhcERhdGEocmF3VHJlZSkpO1xuICAgIH1cbiAgICBhc3NlcnRQYXNzYWJsZShyZXN1bHQpO1xuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgcmVzdWx0XG4gICAgKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgdG9DYXBEYXRhOiB0b0NhcERhdGEyLFxuICAgIGZyb21DYXBEYXRhLFxuICAgIC8vXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBzZXJpYWxpemU6IHRvQ2FwRGF0YTIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHVuc2VyaWFsaXplOiBmcm9tQ2FwRGF0YVxuICB9KTtcbn07XG5cbi8vXG52YXIgeyBmcmVlemU6IGZyZWV6ZTYgfSA9IE9iamVjdDtcbnZhciBkb05vdENvbnZlcnRWYWxUb1Nsb3QgPSAodmFsKSA9PiB0aHJvd1JlZGFjdGVkYE1hcnNoYWwncyBzdHJpbmdpZnkgcmVqZWN0cyBwcmVzZW5jZXMgYW5kIHByb21pc2VzICR7dmFsfWA7XG52YXIgZG9Ob3RDb252ZXJ0U2xvdFRvVmFsID0gKHNsb3QsIF9pZmFjZSkgPT4gdGhyb3dSZWRhY3RlZGBNYXJzaGFsJ3MgcGFyc2UgbXVzdCBub3QgZW5jb2RlIGFueSBzbG90cyAke3Nsb3R9YDtcbnZhciBiYWRBcnJheUhhbmRsZXIgPSBoYXJkZW4oe1xuICBnZXQ6IChfdGFyZ2V0LCBuYW1lLCBfcmVjZWl2ZXIpID0+IHtcbiAgICBpZiAobmFtZSA9PT0gXCJsZW5ndGhcIikge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIHRocm93IHRocm93UmVkYWN0ZWRgTWFyc2hhbCdzIHBhcnNlIG11c3Qgbm90IGVuY29kZSBhbnkgc2xvdCBwb3NpdGlvbnMgJHtuYW1lfWA7XG4gIH1cbn0pO1xudmFyIGFycmF5VGFyZ2V0ID0gZnJlZXplNihcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgW11cbik7XG52YXIgYmFkQXJyYXkgPSBuZXcgUHJveHkoYXJyYXlUYXJnZXQsIGJhZEFycmF5SGFuZGxlcik7XG52YXIgeyBzZXJpYWxpemUsIHVuc2VyaWFsaXplIH0gPSBtYWtlTWFyc2hhbChcbiAgZG9Ob3RDb252ZXJ0VmFsVG9TbG90LFxuICBkb05vdENvbnZlcnRTbG90VG9WYWwsXG4gIHtcbiAgICBlcnJvclRhZ2dpbmc6IFwib2ZmXCIsXG4gICAgLy9cbiAgICBzZXJpYWxpemVCb2R5Rm9ybWF0OiBcImNhcGRhdGFcIlxuICB9XG4pO1xudmFyIHN0cmluZ2lmeSA9ICh2YWwpID0+IHNlcmlhbGl6ZSh2YWwpLmJvZHk7XG5oYXJkZW4oc3RyaW5naWZ5KTtcbnZhciBwYXJzZSA9IChzdHIpID0+IHVuc2VyaWFsaXplKFxuICAvL1xuICAvL1xuICAvL1xuICBmcmVlemU2KHtcbiAgICBib2R5OiBzdHIsXG4gICAgc2xvdHM6IGJhZEFycmF5XG4gIH0pXG4pO1xuaGFyZGVuKHBhcnNlKTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXMxNCB9ID0gUmVmbGVjdDtcbnZhciB7IGlzQXJyYXk6IGlzQXJyYXk3IH0gPSBBcnJheTtcbnZhciB7IHN0cmluZ2lmeTogcXVvdGUyIH0gPSBKU09OO1xudmFyIG1ha2VZZXNJbmRlbnRlciA9ICgpID0+IHtcbiAgY29uc3Qgc3RyaW5ncyA9IFtdO1xuICBsZXQgbGV2ZWwgPSAwO1xuICBsZXQgbmVlZFNwYWNlID0gZmFsc2U7XG4gIGNvbnN0IGxpbmUgPSAoKSA9PiB7XG4gICAgbmVlZFNwYWNlID0gZmFsc2U7XG4gICAgcmV0dXJuIHN0cmluZ3MucHVzaChcIlxcblwiLCBcIiAgXCIucmVwZWF0KGxldmVsKSk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIG9wZW46IChvcGVuQnJhY2tldCkgPT4ge1xuICAgICAgbGV2ZWwgKz0gMTtcbiAgICAgIGlmIChuZWVkU3BhY2UpIHtcbiAgICAgICAgc3RyaW5ncy5wdXNoKFwiIFwiKTtcbiAgICAgIH1cbiAgICAgIG5lZWRTcGFjZSA9IGZhbHNlO1xuICAgICAgcmV0dXJuIHN0cmluZ3MucHVzaChvcGVuQnJhY2tldCk7XG4gICAgfSxcbiAgICBsaW5lLFxuICAgIG5leHQ6ICh0b2tlbikgPT4ge1xuICAgICAgaWYgKG5lZWRTcGFjZSAmJiB0b2tlbiAhPT0gXCIsXCIgJiYgdG9rZW4gIT09IFwiKVwiKSB7XG4gICAgICAgIHN0cmluZ3MucHVzaChcIiBcIik7XG4gICAgICB9XG4gICAgICBuZWVkU3BhY2UgPSB0cnVlO1xuICAgICAgcmV0dXJuIHN0cmluZ3MucHVzaCh0b2tlbik7XG4gICAgfSxcbiAgICBjbG9zZTogKGNsb3NlQnJhY2tldCkgPT4ge1xuICAgICAgYXNzZXJ0KGxldmVsID49IDEpO1xuICAgICAgbGV2ZWwgLT0gMTtcbiAgICAgIGxpbmUoKTtcbiAgICAgIHJldHVybiBzdHJpbmdzLnB1c2goY2xvc2VCcmFja2V0KTtcbiAgICB9LFxuICAgIGRvbmU6ICgpID0+IHtcbiAgICAgIGFzc2VydC5lcXVhbChsZXZlbCwgMCk7XG4gICAgICByZXR1cm4gc3RyaW5ncy5qb2luKFwiXCIpO1xuICAgIH1cbiAgfSk7XG59O1xudmFyIGJhZFBhaXJQYXR0ZXJuID0gL14oPzpcXHdcXHd8PDx8Pj58XFwrXFwrfC0tfDwhfC0+KSQvO1xudmFyIG1ha2VOb0luZGVudGVyID0gKCkgPT4ge1xuICBjb25zdCBzdHJpbmdzID0gW107XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIG9wZW46IChvcGVuQnJhY2tldCkgPT4gc3RyaW5ncy5wdXNoKG9wZW5CcmFja2V0KSxcbiAgICBsaW5lOiAoKSA9PiBzdHJpbmdzLmxlbmd0aCxcbiAgICBuZXh0OiAodG9rZW4pID0+IHtcbiAgICAgIGlmIChzdHJpbmdzLmxlbmd0aCA+PSAxKSB7XG4gICAgICAgIGNvbnN0IGxhc3QgPSBzdHJpbmdzW3N0cmluZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgIGlmIChsYXN0Lmxlbmd0aCA+PSAxICYmIHRva2VuLmxlbmd0aCA+PSAxKSB7XG4gICAgICAgICAgY29uc3QgcGFpciA9IGAke2xhc3RbbGFzdC5sZW5ndGggLSAxXX0ke3Rva2VuWzBdfWA7XG4gICAgICAgICAgaWYgKGJhZFBhaXJQYXR0ZXJuLnRlc3QocGFpcikpIHtcbiAgICAgICAgICAgIHN0cmluZ3MucHVzaChcIiBcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RyaW5ncy5wdXNoKHRva2VuKTtcbiAgICB9LFxuICAgIGNsb3NlOiAoY2xvc2VCcmFja2V0KSA9PiB7XG4gICAgICBpZiAoc3RyaW5ncy5sZW5ndGggPj0gMSAmJiBzdHJpbmdzW3N0cmluZ3MubGVuZ3RoIC0gMV0gPT09IFwiLFwiKSB7XG4gICAgICAgIHN0cmluZ3MucG9wKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RyaW5ncy5wdXNoKGNsb3NlQnJhY2tldCk7XG4gICAgfSxcbiAgICBkb25lOiAoKSA9PiBzdHJpbmdzLmpvaW4oXCJcIilcbiAgfSk7XG59O1xudmFyIGlkZW50UGF0dGVybiA9IC9eW2EtekEtWl1cXHcqJC87XG5oYXJkZW4oaWRlbnRQYXR0ZXJuKTtcbnZhciBBdEF0UHJlZml4UGF0dGVybjIgPSAvXkBAKC4qKSQvO1xuaGFyZGVuKEF0QXRQcmVmaXhQYXR0ZXJuMik7XG52YXIgZGVjb2RlVG9KdXN0aW4gPSAoZW5jb2RpbmcsIHNob3VsZEluZGVudCA9IGZhbHNlLCBzbG90cyA9IFtdKSA9PiB7XG4gIGNvbnN0IHByZXBhcmUgPSAocmF3VHJlZSkgPT4ge1xuICAgIGlmIChpc1ByaW1pdGl2ZTIocmF3VHJlZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYXNzZXJ0LnR5cGVvZihyYXdUcmVlLCBcIm9iamVjdFwiKTtcbiAgICBhc3NlcnQocmF3VHJlZSAhPT0gbnVsbCk7XG4gICAgaWYgKFFDTEFTUyBpbiByYXdUcmVlKSB7XG4gICAgICBjb25zdCBxY2xhc3MgPSByYXdUcmVlW1FDTEFTU107XG4gICAgICB0eXBlb2YgcWNsYXNzID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgaW52YWxpZCBxY2xhc3MgdHlwZW9mICR7cXVvdGUodHlwZW9mIHFjbGFzcyl9YDtcbiAgICAgIGFzc2VydCghaXNBcnJheTcocmF3VHJlZSkpO1xuICAgICAgc3dpdGNoIChyYXdUcmVlW1wiQHFjbGFzc1wiXSkge1xuICAgICAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgICAgIGNhc2UgXCJOYU5cIjpcbiAgICAgICAgY2FzZSBcIkluZmluaXR5XCI6XG4gICAgICAgIGNhc2UgXCItSW5maW5pdHlcIjoge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgICBjb25zdCB7IGRpZ2l0cyB9ID0gcmF3VHJlZTtcbiAgICAgICAgICB0eXBlb2YgZGlnaXRzID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgaW52YWxpZCBkaWdpdHMgdHlwZW9mICR7cXVvdGUodHlwZW9mIGRpZ2l0cyl9YDtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcIkBAYXN5bmNJdGVyYXRvclwiOiB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJzeW1ib2xcIjoge1xuICAgICAgICAgIGNvbnN0IHsgbmFtZSB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKG5hbWUsIFwic3RyaW5nXCIpO1xuICAgICAgICAgIGNvbnN0IHN5bSA9IHBhc3NhYmxlU3ltYm9sRm9yTmFtZShuYW1lKTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKHN5bSwgXCJzeW1ib2xcIik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICAgIGNvbnN0IHsgdGFnLCBwYXlsb2FkIH0gPSByYXdUcmVlO1xuICAgICAgICAgIGFzc2VydC50eXBlb2YodGFnLCBcInN0cmluZ1wiKTtcbiAgICAgICAgICBwcmVwYXJlKHBheWxvYWQpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwic2xvdFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBpbmRleCwgaWZhY2UgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgYXNzZXJ0LnR5cGVvZihpbmRleCwgXCJudW1iZXJcIik7XG4gICAgICAgICAgTmF0KGluZGV4KTtcbiAgICAgICAgICBpZiAoaWZhY2UgIT09IHZvaWQgMCkge1xuICAgICAgICAgICAgYXNzZXJ0LnR5cGVvZihpZmFjZSwgXCJzdHJpbmdcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiaGlsYmVydFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBvcmlnaW5hbCwgcmVzdCB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBcIm9yaWdpbmFsXCIgaW4gcmF3VHJlZSB8fCB0aHJvd1JlZGFjdGVkYEludmFsaWQgSGlsYmVydCBIb3RlbCBlbmNvZGluZyAke3Jhd1RyZWV9YDtcbiAgICAgICAgICBwcmVwYXJlKG9yaWdpbmFsKTtcbiAgICAgICAgICBpZiAoXCJyZXN0XCIgaW4gcmF3VHJlZSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiByZXN0ICE9PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdCAke3Jlc3R9IGVuY29kaW5nIG11c3QgYmUgYW4gb2JqZWN0YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXN0ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdCAke3Jlc3R9IGVuY29kaW5nIG11c3Qgbm90IGJlIG51bGxgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzQXJyYXk3KHJlc3QpKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdCAke3Jlc3R9IGVuY29kaW5nIG11c3Qgbm90IGJlIGFuIGFycmF5YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChRQ0xBU1MgaW4gcmVzdCkge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3QgZW5jb2RpbmcgJHtyZXN0fSBtdXN0IG5vdCBjb250YWluICR7cXVvdGUoUUNMQVNTKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbmFtZXMgPSBvd25LZXlzMTQocmVzdCk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpIHtcbiAgICAgICAgICAgICAgdHlwZW9mIG5hbWUgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBQcm9wZXJ0eSBuYW1lICR7bmFtZX0gb2YgJHtyYXdUcmVlfSBtdXN0IGJlIGEgc3RyaW5nYDtcbiAgICAgICAgICAgICAgcHJlcGFyZShyZXN0W25hbWVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgICAgY29uc3QgeyBuYW1lLCBtZXNzYWdlIH0gPSByYXdUcmVlO1xuICAgICAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIGVycm9yIG5hbWUgdHlwZW9mICR7cXVvdGUodHlwZW9mIG5hbWUpfWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGdldEVycm9yQ29uc3RydWN0b3IobmFtZSkgIT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYE11c3QgYmUgdGhlIG5hbWUgb2YgYW4gRXJyb3IgY29uc3RydWN0b3IgJHtuYW1lfWA7XG4gICAgICAgICAgdHlwZW9mIG1lc3NhZ2UgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIGVycm9yIG1lc3NhZ2UgdHlwZW9mICR7cXVvdGUodHlwZW9mIG1lc3NhZ2UpfWA7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICBhc3NlcnQuZmFpbChyZWRhY3RlZGB1bnJlY29nbml6ZWQgJHtxdW90ZShRQ0xBU1MpfSAke3F1b3RlKHFjbGFzcyl9YCwgVHlwZUVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoaXNBcnJheTcocmF3VHJlZSkpIHtcbiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSByYXdUcmVlO1xuICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGxlbmd0aDsgaTIgKz0gMSkge1xuICAgICAgICBwcmVwYXJlKHJhd1RyZWVbaTJdKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgbmFtZXMgPSBvd25LZXlzMTQocmF3VHJlZSk7XG4gICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBuYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBQcm9wZXJ0eSBuYW1lICR7bmFtZX0gb2YgJHtyYXdUcmVlfSBtdXN0IGJlIGEgc3RyaW5nYDtcbiAgICAgICAgfVxuICAgICAgICBwcmVwYXJlKHJhd1RyZWVbbmFtZV0pO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgbWFrZUluZGVudGVyID0gc2hvdWxkSW5kZW50ID8gbWFrZVllc0luZGVudGVyIDogbWFrZU5vSW5kZW50ZXI7XG4gIGxldCBvdXQgPSBtYWtlSW5kZW50ZXIoKTtcbiAgY29uc3QgZGVjb2RlID0gKHJhd1RyZWUpID0+IHtcbiAgICByZXR1cm4gcmVjdXIocmF3VHJlZSk7XG4gIH07XG4gIGNvbnN0IGRlY29kZVByb3BlcnR5ID0gKG5hbWUsIHZhbHVlKSA9PiB7XG4gICAgb3V0LmxpbmUoKTtcbiAgICBpZiAobmFtZSA9PT0gXCJfX3Byb3RvX19cIikge1xuICAgICAgb3V0Lm5leHQoYFtcIl9fcHJvdG9fX1wiXTpgKTtcbiAgICB9IGVsc2UgaWYgKGlkZW50UGF0dGVybi50ZXN0KG5hbWUpKSB7XG4gICAgICBvdXQubmV4dChgJHtuYW1lfTpgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb3V0Lm5leHQoYCR7cXVvdGUyKG5hbWUpfTpgKTtcbiAgICB9XG4gICAgZGVjb2RlKHZhbHVlKTtcbiAgICBvdXQubmV4dChcIixcIik7XG4gIH07XG4gIGNvbnN0IHJlY3VyID0gKHJhd1RyZWUpID0+IHtcbiAgICBpZiAoaXNQcmltaXRpdmUyKHJhd1RyZWUpKSB7XG4gICAgICByZXR1cm4gb3V0Lm5leHQocXVvdGUyKHJhd1RyZWUpKTtcbiAgICB9XG4gICAgYXNzZXJ0LnR5cGVvZihyYXdUcmVlLCBcIm9iamVjdFwiKTtcbiAgICBhc3NlcnQocmF3VHJlZSAhPT0gbnVsbCk7XG4gICAgaWYgKFFDTEFTUyBpbiByYXdUcmVlKSB7XG4gICAgICBjb25zdCBxY2xhc3MgPSByYXdUcmVlW1FDTEFTU107XG4gICAgICBhc3NlcnQudHlwZW9mKHFjbGFzcywgXCJzdHJpbmdcIik7XG4gICAgICBhc3NlcnQoIWlzQXJyYXk3KHJhd1RyZWUpKTtcbiAgICAgIHN3aXRjaCAocmF3VHJlZVtcIkBxY2xhc3NcIl0pIHtcbiAgICAgICAgLy9cbiAgICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgICAgICBjYXNlIFwiTmFOXCI6XG4gICAgICAgIGNhc2UgXCJJbmZpbml0eVwiOlxuICAgICAgICBjYXNlIFwiLUluZmluaXR5XCI6IHtcbiAgICAgICAgICByZXR1cm4gb3V0Lm5leHQocWNsYXNzKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgICBjb25zdCB7IGRpZ2l0cyB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKGRpZ2l0cywgXCJzdHJpbmdcIik7XG4gICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGAke0JpZ0ludChkaWdpdHMpfW5gKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiQEBhc3luY0l0ZXJhdG9yXCI6IHtcbiAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoXCJTeW1ib2wuYXN5bmNJdGVyYXRvclwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgICBjb25zdCB7IG5hbWUgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgYXNzZXJ0LnR5cGVvZihuYW1lLCBcInN0cmluZ1wiKTtcbiAgICAgICAgICBjb25zdCBzeW0gPSBwYXNzYWJsZVN5bWJvbEZvck5hbWUobmFtZSk7XG4gICAgICAgICAgYXNzZXJ0LnR5cGVvZihzeW0sIFwic3ltYm9sXCIpO1xuICAgICAgICAgIGNvbnN0IHJlZ2lzdGVyZWROYW1lID0gbmFtZUZvclBhc3NhYmxlU3ltYm9sKHN5bSk7XG4gICAgICAgICAgaWYgKHJlZ2lzdGVyZWROYW1lID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gQXRBdFByZWZpeFBhdHRlcm4yLmV4ZWMobmFtZSk7XG4gICAgICAgICAgICBhc3NlcnQobWF0Y2ggIT09IG51bGwpO1xuICAgICAgICAgICAgY29uc3Qgc3VmZml4ID0gbWF0Y2hbMV07XG4gICAgICAgICAgICBhc3NlcnQoU3ltYm9sW3N1ZmZpeF0gPT09IHN5bSk7XG4gICAgICAgICAgICBhc3NlcnQoaWRlbnRQYXR0ZXJuLnRlc3Qoc3VmZml4KSk7XG4gICAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoYFN5bWJvbC4ke3N1ZmZpeH1gKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGBwYXNzYWJsZVN5bWJvbEZvck5hbWUoJHtxdW90ZTIocmVnaXN0ZXJlZE5hbWUpfSlgKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgICBjb25zdCB7IHRhZywgcGF5bG9hZCB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBvdXQubmV4dChgbWFrZVRhZ2dlZCgke3F1b3RlMih0YWcpfWApO1xuICAgICAgICAgIG91dC5uZXh0KFwiLFwiKTtcbiAgICAgICAgICBkZWNvZGUocGF5bG9hZCk7XG4gICAgICAgICAgcmV0dXJuIG91dC5uZXh0KFwiKVwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwic2xvdFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBpZmFjZSB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBjb25zdCBpbmRleCA9IE51bWJlcihOYXQocmF3VHJlZS5pbmRleCkpO1xuICAgICAgICAgIGNvbnN0IG5lc3RlZFJlbmRlciA9IChhcmcpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9sZE91dCA9IG91dDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIG91dCA9IG1ha2VOb0luZGVudGVyKCk7XG4gICAgICAgICAgICAgIGRlY29kZShhcmcpO1xuICAgICAgICAgICAgICByZXR1cm4gb3V0LmRvbmUoKTtcbiAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgIG91dCA9IG9sZE91dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICAgIGlmIChpbmRleCA8IHNsb3RzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgcmVuZGVyZWRTbG90ID0gbmVzdGVkUmVuZGVyKHNsb3RzW2luZGV4XSk7XG4gICAgICAgICAgICByZXR1cm4gaWZhY2UgPT09IHZvaWQgMCA/IG91dC5uZXh0KGBzbG90VG9WYWwoJHtyZW5kZXJlZFNsb3R9KWApIDogb3V0Lm5leHQoYHNsb3RUb1ZhbCgke3JlbmRlcmVkU2xvdH0sJHtuZXN0ZWRSZW5kZXIoaWZhY2UpfSlgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGlmYWNlID09PSB2b2lkIDAgPyBvdXQubmV4dChgc2xvdCgke2luZGV4fSlgKSA6IG91dC5uZXh0KGBzbG90KCR7aW5kZXh9LCR7bmVzdGVkUmVuZGVyKGlmYWNlKX0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImhpbGJlcnRcIjoge1xuICAgICAgICAgIGNvbnN0IHsgb3JpZ2luYWwsIHJlc3QgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgb3V0Lm9wZW4oXCJ7XCIpO1xuICAgICAgICAgIGRlY29kZVByb3BlcnR5KFFDTEFTUywgb3JpZ2luYWwpO1xuICAgICAgICAgIGlmIChcInJlc3RcIiBpbiByYXdUcmVlKSB7XG4gICAgICAgICAgICBhc3NlcnQudHlwZW9mKHJlc3QsIFwib2JqZWN0XCIpO1xuICAgICAgICAgICAgYXNzZXJ0KHJlc3QgIT09IG51bGwpO1xuICAgICAgICAgICAgY29uc3QgbmFtZXMgPSBvd25LZXlzMTQocmVzdCk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpIHtcbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBuYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBQcm9wZXJ0eSBuYW1lICR7cXVvdGUoXG4gICAgICAgICAgICAgICAgICBuYW1lXG4gICAgICAgICAgICAgICAgKX0gb2YgJHtyZXN0fSBtdXN0IGJlIGEgc3RyaW5nYDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBkZWNvZGVQcm9wZXJ0eShuYW1lLCByZXN0W25hbWVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG91dC5jbG9zZShcIn1cIik7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgIGNhdXNlID0gdm9pZCAwLFxuICAgICAgICAgICAgZXJyb3JzID0gdm9pZCAwXG4gICAgICAgICAgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgY2F1c2UgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYGVycm9yIGNhdXNlIG5vdCB5ZXQgaW1wbGVtZW50ZWQgaW4gbWFyc2hhbC1qdXN0aW5gO1xuICAgICAgICAgIG5hbWUgIT09IGBBZ2dyZWdhdGVFcnJvcmAgfHwgdGhyb3dSZWRhY3RlZGBBZ2dyZWdhdGVFcnJvciBub3QgeWV0IGltcGxlbWVudGVkIGluIG1hcnNoYWwtanVzdGluYDtcbiAgICAgICAgICBlcnJvcnMgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYGVycm9yIGVycm9ycyBub3QgeWV0IGltcGxlbWVudGVkIGluIG1hcnNoYWwtanVzdGluYDtcbiAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoYCR7bmFtZX0oJHtxdW90ZTIobWVzc2FnZSl9KWApO1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICB0aHJvdyBhc3NlcnQuZmFpbChcbiAgICAgICAgICAgIHJlZGFjdGVkYHVucmVjb2duaXplZCAke3F1b3RlKFFDTEFTUyl9ICR7cXVvdGUocWNsYXNzKX1gLFxuICAgICAgICAgICAgVHlwZUVycm9yXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoaXNBcnJheTcocmF3VHJlZSkpIHtcbiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSByYXdUcmVlO1xuICAgICAgaWYgKGxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gb3V0Lm5leHQoXCJbXVwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG91dC5vcGVuKFwiW1wiKTtcbiAgICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGxlbmd0aDsgaTIgKz0gMSkge1xuICAgICAgICAgIG91dC5saW5lKCk7XG4gICAgICAgICAgZGVjb2RlKHJhd1RyZWVbaTJdKTtcbiAgICAgICAgICBvdXQubmV4dChcIixcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dC5jbG9zZShcIl1cIik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG5hbWVzID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBvd25LZXlzMTQocmF3VHJlZSlcbiAgICAgICk7XG4gICAgICBpZiAobmFtZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBvdXQubmV4dChcInt9XCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3V0Lm9wZW4oXCJ7XCIpO1xuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpIHtcbiAgICAgICAgICBkZWNvZGVQcm9wZXJ0eShuYW1lLCByYXdUcmVlW25hbWVdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0LmNsb3NlKFwifVwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHByZXBhcmUoZW5jb2RpbmcpO1xuICBkZWNvZGUoZW5jb2RpbmcpO1xuICByZXR1cm4gb3V0LmRvbmUoKTtcbn07XG5oYXJkZW4oZGVjb2RlVG9KdXN0aW4pO1xudmFyIHBhc3NhYmxlQXNKdXN0aW4gPSAocGFzc2FibGUsIHNob3VsZEluZGVudCA9IHRydWUpID0+IHtcbiAgbGV0IHNsb3RDb3VudCA9IDA7XG4gIGNvbnN0IGNvbnZlcnRWYWxUb1Nsb3QgPSAodmFsKSA9PiBgcyR7c2xvdENvdW50Kyt9YDtcbiAgY29uc3QgeyB0b0NhcERhdGE6IHRvQ2FwRGF0YTIgfSA9IG1ha2VNYXJzaGFsKGNvbnZlcnRWYWxUb1Nsb3QpO1xuICBjb25zdCB7IGJvZHksIHNsb3RzIH0gPSB0b0NhcERhdGEyKHBhc3NhYmxlKTtcbiAgY29uc3QgZW5jb2RlZCA9IEpTT04ucGFyc2UoYm9keSk7XG4gIHJldHVybiBkZWNvZGVUb0p1c3RpbihlbmNvZGVkLCBzaG91bGRJbmRlbnQsIHNsb3RzKTtcbn07XG5oYXJkZW4ocGFzc2FibGVBc0p1c3Rpbik7XG52YXIgcXAgPSAocGF5bG9hZCkgPT4gYFxcYCR7cGFzc2FibGVBc0p1c3RpbihoYXJkZW4ocGF5bG9hZCksIHRydWUpfVxcYGA7XG5oYXJkZW4ocXApO1xuXG4vL1xudmFyIHsgaXNBcnJheTogaXNBcnJheTggfSA9IEFycmF5O1xudmFyIHsgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzNSwgaXM6IGlzMyB9ID0gT2JqZWN0O1xudmFyIHsgb3duS2V5czogb3duS2V5czE1IH0gPSBSZWZsZWN0O1xudmFyIHJDMCA9IC9bXFx4MDAtXFx4MUZdLztcbnZhciBnZXRTdWZmaXggPSAoc3RyLCBpbmRleCkgPT4gaW5kZXggPT09IDAgPyBzdHIgOiBzdHIuc3Vic3RyaW5nKGluZGV4KTtcbnZhciByZWNvcmROYW1lcyA9IChyZWNvcmQpID0+IChcbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgaGFyZGVuKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgb3duS2V5czE1KHJlY29yZCkuc29ydCgpLnJldmVyc2UoKVxuICApXG4pO1xuaGFyZGVuKHJlY29yZE5hbWVzKTtcbnZhciByZWNvcmRWYWx1ZXMgPSAocmVjb3JkLCBuYW1lcykgPT4gaGFyZGVuKG5hbWVzLm1hcCgobmFtZSkgPT4gcmVjb3JkW25hbWVdKSk7XG5oYXJkZW4ocmVjb3JkVmFsdWVzKTtcbnZhciB6ZXJvZXMgPSBBcnJheSgxNikuZmlsbCh2b2lkIDApLm1hcCgoXywgaTIpID0+IFwiMFwiLnJlcGVhdChpMikpO1xudmFyIHplcm9QYWQgPSAobjIsIHNpemUpID0+IHtcbiAgY29uc3QgblN0ciA9IGAke24yfWA7XG4gIGNvbnN0IGZpbGxMZW4gPSBzaXplIC0gblN0ci5sZW5ndGg7XG4gIGlmIChmaWxsTGVuID09PSAwKSByZXR1cm4gblN0cjtcbiAgYXNzZXJ0KGZpbGxMZW4gPiAwICYmIGZpbGxMZW4gPCB6ZXJvZXMubGVuZ3RoKTtcbiAgcmV0dXJuIGAke3plcm9lc1tmaWxsTGVuXX0ke25TdHJ9YDtcbn07XG5oYXJkZW4oemVyb1BhZCk7XG52YXIgYXNOdW1iZXIgPSBuZXcgRmxvYXQ2NEFycmF5KDEpO1xudmFyIGFzQml0cyA9IG5ldyBCaWdVaW50NjRBcnJheShhc051bWJlci5idWZmZXIpO1xudmFyIENhbm9uaWNhbE5hTkJpdHMgPSBcImZmZjgwMDAwMDAwMDAwMDBcIjtcbnZhciBlbmNvZGVCaW5hcnk2NCA9IChuMikgPT4ge1xuICBpZiAoaXMzKG4yLCAtMCkpIHtcbiAgICBuMiA9IDA7XG4gIH0gZWxzZSBpZiAoaXMzKG4yLCBOYU4pKSB7XG4gICAgcmV0dXJuIGBmJHtDYW5vbmljYWxOYU5CaXRzfWA7XG4gIH1cbiAgYXNOdW1iZXJbMF0gPSBuMjtcbiAgbGV0IGJpdHMgPSBhc0JpdHNbMF07XG4gIGlmIChuMiA8IDApIHtcbiAgICBiaXRzIF49IDB4ZmZmZmZmZmZmZmZmZmZmZm47XG4gIH0gZWxzZSB7XG4gICAgYml0cyBePSAweDgwMDAwMDAwMDAwMDAwMDBuO1xuICB9XG4gIHJldHVybiBgZiR7emVyb1BhZChiaXRzLnRvU3RyaW5nKDE2KSwgMTYpfWA7XG59O1xudmFyIGRlY29kZUJpbmFyeTY0ID0gKGVuY29kZWQsIHNraXAgPSAwKSA9PiB7XG4gIGVuY29kZWQuY2hhckF0KHNraXApID09PSBcImZcIiB8fCB0aHJvd1JlZGFjdGVkYEVuY29kZWQgbnVtYmVyIGV4cGVjdGVkOiAke2VuY29kZWR9YDtcbiAgbGV0IGJpdHMgPSBCaWdJbnQoYDB4JHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCArIDEpfWApO1xuICBpZiAoZW5jb2RlZC5jaGFyQXQoc2tpcCArIDEpIDwgXCI4XCIpIHtcbiAgICBiaXRzIF49IDB4ZmZmZmZmZmZmZmZmZmZmZm47XG4gIH0gZWxzZSB7XG4gICAgYml0cyBePSAweDgwMDAwMDAwMDAwMDAwMDBuO1xuICB9XG4gIGFzQml0c1swXSA9IGJpdHM7XG4gIGNvbnN0IHJlc3VsdCA9IGFzTnVtYmVyWzBdO1xuICAhaXMzKHJlc3VsdCwgLTApIHx8IHRocm93UmVkYWN0ZWRgVW5leHBlY3RlZCBuZWdhdGl2ZSB6ZXJvOiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBlbmNvZGVCaWdJbnQgPSAobjIpID0+IHtcbiAgY29uc3QgYWJzID0gbjIgPCAwbiA/IC1uMiA6IG4yO1xuICBjb25zdCBuRGlnaXRzID0gYWJzLnRvU3RyaW5nKCkubGVuZ3RoO1xuICBjb25zdCBsRGlnaXRzID0gbkRpZ2l0cy50b1N0cmluZygpLmxlbmd0aDtcbiAgaWYgKG4yIDwgMG4pIHtcbiAgICByZXR1cm4gYG4key8vXG4gICAgLy9cbiAgICBcIiNcIi5yZXBlYXQobERpZ2l0cyAtIDEpfSR7Ly9cbiAgICAoMTAgKiogbERpZ2l0cyAtIG5EaWdpdHMpLnRvU3RyaW5nKCkucGFkU3RhcnQobERpZ2l0cywgXCIwXCIpfTokey8vXG4gICAgKDEwbiAqKiBCaWdJbnQobkRpZ2l0cykgKyBuMikudG9TdHJpbmcoKS5wYWRTdGFydChuRGlnaXRzLCBcIjBcIil9YDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYHAkey8vXG4gICAgLy9cbiAgICBcIn5cIi5yZXBlYXQobERpZ2l0cyAtIDEpfSR7Ly9cbiAgICBuRGlnaXRzfTokey8vXG4gICAgbjJ9YDtcbiAgfVxufTtcbnZhciByQmlnSW50UGF5bG9hZCA9IC8oWzAtOV0rKSg6KFswLTldKyR8KXwpL3M7XG52YXIgZGVjb2RlQmlnSW50ID0gKGVuY29kZWQpID0+IHtcbiAgY29uc3QgdHlwZVByZWZpeCA9IGVuY29kZWQuY2hhckF0KDApO1xuICB0eXBlUHJlZml4ID09PSBcInBcIiB8fCB0eXBlUHJlZml4ID09PSBcIm5cIiB8fCB0aHJvd1JlZGFjdGVkYEVuY29kZWQgYmlnaW50IGV4cGVjdGVkOiAke2VuY29kZWR9YDtcbiAgY29uc3Qge1xuICAgIGluZGV4OiBsRGlnaXRzLFxuICAgIDE6IHNuRGlnaXRzLFxuICAgIDI6IHRhaWwsXG4gICAgMzogZGlnaXRzXG4gIH0gPSBlbmNvZGVkLm1hdGNoKHJCaWdJbnRQYXlsb2FkKSB8fCB0aHJvd1JlZGFjdGVkYERpZ2l0IGNvdW50IGV4cGVjdGVkOiAke2VuY29kZWR9YDtcbiAgc25EaWdpdHMubGVuZ3RoID09PSBsRGlnaXRzIHx8IHRocm93UmVkYWN0ZWRgVW5hcnktcHJlZml4ZWQgZGVjaW1hbCBkaWdpdCBjb3VudCBleHBlY3RlZDogJHtlbmNvZGVkfWA7XG4gIGxldCBuRGlnaXRzID0gcGFyc2VJbnQoc25EaWdpdHMsIDEwKTtcbiAgaWYgKHR5cGVQcmVmaXggPT09IFwiblwiKSB7XG4gICAgbkRpZ2l0cyA9IDEwICoqIC8qICAgICAgICAgICAgICAgICAqL1xuICAgIGxEaWdpdHMgLSBuRGlnaXRzO1xuICB9XG4gIHRhaWwuY2hhckF0KDApID09PSBcIjpcIiB8fCB0aHJvd1JlZGFjdGVkYFNlcGFyYXRvciBleHBlY3RlZDogJHtlbmNvZGVkfWA7XG4gIGRpZ2l0cy5sZW5ndGggPT09IG5EaWdpdHMgfHwgdGhyb3dSZWRhY3RlZGBGaXhlZC1sZW5ndGggZGlnaXQgc2VxdWVuY2UgZXhwZWN0ZWQ6ICR7ZW5jb2RlZH1gO1xuICBsZXQgbjIgPSBCaWdJbnQoZGlnaXRzKTtcbiAgaWYgKHR5cGVQcmVmaXggPT09IFwiblwiKSB7XG4gICAgbjIgPSAtKDEwbiAqKiBCaWdJbnQobkRpZ2l0cykgLSBuMik7XG4gIH1cbiAgcmV0dXJuIG4yO1xufTtcbnZhciBzdHJpbmdFc2NhcGVzID0gQXJyYXkoMzQpLmZpbGwodm9pZCAwKS5tYXAoKF8sIGNwKSA9PiB7XG4gIHN3aXRjaCAoU3RyaW5nLmZyb21DaGFyQ29kZShjcCkpIHtcbiAgICBjYXNlIFwiIFwiOlxuICAgICAgcmV0dXJuIFwiIV9cIjtcbiAgICBjYXNlIFwiIVwiOlxuICAgICAgcmV0dXJuIFwiIXxcIjtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIGAhJHtTdHJpbmcuZnJvbUNoYXJDb2RlKGNwICsgMzMpfWA7XG4gIH1cbn0pO1xuc3RyaW5nRXNjYXBlc1tcIl5cIi5jaGFyQ29kZUF0KDApXSA9IFwiX0BcIjtcbnN0cmluZ0VzY2FwZXNbXCJfXCIuY2hhckNvZGVBdCgwKV0gPSBcIl9fXCI7XG52YXIgZW5jb2RlQ29tcGFjdFN0cmluZ1N1ZmZpeCA9IChzdHIpID0+IHN0ci5yZXBsYWNlKC9bXFwwLSFeX10vZywgKGNoKSA9PiBzdHJpbmdFc2NhcGVzW2NoLmNoYXJDb2RlQXQoMCldKTtcbnZhciBkZWNvZGVDb21wYWN0U3RyaW5nU3VmZml4ID0gKGVuY29kZWQpID0+IHtcbiAgcmV0dXJuIGVuY29kZWQucmVwbGFjZSgvKFtcXDAtIV9dKSgufFxcbik/L2csIChlc2MsIHByZWZpeCwgc3VmZml4KSA9PiB7XG4gICAgc3dpdGNoIChlc2MpIHtcbiAgICAgIGNhc2UgXCIhX1wiOlxuICAgICAgICByZXR1cm4gXCIgXCI7XG4gICAgICBjYXNlIFwiIXxcIjpcbiAgICAgICAgcmV0dXJuIFwiIVwiO1xuICAgICAgY2FzZSBcIl9AXCI6XG4gICAgICAgIHJldHVybiBcIl5cIjtcbiAgICAgIGNhc2UgXCJfX1wiOlxuICAgICAgICByZXR1cm4gXCJfXCI7XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIGNvbnN0IGNoID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHN1ZmZpeFxuICAgICAgICApO1xuICAgICAgICBwcmVmaXggPT09IFwiIVwiICYmIHN1ZmZpeCAhPT0gdm9pZCAwICYmIGNoID49IFwiIVwiICYmIGNoIDw9IFwiQFwiIHx8IHRocm93UmVkYWN0ZWRgaW52YWxpZCBzdHJpbmcgZXNjYXBlOiAke3F1b3RlKGVzYyl9YDtcbiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2guY2hhckNvZGVBdCgwKSAtIDMzKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBlbmNvZGVMZWdhY3lTdHJpbmdTdWZmaXggPSAoc3RyKSA9PiBzdHI7XG52YXIgZGVjb2RlTGVnYWN5U3RyaW5nU3VmZml4ID0gKGVuY29kZWQpID0+IGVuY29kZWQ7XG52YXIgZW5jb2RlQ29tcGFjdEFycmF5ID0gKGFycmF5LCBlbmNvZGVQYXNzYWJsZSkgPT4ge1xuICBjb25zdCBjaGFycyA9IFtcIl5cIl07XG4gIGZvciAoY29uc3QgZWxlbWVudCBvZiBhcnJheSkge1xuICAgIGNvbnN0IGVuYyA9IGVuY29kZVBhc3NhYmxlKGVsZW1lbnQpO1xuICAgIGNoYXJzLnB1c2goZW5jLCBcIiBcIik7XG4gIH1cbiAgcmV0dXJuIGNoYXJzLmpvaW4oXCJcIik7XG59O1xudmFyIGRlY29kZUNvbXBhY3RBcnJheSA9IChlbmNvZGVkLCBkZWNvZGVQYXNzYWJsZSwgc2tpcCA9IDApID0+IHtcbiAgY29uc3QgZWxlbWVudHMgPSBbXTtcbiAgbGV0IGRlcHRoID0gMDtcbiAgbGV0IG5leHRJbmRleCA9IHNraXAgKyAxO1xuICBsZXQgY3VycmVudEVsZW1lbnRTdGFydCA9IHNraXAgKyAxO1xuICBmb3IgKGNvbnN0IHsgMDogY2gsIGluZGV4OiBpMiB9IG9mIGVuY29kZWQubWF0Y2hBbGwoL1tcXF4gXS9nKSkge1xuICAgIGNvbnN0IGluZGV4ID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICBpMlxuICAgICk7XG4gICAgaWYgKGluZGV4IDw9IHNraXApIHtcbiAgICAgIGlmIChpbmRleCA9PT0gc2tpcCkge1xuICAgICAgICBjaCA9PT0gXCJeXCIgfHwgdGhyb3dSZWRhY3RlZGBFbmNvZGVkIGFycmF5IGV4cGVjdGVkOiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoY2ggPT09IFwiXlwiKSB7XG4gICAgICBkZXB0aCArPSAxO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoaW5kZXggPT09IG5leHRJbmRleCkge1xuICAgICAgICBkZXB0aCAtPSAxO1xuICAgICAgICBkZXB0aCA+PSAwIHx8IC8vXG4gICAgICAgIHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBhcnJheSBlbGVtZW50IHRlcm1pbmF0b3I6ICR7ZW5jb2RlZC5zbGljZShza2lwLCBpbmRleCArIDIpfWA7XG4gICAgICB9XG4gICAgICBpZiAoZGVwdGggPT09IDApIHtcbiAgICAgICAgZWxlbWVudHMucHVzaChcbiAgICAgICAgICBkZWNvZGVQYXNzYWJsZShlbmNvZGVkLnNsaWNlKGN1cnJlbnRFbGVtZW50U3RhcnQsIGluZGV4KSlcbiAgICAgICAgKTtcbiAgICAgICAgY3VycmVudEVsZW1lbnRTdGFydCA9IGluZGV4ICsgMTtcbiAgICAgIH1cbiAgICB9XG4gICAgbmV4dEluZGV4ID0gaW5kZXggKyAxO1xuICB9XG4gIGRlcHRoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgdW50ZXJtaW5hdGVkIGFycmF5OiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICBuZXh0SW5kZXggPT09IGVuY29kZWQubGVuZ3RoIHx8IHRocm93UmVkYWN0ZWRgdW50ZXJtaW5hdGVkIGFycmF5IGVsZW1lbnQ6ICR7Z2V0U3VmZml4KFxuICAgIGVuY29kZWQsXG4gICAgY3VycmVudEVsZW1lbnRTdGFydFxuICApfWA7XG4gIHJldHVybiBoYXJkZW4oZWxlbWVudHMpO1xufTtcbnZhciBlbmNvZGVMZWdhY3lBcnJheSA9IChhcnJheSwgZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgY29uc3QgY2hhcnMgPSBbXCJbXCJdO1xuICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgYXJyYXkpIHtcbiAgICBjb25zdCBlbmMgPSBlbmNvZGVQYXNzYWJsZShlbGVtZW50KTtcbiAgICBmb3IgKGNvbnN0IGMyIG9mIGVuYykge1xuICAgICAgaWYgKGMyID09PSBcIlxcMFwiIHx8IGMyID09PSBcIlx1MDAwMVwiKSB7XG4gICAgICAgIGNoYXJzLnB1c2goXCJcdTAwMDFcIik7XG4gICAgICB9XG4gICAgICBjaGFycy5wdXNoKGMyKTtcbiAgICB9XG4gICAgY2hhcnMucHVzaChcIlxcMFwiKTtcbiAgfVxuICByZXR1cm4gY2hhcnMuam9pbihcIlwiKTtcbn07XG52YXIgZGVjb2RlTGVnYWN5QXJyYXkgPSAoZW5jb2RlZCwgZGVjb2RlUGFzc2FibGUsIHNraXAgPSAwKSA9PiB7XG4gIGNvbnN0IGVsZW1lbnRzID0gW107XG4gIGNvbnN0IGVsZW1DaGFycyA9IFtdO1xuICBsZXQgc3RpbGxUb1NraXAgPSBza2lwICsgMTtcbiAgbGV0IGluRXNjYXBlID0gZmFsc2U7XG4gIGZvciAoY29uc3QgYzIgb2YgZW5jb2RlZCkge1xuICAgIGlmIChzdGlsbFRvU2tpcCA+IDApIHtcbiAgICAgIHN0aWxsVG9Ta2lwIC09IDE7XG4gICAgICBpZiAoc3RpbGxUb1NraXAgPT09IDApIHtcbiAgICAgICAgYzIgPT09IFwiW1wiIHx8IHRocm93UmVkYWN0ZWRgRW5jb2RlZCBhcnJheSBleHBlY3RlZDogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGluRXNjYXBlKSB7XG4gICAgICBjMiA9PT0gXCJcXDBcIiB8fCBjMiA9PT0gXCJcdTAwMDFcIiB8fCB0aHJvd1JlZGFjdGVkYFVuZXhwZWN0ZWQgY2hhcmFjdGVyIGFmdGVyIHUwMDAxIGVzY2FwZTogJHtjMn1gO1xuICAgICAgZWxlbUNoYXJzLnB1c2goYzIpO1xuICAgIH0gZWxzZSBpZiAoYzIgPT09IFwiXFwwXCIpIHtcbiAgICAgIGNvbnN0IGVuY29kZWRFbGVtZW50ID0gZWxlbUNoYXJzLmpvaW4oXCJcIik7XG4gICAgICBlbGVtQ2hhcnMubGVuZ3RoID0gMDtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBkZWNvZGVQYXNzYWJsZShlbmNvZGVkRWxlbWVudCk7XG4gICAgICBlbGVtZW50cy5wdXNoKGVsZW1lbnQpO1xuICAgIH0gZWxzZSBpZiAoYzIgPT09IFwiXHUwMDAxXCIpIHtcbiAgICAgIGluRXNjYXBlID0gdHJ1ZTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbGVtQ2hhcnMucHVzaChjMik7XG4gICAgfVxuICAgIGluRXNjYXBlID0gZmFsc2U7XG4gIH1cbiAgIWluRXNjYXBlIHx8IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBlbmQgb2YgZW5jb2RpbmcgJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgZWxlbUNoYXJzLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYGVuY29kaW5nIHRlcm1pbmF0ZWQgZWFybHk6ICR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXApfWA7XG4gIHJldHVybiBoYXJkZW4oZWxlbWVudHMpO1xufTtcbnZhciBlbmNvZGVCeXRlQXJyYXkgPSAoYnl0ZUFycmF5LCBfZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgdGhyb3dSZWRhY3RlZGBlbmNvZGVQYXNzYWJsZShieXRlQXJyYXkpIG5vdCB5ZXQgaW1wbGVtZW50ZWQ6ICR7Ynl0ZUFycmF5fWA7XG4gIHJldHVybiBcIlwiO1xufTtcbnZhciBlbmNvZGVSZWNvcmQgPSAocmVjb3JkLCBlbmNvZGVBcnJheSwgZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgY29uc3QgbmFtZXMgPSByZWNvcmROYW1lcyhyZWNvcmQpO1xuICBjb25zdCB2YWx1ZXM4ID0gcmVjb3JkVmFsdWVzKHJlY29yZCwgbmFtZXMpO1xuICByZXR1cm4gYCgke2VuY29kZUFycmF5KGhhcmRlbihbbmFtZXMsIHZhbHVlczhdKSwgZW5jb2RlUGFzc2FibGUpfWA7XG59O1xudmFyIGRlY29kZVJlY29yZCA9IChlbmNvZGVkLCBkZWNvZGVBcnJheSwgZGVjb2RlUGFzc2FibGUsIHNraXAgPSAwKSA9PiB7XG4gIGFzc2VydChlbmNvZGVkLmNoYXJBdChza2lwKSA9PT0gXCIoXCIpO1xuICBjb25zdCB1bnppcHBlZEVudHJpZXMgPSBkZWNvZGVBcnJheShlbmNvZGVkLCBkZWNvZGVQYXNzYWJsZSwgc2tpcCArIDEpO1xuICB1bnppcHBlZEVudHJpZXMubGVuZ3RoID09PSAyIHx8IHRocm93UmVkYWN0ZWRgZXhwZWN0ZWQga2V5cyx2YWx1ZXMgcGFpcjogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgY29uc3QgW2tleXM1LCB2YWxzXSA9IHVuemlwcGVkRW50cmllcztcbiAgcGFzc1N0eWxlT2Yoa2V5czUpID09PSBcImNvcHlBcnJheVwiICYmIHBhc3NTdHlsZU9mKHZhbHMpID09PSBcImNvcHlBcnJheVwiICYmIGtleXM1Lmxlbmd0aCA9PT0gdmFscy5sZW5ndGggJiYga2V5czUuZXZlcnkoKGtleSkgPT4gdHlwZW9mIGtleSA9PT0gXCJzdHJpbmdcIikgfHwgdGhyb3dSZWRhY3RlZGBub3QgYSB2YWxpZCByZWNvcmQgZW5jb2Rpbmc6ICR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXApfWA7XG4gIGNvbnN0IG1hcEVudHJpZXMgPSBrZXlzNS5tYXAoKGtleSwgaTIpID0+IFtrZXksIHZhbHNbaTJdXSk7XG4gIGNvbnN0IHJlY29yZCA9IGhhcmRlbihmcm9tRW50cmllczUobWFwRW50cmllcykpO1xuICBhc3NlcnRSZWNvcmQocmVjb3JkLCBcImRlY29kZWQgcmVjb3JkXCIpO1xuICByZXR1cm4gcmVjb3JkO1xufTtcbnZhciBlbmNvZGVUYWdnZWQgPSAodGFnZ2VkLCBlbmNvZGVBcnJheSwgZW5jb2RlUGFzc2FibGUpID0+IGA6JHtlbmNvZGVBcnJheShoYXJkZW4oW2dldFRhZyh0YWdnZWQpLCB0YWdnZWQucGF5bG9hZF0pLCBlbmNvZGVQYXNzYWJsZSl9YDtcbnZhciBkZWNvZGVUYWdnZWQgPSAoZW5jb2RlZCwgZGVjb2RlQXJyYXksIGRlY29kZVBhc3NhYmxlLCBza2lwID0gMCkgPT4ge1xuICBhc3NlcnQoZW5jb2RlZC5jaGFyQXQoc2tpcCkgPT09IFwiOlwiKTtcbiAgY29uc3QgdGFnZ2VkUGF5bG9hZCA9IGRlY29kZUFycmF5KGVuY29kZWQsIGRlY29kZVBhc3NhYmxlLCBza2lwICsgMSk7XG4gIHRhZ2dlZFBheWxvYWQubGVuZ3RoID09PSAyIHx8IHRocm93UmVkYWN0ZWRgZXhwZWN0ZWQgdGFnLHBheWxvYWQgcGFpcjogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgY29uc3QgW3RhZywgcGF5bG9hZF0gPSB0YWdnZWRQYXlsb2FkO1xuICBwYXNzU3R5bGVPZih0YWcpID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgbm90IGEgdmFsaWQgdGFnZ2VkIGVuY29kaW5nOiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICByZXR1cm4gbWFrZVRhZ2dlZCh0YWcsIHBheWxvYWQpO1xufTtcbnZhciBtYWtlRW5jb2RlUmVtb3RhYmxlID0gKHVuc2FmZUVuY29kZVJlbW90YWJsZSwgdmVyaWZ5RW5jb2RpbmcpID0+IHtcbiAgY29uc3QgZW5jb2RlUmVtb3RhYmxlID0gKHI2LCBpbm5lckVuY29kZSkgPT4ge1xuICAgIGNvbnN0IGVuY29kaW5nID0gdW5zYWZlRW5jb2RlUmVtb3RhYmxlKHI2LCBpbm5lckVuY29kZSk7XG4gICAgdHlwZW9mIGVuY29kaW5nID09PSBcInN0cmluZ1wiICYmIGVuY29kaW5nLmNoYXJBdCgwKSA9PT0gXCJyXCIgfHwgdGhyb3dSZWRhY3RlZGBSZW1vdGFibGUgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiclwiOiAke2VuY29kaW5nfWA7XG4gICAgdmVyaWZ5RW5jb2RpbmcoZW5jb2RpbmcsIFwiUmVtb3RhYmxlXCIpO1xuICAgIHJldHVybiBlbmNvZGluZztcbiAgfTtcbiAgcmV0dXJuIGVuY29kZVJlbW90YWJsZTtcbn07XG52YXIgbWFrZUVuY29kZVByb21pc2UgPSAodW5zYWZlRW5jb2RlUHJvbWlzZSwgdmVyaWZ5RW5jb2RpbmcpID0+IHtcbiAgY29uc3QgZW5jb2RlUHJvbWlzZSA9IChwMiwgaW5uZXJFbmNvZGUpID0+IHtcbiAgICBjb25zdCBlbmNvZGluZyA9IHVuc2FmZUVuY29kZVByb21pc2UocDIsIGlubmVyRW5jb2RlKTtcbiAgICB0eXBlb2YgZW5jb2RpbmcgPT09IFwic3RyaW5nXCIgJiYgZW5jb2RpbmcuY2hhckF0KDApID09PSBcIj9cIiB8fCB0aHJvd1JlZGFjdGVkYFByb21pc2UgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiP1wiOiAke2VuY29kaW5nfWA7XG4gICAgdmVyaWZ5RW5jb2RpbmcoZW5jb2RpbmcsIFwiUHJvbWlzZVwiKTtcbiAgICByZXR1cm4gZW5jb2Rpbmc7XG4gIH07XG4gIHJldHVybiBlbmNvZGVQcm9taXNlO1xufTtcbnZhciBtYWtlRW5jb2RlRXJyb3IgPSAodW5zYWZlRW5jb2RlRXJyb3IsIHZlcmlmeUVuY29kaW5nKSA9PiB7XG4gIGNvbnN0IGVuY29kZUVycm9yID0gKGVyciwgaW5uZXJFbmNvZGUpID0+IHtcbiAgICBjb25zdCBlbmNvZGluZyA9IHVuc2FmZUVuY29kZUVycm9yKGVyciwgaW5uZXJFbmNvZGUpO1xuICAgIHR5cGVvZiBlbmNvZGluZyA9PT0gXCJzdHJpbmdcIiAmJiBlbmNvZGluZy5jaGFyQXQoMCkgPT09IFwiIVwiIHx8IHRocm93UmVkYWN0ZWRgRXJyb3IgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiIVwiOiAke2VuY29kaW5nfWA7XG4gICAgdmVyaWZ5RW5jb2RpbmcoZW5jb2RpbmcsIFwiRXJyb3JcIik7XG4gICAgcmV0dXJuIGVuY29kaW5nO1xuICB9O1xuICByZXR1cm4gZW5jb2RlRXJyb3I7XG59O1xudmFyIG1ha2VJbm5lckVuY29kZSA9IChlbmNvZGVTdHJpbmdTdWZmaXgsIGVuY29kZUFycmF5LCBvcHRpb25zKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBlbmNvZGVSZW1vdGFibGU6IHVuc2FmZUVuY29kZVJlbW90YWJsZSxcbiAgICBlbmNvZGVQcm9taXNlOiB1bnNhZmVFbmNvZGVQcm9taXNlLFxuICAgIGVuY29kZUVycm9yOiB1bnNhZmVFbmNvZGVFcnJvcixcbiAgICB2ZXJpZnlFbmNvZGluZyA9ICgpID0+IHtcbiAgICB9XG4gIH0gPSBvcHRpb25zO1xuICBjb25zdCBlbmNvZGVSZW1vdGFibGUgPSBtYWtlRW5jb2RlUmVtb3RhYmxlKFxuICAgIHVuc2FmZUVuY29kZVJlbW90YWJsZSxcbiAgICB2ZXJpZnlFbmNvZGluZ1xuICApO1xuICBjb25zdCBlbmNvZGVQcm9taXNlID0gbWFrZUVuY29kZVByb21pc2UodW5zYWZlRW5jb2RlUHJvbWlzZSwgdmVyaWZ5RW5jb2RpbmcpO1xuICBjb25zdCBlbmNvZGVFcnJvciA9IG1ha2VFbmNvZGVFcnJvcih1bnNhZmVFbmNvZGVFcnJvciwgdmVyaWZ5RW5jb2RpbmcpO1xuICBjb25zdCBpbm5lckVuY29kZSA9IChwYXNzYWJsZSkgPT4ge1xuICAgIGlmIChpc0Vycm9yTGlrZShwYXNzYWJsZSkpIHtcbiAgICAgIHJldHVybiBlbmNvZGVFcnJvcihwYXNzYWJsZSwgaW5uZXJFbmNvZGUpO1xuICAgIH1cbiAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihwYXNzYWJsZSk7XG4gICAgc3dpdGNoIChwYXNzU3R5bGUpIHtcbiAgICAgIGNhc2UgXCJudWxsXCI6IHtcbiAgICAgICAgcmV0dXJuIFwidlwiO1xuICAgICAgfVxuICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOiB7XG4gICAgICAgIHJldHVybiBcInpcIjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJudW1iZXJcIjoge1xuICAgICAgICByZXR1cm4gZW5jb2RlQmluYXJ5NjQocGFzc2FibGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN0cmluZ1wiOiB7XG4gICAgICAgIHJldHVybiBgcyR7ZW5jb2RlU3RyaW5nU3VmZml4KHBhc3NhYmxlKX1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJvb2xlYW5cIjoge1xuICAgICAgICByZXR1cm4gYGIke3Bhc3NhYmxlfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZUJpZ0ludChwYXNzYWJsZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZVJlbW90YWJsZShwYXNzYWJsZSwgaW5uZXJFbmNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZUVycm9yKHBhc3NhYmxlLCBpbm5lckVuY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVQcm9taXNlKHBhc3NhYmxlLCBpbm5lckVuY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgY29uc3QgbmFtZSA9IG5hbWVGb3JQYXNzYWJsZVN5bWJvbChwYXNzYWJsZSk7XG4gICAgICAgIGFzc2VydC50eXBlb2YobmFtZSwgXCJzdHJpbmdcIik7XG4gICAgICAgIHJldHVybiBgeSR7ZW5jb2RlU3RyaW5nU3VmZml4KG5hbWUpfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZUFycmF5KHBhc3NhYmxlLCBpbm5lckVuY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYnl0ZUFycmF5XCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZUJ5dGVBcnJheShwYXNzYWJsZSwgaW5uZXJFbmNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICByZXR1cm4gZW5jb2RlUmVjb3JkKHBhc3NhYmxlLCBlbmNvZGVBcnJheSwgaW5uZXJFbmNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVUYWdnZWQocGFzc2FibGUsIGVuY29kZUFycmF5LCBpbm5lckVuY29kZSk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgYSAke3F1b3RlKHBhc3NTdHlsZSl9IGNhbm5vdCBiZSB1c2VkIGFzIGEgY29sbGVjdGlvbiBwYXNzYWJsZWA7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gaW5uZXJFbmNvZGU7XG59O1xudmFyIGxpYmVyYWxEZWNvZGVycyA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgLyogICAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgZGVjb2RlUmVtb3RhYmxlOiAoX2VuY29kaW5nLCBfaW5uZXJEZWNvZGUpID0+IHZvaWQgMCxcbiAgICBkZWNvZGVQcm9taXNlOiAoX2VuY29kaW5nLCBfaW5uZXJEZWNvZGUpID0+IHZvaWQgMCxcbiAgICBkZWNvZGVFcnJvcjogKF9lbmNvZGluZywgX2lubmVyRGVjb2RlKSA9PiB2b2lkIDBcbiAgfVxuKTtcbnZhciBtYWtlSW5uZXJEZWNvZGUgPSAoZGVjb2RlU3RyaW5nU3VmZml4LCBkZWNvZGVBcnJheSwgb3B0aW9ucykgPT4ge1xuICBjb25zdCB7IGRlY29kZVJlbW90YWJsZSwgZGVjb2RlUHJvbWlzZSwgZGVjb2RlRXJyb3IgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IGlubmVyRGVjb2RlID0gKGVuY29kZWQsIHNraXAgPSAwKSA9PiB7XG4gICAgc3dpdGNoIChlbmNvZGVkLmNoYXJBdChza2lwKSkge1xuICAgICAgY2FzZSBcInZcIjoge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ6XCI6IHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJmXCI6IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZUJpbmFyeTY0KGVuY29kZWQsIHNraXApO1xuICAgICAgfVxuICAgICAgY2FzZSBcInNcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlU3RyaW5nU3VmZml4KGdldFN1ZmZpeChlbmNvZGVkLCBza2lwICsgMSkpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJcIjoge1xuICAgICAgICBjb25zdCBzdWJzdHJpbmcgPSBnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCArIDEpO1xuICAgICAgICBpZiAoc3Vic3RyaW5nID09PSBcInRydWVcIikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHN1YnN0cmluZyA9PT0gXCJmYWxzZVwiKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgZXhwZWN0ZWQgZW5jb2RlZCBib29sZWFuIHRvIGJlIFwiYnRydWVcIiBvciBcImJmYWxzZVwiOiAke3N1YnN0cmluZ31gO1xuICAgICAgfVxuICAgICAgY2FzZSBcIm5cIjpcbiAgICAgIGNhc2UgXCJwXCI6IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZUJpZ0ludChnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCkpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInJcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlUmVtb3RhYmxlKGdldFN1ZmZpeChlbmNvZGVkLCBza2lwKSwgaW5uZXJEZWNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcIj9cIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlUHJvbWlzZShnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCksIGlubmVyRGVjb2RlKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCIhXCI6IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZUVycm9yKGdldFN1ZmZpeChlbmNvZGVkLCBza2lwKSwgaW5uZXJEZWNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInlcIjoge1xuICAgICAgICBjb25zdCBuYW1lID0gZGVjb2RlU3RyaW5nU3VmZml4KGdldFN1ZmZpeChlbmNvZGVkLCBza2lwICsgMSkpO1xuICAgICAgICByZXR1cm4gcGFzc2FibGVTeW1ib2xGb3JOYW1lKG5hbWUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcIltcIjpcbiAgICAgIGNhc2UgXCJeXCI6IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZUFycmF5KGVuY29kZWQsIGlubmVyRGVjb2RlLCBza2lwKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCIoXCI6IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZVJlY29yZChlbmNvZGVkLCBkZWNvZGVBcnJheSwgaW5uZXJEZWNvZGUsIHNraXApO1xuICAgICAgfVxuICAgICAgY2FzZSBcIjpcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlVGFnZ2VkKGVuY29kZWQsIGRlY29kZUFycmF5LCBpbm5lckRlY29kZSwgc2tpcCk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW52YWxpZCBkYXRhYmFzZSBrZXk6ICR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXApfWA7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gaW5uZXJEZWNvZGU7XG59O1xudmFyIG1ha2VQYXNzYWJsZUtpdCA9IChvcHRpb25zID0ge30pID0+IHtcbiAgY29uc3Qge1xuICAgIGVuY29kZVJlbW90YWJsZSA9IChyNiwgXykgPT4gdGhyb3dSZWRhY3RlZGByZW1vdGFibGUgdW5leHBlY3RlZDogJHtyNn1gLFxuICAgIGVuY29kZVByb21pc2UgPSAocDIsIF8pID0+IHRocm93UmVkYWN0ZWRgcHJvbWlzZSB1bmV4cGVjdGVkOiAke3AyfWAsXG4gICAgZW5jb2RlRXJyb3IgPSAoZXJyLCBfKSA9PiB0aHJvd1JlZGFjdGVkYGVycm9yIHVuZXhwZWN0ZWQ6ICR7ZXJyfWAsXG4gICAgZm9ybWF0ID0gXCJsZWdhY3lPcmRlcmVkXCIsXG4gICAgZGVjb2RlUmVtb3RhYmxlID0gKGVuY29kaW5nLCBfKSA9PiB0aHJvd1JlZGFjdGVkYHJlbW90YWJsZSB1bmV4cGVjdGVkOiAke2VuY29kaW5nfWAsXG4gICAgZGVjb2RlUHJvbWlzZSA9IChlbmNvZGluZywgXykgPT4gdGhyb3dSZWRhY3RlZGBwcm9taXNlIHVuZXhwZWN0ZWQ6ICR7ZW5jb2Rpbmd9YCxcbiAgICBkZWNvZGVFcnJvciA9IChlbmNvZGluZywgXykgPT4gdGhyb3dSZWRhY3RlZGBlcnJvciB1bmV4cGVjdGVkOiAke2VuY29kaW5nfWBcbiAgfSA9IG9wdGlvbnM7XG4gIGxldCBlbmNvZGVQYXNzYWJsZTtcbiAgY29uc3QgZW5jb2RlT3B0aW9ucyA9IHsgZW5jb2RlUmVtb3RhYmxlLCBlbmNvZGVQcm9taXNlLCBlbmNvZGVFcnJvciwgZm9ybWF0IH07XG4gIGlmIChmb3JtYXQgPT09IFwiY29tcGFjdE9yZGVyZWRcIikge1xuICAgIGNvbnN0IGxpYmVyYWxEZWNvZGUgPSBtYWtlSW5uZXJEZWNvZGUoXG4gICAgICBkZWNvZGVDb21wYWN0U3RyaW5nU3VmZml4LFxuICAgICAgZGVjb2RlQ29tcGFjdEFycmF5LFxuICAgICAgbGliZXJhbERlY29kZXJzXG4gICAgKTtcbiAgICBjb25zdCB2ZXJpZnlFbmNvZGluZyA9IChlbmNvZGluZywgbGFiZWwpID0+IHtcbiAgICAgICFlbmNvZGluZy5tYXRjaChyQzApIHx8IHRocm93UmVkYWN0ZWRgJHtiYXJlT3JRdW90ZShcbiAgICAgICAgbGFiZWxcbiAgICAgICl9IGVuY29kaW5nIG11c3Qgbm90IGNvbnRhaW4gYSBDMCBjb250cm9sIGNoYXJhY3RlcjogJHtlbmNvZGluZ31gO1xuICAgICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZUNvbXBhY3RBcnJheShgXnYgJHtlbmNvZGluZ30gdiBgLCBsaWJlcmFsRGVjb2RlKTtcbiAgICAgIGlzQXJyYXk4KGRlY29kZWQpICYmIGRlY29kZWQubGVuZ3RoID09PSAzICYmIGRlY29kZWRbMF0gPT09IG51bGwgJiYgZGVjb2RlZFsyXSA9PT0gbnVsbCB8fCB0aHJvd1JlZGFjdGVkYCR7YmFyZU9yUXVvdGUobGFiZWwpfSBlbmNvZGluZyBtdXN0IGJlIGVtYmVkZGFibGU6ICR7ZW5jb2Rpbmd9YDtcbiAgICB9O1xuICAgIGNvbnN0IGVuY29kZUNvbXBhY3QgPSBtYWtlSW5uZXJFbmNvZGUoXG4gICAgICBlbmNvZGVDb21wYWN0U3RyaW5nU3VmZml4LFxuICAgICAgZW5jb2RlQ29tcGFjdEFycmF5LFxuICAgICAgeyAuLi5lbmNvZGVPcHRpb25zLCB2ZXJpZnlFbmNvZGluZyB9XG4gICAgKTtcbiAgICBlbmNvZGVQYXNzYWJsZSA9IChwYXNzYWJsZSkgPT4gYH4ke2VuY29kZUNvbXBhY3QocGFzc2FibGUpfWA7XG4gIH0gZWxzZSBpZiAoZm9ybWF0ID09PSBcImxlZ2FjeU9yZGVyZWRcIikge1xuICAgIGVuY29kZVBhc3NhYmxlID0gbWFrZUlubmVyRW5jb2RlKFxuICAgICAgZW5jb2RlTGVnYWN5U3RyaW5nU3VmZml4LFxuICAgICAgZW5jb2RlTGVnYWN5QXJyYXksXG4gICAgICBlbmNvZGVPcHRpb25zXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFVucmVjb2duaXplZCBmb3JtYXQ6ICR7cXVvdGUoZm9ybWF0KX1gO1xuICB9XG4gIGNvbnN0IGRlY29kZU9wdGlvbnMgPSB7IGRlY29kZVJlbW90YWJsZSwgZGVjb2RlUHJvbWlzZSwgZGVjb2RlRXJyb3IgfTtcbiAgY29uc3QgZGVjb2RlQ29tcGFjdCA9IG1ha2VJbm5lckRlY29kZShcbiAgICBkZWNvZGVDb21wYWN0U3RyaW5nU3VmZml4LFxuICAgIGRlY29kZUNvbXBhY3RBcnJheSxcbiAgICBkZWNvZGVPcHRpb25zXG4gICk7XG4gIGNvbnN0IGRlY29kZUxlZ2FjeSA9IG1ha2VJbm5lckRlY29kZShcbiAgICBkZWNvZGVMZWdhY3lTdHJpbmdTdWZmaXgsXG4gICAgZGVjb2RlTGVnYWN5QXJyYXksXG4gICAgZGVjb2RlT3B0aW9uc1xuICApO1xuICBjb25zdCBkZWNvZGVQYXNzYWJsZSA9IChlbmNvZGVkKSA9PiB7XG4gICAgaWYgKGVuY29kZWQuY2hhckF0KDApID09PSBcIn5cIikge1xuICAgICAgcmV0dXJuIGRlY29kZUNvbXBhY3QoZW5jb2RlZCwgMSk7XG4gICAgfVxuICAgIHJldHVybiBkZWNvZGVMZWdhY3koZW5jb2RlZCk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oeyBlbmNvZGVQYXNzYWJsZSwgZGVjb2RlUGFzc2FibGUgfSk7XG59O1xuaGFyZGVuKG1ha2VQYXNzYWJsZUtpdCk7XG52YXIgbWFrZUVuY29kZVBhc3NhYmxlID0gKGVuY29kZU9wdGlvbnMpID0+IHtcbiAgY29uc3QgeyBlbmNvZGVQYXNzYWJsZSB9ID0gbWFrZVBhc3NhYmxlS2l0KGVuY29kZU9wdGlvbnMpO1xuICByZXR1cm4gZW5jb2RlUGFzc2FibGU7XG59O1xuaGFyZGVuKG1ha2VFbmNvZGVQYXNzYWJsZSk7XG52YXIgbWFrZURlY29kZVBhc3NhYmxlID0gKGRlY29kZU9wdGlvbnMpID0+IHtcbiAgY29uc3QgeyBkZWNvZGVQYXNzYWJsZSB9ID0gbWFrZVBhc3NhYmxlS2l0KGRlY29kZU9wdGlvbnMpO1xuICByZXR1cm4gZGVjb2RlUGFzc2FibGU7XG59O1xuaGFyZGVuKG1ha2VEZWNvZGVQYXNzYWJsZSk7XG52YXIgaXNFbmNvZGVkUmVtb3RhYmxlID0gKGVuY29kZWQpID0+IGVuY29kZWQuY2hhckF0KDApID09PSBcInJcIjtcbmhhcmRlbihpc0VuY29kZWRSZW1vdGFibGUpO1xudmFyIHBhc3NTdHlsZVByZWZpeGVzID0ge1xuICBlcnJvcjogXCIhXCIsXG4gIGNvcHlSZWNvcmQ6IFwiKFwiLFxuICB0YWdnZWQ6IFwiOlwiLFxuICBwcm9taXNlOiBcIj9cIixcbiAgY29weUFycmF5OiBcIlteXCIsXG4gIGJ5dGVBcnJheTogXCJhXCIsXG4gIGJvb2xlYW46IFwiYlwiLFxuICBudW1iZXI6IFwiZlwiLFxuICBiaWdpbnQ6IFwibnBcIixcbiAgcmVtb3RhYmxlOiBcInJcIixcbiAgc3RyaW5nOiBcInNcIixcbiAgbnVsbDogXCJ2XCIsXG4gIHN5bWJvbDogXCJ5XCIsXG4gIC8vXG4gIC8vXG4gIC8vXG4gIHVuZGVmaW5lZDogXCJ6XCJcbn07XG5PYmplY3Quc2V0UHJvdG90eXBlT2YocGFzc1N0eWxlUHJlZml4ZXMsIG51bGwpO1xuaGFyZGVuKHBhc3NTdHlsZVByZWZpeGVzKTtcblxuLy9cbnZhciB7IGlzTmFOOiBOdW1iZXJJc05hTiB9ID0gTnVtYmVyO1xudmFyIHsgZW50cmllczogZW50cmllczYsIGZyb21FbnRyaWVzOiBmcm9tRW50cmllczYsIHNldFByb3RvdHlwZU9mOiBzZXRQcm90b3R5cGVPZjIsIGlzOiBpczQgfSA9IE9iamVjdDtcbnZhciBFTkRPX1JBTktfU1RSSU5HUyA9IGdldEVudmlyb25tZW50T3B0aW9uKFwiRU5ET19SQU5LX1NUUklOR1NcIiwgXCJ1dGYxNi1jb2RlLXVuaXQtb3JkZXJcIiwgW1xuICBcInVuaWNvZGUtY29kZS1wb2ludC1vcmRlclwiLFxuICBcImVycm9yLWlmLW9yZGVyLWNob2ljZS1tYXR0ZXJzXCJcbl0pO1xudmFyIHNhbWVWYWx1ZVplcm8gPSAoeCwgeSkgPT4geCA9PT0geSB8fCBpczQoeCwgeSk7XG52YXIgdHJpdmlhbENvbXBhcmF0b3IgPSAobGVmdCwgcmlnaHQpID0+IChcbiAgLy9cbiAgbGVmdCA8IHJpZ2h0ID8gLTEgOiBsZWZ0ID09PSByaWdodCA/IDAgOiAxXG4pO1xuaGFyZGVuKHRyaXZpYWxDb21wYXJhdG9yKTtcbnZhciBjb21wYXJlQnlDb2RlUG9pbnRzID0gKGxlZnQsIHJpZ2h0KSA9PiB7XG4gIGNvbnN0IGxlZnRJdGVyID0gbGVmdFtTeW1ib2wuaXRlcmF0b3JdKCk7XG4gIGNvbnN0IHJpZ2h0SXRlciA9IHJpZ2h0W1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgZm9yICg7IDsgKSB7XG4gICAgY29uc3QgeyB2YWx1ZTogbGVmdENoYXIgfSA9IGxlZnRJdGVyLm5leHQoKTtcbiAgICBjb25zdCB7IHZhbHVlOiByaWdodENoYXIgfSA9IHJpZ2h0SXRlci5uZXh0KCk7XG4gICAgaWYgKGxlZnRDaGFyID09PSB2b2lkIDAgJiYgcmlnaHRDaGFyID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH0gZWxzZSBpZiAobGVmdENoYXIgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIC0xO1xuICAgIH0gZWxzZSBpZiAocmlnaHRDaGFyID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiAxO1xuICAgIH1cbiAgICBjb25zdCBsZWZ0Q29kZXBvaW50ID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICBsZWZ0Q2hhci5jb2RlUG9pbnRBdCgwKVxuICAgICk7XG4gICAgY29uc3QgcmlnaHRDb2RlcG9pbnQgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHJpZ2h0Q2hhci5jb2RlUG9pbnRBdCgwKVxuICAgICk7XG4gICAgaWYgKGxlZnRDb2RlcG9pbnQgPCByaWdodENvZGVwb2ludCkgcmV0dXJuIC0xO1xuICAgIGlmIChsZWZ0Q29kZXBvaW50ID4gcmlnaHRDb2RlcG9pbnQpIHJldHVybiAxO1xuICB9XG59O1xuaGFyZGVuKGNvbXBhcmVCeUNvZGVQb2ludHMpO1xudmFyIGNvbXBhcmVOdW1lcmljcyA9IChsZWZ0LCByaWdodCkgPT4ge1xuICBpZiAobGVmdCA8IHJpZ2h0KSByZXR1cm4gLTE7XG4gIGlmIChsZWZ0ID4gcmlnaHQpIHJldHVybiAxO1xuICBpZiAoTnVtYmVySXNOYU4obGVmdCkgPT09IE51bWJlcklzTmFOKHJpZ2h0KSkgcmV0dXJuIDA7XG4gIGlmIChOdW1iZXJJc05hTihyaWdodCkpIHJldHVybiAtMTtcbiAgYXNzZXJ0KE51bWJlcklzTmFOKGxlZnQpKTtcbiAgcmV0dXJuIDE7XG59O1xudmFyIHBhc3NTdHlsZVJhbmtzID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICBmcm9tRW50cmllczYoXG4gICAgZW50cmllczYocGFzc1N0eWxlUHJlZml4ZXMpLnNvcnQoKFtfbGVmdFN0eWxlLCBsZWZ0UHJlZml4ZXNdLCBbX3JpZ2h0U3R5bGUsIHJpZ2h0UHJlZml4ZXNdKSA9PiB7XG4gICAgICByZXR1cm4gdHJpdmlhbENvbXBhcmF0b3IobGVmdFByZWZpeGVzLCByaWdodFByZWZpeGVzKTtcbiAgICB9KS5tYXAoKFtwYXNzU3R5bGUsIHByZWZpeGVzXSwgaW5kZXgpID0+IHtcbiAgICAgIHByZWZpeGVzID09PSBwcmVmaXhlcy5zcGxpdChcIlwiKS5zb3J0KCkuam9pbihcIlwiKSB8fCB0aHJvd1JlZGFjdGVkYHVuc29ydGVkIHByZWZpeGVzIGZvciBwYXNzU3R5bGUgJHtxdW90ZShwYXNzU3R5bGUpfTogJHtxdW90ZShwcmVmaXhlcyl9YDtcbiAgICAgIGNvbnN0IGNvdmVyID0gW1xuICAgICAgICBwcmVmaXhlcy5jaGFyQXQoMCksXG4gICAgICAgIFN0cmluZy5mcm9tQ2hhckNvZGUocHJlZml4ZXMuY2hhckNvZGVBdChwcmVmaXhlcy5sZW5ndGggLSAxKSArIDEpXG4gICAgICBdO1xuICAgICAgcmV0dXJuIFtwYXNzU3R5bGUsIHsgaW5kZXgsIGNvdmVyIH1dO1xuICAgIH0pXG4gIClcbik7XG5zZXRQcm90b3R5cGVPZjIocGFzc1N0eWxlUmFua3MsIG51bGwpO1xuaGFyZGVuKHBhc3NTdHlsZVJhbmtzKTtcbnZhciBnZXRQYXNzU3R5bGVDb3ZlciA9IChwYXNzU3R5bGUpID0+IHBhc3NTdHlsZVJhbmtzW3Bhc3NTdHlsZV0uY292ZXI7XG5oYXJkZW4oZ2V0UGFzc1N0eWxlQ292ZXIpO1xudmFyIG1lbW9PZlNvcnRlZCA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xudmFyIGNvbXBhcmF0b3JNaXJyb3JJbWFnZXMgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbnZhciBtYWtlQ29tcGFyYXRvcktpdCA9IChjb21wYXJlUmVtb3RhYmxlcyA9IChfeCwgX3kpID0+IE5hTikgPT4ge1xuICBjb25zdCBjb21wYXJhdG9yID0gKGxlZnQsIHJpZ2h0KSA9PiB7XG4gICAgaWYgKHNhbWVWYWx1ZVplcm8obGVmdCwgcmlnaHQpKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgY29uc3QgbGVmdFN0eWxlID0gcGFzc1N0eWxlT2YobGVmdCk7XG4gICAgY29uc3QgcmlnaHRTdHlsZSA9IHBhc3NTdHlsZU9mKHJpZ2h0KTtcbiAgICBpZiAobGVmdFN0eWxlICE9PSByaWdodFN0eWxlKSB7XG4gICAgICByZXR1cm4gY29tcGFyZU51bWVyaWNzKFxuICAgICAgICBwYXNzU3R5bGVSYW5rc1tsZWZ0U3R5bGVdLmluZGV4LFxuICAgICAgICBwYXNzU3R5bGVSYW5rc1tyaWdodFN0eWxlXS5pbmRleFxuICAgICAgKTtcbiAgICB9XG4gICAgc3dpdGNoIChsZWZ0U3R5bGUpIHtcbiAgICAgIGNhc2UgXCJyZW1vdGFibGVcIjoge1xuICAgICAgICByZXR1cm4gY29tcGFyZVJlbW90YWJsZXMobGVmdCwgcmlnaHQpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgICAgY2FzZSBcIm51bGxcIjpcbiAgICAgIGNhc2UgXCJlcnJvclwiOlxuICAgICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJib29sZWFuXCI6XG4gICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgcmV0dXJuIHRyaXZpYWxDb21wYXJhdG9yKGxlZnQsIHJpZ2h0KTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJzdHJpbmdcIjoge1xuICAgICAgICBzd2l0Y2ggKEVORE9fUkFOS19TVFJJTkdTKSB7XG4gICAgICAgICAgY2FzZSBcInV0ZjE2LWNvZGUtdW5pdC1vcmRlclwiOiB7XG4gICAgICAgICAgICByZXR1cm4gdHJpdmlhbENvbXBhcmF0b3IobGVmdCwgcmlnaHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwidW5pY29kZS1jb2RlLXBvaW50LW9yZGVyXCI6IHtcbiAgICAgICAgICAgIHJldHVybiBjb21wYXJlQnlDb2RlUG9pbnRzKGxlZnQsIHJpZ2h0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBcImVycm9yLWlmLW9yZGVyLWNob2ljZS1tYXR0ZXJzXCI6IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDEgPSB0cml2aWFsQ29tcGFyYXRvcihsZWZ0LCByaWdodCk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQyID0gY29tcGFyZUJ5Q29kZVBvaW50cyhsZWZ0LCByaWdodCk7XG4gICAgICAgICAgICByZXN1bHQxID09PSByZXN1bHQyIHx8IHRocm93UmVkYWN0ZWRgQ29tcGFyaXNvbnMgZGlmZmVyZWQ6ICR7bGVmdH0gdnMgJHtyaWdodH0sICR7cXVvdGUocmVzdWx0MSl9IHZzICR7cXVvdGUocmVzdWx0Mil9YDtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQxO1xuICAgICAgICAgIH1cbiAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFVuZXhwZWN0ZWQgRU5ET19SQU5LX1NUUklOR1MgJHtxdW90ZShFTkRPX1JBTktfU1RSSU5HUyl9YDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNhc2UgXCJzeW1ib2xcIjoge1xuICAgICAgICByZXR1cm4gY29tcGFyYXRvcihcbiAgICAgICAgICBuYW1lRm9yUGFzc2FibGVTeW1ib2wobGVmdCksXG4gICAgICAgICAgbmFtZUZvclBhc3NhYmxlU3ltYm9sKHJpZ2h0KVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2FzZSBcIm51bWJlclwiOiB7XG4gICAgICAgIHJldHVybiBjb21wYXJlTnVtZXJpY3MobGVmdCwgcmlnaHQpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICBjb25zdCBsZWZ0TmFtZXMgPSByZWNvcmROYW1lcyhsZWZ0KTtcbiAgICAgICAgY29uc3QgcmlnaHROYW1lcyA9IHJlY29yZE5hbWVzKHJpZ2h0KTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tcGFyYXRvcihsZWZ0TmFtZXMsIHJpZ2h0TmFtZXMpO1xuICAgICAgICBpZiAocmVzdWx0ICE9PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsZWZ0VmFsdWVzID0gcmVjb3JkVmFsdWVzKGxlZnQsIGxlZnROYW1lcyk7XG4gICAgICAgIGNvbnN0IHJpZ2h0VmFsdWVzID0gcmVjb3JkVmFsdWVzKHJpZ2h0LCByaWdodE5hbWVzKTtcbiAgICAgICAgcmV0dXJuIGNvbXBhcmF0b3IobGVmdFZhbHVlcywgcmlnaHRWYWx1ZXMpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIGNvbnN0IGxlbiA9IE1hdGgubWluKGxlZnQubGVuZ3RoLCByaWdodC5sZW5ndGgpO1xuICAgICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgbGVuOyBpMiArPSAxKSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tcGFyYXRvcihsZWZ0W2kyXSwgcmlnaHRbaTJdKTtcbiAgICAgICAgICBpZiAocmVzdWx0ICE9PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29tcGFyYXRvcihsZWZ0Lmxlbmd0aCwgcmlnaHQubGVuZ3RoKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJieXRlQXJyYXlcIjoge1xuICAgICAgICBjb25zdCB7IGJ5dGVMZW5ndGg6IGxlZnRMZW4gfSA9IGxlZnQ7XG4gICAgICAgIGNvbnN0IHsgYnl0ZUxlbmd0aDogcmlnaHRMZW4gfSA9IHJpZ2h0O1xuICAgICAgICBpZiAobGVmdExlbiA8IHJpZ2h0TGVuKSB7XG4gICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsZWZ0TGVuID4gcmlnaHRMZW4pIHtcbiAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsZWZ0QXJyYXkgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YobGVmdCkgPT09IEFycmF5QnVmZmVyLnByb3RvdHlwZSA/IG5ldyBVaW50OEFycmF5KGxlZnQpIDogbmV3IFVpbnQ4QXJyYXkobGVmdC5zbGljZSgwKSk7XG4gICAgICAgIGNvbnN0IHJpZ2h0QXJyYXkgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YocmlnaHQpID09PSBBcnJheUJ1ZmZlci5wcm90b3R5cGUgPyBuZXcgVWludDhBcnJheShyaWdodCkgOiBuZXcgVWludDhBcnJheShyaWdodC5zbGljZSgwKSk7XG4gICAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBsZWZ0TGVuOyBpMiArPSAxKSB7XG4gICAgICAgICAgY29uc3QgbGVmdEJ5dGUgPSBsZWZ0QXJyYXlbaTJdO1xuICAgICAgICAgIGNvbnN0IHJpZ2h0Qnl0ZSA9IHJpZ2h0QXJyYXlbaTJdO1xuICAgICAgICAgIGlmIChsZWZ0Qnl0ZSA8IHJpZ2h0Qnl0ZSkge1xuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobGVmdEJ5dGUgPiByaWdodEJ5dGUpIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICBjb25zdCBsYWJlbENvbXAgPSBjb21wYXJhdG9yKGdldFRhZyhsZWZ0KSwgZ2V0VGFnKHJpZ2h0KSk7XG4gICAgICAgIGlmIChsYWJlbENvbXAgIT09IDApIHtcbiAgICAgICAgICByZXR1cm4gbGFiZWxDb21wO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb21wYXJhdG9yKGxlZnQucGF5bG9hZCwgcmlnaHQucGF5bG9hZCk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgVW5yZWNvZ25pemVkIHBhc3NTdHlsZTogJHtxdW90ZShsZWZ0U3R5bGUpfWA7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBvdXRlckNvbXBhcmF0b3IgPSAoeCwgeSkgPT4gKFxuICAgIC8vXG4gICAgLy9cbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgY29tcGFyYXRvcih4LCB5KSB8fCAwXG4gICk7XG4gIGNvbnN0IGFudGlDb21wYXJhdG9yID0gKHgsIHkpID0+IG91dGVyQ29tcGFyYXRvcih5LCB4KTtcbiAgbWVtb09mU29ydGVkLnNldChvdXRlckNvbXBhcmF0b3IsIC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpKTtcbiAgbWVtb09mU29ydGVkLnNldChhbnRpQ29tcGFyYXRvciwgLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCkpO1xuICBjb21wYXJhdG9yTWlycm9ySW1hZ2VzLnNldChvdXRlckNvbXBhcmF0b3IsIGFudGlDb21wYXJhdG9yKTtcbiAgY29tcGFyYXRvck1pcnJvckltYWdlcy5zZXQoYW50aUNvbXBhcmF0b3IsIG91dGVyQ29tcGFyYXRvcik7XG4gIHJldHVybiBoYXJkZW4oeyBjb21wYXJhdG9yOiBvdXRlckNvbXBhcmF0b3IsIGFudGlDb21wYXJhdG9yIH0pO1xufTtcbnZhciBpc1JhbmtTb3J0ZWQgPSAocGFzc2FibGVzLCBjb21wYXJlKSA9PiB7XG4gIGNvbnN0IHN1Yk1lbW9PZlNvcnRlZCA9IG1lbW9PZlNvcnRlZC5nZXQoY29tcGFyZSk7XG4gIGFzc2VydChzdWJNZW1vT2ZTb3J0ZWQgIT09IHZvaWQgMCk7XG4gIGlmIChzdWJNZW1vT2ZTb3J0ZWQuaGFzKHBhc3NhYmxlcykpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBhc3NlcnQocGFzc1N0eWxlT2YocGFzc2FibGVzKSA9PT0gXCJjb3B5QXJyYXlcIik7XG4gIGZvciAobGV0IGkyID0gMTsgaTIgPCBwYXNzYWJsZXMubGVuZ3RoOyBpMiArPSAxKSB7XG4gICAgaWYgKGNvbXBhcmUocGFzc2FibGVzW2kyIC0gMV0sIHBhc3NhYmxlc1tpMl0pID49IDEpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgc3ViTWVtb09mU29ydGVkLmFkZChwYXNzYWJsZXMpO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5oYXJkZW4oaXNSYW5rU29ydGVkKTtcbnZhciBhc3NlcnRSYW5rU29ydGVkID0gKHNvcnRlZCwgY29tcGFyZSkgPT4gaXNSYW5rU29ydGVkKHNvcnRlZCwgY29tcGFyZSkgfHwgLy9cbi8vXG50aHJvd1JlZGFjdGVkYE11c3QgYmUgcmFuayBzb3J0ZWQ6ICR7c29ydGVkfSB2cyAke3NvcnRCeVJhbmsoc29ydGVkLCBjb21wYXJlKX1gO1xuaGFyZGVuKGFzc2VydFJhbmtTb3J0ZWQpO1xudmFyIHNvcnRCeVJhbmsgPSAocGFzc2FibGVzLCBjb21wYXJlKSA9PiB7XG4gIGxldCB1bnNvcnRlZDtcbiAgaWYgKEFycmF5LmlzQXJyYXkocGFzc2FibGVzKSkge1xuICAgIGhhcmRlbihwYXNzYWJsZXMpO1xuICAgIGlmIChpc1JhbmtTb3J0ZWQocGFzc2FibGVzLCBjb21wYXJlKSkge1xuICAgICAgcmV0dXJuIHBhc3NhYmxlcztcbiAgICB9XG4gICAgdW5zb3J0ZWQgPSBbLi4ucGFzc2FibGVzXTtcbiAgfSBlbHNlIHtcbiAgICB1bnNvcnRlZCA9IEFycmF5LmZyb20ocGFzc2FibGVzLCBoYXJkZW4pO1xuICB9XG4gIGNvbnN0IHNvcnRlZCA9IHVuc29ydGVkLnNvcnQoY29tcGFyZSk7XG4gIGlmIChjb21wYXJlKHRydWUsIHZvaWQgMCkgPiAwKSB7XG4gICAgbGV0IGkyID0gc29ydGVkLmxlbmd0aCAtIDE7XG4gICAgd2hpbGUgKGkyID49IDAgJiYgc29ydGVkW2kyXSA9PT0gdm9pZCAwKSBpMiAtPSAxO1xuICAgIGNvbnN0IG4yID0gc29ydGVkLmxlbmd0aCAtIGkyIC0gMTtcbiAgICBpZiAobjIgPiAwICYmIG4yIDwgc29ydGVkLmxlbmd0aCkge1xuICAgICAgc29ydGVkLmNvcHlXaXRoaW4objIsIDApO1xuICAgICAgc29ydGVkLmZpbGwoXG4gICAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgICAgdm9pZCAwLFxuICAgICAgICAwLFxuICAgICAgICBuMlxuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgaGFyZGVuKHNvcnRlZCk7XG4gIGNvbnN0IHN1Yk1lbW9PZlNvcnRlZCA9IG1lbW9PZlNvcnRlZC5nZXQoY29tcGFyZSk7XG4gIGFzc2VydChzdWJNZW1vT2ZTb3J0ZWQgIT09IHZvaWQgMCk7XG4gIHN1Yk1lbW9PZlNvcnRlZC5hZGQoc29ydGVkKTtcbiAgcmV0dXJuIHNvcnRlZDtcbn07XG5oYXJkZW4oc29ydEJ5UmFuayk7XG52YXIgcmFua1NlYXJjaCA9IChzb3J0ZWQsIGNvbXBhcmUsIGtleSwgYmlhcyA9IFwibGVmdE1vc3RcIikgPT4ge1xuICBhc3NlcnRSYW5rU29ydGVkKHNvcnRlZCwgY29tcGFyZSk7XG4gIGxldCBsZWZ0ID0gMDtcbiAgbGV0IHJpZ2h0ID0gc29ydGVkLmxlbmd0aDtcbiAgd2hpbGUgKGxlZnQgPCByaWdodCkge1xuICAgIGNvbnN0IG0yID0gTWF0aC5mbG9vcigobGVmdCArIHJpZ2h0KSAvIDIpO1xuICAgIGNvbnN0IGNvbXAgPSBjb21wYXJlKHNvcnRlZFttMl0sIGtleSk7XG4gICAgaWYgKGNvbXAgPD0gLTEgfHwgY29tcCA9PT0gMCAmJiBiaWFzID09PSBcInJpZ2h0TW9zdFwiKSB7XG4gICAgICBsZWZ0ID0gbTIgKyAxO1xuICAgIH0gZWxzZSB7XG4gICAgICBhc3NlcnQoY29tcCA+PSAxIHx8IGNvbXAgPT09IDAgJiYgYmlhcyA9PT0gXCJsZWZ0TW9zdFwiKTtcbiAgICAgIHJpZ2h0ID0gbTI7XG4gICAgfVxuICB9XG4gIHJldHVybiBiaWFzID09PSBcImxlZnRNb3N0XCIgPyBsZWZ0IDogcmlnaHQgLSAxO1xufTtcbnZhciBnZXRJbmRleENvdmVyID0gKHNvcnRlZCwgY29tcGFyZSwgW2xlZnRLZXksIHJpZ2h0S2V5XSkgPT4ge1xuICBhc3NlcnRSYW5rU29ydGVkKHNvcnRlZCwgY29tcGFyZSk7XG4gIGNvbnN0IGxlZnRJbmRleCA9IHJhbmtTZWFyY2goc29ydGVkLCBjb21wYXJlLCBsZWZ0S2V5LCBcImxlZnRNb3N0XCIpO1xuICBjb25zdCByaWdodEluZGV4ID0gcmFua1NlYXJjaChzb3J0ZWQsIGNvbXBhcmUsIHJpZ2h0S2V5LCBcInJpZ2h0TW9zdFwiKTtcbiAgcmV0dXJuIFtsZWZ0SW5kZXgsIHJpZ2h0SW5kZXhdO1xufTtcbmhhcmRlbihnZXRJbmRleENvdmVyKTtcbnZhciBGdWxsUmFua0NvdmVyID0gaGFyZGVuKFtcIlwiLCBcIntcIl0pO1xudmFyIGNvdmVyZWRFbnRyaWVzID0gKHNvcnRlZCwgW2xlZnRJbmRleCwgcmlnaHRJbmRleF0pID0+IHtcbiAgY29uc3QgaXRlcmFibGUgPSBoYXJkZW4oe1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBsZXQgaTIgPSBsZWZ0SW5kZXg7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGlmIChpMiA8PSByaWdodEluZGV4KSB7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gc29ydGVkW2kyXTtcbiAgICAgICAgICAgIGkyICs9IDE7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgdmFsdWU6IFtpMiwgZWxlbWVudF0sIGRvbmU6IGZhbHNlIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgdmFsdWU6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBpdGVyYWJsZTtcbn07XG5oYXJkZW4oY292ZXJlZEVudHJpZXMpO1xudmFyIG1heFJhbmsgPSAoY29tcGFyZSwgYTIsIGIzKSA9PiBjb21wYXJlKGEyLCBiMykgPj0gMCA/IGEyIDogYjM7XG52YXIgbWluUmFuayA9IChjb21wYXJlLCBhMiwgYjMpID0+IGNvbXBhcmUoYTIsIGIzKSA8PSAwID8gYTIgOiBiMztcbnZhciB1bmlvblJhbmtDb3ZlcnMgPSAoY29tcGFyZSwgY292ZXJzKSA9PiB7XG4gIGNvbnN0IHVuaW9uUmFua0NvdmVyUGFpciA9IChbbGVmdEEsIHJpZ2h0QV0sIFtsZWZ0QiwgcmlnaHRCXSkgPT4gW1xuICAgIG1pblJhbmsoY29tcGFyZSwgbGVmdEEsIGxlZnRCKSxcbiAgICBtYXhSYW5rKGNvbXBhcmUsIHJpZ2h0QSwgcmlnaHRCKVxuICBdO1xuICByZXR1cm4gY292ZXJzLnJlZHVjZSh1bmlvblJhbmtDb3ZlclBhaXIsIFtcIntcIiwgXCJcIl0pO1xufTtcbmhhcmRlbih1bmlvblJhbmtDb3ZlcnMpO1xudmFyIGludGVyc2VjdFJhbmtDb3ZlcnMgPSAoY29tcGFyZSwgY292ZXJzKSA9PiB7XG4gIGNvbnN0IGludGVyc2VjdFJhbmtDb3ZlclBhaXIgPSAoW2xlZnRBLCByaWdodEFdLCBbbGVmdEIsIHJpZ2h0Ql0pID0+IFtcbiAgICBtYXhSYW5rKGNvbXBhcmUsIGxlZnRBLCBsZWZ0QiksXG4gICAgbWluUmFuayhjb21wYXJlLCByaWdodEEsIHJpZ2h0QilcbiAgXTtcbiAgcmV0dXJuIGNvdmVycy5yZWR1Y2UoaW50ZXJzZWN0UmFua0NvdmVyUGFpciwgW1wiXCIsIFwie1wiXSk7XG59O1xudmFyIHsgY29tcGFyYXRvcjogY29tcGFyZVJhbmssIGFudGlDb21wYXJhdG9yOiBjb21wYXJlQW50aVJhbmsgfSA9IG1ha2VDb21wYXJhdG9yS2l0KCk7XG52YXIgbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQgPSAobG9uZ0xpdmVkID0gZmFsc2UpID0+IHtcbiAgbGV0IG51bVNlZW4gPSAwO1xuICBjb25zdCBNYXBDb25zdHJ1Y3RvciA9IGxvbmdMaXZlZCA/IFdlYWtNYXAgOiBNYXA7XG4gIGNvbnN0IHNlZW4gPSBuZXcgTWFwQ29uc3RydWN0b3IoKTtcbiAgY29uc3QgdGFnID0gKHI2KSA9PiB7XG4gICAgaWYgKHNlZW4uaGFzKHI2KSkge1xuICAgICAgcmV0dXJuIHNlZW4uZ2V0KHI2KTtcbiAgICB9XG4gICAgbnVtU2VlbiArPSAxO1xuICAgIHNlZW4uc2V0KHI2LCBudW1TZWVuKTtcbiAgICByZXR1cm4gbnVtU2VlbjtcbiAgfTtcbiAgY29uc3QgY29tcGFyZVJlbW90YWJsZXMgPSAoeCwgeSkgPT4gY29tcGFyZVJhbmsodGFnKHgpLCB0YWcoeSkpO1xuICByZXR1cm4gbWFrZUNvbXBhcmF0b3JLaXQoY29tcGFyZVJlbW90YWJsZXMpO1xufTtcbmhhcmRlbihtYWtlRnVsbE9yZGVyQ29tcGFyYXRvcktpdCk7XG5cbi8vXG52YXIgY2hlY2tOb0R1cGxpY2F0ZXMgPSAoZWxlbWVudHMsIGZ1bGxDb21wYXJlLCBjaGVjaykgPT4ge1xuICBmdWxsQ29tcGFyZSA9IGZ1bGxDb21wYXJlIHx8IG1ha2VGdWxsT3JkZXJDb21wYXJhdG9yS2l0KCkuYW50aUNvbXBhcmF0b3I7XG4gIGVsZW1lbnRzID0gc29ydEJ5UmFuayhlbGVtZW50cywgZnVsbENvbXBhcmUpO1xuICBjb25zdCB7IGxlbmd0aCB9ID0gZWxlbWVudHM7XG4gIGZvciAobGV0IGkyID0gMTsgaTIgPCBsZW5ndGg7IGkyICs9IDEpIHtcbiAgICBjb25zdCBrMCA9IGVsZW1lbnRzW2kyIC0gMV07XG4gICAgY29uc3QgazEgPSBlbGVtZW50c1tpMl07XG4gICAgaWYgKGZ1bGxDb21wYXJlKGswLCBrMSkgPT09IDApIHtcbiAgICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgdmFsdWUgaGFzIGR1cGxpY2F0ZSBrZXlzOiAke2swfWApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgYXNzZXJ0Tm9EdXBsaWNhdGVzID0gKGVsZW1lbnRzLCBmdWxsQ29tcGFyZSA9IHZvaWQgMCkgPT4ge1xuICBjaGVja05vRHVwbGljYXRlcyhlbGVtZW50cywgZnVsbENvbXBhcmUsIGFzc2VydENoZWNrZXIpO1xufTtcbnZhciBjaGVja0VsZW1lbnRzID0gKGVsZW1lbnRzLCBjaGVjaykgPT4ge1xuICBpZiAocGFzc1N0eWxlT2YoZWxlbWVudHMpICE9PSBcImNvcHlBcnJheVwiKSB7XG4gICAgcmV0dXJuIGNoZWNrKFxuICAgICAgZmFsc2UsXG4gICAgICByZWRhY3RlZGBUaGUga2V5cyBvZiBhIGNvcHlTZXQgb3IgY29weU1hcCBtdXN0IGJlIGEgY29weUFycmF5OiAke2VsZW1lbnRzfWBcbiAgICApO1xuICB9XG4gIGlmICghaXNSYW5rU29ydGVkKGVsZW1lbnRzLCBjb21wYXJlQW50aVJhbmspKSB7XG4gICAgcmV0dXJuIGNoZWNrKFxuICAgICAgZmFsc2UsXG4gICAgICByZWRhY3RlZGBUaGUga2V5cyBvZiBhIGNvcHlTZXQgb3IgY29weU1hcCBtdXN0IGJlIHNvcnRlZCBpbiByZXZlcnNlIHJhbmsgb3JkZXI6ICR7ZWxlbWVudHN9YFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIGNoZWNrTm9EdXBsaWNhdGVzKGVsZW1lbnRzLCB2b2lkIDAsIGNoZWNrKTtcbn07XG5oYXJkZW4oY2hlY2tFbGVtZW50cyk7XG52YXIgYXNzZXJ0RWxlbWVudHMgPSAoZWxlbWVudHMpID0+IHtcbiAgY2hlY2tFbGVtZW50cyhlbGVtZW50cywgYXNzZXJ0Q2hlY2tlcik7XG59O1xuaGFyZGVuKGFzc2VydEVsZW1lbnRzKTtcbnZhciBjb2VyY2VUb0VsZW1lbnRzID0gKGVsZW1lbnRzTGlzdCkgPT4ge1xuICBjb25zdCBlbGVtZW50cyA9IHNvcnRCeVJhbmsoZWxlbWVudHNMaXN0LCBjb21wYXJlQW50aVJhbmspO1xuICBhc3NlcnRFbGVtZW50cyhlbGVtZW50cyk7XG4gIHJldHVybiBlbGVtZW50cztcbn07XG5oYXJkZW4oY29lcmNlVG9FbGVtZW50cyk7XG52YXIgbWFrZVNldE9mRWxlbWVudHMgPSAoZWxlbWVudEl0ZXIpID0+IG1ha2VUYWdnZWQoXCJjb3B5U2V0XCIsIGNvZXJjZVRvRWxlbWVudHMoZWxlbWVudEl0ZXIpKTtcbmhhcmRlbihtYWtlU2V0T2ZFbGVtZW50cyk7XG5cbi8vXG52YXIgY2hlY2tOb0R1cGxpY2F0ZUtleXMgPSAoYmFnRW50cmllcywgZnVsbENvbXBhcmUsIGNoZWNrKSA9PiB7XG4gIGZ1bGxDb21wYXJlID0gZnVsbENvbXBhcmUgfHwgbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQoKS5hbnRpQ29tcGFyYXRvcjtcbiAgYmFnRW50cmllcyA9IHNvcnRCeVJhbmsoYmFnRW50cmllcywgZnVsbENvbXBhcmUpO1xuICBjb25zdCB7IGxlbmd0aCB9ID0gYmFnRW50cmllcztcbiAgZm9yIChsZXQgaTIgPSAxOyBpMiA8IGxlbmd0aDsgaTIgKz0gMSkge1xuICAgIGNvbnN0IGswID0gYmFnRW50cmllc1tpMiAtIDFdWzBdO1xuICAgIGNvbnN0IGsxID0gYmFnRW50cmllc1tpMl1bMF07XG4gICAgaWYgKGZ1bGxDb21wYXJlKGswLCBrMSkgPT09IDApIHtcbiAgICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgdmFsdWUgaGFzIGR1cGxpY2F0ZSBrZXlzOiAke2swfWApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgYXNzZXJ0Tm9EdXBsaWNhdGVLZXlzID0gKGJhZ0VudHJpZXMsIGZ1bGxDb21wYXJlID0gdm9pZCAwKSA9PiB7XG4gIGNoZWNrTm9EdXBsaWNhdGVLZXlzKGJhZ0VudHJpZXMsIGZ1bGxDb21wYXJlLCBhc3NlcnRDaGVja2VyKTtcbn07XG52YXIgY2hlY2tCYWdFbnRyaWVzID0gKGJhZ0VudHJpZXMsIGNoZWNrKSA9PiB7XG4gIGlmIChwYXNzU3R5bGVPZihiYWdFbnRyaWVzKSAhPT0gXCJjb3B5QXJyYXlcIikge1xuICAgIHJldHVybiBjaGVjayhcbiAgICAgIGZhbHNlLFxuICAgICAgcmVkYWN0ZWRgVGhlIGVudHJpZXMgb2YgYSBjb3B5QmFnIG11c3QgYmUgYSBjb3B5QXJyYXk6ICR7YmFnRW50cmllc31gXG4gICAgKTtcbiAgfVxuICBpZiAoIWlzUmFua1NvcnRlZChiYWdFbnRyaWVzLCBjb21wYXJlQW50aVJhbmspKSB7XG4gICAgcmV0dXJuIGNoZWNrKFxuICAgICAgZmFsc2UsXG4gICAgICByZWRhY3RlZGBUaGUgZW50cmllcyBvZiBhIGNvcHlCYWcgbXVzdCBiZSBzb3J0ZWQgaW4gcmV2ZXJzZSByYW5rIG9yZGVyOiAke2JhZ0VudHJpZXN9YFxuICAgICk7XG4gIH1cbiAgZm9yIChjb25zdCBlbnRyeSBvZiBiYWdFbnRyaWVzKSB7XG4gICAgaWYgKHBhc3NTdHlsZU9mKGVudHJ5KSAhPT0gXCJjb3B5QXJyYXlcIiB8fCBlbnRyeS5sZW5ndGggIT09IDIgfHwgdHlwZW9mIGVudHJ5WzFdICE9PSBcImJpZ2ludFwiKSB7XG4gICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgIGZhbHNlLFxuICAgICAgICByZWRhY3RlZGBFYWNoIGVudHJ5IG9mIGEgY29weUJhZyBtdXN0IGJlIHBhaXIgb2YgYSBrZXkgYW5kIGEgYmlnaW50IHJlcHJlc2VudGluZyBhIGNvdW50OiAke2VudHJ5fWBcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChlbnRyeVsxXSA8IDEpIHtcbiAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYEVhY2ggZW50cnkgb2YgYSBjb3B5QmFnIG11c3QgaGF2ZSBhIHBvc2l0aXZlIGNvdW50OiAke2VudHJ5fWBcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIHJldHVybiBjaGVja05vRHVwbGljYXRlS2V5cyhiYWdFbnRyaWVzLCB2b2lkIDAsIGNoZWNrKTtcbn07XG5oYXJkZW4oY2hlY2tCYWdFbnRyaWVzKTtcbnZhciBhc3NlcnRCYWdFbnRyaWVzID0gKGJhZ0VudHJpZXMpID0+IHtcbiAgY2hlY2tCYWdFbnRyaWVzKGJhZ0VudHJpZXMsIGFzc2VydENoZWNrZXIpO1xufTtcbmhhcmRlbihhc3NlcnRCYWdFbnRyaWVzKTtcbnZhciBjb2VyY2VUb0JhZ0VudHJpZXMgPSAoYmFnRW50cmllc0xpc3QpID0+IHtcbiAgY29uc3QgYmFnRW50cmllcyA9IHNvcnRCeVJhbmsoYmFnRW50cmllc0xpc3QsIGNvbXBhcmVBbnRpUmFuayk7XG4gIGFzc2VydEJhZ0VudHJpZXMoYmFnRW50cmllcyk7XG4gIHJldHVybiBiYWdFbnRyaWVzO1xufTtcbmhhcmRlbihjb2VyY2VUb0JhZ0VudHJpZXMpO1xudmFyIG1ha2VCYWdPZkVudHJpZXMgPSAoYmFnRW50cnlJdGVyKSA9PiBtYWtlVGFnZ2VkKFwiY29weUJhZ1wiLCBjb2VyY2VUb0JhZ0VudHJpZXMoYmFnRW50cnlJdGVyKSk7XG5oYXJkZW4obWFrZUJhZ09mRW50cmllcyk7XG5cbi8vXG52YXIgeyBvd25LZXlzOiBvd25LZXlzMTYgfSA9IFJlZmxlY3Q7XG52YXIgY2hlY2tTY2FsYXJLZXkgPSAodmFsLCBjaGVjaykgPT4ge1xuICBpZiAoaXNBdG9tKHZhbCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZih2YWwpO1xuICBpZiAocGFzc1N0eWxlID09PSBcInJlbW90YWJsZVwiKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBBICR7cXVvdGUocGFzc1N0eWxlKX0gY2Fubm90IGJlIGEgc2NhbGFyIGtleTogJHt2YWx9YCk7XG59O1xudmFyIGlzU2NhbGFyS2V5ID0gKHZhbCkgPT4gY2hlY2tTY2FsYXJLZXkodmFsLCBpZGVudENoZWNrZXIpO1xuaGFyZGVuKGlzU2NhbGFyS2V5KTtcbnZhciBhc3NlcnRTY2FsYXJLZXkgPSAodmFsKSA9PiB7XG4gIGNoZWNrU2NhbGFyS2V5KHZhbCwgYXNzZXJ0Q2hlY2tlcik7XG59O1xuaGFyZGVuKGFzc2VydFNjYWxhcktleSk7XG52YXIga2V5TWVtbyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xudmFyIGNoZWNrS2V5ID0gKHZhbCwgY2hlY2spID0+IHtcbiAgaWYgKGlzQXRvbSh2YWwpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKGtleU1lbW8uaGFzKHZhbCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCByZXN1bHQgPSBjaGVja0tleUludGVybmFsKHZhbCwgY2hlY2spO1xuICBpZiAocmVzdWx0KSB7XG4gICAga2V5TWVtby5hZGQodmFsKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbmhhcmRlbihjaGVja0tleSk7XG52YXIgaXNLZXkgPSAodmFsKSA9PiBjaGVja0tleSh2YWwsIGlkZW50Q2hlY2tlcik7XG5oYXJkZW4oaXNLZXkpO1xudmFyIGFzc2VydEtleSA9ICh2YWwpID0+IHtcbiAgY2hlY2tLZXkodmFsLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0S2V5KTtcbnZhciBjb3B5U2V0TWVtbyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xudmFyIGNoZWNrQ29weVNldCA9IChzMiwgY2hlY2spID0+IHtcbiAgaWYgKGNvcHlTZXRNZW1vLmhhcyhzMikpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCByZXN1bHQgPSAocGFzc1N0eWxlT2YoczIpID09PSBcInRhZ2dlZFwiICYmIGdldFRhZyhzMikgPT09IFwiY29weVNldFwiIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBOb3QgYSBjb3B5U2V0OiAke3MyfWApKSAmJiBjaGVja0VsZW1lbnRzKHMyLnBheWxvYWQsIGNoZWNrKSAmJiBjaGVja0tleShzMi5wYXlsb2FkLCBjaGVjayk7XG4gIGlmIChyZXN1bHQpIHtcbiAgICBjb3B5U2V0TWVtby5hZGQoczIpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xuaGFyZGVuKGNoZWNrQ29weVNldCk7XG52YXIgaXNDb3B5U2V0ID0gKHMyKSA9PiBjaGVja0NvcHlTZXQoczIsIGlkZW50Q2hlY2tlcik7XG5oYXJkZW4oaXNDb3B5U2V0KTtcbnZhciBhc3NlcnRDb3B5U2V0ID0gKHMyKSA9PiB7XG4gIGNoZWNrQ29weVNldChzMiwgYXNzZXJ0Q2hlY2tlcik7XG59O1xuaGFyZGVuKGFzc2VydENvcHlTZXQpO1xudmFyIGdldENvcHlTZXRLZXlzID0gKHMyKSA9PiB7XG4gIGFzc2VydENvcHlTZXQoczIpO1xuICByZXR1cm4gczIucGF5bG9hZDtcbn07XG5oYXJkZW4oZ2V0Q29weVNldEtleXMpO1xudmFyIGV2ZXJ5Q29weVNldEtleSA9IChzMiwgZm4pID0+IGdldENvcHlTZXRLZXlzKHMyKS5ldmVyeSgoa2V5LCBpbmRleCkgPT4gZm4oa2V5LCBpbmRleCkpO1xuaGFyZGVuKGV2ZXJ5Q29weVNldEtleSk7XG52YXIgbWFrZUNvcHlTZXQgPSAoZWxlbWVudEl0ZXIpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gbWFrZVNldE9mRWxlbWVudHMoZWxlbWVudEl0ZXIpO1xuICBhc3NlcnRDb3B5U2V0KHJlc3VsdCk7XG4gIHJldHVybiByZXN1bHQ7XG59O1xuaGFyZGVuKG1ha2VDb3B5U2V0KTtcbnZhciBjb3B5QmFnTWVtbyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xudmFyIGNoZWNrQ29weUJhZyA9IChiMywgY2hlY2spID0+IHtcbiAgaWYgKGNvcHlCYWdNZW1vLmhhcyhiMykpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCByZXN1bHQgPSAocGFzc1N0eWxlT2YoYjMpID09PSBcInRhZ2dlZFwiICYmIGdldFRhZyhiMykgPT09IFwiY29weUJhZ1wiIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBOb3QgYSBjb3B5QmFnOiAke2IzfWApKSAmJiBjaGVja0JhZ0VudHJpZXMoYjMucGF5bG9hZCwgY2hlY2spICYmIGNoZWNrS2V5KGIzLnBheWxvYWQsIGNoZWNrKTtcbiAgaWYgKHJlc3VsdCkge1xuICAgIGNvcHlCYWdNZW1vLmFkZChiMyk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5oYXJkZW4oY2hlY2tDb3B5QmFnKTtcbnZhciBpc0NvcHlCYWcgPSAoYjMpID0+IGNoZWNrQ29weUJhZyhiMywgaWRlbnRDaGVja2VyKTtcbmhhcmRlbihpc0NvcHlCYWcpO1xudmFyIGFzc2VydENvcHlCYWcgPSAoYjMpID0+IHtcbiAgY2hlY2tDb3B5QmFnKGIzLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0Q29weUJhZyk7XG52YXIgZ2V0Q29weUJhZ0VudHJpZXMgPSAoYjMpID0+IHtcbiAgYXNzZXJ0Q29weUJhZyhiMyk7XG4gIHJldHVybiBiMy5wYXlsb2FkO1xufTtcbmhhcmRlbihnZXRDb3B5QmFnRW50cmllcyk7XG52YXIgZXZlcnlDb3B5QmFnRW50cnkgPSAoYjMsIGZuKSA9PiBnZXRDb3B5QmFnRW50cmllcyhiMykuZXZlcnkoKGVudHJ5LCBpbmRleCkgPT4gZm4oZW50cnksIGluZGV4KSk7XG5oYXJkZW4oZXZlcnlDb3B5QmFnRW50cnkpO1xudmFyIG1ha2VDb3B5QmFnID0gKGJhZ0VudHJ5SXRlcikgPT4ge1xuICBjb25zdCByZXN1bHQgPSBtYWtlQmFnT2ZFbnRyaWVzKGJhZ0VudHJ5SXRlcik7XG4gIGFzc2VydENvcHlCYWcocmVzdWx0KTtcbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5oYXJkZW4obWFrZUNvcHlCYWcpO1xudmFyIG1ha2VDb3B5QmFnRnJvbUVsZW1lbnRzID0gKGVsZW1lbnRJdGVyKSA9PiB7XG4gIGNvbnN0IGZ1bGxDb21wYXJlID0gbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQoKS5hbnRpQ29tcGFyYXRvcjtcbiAgY29uc3Qgc29ydGVkID0gc29ydEJ5UmFuayhlbGVtZW50SXRlciwgZnVsbENvbXBhcmUpO1xuICBjb25zdCBlbnRyaWVzMTEgPSBbXTtcbiAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IHNvcnRlZC5sZW5ndGg7ICkge1xuICAgIGNvbnN0IGsgPSBzb3J0ZWRbaTJdO1xuICAgIGxldCBqID0gaTIgKyAxO1xuICAgIHdoaWxlIChqIDwgc29ydGVkLmxlbmd0aCAmJiBmdWxsQ29tcGFyZShrLCBzb3J0ZWRbal0pID09PSAwKSB7XG4gICAgICBqICs9IDE7XG4gICAgfVxuICAgIGVudHJpZXMxMS5wdXNoKFtrLCBCaWdJbnQoaiAtIGkyKV0pO1xuICAgIGkyID0gajtcbiAgfVxuICByZXR1cm4gbWFrZUNvcHlCYWcoZW50cmllczExKTtcbn07XG5oYXJkZW4obWFrZUNvcHlCYWdGcm9tRWxlbWVudHMpO1xudmFyIGNvcHlNYXBNZW1vID0gLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCk7XG52YXIgY2hlY2tDb3B5TWFwID0gKG0yLCBjaGVjaykgPT4ge1xuICBpZiAoY29weU1hcE1lbW8uaGFzKG0yKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmICghKHBhc3NTdHlsZU9mKG0yKSA9PT0gXCJ0YWdnZWRcIiAmJiBnZXRUYWcobTIpID09PSBcImNvcHlNYXBcIikpIHtcbiAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYE5vdCBhIGNvcHlNYXA6ICR7bTJ9YCk7XG4gIH1cbiAgY29uc3QgeyBwYXlsb2FkIH0gPSBtMjtcbiAgaWYgKHBhc3NTdHlsZU9mKHBheWxvYWQpICE9PSBcImNvcHlSZWNvcmRcIikge1xuICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSBjb3B5TWFwJ3MgcGF5bG9hZCBtdXN0IGJlIGEgcmVjb3JkOiAke20yfWApO1xuICB9XG4gIGNvbnN0IHsga2V5czoga2V5czUsIHZhbHVlczogdmFsdWVzOCwgLi4ucmVzdCB9ID0gcGF5bG9hZDtcbiAgY29uc3QgcmVzdWx0ID0gKG93bktleXMxNihyZXN0KS5sZW5ndGggPT09IDAgfHwgY2hlY2soXG4gICAgZmFsc2UsXG4gICAgcmVkYWN0ZWRgQSBjb3B5TWFwJ3MgcGF5bG9hZCBtdXN0IG9ubHkgaGF2ZSAua2V5cyBhbmQgLnZhbHVlczogJHttMn1gXG4gICkpICYmIGNoZWNrRWxlbWVudHMoa2V5czUsIGNoZWNrKSAmJiBjaGVja0tleShrZXlzNSwgY2hlY2spICYmIChwYXNzU3R5bGVPZih2YWx1ZXM4KSA9PT0gXCJjb3B5QXJyYXlcIiB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSBjb3B5TWFwJ3MgLnZhbHVlcyBtdXN0IGJlIGEgY29weUFycmF5OiAke20yfWApKSAmJiAoa2V5czUubGVuZ3RoID09PSB2YWx1ZXM4Lmxlbmd0aCB8fCBjaGVjayhcbiAgICBmYWxzZSxcbiAgICByZWRhY3RlZGBBIGNvcHlNYXAgbXVzdCBoYXZlIHRoZSBzYW1lIG51bWJlciBvZiBrZXlzIGFuZCB2YWx1ZXM6ICR7bTJ9YFxuICApKTtcbiAgaWYgKHJlc3VsdCkge1xuICAgIGNvcHlNYXBNZW1vLmFkZChtMik7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5oYXJkZW4oY2hlY2tDb3B5TWFwKTtcbnZhciBpc0NvcHlNYXAgPSAobTIpID0+IGNoZWNrQ29weU1hcChtMiwgaWRlbnRDaGVja2VyKTtcbmhhcmRlbihpc0NvcHlNYXApO1xudmFyIGFzc2VydENvcHlNYXAgPSAobTIpID0+IHtcbiAgY2hlY2tDb3B5TWFwKG0yLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0Q29weU1hcCk7XG52YXIgZ2V0Q29weU1hcEtleXMgPSAobTIpID0+IHtcbiAgYXNzZXJ0Q29weU1hcChtMik7XG4gIHJldHVybiBtMi5wYXlsb2FkLmtleXM7XG59O1xuaGFyZGVuKGdldENvcHlNYXBLZXlzKTtcbnZhciBnZXRDb3B5TWFwVmFsdWVzID0gKG0yKSA9PiB7XG4gIGFzc2VydENvcHlNYXAobTIpO1xuICByZXR1cm4gbTIucGF5bG9hZC52YWx1ZXM7XG59O1xuaGFyZGVuKGdldENvcHlNYXBWYWx1ZXMpO1xudmFyIGdldENvcHlNYXBFbnRyeUFycmF5ID0gKG0yKSA9PiB7XG4gIGFzc2VydENvcHlNYXAobTIpO1xuICBjb25zdCB7XG4gICAgcGF5bG9hZDogeyBrZXlzOiBrZXlzNSwgdmFsdWVzOiB2YWx1ZXM4IH1cbiAgfSA9IG0yO1xuICByZXR1cm4gaGFyZGVuKGtleXM1Lm1hcCgoa2V5LCBpMikgPT4gW2tleSwgdmFsdWVzOFtpMl1dKSk7XG59O1xuaGFyZGVuKGdldENvcHlNYXBFbnRyeUFycmF5KTtcbnZhciBnZXRDb3B5TWFwRW50cmllcyA9IChtMikgPT4ge1xuICBhc3NlcnRDb3B5TWFwKG0yKTtcbiAgY29uc3Qge1xuICAgIHBheWxvYWQ6IHsga2V5czoga2V5czUsIHZhbHVlczogdmFsdWVzOCB9XG4gIH0gPSBtMjtcbiAgY29uc3QgeyBsZW5ndGggfSA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgIGtleXM1XG4gICk7XG4gIHJldHVybiBGYXIoXCJDb3B5TWFwIGVudHJpZXMgaXRlcmFibGVcIiwge1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBsZXQgaTIgPSAwO1xuICAgICAgcmV0dXJuIEZhcihcIkNvcHlNYXAgZW50cmllcyBpdGVyYXRvclwiLCB7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBsZXQgcmVzdWx0O1xuICAgICAgICAgIGlmIChpMiA8IGxlbmd0aCkge1xuICAgICAgICAgICAgcmVzdWx0ID0gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlOiBba2V5czVbaTJdLCB2YWx1ZXM4W2kyXV0gfSk7XG4gICAgICAgICAgICBpMiArPSAxO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0ID0gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHZvaWQgMCB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4oZ2V0Q29weU1hcEVudHJpZXMpO1xudmFyIGV2ZXJ5Q29weU1hcEtleSA9IChtMiwgZm4pID0+IGdldENvcHlNYXBLZXlzKG0yKS5ldmVyeSgoa2V5LCBpbmRleCkgPT4gZm4oa2V5LCBpbmRleCkpO1xuaGFyZGVuKGV2ZXJ5Q29weU1hcEtleSk7XG52YXIgZXZlcnlDb3B5TWFwVmFsdWUgPSAobTIsIGZuKSA9PiBnZXRDb3B5TWFwVmFsdWVzKG0yKS5ldmVyeSgodmFsdWUsIGluZGV4KSA9PiBmbih2YWx1ZSwgaW5kZXgpKTtcbmhhcmRlbihldmVyeUNvcHlNYXBWYWx1ZSk7XG52YXIgY29weU1hcEtleVNldCA9IChtMikgPT4gKFxuICAvL1xuICBtYWtlVGFnZ2VkKFwiY29weVNldFwiLCBtMi5wYXlsb2FkLmtleXMpXG4pO1xuaGFyZGVuKGNvcHlNYXBLZXlTZXQpO1xudmFyIG1ha2VDb3B5TWFwID0gKGVudHJpZXMxMSkgPT4ge1xuICBjb25zdCBzb3J0ZWRFbnRyaWVzID0gc29ydEJ5UmFuayhlbnRyaWVzMTEsIGNvbXBhcmVBbnRpUmFuayk7XG4gIGNvbnN0IGtleXM1ID0gc29ydGVkRW50cmllcy5tYXAoKFtrLCBfdl0pID0+IGspO1xuICBjb25zdCB2YWx1ZXM4ID0gc29ydGVkRW50cmllcy5tYXAoKFtfaywgdjJdKSA9PiB2Mik7XG4gIGNvbnN0IHJlc3VsdCA9IG1ha2VUYWdnZWQoXCJjb3B5TWFwXCIsIHsga2V5czoga2V5czUsIHZhbHVlczogdmFsdWVzOCB9KTtcbiAgYXNzZXJ0Q29weU1hcChyZXN1bHQpO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbmhhcmRlbihtYWtlQ29weU1hcCk7XG52YXIgY2hlY2tLZXlJbnRlcm5hbCA9ICh2YWwsIGNoZWNrKSA9PiB7XG4gIGNvbnN0IGNoZWNrSXQgPSAoY2hpbGQpID0+IGNoZWNrS2V5KGNoaWxkLCBjaGVjayk7XG4gIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHZhbCk7XG4gIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXModmFsKS5ldmVyeShjaGVja0l0KTtcbiAgICB9XG4gICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICByZXR1cm4gdmFsLmV2ZXJ5KGNoZWNrSXQpO1xuICAgIH1cbiAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgIGNvbnN0IHRhZyA9IGdldFRhZyh2YWwpO1xuICAgICAgc3dpdGNoICh0YWcpIHtcbiAgICAgICAgY2FzZSBcImNvcHlTZXRcIjoge1xuICAgICAgICAgIHJldHVybiBjaGVja0NvcHlTZXQodmFsLCBjaGVjayk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImNvcHlCYWdcIjoge1xuICAgICAgICAgIHJldHVybiBjaGVja0NvcHlCYWcodmFsLCBjaGVjayk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImNvcHlNYXBcIjoge1xuICAgICAgICAgIHJldHVybiBjaGVja0NvcHlNYXAodmFsLCBjaGVjaykgJiYgLy9cbiAgICAgICAgICAvL1xuICAgICAgICAgIC8vXG4gICAgICAgICAgZXZlcnlDb3B5TWFwVmFsdWUodmFsLCBjaGVja0l0KTtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrICE9PSBpZGVudENoZWNrZXIgJiYgY2hlY2soZmFsc2UsIHJlZGFjdGVkYEEgcGFzc2FibGUgdGFnZ2VkICR7cXVvdGUodGFnKX0gaXMgbm90IGEga2V5OiAke3ZhbH1gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBjYXNlIFwiZXJyb3JcIjpcbiAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYEEgJHtxdW90ZShwYXNzU3R5bGUpfSBjYW5ub3QgYmUgYSBrZXlgKTtcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIHBhc3NTdHlsZSAke3F1b3RlKHBhc3NTdHlsZSl9OiAke3ZhbH1gO1xuICAgIH1cbiAgfVxufTtcblxuLy9cbnZhciBtYWtlSXRlcmF0b3IgPSAobmV4dCkgPT4ge1xuICBjb25zdCBpdGVyID0gaGFyZGVuKHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4gaXRlcixcbiAgICBuZXh0XG4gIH0pO1xuICByZXR1cm4gaXRlcjtcbn07XG5oYXJkZW4obWFrZUl0ZXJhdG9yKTtcblxuLy9cbnZhciBtYWtlQXJyYXlJdGVyYXRvciA9IChhcnIpID0+IHtcbiAgY29uc3QgeyBsZW5ndGggfSA9IGFycjtcbiAgbGV0IGkyID0gMDtcbiAgcmV0dXJuIG1ha2VJdGVyYXRvcigoKSA9PiB7XG4gICAgbGV0IHZhbHVlO1xuICAgIGlmIChpMiA8IGxlbmd0aCkge1xuICAgICAgdmFsdWUgPSBhcnJbaTJdO1xuICAgICAgaTIgKz0gMTtcbiAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWUgfSk7XG4gICAgfVxuICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZSB9KTtcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VBcnJheUl0ZXJhdG9yKTtcblxuLy9cbnZhciBnZW5lcmF0ZUZ1bGxTb3J0ZWRFbnRyaWVzID0gKGVudHJpZXMxMSwgcmFua0NvbXBhcmUsIGZ1bGxDb21wYXJlKSA9PiB7XG4gIGFzc2VydFJhbmtTb3J0ZWQoZW50cmllczExLCByYW5rQ29tcGFyZSk7XG4gIGNvbnN0IHsgbGVuZ3RoIH0gPSBlbnRyaWVzMTE7XG4gIGxldCBpMiA9IDA7XG4gIGxldCBzYW1lUmFua0l0ZXJhdG9yO1xuICByZXR1cm4gbWFrZUl0ZXJhdG9yKCgpID0+IHtcbiAgICBpZiAoc2FtZVJhbmtJdGVyYXRvcikge1xuICAgICAgY29uc3QgcmVzdWx0ID0gc2FtZVJhbmtJdGVyYXRvci5uZXh0KCk7XG4gICAgICBpZiAoIXJlc3VsdC5kb25lKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICBzYW1lUmFua0l0ZXJhdG9yID0gdm9pZCAwO1xuICAgIH1cbiAgICBpZiAoaTIgPCBsZW5ndGgpIHtcbiAgICAgIGNvbnN0IGVudHJ5ID0gZW50cmllczExW2kyXTtcbiAgICAgIGxldCBqID0gaTIgKyAxO1xuICAgICAgd2hpbGUgKGogPCBsZW5ndGggJiYgcmFua0NvbXBhcmUoZW50cnlbMF0sIGVudHJpZXMxMVtqXVswXSkgPT09IDApIHtcbiAgICAgICAgaiArPSAxO1xuICAgICAgfVxuICAgICAgaWYgKGogPT09IGkyICsgMSkge1xuICAgICAgICBpMiA9IGo7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWU6IGVudHJ5IH0pO1xuICAgICAgfVxuICAgICAgY29uc3QgdGllcyA9IGVudHJpZXMxMS5zbGljZShpMiwgaik7XG4gICAgICBpMiA9IGo7XG4gICAgICBjb25zdCBzb3J0ZWRUaWVzID0gc29ydEJ5UmFuayh0aWVzLCBmdWxsQ29tcGFyZSk7XG4gICAgICBmb3IgKGxldCBrID0gMTsgayA8IHNvcnRlZFRpZXMubGVuZ3RoOyBrICs9IDEpIHtcbiAgICAgICAgY29uc3QgW2tleTBdID0gc29ydGVkVGllc1trIC0gMV07XG4gICAgICAgIGNvbnN0IFtrZXkxXSA9IHNvcnRlZFRpZXNba107XG4gICAgICAgIE1hdGguc2lnbihmdWxsQ29tcGFyZShrZXkwLCBrZXkxKSkgfHwgdGhyb3dSZWRhY3RlZGBEdXBsaWNhdGUgZW50cnkga2V5OiAke2tleTB9YDtcbiAgICAgIH1cbiAgICAgIHNhbWVSYW5rSXRlcmF0b3IgPSBtYWtlQXJyYXlJdGVyYXRvcihzb3J0ZWRUaWVzKTtcbiAgICAgIHJldHVybiBzYW1lUmFua0l0ZXJhdG9yLm5leHQoKTtcbiAgICB9XG4gICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IHRydWUsIHZhbHVlOiB2b2lkIDAgfSk7XG4gIH0pO1xufTtcbmhhcmRlbihnZW5lcmF0ZUZ1bGxTb3J0ZWRFbnRyaWVzKTtcbnZhciBnZW5lcmF0ZUNvbGxlY3Rpb25QYWlyRW50cmllcyA9IChjMSwgYzIsIGdldEVudHJpZXMsIGFic2VudFZhbHVlKSA9PiB7XG4gIGNvbnN0IGUxID0gZ2V0RW50cmllcyhjMSk7XG4gIGNvbnN0IGUyID0gZ2V0RW50cmllcyhjMik7XG4gIGNvbnN0IGZ1bGxDb21wYXJlID0gbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQoKS5hbnRpQ29tcGFyYXRvcjtcbiAgY29uc3QgeCA9IGdlbmVyYXRlRnVsbFNvcnRlZEVudHJpZXMoZTEsIGNvbXBhcmVBbnRpUmFuaywgZnVsbENvbXBhcmUpO1xuICBjb25zdCB5ID0gZ2VuZXJhdGVGdWxsU29ydGVkRW50cmllcyhlMiwgY29tcGFyZUFudGlSYW5rLCBmdWxsQ29tcGFyZSk7XG4gIGxldCB4RG9uZTtcbiAgbGV0IHhLZXk7XG4gIGxldCB4VmFsdWU7XG4gIGxldCB5RG9uZTtcbiAgbGV0IHlLZXk7XG4gIGxldCB5VmFsdWU7XG4gIGNvbnN0IG5vbkVudHJ5ID0gW3ZvaWQgMCwgdm9pZCAwXTtcbiAgY29uc3QgbmV4dFggPSAoKSA9PiB7XG4gICAgIXhEb25lIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IG5leHRYIG11c3Qgbm90IGJlIGNhbGxlZCBvbmNlIGRvbmVgO1xuICAgIGNvbnN0IHJlc3VsdCA9IHhWYWx1ZTtcbiAgICAoeyBkb25lOiB4RG9uZSwgdmFsdWU6IFt4S2V5LCB4VmFsdWVdID0gbm9uRW50cnkgfSA9IHgubmV4dCgpKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuICBuZXh0WCgpO1xuICBjb25zdCBuZXh0WSA9ICgpID0+IHtcbiAgICAheURvbmUgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogbmV4dFkgbXVzdCBub3QgYmUgY2FsbGVkIG9uY2UgZG9uZWA7XG4gICAgY29uc3QgcmVzdWx0ID0geVZhbHVlO1xuICAgICh7IGRvbmU6IHlEb25lLCB2YWx1ZTogW3lLZXksIHlWYWx1ZV0gPSBub25FbnRyeSB9ID0geS5uZXh0KCkpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG4gIG5leHRZKCk7XG4gIHJldHVybiBtYWtlSXRlcmF0b3IoKCkgPT4ge1xuICAgIGxldCBkb25lID0gZmFsc2U7XG4gICAgbGV0IHZhbHVlO1xuICAgIGlmICh4RG9uZSAmJiB5RG9uZSkge1xuICAgICAgZG9uZSA9IHRydWU7XG4gICAgICB2YWx1ZSA9IFt2b2lkIDAsIGFic2VudFZhbHVlLCBhYnNlbnRWYWx1ZV07XG4gICAgfSBlbHNlIGlmICh4RG9uZSkge1xuICAgICAgdmFsdWUgPSBbeUtleSwgYWJzZW50VmFsdWUsIG5leHRZKCldO1xuICAgIH0gZWxzZSBpZiAoeURvbmUpIHtcbiAgICAgIHZhbHVlID0gW3hLZXksIG5leHRYKCksIGFic2VudFZhbHVlXTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgY29tcCA9IGZ1bGxDb21wYXJlKHhLZXksIHlLZXkpO1xuICAgICAgaWYgKGNvbXAgPT09IDApIHtcbiAgICAgICAgdmFsdWUgPSBbeEtleSwgbmV4dFgoKSwgbmV4dFkoKV07XG4gICAgICB9IGVsc2UgaWYgKGNvbXAgPCAwKSB7XG4gICAgICAgIHZhbHVlID0gW3hLZXksIG5leHRYKCksIGFic2VudFZhbHVlXTtcbiAgICAgIH0gZWxzZSBpZiAoY29tcCA+IDApIHtcbiAgICAgICAgdmFsdWUgPSBbeUtleSwgYWJzZW50VmFsdWUsIG5leHRZKCldO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBVbmV4cGVjdGVkIGtleSBjb21wYXJpc29uICR7cXVvdGUoY29tcCl9IGZvciAke3hLZXl9IHZzICR7eUtleX1gO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaGFyZGVuKHsgZG9uZSwgdmFsdWUgfSk7XG4gIH0pO1xufTtcbmhhcmRlbihnZW5lcmF0ZUNvbGxlY3Rpb25QYWlyRW50cmllcyk7XG52YXIgbWFrZUNvbXBhcmVDb2xsZWN0aW9uID0gKGdldEVudHJpZXMsIGFic2VudFZhbHVlLCBjb21wYXJlVmFsdWVzMikgPT4gaGFyZGVuKChsZWZ0LCByaWdodCkgPT4ge1xuICBjb25zdCBtZXJnZWQgPSBnZW5lcmF0ZUNvbGxlY3Rpb25QYWlyRW50cmllcyhcbiAgICBsZWZ0LFxuICAgIHJpZ2h0LFxuICAgIGdldEVudHJpZXMsXG4gICAgYWJzZW50VmFsdWVcbiAgKTtcbiAgbGV0IGxlZnRJc0JpZ2dlciA9IGZhbHNlO1xuICBsZXQgcmlnaHRJc0JpZ2dlciA9IGZhbHNlO1xuICBmb3IgKGNvbnN0IFtfa2V5LCBsZWZ0VmFsdWUsIHJpZ2h0VmFsdWVdIG9mIG1lcmdlZCkge1xuICAgIGNvbnN0IGNvbXAgPSBjb21wYXJlVmFsdWVzMihsZWZ0VmFsdWUsIHJpZ2h0VmFsdWUpO1xuICAgIGlmIChjb21wID09PSAwKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9IGVsc2UgaWYgKGNvbXAgPCAwKSB7XG4gICAgICByaWdodElzQmlnZ2VyID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGNvbXAgPiAwKSB7XG4gICAgICBsZWZ0SXNCaWdnZXIgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBOdW1iZXIuaXNOYU4oY29tcCkgfHwgLy9cbiAgICAgIHRocm93UmVkYWN0ZWRgVW5leHBlY3RlZCB2YWx1ZSBjb21wYXJpc29uICR7cXVvdGUoY29tcCl9IGZvciAke2xlZnRWYWx1ZX0gdnMgJHtyaWdodFZhbHVlfWA7XG4gICAgICByZXR1cm4gTmFOO1xuICAgIH1cbiAgICBpZiAobGVmdElzQmlnZ2VyICYmIHJpZ2h0SXNCaWdnZXIpIHtcbiAgICAgIHJldHVybiBOYU47XG4gICAgfVxuICB9XG4gIHJldHVybiBsZWZ0SXNCaWdnZXIgPyAxIDogcmlnaHRJc0JpZ2dlciA/IC0xIDogMDtcbn0pO1xuaGFyZGVuKG1ha2VDb21wYXJlQ29sbGVjdGlvbik7XG5cbi8vXG52YXIgc2V0Q29tcGFyZSA9IG1ha2VDb21wYXJlQ29sbGVjdGlvbihcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgKChzMikgPT4gaGFyZGVuKGdldENvcHlTZXRLZXlzKHMyKS5tYXAoKGtleSkgPT4gW2tleSwgMV0pKSksXG4gIDAsXG4gIGNvbXBhcmVOdW1lcmljc1xuKTtcbmhhcmRlbihzZXRDb21wYXJlKTtcbnZhciBiYWdDb21wYXJlID0gbWFrZUNvbXBhcmVDb2xsZWN0aW9uKFxuICBnZXRDb3B5QmFnRW50cmllcyxcbiAgMG4sXG4gIGNvbXBhcmVOdW1lcmljc1xuKTtcbmhhcmRlbihiYWdDb21wYXJlKTtcbnZhciBBQlNFTlQgPSBTeW1ib2woXCJhYnNlbnRcIik7XG52YXIgX21hcENvbXBhcmUgPSBtYWtlQ29tcGFyZUNvbGxlY3Rpb24oXG4gIGdldENvcHlNYXBFbnRyeUFycmF5LFxuICBBQlNFTlQsXG4gIChsZWZ0VmFsdWUsIHJpZ2h0VmFsdWUpID0+IHtcbiAgICBpZiAobGVmdFZhbHVlID09PSBBQlNFTlQgJiYgcmlnaHRWYWx1ZSA9PT0gQUJTRU5UKSB7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBVbmV4cGVjdGVkIGFic2VudCBlbnRyeSBwYWlyYDtcbiAgICB9IGVsc2UgaWYgKGxlZnRWYWx1ZSA9PT0gQUJTRU5UKSB7XG4gICAgICByZXR1cm4gLTE7XG4gICAgfSBlbHNlIGlmIChyaWdodFZhbHVlID09PSBBQlNFTlQpIHtcbiAgICAgIHJldHVybiAxO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gY29tcGFyZUtleXMobGVmdFZhbHVlLCByaWdodFZhbHVlKTtcbiAgICB9XG4gIH1cbik7XG5oYXJkZW4oX21hcENvbXBhcmUpO1xudmFyIGNvbXBhcmVLZXlzID0gKGxlZnQsIHJpZ2h0KSA9PiB7XG4gIGFzc2VydEtleShsZWZ0KTtcbiAgYXNzZXJ0S2V5KHJpZ2h0KTtcbiAgY29uc3QgbGVmdFN0eWxlID0gcGFzc1N0eWxlT2YobGVmdCk7XG4gIGNvbnN0IHJpZ2h0U3R5bGUgPSBwYXNzU3R5bGVPZihyaWdodCk7XG4gIGlmIChsZWZ0U3R5bGUgIT09IHJpZ2h0U3R5bGUpIHtcbiAgICByZXR1cm4gTmFOO1xuICB9XG4gIHN3aXRjaCAobGVmdFN0eWxlKSB7XG4gICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgIGNhc2UgXCJudWxsXCI6XG4gICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICBjYXNlIFwiYmlnaW50XCI6XG4gICAgY2FzZSBcInN0cmluZ1wiOlxuICAgIGNhc2UgXCJieXRlQXJyYXlcIjpcbiAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgIHJldHVybiBjb21wYXJlUmFuayhsZWZ0LCByaWdodCk7XG4gICAgfVxuICAgIGNhc2UgXCJudW1iZXJcIjoge1xuICAgICAgY29uc3QgcmFua0NvbXAgPSBjb21wYXJlUmFuayhsZWZ0LCByaWdodCk7XG4gICAgICBpZiAocmFua0NvbXAgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgICBpZiAoTnVtYmVyLmlzTmFOKGxlZnQpIHx8IE51bWJlci5pc05hTihyaWdodCkpIHtcbiAgICAgICAgYXNzZXJ0KCFOdW1iZXIuaXNOYU4obGVmdCkgfHwgIU51bWJlci5pc05hTihyaWdodCkpO1xuICAgICAgICByZXR1cm4gTmFOO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJhbmtDb21wO1xuICAgIH1cbiAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgIGlmIChsZWZ0ID09PSByaWdodCkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOYU47XG4gICAgfVxuICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgY29uc3QgbGVuID0gTWF0aC5taW4obGVmdC5sZW5ndGgsIHJpZ2h0Lmxlbmd0aCk7XG4gICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgbGVuOyBpMiArPSAxKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbXBhcmVLZXlzKGxlZnRbaTJdLCByaWdodFtpMl0pO1xuICAgICAgICBpZiAocmVzdWx0ICE9PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvbXBhcmVSYW5rKGxlZnQubGVuZ3RoLCByaWdodC5sZW5ndGgpO1xuICAgIH1cbiAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICBjb25zdCBsZWZ0TmFtZXMgPSByZWNvcmROYW1lcyhsZWZ0KTtcbiAgICAgIGNvbnN0IHJpZ2h0TmFtZXMgPSByZWNvcmROYW1lcyhyaWdodCk7XG4gICAgICBpZiAoIWtleUVRKGxlZnROYW1lcywgcmlnaHROYW1lcykpIHtcbiAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGxlZnRWYWx1ZXMgPSByZWNvcmRWYWx1ZXMobGVmdCwgbGVmdE5hbWVzKTtcbiAgICAgIGNvbnN0IHJpZ2h0VmFsdWVzID0gcmVjb3JkVmFsdWVzKHJpZ2h0LCByaWdodE5hbWVzKTtcbiAgICAgIGxldCByZXN1bHQgPSAwO1xuICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGxlZnRWYWx1ZXMubGVuZ3RoOyBpMiArPSAxKSB7XG4gICAgICAgIGNvbnN0IGNvbXAgPSBjb21wYXJlS2V5cyhsZWZ0VmFsdWVzW2kyXSwgcmlnaHRWYWx1ZXNbaTJdKTtcbiAgICAgICAgaWYgKE51bWJlci5pc05hTihjb21wKSkge1xuICAgICAgICAgIHJldHVybiBOYU47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3VsdCAhPT0gY29tcCAmJiBjb21wICE9PSAwKSB7XG4gICAgICAgICAgaWYgKHJlc3VsdCA9PT0gMCkge1xuICAgICAgICAgICAgcmVzdWx0ID0gY29tcDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXNzZXJ0KFxuICAgICAgICAgICAgICByZXN1bHQgPT09IC0xICYmIGNvbXAgPT09IDEgfHwgcmVzdWx0ID09PSAxICYmIGNvbXAgPT09IC0xXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgY29uc3QgbGVmdFRhZyA9IGdldFRhZyhsZWZ0KTtcbiAgICAgIGNvbnN0IHJpZ2h0VGFnID0gZ2V0VGFnKHJpZ2h0KTtcbiAgICAgIGlmIChsZWZ0VGFnICE9PSByaWdodFRhZykge1xuICAgICAgICByZXR1cm4gTmFOO1xuICAgICAgfVxuICAgICAgc3dpdGNoIChsZWZ0VGFnKSB7XG4gICAgICAgIGNhc2UgXCJjb3B5U2V0XCI6IHtcbiAgICAgICAgICByZXR1cm4gc2V0Q29tcGFyZShsZWZ0LCByaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImNvcHlCYWdcIjoge1xuICAgICAgICAgIHJldHVybiBiYWdDb21wYXJlKGxlZnQsIHJpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiY29weU1hcFwiOiB7XG4gICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBNYXAgY29tcGFyaXNvbiBub3QgeWV0IGltcGxlbWVudGVkOiAke2xlZnR9IHZzICR7cmlnaHR9YDtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIHRhZyAke3F1b3RlKGxlZnRUYWcpfTogJHtsZWZ0fWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIHBhc3NTdHlsZSAke3F1b3RlKGxlZnRTdHlsZSl9OiAke2xlZnR9YDtcbiAgICB9XG4gIH1cbn07XG5oYXJkZW4oY29tcGFyZUtleXMpO1xudmFyIGtleUxUID0gKGxlZnQsIHJpZ2h0KSA9PiBjb21wYXJlS2V5cyhsZWZ0LCByaWdodCkgPCAwO1xuaGFyZGVuKGtleUxUKTtcbnZhciBrZXlMVEUgPSAobGVmdCwgcmlnaHQpID0+IGNvbXBhcmVLZXlzKGxlZnQsIHJpZ2h0KSA8PSAwO1xuaGFyZGVuKGtleUxURSk7XG52YXIga2V5RVEgPSAobGVmdCwgcmlnaHQpID0+IGNvbXBhcmVLZXlzKGxlZnQsIHJpZ2h0KSA9PT0gMDtcbmhhcmRlbihrZXlFUSk7XG52YXIga2V5R1RFID0gKGxlZnQsIHJpZ2h0KSA9PiBjb21wYXJlS2V5cyhsZWZ0LCByaWdodCkgPj0gMDtcbmhhcmRlbihrZXlHVEUpO1xudmFyIGtleUdUID0gKGxlZnQsIHJpZ2h0KSA9PiBjb21wYXJlS2V5cyhsZWZ0LCByaWdodCkgPiAwO1xuaGFyZGVuKGtleUdUKTtcblxuLy9cbnZhciB3aW5kb3dSZXNvcnQgPSAoZWxlbWVudHMsIHJhbmtDb21wYXJlLCBmdWxsQ29tcGFyZSkgPT4ge1xuICBhc3NlcnRSYW5rU29ydGVkKGVsZW1lbnRzLCByYW5rQ29tcGFyZSk7XG4gIGNvbnN0IHsgbGVuZ3RoIH0gPSBlbGVtZW50cztcbiAgbGV0IGkyID0gMDtcbiAgbGV0IG9wdElubmVySXRlcmF0b3I7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiBoYXJkZW4oe1xuICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICBpZiAob3B0SW5uZXJJdGVyYXRvcikge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IG9wdElubmVySXRlcmF0b3IubmV4dCgpO1xuICAgICAgICAgIGlmIChyZXN1bHQuZG9uZSkge1xuICAgICAgICAgICAgb3B0SW5uZXJJdGVyYXRvciA9IHZvaWQgMDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGkyIDwgbGVuZ3RoKSB7XG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBlbGVtZW50c1tpMl07XG4gICAgICAgICAgbGV0IGogPSBpMiArIDE7XG4gICAgICAgICAgd2hpbGUgKGogPCBsZW5ndGggJiYgcmFua0NvbXBhcmUodmFsdWUsIGVsZW1lbnRzW2pdKSA9PT0gMCkge1xuICAgICAgICAgICAgaiArPSAxO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaiA9PT0gaTIgKyAxKSB7XG4gICAgICAgICAgICBpMiA9IGo7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBzaW1pbGFyUnVuID0gZWxlbWVudHMuc2xpY2UoaTIsIGopO1xuICAgICAgICAgIGkyID0gajtcbiAgICAgICAgICBjb25zdCByZXNvcnRlZCA9IHNvcnRCeVJhbmsoc2ltaWxhclJ1biwgZnVsbENvbXBhcmUpO1xuICAgICAgICAgIGFzc2VydE5vRHVwbGljYXRlcyhyZXNvcnRlZCwgZnVsbENvbXBhcmUpO1xuICAgICAgICAgIG9wdElubmVySXRlcmF0b3IgPSByZXNvcnRlZFtTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICAgICAgcmV0dXJuIG9wdElubmVySXRlcmF0b3IubmV4dCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZTogbnVsbCB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gIH0pO1xufTtcbnZhciBtZXJnZSA9ICh4ZWxlbWVudHMsIHllbGVtZW50cykgPT4ge1xuICBjb25zdCBmdWxsQ29tcGFyZSA9IG1ha2VGdWxsT3JkZXJDb21wYXJhdG9yS2l0KCkuYW50aUNvbXBhcmF0b3I7XG4gIGNvbnN0IHhzID0gd2luZG93UmVzb3J0KHhlbGVtZW50cywgY29tcGFyZUFudGlSYW5rLCBmdWxsQ29tcGFyZSk7XG4gIGNvbnN0IHlzID0gd2luZG93UmVzb3J0KHllbGVtZW50cywgY29tcGFyZUFudGlSYW5rLCBmdWxsQ29tcGFyZSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBsZXQgeDtcbiAgICAgIGxldCB4RG9uZTtcbiAgICAgIGxldCB5O1xuICAgICAgbGV0IHlEb25lO1xuICAgICAgY29uc3QgeGkgPSB4c1tTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICBjb25zdCBuZXh0WCA9ICgpID0+IHtcbiAgICAgICAgIXhEb25lIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IG5leHRYIHNob3VsZCBub3QgYmUgY2FsbGVkIG9uY2UgZG9uZWA7XG4gICAgICAgICh7IGRvbmU6IHhEb25lLCB2YWx1ZTogeCB9ID0geGkubmV4dCgpKTtcbiAgICAgIH07XG4gICAgICBuZXh0WCgpO1xuICAgICAgY29uc3QgeWkgPSB5c1tTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICBjb25zdCBuZXh0WSA9ICgpID0+IHtcbiAgICAgICAgIXlEb25lIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IG5leHRZIHNob3VsZCBub3QgYmUgY2FsbGVkIG9uY2UgZG9uZWA7XG4gICAgICAgICh7IGRvbmU6IHlEb25lLCB2YWx1ZTogeSB9ID0geWkubmV4dCgpKTtcbiAgICAgIH07XG4gICAgICBuZXh0WSgpO1xuICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBsZXQgZG9uZSA9IGZhbHNlO1xuICAgICAgICAgIGxldCB2YWx1ZTtcbiAgICAgICAgICBpZiAoeERvbmUgJiYgeURvbmUpIHtcbiAgICAgICAgICAgIGRvbmUgPSB0cnVlO1xuICAgICAgICAgICAgdmFsdWUgPSBbbnVsbCwgMG4sIDBuXTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHhEb25lKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IFt5LCAwbiwgMW5dO1xuICAgICAgICAgICAgbmV4dFkoKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHlEb25lKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IFt4LCAxbiwgMG5dO1xuICAgICAgICAgICAgbmV4dFgoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgY29tcCA9IGZ1bGxDb21wYXJlKHgsIHkpO1xuICAgICAgICAgICAgaWYgKGNvbXAgPT09IDApIHtcbiAgICAgICAgICAgICAgdmFsdWUgPSBbeCwgMW4sIDFuXTtcbiAgICAgICAgICAgICAgbmV4dFgoKTtcbiAgICAgICAgICAgICAgbmV4dFkoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29tcCA8IDApIHtcbiAgICAgICAgICAgICAgdmFsdWUgPSBbeCwgMW4sIDBuXTtcbiAgICAgICAgICAgICAgbmV4dFgoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbXAgPiAwIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IFVuZXhwZWN0ZWQgY29tcCAke3F1b3RlKGNvbXApfWA7XG4gICAgICAgICAgICAgIHZhbHVlID0gW3ksIDBuLCAxbl07XG4gICAgICAgICAgICAgIG5leHRZKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lLCB2YWx1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4obWVyZ2UpO1xudmFyIGl0ZXJJc1N1cGVyc2V0ID0gKHh5aSkgPT4ge1xuICBmb3IgKGNvbnN0IFtfbSwgeGMsIF95Y10gb2YgeHlpKSB7XG4gICAgaWYgKHhjID09PSAwbikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgaXRlcklzRGlzam9pbnQgPSAoeHlpKSA9PiB7XG4gIGZvciAoY29uc3QgW19tLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGlmICh4YyA+PSAxbiAmJiB5YyA+PSAxbikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgaXRlckNvbXBhcmUgPSAoeHlpKSA9PiB7XG4gIGxldCBsb25lWSA9IGZhbHNlO1xuICBsZXQgbG9uZVggPSBmYWxzZTtcbiAgZm9yIChjb25zdCBbX20sIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgaWYgKHhjID09PSAwbikge1xuICAgICAgbG9uZVkgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoeWMgPT09IDBuKSB7XG4gICAgICBsb25lWCA9IHRydWU7XG4gICAgfVxuICAgIGlmIChsb25lWCAmJiBsb25lWSkge1xuICAgICAgcmV0dXJuIE5hTjtcbiAgICB9XG4gIH1cbiAgaWYgKGxvbmVYKSB7XG4gICAgcmV0dXJuIDE7XG4gIH0gZWxzZSBpZiAobG9uZVkpIHtcbiAgICByZXR1cm4gLTE7XG4gIH0gZWxzZSB7XG4gICAgIWxvbmVYICYmICFsb25lWSB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBVbmV4cGVjdGVkIGxvbmUgcGFpciAke3F1b3RlKFtsb25lWCwgbG9uZVldKX1gO1xuICAgIHJldHVybiAwO1xuICB9XG59O1xudmFyIGl0ZXJVbmlvbiA9ICh4eWkpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgW20yLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGlmICh4YyA+PSAwbikge1xuICAgICAgcmVzdWx0LnB1c2gobTIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB5YyA+PSAwbiB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBVbmV4cGVjdGVkIGNvdW50ICR7cXVvdGUoeWMpfWA7XG4gICAgICByZXN1bHQucHVzaChtMik7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xudmFyIGl0ZXJEaXNqb2ludFVuaW9uID0gKHh5aSkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgZm9yIChjb25zdCBbbTIsIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgeGMgPT09IDBuIHx8IHljID09PSAwbiB8fCB0aHJvd1JlZGFjdGVkYFNldHMgbXVzdCBub3QgaGF2ZSBjb21tb24gZWxlbWVudHM6ICR7bTJ9YDtcbiAgICBpZiAoeGMgPj0gMW4pIHtcbiAgICAgIHJlc3VsdC5wdXNoKG0yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgeWMgPj0gMW4gfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogVW5leHBlY3RlZCBjb3VudCAke3F1b3RlKHljKX1gO1xuICAgICAgcmVzdWx0LnB1c2gobTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBpdGVySW50ZXJzZWN0aW9uID0gKHh5aSkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgZm9yIChjb25zdCBbbTIsIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgaWYgKHhjID49IDFuICYmIHljID49IDFuKSB7XG4gICAgICByZXN1bHQucHVzaChtMik7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xudmFyIGl0ZXJEaXNqb2ludFN1YnRyYWN0ID0gKHh5aSkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgZm9yIChjb25zdCBbbTIsIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgeGMgPj0gMW4gfHwgdGhyb3dSZWRhY3RlZGByaWdodCBlbGVtZW50ICR7bTJ9IHdhcyBub3QgaW4gbGVmdGA7XG4gICAgaWYgKHljID09PSAwbikge1xuICAgICAgcmVzdWx0LnB1c2gobTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBtZXJnZWlmeSA9IChpdGVyT3ApID0+ICh4ZWxlbWVudHMsIHllbGVtZW50cykgPT4gaXRlck9wKG1lcmdlKHhlbGVtZW50cywgeWVsZW1lbnRzKSk7XG52YXIgZWxlbWVudHNJc1N1cGVyc2V0ID0gbWVyZ2VpZnkoaXRlcklzU3VwZXJzZXQpO1xudmFyIGVsZW1lbnRzSXNEaXNqb2ludCA9IG1lcmdlaWZ5KGl0ZXJJc0Rpc2pvaW50KTtcbnZhciBlbGVtZW50c0NvbXBhcmUgPSBtZXJnZWlmeShpdGVyQ29tcGFyZSk7XG52YXIgZWxlbWVudHNVbmlvbiA9IG1lcmdlaWZ5KGl0ZXJVbmlvbik7XG52YXIgZWxlbWVudHNEaXNqb2ludFVuaW9uID0gbWVyZ2VpZnkoaXRlckRpc2pvaW50VW5pb24pO1xudmFyIGVsZW1lbnRzSW50ZXJzZWN0aW9uID0gbWVyZ2VpZnkoaXRlckludGVyc2VjdGlvbik7XG52YXIgZWxlbWVudHNEaXNqb2ludFN1YnRyYWN0ID0gbWVyZ2VpZnkoaXRlckRpc2pvaW50U3VidHJhY3QpO1xudmFyIHJhd1NldGlmeSA9IChlbGVtZW50c09wKSA9PiAoeHNldCwgeXNldCkgPT4gZWxlbWVudHNPcCh4c2V0LnBheWxvYWQsIHlzZXQucGF5bG9hZCk7XG52YXIgc2V0aWZ5ID0gKGVsZW1lbnRzT3ApID0+ICh4c2V0LCB5c2V0KSA9PiBtYWtlU2V0T2ZFbGVtZW50cyhlbGVtZW50c09wKHhzZXQucGF5bG9hZCwgeXNldC5wYXlsb2FkKSk7XG52YXIgc2V0SXNTdXBlcnNldCA9IHJhd1NldGlmeShlbGVtZW50c0lzU3VwZXJzZXQpO1xudmFyIHNldElzRGlzam9pbnQgPSByYXdTZXRpZnkoZWxlbWVudHNJc0Rpc2pvaW50KTtcbnZhciBzZXRVbmlvbiA9IHNldGlmeShlbGVtZW50c1VuaW9uKTtcbnZhciBzZXREaXNqb2ludFVuaW9uID0gc2V0aWZ5KGVsZW1lbnRzRGlzam9pbnRVbmlvbik7XG52YXIgc2V0SW50ZXJzZWN0aW9uID0gc2V0aWZ5KGVsZW1lbnRzSW50ZXJzZWN0aW9uKTtcbnZhciBzZXREaXNqb2ludFN1YnRyYWN0ID0gc2V0aWZ5KGVsZW1lbnRzRGlzam9pbnRTdWJ0cmFjdCk7XG5cbi8vXG52YXIgYmFnV2luZG93UmVzb3J0ID0gKGJhZ0VudHJpZXMsIHJhbmtDb21wYXJlLCBmdWxsQ29tcGFyZSkgPT4ge1xuICBhc3NlcnRSYW5rU29ydGVkKGJhZ0VudHJpZXMsIHJhbmtDb21wYXJlKTtcbiAgY29uc3QgeyBsZW5ndGggfSA9IGJhZ0VudHJpZXM7XG4gIGxldCBpMiA9IDA7XG4gIGxldCBvcHRJbm5lckl0ZXJhdG9yO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4gaGFyZGVuKHtcbiAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgaWYgKG9wdElubmVySXRlcmF0b3IpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBvcHRJbm5lckl0ZXJhdG9yLm5leHQoKTtcbiAgICAgICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgICAgIG9wdElubmVySXRlcmF0b3IgPSB2b2lkIDA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChpMiA8IGxlbmd0aCkge1xuICAgICAgICAgIGNvbnN0IGVudHJ5ID0gYmFnRW50cmllc1tpMl07XG4gICAgICAgICAgbGV0IGogPSBpMiArIDE7XG4gICAgICAgICAgd2hpbGUgKGogPCBsZW5ndGggJiYgcmFua0NvbXBhcmUoZW50cnlbMF0sIGJhZ0VudHJpZXNbal1bMF0pID09PSAwKSB7XG4gICAgICAgICAgICBqICs9IDE7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChqID09PSBpMiArIDEpIHtcbiAgICAgICAgICAgIGkyID0gajtcbiAgICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWU6IGVudHJ5IH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBzaW1pbGFyUnVuID0gYmFnRW50cmllcy5zbGljZShpMiwgaik7XG4gICAgICAgICAgaTIgPSBqO1xuICAgICAgICAgIGNvbnN0IHJlc29ydGVkID0gc29ydEJ5UmFuayhzaW1pbGFyUnVuLCBmdWxsQ29tcGFyZSk7XG4gICAgICAgICAgYXNzZXJ0Tm9EdXBsaWNhdGVLZXlzKHJlc29ydGVkLCBmdWxsQ29tcGFyZSk7XG4gICAgICAgICAgb3B0SW5uZXJJdGVyYXRvciA9IHJlc29ydGVkW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgICAgICByZXR1cm4gb3B0SW5uZXJJdGVyYXRvci5uZXh0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IHRydWUsIHZhbHVlOiBbbnVsbCwgMG5dIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfSk7XG59O1xudmFyIG1lcmdlMiA9ICh4YmFnRW50cmllcywgeWJhZ0VudHJpZXMpID0+IHtcbiAgY29uc3QgZnVsbENvbXBhcmUgPSBtYWtlRnVsbE9yZGVyQ29tcGFyYXRvcktpdCgpLmFudGlDb21wYXJhdG9yO1xuICBjb25zdCB4cyA9IGJhZ1dpbmRvd1Jlc29ydCh4YmFnRW50cmllcywgY29tcGFyZUFudGlSYW5rLCBmdWxsQ29tcGFyZSk7XG4gIGNvbnN0IHlzID0gYmFnV2luZG93UmVzb3J0KHliYWdFbnRyaWVzLCBjb21wYXJlQW50aVJhbmssIGZ1bGxDb21wYXJlKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGxldCB4O1xuICAgICAgbGV0IHhjO1xuICAgICAgbGV0IHhEb25lO1xuICAgICAgbGV0IHk7XG4gICAgICBsZXQgeWM7XG4gICAgICBsZXQgeURvbmU7XG4gICAgICBjb25zdCB4aSA9IHhzW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgIGNvbnN0IG5leHRYID0gKCkgPT4ge1xuICAgICAgICAheERvbmUgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogbmV4dFggc2hvdWxkIG5vdCBiZSBjYWxsZWQgb25jZSBkb25lYDtcbiAgICAgICAgKHtcbiAgICAgICAgICBkb25lOiB4RG9uZSxcbiAgICAgICAgICB2YWx1ZTogW3gsIHhjXVxuICAgICAgICB9ID0geGkubmV4dCgpKTtcbiAgICAgIH07XG4gICAgICBuZXh0WCgpO1xuICAgICAgY29uc3QgeWkgPSB5c1tTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICBjb25zdCBuZXh0WSA9ICgpID0+IHtcbiAgICAgICAgIXlEb25lIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IG5leHRZIHNob3VsZCBub3QgYmUgY2FsbGVkIG9uY2UgZG9uZWA7XG4gICAgICAgICh7XG4gICAgICAgICAgZG9uZTogeURvbmUsXG4gICAgICAgICAgdmFsdWU6IFt5LCB5Y11cbiAgICAgICAgfSA9IHlpLm5leHQoKSk7XG4gICAgICB9O1xuICAgICAgbmV4dFkoKTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgbGV0IGRvbmUgPSBmYWxzZTtcbiAgICAgICAgICBsZXQgdmFsdWU7XG4gICAgICAgICAgaWYgKHhEb25lICYmIHlEb25lKSB7XG4gICAgICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhbHVlID0gW251bGwsIDBuLCAwbl07XG4gICAgICAgICAgfSBlbHNlIGlmICh4RG9uZSkge1xuICAgICAgICAgICAgdmFsdWUgPSBbeSwgMG4sIHljXTtcbiAgICAgICAgICAgIG5leHRZKCk7XG4gICAgICAgICAgfSBlbHNlIGlmICh5RG9uZSkge1xuICAgICAgICAgICAgdmFsdWUgPSBbeCwgeGMsIDBuXTtcbiAgICAgICAgICAgIG5leHRYKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbXAgPSBmdWxsQ29tcGFyZSh4LCB5KTtcbiAgICAgICAgICAgIGlmIChjb21wID09PSAwKSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gW3gsIHhjLCB5Y107XG4gICAgICAgICAgICAgIG5leHRYKCk7XG4gICAgICAgICAgICAgIG5leHRZKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbXAgPCAwKSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gW3gsIHhjLCAwbl07XG4gICAgICAgICAgICAgIG5leHRYKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb21wID4gMCB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBVbmV4cGVjdGVkIGNvbXAgJHtxdW90ZShjb21wKX1gO1xuICAgICAgICAgICAgICB2YWx1ZSA9IFt5LCAwbiwgeWNdO1xuICAgICAgICAgICAgICBuZXh0WSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZSwgdmFsdWUgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKG1lcmdlMik7XG52YXIgYmFnSXRlcklzU3VwZXJiYWcgPSAoeHlpKSA9PiB7XG4gIGZvciAoY29uc3QgW19tLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGlmICh4YyA8IHljKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufTtcbnZhciBiYWdJdGVySXNEaXNqb2ludCA9ICh4eWkpID0+IHtcbiAgZm9yIChjb25zdCBbX20sIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgaWYgKHhjID49IDFuICYmIHljID49IDFuKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufTtcbnZhciBiYWdJdGVyVW5pb24gPSAoeHlpKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBmb3IgKGNvbnN0IFttMiwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICByZXN1bHQucHVzaChbbTIsIHhjICsgeWNdKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBiYWdJdGVySW50ZXJzZWN0aW9uID0gKHh5aSkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgZm9yIChjb25zdCBbbTIsIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgY29uc3QgbWMgPSB4YyA8PSB5YyA/IHhjIDogeWM7XG4gICAgcmVzdWx0LnB1c2goW20yLCBtY10pO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xudmFyIGJhZ0l0ZXJEaXNqb2ludFN1YnRyYWN0ID0gKHh5aSkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgZm9yIChjb25zdCBbbTIsIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgY29uc3QgbWMgPSB4YyAtIHljO1xuICAgIG1jID49IDBuIHx8IHRocm93UmVkYWN0ZWRgcmlnaHQgZWxlbWVudCAke20yfSB3YXMgbm90IGluIGxlZnRgO1xuICAgIGlmIChtYyA+PSAxbikge1xuICAgICAgcmVzdWx0LnB1c2goW20yLCBtY10pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBtZXJnZWlmeTIgPSAoYmFnSXRlck9wKSA9PiAoeGJhZ0VudHJpZXMsIHliYWdFbnRyaWVzKSA9PiBiYWdJdGVyT3AobWVyZ2UyKHhiYWdFbnRyaWVzLCB5YmFnRW50cmllcykpO1xudmFyIGJhZ0VudHJpZXNJc1N1cGVyYmFnID0gbWVyZ2VpZnkyKGJhZ0l0ZXJJc1N1cGVyYmFnKTtcbnZhciBiYWdFbnRyaWVzSXNEaXNqb2ludCA9IG1lcmdlaWZ5MihiYWdJdGVySXNEaXNqb2ludCk7XG52YXIgYmFnRW50cmllc1VuaW9uID0gbWVyZ2VpZnkyKGJhZ0l0ZXJVbmlvbik7XG52YXIgYmFnRW50cmllc0ludGVyc2VjdGlvbiA9IG1lcmdlaWZ5MihiYWdJdGVySW50ZXJzZWN0aW9uKTtcbnZhciBiYWdFbnRyaWVzRGlzam9pbnRTdWJ0cmFjdCA9IG1lcmdlaWZ5MihiYWdJdGVyRGlzam9pbnRTdWJ0cmFjdCk7XG52YXIgcmF3QmFnaWZ5ID0gKGJhZ0VudHJpZXNPcCkgPT4gKHhiYWcsIHliYWcpID0+IGJhZ0VudHJpZXNPcCh4YmFnLnBheWxvYWQsIHliYWcucGF5bG9hZCk7XG52YXIgYmFnaWZ5ID0gKGJhZ0VudHJpZXNPcCkgPT4gKHhiYWcsIHliYWcpID0+IG1ha2VCYWdPZkVudHJpZXMoYmFnRW50cmllc09wKHhiYWcucGF5bG9hZCwgeWJhZy5wYXlsb2FkKSk7XG52YXIgYmFnSXNTdXBlcmJhZyA9IHJhd0JhZ2lmeShiYWdFbnRyaWVzSXNTdXBlcmJhZyk7XG52YXIgYmFnSXNEaXNqb2ludCA9IHJhd0JhZ2lmeShiYWdFbnRyaWVzSXNEaXNqb2ludCk7XG52YXIgYmFnVW5pb24gPSBiYWdpZnkoYmFnRW50cmllc1VuaW9uKTtcbnZhciBiYWdJbnRlcnNlY3Rpb24gPSBiYWdpZnkoYmFnRW50cmllc0ludGVyc2VjdGlvbik7XG52YXIgYmFnRGlzam9pbnRTdWJ0cmFjdCA9IGJhZ2lmeShiYWdFbnRyaWVzRGlzam9pbnRTdWJ0cmFjdCk7XG5cbi8vXG52YXIgdGhyb3dMYWJlbGVkID0gKGlubmVyRXJyLCBsYWJlbCwgZXJyQ29uc3RydWN0b3IgPSB2b2lkIDAsIG9wdGlvbnMgPSB2b2lkIDApID0+IHtcbiAgaWYgKHR5cGVvZiBsYWJlbCA9PT0gXCJudW1iZXJcIikge1xuICAgIGxhYmVsID0gYFske2xhYmVsfV1gO1xuICB9XG4gIGNvbnN0IG91dGVyRXJyID0gbWFrZUVycm9yKFxuICAgIGAke2xhYmVsfTogJHtpbm5lckVyci5tZXNzYWdlfWAsXG4gICAgZXJyQ29uc3RydWN0b3IsXG4gICAgb3B0aW9uc1xuICApO1xuICBub3RlKG91dGVyRXJyLCByZWRhY3RlZGBDYXVzZWQgYnkgJHtpbm5lckVycn1gKTtcbiAgdGhyb3cgb3V0ZXJFcnI7XG59O1xuaGFyZGVuKHRocm93TGFiZWxlZCk7XG5cbi8vXG52YXIgYXBwbHlMYWJlbGluZ0Vycm9yID0gKGZ1bmMsIGFyZ3MsIGxhYmVsID0gdm9pZCAwKSA9PiB7XG4gIGlmIChsYWJlbCA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIGZ1bmMoLi4uYXJncyk7XG4gIH1cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBmdW5jKC4uLmFyZ3MpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICB0aHJvd0xhYmVsZWQoZXJyLCBsYWJlbCk7XG4gIH1cbiAgaWYgKGlzUHJvbWlzZShyZXN1bHQpKSB7XG4gICAgcmV0dXJuIEUud2hlbihyZXN1bHQsIHZvaWQgMCwgKHJlYXNvbikgPT4gdGhyb3dMYWJlbGVkKHJlYXNvbiwgbGFiZWwpKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG59O1xuaGFyZGVuKGFwcGx5TGFiZWxpbmdFcnJvcik7XG5cbi8vXG52YXIgeyBmcm9tRW50cmllczogZnJvbUVudHJpZXM3IH0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzMTcgfSA9IFJlZmxlY3Q7XG52YXIgZnJvbVVuaXF1ZUVudHJpZXMgPSAoYWxsRW50cmllcykgPT4ge1xuICBjb25zdCBlbnRyaWVzQXJyYXkgPSBbLi4uYWxsRW50cmllc107XG4gIGNvbnN0IHJlc3VsdCA9IGhhcmRlbihmcm9tRW50cmllczcoZW50cmllc0FycmF5KSk7XG4gIGlmIChvd25LZXlzMTcocmVzdWx0KS5sZW5ndGggPT09IGVudHJpZXNBcnJheS5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG4gIGNvbnN0IG5hbWVzID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgZm9yIChjb25zdCBbbmFtZSwgX10gb2YgZW50cmllc0FycmF5KSB7XG4gICAgaWYgKG5hbWVzLmhhcyhuYW1lKSkge1xuICAgICAgdGhyb3dSZWRhY3RlZGBjb2xsaXNpb24gb24gcHJvcGVydHkgbmFtZSAke3F1b3RlKG5hbWUpfTogJHtlbnRyaWVzQXJyYXl9YDtcbiAgICB9XG4gICAgbmFtZXMuYWRkKG5hbWUpO1xuICB9XG4gIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGZhaWxlZCB0byBjcmVhdGUgb2JqZWN0IGZyb20gdW5pcXVlIGVudHJpZXNgO1xufTtcbmhhcmRlbihmcm9tVW5pcXVlRW50cmllcyk7XG5cbi8vXG52YXIgbGlzdERpZmZlcmVuY2UgPSAobGVmdExpc3QsIHJpZ2h0TGlzdCkgPT4ge1xuICBjb25zdCByaWdodFNldCA9IG5ldyBTZXQocmlnaHRMaXN0KTtcbiAgcmV0dXJuIGxlZnRMaXN0LmZpbHRlcigoZWxlbWVudCkgPT4gIXJpZ2h0U2V0LmhhcyhlbGVtZW50KSk7XG59O1xuaGFyZGVuKGxpc3REaWZmZXJlbmNlKTtcblxuLy9cbnZhciB7IGVudHJpZXM6IGVudHJpZXM3LCB2YWx1ZXM6IHZhbHVlczIsIGhhc093bjogaGFzT3duOSB9ID0gT2JqZWN0O1xudmFyIHsgb3duS2V5czogb3duS2V5czE4IH0gPSBSZWZsZWN0O1xudmFyIHBhdHRlcm5NZW1vID0gLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCk7XG52YXIgTU07XG52YXIgZGVmYXVsdExpbWl0cyA9IGhhcmRlbih7XG4gIGRlY2ltYWxEaWdpdHNMaW1pdDogMTAwLFxuICBzdHJpbmdMZW5ndGhMaW1pdDogMWU1LFxuICBzeW1ib2xOYW1lTGVuZ3RoTGltaXQ6IDEwMCxcbiAgbnVtUHJvcGVydGllc0xpbWl0OiA4MCxcbiAgcHJvcGVydHlOYW1lTGVuZ3RoTGltaXQ6IDEwMCxcbiAgYXJyYXlMZW5ndGhMaW1pdDogMWU0LFxuICBieXRlTGVuZ3RoTGltaXQ6IDFlNSxcbiAgbnVtU2V0RWxlbWVudHNMaW1pdDogMWU0LFxuICBudW1VbmlxdWVCYWdFbGVtZW50c0xpbWl0OiAxZTQsXG4gIG51bU1hcEVudHJpZXNMaW1pdDogNWUzXG59KTtcbnZhciBsaW1pdCA9IChsaW1pdHMgPSB7fSkgPT4gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgaGFyZGVuKHsgX19wcm90b19fOiBkZWZhdWx0TGltaXRzLCAuLi5saW1pdHMgfSlcbik7XG52YXIgY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQgPSAocGF5bG9hZCwgbWFpblBheWxvYWRTaGFwZSwgY2hlY2ssIGxhYmVsKSA9PiB7XG4gIGFzc2VydChBcnJheS5pc0FycmF5KG1haW5QYXlsb2FkU2hhcGUpKTtcbiAgaWYgKCFBcnJheS5pc0FycmF5KHBheWxvYWQpKSB7XG4gICAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke3F1b3RlKGxhYmVsKX0gcGF5bG9hZCBtdXN0IGJlIGFuIGFycmF5OiAke3BheWxvYWR9YCk7XG4gIH1cbiAgY29uc3QgbWFpbkxlbmd0aCA9IG1haW5QYXlsb2FkU2hhcGUubGVuZ3RoO1xuICBpZiAoIShwYXlsb2FkLmxlbmd0aCA9PT0gbWFpbkxlbmd0aCB8fCBwYXlsb2FkLmxlbmd0aCA9PT0gbWFpbkxlbmd0aCArIDEpKSB7XG4gICAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke3F1b3RlKGxhYmVsKX0gcGF5bG9hZCB1bmV4cGVjdGVkIHNpemU6ICR7cGF5bG9hZH1gKTtcbiAgfVxuICBjb25zdCBsaW1pdHMgPSBwYXlsb2FkW21haW5MZW5ndGhdO1xuICBwYXlsb2FkID0gaGFyZGVuKHBheWxvYWQuc2xpY2UoMCwgbWFpbkxlbmd0aCkpO1xuICBpZiAoIWNoZWNrTWF0Y2hlcyhwYXlsb2FkLCBtYWluUGF5bG9hZFNoYXBlLCBjaGVjaywgbGFiZWwpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGlmIChsaW1pdHMgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiAocGFzc1N0eWxlT2YobGltaXRzKSA9PT0gXCJjb3B5UmVjb3JkXCIgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYExpbWl0cyBtdXN0IGJlIGEgcmVjb3JkOiAke3F1b3RlKGxpbWl0cyl9YCkpICYmIGVudHJpZXM3KGxpbWl0cykuZXZlcnkoXG4gICAgKFtrZXksIHZhbHVlXSkgPT4gcGFzc1N0eWxlT2YodmFsdWUpID09PSBcIm51bWJlclwiIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBWYWx1ZSBvZiBsaW1pdCAke3F1b3RlKGtleSl9IGJ1dCBiZSBhIG51bWJlcjogJHtxdW90ZSh2YWx1ZSl9YClcbiAgKTtcbn07XG52YXIgY2hlY2tEZWNpbWFsRGlnaXRzTGltaXQgPSAoc3BlY2ltZW4sIGRlY2ltYWxEaWdpdHNMaW1pdCwgY2hlY2spID0+IHtcbiAgaWYgKE1hdGguZmxvb3IoTWF0aC5sb2cxMChNYXRoLmFicyhOdW1iZXIoc3BlY2ltZW4pKSkpICsgMSA8PSBkZWNpbWFsRGlnaXRzTGltaXQpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gY2hlY2soXG4gICAgZmFsc2UsXG4gICAgcmVkYWN0ZWRgYmlnaW50ICR7c3BlY2ltZW59IG11c3Qgbm90IGhhdmUgbW9yZSB0aGFuICR7ZGVjaW1hbERpZ2l0c0xpbWl0fSBkaWdpdHNgXG4gICk7XG59O1xudmFyIG1ha2VQYXR0ZXJuS2l0ID0gKCkgPT4ge1xuICBjb25zdCBtYXliZU1hdGNoSGVscGVyID0gKHRhZykgPT4gKFxuICAgIC8vXG4gICAgSGVscGVyc0J5TWF0Y2hUYWdbdGFnXVxuICApO1xuICBjb25zdCBtYXliZVBheWxvYWRTaGFwZSA9ICh0YWcpID0+IChcbiAgICAvL1xuICAgIEd1YXJkUGF5bG9hZFNoYXBlc1t0YWddXG4gICk7XG4gIGNvbnN0IHNpbmdsZXRvbktpbmRzID0gLyogICAgICAgICAgICovIG5ldyBNYXAoW1xuICAgIFtcIm51bGxcIiwgbnVsbF0sXG4gICAgW1widW5kZWZpbmVkXCIsIHZvaWQgMF1cbiAgXSk7XG4gIGNvbnN0IHRhZ01lbW8gPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgY2hlY2tUYWdnZWQgPSAodGFnZ2VkLCB0YWcsIGNoZWNrKSA9PiB7XG4gICAgY29uc3QgbWF0Y2hIZWxwZXIgPSBtYXliZU1hdGNoSGVscGVyKHRhZyk7XG4gICAgaWYgKG1hdGNoSGVscGVyKSB7XG4gICAgICByZXR1cm4gbWF0Y2hIZWxwZXIuY2hlY2tJc1dlbGxGb3JtZWQodGFnZ2VkLnBheWxvYWQsIGNoZWNrKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgcGF5bG9hZFNoYXBlID0gbWF5YmVQYXlsb2FkU2hhcGUodGFnKTtcbiAgICAgIGlmIChwYXlsb2FkU2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4gY2hlY2tNYXRjaGVzMih0YWdnZWQucGF5bG9hZCwgcGF5bG9hZFNoYXBlLCBjaGVjaywgdGFnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgc3dpdGNoICh0YWcpIHtcbiAgICAgIGNhc2UgXCJjb3B5U2V0XCI6IHtcbiAgICAgICAgcmV0dXJuIGNoZWNrQ29weVNldCh0YWdnZWQsIGNoZWNrKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5QmFnXCI6IHtcbiAgICAgICAgcmV0dXJuIGNoZWNrQ29weUJhZyh0YWdnZWQsIGNoZWNrKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5TWFwXCI6IHtcbiAgICAgICAgcmV0dXJuIGNoZWNrQ29weU1hcCh0YWdnZWQsIGNoZWNrKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHJlZGFjdGVkYGNhbm5vdCBjaGVjayB1bnJlY29nbml6ZWQgdGFnICR7cXVvdGUodGFnKX06ICR7dGFnZ2VkfWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IGtpbmRPZjIgPSAoc3BlY2ltZW4sIGNoZWNrID0gaWRlbnRDaGVja2VyKSA9PiB7XG4gICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2Yoc3BlY2ltZW4pO1xuICAgIGlmIChwYXNzU3R5bGUgIT09IFwidGFnZ2VkXCIpIHtcbiAgICAgIHJldHVybiBwYXNzU3R5bGU7XG4gICAgfVxuICAgIGlmICh0YWdNZW1vLmhhcyhzcGVjaW1lbikpIHtcbiAgICAgIHJldHVybiB0YWdNZW1vLmdldChzcGVjaW1lbik7XG4gICAgfVxuICAgIGNvbnN0IHRhZyA9IGdldFRhZyhzcGVjaW1lbik7XG4gICAgaWYgKGNoZWNrVGFnZ2VkKHNwZWNpbWVuLCB0YWcsIGNoZWNrKSkge1xuICAgICAgdGFnTWVtby5zZXQoc3BlY2ltZW4sIHRhZyk7XG4gICAgICByZXR1cm4gdGFnO1xuICAgIH1cbiAgICBpZiAoY2hlY2sgIT09IGlkZW50Q2hlY2tlcikge1xuICAgICAgY2hlY2soZmFsc2UsIHJlZGFjdGVkYGNhbm5vdCBjaGVjayB1bnJlY29nbml6ZWQgdGFnICR7cXVvdGUodGFnKX1gKTtcbiAgICB9XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfTtcbiAgaGFyZGVuKGtpbmRPZjIpO1xuICBjb25zdCBjaGVja0tpbmQgPSAoc3BlY2ltZW4sIGtpbmQyLCBjaGVjaykgPT4ge1xuICAgIGlmIChzaW5nbGV0b25LaW5kcy5oYXMoa2luZDIpKSB7XG4gICAgICByZXR1cm4gY2hlY2tBc0tleVBhdHQoc3BlY2ltZW4sIHNpbmdsZXRvbktpbmRzLmdldChraW5kMiksIGNoZWNrKTtcbiAgICB9XG4gICAgY29uc3QgcmVhbEtpbmQgPSBraW5kT2YyKHNwZWNpbWVuLCBjaGVjayk7XG4gICAgaWYgKGtpbmQyID09PSByZWFsS2luZCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChjaGVjayAhPT0gaWRlbnRDaGVja2VyKSB7XG4gICAgICBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtiYXJlT3JRdW90ZShyZWFsS2luZCl9ICR7c3BlY2ltZW59IC0gTXVzdCBiZSBhICR7YmFyZU9yUXVvdGUoa2luZDIpfWApO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIGNvbnN0IGlzS2luZCA9IChzcGVjaW1lbiwga2luZDIpID0+IGNoZWNrS2luZChzcGVjaW1lbiwga2luZDIsIGlkZW50Q2hlY2tlcik7XG4gIGNvbnN0IGlzVW5kZWZpbmVkUGF0dCA9IChwYXR0KSA9PiBwYXR0ID09PSB2b2lkIDAgfHwgaXNLaW5kKHBhdHQsIFwibWF0Y2g6a2luZFwiKSAmJiBwYXR0LnBheWxvYWQgPT09IFwidW5kZWZpbmVkXCI7XG4gIGNvbnN0IGNoZWNrQXNLZXlQYXR0ID0gKHNwZWNpbWVuLCBrZXlBc1BhdHRlcm4sIGNoZWNrKSA9PiB7XG4gICAgaWYgKGlzS2V5KHNwZWNpbWVuKSAmJiBrZXlFUShzcGVjaW1lbiwga2V5QXNQYXR0ZXJuKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBjaGVjayAhPT0gaWRlbnRDaGVja2VyICYmIC8vXG4gICAgLy9cbiAgICBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlOiAke2tleUFzUGF0dGVybn1gKTtcbiAgfTtcbiAgY29uc3QgY2hlY2tQYXR0ZXJuID0gKHBhdHQsIGNoZWNrKSA9PiB7XG4gICAgaWYgKGlzS2V5KHBhdHQpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHBhdHRlcm5NZW1vLmhhcyhwYXR0KSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdCA9IGNoZWNrUGF0dGVybkludGVybmFsKHBhdHQsIGNoZWNrKTtcbiAgICBpZiAocmVzdWx0KSB7XG4gICAgICBwYXR0ZXJuTWVtby5hZGQocGF0dCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG4gIGNvbnN0IGNoZWNrUGF0dGVybkludGVybmFsID0gKHBhdHQsIGNoZWNrKSA9PiB7XG4gICAgY29uc3QgY2hlY2tJdCA9IChjaGlsZCkgPT4gY2hlY2tQYXR0ZXJuKGNoaWxkLCBjaGVjayk7XG4gICAgY29uc3Qga2luZDIgPSBraW5kT2YyKHBhdHQsIGNoZWNrKTtcbiAgICBzd2l0Y2ggKGtpbmQyKSB7XG4gICAgICBjYXNlIHZvaWQgMDoge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIHJldHVybiB2YWx1ZXMyKHBhdHQpLmV2ZXJ5KGNoZWNrSXQpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIHJldHVybiBwYXR0LmV2ZXJ5KGNoZWNrSXQpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlNYXBcIjoge1xuICAgICAgICByZXR1cm4gY2hlY2tQYXR0ZXJuKHBhdHQudmFsdWVzLCBjaGVjayk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZXJyb3JcIjpcbiAgICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgICAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBBICR7cXVvdGUoa2luZDIpfSBjYW5ub3QgYmUgYSBwYXR0ZXJuYCk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIGlmIChtYXliZU1hdGNoSGVscGVyKGtpbmQyKSAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHJlZGFjdGVkYEEgcGFzc2FibGUgb2Yga2luZCAke3F1b3RlKGtpbmQyKX0gaXMgbm90IGEgcGF0dGVybjogJHtwYXR0fWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IGlzUGF0dGVybjIgPSAocGF0dCkgPT4gY2hlY2tQYXR0ZXJuKHBhdHQsIGlkZW50Q2hlY2tlcik7XG4gIGNvbnN0IGFzc2VydFBhdHRlcm4yID0gKHBhdHQpID0+IHtcbiAgICBjaGVja1BhdHRlcm4ocGF0dCwgYXNzZXJ0Q2hlY2tlcik7XG4gIH07XG4gIGNvbnN0IGNoZWNrTWF0Y2hlczIgPSAoc3BlY2ltZW4sIHBhdHRlcm4sIGNoZWNrLCBsYWJlbCA9IHZvaWQgMCkgPT4gKFxuICAgIC8vXG4gICAgYXBwbHlMYWJlbGluZ0Vycm9yKGNoZWNrTWF0Y2hlc0ludGVybmFsLCBbc3BlY2ltZW4sIHBhdHRlcm4sIGNoZWNrXSwgbGFiZWwpXG4gICk7XG4gIGNvbnN0IGNoZWNrTWF0Y2hlc0ludGVybmFsID0gKHNwZWNpbWVuLCBwYXR0LCBjaGVjaykgPT4ge1xuICAgIGNvbnN0IHBhdHRlcm5LaW5kID0ga2luZE9mMihwYXR0LCBjaGVjayk7XG4gICAgY29uc3Qgc3BlY2ltZW5LaW5kID0ga2luZE9mMihzcGVjaW1lbik7XG4gICAgc3dpdGNoIChwYXR0ZXJuS2luZCkge1xuICAgICAgY2FzZSB2b2lkIDA6IHtcbiAgICAgICAgcmV0dXJuIHRocm93UmVkYWN0ZWRgcGF0dGVybiBleHBlY3RlZDogJHtwYXR0fWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIHJldHVybiB0aHJvd1JlZGFjdGVkYHByb21pc2VzIGNhbm5vdCBiZSBwYXR0ZXJuczogJHtwYXR0fWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZXJyb3JcIjoge1xuICAgICAgICByZXR1cm4gdGhyb3dSZWRhY3RlZGBlcnJvcnMgY2Fubm90IGJlIHBhdHRlcm5zOiAke3BhdHR9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjpcbiAgICAgIGNhc2UgXCJudWxsXCI6XG4gICAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgICAgY2FzZSBcIm51bWJlclwiOlxuICAgICAgY2FzZSBcImJpZ2ludFwiOlxuICAgICAgY2FzZSBcInN0cmluZ1wiOlxuICAgICAgY2FzZSBcInN5bWJvbFwiOlxuICAgICAgY2FzZSBcImJ5dGVBcnJheVwiOlxuICAgICAgY2FzZSBcImNvcHlTZXRcIjpcbiAgICAgIGNhc2UgXCJjb3B5QmFnXCI6XG4gICAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgICAgcmV0dXJuIGNoZWNrQXNLZXlQYXR0KHNwZWNpbWVuLCBwYXR0LCBjaGVjayk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgaWYgKGlzS2V5KHBhdHQpKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrQXNLZXlQYXR0KHNwZWNpbWVuLCBwYXR0LCBjaGVjayk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNwZWNpbWVuS2luZCAhPT0gXCJjb3B5QXJyYXlcIikge1xuICAgICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlIGEgY29weUFycmF5IHRvIG1hdGNoIGEgY29weUFycmF5IHBhdHRlcm46ICR7cXAoXG4gICAgICAgICAgICAgIHBhdHRcbiAgICAgICAgICAgICl9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHBhdHQ7XG4gICAgICAgIGlmIChzcGVjaW1lbi5sZW5ndGggIT09IGxlbmd0aCkge1xuICAgICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgcmVkYWN0ZWRgQXJyYXkgJHtzcGVjaW1lbn0gLSBNdXN0IGJlIGFzIGxvbmcgYXMgY29weUFycmF5IHBhdHRlcm46ICR7cXAoXG4gICAgICAgICAgICAgIHBhdHRcbiAgICAgICAgICAgICl9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhdHQuZXZlcnkoKHAyLCBpMikgPT4gY2hlY2tNYXRjaGVzMihzcGVjaW1lbltpMl0sIHAyLCBjaGVjaywgaTIpKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgICAgaWYgKGlzS2V5KHBhdHQpKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrQXNLZXlQYXR0KHNwZWNpbWVuLCBwYXR0LCBjaGVjayk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNwZWNpbWVuS2luZCAhPT0gXCJjb3B5UmVjb3JkXCIpIHtcbiAgICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSBhIGNvcHlSZWNvcmQgdG8gbWF0Y2ggYSBjb3B5UmVjb3JkIHBhdHRlcm46ICR7cXAoXG4gICAgICAgICAgICAgIHBhdHRcbiAgICAgICAgICAgICl9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3BlY2ltZW5OYW1lcyA9IHJlY29yZE5hbWVzKHNwZWNpbWVuKTtcbiAgICAgICAgY29uc3QgcGF0dE5hbWVzID0gcmVjb3JkTmFtZXMocGF0dCk7XG4gICAgICAgIGNvbnN0IG1pc3NpbmcyID0gbGlzdERpZmZlcmVuY2UocGF0dE5hbWVzLCBzcGVjaW1lbk5hbWVzKTtcbiAgICAgICAgaWYgKG1pc3NpbmcyLmxlbmd0aCA+PSAxKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgaGF2ZSBtaXNzaW5nIHByb3BlcnRpZXMgJHtxdW90ZShtaXNzaW5nMil9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdW5leHBlY3RlZCA9IGxpc3REaWZmZXJlbmNlKHNwZWNpbWVuTmFtZXMsIHBhdHROYW1lcyk7XG4gICAgICAgIGlmICh1bmV4cGVjdGVkLmxlbmd0aCA+PSAxKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3Qgbm90IGhhdmUgdW5leHBlY3RlZCBwcm9wZXJ0aWVzOiAke3F1b3RlKFxuICAgICAgICAgICAgICB1bmV4cGVjdGVkXG4gICAgICAgICAgICApfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNwZWNpbWVuVmFsdWVzID0gcmVjb3JkVmFsdWVzKHNwZWNpbWVuLCBzcGVjaW1lbk5hbWVzKTtcbiAgICAgICAgY29uc3QgcGF0dFZhbHVlcyA9IHJlY29yZFZhbHVlcyhwYXR0LCBwYXR0TmFtZXMpO1xuICAgICAgICByZXR1cm4gcGF0dE5hbWVzLmV2ZXJ5KFxuICAgICAgICAgIChsYWJlbCwgaTIpID0+IGNoZWNrTWF0Y2hlczIoc3BlY2ltZW5WYWx1ZXNbaTJdLCBwYXR0VmFsdWVzW2kyXSwgY2hlY2ssIGxhYmVsKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlNYXBcIjoge1xuICAgICAgICBpZiAoaXNLZXkocGF0dCkpIHtcbiAgICAgICAgICByZXR1cm4gY2hlY2tBc0tleVBhdHQoc3BlY2ltZW4sIHBhdHQsIGNoZWNrKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3BlY2ltZW5LaW5kICE9PSBcImNvcHlNYXBcIikge1xuICAgICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlIGEgY29weU1hcCB0byBtYXRjaCBhIGNvcHlNYXAgcGF0dGVybjogJHtxcChcbiAgICAgICAgICAgICAgcGF0dFxuICAgICAgICAgICAgKX1gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwYXR0S2V5U2V0ID0gY29weU1hcEtleVNldChwYXR0KTtcbiAgICAgICAgY29uc3Qgc3BlY2ltZW5LZXlTZXQgPSBjb3B5TWFwS2V5U2V0KHNwZWNpbWVuKTtcbiAgICAgICAgaWYgKCFjaGVja01hdGNoZXMyKHNwZWNpbWVuS2V5U2V0LCBwYXR0S2V5U2V0LCBjaGVjaykpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGF0dFZhbHVlcyA9IFtdO1xuICAgICAgICBjb25zdCBzcGVjaW1lblZhbHVlcyA9IFtdO1xuICAgICAgICBjb25zdCBlbnRyeVBhaXJzID0gZ2VuZXJhdGVDb2xsZWN0aW9uUGFpckVudHJpZXMoXG4gICAgICAgICAgcGF0dCxcbiAgICAgICAgICBzcGVjaW1lbixcbiAgICAgICAgICBnZXRDb3B5TWFwRW50cnlBcnJheSxcbiAgICAgICAgICB2b2lkIDBcbiAgICAgICAgKTtcbiAgICAgICAgZm9yIChjb25zdCBbX2tleSwgcGF0dFZhbHVlLCBzcGVjaW1lblZhbHVlXSBvZiBlbnRyeVBhaXJzKSB7XG4gICAgICAgICAgcGF0dFZhbHVlcy5wdXNoKHBhdHRWYWx1ZSk7XG4gICAgICAgICAgc3BlY2ltZW5WYWx1ZXMucHVzaChzcGVjaW1lblZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hlY2tNYXRjaGVzMihoYXJkZW4oc3BlY2ltZW5WYWx1ZXMpLCBoYXJkZW4ocGF0dFZhbHVlcyksIGNoZWNrKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgY29uc3QgbWF0Y2hIZWxwZXIgPSBtYXliZU1hdGNoSGVscGVyKHBhdHRlcm5LaW5kKTtcbiAgICAgICAgaWYgKG1hdGNoSGVscGVyKSB7XG4gICAgICAgICAgcmV0dXJuIG1hdGNoSGVscGVyLmNoZWNrTWF0Y2hlcyhzcGVjaW1lbiwgcGF0dC5wYXlsb2FkLCBjaGVjayk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogc2hvdWxkIGhhdmUgcmVjb2duaXplZCAke3F1b3RlKHBhdHRlcm5LaW5kKX0gYDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IG1hdGNoZXMyID0gKHNwZWNpbWVuLCBwYXR0KSA9PiBjaGVja01hdGNoZXMyKHNwZWNpbWVuLCBwYXR0LCBpZGVudENoZWNrZXIpO1xuICBjb25zdCBtdXN0TWF0Y2g1ID0gKHNwZWNpbWVuLCBwYXR0LCBsYWJlbCA9IHZvaWQgMCkgPT4ge1xuICAgIGxldCBpbm5lckVycm9yO1xuICAgIHRyeSB7XG4gICAgICBpZiAoY2hlY2tNYXRjaGVzMihzcGVjaW1lbiwgcGF0dCwgaWRlbnRDaGVja2VyLCB2b2lkIDApKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcikge1xuICAgICAgaW5uZXJFcnJvciA9IGVyO1xuICAgIH1cbiAgICBjaGVja01hdGNoZXMyKHNwZWNpbWVuLCBwYXR0LCBhc3NlcnRDaGVja2VyLCBsYWJlbCk7XG4gICAgY29uc3Qgb3V0ZXJFcnJvciA9IG1ha2VFcnJvcihcbiAgICAgIHJlZGFjdGVkYGludGVybmFsOiAke2xhYmVsfTogaW5jb25zaXN0ZW50IHBhdHRlcm4gbWF0Y2g6ICR7cXAocGF0dCl9YFxuICAgICk7XG4gICAgaWYgKGlubmVyRXJyb3IgIT09IHZvaWQgMCkge1xuICAgICAgbm90ZShvdXRlckVycm9yLCByZWRhY3RlZGBjYXVzZWQgYnkgJHtpbm5lckVycm9yfWApO1xuICAgIH1cbiAgICB0aHJvdyBvdXRlckVycm9yO1xuICB9O1xuICBjb25zdCBnZXRSYW5rQ292ZXIyID0gKHBhdHQsIGVuY29kZVBhc3NhYmxlKSA9PiB7XG4gICAgaWYgKGlzS2V5KHBhdHQpKSB7XG4gICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2RlUGFzc2FibGUocGF0dCk7XG4gICAgICBpZiAoZW5jb2RlZCAhPT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybiBbZW5jb2RlZCwgYCR7ZW5jb2RlZH1+YF07XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHBhdHQpO1xuICAgIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgIGNvbnN0IHRhZyA9IGdldFRhZyhwYXR0KTtcbiAgICAgICAgY29uc3QgbWF0Y2hIZWxwZXIgPSBtYXliZU1hdGNoSGVscGVyKHRhZyk7XG4gICAgICAgIGlmIChtYXRjaEhlbHBlcikge1xuICAgICAgICAgIHJldHVybiBtYXRjaEhlbHBlci5nZXRSYW5rQ292ZXIocGF0dC5wYXlsb2FkLCBlbmNvZGVQYXNzYWJsZSk7XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoICh0YWcpIHtcbiAgICAgICAgICBjYXNlIFwiY29weVNldFwiOiB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBcImNvcHlNYXBcIjoge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBnZXRQYXNzU3R5bGVDb3ZlcihwYXNzU3R5bGUpO1xuICB9O1xuICBjb25zdCBhcnJheUV2ZXJ5TWF0Y2hQYXR0ZXJuID0gKGFycmF5LCBwYXR0LCBjaGVjaywgbGFiZWxQcmVmaXggPSBcIlwiKSA9PiB7XG4gICAgaWYgKGlzS2luZChwYXR0LCBcIm1hdGNoOmFueVwiKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBhcnJheS5ldmVyeShcbiAgICAgIChlbCwgaTIpID0+IGNoZWNrTWF0Y2hlczIoZWwsIHBhdHQsIGNoZWNrLCBgJHtsYWJlbFByZWZpeH1bJHtpMn1dYClcbiAgICApO1xuICB9O1xuICBjb25zdCBtYXRjaEFueUhlbHBlciA9IEZhcihcIm1hdGNoOmFueSBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKF9zcGVjaW1lbiwgX21hdGNoZXJQYXlsb2FkLCBfY2hlY2spID0+IHRydWUsXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChtYXRjaGVyUGF5bG9hZCwgY2hlY2spID0+IG1hdGNoZXJQYXlsb2FkID09PSB2b2lkIDAgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYG1hdGNoOmFueSBwYXlsb2FkOiAke21hdGNoZXJQYXlsb2FkfSAtIE11c3QgYmUgdW5kZWZpbmVkYCksXG4gICAgZ2V0UmFua0NvdmVyOiAoX21hdGNoUGF5bG9hZCwgX2VuY29kZVBhc3NhYmxlKSA9PiBbXCJcIiwgXCJ7XCJdXG4gIH0pO1xuICBjb25zdCBtYXRjaEFuZEhlbHBlciA9IEZhcihcIm1hdGNoOmFuZCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBwYXR0cywgY2hlY2spID0+IHtcbiAgICAgIHJldHVybiBwYXR0cy5ldmVyeSgocGF0dCkgPT4gY2hlY2tNYXRjaGVzMihzcGVjaW1lbiwgcGF0dCwgY2hlY2spKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAoYWxsZWdlZFBhdHRzLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgY2hlY2tJdCA9IChwYXR0KSA9PiBjaGVja1BhdHRlcm4ocGF0dCwgY2hlY2spO1xuICAgICAgcmV0dXJuIChwYXNzU3R5bGVPZihhbGxlZ2VkUGF0dHMpID09PSBcImNvcHlBcnJheVwiIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBOZWVkcyBhcnJheSBvZiBzdWItcGF0dGVybnM6ICR7cXAoYWxsZWdlZFBhdHRzKX1gKSkgJiYgYWxsZWdlZFBhdHRzLmV2ZXJ5KGNoZWNrSXQpO1xuICAgIH0sXG4gICAgZ2V0UmFua0NvdmVyOiAocGF0dHMsIGVuY29kZVBhc3NhYmxlKSA9PiBpbnRlcnNlY3RSYW5rQ292ZXJzKFxuICAgICAgY29tcGFyZVJhbmssXG4gICAgICBwYXR0cy5tYXAoKHAyKSA9PiBnZXRSYW5rQ292ZXIyKHAyLCBlbmNvZGVQYXNzYWJsZSkpXG4gICAgKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hPckhlbHBlciA9IEZhcihcIm1hdGNoOm9yIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIHBhdHRzLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHBhdHRzO1xuICAgICAgaWYgKGxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBubyBwYXR0ZXJuIGRpc2p1bmN0cyB0byBtYXRjaDogJHtxcChwYXR0cyl9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3QgYmluYXJ5VW5kZWZQYXR0SWR4ID0gcGF0dHMubGVuZ3RoID09PSAyID8gcGF0dHMuZmluZEluZGV4KChwYXR0KSA9PiBpc1VuZGVmaW5lZFBhdHQocGF0dCkpIDogLTE7XG4gICAgICBpZiAoYmluYXJ5VW5kZWZQYXR0SWR4ICE9PSAtMSkge1xuICAgICAgICByZXR1cm4gc3BlY2ltZW4gPT09IHZvaWQgMCB8fCBjaGVja01hdGNoZXMyKHNwZWNpbWVuLCBwYXR0c1sxIC0gYmluYXJ5VW5kZWZQYXR0SWR4XSwgY2hlY2spO1xuICAgICAgfVxuICAgICAgaWYgKHBhdHRzLnNvbWUoKHBhdHQpID0+IG1hdGNoZXMyKHNwZWNpbWVuLCBwYXR0KSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBtYXRjaCBvbmUgb2YgJHtxcChwYXR0cyl9YCk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogbWF0Y2hBbmRIZWxwZXIuY2hlY2tJc1dlbGxGb3JtZWQsXG4gICAgZ2V0UmFua0NvdmVyOiAocGF0dHMsIGVuY29kZVBhc3NhYmxlKSA9PiB1bmlvblJhbmtDb3ZlcnMoXG4gICAgICBjb21wYXJlUmFuayxcbiAgICAgIHBhdHRzLm1hcCgocDIpID0+IGdldFJhbmtDb3ZlcjIocDIsIGVuY29kZVBhc3NhYmxlKSlcbiAgICApXG4gIH0pO1xuICBjb25zdCBtYXRjaE5vdEhlbHBlciA9IEZhcihcIm1hdGNoOm5vdCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBwYXR0LCBjaGVjaykgPT4ge1xuICAgICAgaWYgKG1hdGNoZXMyKHNwZWNpbWVuLCBwYXR0KSkge1xuICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGZhaWwgbmVnYXRlZCBwYXR0ZXJuOiAke3FwKHBhdHQpfWBcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IGNoZWNrUGF0dGVybixcbiAgICBnZXRSYW5rQ292ZXI6IChfcGF0dCwgX2VuY29kZVBhc3NhYmxlKSA9PiBbXCJcIiwgXCJ7XCJdXG4gIH0pO1xuICBjb25zdCBtYXRjaFNjYWxhckhlbHBlciA9IEZhcihcIm1hdGNoOnNjYWxhciBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBfbWF0Y2hlclBheWxvYWQsIGNoZWNrKSA9PiBjaGVja1NjYWxhcktleShzcGVjaW1lbiwgY2hlY2spLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBtYXRjaEFueUhlbHBlci5jaGVja0lzV2VsbEZvcm1lZCxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IFtcImFcIiwgXCJ6flwiXVxuICB9KTtcbiAgY29uc3QgbWF0Y2hLZXlIZWxwZXIgPSBGYXIoXCJtYXRjaDprZXkgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgX21hdGNoZXJQYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tLZXkoc3BlY2ltZW4sIGNoZWNrKSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogbWF0Y2hBbnlIZWxwZXIuY2hlY2tJc1dlbGxGb3JtZWQsXG4gICAgZ2V0UmFua0NvdmVyOiAoX21hdGNoUGF5bG9hZCwgX2VuY29kZVBhc3NhYmxlKSA9PiBbXCJhXCIsIFwien5cIl1cbiAgfSk7XG4gIGNvbnN0IG1hdGNoUGF0dGVybkhlbHBlciA9IEZhcihcIm1hdGNoOnBhdHRlcm4gaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgX21hdGNoZXJQYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tQYXR0ZXJuKHNwZWNpbWVuLCBjaGVjayksXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IG1hdGNoQW55SGVscGVyLmNoZWNrSXNXZWxsRm9ybWVkLFxuICAgIGdldFJhbmtDb3ZlcjogKF9tYXRjaFBheWxvYWQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gW1wiYVwiLCBcInp+XCJdXG4gIH0pO1xuICBjb25zdCBtYXRjaEtpbmRIZWxwZXIgPSBGYXIoXCJtYXRjaDpraW5kIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiBjaGVja0tpbmQsXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChhbGxlZ2VkS2V5S2luZCwgY2hlY2spID0+IHR5cGVvZiBhbGxlZ2VkS2V5S2luZCA9PT0gXCJzdHJpbmdcIiB8fCBjaGVjayhcbiAgICAgIGZhbHNlLFxuICAgICAgcmVkYWN0ZWRgbWF0Y2g6a2luZDogcGF5bG9hZDogJHthbGxlZ2VkS2V5S2luZH0gLSBBIGtpbmQgbmFtZSBtdXN0IGJlIGEgc3RyaW5nYFxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoa2luZDIsIF9lbmNvZGVQYXNzYWJsZSkgPT4ge1xuICAgICAgbGV0IHN0eWxlO1xuICAgICAgc3dpdGNoIChraW5kMikge1xuICAgICAgICBjYXNlIFwiY29weVNldFwiOlxuICAgICAgICBjYXNlIFwiY29weU1hcFwiOiB7XG4gICAgICAgICAgc3R5bGUgPSBcInRhZ2dlZFwiO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICBzdHlsZSA9IGtpbmQyO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZ2V0UGFzc1N0eWxlQ292ZXIoc3R5bGUpO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IG1hdGNoVGFnZ2VkSGVscGVyID0gRmFyKFwibWF0Y2g6dGFnZ2VkIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFt0YWdQYXR0LCBwYXlsb2FkUGF0dF0sIGNoZWNrKSA9PiB7XG4gICAgICBpZiAocGFzc1N0eWxlT2Yoc3BlY2ltZW4pICE9PSBcInRhZ2dlZFwiKSB7XG4gICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICByZWRhY3RlZGBFeHBlY3RlZCB0YWdnZWQgb2JqZWN0LCBub3QgJHtxdW90ZShcbiAgICAgICAgICAgIHBhc3NTdHlsZU9mKHNwZWNpbWVuKVxuICAgICAgICAgICl9OiAke3NwZWNpbWVufWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjaGVja01hdGNoZXMyKGdldFRhZyhzcGVjaW1lbiksIHRhZ1BhdHQsIGNoZWNrLCBcInRhZ1wiKSAmJiBjaGVja01hdGNoZXMyKHNwZWNpbWVuLnBheWxvYWQsIHBheWxvYWRQYXR0LCBjaGVjaywgXCJwYXlsb2FkXCIpO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tNYXRjaGVzMihcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKSwgTU0ucGF0dGVybigpXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6dGFnZ2VkIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoX2tpbmQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJ0YWdnZWRcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoQmlnaW50SGVscGVyID0gRmFyKFwibWF0Y2g6YmlnaW50IGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtsaW1pdHMgPSB2b2lkIDBdLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgeyBkZWNpbWFsRGlnaXRzTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcImJpZ2ludFwiLCBjaGVjaykgJiYgY2hlY2tEZWNpbWFsRGlnaXRzTGltaXQoc3BlY2ltZW4sIGRlY2ltYWxEaWdpdHNMaW1pdCwgY2hlY2spO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtdKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpiaWdpbnQgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwiYmlnaW50XCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaE5hdEhlbHBlciA9IEZhcihcIm1hdGNoOm5hdCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgZGVjaW1hbERpZ2l0c0xpbWl0IH0gPSBsaW1pdChsaW1pdHMpO1xuICAgICAgcmV0dXJuIGNoZWNrS2luZChzcGVjaW1lbiwgXCJiaWdpbnRcIiwgY2hlY2spICYmIGNoZWNrKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgc3BlY2ltZW4gPj0gMG4sXG4gICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSBub24tbmVnYXRpdmVgXG4gICAgICApICYmIGNoZWNrRGVjaW1hbERpZ2l0c0xpbWl0KHNwZWNpbWVuLCBkZWNpbWFsRGlnaXRzTGltaXQsIGNoZWNrKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6bmF0IHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoX21hdGNoUGF5bG9hZCwgX2VuY29kZVBhc3NhYmxlKSA9PiAoXG4gICAgICAvL1xuICAgICAgZ2V0UGFzc1N0eWxlQ292ZXIoXCJiaWdpbnRcIilcbiAgICApXG4gIH0pO1xuICBjb25zdCBtYXRjaFN0cmluZ0hlbHBlciA9IEZhcihcIm1hdGNoOnN0cmluZyBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgc3RyaW5nTGVuZ3RoTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcInN0cmluZ1wiLCBjaGVjaykgJiYgLy9cbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgKHNwZWNpbWVuLmxlbmd0aCA8PSBzdHJpbmdMZW5ndGhMaW1pdCB8fCBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYHN0cmluZyAke3NwZWNpbWVufSBtdXN0IG5vdCBiZSBiaWdnZXIgdGhhbiAke3N0cmluZ0xlbmd0aExpbWl0fWBcbiAgICAgICkpO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtdKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpzdHJpbmcgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwic3RyaW5nXCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaFN5bWJvbEhlbHBlciA9IEZhcihcIm1hdGNoOnN5bWJvbCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgc3ltYm9sTmFtZUxlbmd0aExpbWl0IH0gPSBsaW1pdChsaW1pdHMpO1xuICAgICAgaWYgKCFjaGVja0tpbmQoc3BlY2ltZW4sIFwic3ltYm9sXCIsIGNoZWNrKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjb25zdCBzeW1ib2xOYW1lID0gbmFtZUZvclBhc3NhYmxlU3ltYm9sKHNwZWNpbWVuKTtcbiAgICAgIGlmICh0eXBlb2Ygc3ltYm9sTmFtZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBQYXNzYWJsZSBzeW1ib2wgJHtzcGVjaW1lbn0gbXVzdCBoYXZlIGEgcGFzc2FibGUgbmFtZWA7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgIHN5bWJvbE5hbWUubGVuZ3RoIDw9IHN5bWJvbE5hbWVMZW5ndGhMaW1pdCxcbiAgICAgICAgcmVkYWN0ZWRgU3ltYm9sIG5hbWUgJHtxdW90ZShcbiAgICAgICAgICBzeW1ib2xOYW1lXG4gICAgICAgICl9IG11c3Qgbm90IGJlIGJpZ2dlciB0aGFuICR7c3ltYm9sTmFtZUxlbmd0aExpbWl0fWBcbiAgICAgICk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW10pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIm1hdGNoOnN5bWJvbCBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKF9tYXRjaFBheWxvYWQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJzeW1ib2xcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoUmVtb3RhYmxlSGVscGVyID0gRmFyKFwibWF0Y2g6cmVtb3RhYmxlIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIHJlbW90YWJsZURlc2MsIGNoZWNrKSA9PiB7XG4gICAgICBpZiAoaXNLaW5kKHNwZWNpbWVuLCBcInJlbW90YWJsZVwiKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChjaGVjayA9PT0gaWRlbnRDaGVja2VyKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgbGFiZWwgfSA9IHJlbW90YWJsZURlc2M7XG4gICAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihzcGVjaW1lbik7XG4gICAgICBjb25zdCBraW5kRGV0YWlscyA9IHBhc3NTdHlsZSAhPT0gXCJ0YWdnZWRcIiA/IChcbiAgICAgICAgLy9cbiAgICAgICAgYmFyZU9yUXVvdGUocGFzc1N0eWxlKVxuICAgICAgKSA6IChcbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgcXVvdGUoZ2V0VGFnKHNwZWNpbWVuKSlcbiAgICAgICk7XG4gICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgIGZhbHNlLFxuICAgICAgICAvL1xuICAgICAgICAvL1xuICAgICAgICByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgYSByZW1vdGFibGUgJHtiYXJlT3JRdW90ZShsYWJlbCl9LCBub3QgJHtraW5kRGV0YWlsc31gXG4gICAgICApO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChhbGxlZ2VkUmVtb3RhYmxlRGVzYywgY2hlY2spID0+IGNoZWNrTWF0Y2hlczIoXG4gICAgICBhbGxlZ2VkUmVtb3RhYmxlRGVzYyxcbiAgICAgIGhhcmRlbih7IGxhYmVsOiBNTS5zdHJpbmcoKSB9KSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpyZW1vdGFibGUgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfcmVtb3RhYmxlRGVzYywgX2VuY29kZVBhc3NhYmxlKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcInJlbW90YWJsZVwiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hMVEVIZWxwZXIgPSBGYXIoXCJtYXRjaDpsdGUgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgcmlnaHRPcGVyYW5kLCBjaGVjaykgPT4ga2V5TFRFKHNwZWNpbWVuLCByaWdodE9wZXJhbmQpIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgPD0gJHtyaWdodE9wZXJhbmR9YCksXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IGNoZWNrS2V5LFxuICAgIGdldFJhbmtDb3ZlcjogKHJpZ2h0T3BlcmFuZCwgZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHJpZ2h0T3BlcmFuZCk7XG4gICAgICBsZXQgW2xlZnRCb3VuZCwgcmlnaHRCb3VuZF0gPSBnZXRQYXNzU3R5bGVDb3ZlcihwYXNzU3R5bGUpO1xuICAgICAgY29uc3QgbmV3UmlnaHRCb3VuZCA9IGAke2VuY29kZVBhc3NhYmxlKHJpZ2h0T3BlcmFuZCl9fmA7XG4gICAgICBpZiAobmV3UmlnaHRCb3VuZCAhPT0gdm9pZCAwKSB7XG4gICAgICAgIHJpZ2h0Qm91bmQgPSBuZXdSaWdodEJvdW5kO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFtsZWZ0Qm91bmQsIHJpZ2h0Qm91bmRdO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IG1hdGNoTFRIZWxwZXIgPSBGYXIoXCJtYXRjaDpsdCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCByaWdodE9wZXJhbmQsIGNoZWNrKSA9PiBrZXlMVChzcGVjaW1lbiwgcmlnaHRPcGVyYW5kKSB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlIDwgJHtyaWdodE9wZXJhbmR9YCksXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IGNoZWNrS2V5LFxuICAgIGdldFJhbmtDb3ZlcjogbWF0Y2hMVEVIZWxwZXIuZ2V0UmFua0NvdmVyXG4gIH0pO1xuICBjb25zdCBtYXRjaEdURUhlbHBlciA9IEZhcihcIm1hdGNoOmd0ZSBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCByaWdodE9wZXJhbmQsIGNoZWNrKSA9PiBrZXlHVEUoc3BlY2ltZW4sIHJpZ2h0T3BlcmFuZCkgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSA+PSAke3JpZ2h0T3BlcmFuZH1gKSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogY2hlY2tLZXksXG4gICAgZ2V0UmFua0NvdmVyOiAocmlnaHRPcGVyYW5kLCBlbmNvZGVQYXNzYWJsZSkgPT4ge1xuICAgICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YocmlnaHRPcGVyYW5kKTtcbiAgICAgIGxldCBbbGVmdEJvdW5kLCByaWdodEJvdW5kXSA9IGdldFBhc3NTdHlsZUNvdmVyKHBhc3NTdHlsZSk7XG4gICAgICBjb25zdCBuZXdMZWZ0Qm91bmQgPSBlbmNvZGVQYXNzYWJsZShyaWdodE9wZXJhbmQpO1xuICAgICAgaWYgKG5ld0xlZnRCb3VuZCAhPT0gdm9pZCAwKSB7XG4gICAgICAgIGxlZnRCb3VuZCA9IG5ld0xlZnRCb3VuZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBbbGVmdEJvdW5kLCByaWdodEJvdW5kXTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBtYXRjaEdUSGVscGVyID0gRmFyKFwibWF0Y2g6Z3QgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgcmlnaHRPcGVyYW5kLCBjaGVjaykgPT4ga2V5R1Qoc3BlY2ltZW4sIHJpZ2h0T3BlcmFuZCkgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSA+ICR7cmlnaHRPcGVyYW5kfWApLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBjaGVja0tleSxcbiAgICBnZXRSYW5rQ292ZXI6IG1hdGNoR1RFSGVscGVyLmdldFJhbmtDb3ZlclxuICB9KTtcbiAgY29uc3QgbWF0Y2hSZWNvcmRPZkhlbHBlciA9IEZhcihcIm1hdGNoOnJlY29yZE9mIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtrZXlQYXR0LCB2YWx1ZVBhdHQsIGxpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IG51bVByb3BlcnRpZXNMaW1pdCwgcHJvcGVydHlOYW1lTGVuZ3RoTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcImNvcHlSZWNvcmRcIiwgY2hlY2spICYmIGNoZWNrKFxuICAgICAgICBvd25LZXlzMTgoc3BlY2ltZW4pLmxlbmd0aCA8PSBudW1Qcm9wZXJ0aWVzTGltaXQsXG4gICAgICAgIHJlZGFjdGVkYE11c3Qgbm90IGhhdmUgbW9yZSB0aGFuICR7cXVvdGUoXG4gICAgICAgICAgbnVtUHJvcGVydGllc0xpbWl0XG4gICAgICAgICl9IHByb3BlcnRpZXM6ICR7c3BlY2ltZW59YFxuICAgICAgKSAmJiBlbnRyaWVzNyhzcGVjaW1lbikuZXZlcnkoXG4gICAgICAgIChba2V5LCB2YWx1ZV0pID0+IGFwcGx5TGFiZWxpbmdFcnJvcihcbiAgICAgICAgICBjaGVjayxcbiAgICAgICAgICBbXG4gICAgICAgICAgICBrZXkubGVuZ3RoIDw9IHByb3BlcnR5TmFtZUxlbmd0aExpbWl0LFxuICAgICAgICAgICAgcmVkYWN0ZWRgUHJvcGVydHkgbmFtZSBtdXN0IG5vdCBiZSBsb25nZXIgdGhhbiAke3F1b3RlKFxuICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWVMZW5ndGhMaW1pdFxuICAgICAgICAgICAgKX1gXG4gICAgICAgICAgXSxcbiAgICAgICAgICBrZXlcbiAgICAgICAgKSAmJiBjaGVja01hdGNoZXMyKFxuICAgICAgICAgIGhhcmRlbihba2V5LCB2YWx1ZV0pLFxuICAgICAgICAgIGhhcmRlbihba2V5UGF0dCwgdmFsdWVQYXR0XSksXG4gICAgICAgICAgY2hlY2ssXG4gICAgICAgICAga2V5XG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKSwgTU0ucGF0dGVybigpXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6cmVjb3JkT2YgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfZW50cnlQYXR0KSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcImNvcHlSZWNvcmRcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoQXJyYXlPZkhlbHBlciA9IEZhcihcIm1hdGNoOmFycmF5T2YgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW3N1YlBhdHQsIGxpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IGFycmF5TGVuZ3RoTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcImNvcHlBcnJheVwiLCBjaGVjaykgJiYgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgIChzcGVjaW1lbi5sZW5ndGggPD0gYXJyYXlMZW5ndGhMaW1pdCB8fCBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYEFycmF5IGxlbmd0aCAke3NwZWNpbWVuLmxlbmd0aH0gbXVzdCBiZSA8PSBsaW1pdCAke2FycmF5TGVuZ3RoTGltaXR9YFxuICAgICAgKSkgJiYgYXJyYXlFdmVyeU1hdGNoUGF0dGVybihzcGVjaW1lbiwgc3ViUGF0dCwgY2hlY2spO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtNTS5wYXR0ZXJuKCldKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDphcnJheU9mIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcImNvcHlBcnJheVwiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hCeXRlQXJyYXlIZWxwZXIgPSBGYXIoXCJtYXRjaDpieXRlQXJyYXkgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2xpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IGJ5dGVMZW5ndGhMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwiYnl0ZUFycmF5XCIsIGNoZWNrKSAmJiAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgKHNwZWNpbWVuLmJ5dGVMZW5ndGggPD0gYnl0ZUxlbmd0aExpbWl0IHx8IGNoZWNrKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgcmVkYWN0ZWRgYnl0ZUFycmF5ICR7c3BlY2ltZW59IG11c3Qgbm90IGJlIGJpZ2dlciB0aGFuICR7Ynl0ZUxlbmd0aExpbWl0fWBcbiAgICAgICkpO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtdKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpieXRlQXJyYXkgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwiYnl0ZUFycmF5XCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaFNldE9mSGVscGVyID0gRmFyKFwibWF0Y2g6c2V0T2YgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2tleVBhdHQsIGxpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IG51bVNldEVsZW1lbnRzTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcImNvcHlTZXRcIiwgY2hlY2spICYmIGNoZWNrKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgICAgICBzcGVjaW1lbi5wYXlsb2FkLmxlbmd0aCA8IG51bVNldEVsZW1lbnRzTGltaXQsXG4gICAgICAgIHJlZGFjdGVkYFNldCBtdXN0IG5vdCBoYXZlIG1vcmUgdGhhbiAke3F1b3RlKG51bVNldEVsZW1lbnRzTGltaXQpfSBlbGVtZW50czogJHtzcGVjaW1lbi5wYXlsb2FkLmxlbmd0aH1gXG4gICAgICApICYmIGFycmF5RXZlcnlNYXRjaFBhdHRlcm4oc3BlY2ltZW4ucGF5bG9hZCwga2V5UGF0dCwgY2hlY2ssIFwic2V0IGVsZW1lbnRzXCIpO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtNTS5wYXR0ZXJuKCldKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpzZXRPZiBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKCkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJ0YWdnZWRcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoQmFnT2ZIZWxwZXIgPSBGYXIoXCJtYXRjaDpiYWdPZiBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBba2V5UGF0dCwgY291bnRQYXR0LCBsaW1pdHMgPSB2b2lkIDBdLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgeyBudW1VbmlxdWVCYWdFbGVtZW50c0xpbWl0LCBkZWNpbWFsRGlnaXRzTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcImNvcHlCYWdcIiwgY2hlY2spICYmIGNoZWNrKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgICAgICBzcGVjaW1lbi5wYXlsb2FkLmxlbmd0aCA8PSBudW1VbmlxdWVCYWdFbGVtZW50c0xpbWl0LFxuICAgICAgICByZWRhY3RlZGBCYWcgbXVzdCBub3QgaGF2ZSBtb3JlIHRoYW4gJHtxdW90ZShcbiAgICAgICAgICBudW1VbmlxdWVCYWdFbGVtZW50c0xpbWl0XG4gICAgICAgICl9IHVuaXF1ZSBlbGVtZW50czogJHtzcGVjaW1lbn1gXG4gICAgICApICYmIHNwZWNpbWVuLnBheWxvYWQuZXZlcnkoXG4gICAgICAgIChba2V5LCBjb3VudF0sIGkyKSA9PiBjaGVja01hdGNoZXMyKGtleSwga2V5UGF0dCwgY2hlY2ssIGBiYWcga2V5c1ske2kyfV1gKSAmJiBhcHBseUxhYmVsaW5nRXJyb3IoXG4gICAgICAgICAgY2hlY2tEZWNpbWFsRGlnaXRzTGltaXQsXG4gICAgICAgICAgW2NvdW50LCBkZWNpbWFsRGlnaXRzTGltaXQsIGNoZWNrXSxcbiAgICAgICAgICBgYmFnIGNvdW50c1ske2kyfV1gXG4gICAgICAgICkgJiYgY2hlY2tNYXRjaGVzMihjb3VudCwgY291bnRQYXR0LCBjaGVjaywgYGJhZyBjb3VudHNbJHtpMn1dYClcbiAgICAgICk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKSwgTU0ucGF0dGVybigpXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6YmFnT2YgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6ICgpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwidGFnZ2VkXCIpXG4gIH0pO1xuICBjb25zdCBlbGVtZW50c0hhc1NwbGl0ID0gKGVsZW1lbnRzLCBlbGVtZW50UGF0dCwgYm91bmQsIGluUmVzdWx0cyA9IHZvaWQgMCwgb3V0UmVzdWx0cyA9IHZvaWQgMCwgY2hlY2sgPSBpZGVudENoZWNrZXIpID0+IHtcbiAgICBsZXQgY291bnQgPSAwbjtcbiAgICBmb3IgKGxldCBpMiA9IGVsZW1lbnRzLmxlbmd0aCAtIDE7IGkyID49IDA7IGkyIC09IDEpIHtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBlbGVtZW50c1tpMl07XG4gICAgICBpZiAoY291bnQgPCBib3VuZCkge1xuICAgICAgICBpZiAobWF0Y2hlczIoZWxlbWVudCwgZWxlbWVudFBhdHQpKSB7XG4gICAgICAgICAgY291bnQgKz0gMW47XG4gICAgICAgICAgaWYgKGluUmVzdWx0cykgaW5SZXN1bHRzLnB1c2goZWxlbWVudCk7XG4gICAgICAgIH0gZWxzZSBpZiAob3V0UmVzdWx0cykge1xuICAgICAgICAgIG91dFJlc3VsdHMucHVzaChlbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChvdXRSZXN1bHRzID09PSB2b2lkIDApIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvdXRSZXN1bHRzLnB1c2goZWxlbWVudCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjaGVjayhcbiAgICAgIGNvdW50ID49IGJvdW5kLFxuICAgICAgcmVkYWN0ZWRgSGFzIG9ubHkgJHtxdW90ZShjb3VudCl9IG1hdGNoZXMsIGJ1dCBuZWVkcyAke3F1b3RlKGJvdW5kKX1gXG4gICAgKTtcbiAgfTtcbiAgY29uc3QgcGFpcnNIYXNTcGxpdCA9IChwYWlycywgZWxlbWVudFBhdHQsIGJvdW5kLCBpblJlc3VsdHMgPSB2b2lkIDAsIG91dFJlc3VsdHMgPSB2b2lkIDAsIGNoZWNrID0gaWRlbnRDaGVja2VyKSA9PiB7XG4gICAgbGV0IGNvdW50ID0gMG47XG4gICAgZm9yIChsZXQgaTIgPSBwYWlycy5sZW5ndGggLSAxOyBpMiA+PSAwOyBpMiAtPSAxKSB7XG4gICAgICBjb25zdCBbZWxlbWVudCwgbnVtXSA9IHBhaXJzW2kyXTtcbiAgICAgIGNvbnN0IG51bVJlc3QgPSBib3VuZCAtIGNvdW50O1xuICAgICAgaWYgKG51bVJlc3QgPj0gMW4pIHtcbiAgICAgICAgaWYgKG1hdGNoZXMyKGVsZW1lbnQsIGVsZW1lbnRQYXR0KSkge1xuICAgICAgICAgIGlmIChudW0gPD0gbnVtUmVzdCkge1xuICAgICAgICAgICAgY291bnQgKz0gbnVtO1xuICAgICAgICAgICAgaWYgKGluUmVzdWx0cykgaW5SZXN1bHRzLnB1c2goW2VsZW1lbnQsIG51bV0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBudW1JbiA9IG51bVJlc3Q7XG4gICAgICAgICAgICBjb3VudCArPSBudW1JbjtcbiAgICAgICAgICAgIGlmIChpblJlc3VsdHMpIGluUmVzdWx0cy5wdXNoKFtlbGVtZW50LCBudW1SZXN0XSk7XG4gICAgICAgICAgICBpZiAob3V0UmVzdWx0cykgb3V0UmVzdWx0cy5wdXNoKFtlbGVtZW50LCBudW0gLSBudW1SZXN0XSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKG91dFJlc3VsdHMpIHtcbiAgICAgICAgICBvdXRSZXN1bHRzLnB1c2goW2VsZW1lbnQsIG51bV0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKG91dFJlc3VsdHMgPT09IHZvaWQgMCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG91dFJlc3VsdHMucHVzaChbZWxlbWVudCwgbnVtXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjaGVjayhcbiAgICAgIGNvdW50ID49IGJvdW5kLFxuICAgICAgcmVkYWN0ZWRgSGFzIG9ubHkgJHtxdW90ZShjb3VudCl9IG1hdGNoZXMsIGJ1dCBuZWVkcyAke3F1b3RlKGJvdW5kKX1gXG4gICAgKTtcbiAgfTtcbiAgY29uc3QgY29udGFpbmVySGFzU3BsaXQyID0gKHNwZWNpbWVuLCBlbGVtZW50UGF0dCwgYm91bmQsIG5lZWRJblJlc3VsdHMgPSBmYWxzZSwgbmVlZE91dFJlc3VsdHMgPSBmYWxzZSwgY2hlY2sgPSBpZGVudENoZWNrZXIpID0+IHtcbiAgICBjb25zdCBpblJlc3VsdHMgPSBuZWVkSW5SZXN1bHRzID8gW10gOiB2b2lkIDA7XG4gICAgY29uc3Qgb3V0UmVzdWx0cyA9IG5lZWRPdXRSZXN1bHRzID8gW10gOiB2b2lkIDA7XG4gICAgY29uc3Qga2luZDIgPSBraW5kT2YyKHNwZWNpbWVuKTtcbiAgICBzd2l0Y2ggKGtpbmQyKSB7XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgaWYgKCFlbGVtZW50c0hhc1NwbGl0KFxuICAgICAgICAgIHNwZWNpbWVuLFxuICAgICAgICAgIGVsZW1lbnRQYXR0LFxuICAgICAgICAgIGJvdW5kLFxuICAgICAgICAgIGluUmVzdWx0cyxcbiAgICAgICAgICBvdXRSZXN1bHRzLFxuICAgICAgICAgIGNoZWNrXG4gICAgICAgICkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtpblJlc3VsdHMsIG91dFJlc3VsdHNdO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlTZXRcIjoge1xuICAgICAgICBpZiAoIWVsZW1lbnRzSGFzU3BsaXQoXG4gICAgICAgICAgc3BlY2ltZW4ucGF5bG9hZCxcbiAgICAgICAgICBlbGVtZW50UGF0dCxcbiAgICAgICAgICBib3VuZCxcbiAgICAgICAgICBpblJlc3VsdHMsXG4gICAgICAgICAgb3V0UmVzdWx0cyxcbiAgICAgICAgICBjaGVja1xuICAgICAgICApKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgaW5SZXN1bHRzICYmIG1ha2VDb3B5U2V0KGluUmVzdWx0cyksXG4gICAgICAgICAgb3V0UmVzdWx0cyAmJiBtYWtlQ29weVNldChvdXRSZXN1bHRzKVxuICAgICAgICBdO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlCYWdcIjoge1xuICAgICAgICBpZiAoIXBhaXJzSGFzU3BsaXQoXG4gICAgICAgICAgc3BlY2ltZW4ucGF5bG9hZCxcbiAgICAgICAgICBlbGVtZW50UGF0dCxcbiAgICAgICAgICBib3VuZCxcbiAgICAgICAgICBpblJlc3VsdHMsXG4gICAgICAgICAgb3V0UmVzdWx0cyxcbiAgICAgICAgICBjaGVja1xuICAgICAgICApKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgaW5SZXN1bHRzICYmIG1ha2VDb3B5QmFnKGluUmVzdWx0cyksXG4gICAgICAgICAgb3V0UmVzdWx0cyAmJiBtYWtlQ29weUJhZyhvdXRSZXN1bHRzKVxuICAgICAgICBdO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYHVuZXhwZWN0ZWQgJHtxdW90ZShraW5kMil9YCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBtYXRjaENvbnRhaW5lckhhc0hlbHBlciA9IEZhcihcIk0uY29udGFpbmVySGFzIGhlbHBlclwiLCB7XG4gICAgLypcblxuXG5cbiAgICAgKi9cbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2VsZW1lbnRQYXR0LCBib3VuZCwgbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IGtpbmQyID0ga2luZE9mMihzcGVjaW1lbiwgY2hlY2spO1xuICAgICAgY29uc3QgeyBkZWNpbWFsRGlnaXRzTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICBpZiAoIWFwcGx5TGFiZWxpbmdFcnJvcihcbiAgICAgICAgY2hlY2tEZWNpbWFsRGlnaXRzTGltaXQsXG4gICAgICAgIFtib3VuZCwgZGVjaW1hbERpZ2l0c0xpbWl0LCBjaGVja10sXG4gICAgICAgIGAke2tpbmQyfSBtYXRjaGVzYFxuICAgICAgKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gISFjb250YWluZXJIYXNTcGxpdDIoXG4gICAgICAgIHNwZWNpbWVuLFxuICAgICAgICBlbGVtZW50UGF0dCxcbiAgICAgICAgYm91bmQsXG4gICAgICAgIGZhbHNlLFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgY2hlY2tcbiAgICAgICk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKSwgTU0uZ3RlKDFuKV0pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIk0uY29udGFpbmVySGFzIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcInRhZ2dlZFwiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hNYXBPZkhlbHBlciA9IEZhcihcIm1hdGNoOm1hcE9mIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtrZXlQYXR0LCB2YWx1ZVBhdHQsIGxpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IG51bU1hcEVudHJpZXNMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwiY29weU1hcFwiLCBjaGVjaykgJiYgY2hlY2soXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNwZWNpbWVuLnBheWxvYWQua2V5cy5sZW5ndGggPD0gbnVtTWFwRW50cmllc0xpbWl0LFxuICAgICAgICByZWRhY3RlZGBDb3B5TWFwIG11c3QgaGF2ZSBubyBtb3JlIHRoYW4gJHtxdW90ZShcbiAgICAgICAgICBudW1NYXBFbnRyaWVzTGltaXRcbiAgICAgICAgKX0gZW50cmllczogJHtzcGVjaW1lbn1gXG4gICAgICApICYmIGFycmF5RXZlcnlNYXRjaFBhdHRlcm4oXG4gICAgICAgIHNwZWNpbWVuLnBheWxvYWQua2V5cyxcbiAgICAgICAga2V5UGF0dCxcbiAgICAgICAgY2hlY2ssXG4gICAgICAgIFwibWFwIGtleXNcIlxuICAgICAgKSAmJiBhcnJheUV2ZXJ5TWF0Y2hQYXR0ZXJuKFxuICAgICAgICBzcGVjaW1lbi5wYXlsb2FkLnZhbHVlcyxcbiAgICAgICAgdmFsdWVQYXR0LFxuICAgICAgICBjaGVjayxcbiAgICAgICAgXCJtYXAgdmFsdWVzXCJcbiAgICAgICk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKSwgTU0ucGF0dGVybigpXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6bWFwT2YgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfZW50cnlQYXR0KSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcInRhZ2dlZFwiKVxuICB9KTtcbiAgY29uc3Qgc3BsaXRBcnJheVBhcnRzID0gKHNwZWNpbWVuLCByZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCkgPT4ge1xuICAgIGNvbnN0IG51bVJlcXVpcmVkID0gcmVxdWlyZWRQYXR0Lmxlbmd0aDtcbiAgICBjb25zdCBudW1PcHRpb25hbCA9IG9wdGlvbmFsUGF0dC5sZW5ndGg7XG4gICAgY29uc3QgcmVxdWlyZWRTcGVjaW1lbiA9IHNwZWNpbWVuLnNsaWNlKDAsIG51bVJlcXVpcmVkKTtcbiAgICBjb25zdCBvcHRpb25hbFNwZWNpbWVuID0gc3BlY2ltZW4uc2xpY2UoXG4gICAgICBudW1SZXF1aXJlZCxcbiAgICAgIG51bVJlcXVpcmVkICsgbnVtT3B0aW9uYWxcbiAgICApO1xuICAgIGNvbnN0IHJlc3RTcGVjaW1lbiA9IHNwZWNpbWVuLnNsaWNlKG51bVJlcXVpcmVkICsgbnVtT3B0aW9uYWwpO1xuICAgIHJldHVybiBoYXJkZW4oeyByZXF1aXJlZFNwZWNpbWVuLCBvcHRpb25hbFNwZWNpbWVuLCByZXN0U3BlY2ltZW4gfSk7XG4gIH07XG4gIGNvbnN0IGFkYXB0QXJyYXlQYXR0ZXJuID0gKG9wdGlvbmFsUGF0dCwgbGVuZ3RoKSA9PiBoYXJkZW4ob3B0aW9uYWxQYXR0LnNsaWNlKDAsIGxlbmd0aCkubWFwKChwYXR0KSA9PiBNTS5vcHQocGF0dCkpKTtcbiAgY29uc3QgbWF0Y2hTcGxpdEFycmF5SGVscGVyID0gRmFyKFwibWF0Y2g6c3BsaXRBcnJheSBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQgPSBbXSwgcmVzdFBhdHQgPSBNTS5hbnkoKV0sIGNoZWNrKSA9PiB7XG4gICAgICBpZiAoIWNoZWNrS2luZChzcGVjaW1lbiwgXCJjb3B5QXJyYXlcIiwgY2hlY2spKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgcmVxdWlyZWRTcGVjaW1lbiwgb3B0aW9uYWxTcGVjaW1lbiwgcmVzdFNwZWNpbWVuIH0gPSBzcGxpdEFycmF5UGFydHMoc3BlY2ltZW4sIHJlcXVpcmVkUGF0dCwgb3B0aW9uYWxQYXR0KTtcbiAgICAgIGNvbnN0IHBhcnRpYWxQYXR0ID0gYWRhcHRBcnJheVBhdHRlcm4oXG4gICAgICAgIG9wdGlvbmFsUGF0dCxcbiAgICAgICAgb3B0aW9uYWxTcGVjaW1lbi5sZW5ndGhcbiAgICAgICk7XG4gICAgICBsZXQgYXJnTnVtID0gMDtcbiAgICAgIHJldHVybiAocmVxdWlyZWRTcGVjaW1lbi5sZW5ndGggPT09IHJlcXVpcmVkUGF0dC5sZW5ndGggfHwgY2hlY2soXG4gICAgICAgIGZhbHNlLFxuICAgICAgICByZWRhY3RlZGBFeHBlY3RlZCBhdCBsZWFzdCAke3F1b3RlKFxuICAgICAgICAgIHJlcXVpcmVkUGF0dC5sZW5ndGhcbiAgICAgICAgKX0gYXJndW1lbnRzOiAke3NwZWNpbWVufWBcbiAgICAgICkpICYmIHJlcXVpcmVkUGF0dC5ldmVyeShcbiAgICAgICAgKHAyLCBpMikgPT4gKFxuICAgICAgICAgIC8vXG4gICAgICAgICAgY2hlY2tNYXRjaGVzMihyZXF1aXJlZFNwZWNpbWVuW2kyXSwgcDIsIGNoZWNrLCBgYXJnICR7YXJnTnVtKyt9YClcbiAgICAgICAgKVxuICAgICAgKSAmJiBwYXJ0aWFsUGF0dC5ldmVyeShcbiAgICAgICAgKHAyLCBpMikgPT4gKFxuICAgICAgICAgIC8vXG4gICAgICAgICAgY2hlY2tNYXRjaGVzMihvcHRpb25hbFNwZWNpbWVuW2kyXSwgcDIsIGNoZWNrLCBgYXJnICR7YXJnTnVtKyt9P2ApXG4gICAgICAgIClcbiAgICAgICkgJiYgY2hlY2tNYXRjaGVzMihyZXN0U3BlY2ltZW4sIHJlc3RQYXR0LCBjaGVjaywgXCIuLi5yZXN0XCIpO1xuICAgIH0sXG4gICAgLypcblxuXG4gICAgICovXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChzcGxpdEFycmF5LCBjaGVjaykgPT4ge1xuICAgICAgaWYgKHBhc3NTdHlsZU9mKHNwbGl0QXJyYXkpID09PSBcImNvcHlBcnJheVwiICYmIChzcGxpdEFycmF5Lmxlbmd0aCA+PSAxIHx8IHNwbGl0QXJyYXkubGVuZ3RoIDw9IDMpKSB7XG4gICAgICAgIGNvbnN0IFtyZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCA9IHZvaWQgMCwgcmVzdFBhdHQgPSB2b2lkIDBdID0gc3BsaXRBcnJheTtcbiAgICAgICAgaWYgKGlzUGF0dGVybjIocmVxdWlyZWRQYXR0KSAmJiBwYXNzU3R5bGVPZihyZXF1aXJlZFBhdHQpID09PSBcImNvcHlBcnJheVwiICYmIChvcHRpb25hbFBhdHQgPT09IHZvaWQgMCB8fCBpc1BhdHRlcm4yKG9wdGlvbmFsUGF0dCkgJiYgcGFzc1N0eWxlT2Yob3B0aW9uYWxQYXR0KSA9PT0gXCJjb3B5QXJyYXlcIikgJiYgKHJlc3RQYXR0ID09PSB2b2lkIDAgfHwgaXNQYXR0ZXJuMihyZXN0UGF0dCkpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYE11c3QgYmUgYW4gYXJyYXkgb2YgYSByZXF1aXJlZFBhdHQgYXJyYXksIGFuIG9wdGlvbmFsIG9wdGlvbmFsUGF0dCBhcnJheSwgYW5kIGFuIG9wdGlvbmFsIHJlc3RQYXR0OiAke3F1b3RlKFxuICAgICAgICAgIHNwbGl0QXJyYXlcbiAgICAgICAgKX1gXG4gICAgICApO1xuICAgIH0sXG4gICAgZ2V0UmFua0NvdmVyOiAoW1xuICAgICAgX3JlcXVpcmVkUGF0dCxcbiAgICAgIF9vcHRpb25hbFBhdHQgPSB2b2lkIDAsXG4gICAgICBfcmVzdFBhdHQgPSB2b2lkIDBcbiAgICBdKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcImNvcHlBcnJheVwiKVxuICB9KTtcbiAgY29uc3Qgc3BsaXRSZWNvcmRQYXJ0cyA9IChzcGVjaW1lbiwgcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQpID0+IHtcbiAgICBjb25zdCByZXF1aXJlZEVudHJpZXMgPSBbXTtcbiAgICBjb25zdCBvcHRpb25hbEVudHJpZXMgPSBbXTtcbiAgICBjb25zdCByZXN0RW50cmllcyA9IFtdO1xuICAgIGZvciAoY29uc3QgW25hbWUsIHZhbHVlXSBvZiBlbnRyaWVzNyhzcGVjaW1lbikpIHtcbiAgICAgIGlmIChoYXNPd245KHJlcXVpcmVkUGF0dCwgbmFtZSkpIHtcbiAgICAgICAgcmVxdWlyZWRFbnRyaWVzLnB1c2goW25hbWUsIHZhbHVlXSk7XG4gICAgICB9IGVsc2UgaWYgKGhhc093bjkob3B0aW9uYWxQYXR0LCBuYW1lKSkge1xuICAgICAgICBvcHRpb25hbEVudHJpZXMucHVzaChbbmFtZSwgdmFsdWVdKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3RFbnRyaWVzLnB1c2goW25hbWUsIHZhbHVlXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgcmVxdWlyZWRTcGVjaW1lbjogZnJvbVVuaXF1ZUVudHJpZXMocmVxdWlyZWRFbnRyaWVzKSxcbiAgICAgIG9wdGlvbmFsU3BlY2ltZW46IGZyb21VbmlxdWVFbnRyaWVzKG9wdGlvbmFsRW50cmllcyksXG4gICAgICByZXN0U3BlY2ltZW46IGZyb21VbmlxdWVFbnRyaWVzKHJlc3RFbnRyaWVzKVxuICAgIH0pO1xuICB9O1xuICBjb25zdCBhZGFwdFJlY29yZFBhdHRlcm4gPSAob3B0aW9uYWxQYXR0LCBuYW1lcykgPT4gZnJvbVVuaXF1ZUVudHJpZXMobmFtZXMubWFwKChuYW1lKSA9PiBbbmFtZSwgTU0ub3B0KG9wdGlvbmFsUGF0dFtuYW1lXSldKSk7XG4gIGNvbnN0IG1hdGNoU3BsaXRSZWNvcmRIZWxwZXIgPSBGYXIoXCJtYXRjaDpzcGxpdFJlY29yZCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQgPSB7fSwgcmVzdFBhdHQgPSBNTS5hbnkoKV0sIGNoZWNrKSA9PiB7XG4gICAgICBpZiAoIWNoZWNrS2luZChzcGVjaW1lbiwgXCJjb3B5UmVjb3JkXCIsIGNoZWNrKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjb25zdCB7IHJlcXVpcmVkU3BlY2ltZW4sIG9wdGlvbmFsU3BlY2ltZW4sIHJlc3RTcGVjaW1lbiB9ID0gc3BsaXRSZWNvcmRQYXJ0cyhzcGVjaW1lbiwgcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQpO1xuICAgICAgY29uc3QgcGFydGlhbE5hbWVzID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBvd25LZXlzMTgob3B0aW9uYWxTcGVjaW1lbilcbiAgICAgICk7XG4gICAgICBjb25zdCBwYXJ0aWFsUGF0dCA9IGFkYXB0UmVjb3JkUGF0dGVybihvcHRpb25hbFBhdHQsIHBhcnRpYWxOYW1lcyk7XG4gICAgICByZXR1cm4gY2hlY2tNYXRjaGVzMihyZXF1aXJlZFNwZWNpbWVuLCByZXF1aXJlZFBhdHQsIGNoZWNrKSAmJiBwYXJ0aWFsTmFtZXMuZXZlcnkoXG4gICAgICAgIChuYW1lKSA9PiBjaGVja01hdGNoZXMyKFxuICAgICAgICAgIG9wdGlvbmFsU3BlY2ltZW5bbmFtZV0sXG4gICAgICAgICAgcGFydGlhbFBhdHRbbmFtZV0sXG4gICAgICAgICAgY2hlY2ssXG4gICAgICAgICAgYCR7bmFtZX0/YFxuICAgICAgICApXG4gICAgICApICYmIGNoZWNrTWF0Y2hlczIocmVzdFNwZWNpbWVuLCByZXN0UGF0dCwgY2hlY2ssIFwiLi4ucmVzdFwiKTtcbiAgICB9LFxuICAgIC8qXG5cblxuICAgICAqL1xuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAoc3BsaXRBcnJheSwgY2hlY2spID0+IHtcbiAgICAgIGlmIChwYXNzU3R5bGVPZihzcGxpdEFycmF5KSA9PT0gXCJjb3B5QXJyYXlcIiAmJiAoc3BsaXRBcnJheS5sZW5ndGggPj0gMSB8fCBzcGxpdEFycmF5Lmxlbmd0aCA8PSAzKSkge1xuICAgICAgICBjb25zdCBbcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQgPSB2b2lkIDAsIHJlc3RQYXR0ID0gdm9pZCAwXSA9IHNwbGl0QXJyYXk7XG4gICAgICAgIGlmIChpc1BhdHRlcm4yKHJlcXVpcmVkUGF0dCkgJiYgcGFzc1N0eWxlT2YocmVxdWlyZWRQYXR0KSA9PT0gXCJjb3B5UmVjb3JkXCIgJiYgKG9wdGlvbmFsUGF0dCA9PT0gdm9pZCAwIHx8IGlzUGF0dGVybjIob3B0aW9uYWxQYXR0KSAmJiBwYXNzU3R5bGVPZihvcHRpb25hbFBhdHQpID09PSBcImNvcHlSZWNvcmRcIikgJiYgKHJlc3RQYXR0ID09PSB2b2lkIDAgfHwgaXNQYXR0ZXJuMihyZXN0UGF0dCkpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYE11c3QgYmUgYW4gYXJyYXkgb2YgYSByZXF1aXJlZFBhdHQgcmVjb3JkLCBhbiBvcHRpb25hbCBvcHRpb25hbFBhdHQgcmVjb3JkLCBhbmQgYW4gb3B0aW9uYWwgcmVzdFBhdHQ6ICR7cXVvdGUoXG4gICAgICAgICAgc3BsaXRBcnJheVxuICAgICAgICApfWBcbiAgICAgICk7XG4gICAgfSxcbiAgICBnZXRSYW5rQ292ZXI6IChbXG4gICAgICByZXF1aXJlZFBhdHQsXG4gICAgICBfb3B0aW9uYWxQYXR0ID0gdm9pZCAwLFxuICAgICAgX3Jlc3RQYXR0ID0gdm9pZCAwXG4gICAgXSkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIocGFzc1N0eWxlT2YocmVxdWlyZWRQYXR0KSlcbiAgfSk7XG4gIGNvbnN0IEhlbHBlcnNCeU1hdGNoVGFnID0gaGFyZGVuKHtcbiAgICBcIm1hdGNoOmFueVwiOiBtYXRjaEFueUhlbHBlcixcbiAgICBcIm1hdGNoOmFuZFwiOiBtYXRjaEFuZEhlbHBlcixcbiAgICBcIm1hdGNoOm9yXCI6IG1hdGNoT3JIZWxwZXIsXG4gICAgXCJtYXRjaDpub3RcIjogbWF0Y2hOb3RIZWxwZXIsXG4gICAgXCJtYXRjaDpzY2FsYXJcIjogbWF0Y2hTY2FsYXJIZWxwZXIsXG4gICAgXCJtYXRjaDprZXlcIjogbWF0Y2hLZXlIZWxwZXIsXG4gICAgXCJtYXRjaDpwYXR0ZXJuXCI6IG1hdGNoUGF0dGVybkhlbHBlcixcbiAgICBcIm1hdGNoOmtpbmRcIjogbWF0Y2hLaW5kSGVscGVyLFxuICAgIFwibWF0Y2g6dGFnZ2VkXCI6IG1hdGNoVGFnZ2VkSGVscGVyLFxuICAgIFwibWF0Y2g6YmlnaW50XCI6IG1hdGNoQmlnaW50SGVscGVyLFxuICAgIFwibWF0Y2g6bmF0XCI6IG1hdGNoTmF0SGVscGVyLFxuICAgIFwibWF0Y2g6c3RyaW5nXCI6IG1hdGNoU3RyaW5nSGVscGVyLFxuICAgIFwibWF0Y2g6c3ltYm9sXCI6IG1hdGNoU3ltYm9sSGVscGVyLFxuICAgIFwibWF0Y2g6cmVtb3RhYmxlXCI6IG1hdGNoUmVtb3RhYmxlSGVscGVyLFxuICAgIFwibWF0Y2g6bHRcIjogbWF0Y2hMVEhlbHBlcixcbiAgICBcIm1hdGNoOmx0ZVwiOiBtYXRjaExURUhlbHBlcixcbiAgICBcIm1hdGNoOmd0ZVwiOiBtYXRjaEdURUhlbHBlcixcbiAgICBcIm1hdGNoOmd0XCI6IG1hdGNoR1RIZWxwZXIsXG4gICAgXCJtYXRjaDphcnJheU9mXCI6IG1hdGNoQXJyYXlPZkhlbHBlcixcbiAgICBcIm1hdGNoOmJ5dGVBcnJheVwiOiBtYXRjaEJ5dGVBcnJheUhlbHBlcixcbiAgICBcIm1hdGNoOnJlY29yZE9mXCI6IG1hdGNoUmVjb3JkT2ZIZWxwZXIsXG4gICAgXCJtYXRjaDpzZXRPZlwiOiBtYXRjaFNldE9mSGVscGVyLFxuICAgIFwibWF0Y2g6YmFnT2ZcIjogbWF0Y2hCYWdPZkhlbHBlcixcbiAgICBcIm1hdGNoOmNvbnRhaW5lckhhc1wiOiBtYXRjaENvbnRhaW5lckhhc0hlbHBlcixcbiAgICBcIm1hdGNoOm1hcE9mXCI6IG1hdGNoTWFwT2ZIZWxwZXIsXG4gICAgXCJtYXRjaDpzcGxpdEFycmF5XCI6IG1hdGNoU3BsaXRBcnJheUhlbHBlcixcbiAgICBcIm1hdGNoOnNwbGl0UmVjb3JkXCI6IG1hdGNoU3BsaXRSZWNvcmRIZWxwZXJcbiAgfSk7XG4gIGNvbnN0IG1ha2VNYXRjaGVyID0gKHRhZywgcGF5bG9hZCkgPT4ge1xuICAgIGNvbnN0IG1hdGNoZXIgPSBtYWtlVGFnZ2VkKHRhZywgcGF5bG9hZCk7XG4gICAgYXNzZXJ0UGF0dGVybjIobWF0Y2hlcik7XG4gICAgcmV0dXJuIG1hdGNoZXI7XG4gIH07XG4gIGNvbnN0IG1ha2VLaW5kTWF0Y2hlciA9IChraW5kMikgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpraW5kXCIsIGtpbmQyKTtcbiAgY29uc3QgQW55U2hhcGUgPSBtYWtlTWF0Y2hlcihcIm1hdGNoOmFueVwiLCB2b2lkIDApO1xuICBjb25zdCBTY2FsYXJTaGFwZSA9IG1ha2VNYXRjaGVyKFwibWF0Y2g6c2NhbGFyXCIsIHZvaWQgMCk7XG4gIGNvbnN0IEtleVNoYXBlID0gbWFrZU1hdGNoZXIoXCJtYXRjaDprZXlcIiwgdm9pZCAwKTtcbiAgY29uc3QgUGF0dGVyblNoYXBlID0gbWFrZU1hdGNoZXIoXCJtYXRjaDpwYXR0ZXJuXCIsIHZvaWQgMCk7XG4gIGNvbnN0IEJvb2xlYW5TaGFwZSA9IG1ha2VLaW5kTWF0Y2hlcihcImJvb2xlYW5cIik7XG4gIGNvbnN0IE51bWJlclNoYXBlID0gbWFrZUtpbmRNYXRjaGVyKFwibnVtYmVyXCIpO1xuICBjb25zdCBCaWdJbnRTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpiaWdpbnRcIiwgW10pO1xuICBjb25zdCBOYXRTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpuYXRcIiwgW10pO1xuICBjb25zdCBTdHJpbmdTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpzdHJpbmdcIiwgW10pO1xuICBjb25zdCBTeW1ib2xTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpzeW1ib2xcIiwgW10pO1xuICBjb25zdCBSZWNvcmRTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpyZWNvcmRPZlwiLCBbQW55U2hhcGUsIEFueVNoYXBlXSk7XG4gIGNvbnN0IEFycmF5U2hhcGUgPSBtYWtlVGFnZ2VkKFwibWF0Y2g6YXJyYXlPZlwiLCBbQW55U2hhcGVdKTtcbiAgY29uc3QgQnl0ZUFycmF5U2hhcGUgPSBtYWtlVGFnZ2VkKFwibWF0Y2g6Ynl0ZUFycmF5XCIsIFtdKTtcbiAgY29uc3QgU2V0U2hhcGUgPSBtYWtlVGFnZ2VkKFwibWF0Y2g6c2V0T2ZcIiwgW0FueVNoYXBlXSk7XG4gIGNvbnN0IEJhZ1NoYXBlID0gbWFrZVRhZ2dlZChcIm1hdGNoOmJhZ09mXCIsIFtBbnlTaGFwZSwgQW55U2hhcGVdKTtcbiAgY29uc3QgTWFwU2hhcGUgPSBtYWtlVGFnZ2VkKFwibWF0Y2g6bWFwT2ZcIiwgW0FueVNoYXBlLCBBbnlTaGFwZV0pO1xuICBjb25zdCBSZW1vdGFibGVTaGFwZSA9IG1ha2VLaW5kTWF0Y2hlcihcInJlbW90YWJsZVwiKTtcbiAgY29uc3QgRXJyb3JTaGFwZSA9IG1ha2VLaW5kTWF0Y2hlcihcImVycm9yXCIpO1xuICBjb25zdCBQcm9taXNlU2hhcGUgPSBtYWtlS2luZE1hdGNoZXIoXCJwcm9taXNlXCIpO1xuICBjb25zdCBVbmRlZmluZWRTaGFwZSA9IG1ha2VLaW5kTWF0Y2hlcihcInVuZGVmaW5lZFwiKTtcbiAgY29uc3QgbWFrZUxpbWl0c01hdGNoZXIgPSAodGFnLCBwYXlsb2FkKSA9PiB7XG4gICAgaWYgKHBheWxvYWRbcGF5bG9hZC5sZW5ndGggLSAxXSA9PT0gdm9pZCAwKSB7XG4gICAgICBwYXlsb2FkID0gaGFyZGVuKHBheWxvYWQuc2xpY2UoMCwgcGF5bG9hZC5sZW5ndGggLSAxKSk7XG4gICAgfVxuICAgIHJldHVybiBtYWtlTWF0Y2hlcih0YWcsIHBheWxvYWQpO1xuICB9O1xuICBjb25zdCBtYWtlUmVtb3RhYmxlTWF0Y2hlciA9IChsYWJlbCA9IHZvaWQgMCkgPT4gbGFiZWwgPT09IHZvaWQgMCA/IFJlbW90YWJsZVNoYXBlIDogbWFrZU1hdGNoZXIoXCJtYXRjaDpyZW1vdGFibGVcIiwgaGFyZGVuKHsgbGFiZWwgfSkpO1xuICBjb25zdCBtYWtlU3BsaXRQYXlsb2FkID0gKGVtcHR5OSwgYmFzZTIsIG9wdGlvbmFsID0gdm9pZCAwLCByZXN0ID0gdm9pZCAwKSA9PiB7XG4gICAgaWYgKHJlc3QpIHtcbiAgICAgIHJldHVybiBbYmFzZTIsIG9wdGlvbmFsIHx8IGVtcHR5OSwgcmVzdF07XG4gICAgfVxuICAgIGlmIChvcHRpb25hbCkge1xuICAgICAgcmV0dXJuIFtiYXNlMiwgb3B0aW9uYWxdO1xuICAgIH1cbiAgICByZXR1cm4gW2Jhc2UyXTtcbiAgfTtcbiAgY29uc3QgTTMgPSBoYXJkZW4oe1xuICAgIGFueTogKCkgPT4gQW55U2hhcGUsXG4gICAgYW5kOiAoLi4ucGF0dHMpID0+IG1ha2VNYXRjaGVyKFwibWF0Y2g6YW5kXCIsIHBhdHRzKSxcbiAgICBvcjogKC4uLnBhdHRzKSA9PiBtYWtlTWF0Y2hlcihcIm1hdGNoOm9yXCIsIHBhdHRzKSxcbiAgICBub3Q6IChzdWJQYXR0KSA9PiBtYWtlTWF0Y2hlcihcIm1hdGNoOm5vdFwiLCBzdWJQYXR0KSxcbiAgICBzY2FsYXI6ICgpID0+IFNjYWxhclNoYXBlLFxuICAgIGtleTogKCkgPT4gS2V5U2hhcGUsXG4gICAgcGF0dGVybjogKCkgPT4gUGF0dGVyblNoYXBlLFxuICAgIGtpbmQ6IG1ha2VLaW5kTWF0Y2hlcixcbiAgICB0YWdnZWQ6ICh0YWdQYXR0ID0gTTMuc3RyaW5nKCksIHBheWxvYWRQYXR0ID0gTTMuYW55KCkpID0+IG1ha2VNYXRjaGVyKFwibWF0Y2g6dGFnZ2VkXCIsIGhhcmRlbihbdGFnUGF0dCwgcGF5bG9hZFBhdHRdKSksXG4gICAgYm9vbGVhbjogKCkgPT4gQm9vbGVhblNoYXBlLFxuICAgIG51bWJlcjogKCkgPT4gTnVtYmVyU2hhcGUsXG4gICAgYmlnaW50OiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOmJpZ2ludFwiLCBbbGltaXRzXSkgOiBCaWdJbnRTaGFwZSxcbiAgICBuYXQ6IChsaW1pdHMgPSB2b2lkIDApID0+IGxpbWl0cyA/IG1ha2VMaW1pdHNNYXRjaGVyKFwibWF0Y2g6bmF0XCIsIFtsaW1pdHNdKSA6IE5hdFNoYXBlLFxuICAgIHN0cmluZzogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDpzdHJpbmdcIiwgW2xpbWl0c10pIDogU3RyaW5nU2hhcGUsXG4gICAgc3ltYm9sOiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOnN5bWJvbFwiLCBbbGltaXRzXSkgOiBTeW1ib2xTaGFwZSxcbiAgICByZWNvcmQ6IChsaW1pdHMgPSB2b2lkIDApID0+IGxpbWl0cyA/IE0zLnJlY29yZE9mKE0zLmFueSgpLCBNMy5hbnkoKSwgbGltaXRzKSA6IFJlY29yZFNoYXBlLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgYXJyYXk6IChsaW1pdHMgPSB2b2lkIDApID0+IGxpbWl0cyA/IE0zLmFycmF5T2YoTTMuYW55KCksIGxpbWl0cykgOiBBcnJheVNoYXBlLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIGJ5dGVBcnJheTogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDpieXRlQXJyYXlcIiwgW2xpbWl0c10pIDogQnl0ZUFycmF5U2hhcGUsXG4gICAgc2V0OiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBNMy5zZXRPZihNMy5hbnkoKSwgbGltaXRzKSA6IFNldFNoYXBlLFxuICAgIGJhZzogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gTTMuYmFnT2YoTTMuYW55KCksIE0zLmFueSgpLCBsaW1pdHMpIDogQmFnU2hhcGUsXG4gICAgbWFwOiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBNMy5tYXBPZihNMy5hbnkoKSwgTTMuYW55KCksIGxpbWl0cykgOiBNYXBTaGFwZSxcbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIHJlbW90YWJsZTogbWFrZVJlbW90YWJsZU1hdGNoZXIsXG4gICAgZXJyb3I6ICgpID0+IEVycm9yU2hhcGUsXG4gICAgcHJvbWlzZTogKCkgPT4gUHJvbWlzZVNoYXBlLFxuICAgIHVuZGVmaW5lZDogKCkgPT4gVW5kZWZpbmVkU2hhcGUsXG4gICAgbnVsbDogKCkgPT4gbnVsbCxcbiAgICBsdDogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpsdFwiLCByaWdodE9wZXJhbmQpLFxuICAgIGx0ZTogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpsdGVcIiwgcmlnaHRPcGVyYW5kKSxcbiAgICBlcTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5KGtleSk7XG4gICAgICByZXR1cm4ga2V5ID09PSB2b2lkIDAgPyBNMy51bmRlZmluZWQoKSA6IGtleTtcbiAgICB9LFxuICAgIG5lcTogKGtleSkgPT4gTTMubm90KE0zLmVxKGtleSkpLFxuICAgIGd0ZTogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpndGVcIiwgcmlnaHRPcGVyYW5kKSxcbiAgICBndDogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpndFwiLCByaWdodE9wZXJhbmQpLFxuICAgIHJlY29yZE9mOiAoa2V5UGF0dCA9IE0zLmFueSgpLCB2YWx1ZVBhdHQgPSBNMy5hbnkoKSwgbGltaXRzID0gdm9pZCAwKSA9PiBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOnJlY29yZE9mXCIsIFtrZXlQYXR0LCB2YWx1ZVBhdHQsIGxpbWl0c10pLFxuICAgIGFycmF5T2Y6IChzdWJQYXR0ID0gTTMuYW55KCksIGxpbWl0cyA9IHZvaWQgMCkgPT4gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDphcnJheU9mXCIsIFtzdWJQYXR0LCBsaW1pdHNdKSxcbiAgICBzZXRPZjogKGtleVBhdHQgPSBNMy5hbnkoKSwgbGltaXRzID0gdm9pZCAwKSA9PiBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOnNldE9mXCIsIFtrZXlQYXR0LCBsaW1pdHNdKSxcbiAgICBiYWdPZjogKGtleVBhdHQgPSBNMy5hbnkoKSwgY291bnRQYXR0ID0gTTMuYW55KCksIGxpbWl0cyA9IHZvaWQgMCkgPT4gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDpiYWdPZlwiLCBba2V5UGF0dCwgY291bnRQYXR0LCBsaW1pdHNdKSxcbiAgICBjb250YWluZXJIYXM6IChlbGVtZW50UGF0dCA9IE0zLmFueSgpLCBjb3VudFBhdHQgPSAxbiwgbGltaXRzID0gdm9pZCAwKSA9PiBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOmNvbnRhaW5lckhhc1wiLCBbZWxlbWVudFBhdHQsIGNvdW50UGF0dCwgbGltaXRzXSksXG4gICAgbWFwT2Y6IChrZXlQYXR0ID0gTTMuYW55KCksIHZhbHVlUGF0dCA9IE0zLmFueSgpLCBsaW1pdHMgPSB2b2lkIDApID0+IG1ha2VMaW1pdHNNYXRjaGVyKFwibWF0Y2g6bWFwT2ZcIiwgW2tleVBhdHQsIHZhbHVlUGF0dCwgbGltaXRzXSksXG4gICAgc3BsaXRBcnJheTogKGJhc2UyLCBvcHRpb25hbCA9IHZvaWQgMCwgcmVzdCA9IHZvaWQgMCkgPT4gbWFrZU1hdGNoZXIoXG4gICAgICBcIm1hdGNoOnNwbGl0QXJyYXlcIixcbiAgICAgIG1ha2VTcGxpdFBheWxvYWQoW10sIGJhc2UyLCBvcHRpb25hbCwgcmVzdClcbiAgICApLFxuICAgIHNwbGl0UmVjb3JkOiAoYmFzZTIsIG9wdGlvbmFsID0gdm9pZCAwLCByZXN0ID0gdm9pZCAwKSA9PiBtYWtlTWF0Y2hlcihcbiAgICAgIFwibWF0Y2g6c3BsaXRSZWNvcmRcIixcbiAgICAgIG1ha2VTcGxpdFBheWxvYWQoe30sIGJhc2UyLCBvcHRpb25hbCwgcmVzdClcbiAgICApLFxuICAgIHNwbGl0OiAoYmFzZTIsIHJlc3QgPSB2b2lkIDApID0+IHtcbiAgICAgIGlmIChwYXNzU3R5bGVPZihoYXJkZW4oYmFzZTIpKSA9PT0gXCJjb3B5QXJyYXlcIikge1xuICAgICAgICByZXR1cm4gTTMuc3BsaXRBcnJheShiYXNlMiwgcmVzdCAmJiBbXSwgcmVzdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gTTMuc3BsaXRSZWNvcmQoYmFzZTIsIHJlc3QgJiYge30sIHJlc3QpO1xuICAgICAgfVxuICAgIH0sXG4gICAgcGFydGlhbDogKGJhc2UyLCByZXN0ID0gdm9pZCAwKSA9PiB7XG4gICAgICBpZiAocGFzc1N0eWxlT2YoaGFyZGVuKGJhc2UyKSkgPT09IFwiY29weUFycmF5XCIpIHtcbiAgICAgICAgcmV0dXJuIE0zLnNwbGl0QXJyYXkoW10sIGJhc2UyLCByZXN0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBNMy5zcGxpdFJlY29yZCh7fSwgYmFzZTIsIHJlc3QpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZXJlZjogKHQ1KSA9PiBNMy5vcih0NSwgTTMucHJvbWlzZSgpKSxcbiAgICBvcHQ6ICh0NSkgPT4gTTMub3IoTTMudW5kZWZpbmVkKCksIHQ1KSxcbiAgICBpbnRlcmZhY2U6IChpbnRlcmZhY2VOYW1lLCBtZXRob2RHdWFyZHMsIG9wdGlvbnMpID0+IChcbiAgICAgIC8vXG4gICAgICBtYWtlSW50ZXJmYWNlR3VhcmQoaW50ZXJmYWNlTmFtZSwgbWV0aG9kR3VhcmRzLCBvcHRpb25zKVxuICAgICksXG4gICAgY2FsbDogKC4uLmFyZ1BhdHRlcm5zKSA9PiAoXG4gICAgICAvL1xuICAgICAgbWFrZU1ldGhvZEd1YXJkTWFrZXIoXCJzeW5jXCIsIGFyZ1BhdHRlcm5zKVxuICAgICksXG4gICAgY2FsbFdoZW46ICguLi5hcmdHdWFyZHMpID0+IChcbiAgICAgIC8vXG4gICAgICBtYWtlTWV0aG9kR3VhcmRNYWtlcihcImFzeW5jXCIsIGFyZ0d1YXJkcylcbiAgICApLFxuICAgIGF3YWl0OiAoYXJnUGF0dGVybikgPT4gKFxuICAgICAgLy9cbiAgICAgIG1ha2VBd2FpdEFyZ0d1YXJkKGFyZ1BhdHRlcm4pXG4gICAgKSxcbiAgICByYXc6ICgpID0+IChcbiAgICAgIC8vXG4gICAgICBtYWtlUmF3R3VhcmQoKVxuICAgIClcbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGNoZWNrTWF0Y2hlczogY2hlY2tNYXRjaGVzMixcbiAgICBtYXRjaGVzOiBtYXRjaGVzMixcbiAgICBtdXN0TWF0Y2g6IG11c3RNYXRjaDUsXG4gICAgYXNzZXJ0UGF0dGVybjogYXNzZXJ0UGF0dGVybjIsXG4gICAgaXNQYXR0ZXJuOiBpc1BhdHRlcm4yLFxuICAgIGdldFJhbmtDb3ZlcjogZ2V0UmFua0NvdmVyMixcbiAgICBNOiBNMyxcbiAgICBraW5kT2Y6IGtpbmRPZjIsXG4gICAgY29udGFpbmVySGFzU3BsaXQ6IGNvbnRhaW5lckhhc1NwbGl0MlxuICB9KTtcbn07XG52YXIge1xuICBjaGVja01hdGNoZXMsXG4gIG1hdGNoZXMsXG4gIG11c3RNYXRjaCxcbiAgYXNzZXJ0UGF0dGVybixcbiAgaXNQYXR0ZXJuLFxuICBnZXRSYW5rQ292ZXIsXG4gIE0sXG4gIGtpbmRPZixcbiAgY29udGFpbmVySGFzU3BsaXRcbn0gPSBtYWtlUGF0dGVybktpdCgpO1xuTU0gPSBNO1xudmFyIEF3YWl0QXJnR3VhcmRQYXlsb2FkU2hhcGUgPSBoYXJkZW4oe1xuICBhcmdHdWFyZDogTS5wYXR0ZXJuKClcbn0pO1xudmFyIEF3YWl0QXJnR3VhcmRTaGFwZSA9IE0ua2luZChcImd1YXJkOmF3YWl0QXJnR3VhcmRcIik7XG52YXIgaXNBd2FpdEFyZ0d1YXJkID0gKHNwZWNpbWVuKSA9PiBtYXRjaGVzKHNwZWNpbWVuLCBBd2FpdEFyZ0d1YXJkU2hhcGUpO1xuaGFyZGVuKGlzQXdhaXRBcmdHdWFyZCk7XG52YXIgYXNzZXJ0QXdhaXRBcmdHdWFyZCA9IChzcGVjaW1lbikgPT4ge1xuICBtdXN0TWF0Y2goc3BlY2ltZW4sIEF3YWl0QXJnR3VhcmRTaGFwZSwgXCJhd2FpdEFyZ0d1YXJkXCIpO1xufTtcbmhhcmRlbihhc3NlcnRBd2FpdEFyZ0d1YXJkKTtcbnZhciBtYWtlQXdhaXRBcmdHdWFyZCA9IChhcmdQYXR0ZXJuKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IG1ha2VUYWdnZWQoXCJndWFyZDphd2FpdEFyZ0d1YXJkXCIsIHtcbiAgICBhcmdHdWFyZDogYXJnUGF0dGVyblxuICB9KTtcbiAgYXNzZXJ0QXdhaXRBcmdHdWFyZChyZXN1bHQpO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBSYXdHdWFyZFBheWxvYWRTaGFwZSA9IE0ucmVjb3JkKCk7XG52YXIgUmF3R3VhcmRTaGFwZSA9IE0ua2luZChcImd1YXJkOnJhd0d1YXJkXCIpO1xudmFyIGlzUmF3R3VhcmQgPSAoc3BlY2ltZW4pID0+IG1hdGNoZXMoc3BlY2ltZW4sIFJhd0d1YXJkU2hhcGUpO1xudmFyIG1ha2VSYXdHdWFyZCA9ICgpID0+IG1ha2VUYWdnZWQoXCJndWFyZDpyYXdHdWFyZFwiLCB7fSk7XG52YXIgU3luY1ZhbHVlR3VhcmRTaGFwZSA9IE0ub3IoUmF3R3VhcmRTaGFwZSwgTS5wYXR0ZXJuKCkpO1xudmFyIFN5bmNWYWx1ZUd1YXJkTGlzdFNoYXBlID0gTS5hcnJheU9mKFN5bmNWYWx1ZUd1YXJkU2hhcGUpO1xudmFyIEFyZ0d1YXJkU2hhcGUgPSBNLm9yKFJhd0d1YXJkU2hhcGUsIEF3YWl0QXJnR3VhcmRTaGFwZSwgTS5wYXR0ZXJuKCkpO1xudmFyIEFyZ0d1YXJkTGlzdFNoYXBlID0gTS5hcnJheU9mKEFyZ0d1YXJkU2hhcGUpO1xudmFyIFN5bmNNZXRob2RHdWFyZFBheWxvYWRTaGFwZSA9IGhhcmRlbih7XG4gIGNhbGxLaW5kOiBcInN5bmNcIixcbiAgYXJnR3VhcmRzOiBTeW5jVmFsdWVHdWFyZExpc3RTaGFwZSxcbiAgb3B0aW9uYWxBcmdHdWFyZHM6IE0ub3B0KFN5bmNWYWx1ZUd1YXJkTGlzdFNoYXBlKSxcbiAgcmVzdEFyZ0d1YXJkOiBNLm9wdChTeW5jVmFsdWVHdWFyZFNoYXBlKSxcbiAgcmV0dXJuR3VhcmQ6IFN5bmNWYWx1ZUd1YXJkU2hhcGVcbn0pO1xudmFyIEFzeW5jTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUgPSBoYXJkZW4oe1xuICBjYWxsS2luZDogXCJhc3luY1wiLFxuICBhcmdHdWFyZHM6IEFyZ0d1YXJkTGlzdFNoYXBlLFxuICBvcHRpb25hbEFyZ0d1YXJkczogTS5vcHQoQXJnR3VhcmRMaXN0U2hhcGUpLFxuICByZXN0QXJnR3VhcmQ6IE0ub3B0KFN5bmNWYWx1ZUd1YXJkU2hhcGUpLFxuICByZXR1cm5HdWFyZDogU3luY1ZhbHVlR3VhcmRTaGFwZVxufSk7XG52YXIgTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUgPSBNLm9yKFxuICBTeW5jTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUsXG4gIEFzeW5jTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGVcbik7XG52YXIgTWV0aG9kR3VhcmRTaGFwZSA9IE0ua2luZChcImd1YXJkOm1ldGhvZEd1YXJkXCIpO1xudmFyIGFzc2VydE1ldGhvZEd1YXJkID0gKHNwZWNpbWVuKSA9PiB7XG4gIG11c3RNYXRjaChzcGVjaW1lbiwgTWV0aG9kR3VhcmRTaGFwZSwgXCJtZXRob2RHdWFyZFwiKTtcbn07XG5oYXJkZW4oYXNzZXJ0TWV0aG9kR3VhcmQpO1xudmFyIG1ha2VNZXRob2RHdWFyZE1ha2VyID0gKGNhbGxLaW5kLCBhcmdHdWFyZHMsIG9wdGlvbmFsQXJnR3VhcmRzID0gdm9pZCAwLCByZXN0QXJnR3VhcmQgPSB2b2lkIDApID0+IGhhcmRlbih7XG4gIG9wdGlvbmFsOiAoLi4ub3B0QXJnR3VhcmRzKSA9PiB7XG4gICAgb3B0aW9uYWxBcmdHdWFyZHMgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYENhbiBvbmx5IGhhdmUgb25lIHNldCBvZiBvcHRpb25hbCBndWFyZHNgO1xuICAgIHJlc3RBcmdHdWFyZCA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgb3B0aW9uYWwgYXJnIGd1YXJkcyBtdXN0IGNvbWUgYmVmb3JlIHJlc3QgYXJnYDtcbiAgICByZXR1cm4gbWFrZU1ldGhvZEd1YXJkTWFrZXIoY2FsbEtpbmQsIGFyZ0d1YXJkcywgb3B0QXJnR3VhcmRzKTtcbiAgfSxcbiAgcmVzdDogKHJBcmdHdWFyZCkgPT4ge1xuICAgIHJlc3RBcmdHdWFyZCA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgQ2FuIG9ubHkgaGF2ZSBvbmUgcmVzdCBhcmdgO1xuICAgIHJldHVybiBtYWtlTWV0aG9kR3VhcmRNYWtlcihcbiAgICAgIGNhbGxLaW5kLFxuICAgICAgYXJnR3VhcmRzLFxuICAgICAgb3B0aW9uYWxBcmdHdWFyZHMsXG4gICAgICByQXJnR3VhcmRcbiAgICApO1xuICB9LFxuICByZXR1cm5zOiAocmV0dXJuR3VhcmQgPSBNLnVuZGVmaW5lZCgpKSA9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gbWFrZVRhZ2dlZChcImd1YXJkOm1ldGhvZEd1YXJkXCIsIHtcbiAgICAgIGNhbGxLaW5kLFxuICAgICAgYXJnR3VhcmRzLFxuICAgICAgb3B0aW9uYWxBcmdHdWFyZHMsXG4gICAgICByZXN0QXJnR3VhcmQsXG4gICAgICByZXR1cm5HdWFyZFxuICAgIH0pO1xuICAgIGFzc2VydE1ldGhvZEd1YXJkKHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufSk7XG52YXIgSW50ZXJmYWNlR3VhcmRQYXlsb2FkU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAgaW50ZXJmYWNlTmFtZTogTS5zdHJpbmcoKSxcbiAgICBtZXRob2RHdWFyZHM6IE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgTWV0aG9kR3VhcmRTaGFwZSlcbiAgfSxcbiAge1xuICAgIGRlZmF1bHRHdWFyZHM6IE0ub3IoTS51bmRlZmluZWQoKSwgXCJwYXNzYWJsZVwiLCBcInJhd1wiKSxcbiAgICBzbG9wcHk6IE0uYm9vbGVhbigpLFxuICAgIHN5bWJvbE1ldGhvZEd1YXJkczogTS5tYXBPZihNLnN5bWJvbCgpLCBNZXRob2RHdWFyZFNoYXBlKVxuICB9XG4pO1xudmFyIEludGVyZmFjZUd1YXJkU2hhcGUgPSBNLmtpbmQoXCJndWFyZDppbnRlcmZhY2VHdWFyZFwiKTtcbnZhciBhc3NlcnRJbnRlcmZhY2VHdWFyZCA9IChzcGVjaW1lbikgPT4ge1xuICBtdXN0TWF0Y2goc3BlY2ltZW4sIEludGVyZmFjZUd1YXJkU2hhcGUsIFwiaW50ZXJmYWNlR3VhcmRcIik7XG59O1xuaGFyZGVuKGFzc2VydEludGVyZmFjZUd1YXJkKTtcbnZhciBtYWtlSW50ZXJmYWNlR3VhcmQgPSAoaW50ZXJmYWNlTmFtZSwgbWV0aG9kR3VhcmRzLCBvcHRpb25zID0ge30pID0+IHtcbiAgY29uc3QgeyBzbG9wcHkgPSBmYWxzZSwgZGVmYXVsdEd1YXJkcyA9IHNsb3BweSA/IFwicGFzc2FibGVcIiA6IHZvaWQgMCB9ID0gb3B0aW9ucztcbiAgY29uc3Qgc3RyaW5nTWV0aG9kR3VhcmRzID0ge307XG4gIGNvbnN0IHN5bWJvbE1ldGhvZEd1YXJkc0VudHJpZXMgPSBbXTtcbiAgZm9yIChjb25zdCBrZXkgb2Ygb3duS2V5czE4KG1ldGhvZEd1YXJkcykpIHtcbiAgICBjb25zdCB2YWx1ZSA9IG1ldGhvZEd1YXJkc1tcbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAga2V5XG4gICAgXTtcbiAgICBpZiAodHlwZW9mIGtleSA9PT0gXCJzeW1ib2xcIikge1xuICAgICAgc3ltYm9sTWV0aG9kR3VhcmRzRW50cmllcy5wdXNoKFtrZXksIHZhbHVlXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0cmluZ01ldGhvZEd1YXJkc1trZXldID0gdmFsdWU7XG4gICAgfVxuICB9XG4gIGNvbnN0IHJlc3VsdCA9IG1ha2VUYWdnZWQoXCJndWFyZDppbnRlcmZhY2VHdWFyZFwiLCB7XG4gICAgaW50ZXJmYWNlTmFtZSxcbiAgICBtZXRob2RHdWFyZHM6IHN0cmluZ01ldGhvZEd1YXJkcyxcbiAgICAuLi4oc3ltYm9sTWV0aG9kR3VhcmRzRW50cmllcy5sZW5ndGg/IHsgc3ltYm9sTWV0aG9kR3VhcmRzOiBtYWtlQ29weU1hcChzeW1ib2xNZXRob2RHdWFyZHNFbnRyaWVzKSB9IDoge30pLFxuICAgIGRlZmF1bHRHdWFyZHNcbiAgfSk7XG4gIGFzc2VydEludGVyZmFjZUd1YXJkKHJlc3VsdCk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICByZXN1bHRcbiAgKTtcbn07XG52YXIgR3VhcmRQYXlsb2FkU2hhcGVzID0gaGFyZGVuKHtcbiAgXCJndWFyZDphd2FpdEFyZ0d1YXJkXCI6IEF3YWl0QXJnR3VhcmRQYXlsb2FkU2hhcGUsXG4gIFwiZ3VhcmQ6cmF3R3VhcmRcIjogUmF3R3VhcmRQYXlsb2FkU2hhcGUsXG4gIFwiZ3VhcmQ6bWV0aG9kR3VhcmRcIjogTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUsXG4gIFwiZ3VhcmQ6aW50ZXJmYWNlR3VhcmRcIjogSW50ZXJmYWNlR3VhcmRQYXlsb2FkU2hhcGVcbn0pO1xuXG4vL1xudmFyIExlZ2FjeUF3YWl0QXJnR3VhcmRTaGFwZSA9IGhhcmRlbih7XG4gIGtsYXNzOiBcImF3YWl0QXJnXCIsXG4gIGFyZ0d1YXJkOiBNLnBhdHRlcm4oKVxufSk7XG52YXIgZ2V0QXdhaXRBcmdHdWFyZFBheWxvYWQgPSAoYXdhaXRBcmdHdWFyZCkgPT4ge1xuICBpZiAobWF0Y2hlcyhhd2FpdEFyZ0d1YXJkLCBMZWdhY3lBd2FpdEFyZ0d1YXJkU2hhcGUpKSB7XG4gICAgY29uc3QgeyBrbGFzczogXywgLi4ucGF5bG9hZCB9ID0gYXdhaXRBcmdHdWFyZDtcbiAgICByZXR1cm4gcGF5bG9hZDtcbiAgfVxuICBhc3NlcnRBd2FpdEFyZ0d1YXJkKGF3YWl0QXJnR3VhcmQpO1xuICByZXR1cm4gYXdhaXRBcmdHdWFyZC5wYXlsb2FkO1xufTtcbmhhcmRlbihnZXRBd2FpdEFyZ0d1YXJkUGF5bG9hZCk7XG52YXIgTGVnYWN5U3luY01ldGhvZEd1YXJkU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAga2xhc3M6IFwibWV0aG9kR3VhcmRcIixcbiAgICBjYWxsS2luZDogXCJzeW5jXCIsXG4gICAgYXJnR3VhcmRzOiBTeW5jVmFsdWVHdWFyZExpc3RTaGFwZSxcbiAgICByZXR1cm5HdWFyZDogU3luY1ZhbHVlR3VhcmRTaGFwZVxuICB9LFxuICB7XG4gICAgb3B0aW9uYWxBcmdHdWFyZHM6IFN5bmNWYWx1ZUd1YXJkTGlzdFNoYXBlLFxuICAgIHJlc3RBcmdHdWFyZDogU3luY1ZhbHVlR3VhcmRTaGFwZVxuICB9XG4pO1xudmFyIExlZ2FjeUFyZ0d1YXJkU2hhcGUgPSBNLm9yKFxuICBSYXdHdWFyZFNoYXBlLFxuICBBd2FpdEFyZ0d1YXJkU2hhcGUsXG4gIExlZ2FjeUF3YWl0QXJnR3VhcmRTaGFwZSxcbiAgTS5wYXR0ZXJuKClcbik7XG52YXIgTGVnYWN5QXJnR3VhcmRMaXN0U2hhcGUgPSBNLmFycmF5T2YoTGVnYWN5QXJnR3VhcmRTaGFwZSk7XG52YXIgTGVnYWN5QXN5bmNNZXRob2RHdWFyZFNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIGtsYXNzOiBcIm1ldGhvZEd1YXJkXCIsXG4gICAgY2FsbEtpbmQ6IFwiYXN5bmNcIixcbiAgICBhcmdHdWFyZHM6IExlZ2FjeUFyZ0d1YXJkTGlzdFNoYXBlLFxuICAgIHJldHVybkd1YXJkOiBTeW5jVmFsdWVHdWFyZFNoYXBlXG4gIH0sXG4gIHtcbiAgICBvcHRpb25hbEFyZ0d1YXJkczogQXJnR3VhcmRMaXN0U2hhcGUsXG4gICAgcmVzdEFyZ0d1YXJkOiBTeW5jVmFsdWVHdWFyZFNoYXBlXG4gIH1cbik7XG52YXIgTGVnYWN5TWV0aG9kR3VhcmRTaGFwZSA9IE0ub3IoXG4gIExlZ2FjeVN5bmNNZXRob2RHdWFyZFNoYXBlLFxuICBMZWdhY3lBc3luY01ldGhvZEd1YXJkU2hhcGVcbik7XG52YXIgYWRhcHRMZWdhY3lBcmdHdWFyZCA9IChhcmdHdWFyZCkgPT4gbWF0Y2hlcyhhcmdHdWFyZCwgTGVnYWN5QXdhaXRBcmdHdWFyZFNoYXBlKSA/IE0uYXdhaXQoZ2V0QXdhaXRBcmdHdWFyZFBheWxvYWQoYXJnR3VhcmQpLmFyZ0d1YXJkKSA6IGFyZ0d1YXJkO1xudmFyIGdldE1ldGhvZEd1YXJkUGF5bG9hZCA9IChtZXRob2RHdWFyZCkgPT4ge1xuICBpZiAobWF0Y2hlcyhtZXRob2RHdWFyZCwgTWV0aG9kR3VhcmRTaGFwZSkpIHtcbiAgICByZXR1cm4gbWV0aG9kR3VhcmQucGF5bG9hZDtcbiAgfVxuICBtdXN0TWF0Y2gobWV0aG9kR3VhcmQsIExlZ2FjeU1ldGhvZEd1YXJkU2hhcGUsIFwibGVnYWN5TWV0aG9kR3VhcmRcIik7XG4gIGNvbnN0IHtcbiAgICAvL1xuICAgIGtsYXNzOiBfLFxuICAgIC8vXG4gICAgY2FsbEtpbmQsXG4gICAgLy9cbiAgICByZXR1cm5HdWFyZCxcbiAgICAvL1xuICAgIHJlc3RBcmdHdWFyZFxuICB9ID0gbWV0aG9kR3VhcmQ7XG4gIGxldCB7XG4gICAgLy9cbiAgICBhcmdHdWFyZHMsXG4gICAgLy9cbiAgICBvcHRpb25hbEFyZ0d1YXJkc1xuICB9ID0gbWV0aG9kR3VhcmQ7XG4gIGlmIChjYWxsS2luZCA9PT0gXCJhc3luY1wiKSB7XG4gICAgYXJnR3VhcmRzID0gYXJnR3VhcmRzLm1hcChhZGFwdExlZ2FjeUFyZ0d1YXJkKTtcbiAgICBvcHRpb25hbEFyZ0d1YXJkcyA9IG9wdGlvbmFsQXJnR3VhcmRzICYmIG9wdGlvbmFsQXJnR3VhcmRzLm1hcChhZGFwdExlZ2FjeUFyZ0d1YXJkKTtcbiAgfVxuICBjb25zdCBwYXlsb2FkID0gaGFyZGVuKHtcbiAgICBjYWxsS2luZCxcbiAgICBhcmdHdWFyZHMsXG4gICAgb3B0aW9uYWxBcmdHdWFyZHMsXG4gICAgcmVzdEFyZ0d1YXJkLFxuICAgIHJldHVybkd1YXJkXG4gIH0pO1xuICBtdXN0TWF0Y2gocGF5bG9hZCwgTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUsIFwiaW50ZXJuYWxNZXRob2RHdWFyZEFkYXB0b3JcIik7XG4gIHJldHVybiBwYXlsb2FkO1xufTtcbmhhcmRlbihnZXRNZXRob2RHdWFyZFBheWxvYWQpO1xudmFyIExlZ2FjeUludGVyZmFjZUd1YXJkU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAga2xhc3M6IFwiSW50ZXJmYWNlXCIsXG4gICAgaW50ZXJmYWNlTmFtZTogTS5zdHJpbmcoKSxcbiAgICBtZXRob2RHdWFyZHM6IE0ucmVjb3JkT2YoXG4gICAgICBNLnN0cmluZygpLFxuICAgICAgTS5vcihNZXRob2RHdWFyZFNoYXBlLCBMZWdhY3lNZXRob2RHdWFyZFNoYXBlKVxuICAgIClcbiAgfSxcbiAge1xuICAgIGRlZmF1bHRHdWFyZHM6IE0ub3IoTS51bmRlZmluZWQoKSwgXCJwYXNzYWJsZVwiLCBcInJhd1wiKSxcbiAgICBzbG9wcHk6IE0uYm9vbGVhbigpLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIHN5bWJvbE1ldGhvZEd1YXJkczogTS5tYXBPZihNLnN5bWJvbCgpLCBNZXRob2RHdWFyZFNoYXBlKVxuICB9XG4pO1xudmFyIGFkYXB0TWV0aG9kR3VhcmQgPSAobWV0aG9kR3VhcmQpID0+IHtcbiAgaWYgKG1hdGNoZXMobWV0aG9kR3VhcmQsIExlZ2FjeU1ldGhvZEd1YXJkU2hhcGUpKSB7XG4gICAgY29uc3Qge1xuICAgICAgY2FsbEtpbmQsXG4gICAgICBhcmdHdWFyZHMsXG4gICAgICBvcHRpb25hbEFyZ0d1YXJkcyA9IFtdLFxuICAgICAgcmVzdEFyZ0d1YXJkID0gTS5hbnkoKSxcbiAgICAgIHJldHVybkd1YXJkXG4gICAgfSA9IGdldE1ldGhvZEd1YXJkUGF5bG9hZChtZXRob2RHdWFyZCk7XG4gICAgY29uc3QgbUNhbGwgPSBjYWxsS2luZCA9PT0gXCJzeW5jXCIgPyBNLmNhbGwgOiBNLmNhbGxXaGVuO1xuICAgIHJldHVybiBtQ2FsbCguLi5hcmdHdWFyZHMpLm9wdGlvbmFsKC4uLm9wdGlvbmFsQXJnR3VhcmRzKS5yZXN0KHJlc3RBcmdHdWFyZCkucmV0dXJucyhyZXR1cm5HdWFyZCk7XG4gIH1cbiAgcmV0dXJuIG1ldGhvZEd1YXJkO1xufTtcbnZhciBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQgPSAoaW50ZXJmYWNlR3VhcmQpID0+IHtcbiAgaWYgKG1hdGNoZXMoaW50ZXJmYWNlR3VhcmQsIEludGVyZmFjZUd1YXJkU2hhcGUpKSB7XG4gICAgcmV0dXJuIGludGVyZmFjZUd1YXJkLnBheWxvYWQ7XG4gIH1cbiAgbXVzdE1hdGNoKGludGVyZmFjZUd1YXJkLCBMZWdhY3lJbnRlcmZhY2VHdWFyZFNoYXBlLCBcImxlZ2FjeUludGVyZmFjZUd1YXJkXCIpO1xuICBsZXQgeyBrbGFzczogXywgaW50ZXJmYWNlTmFtZSwgbWV0aG9kR3VhcmRzLCAuLi5yZXN0IH0gPSBpbnRlcmZhY2VHdWFyZDtcbiAgbWV0aG9kR3VhcmRzID0gb2JqZWN0TWFwKG1ldGhvZEd1YXJkcywgYWRhcHRNZXRob2RHdWFyZCk7XG4gIGNvbnN0IHBheWxvYWQgPSBoYXJkZW4oe1xuICAgIGludGVyZmFjZU5hbWUsXG4gICAgbWV0aG9kR3VhcmRzLFxuICAgIC4uLnJlc3RcbiAgfSk7XG4gIG11c3RNYXRjaChcbiAgICBwYXlsb2FkLFxuICAgIEludGVyZmFjZUd1YXJkUGF5bG9hZFNoYXBlLFxuICAgIFwiaW50ZXJuYWxJbnRlcmZhY2VHdWFyZEFkYXB0b3JcIlxuICApO1xuICByZXR1cm4gcGF5bG9hZDtcbn07XG5oYXJkZW4oZ2V0SW50ZXJmYWNlR3VhcmRQYXlsb2FkKTtcbnZhciBlbXB0eUNvcHlNYXAgPSBtYWtlQ29weU1hcChbXSk7XG52YXIgZ2V0SW50ZXJmYWNlTWV0aG9kS2V5cyA9IChpbnRlcmZhY2VHdWFyZCkgPT4ge1xuICBjb25zdCB7IG1ldGhvZEd1YXJkcywgc3ltYm9sTWV0aG9kR3VhcmRzID0gZW1wdHlDb3B5TWFwIH0gPSBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQoaW50ZXJmYWNlR3VhcmQpO1xuICByZXR1cm4gaGFyZGVuKFtcbiAgICAuLi5SZWZsZWN0Lm93bktleXMobWV0aG9kR3VhcmRzKSxcbiAgICAuLi5nZXRDb3B5TWFwS2V5cyhzeW1ib2xNZXRob2RHdWFyZHMpXG4gIF0pO1xufTtcbmhhcmRlbihnZXRJbnRlcmZhY2VNZXRob2RLZXlzKTtcblxuLy9cbnZhciB7IGlzRnJvemVuOiBpc0Zyb3plbjYgfSA9IE9iamVjdDtcbnZhciBVcGdyYWRlRGlzY29ubmVjdGlvblNoYXBlID0gaGFyZGVuKHtcbiAgbmFtZTogXCJ2YXRVcGdyYWRlZFwiLFxuICB1cGdyYWRlTWVzc2FnZTogTS5zdHJpbmcoKSxcbiAgaW5jYXJuYXRpb25OdW1iZXI6IE0ubnVtYmVyKClcbn0pO1xudmFyIG1ha2VVcGdyYWRlRGlzY29ubmVjdGlvbiA9ICh1cGdyYWRlTWVzc2FnZSwgdG9JbmNhcm5hdGlvbk51bWJlcikgPT4gaGFyZGVuKHtcbiAgbmFtZTogXCJ2YXRVcGdyYWRlZFwiLFxuICB1cGdyYWRlTWVzc2FnZSxcbiAgaW5jYXJuYXRpb25OdW1iZXI6IHRvSW5jYXJuYXRpb25OdW1iZXJcbn0pO1xuaGFyZGVuKG1ha2VVcGdyYWRlRGlzY29ubmVjdGlvbik7XG52YXIgaXNVcGdyYWRlRGlzY29ubmVjdGlvbiA9IChyZWFzb24pID0+IHJlYXNvbiAhPSBudWxsICYmIC8vXG5pc0Zyb3plbjYocmVhc29uKSAmJiBtYXRjaGVzKHJlYXNvbiwgVXBncmFkZURpc2Nvbm5lY3Rpb25TaGFwZSk7XG5oYXJkZW4oaXNVcGdyYWRlRGlzY29ubmVjdGlvbik7XG52YXIgaXNBYmFuZG9uZWRFcnJvciA9IChyZWFzb24pID0+IHJlYXNvbiAhPSBudWxsICYmIC8vXG5pc0Zyb3plbjYocmVhc29uKSAmJiBtYXRjaGVzKHJlYXNvbiwgTS5lcnJvcigpKSAmJiAvL1xuLy9cbnJlYXNvbi5tZXNzYWdlID09PSBcInZhdCB0ZXJtaW5hdGVkXCI7XG5oYXJkZW4oaXNBYmFuZG9uZWRFcnJvcik7XG5cbi8vXG52YXIgR0VUX0lOVEVSRkFDRV9HVUFSRCA9IFwiX19nZXRJbnRlcmZhY2VHdWFyZF9fXCI7XG5cbi8vXG52YXIgeyBhcHBseTogYXBwbHk1LCBvd25LZXlzOiBvd25LZXlzMTkgfSA9IFJlZmxlY3Q7XG52YXIgeyBkZWZpbmVQcm9wZXJ0aWVzOiBkZWZpbmVQcm9wZXJ0aWVzMywgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzOCwgaGFzT3duOiBoYXNPd24xMCB9ID0gT2JqZWN0O1xudmFyIFJhd01ldGhvZEd1YXJkID0gTS5jYWxsKCkucmVzdChNLnJhdygpKS5yZXR1cm5zKE0ucmF3KCkpO1xudmFyIFJFREFDVEVEX1JBV19BUkcgPSBcIjxyZWRhY3RlZCByYXcgYXJnPlwiO1xudmFyIFBhc3NhYmxlTWV0aG9kR3VhcmQgPSBNLmNhbGwoKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSk7XG52YXIgZGVmZW5kU3luY0FyZ3MgPSAoc3luY0FyZ3MsIG1hdGNoQ29uZmlnLCBsYWJlbCA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCB7XG4gICAgZGVjbGFyZWRMZW4sXG4gICAgaGFzUmVzdEFyZ0d1YXJkLFxuICAgIHJlc3RBcmdHdWFyZElzUmF3LFxuICAgIHBhcmFtc1BhdHRlcm4sXG4gICAgcmVkYWN0ZWRJbmRpY2VzXG4gIH0gPSBtYXRjaENvbmZpZztcbiAgbGV0IG1hdGNoYWJsZUFyZ3MgPSBzeW5jQXJncztcbiAgaWYgKHJlc3RBcmdHdWFyZElzUmF3ICYmIHN5bmNBcmdzLmxlbmd0aCA+IGRlY2xhcmVkTGVuKSB7XG4gICAgY29uc3QgcmVzdExlbiA9IHN5bmNBcmdzLmxlbmd0aCAtIGRlY2xhcmVkTGVuO1xuICAgIGNvbnN0IHJlZGFjdGVkUmVzdCA9IEFycmF5KHJlc3RMZW4pLmZpbGwoUkVEQUNURURfUkFXX0FSRyk7XG4gICAgbWF0Y2hhYmxlQXJncyA9IFsuLi5zeW5jQXJncy5zbGljZSgwLCBkZWNsYXJlZExlbiksIC4uLnJlZGFjdGVkUmVzdF07XG4gIH0gZWxzZSBpZiAocmVkYWN0ZWRJbmRpY2VzLmxlbmd0aCA+IDAgJiYgcmVkYWN0ZWRJbmRpY2VzWzBdIDwgc3luY0FyZ3MubGVuZ3RoKSB7XG4gICAgbWF0Y2hhYmxlQXJncyA9IFsuLi5zeW5jQXJnc107XG4gIH1cbiAgZm9yIChjb25zdCBpMiBvZiByZWRhY3RlZEluZGljZXMpIHtcbiAgICBpZiAoaTIgPj0gbWF0Y2hhYmxlQXJncy5sZW5ndGgpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBtYXRjaGFibGVBcmdzW2kyXSA9IFJFREFDVEVEX1JBV19BUkc7XG4gIH1cbiAgbXVzdE1hdGNoKGhhcmRlbihtYXRjaGFibGVBcmdzKSwgcGFyYW1zUGF0dGVybiwgbGFiZWwpO1xuICBpZiAoaGFzUmVzdEFyZ0d1YXJkKSB7XG4gICAgcmV0dXJuIHN5bmNBcmdzO1xuICB9XG4gIHN5bmNBcmdzLmxlbmd0aCA8PSBkZWNsYXJlZExlbiB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUobGFiZWwpfSBhY2NlcHRzIGF0IG1vc3QgJHtxdW90ZShkZWNsYXJlZExlbil9IGFyZ3VtZW50cywgbm90ICR7cXVvdGUoXG4gICAgc3luY0FyZ3MubGVuZ3RoXG4gICl9OiAke3N5bmNBcmdzfWA7XG4gIHJldHVybiBzeW5jQXJncztcbn07XG52YXIgYnVpbGRNYXRjaENvbmZpZyA9IChtZXRob2RHdWFyZFBheWxvYWQpID0+IHtcbiAgY29uc3Qge1xuICAgIGFyZ0d1YXJkcyxcbiAgICBvcHRpb25hbEFyZ0d1YXJkcyA9IFtdLFxuICAgIHJlc3RBcmdHdWFyZFxuICB9ID0gbWV0aG9kR3VhcmRQYXlsb2FkO1xuICBjb25zdCBtYXRjaGFibGVBcmdHdWFyZHMgPSBbLi4uYXJnR3VhcmRzLCAuLi5vcHRpb25hbEFyZ0d1YXJkc107XG4gIGNvbnN0IHJlZGFjdGVkSW5kaWNlcyA9IFtdO1xuICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgbWF0Y2hhYmxlQXJnR3VhcmRzLmxlbmd0aDsgaTIgKz0gMSkge1xuICAgIGlmIChpc1Jhd0d1YXJkKG1hdGNoYWJsZUFyZ0d1YXJkc1tpMl0pKSB7XG4gICAgICBtYXRjaGFibGVBcmdHdWFyZHNbaTJdID0gUkVEQUNURURfUkFXX0FSRztcbiAgICAgIHJlZGFjdGVkSW5kaWNlcy5wdXNoKGkyKTtcbiAgICB9XG4gIH1cbiAgbGV0IG1hdGNoYWJsZVJlc3RBcmdHdWFyZCA9IHJlc3RBcmdHdWFyZDtcbiAgaWYgKGlzUmF3R3VhcmQobWF0Y2hhYmxlUmVzdEFyZ0d1YXJkKSkge1xuICAgIG1hdGNoYWJsZVJlc3RBcmdHdWFyZCA9IE0uYXJyYXlPZihSRURBQ1RFRF9SQVdfQVJHKTtcbiAgfVxuICBjb25zdCBtYXRjaGFibGVNZXRob2RHdWFyZFBheWxvYWQgPSBoYXJkZW4oe1xuICAgIC4uLm1ldGhvZEd1YXJkUGF5bG9hZCxcbiAgICBhcmdHdWFyZHM6IG1hdGNoYWJsZUFyZ0d1YXJkcy5zbGljZSgwLCBhcmdHdWFyZHMubGVuZ3RoKSxcbiAgICBvcHRpb25hbEFyZ0d1YXJkczogbWF0Y2hhYmxlQXJnR3VhcmRzLnNsaWNlKGFyZ0d1YXJkcy5sZW5ndGgpLFxuICAgIHJlc3RBcmdHdWFyZDogbWF0Y2hhYmxlUmVzdEFyZ0d1YXJkXG4gIH0pO1xuICBjb25zdCBwYXJhbXNQYXR0ZXJuID0gTS5zcGxpdEFycmF5KFxuICAgIG1hdGNoYWJsZU1ldGhvZEd1YXJkUGF5bG9hZC5hcmdHdWFyZHMsXG4gICAgbWF0Y2hhYmxlTWV0aG9kR3VhcmRQYXlsb2FkLm9wdGlvbmFsQXJnR3VhcmRzLFxuICAgIG1hdGNoYWJsZU1ldGhvZEd1YXJkUGF5bG9hZC5yZXN0QXJnR3VhcmRcbiAgKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgZGVjbGFyZWRMZW46IG1hdGNoYWJsZUFyZ0d1YXJkcy5sZW5ndGgsXG4gICAgaGFzUmVzdEFyZ0d1YXJkOiByZXN0QXJnR3VhcmQgIT09IHZvaWQgMCxcbiAgICByZXN0QXJnR3VhcmRJc1JhdzogcmVzdEFyZ0d1YXJkICE9PSBtYXRjaGFibGVSZXN0QXJnR3VhcmQsXG4gICAgcGFyYW1zUGF0dGVybixcbiAgICByZWRhY3RlZEluZGljZXMsXG4gICAgbWF0Y2hhYmxlTWV0aG9kR3VhcmRQYXlsb2FkXG4gIH0pO1xufTtcbnZhciBkZWZlbmRTeW5jTWV0aG9kID0gKGdldENvbnRleHQsIGJlaGF2aW9yTWV0aG9kLCBtZXRob2RHdWFyZFBheWxvYWQsIGxhYmVsKSA9PiB7XG4gIGNvbnN0IHsgcmV0dXJuR3VhcmQgfSA9IG1ldGhvZEd1YXJkUGF5bG9hZDtcbiAgY29uc3QgaXNSYXdSZXR1cm4gPSBpc1Jhd0d1YXJkKHJldHVybkd1YXJkKTtcbiAgY29uc3QgbWF0Y2hDb25maWcgPSBidWlsZE1hdGNoQ29uZmlnKG1ldGhvZEd1YXJkUGF5bG9hZCk7XG4gIGNvbnN0IHsgc3luY01ldGhvZCB9ID0ge1xuICAgIC8vXG4gICAgc3luY01ldGhvZCguLi5zeW5jQXJncykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IGdldENvbnRleHQodGhpcyk7XG4gICAgICAgIGNvbnN0IHJlYWxBcmdzID0gZGVmZW5kU3luY0FyZ3Moc3luY0FyZ3MsIG1hdGNoQ29uZmlnLCBsYWJlbCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGFwcGx5NShiZWhhdmlvck1ldGhvZCwgY29udGV4dCwgcmVhbEFyZ3MpO1xuICAgICAgICBpZiAoIWlzUmF3UmV0dXJuKSB7XG4gICAgICAgICAgbXVzdE1hdGNoKGhhcmRlbihyZXN1bHQpLCByZXR1cm5HdWFyZCwgYCR7bGFiZWx9OiByZXN1bHRgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfSBjYXRjaCAodGhyb3duVGhpbmcpIHtcbiAgICAgICAgdGhyb3cgdG9UaHJvd2FibGUodGhyb3duVGhpbmcpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgcmV0dXJuIHN5bmNNZXRob2Q7XG59O1xudmFyIGRlc3luYyA9IChtZXRob2RHdWFyZFBheWxvYWQpID0+IHtcbiAgY29uc3Qge1xuICAgIGFyZ0d1YXJkcyxcbiAgICBvcHRpb25hbEFyZ0d1YXJkcyA9IFtdLFxuICAgIHJlc3RBcmdHdWFyZFxuICB9ID0gbWV0aG9kR3VhcmRQYXlsb2FkO1xuICAhaXNBd2FpdEFyZ0d1YXJkKHJlc3RBcmdHdWFyZCkgfHwgdGhyb3dSZWRhY3RlZGBSZXN0IGFyZ3MgbWF5IG5vdCBiZSBhd2FpdGVkOiAke3Jlc3RBcmdHdWFyZH1gO1xuICBjb25zdCByYXdBcmdHdWFyZHMgPSBbLi4uYXJnR3VhcmRzLCAuLi5vcHRpb25hbEFyZ0d1YXJkc107XG4gIGNvbnN0IGF3YWl0SW5kZXhlcyA9IFtdO1xuICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgcmF3QXJnR3VhcmRzLmxlbmd0aDsgaTIgKz0gMSkge1xuICAgIGNvbnN0IGFyZ0d1YXJkID0gcmF3QXJnR3VhcmRzW2kyXTtcbiAgICBpZiAoaXNBd2FpdEFyZ0d1YXJkKGFyZ0d1YXJkKSkge1xuICAgICAgcmF3QXJnR3VhcmRzW2kyXSA9IGdldEF3YWl0QXJnR3VhcmRQYXlsb2FkKGFyZ0d1YXJkKS5hcmdHdWFyZDtcbiAgICAgIGF3YWl0SW5kZXhlcy5wdXNoKGkyKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBhd2FpdEluZGV4ZXMsXG4gICAgcmF3TWV0aG9kR3VhcmRQYXlsb2FkOiB7XG4gICAgICAuLi5tZXRob2RHdWFyZFBheWxvYWQsXG4gICAgICBhcmdHdWFyZHM6IHJhd0FyZ0d1YXJkcy5zbGljZSgwLCBhcmdHdWFyZHMubGVuZ3RoKSxcbiAgICAgIG9wdGlvbmFsQXJnR3VhcmRzOiByYXdBcmdHdWFyZHMuc2xpY2UoYXJnR3VhcmRzLmxlbmd0aClcbiAgICB9XG4gIH07XG59O1xudmFyIGRlZmVuZEFzeW5jTWV0aG9kID0gKGdldENvbnRleHQsIGJlaGF2aW9yTWV0aG9kLCBtZXRob2RHdWFyZFBheWxvYWQsIGxhYmVsKSA9PiB7XG4gIGNvbnN0IHsgcmV0dXJuR3VhcmQgfSA9IG1ldGhvZEd1YXJkUGF5bG9hZDtcbiAgY29uc3QgaXNSYXdSZXR1cm4gPSBpc1Jhd0d1YXJkKHJldHVybkd1YXJkKTtcbiAgY29uc3QgeyBhd2FpdEluZGV4ZXMsIHJhd01ldGhvZEd1YXJkUGF5bG9hZCB9ID0gZGVzeW5jKG1ldGhvZEd1YXJkUGF5bG9hZCk7XG4gIGNvbnN0IG1hdGNoQ29uZmlnID0gYnVpbGRNYXRjaENvbmZpZyhyYXdNZXRob2RHdWFyZFBheWxvYWQpO1xuICBjb25zdCB7IGFzeW5jTWV0aG9kIH0gPSB7XG4gICAgLy9cbiAgICBhc3luY01ldGhvZCguLi5hcmdzKSB7XG4gICAgICBjb25zdCBhd2FpdExpc3QgPSBbXTtcbiAgICAgIGZvciAoY29uc3QgaTIgb2YgYXdhaXRJbmRleGVzKSB7XG4gICAgICAgIGlmIChpMiA+PSBhcmdzLmxlbmd0aCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0TGlzdC5wdXNoKGFyZ3NbaTJdKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHAyID0gUHJvbWlzZS5hbGwoYXdhaXRMaXN0KTtcbiAgICAgIGNvbnN0IHN5bmNBcmdzID0gWy4uLmFyZ3NdO1xuICAgICAgY29uc3QgcmVzdWx0UCA9IEUud2hlbihcbiAgICAgICAgcDIsXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAoYXdhaXRlZEFyZ3MpID0+IHtcbiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGF3YWl0ZWRBcmdzLmxlbmd0aDsgaiArPSAxKSB7XG4gICAgICAgICAgICBzeW5jQXJnc1thd2FpdEluZGV4ZXNbal1dID0gYXdhaXRlZEFyZ3Nbal07XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGNvbnRleHQgPSBnZXRDb250ZXh0KHRoaXMpO1xuICAgICAgICAgIGNvbnN0IHJlYWxBcmdzID0gZGVmZW5kU3luY0FyZ3Moc3luY0FyZ3MsIG1hdGNoQ29uZmlnLCBsYWJlbCk7XG4gICAgICAgICAgcmV0dXJuIGFwcGx5NShiZWhhdmlvck1ldGhvZCwgY29udGV4dCwgcmVhbEFyZ3MpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgcmV0dXJuIEUud2hlbihyZXN1bHRQLCAoZnVsZmlsbG1lbnQpID0+IHtcbiAgICAgICAgaWYgKCFpc1Jhd1JldHVybikge1xuICAgICAgICAgIG11c3RNYXRjaChoYXJkZW4oZnVsZmlsbG1lbnQpLCByZXR1cm5HdWFyZCwgYCR7bGFiZWx9OiByZXN1bHRgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnVsZmlsbG1lbnQ7XG4gICAgICB9KS5jYXRjaChcbiAgICAgICAgKHJlYXNvbikgPT4gKFxuICAgICAgICAgIC8vXG4gICAgICAgICAgLy9cbiAgICAgICAgICBQcm9taXNlLnJlamVjdCh0b1Rocm93YWJsZShyZWFzb24pKVxuICAgICAgICApXG4gICAgICApO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIGFzeW5jTWV0aG9kO1xufTtcbnZhciBkZWZlbmRNZXRob2QgPSAoZ2V0Q29udGV4dCwgYmVoYXZpb3JNZXRob2QsIG1ldGhvZEd1YXJkLCBsYWJlbCkgPT4ge1xuICBjb25zdCBtZXRob2RHdWFyZFBheWxvYWQgPSBnZXRNZXRob2RHdWFyZFBheWxvYWQobWV0aG9kR3VhcmQpO1xuICBjb25zdCB7IGNhbGxLaW5kIH0gPSBtZXRob2RHdWFyZFBheWxvYWQ7XG4gIGlmIChjYWxsS2luZCA9PT0gXCJzeW5jXCIpIHtcbiAgICByZXR1cm4gZGVmZW5kU3luY01ldGhvZChcbiAgICAgIGdldENvbnRleHQsXG4gICAgICBiZWhhdmlvck1ldGhvZCxcbiAgICAgIG1ldGhvZEd1YXJkUGF5bG9hZCxcbiAgICAgIGxhYmVsXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICBhc3NlcnQoY2FsbEtpbmQgPT09IFwiYXN5bmNcIik7XG4gICAgcmV0dXJuIGRlZmVuZEFzeW5jTWV0aG9kKFxuICAgICAgZ2V0Q29udGV4dCxcbiAgICAgIGJlaGF2aW9yTWV0aG9kLFxuICAgICAgbWV0aG9kR3VhcmRQYXlsb2FkLFxuICAgICAgbGFiZWxcbiAgICApO1xuICB9XG59O1xudmFyIGJpbmRNZXRob2QgPSAobWV0aG9kVGFnLCBjb250ZXh0UHJvdmlkZXIsIGJlaGF2aW9yTWV0aG9kLCBtZXRob2RHdWFyZCkgPT4ge1xuICBhc3NlcnQudHlwZW9mKGJlaGF2aW9yTWV0aG9kLCBcImZ1bmN0aW9uXCIpO1xuICBjb25zdCBnZXRDb250ZXh0ID0gKHJlcHJlc2VudGF0aXZlKSA9PiB7XG4gICAgcmVwcmVzZW50YXRpdmUgfHwgLy9cbiAgICB0aHJvd1JlZGFjdGVkYE1ldGhvZCAke21ldGhvZFRhZ30gY2FsbGVkIHdpdGhvdXQgJ3RoaXMnIG9iamVjdGA7XG4gICAgY29uc3QgY29udGV4dCA9IGNvbnRleHRQcm92aWRlcihyZXByZXNlbnRhdGl2ZSk7XG4gICAgaWYgKGNvbnRleHQgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGAke3F1b3RlKFxuICAgICAgICBtZXRob2RUYWdcbiAgICAgICl9IG1heSBvbmx5IGJlIGFwcGxpZWQgdG8gYSB2YWxpZCBpbnN0YW5jZTogJHtyZXByZXNlbnRhdGl2ZX1gO1xuICAgIH1cbiAgICByZXR1cm4gY29udGV4dDtcbiAgfTtcbiAgY29uc3QgbWV0aG9kID0gZGVmZW5kTWV0aG9kKFxuICAgIGdldENvbnRleHQsXG4gICAgYmVoYXZpb3JNZXRob2QsXG4gICAgbWV0aG9kR3VhcmQsXG4gICAgbWV0aG9kVGFnXG4gICk7XG4gIGRlZmluZVByb3BlcnRpZXMzKG1ldGhvZCwge1xuICAgIG5hbWU6IHsgdmFsdWU6IG1ldGhvZFRhZyB9LFxuICAgIGxlbmd0aDogeyB2YWx1ZTogYmVoYXZpb3JNZXRob2QubGVuZ3RoIH1cbiAgfSk7XG4gIHJldHVybiBtZXRob2Q7XG59O1xudmFyIGRlZmVuZFByb3RvdHlwZSA9ICh0YWcsIGNvbnRleHRQcm92aWRlciwgYmVoYXZpb3JNZXRob2RzLCB0aGlzZnVsTWV0aG9kcyA9IGZhbHNlLCBpbnRlcmZhY2VHdWFyZCA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCBwcm90b3R5cGUgPSB7fTtcbiAgY29uc3QgbWV0aG9kTmFtZXMgPSBnZXRSZW1vdGFibGVNZXRob2ROYW1lcyhiZWhhdmlvck1ldGhvZHMpLmZpbHRlcihcbiAgICAvL1xuICAgIC8vXG4gICAgKGtleSkgPT4ge1xuICAgICAgaWYgKGtleSAhPT0gXCJjb25zdHJ1Y3RvclwiKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgY29uc3QgY29uc3RydWN0b3IgPSBiZWhhdmlvck1ldGhvZHMuY29uc3RydWN0b3I7XG4gICAgICByZXR1cm4gIShjb25zdHJ1Y3Rvci5wcm90b3R5cGUgJiYgY29uc3RydWN0b3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID09PSBjb25zdHJ1Y3Rvcik7XG4gICAgfVxuICApO1xuICBsZXQgbWV0aG9kR3VhcmRzO1xuICBsZXQgZGVmYXVsdEd1YXJkcztcbiAgaWYgKGludGVyZmFjZUd1YXJkKSB7XG4gICAgY29uc3Qge1xuICAgICAgaW50ZXJmYWNlTmFtZSxcbiAgICAgIG1ldGhvZEd1YXJkczogbWcsXG4gICAgICBzeW1ib2xNZXRob2RHdWFyZHMsXG4gICAgICBzbG9wcHksXG4gICAgICBkZWZhdWx0R3VhcmRzOiBkZyA9IHNsb3BweSA/IFwicGFzc2FibGVcIiA6IGRlZmF1bHRHdWFyZHNcbiAgICB9ID0gZ2V0SW50ZXJmYWNlR3VhcmRQYXlsb2FkKGludGVyZmFjZUd1YXJkKTtcbiAgICBtZXRob2RHdWFyZHMgPSBoYXJkZW4oe1xuICAgICAgLi4ubWcsXG4gICAgICAuLi4oc3ltYm9sTWV0aG9kR3VhcmRzJiYgZnJvbUVudHJpZXM4KGdldENvcHlNYXBFbnRyaWVzKHN5bWJvbE1ldGhvZEd1YXJkcykpKVxuICAgIH0pO1xuICAgIGRlZmF1bHRHdWFyZHMgPSBkZztcbiAgICB7XG4gICAgICBjb25zdCBtZXRob2RHdWFyZE5hbWVzID0gb3duS2V5czE5KG1ldGhvZEd1YXJkcyk7XG4gICAgICBjb25zdCB1bmltcGxlbWVudGVkID0gbGlzdERpZmZlcmVuY2UobWV0aG9kR3VhcmROYW1lcywgbWV0aG9kTmFtZXMpO1xuICAgICAgdW5pbXBsZW1lbnRlZC5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBtZXRob2RzICR7cXVvdGUodW5pbXBsZW1lbnRlZCl9IG5vdCBpbXBsZW1lbnRlZCBieSAke3F1b3RlKHRhZyl9YDtcbiAgICAgIGlmIChkZWZhdWx0R3VhcmRzID09PSB2b2lkIDApIHtcbiAgICAgICAgY29uc3QgdW5ndWFyZGVkID0gbGlzdERpZmZlcmVuY2UobWV0aG9kTmFtZXMsIG1ldGhvZEd1YXJkTmFtZXMpO1xuICAgICAgICB1bmd1YXJkZWQubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgbWV0aG9kcyAke3F1b3RlKHVuZ3VhcmRlZCl9IG5vdCBndWFyZGVkIGJ5ICR7cXVvdGUoaW50ZXJmYWNlTmFtZSl9YDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgZm9yIChjb25zdCBwcm9wIG9mIG1ldGhvZE5hbWVzKSB7XG4gICAgY29uc3Qgb3JpZ2luYWxNZXRob2QgPSBiZWhhdmlvck1ldGhvZHNbcHJvcF07XG4gICAgY29uc3QgeyBzaGlmdGVkTWV0aG9kIH0gPSB7XG4gICAgICBzaGlmdGVkTWV0aG9kKC4uLmFyZ3MpIHtcbiAgICAgICAgcmV0dXJuIG9yaWdpbmFsTWV0aG9kKHRoaXMsIC4uLmFyZ3MpO1xuICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgYmVoYXZpb3JNZXRob2QgPSB0aGlzZnVsTWV0aG9kcyA/IG9yaWdpbmFsTWV0aG9kIDogc2hpZnRlZE1ldGhvZDtcbiAgICBsZXQgbWV0aG9kR3VhcmQgPSBtZXRob2RHdWFyZHMgJiYgbWV0aG9kR3VhcmRzW3Byb3BdO1xuICAgIGlmICghbWV0aG9kR3VhcmQpIHtcbiAgICAgIHN3aXRjaCAoZGVmYXVsdEd1YXJkcykge1xuICAgICAgICBjYXNlIHZvaWQgMDoge1xuICAgICAgICAgIGlmICh0aGlzZnVsTWV0aG9kcykge1xuICAgICAgICAgICAgbWV0aG9kR3VhcmQgPSBQYXNzYWJsZU1ldGhvZEd1YXJkO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtZXRob2RHdWFyZCA9IFJhd01ldGhvZEd1YXJkO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwicGFzc2FibGVcIjoge1xuICAgICAgICAgIG1ldGhvZEd1YXJkID0gUGFzc2FibGVNZXRob2RHdWFyZDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwicmF3XCI6IHtcbiAgICAgICAgICBtZXRob2RHdWFyZCA9IFJhd01ldGhvZEd1YXJkO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFVucmVjb2duaXplZCBkZWZhdWx0R3VhcmRzICR7cXVvdGUoZGVmYXVsdEd1YXJkcyl9YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBwcm90b3R5cGVbcHJvcF0gPSBiaW5kTWV0aG9kKFxuICAgICAgYEluICR7cXVvdGUocHJvcCl9IG1ldGhvZCBvZiAoJHt0YWd9KWAsXG4gICAgICBjb250ZXh0UHJvdmlkZXIsXG4gICAgICBiZWhhdmlvck1ldGhvZCxcbiAgICAgIG1ldGhvZEd1YXJkXG4gICAgKTtcbiAgfVxuICBpZiAoIWhhc093bjEwKHByb3RvdHlwZSwgR0VUX0lOVEVSRkFDRV9HVUFSRCkpIHtcbiAgICBjb25zdCBnZXRJbnRlcmZhY2VHdWFyZE1ldGhvZCA9IHtcbiAgICAgIFtHRVRfSU5URVJGQUNFX0dVQVJEXSgpIHtcbiAgICAgICAgcmV0dXJuIGludGVyZmFjZUd1YXJkO1xuICAgICAgfVxuICAgIH1bR0VUX0lOVEVSRkFDRV9HVUFSRF07XG4gICAgcHJvdG90eXBlW0dFVF9JTlRFUkZBQ0VfR1VBUkRdID0gYmluZE1ldGhvZChcbiAgICAgIGBJbiAke3F1b3RlKEdFVF9JTlRFUkZBQ0VfR1VBUkQpfSBtZXRob2Qgb2YgKCR7dGFnfSlgLFxuICAgICAgY29udGV4dFByb3ZpZGVyLFxuICAgICAgZ2V0SW50ZXJmYWNlR3VhcmRNZXRob2QsXG4gICAgICBQYXNzYWJsZU1ldGhvZEd1YXJkXG4gICAgKTtcbiAgfVxuICByZXR1cm4gRmFyKFxuICAgIHRhZyxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBwcm90b3R5cGVcbiAgKTtcbn07XG5oYXJkZW4oZGVmZW5kUHJvdG90eXBlKTtcbnZhciBkZWZlbmRQcm90b3R5cGVLaXQgPSAodGFnLCBjb250ZXh0UHJvdmlkZXJLaXQsIGJlaGF2aW9yTWV0aG9kc0tpdCwgdGhpc2Z1bE1ldGhvZHMgPSBmYWxzZSwgaW50ZXJmYWNlR3VhcmRLaXQgPSB2b2lkIDApID0+IHtcbiAgY29uc3QgZmFjZXROYW1lcyA9IG93bktleXMxOShiZWhhdmlvck1ldGhvZHNLaXQpLnNvcnQoKTtcbiAgZmFjZXROYW1lcy5sZW5ndGggPiAxIHx8IHRocm93UmVkYWN0ZWRgQSBtdWx0aS1mYWNldCBvYmplY3QgbXVzdCBoYXZlIG11bHRpcGxlIGZhY2V0c2A7XG4gIGlmIChpbnRlcmZhY2VHdWFyZEtpdCkge1xuICAgIGNvbnN0IGludGVyZmFjZU5hbWVzID0gb3duS2V5czE5KGludGVyZmFjZUd1YXJkS2l0KTtcbiAgICBjb25zdCBleHRyYUludGVyZmFjZU5hbWVzID0gbGlzdERpZmZlcmVuY2UoZmFjZXROYW1lcywgaW50ZXJmYWNlTmFtZXMpO1xuICAgIGV4dHJhSW50ZXJmYWNlTmFtZXMubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJmYWNlcyAke3F1b3RlKGV4dHJhSW50ZXJmYWNlTmFtZXMpfSBub3QgaW1wbGVtZW50ZWQgYnkgJHtxdW90ZSh0YWcpfWA7XG4gICAgY29uc3QgZXh0cmFGYWNldE5hbWVzMiA9IGxpc3REaWZmZXJlbmNlKGludGVyZmFjZU5hbWVzLCBmYWNldE5hbWVzKTtcbiAgICBleHRyYUZhY2V0TmFtZXMyLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYEZhY2V0cyAke3F1b3RlKGV4dHJhRmFjZXROYW1lczIpfSBvZiAke3F1b3RlKHRhZyl9IG5vdCBndWFyZGVkIGJ5IGludGVyZmFjZXNgO1xuICB9XG4gIGNvbnN0IGNvbnRleHRNYXBOYW1lcyA9IG93bktleXMxOShjb250ZXh0UHJvdmlkZXJLaXQpO1xuICBjb25zdCBleHRyYUNvbnRleHROYW1lcyA9IGxpc3REaWZmZXJlbmNlKGZhY2V0TmFtZXMsIGNvbnRleHRNYXBOYW1lcyk7XG4gIGV4dHJhQ29udGV4dE5hbWVzLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYENvbnRleHRzICR7cXVvdGUoZXh0cmFDb250ZXh0TmFtZXMpfSBub3QgaW1wbGVtZW50ZWQgYnkgJHtxdW90ZSh0YWcpfWA7XG4gIGNvbnN0IGV4dHJhRmFjZXROYW1lcyA9IGxpc3REaWZmZXJlbmNlKGNvbnRleHRNYXBOYW1lcywgZmFjZXROYW1lcyk7XG4gIGV4dHJhRmFjZXROYW1lcy5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBGYWNldHMgJHtxdW90ZShleHRyYUZhY2V0TmFtZXMpfSBvZiAke3F1b3RlKHRhZyl9IG1pc3NpbmcgY29udGV4dHNgO1xuICBjb25zdCBwcm90b0tpdCA9IG9iamVjdE1hcChcbiAgICBiZWhhdmlvck1ldGhvZHNLaXQsXG4gICAgKGJlaGF2aW9yTWV0aG9kcywgZmFjZXROYW1lKSA9PiBkZWZlbmRQcm90b3R5cGUoXG4gICAgICBgJHt0YWd9ICR7U3RyaW5nKGZhY2V0TmFtZSl9YCxcbiAgICAgIGNvbnRleHRQcm92aWRlcktpdFtmYWNldE5hbWVdLFxuICAgICAgYmVoYXZpb3JNZXRob2RzLFxuICAgICAgdGhpc2Z1bE1ldGhvZHMsXG4gICAgICBpbnRlcmZhY2VHdWFyZEtpdCAmJiBpbnRlcmZhY2VHdWFyZEtpdFtmYWNldE5hbWVdXG4gICAgKVxuICApO1xuICByZXR1cm4gcHJvdG9LaXQ7XG59O1xuXG4vL1xudmFyIHsgY3JlYXRlOiBjcmVhdGUzLCBzZWFsLCBmcmVlemU6IGZyZWV6ZTcsIGRlZmluZVByb3BlcnR5LCB2YWx1ZXM6IHZhbHVlczMgfSA9IE9iamVjdDtcbnZhciBMQUJFTF9JTlNUQU5DRVMgPSBlbnZpcm9ubWVudE9wdGlvbnNMaXN0SGFzKFwiREVCVUdcIiwgXCJsYWJlbC1pbnN0YW5jZXNcIik7XG52YXIgbWFrZVNlbGYgPSAocHJvdG8sIGluc3RhbmNlQ291bnQpID0+IHtcbiAgY29uc3Qgc2VsZiA9IGNyZWF0ZTMocHJvdG8pO1xuICBpZiAoTEFCRUxfSU5TVEFOQ0VTKSB7XG4gICAgZGVmaW5lUHJvcGVydHkoc2VsZiwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7XG4gICAgICB2YWx1ZTogYCR7cHJvdG9bU3ltYm9sLnRvU3RyaW5nVGFnXX0jJHtpbnN0YW5jZUNvdW50fWAsXG4gICAgICB3cml0YWJsZTogZmFsc2UsXG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2VcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gaGFyZGVuKHNlbGYpO1xufTtcbnZhciBlbXB0eVJlY29yZCA9IGhhcmRlbih7fSk7XG52YXIgaW5pdEVtcHR5ID0gKCkgPT4gZW1wdHlSZWNvcmQ7XG52YXIgZGVmaW5lRXhvQ2xhc3MgPSAodGFnLCBpbnRlcmZhY2VHdWFyZCwgaW5pdCwgbWV0aG9kcywgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGhhcmRlbihtZXRob2RzKTtcbiAgY29uc3Qge1xuICAgIGZpbmlzaCA9IHZvaWQgMCxcbiAgICByZWNlaXZlQW1wbGlmaWVyID0gdm9pZCAwLFxuICAgIHJlY2VpdmVJbnN0YW5jZVRlc3RlciA9IHZvaWQgMFxuICB9ID0gb3B0aW9ucztcbiAgcmVjZWl2ZUFtcGxpZmllciA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgT25seSBmYWNldHMgb2YgYW4gZXhvIGNsYXNzIGtpdCBjYW4gYmUgYW1wbGlmaWVkICR7cXVvdGUodGFnKX1gO1xuICBjb25zdCBjb250ZXh0TWFwID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IHByb3RvID0gZGVmZW5kUHJvdG90eXBlKFxuICAgIHRhZyxcbiAgICAoc2VsZikgPT4gKFxuICAgICAgLyogICAgICAgICAgICAgICovXG4gICAgICBjb250ZXh0TWFwLmdldChzZWxmKVxuICAgICksXG4gICAgbWV0aG9kcyxcbiAgICB0cnVlLFxuICAgIGludGVyZmFjZUd1YXJkXG4gICk7XG4gIGxldCBpbnN0YW5jZUNvdW50ID0gMDtcbiAgY29uc3QgbWFrZUluc3RhbmNlID0gKC4uLmFyZ3MpID0+IHtcbiAgICBjb25zdCBzdGF0ZSA9IHNlYWwoaW5pdCguLi5hcmdzKSk7XG4gICAgaW5zdGFuY2VDb3VudCArPSAxO1xuICAgIGNvbnN0IHNlbGYgPSBtYWtlU2VsZihwcm90bywgaW5zdGFuY2VDb3VudCk7XG4gICAgY29uc3QgY29udGV4dCA9IGZyZWV6ZTcoeyBzdGF0ZSwgc2VsZiB9KTtcbiAgICBjb250ZXh0TWFwLnNldChzZWxmLCBjb250ZXh0KTtcbiAgICBpZiAoZmluaXNoKSB7XG4gICAgICBmaW5pc2goY29udGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBzZWxmO1xuICB9O1xuICBpZiAocmVjZWl2ZUluc3RhbmNlVGVzdGVyKSB7XG4gICAgY29uc3QgaXNJbnN0YW5jZSA9IChleG8sIGZhY2V0TmFtZSA9IHZvaWQgMCkgPT4ge1xuICAgICAgZmFjZXROYW1lID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBmYWNldE5hbWUgY2FuIG9ubHkgYmUgdXNlZCB3aXRoIGFuIGV4byBjbGFzcyBraXQ6ICR7cXVvdGUoXG4gICAgICAgIHRhZ1xuICAgICAgKX0gaGFzIG5vIGZhY2V0ICR7cXVvdGUoZmFjZXROYW1lKX1gO1xuICAgICAgcmV0dXJuIGNvbnRleHRNYXAuaGFzKGV4byk7XG4gICAgfTtcbiAgICBoYXJkZW4oaXNJbnN0YW5jZSk7XG4gICAgcmVjZWl2ZUluc3RhbmNlVGVzdGVyKGlzSW5zdGFuY2UpO1xuICB9XG4gIHJldHVybiBoYXJkZW4obWFrZUluc3RhbmNlKTtcbn07XG5oYXJkZW4oZGVmaW5lRXhvQ2xhc3MpO1xudmFyIGRlZmluZUV4b0NsYXNzS2l0ID0gKHRhZywgaW50ZXJmYWNlR3VhcmRLaXQsIGluaXQsIG1ldGhvZHNLaXQsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICBoYXJkZW4obWV0aG9kc0tpdCk7XG4gIGNvbnN0IHtcbiAgICBmaW5pc2ggPSB2b2lkIDAsXG4gICAgcmVjZWl2ZUFtcGxpZmllciA9IHZvaWQgMCxcbiAgICByZWNlaXZlSW5zdGFuY2VUZXN0ZXIgPSB2b2lkIDBcbiAgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IGNvbnRleHRNYXBLaXQgPSBvYmplY3RNYXAobWV0aG9kc0tpdCwgKCkgPT4gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCkpO1xuICBjb25zdCBnZXRDb250ZXh0S2l0ID0gb2JqZWN0TWFwKFxuICAgIGNvbnRleHRNYXBLaXQsXG4gICAgKGNvbnRleHRNYXApID0+IChmYWNldCkgPT4gY29udGV4dE1hcC5nZXQoZmFjZXQpXG4gICk7XG4gIGNvbnN0IHByb3RvdHlwZUtpdCA9IGRlZmVuZFByb3RvdHlwZUtpdChcbiAgICB0YWcsXG4gICAgZ2V0Q29udGV4dEtpdCxcbiAgICBtZXRob2RzS2l0LFxuICAgIHRydWUsXG4gICAgaW50ZXJmYWNlR3VhcmRLaXRcbiAgKTtcbiAgbGV0IGluc3RhbmNlQ291bnQgPSAwO1xuICBjb25zdCBtYWtlSW5zdGFuY2VLaXQgPSAoLi4uYXJncykgPT4ge1xuICAgIGNvbnN0IHN0YXRlID0gc2VhbChpbml0KC4uLmFyZ3MpKTtcbiAgICBjb25zdCBjb250ZXh0ID0geyBzdGF0ZSwgZmFjZXRzOiBudWxsIH07XG4gICAgaW5zdGFuY2VDb3VudCArPSAxO1xuICAgIGNvbnN0IGZhY2V0cyA9IG9iamVjdE1hcChwcm90b3R5cGVLaXQsIChwcm90bywgZmFjZXROYW1lKSA9PiB7XG4gICAgICBjb25zdCBzZWxmID0gbWFrZVNlbGYocHJvdG8sIGluc3RhbmNlQ291bnQpO1xuICAgICAgY29udGV4dE1hcEtpdFtmYWNldE5hbWVdLnNldChzZWxmLCBjb250ZXh0KTtcbiAgICAgIHJldHVybiBzZWxmO1xuICAgIH0pO1xuICAgIGNvbnRleHQuZmFjZXRzID0gZmFjZXRzO1xuICAgIGZyZWV6ZTcoY29udGV4dCk7XG4gICAgaWYgKGZpbmlzaCkge1xuICAgICAgZmluaXNoKGNvbnRleHQpO1xuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgY29udGV4dC5mYWNldHNcbiAgICApO1xuICB9O1xuICBpZiAocmVjZWl2ZUFtcGxpZmllcikge1xuICAgIGNvbnN0IGFtcGxpZnkgPSAoZXhvRmFjZXQpID0+IHtcbiAgICAgIGZvciAoY29uc3QgY29udGV4dE1hcCBvZiB2YWx1ZXMzKGNvbnRleHRNYXBLaXQpKSB7XG4gICAgICAgIGlmIChjb250ZXh0TWFwLmhhcyhleG9GYWNldCkpIHtcbiAgICAgICAgICBjb25zdCB7IGZhY2V0cyB9ID0gY29udGV4dE1hcC5nZXQoZXhvRmFjZXQpO1xuICAgICAgICAgIHJldHVybiBmYWNldHM7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgTXVzdCBiZSBhIGZhY2V0IG9mICR7cXVvdGUodGFnKX06ICR7ZXhvRmFjZXR9YDtcbiAgICB9O1xuICAgIGhhcmRlbihhbXBsaWZ5KTtcbiAgICByZWNlaXZlQW1wbGlmaWVyKGFtcGxpZnkpO1xuICB9XG4gIGlmIChyZWNlaXZlSW5zdGFuY2VUZXN0ZXIpIHtcbiAgICBjb25zdCBpc0luc3RhbmNlID0gKGV4b0ZhY2V0LCBmYWNldE5hbWUgPSB2b2lkIDApID0+IHtcbiAgICAgIGlmIChmYWNldE5hbWUgPT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4gdmFsdWVzMyhjb250ZXh0TWFwS2l0KS5zb21lKFxuICAgICAgICAgIChjb250ZXh0TWFwMikgPT4gY29udGV4dE1hcDIuaGFzKGV4b0ZhY2V0KVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgYXNzZXJ0LnR5cGVvZihmYWNldE5hbWUsIFwic3RyaW5nXCIpO1xuICAgICAgY29uc3QgY29udGV4dE1hcCA9IGNvbnRleHRNYXBLaXRbZmFjZXROYW1lXTtcbiAgICAgIGNvbnRleHRNYXAgIT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYGV4byBjbGFzcyBraXQgJHtxdW90ZSh0YWcpfSBoYXMgbm8gZmFjZXQgbmFtZWQgJHtxdW90ZShmYWNldE5hbWUpfWA7XG4gICAgICByZXR1cm4gY29udGV4dE1hcC5oYXMoZXhvRmFjZXQpO1xuICAgIH07XG4gICAgaGFyZGVuKGlzSW5zdGFuY2UpO1xuICAgIHJlY2VpdmVJbnN0YW5jZVRlc3Rlcihpc0luc3RhbmNlKTtcbiAgfVxuICByZXR1cm4gaGFyZGVuKG1ha2VJbnN0YW5jZUtpdCk7XG59O1xuaGFyZGVuKGRlZmluZUV4b0NsYXNzS2l0KTtcbnZhciBtYWtlRXhvID0gKHRhZywgaW50ZXJmYWNlR3VhcmQsIG1ldGhvZHMsIG9wdGlvbnMgPSB2b2lkIDApID0+IHtcbiAgY29uc3QgbWFrZUluc3RhbmNlID0gZGVmaW5lRXhvQ2xhc3MoXG4gICAgdGFnLFxuICAgIGludGVyZmFjZUd1YXJkLFxuICAgIGluaXRFbXB0eSxcbiAgICBtZXRob2RzLFxuICAgIG9wdGlvbnNcbiAgKTtcbiAgcmV0dXJuIG1ha2VJbnN0YW5jZSgpO1xufTtcbmhhcmRlbihtYWtlRXhvKTtcblxuLy9cbnZhciBtYWtlV2Vha1NldFN0b3JlTWV0aG9kcyA9IChqc3NldCwgYXNzZXJ0S2V5T2tUb0FkZCwgYXNzZXJ0S2V5T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgYXNzZXJ0S2V5RXhpc3RzID0gKGtleSkgPT4ganNzZXQuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKGtleU5hbWUpfSBub3QgZm91bmQ6ICR7a2V5fWA7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGhhczogKGtleSkgPT4ge1xuICAgICAgcmV0dXJuIGpzc2V0LmhhcyhrZXkpO1xuICAgIH0sXG4gICAgYWRkOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlPa1RvQWRkKGtleSk7XG4gICAgICBqc3NldC5hZGQoa2V5KTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBpZiAoYXNzZXJ0S2V5T2tUb0RlbGV0ZSAhPT0gdm9pZCAwKSB7XG4gICAgICAgIGFzc2VydEtleU9rVG9EZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICAgIGpzc2V0LmRlbGV0ZShrZXkpO1xuICAgIH0sXG4gICAgYWRkQWxsOiAoa2V5czUpID0+IHtcbiAgICAgIGlmICh0eXBlb2Yga2V5czVbU3ltYm9sLml0ZXJhdG9yXSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGlmIChPYmplY3QuaXNGcm96ZW4oa2V5czUpICYmIGlzQ29weVNldChrZXlzNSkpIHtcbiAgICAgICAgICBrZXlzNSA9IGdldENvcHlTZXRLZXlzKGtleXM1KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvd1JlZGFjdGVkYHByb3ZpZGVkIGRhdGEgc291cmNlIGlzIG5vdCBpdGVyYWJsZTogJHtrZXlzNX1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKFxuICAgICAgICBjb25zdCBrZXkgb2ZcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAga2V5czVcbiAgICAgICkge1xuICAgICAgICBhc3NlcnRLZXlPa1RvQWRkKGtleSk7XG4gICAgICAgIGpzc2V0LmFkZChrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xudmFyIG1ha2VTY2FsYXJXZWFrU2V0U3RvcmUgPSAodGFnID0gXCJrZXlcIiwgeyBsb25nTGl2ZWQgPSB0cnVlLCBrZXlTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNzZXQgPSBuZXcgKGxvbmdMaXZlZCA/IFdlYWtTZXQgOiBTZXQpKCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S2V5T2tUb0FkZCA9IChrZXkpID0+IHtcbiAgICBoYXJkZW4oa2V5KTtcbiAgICBwYXNzU3R5bGVPZihrZXkpID09PSBcInJlbW90YWJsZVwiIHx8IHRocm93UmVkYWN0ZWRgT25seSByZW1vdGFibGVzIGNhbiBiZSBrZXlzIG9mIHNjYWxhciBXZWFrU3RvcmVzOiAke2tleX1gO1xuICAgIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2goa2V5LCBrZXlTaGFwZSwgXCJ3ZWFrU2V0U3RvcmUga2V5XCIpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIEZhcihgc2NhbGFyIFdlYWtTZXRTdG9yZSBvZiAke3F1b3RlKHRhZyl9YCwge1xuICAgIC4uLm1ha2VXZWFrU2V0U3RvcmVNZXRob2RzKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCB2b2lkIDAsIHRhZylcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJXZWFrU2V0U3RvcmUpO1xuXG4vL1xudmFyIG1ha2VDdXJyZW50S2V5c0tpdCA9IChnZXRSYXdLZXlzLCBjaGVja0hhcywgY29tcGFyZSwgYXNzZXJ0T2tUb0FkZCwgYXNzZXJ0T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgbGV0IHVwZGF0ZUNvdW50ID0gMDtcbiAgbGV0IHNvcnRlZEtleXNNZW1vO1xuICBjb25zdCBhc3NlcnRVcGRhdGVPbkFkZCA9IChrLCB2MiA9IHZvaWQgMCkgPT4ge1xuICAgIGFzc2VydE9rVG9BZGQoaywgdjIpO1xuICAgIHVwZGF0ZUNvdW50ICs9IDE7XG4gICAgc29ydGVkS2V5c01lbW8gPSB2b2lkIDA7XG4gIH07XG4gIGNvbnN0IGFzc2VydFVwZGF0ZU9uRGVsZXRlID0gKGspID0+IGFzc2VydE9rVG9EZWxldGUgJiYgYXNzZXJ0T2tUb0RlbGV0ZShrKTtcbiAgY29uc3QgZ2V0U29ydGVkS2V5cyA9ICgpID0+IHtcbiAgICBpZiAoc29ydGVkS2V5c01lbW8gPT09IHZvaWQgMCkge1xuICAgICAgc29ydGVkS2V5c01lbW8gPSBoYXJkZW4oWy4uLmdldFJhd0tleXMoKV0uc29ydChjb21wYXJlKSk7XG4gICAgfVxuICAgIHJldHVybiBzb3J0ZWRLZXlzTWVtbztcbiAgfTtcbiAgY29uc3QgaXRlcmFibGVLZXlzID0gRmFyKFwiSXRlcmFibGUgb2Yga2V5c1wiLCB7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGNvbnN0IGdlbmVyYXRpb24gPSB1cGRhdGVDb3VudDtcbiAgICAgIGdldFNvcnRlZEtleXMoKTtcbiAgICAgIGNvbnN0IGxlbiA9IHNvcnRlZEtleXNNZW1vLmxlbmd0aDtcbiAgICAgIGxldCBpMiA9IDA7XG4gICAgICByZXR1cm4gRmFyKFwiSXRlcmF0b3Igb2Yga2V5c1wiLCB7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBnZW5lcmF0aW9uID09PSB1cGRhdGVDb3VudCB8fCB0aHJvd1JlZGFjdGVkYFN0b3JlICR7cXVvdGUoa2V5TmFtZSl9IGN1cnNvciBzdGFsZWA7XG4gICAgICAgICAgZm9yICg7IDsgKSB7XG4gICAgICAgICAgICBpZiAoaTIgPCBsZW4pIHtcbiAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBzb3J0ZWRLZXlzTWVtb1tpMl07XG4gICAgICAgICAgICAgIGkyICs9IDE7XG4gICAgICAgICAgICAgIGlmIChjaGVja0hhcyh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHZvaWQgMCB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGFzc2VydFVwZGF0ZU9uQWRkLFxuICAgIGFzc2VydFVwZGF0ZU9uRGVsZXRlLFxuICAgIGl0ZXJhYmxlS2V5c1xuICB9KTtcbn07XG5oYXJkZW4obWFrZUN1cnJlbnRLZXlzS2l0KTtcbnZhciBwcm92aWRlTGF6eSA9IChtYXBTdG9yZSwga2V5LCBtYWtlVmFsdWUpID0+IHtcbiAgaWYgKCFtYXBTdG9yZS5oYXMoa2V5KSkge1xuICAgIG1hcFN0b3JlLmluaXQoa2V5LCBtYWtlVmFsdWUoa2V5KSk7XG4gIH1cbiAgcmV0dXJuIG1hcFN0b3JlLmdldChrZXkpO1xufTtcbmhhcmRlbihwcm92aWRlTGF6eSk7XG52YXIgbWFrZUF0b21pY1Byb3ZpZGVyID0gKHN0b3JlKSA9PiB7XG4gIGNvbnN0IHBlbmRpbmcgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICBjb25zdCBwcm92aWRlQXN5bmMgPSAoa2V5LCBtYWtlVmFsdWUsIGZpbmlzaFZhbHVlKSA9PiB7XG4gICAgaWYgKHN0b3JlLmhhcyhrZXkpKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHN0b3JlLmdldChrZXkpKTtcbiAgICB9XG4gICAgaWYgKCFwZW5kaW5nLmhhcyhrZXkpKSB7XG4gICAgICBjb25zdCB2YWxQMiA9IG1ha2VWYWx1ZShrZXkpLnRoZW4oKHYyKSA9PiB7XG4gICAgICAgIHN0b3JlLmluaXQoa2V5LCB2Mik7XG4gICAgICAgIHJldHVybiB2MjtcbiAgICAgIH0pLnRoZW4oKHYyKSA9PiB7XG4gICAgICAgIGlmIChmaW5pc2hWYWx1ZSkge1xuICAgICAgICAgIHJldHVybiBmaW5pc2hWYWx1ZShrZXksIHYyKS50aGVuKCgpID0+IHYyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdjI7XG4gICAgICB9KS5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgcGVuZGluZy5kZWxldGUoa2V5KTtcbiAgICAgIH0pO1xuICAgICAgcGVuZGluZy5zZXQoa2V5LCB2YWxQMik7XG4gICAgfVxuICAgIGNvbnN0IHZhbFAgPSBwZW5kaW5nLmdldChrZXkpO1xuICAgIGFzc2VydCh2YWxQKTtcbiAgICByZXR1cm4gdmFsUDtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IHByb3ZpZGVBc3luYyB9KTtcbn07XG5oYXJkZW4obWFrZUF0b21pY1Byb3ZpZGVyKTtcbnZhciBhcHBlbmRUb1N0b3JlZEFycmF5ID0gKG1hcFN0b3JlLCBrZXksIGl0ZW0pID0+IHtcbiAgaWYgKG1hcFN0b3JlLmhhcyhrZXkpKSB7XG4gICAgY29uc3QgZXh0YW50ID0gbWFwU3RvcmUuZ2V0KGtleSk7XG4gICAgbWFwU3RvcmUuc2V0KGtleSwgaGFyZGVuKFsuLi5leHRhbnQsIGl0ZW1dKSk7XG4gIH0gZWxzZSB7XG4gICAgbWFwU3RvcmUuaW5pdChrZXksIGhhcmRlbihbaXRlbV0pKTtcbiAgfVxufTtcbmhhcmRlbihhcHBlbmRUb1N0b3JlZEFycmF5KTtcblxuLy9cbnZhciBtYWtlU2V0U3RvcmVNZXRob2RzID0gKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCBrZXlOYW1lID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCB7IGFzc2VydFVwZGF0ZU9uQWRkLCBhc3NlcnRVcGRhdGVPbkRlbGV0ZSwgaXRlcmFibGVLZXlzIH0gPSBtYWtlQ3VycmVudEtleXNLaXQoXG4gICAgKCkgPT4ganNzZXQua2V5cygpLFxuICAgIChrKSA9PiBqc3NldC5oYXMoayksXG4gICAgY29tcGFyZVJhbmssXG4gICAgYXNzZXJ0S2V5T2tUb0FkZCxcbiAgICBhc3NlcnRLZXlPa1RvRGVsZXRlLFxuICAgIGtleU5hbWVcbiAgKTtcbiAgY29uc3Qga2V5czUgPSAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ga2V5UGF0dCA9PT0gdm9pZCAwID8gaXRlcmFibGVLZXlzIDogZmlsdGVySXRlcmFibGUoaXRlcmFibGVLZXlzLCAoaykgPT4gbWF0Y2hlcyhrLCBrZXlQYXR0KSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIC4uLm1ha2VXZWFrU2V0U3RvcmVNZXRob2RzKFxuICAgICAganNzZXQsXG4gICAgICBhc3NlcnRVcGRhdGVPbkFkZCxcbiAgICAgIGFzc2VydFVwZGF0ZU9uRGVsZXRlLFxuICAgICAga2V5TmFtZVxuICAgICksXG4gICAga2V5czoga2V5czUsXG4gICAgdmFsdWVzOiBrZXlzNSxcbiAgICBzbmFwc2hvdDogKGtleVBhdHQgPSB2b2lkIDApID0+IG1ha2VDb3B5U2V0KGtleXM1KGtleVBhdHQpKSxcbiAgICBnZXRTaXplOiAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ga2V5UGF0dCA9PT0gdm9pZCAwID8ganNzZXQuc2l6ZSA6IFsuLi5rZXlzNShrZXlQYXR0KV0ubGVuZ3RoLFxuICAgIGNsZWFyOiAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ge1xuICAgICAgaWYgKGtleVBhdHQgPT09IHZvaWQgMCkge1xuICAgICAgICBqc3NldC5jbGVhcigpO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5czUoa2V5UGF0dCkpIHtcbiAgICAgICAganNzZXQuZGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgbWFrZVNjYWxhclNldFN0b3JlID0gKHRhZyA9IFwia2V5XCIsIHsga2V5U2hhcGUgPSB2b2lkIDAgfSA9IHt9KSA9PiB7XG4gIGNvbnN0IGpzc2V0ID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKGtleVNoYXBlKTtcbiAgfVxuICBjb25zdCBhc3NlcnRLZXlPa1RvQWRkID0gKGtleSkgPT4ge1xuICAgIGhhcmRlbihrZXkpO1xuICAgIGFzc2VydFNjYWxhcktleShrZXkpO1xuICAgIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2goa2V5LCBrZXlTaGFwZSwgXCJzZXRTdG9yZSBrZXlcIik7XG4gICAgfVxuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgU2V0U3RvcmUgb2YgJHtxdW90ZSh0YWcpfWAsIHtcbiAgICAuLi5tYWtlU2V0U3RvcmVNZXRob2RzKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCB2b2lkIDAsIHRhZylcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJTZXRTdG9yZSk7XG5cbi8vXG52YXIgbWFrZVdlYWtNYXBTdG9yZU1ldGhvZHMgPSAoanNtYXAsIGFzc2VydEtWT2tUb0FkZCwgYXNzZXJ0S1ZPa1RvU2V0LCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCBrZXlOYW1lID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCBhc3NlcnRLZXlEb2VzTm90RXhpc3QgPSAoa2V5KSA9PiAhanNtYXAuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKGtleU5hbWUpfSBhbHJlYWR5IHJlZ2lzdGVyZWQ6ICR7a2V5fWA7XG4gIGNvbnN0IGFzc2VydEtleUV4aXN0cyA9IChrZXkpID0+IGpzbWFwLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShrZXlOYW1lKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiBqc21hcC5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGdldDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKiAgICAgICAgICAgICovXG4gICAgICAgIGpzbWFwLmdldChrZXkpXG4gICAgICApO1xuICAgIH0sXG4gICAgaW5pdDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleURvZXNOb3RFeGlzdChrZXkpO1xuICAgICAgYXNzZXJ0S1ZPa1RvQWRkKGtleSwgdmFsdWUpO1xuICAgICAganNtYXAuc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgc2V0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBhc3NlcnRLVk9rVG9TZXQoa2V5LCB2YWx1ZSk7XG4gICAgICBqc21hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBkZWxldGU6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgaWYgKGFzc2VydEtleU9rVG9EZWxldGUgIT09IHZvaWQgMCkge1xuICAgICAgICBhc3NlcnRLZXlPa1RvRGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgICBqc21hcC5kZWxldGUoa2V5KTtcbiAgICB9LFxuICAgIGFkZEFsbDogKGVudHJpZXMxMSkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBlbnRyaWVzMTFbU3ltYm9sLml0ZXJhdG9yXSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGlmIChPYmplY3QuaXNGcm96ZW4oZW50cmllczExKSAmJiBpc0NvcHlNYXAoZW50cmllczExKSkge1xuICAgICAgICAgIGVudHJpZXMxMSA9IGdldENvcHlNYXBFbnRyaWVzKGVudHJpZXMxMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3dSZWRhY3RlZGBwcm92aWRlZCBkYXRhIHNvdXJjZSBpcyBub3QgaXRlcmFibGU6ICR7ZW50cmllczExfWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoXG4gICAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSBvZlxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGVudHJpZXMxMVxuICAgICAgKSB7XG4gICAgICAgIGFzc2VydEtWT2tUb0FkZChrZXksIHZhbHVlKTtcbiAgICAgICAganNtYXAuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xudmFyIG1ha2VTY2FsYXJXZWFrTWFwU3RvcmUgPSAodGFnID0gXCJrZXlcIiwgeyBsb25nTGl2ZWQgPSB0cnVlLCBrZXlTaGFwZSA9IHZvaWQgMCwgdmFsdWVTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNtYXAgPSBuZXcgKGxvbmdMaXZlZCA/IFdlYWtNYXAgOiBNYXApKCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4odmFsdWVTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S1ZPa1RvU2V0ID0gKF9rZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKHZhbHVlKTtcbiAgICBhc3NlcnRQYXNzYWJsZSh2YWx1ZSk7XG4gICAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKHZhbHVlLCB2YWx1ZVNoYXBlLCBcIndlYWtNYXBTdG9yZSB2YWx1ZVwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFzc2VydEtWT2tUb0FkZCA9IChrZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgcGFzc1N0eWxlT2Yoa2V5KSA9PT0gXCJyZW1vdGFibGVcIiB8fCB0aHJvd1JlZGFjdGVkYE9ubHkgcmVtb3RhYmxlcyBjYW4gYmUga2V5cyBvZiBzY2FsYXIgV2Vha01hcFN0b3JlczogJHtrZXl9YDtcbiAgICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKGtleSwga2V5U2hhcGUsIFwid2Vha01hcFN0b3JlIGtleVwiKTtcbiAgICB9XG4gICAgYXNzZXJ0S1ZPa1RvU2V0KGtleSwgdmFsdWUpO1xuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgV2Vha01hcFN0b3JlIG9mICR7cXVvdGUodGFnKX1gLCB7XG4gICAgLi4ubWFrZVdlYWtNYXBTdG9yZU1ldGhvZHMoXG4gICAgICBqc21hcCxcbiAgICAgIGFzc2VydEtWT2tUb0FkZCxcbiAgICAgIGFzc2VydEtWT2tUb1NldCxcbiAgICAgIHZvaWQgMCxcbiAgICAgIHRhZ1xuICAgIClcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJXZWFrTWFwU3RvcmUpO1xuXG4vL1xudmFyIG1ha2VNYXBTdG9yZU1ldGhvZHMgPSAoanNtYXAsIGFzc2VydEtWT2tUb0FkZCwgYXNzZXJ0S1ZPa1RvU2V0LCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCB0YWcgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IHsgYXNzZXJ0VXBkYXRlT25BZGQsIGFzc2VydFVwZGF0ZU9uRGVsZXRlLCBpdGVyYWJsZUtleXMgfSA9IG1ha2VDdXJyZW50S2V5c0tpdChcbiAgICAoKSA9PiBqc21hcC5rZXlzKCksXG4gICAgKGspID0+IGpzbWFwLmhhcyhrKSxcbiAgICBjb21wYXJlUmFuayxcbiAgICBhc3NlcnRLVk9rVG9BZGQsXG4gICAgYXNzZXJ0S2V5T2tUb0RlbGV0ZSxcbiAgICB0YWdcbiAgKTtcbiAgY29uc3Qga2V5czUgPSAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiB7XG4gICAgaWYgKGtleVBhdHQgPT09IHZvaWQgMCAmJiB2YWx1ZVBhdHQgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGl0ZXJhYmxlS2V5cztcbiAgICB9XG4gICAgY29uc3QgZmlsdGVyID0gKGspID0+IHtcbiAgICAgIGlmIChrZXlQYXR0ICE9PSB2b2lkIDAgJiYgIW1hdGNoZXMoaywga2V5UGF0dCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKHZhbHVlUGF0dCAhPT0gdm9pZCAwICYmICFtYXRjaGVzKGpzbWFwLmdldChrKSwgdmFsdWVQYXR0KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIHJldHVybiBmaWx0ZXJJdGVyYWJsZShpdGVyYWJsZUtleXMsIGZpbHRlcik7XG4gIH07XG4gIGNvbnN0IHZhbHVlczggPSAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBtYXBJdGVyYWJsZShrZXlzNShrZXlQYXR0LCB2YWx1ZVBhdHQpLCAoaykgPT4gKFxuICAgIC8qICAgICAgICAgICAgKi9cbiAgICBqc21hcC5nZXQoaylcbiAgKSk7XG4gIGNvbnN0IGVudHJpZXMxMSA9IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IG1hcEl0ZXJhYmxlKGtleXM1KGtleVBhdHQsIHZhbHVlUGF0dCksIChrKSA9PiBbXG4gICAgayxcbiAgICAvKiAgICAgICAgICAgICovXG4gICAganNtYXAuZ2V0KGspXG4gIF0pO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICAuLi5tYWtlV2Vha01hcFN0b3JlTWV0aG9kcyhcbiAgICAgIGpzbWFwLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGFzc2VydFVwZGF0ZU9uQWRkLFxuICAgICAgYXNzZXJ0S1ZPa1RvU2V0LFxuICAgICAgYXNzZXJ0VXBkYXRlT25EZWxldGUsXG4gICAgICB0YWdcbiAgICApLFxuICAgIGtleXM6IGtleXM1LFxuICAgIHZhbHVlczogdmFsdWVzOCxcbiAgICBlbnRyaWVzOiBlbnRyaWVzMTEsXG4gICAgc25hcHNob3Q6IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IG1ha2VDb3B5TWFwKGVudHJpZXMxMShrZXlQYXR0LCB2YWx1ZVBhdHQpKSxcbiAgICBnZXRTaXplOiAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBrZXlQYXR0ID09PSB2b2lkIDAgJiYgdmFsdWVQYXR0ID09PSB2b2lkIDAgPyBqc21hcC5zaXplIDogWy4uLmtleXM1KGtleVBhdHQsIHZhbHVlUGF0dCldLmxlbmd0aCxcbiAgICBjbGVhcjogKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4ge1xuICAgICAgaWYgKGtleVBhdHQgPT09IHZvaWQgMCAmJiB2YWx1ZVBhdHQgPT09IHZvaWQgMCkge1xuICAgICAgICBqc21hcC5jbGVhcigpO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5czUoa2V5UGF0dCwgdmFsdWVQYXR0KSkge1xuICAgICAgICBqc21hcC5kZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBtYWtlU2NhbGFyTWFwU3RvcmUgPSAodGFnID0gXCJrZXlcIiwgeyBrZXlTaGFwZSA9IHZvaWQgMCwgdmFsdWVTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNtYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oa2V5U2hhcGUpO1xuICB9XG4gIGlmICh2YWx1ZVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKHZhbHVlU2hhcGUpO1xuICB9XG4gIGNvbnN0IGFzc2VydEtWT2tUb1NldCA9IChfa2V5LCB2YWx1ZSkgPT4ge1xuICAgIGhhcmRlbih2YWx1ZSk7XG4gICAgYXNzZXJ0UGFzc2FibGUodmFsdWUpO1xuICAgIGlmICh2YWx1ZVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaCh2YWx1ZSwgdmFsdWVTaGFwZSwgXCJtYXBTdG9yZSB2YWx1ZVwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFzc2VydEtWT2tUb0FkZCA9IChrZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgYXNzZXJ0U2NhbGFyS2V5KGtleSk7XG4gICAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaChrZXksIGtleVNoYXBlLCBcIm1hcFN0b3JlIGtleVwiKTtcbiAgICB9XG4gICAgYXNzZXJ0S1ZPa1RvU2V0KGtleSwgdmFsdWUpO1xuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgTWFwU3RvcmUgb2YgJHtxdW90ZSh0YWcpfWAsIHtcbiAgICAuLi5tYWtlTWFwU3RvcmVNZXRob2RzKFxuICAgICAganNtYXAsXG4gICAgICBhc3NlcnRLVk9rVG9BZGQsXG4gICAgICBhc3NlcnRLVk9rVG9TZXQsXG4gICAgICB2b2lkIDAsXG4gICAgICB0YWdcbiAgICApXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU2NhbGFyTWFwU3RvcmUpO1xuXG4vL1xudmFyIG1ha2VMZWdhY3lNYXAgPSAodGFnID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCBtMiA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIGNvbnN0IGFzc2VydEtleURvZXNOb3RFeGlzdCA9IChrZXkpID0+ICFtMi5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gYWxyZWFkeSByZWdpc3RlcmVkOiAke2tleX1gO1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiBtMi5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiBtMi5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGluaXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlEb2VzTm90RXhpc3Qoa2V5KTtcbiAgICAgIG0yLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICByZXR1cm4gbTIuZ2V0KGtleSk7XG4gICAgfSxcbiAgICBzZXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIG0yLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBtMi5kZWxldGUoa2V5KTtcbiAgICB9LFxuICAgIGtleXM6ICgpID0+IG0yLmtleXMoKSxcbiAgICB2YWx1ZXM6ICgpID0+IG0yLnZhbHVlcygpLFxuICAgIGVudHJpZXM6ICgpID0+IG0yLmVudHJpZXMoKSxcbiAgICBnZXRTaXplOiAoKSA9PiBtMi5zaXplLFxuICAgIGNsZWFyOiAoKSA9PiBtMi5jbGVhcigpXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlTGVnYWN5TWFwKTtcblxuLy9cbnZhciBtYWtlTGVnYWN5V2Vha01hcCA9ICh0YWcgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IHdtID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IGFzc2VydEtleURvZXNOb3RFeGlzdCA9IChrZXkpID0+ICF3bS5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gYWxyZWFkeSByZWdpc3RlcmVkOiAke2tleX1gO1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiB3bS5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiB3bS5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGluaXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlEb2VzTm90RXhpc3Qoa2V5KTtcbiAgICAgIHdtLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKiAgICAgICAgICAgICovXG4gICAgICAgIHdtLmdldChrZXkpXG4gICAgICApO1xuICAgIH0sXG4gICAgc2V0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICB3bS5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBkZWxldGU6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgd20uZGVsZXRlKGtleSk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUxlZ2FjeVdlYWtNYXApO1xuXG4vL1xudmFyIGRlZmF1bHRMYWJlbFRvS2V5cyA9IChsYWJlbCkgPT4gaGFyZGVuKFtsYWJlbF0pO1xuaGFyZGVuKGRlZmF1bHRMYWJlbFRvS2V5cyk7XG52YXIgbWFrZU9uY2VLaXQgPSAoZGVidWdOYW1lLCBzdG9yZXMsIGJhY2tpbmdTdG9yZSA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCB1c2VkS2V5cyA9IHN0b3Jlcy5kZXRhY2hlZCgpLnNldFN0b3JlKGAke2RlYnVnTmFtZX0gdXNlZCBrZXlzYCk7XG4gIGNvbnN0IGFzc2VydE9ubHlPbmNlID0gKGtleSkgPT4ge1xuICAgIHR5cGVvZiBrZXkgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBrZXkgJHtrZXl9IG11c3QgYmUgYSBzdHJpbmdgO1xuICAgICF1c2VkS2V5cy5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYGtleSAke2tleX0gaGFzIGFscmVhZHkgYmVlbiB1c2VkIGluIHRoaXMgem9uZSBhbmQgaW5jYXJuYXRpb25gO1xuICAgIHVzZWRLZXlzLmFkZChrZXkpO1xuICB9O1xuICBjb25zdCB3cmFwUHJvdmlkZXIgPSAocHJvdmlkZXIsIGxhYmVsVG9LZXlzID0gZGVmYXVsdExhYmVsVG9LZXlzKSA9PiB7XG4gICAgY29uc3Qgd3JhcHBlciA9IChsYWJlbCwgLi4ucmVzdCkgPT4ge1xuICAgICAgZm9yIChjb25zdCBrZXkgb2YgbGFiZWxUb0tleXMobGFiZWwpKSB7XG4gICAgICAgIGFzc2VydE9ubHlPbmNlKGtleSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcHJvdmlkZXIobGFiZWwsIC4uLnJlc3QpO1xuICAgIH07XG4gICAgcmV0dXJuIChcbiAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgIHdyYXBwZXJcbiAgICApO1xuICB9O1xuICBjb25zdCBtYWtlT25jZSA9IChrZXksIG1ha2VyKSA9PiB7XG4gICAgYXNzZXJ0T25seU9uY2Uoa2V5KTtcbiAgICBpZiAoYmFja2luZ1N0b3JlICYmIGJhY2tpbmdTdG9yZS5oYXMoa2V5KSkge1xuICAgICAgcmV0dXJuIGJhY2tpbmdTdG9yZS5nZXQoa2V5KTtcbiAgICB9XG4gICAgY29uc3QgdmFsdWUgPSBtYWtlcihrZXkpO1xuICAgIHN0b3Jlcy5pc1N0b3JhYmxlKHZhbHVlKSB8fCB0aHJvd1JlZGFjdGVkYG1ha2VyIHJldHVybiB2YWx1ZSAke3ZhbHVlfSBpcyBub3Qgc3RvcmFibGVgO1xuICAgIGJhY2tpbmdTdG9yZSAmJiBiYWNraW5nU3RvcmUuaW5pdChrZXksIHZhbHVlKTtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oeyBtYWtlT25jZSwgd3JhcFByb3ZpZGVyIH0pO1xufTtcbmhhcmRlbihtYWtlT25jZUtpdCk7XG5cbi8vXG52YXIga2luZCA9IChsYWJlbCkgPT4gYCR7bGFiZWx9X2tpbmRIYW5kbGVgO1xudmFyIHNpbmdsZXRvbiA9IChsYWJlbCkgPT4gYCR7bGFiZWx9X3NpbmdsZXRvbmA7XG52YXIgYWdvcmljVmF0RGF0YUtleXMgPSB7XG4gIGV4b0NsYXNzOiAobGFiZWwpID0+IGhhcmRlbihba2luZChsYWJlbCldKSxcbiAgZXhvQ2xhc3NLaXQ6IChsYWJlbCkgPT4gaGFyZGVuKFtraW5kKGxhYmVsKV0pLFxuICBleG86IChsYWJlbCkgPT4gaGFyZGVuKFtraW5kKGxhYmVsKSwgc2luZ2xldG9uKGxhYmVsKV0pLFxuICBzdG9yZTogKGxhYmVsKSA9PiBoYXJkZW4oW2xhYmVsXSksXG4gIHpvbmU6IChsYWJlbCkgPT4gaGFyZGVuKFtsYWJlbF0pXG59O1xuaGFyZGVuKGFnb3JpY1ZhdERhdGFLZXlzKTtcblxuLy9cbnZhciB7IGFwcGx5OiBhcHBseTYgfSA9IFJlZmxlY3Q7XG52YXIgUHJvbWlzZVdhdGNoZXJIYW5kbGVyID0gTS5jYWxsKE0ucmF3KCkpLnJlc3QoTS5yYXcoKSkucmV0dXJucygpO1xudmFyIFByb21pc2VXYXRjaGVySSA9IE0uaW50ZXJmYWNlKFwiUHJvbWlzZVdhdGNoZXJcIiwge1xuICBvbkZ1bGZpbGxlZDogUHJvbWlzZVdhdGNoZXJIYW5kbGVyLFxuICBvblJlamVjdGVkOiBQcm9taXNlV2F0Y2hlckhhbmRsZXJcbn0pO1xudmFyIFByb21pc2VXYXRjaGVyRnVsZmlsbGVkSSA9IE0uaW50ZXJmYWNlKFwiUHJvbWlzZVdhdGNoZXJGdWxmaWxsZWRcIiwge1xuICBvbkZ1bGZpbGxlZDogUHJvbWlzZVdhdGNoZXJIYW5kbGVyXG59KTtcbnZhciBQcm9taXNlV2F0Y2hlclJlamVjdGVkSSA9IE0uaW50ZXJmYWNlKFwiUHJvbWlzZVdhdGNoZXJSZWplY3RlZFwiLCB7XG4gIG9uUmVqZWN0ZWQ6IFByb21pc2VXYXRjaGVySGFuZGxlclxufSk7XG52YXIgY2FsbE1lTWF5YmUgPSAodGhhdCwgcHJvcCwgcG9zdEFyZ3MpID0+IHtcbiAgY29uc3QgZm4gPSB0aGF0W3Byb3BdO1xuICBpZiAoIWZuKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBhc3NlcnQudHlwZW9mKGZuLCBcImZ1bmN0aW9uXCIpO1xuICBjb25zdCB3cmFwcGVkID0gKGFyZykgPT4ge1xuICAgIGFwcGx5NihmbiwgdGhhdCwgW2FyZywgLi4ucG9zdEFyZ3NdKTtcbiAgfTtcbiAgcmV0dXJuIHdyYXBwZWQ7XG59O1xudmFyIHdhdGNoUHJvbWlzZSA9IChwMiwgd2F0Y2hlciwgLi4ud2F0Y2hlckFyZ3MpID0+IHtcbiAgUHJvbWlzZS5yZXNvbHZlKHAyKSA9PT0gcDIgfHwgdGhyb3dSZWRhY3RlZGB3YXRjaFByb21pc2Ugb25seSB3YXRjaGVzIHByb21pc2VzYDtcbiAgY29uc3Qgb25GdWxmaWxsZWQgPSBjYWxsTWVNYXliZSh3YXRjaGVyLCBcIm9uRnVsZmlsbGVkXCIsIHdhdGNoZXJBcmdzKTtcbiAgY29uc3Qgb25SZWplY3RlZCA9IGNhbGxNZU1heWJlKHdhdGNoZXIsIFwib25SZWplY3RlZFwiLCB3YXRjaGVyQXJncyk7XG4gIG9uRnVsZmlsbGVkIHx8IG9uUmVqZWN0ZWQgfHwgdGhyb3dSZWRhY3RlZGBwcm9taXNlIHdhdGNoZXIgbXVzdCBpbXBsZW1lbnQgYXQgbGVhc3Qgb25lIGhhbmRsZXIgbWV0aG9kYDtcbiAgdm9pZCBFLndoZW4ocDIsIG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKTtcbn07XG5oYXJkZW4od2F0Y2hQcm9taXNlKTtcblxuLy9cbnZhciBkZXRhY2hlZEhlYXBTdG9yZXMgPSBGYXIoXCJoZWFwU3RvcmVzXCIsIHtcbiAgZGV0YWNoZWQ6ICgpID0+IGRldGFjaGVkSGVhcFN0b3JlcyxcbiAgaXNTdG9yYWJsZTogaXNQYXNzYWJsZSxcbiAgc2V0U3RvcmU6IG1ha2VTY2FsYXJTZXRTdG9yZSxcbiAgbWFwU3RvcmU6IG1ha2VTY2FsYXJNYXBTdG9yZSxcbiAgd2Vha01hcFN0b3JlOiBtYWtlU2NhbGFyV2Vha01hcFN0b3JlLFxuICB3ZWFrU2V0U3RvcmU6IG1ha2VTY2FsYXJXZWFrU2V0U3RvcmVcbn0pO1xudmFyIG1ha2VIZWFwWm9uZSA9IChiYXNlTGFiZWwgPSBcImhlYXBab25lXCIpID0+IHtcbiAgY29uc3QgeyBtYWtlT25jZSwgd3JhcFByb3ZpZGVyIH0gPSBtYWtlT25jZUtpdChiYXNlTGFiZWwsIGRldGFjaGVkSGVhcFN0b3Jlcyk7XG4gIGNvbnN0IG1ha2VTdWJab25lID0gKGxhYmVsLCBfb3B0aW9ucykgPT4gbWFrZUhlYXBab25lKGAke2Jhc2VMYWJlbH0uJHtsYWJlbH1gKTtcbiAgcmV0dXJuIEZhcihcImhlYXBab25lXCIsIHtcbiAgICBleG86IHdyYXBQcm92aWRlcihtYWtlRXhvLCBhZ29yaWNWYXREYXRhS2V5cy5leG8pLFxuICAgIGV4b0NsYXNzOiB3cmFwUHJvdmlkZXIoZGVmaW5lRXhvQ2xhc3MsIGFnb3JpY1ZhdERhdGFLZXlzLmV4b0NsYXNzKSxcbiAgICBleG9DbGFzc0tpdDogd3JhcFByb3ZpZGVyKGRlZmluZUV4b0NsYXNzS2l0LCBhZ29yaWNWYXREYXRhS2V5cy5leG9DbGFzc0tpdCksXG4gICAgc3ViWm9uZTogd3JhcFByb3ZpZGVyKG1ha2VTdWJab25lKSxcbiAgICBtYWtlT25jZSxcbiAgICB3YXRjaFByb21pc2UsXG4gICAgZGV0YWNoZWQ6IGRldGFjaGVkSGVhcFN0b3Jlcy5kZXRhY2hlZCxcbiAgICBpc1N0b3JhYmxlOiBkZXRhY2hlZEhlYXBTdG9yZXMuaXNTdG9yYWJsZSxcbiAgICBtYXBTdG9yZTogd3JhcFByb3ZpZGVyKGRldGFjaGVkSGVhcFN0b3Jlcy5tYXBTdG9yZSksXG4gICAgc2V0U3RvcmU6IHdyYXBQcm92aWRlcihkZXRhY2hlZEhlYXBTdG9yZXMuc2V0U3RvcmUpLFxuICAgIHdlYWtNYXBTdG9yZTogd3JhcFByb3ZpZGVyKGRldGFjaGVkSGVhcFN0b3Jlcy53ZWFrTWFwU3RvcmUpLFxuICAgIHdlYWtTZXRTdG9yZTogd3JhcFByb3ZpZGVyKGRldGFjaGVkSGVhcFN0b3Jlcy53ZWFrU2V0U3RvcmUpXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlSGVhcFpvbmUpO1xuXG4vL1xudmFyIHNpbmsgPSAoKSA9PiB7XG59O1xuaGFyZGVuKHNpbmspO1xudmFyIFZvd1NoYXBlID0gTS50YWdnZWQoXG4gIFwiVm93XCIsXG4gIE0uc3BsaXRSZWNvcmQoe1xuICAgIHZvd1YwOiBNLnJlbW90YWJsZShcIlZvd1YwXCIpXG4gIH0pXG4pO1xudmFyIGlzVm93ID0gKHNwZWNpbWVuKSA9PiBpc1Bhc3NhYmxlKHNwZWNpbWVuKSAmJiBtYXRjaGVzKHNwZWNpbWVuLCBWb3dTaGFwZSk7XG5oYXJkZW4oaXNWb3cpO1xudmFyIGdldFZvd1BheWxvYWQgPSAoc3BlY2ltZW4pID0+IHtcbiAgaWYgKCFpc1ZvdyhzcGVjaW1lbikpIHtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG4gIGNvbnN0IHZvdyA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgc3BlY2ltZW5cbiAgKTtcbiAgcmV0dXJuIHZvdy5wYXlsb2FkO1xufTtcbmhhcmRlbihnZXRWb3dQYXlsb2FkKTtcbnZhciB0b1Bhc3NhYmxlQ2FwID0gKGspID0+IHtcbiAgY29uc3QgcGF5bG9hZCA9IGdldFZvd1BheWxvYWQoayk7XG4gIGlmIChwYXlsb2FkID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGtcbiAgICApO1xuICB9XG4gIGNvbnN0IHsgdm93VjAgfSA9IHBheWxvYWQ7XG4gIHJldHVybiB2b3dWMDtcbn07XG5oYXJkZW4odG9QYXNzYWJsZUNhcCk7XG52YXIgbWFrZUFzVm93ID0gKG1ha2VWb3dLaXQpID0+IHtcbiAgY29uc3QgYXNWb3cgPSAoZm4pID0+IHtcbiAgICBsZXQgcmVzdWx0O1xuICAgIHRyeSB7XG4gICAgICByZXN1bHQgPSBmbigpO1xuICAgIH0gY2F0Y2ggKGUyKSB7XG4gICAgICByZXN1bHQgPSBQcm9taXNlLnJlamVjdChlMik7XG4gICAgfVxuICAgIGlmIChpc1ZvdyhyZXN1bHQpKSB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBjb25zdCB7IHZvdywgcmVzb2x2ZXIgfSA9IG1ha2VWb3dLaXQoKTtcbiAgICByZXNvbHZlci5yZXNvbHZlKHJlc3VsdCk7XG4gICAgcmV0dXJuIHZvdztcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbihhc1Zvdyk7XG59O1xuaGFyZGVuKG1ha2VBc1Zvdyk7XG5cbi8vXG52YXIgeyBkZXRhaWxzOiBYMyB9ID0gYXNzZXJ0O1xudmFyIG5vb3AgPSAoKSA9PiB7XG59O1xuaGFyZGVuKG5vb3ApO1xudmFyIHByZXBhcmVWb3dLaXQgPSAoem9uZSwgdm93UmVqZWN0aW9uVHJhY2tlcikgPT4ge1xuICBjb25zdCByZXNvbHZlclRvRXBoZW1lcmEgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgcmVzb2x2ZXJUb05vblN0b3JlZFZhbHVlID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IHByb3ZpZGVFcGhlbWVyYSA9IChyZXNvbHZlciwgb3B0aW9ucykgPT4ge1xuICAgIGxldCBlcGhlbWVyYSA9IHJlc29sdmVyVG9FcGhlbWVyYS5nZXQocmVzb2x2ZXIpO1xuICAgIGlmICghZXBoZW1lcmEpIHtcbiAgICAgIGVwaGVtZXJhID0gbWFrZVByb21pc2VLaXQoKTtcbiAgICAgIGVwaGVtZXJhLnByb21pc2UuY2F0Y2gobm9vcCk7XG4gICAgfVxuICAgIGVwaGVtZXJhID0gaGFyZGVuKHsgLi4uZXBoZW1lcmEsIC4uLm9wdGlvbnMgfSk7XG4gICAgcmVzb2x2ZXJUb0VwaGVtZXJhLnNldChyZXNvbHZlciwgZXBoZW1lcmEpO1xuICAgIHJldHVybiBlcGhlbWVyYTtcbiAgfTtcbiAgY29uc3QgcHJvdmlkZUVwaGVtZXJhRm9yUmVzb2x1dGlvbiA9IChyZXNvbHZlcikgPT4ge1xuICAgIGNvbnN0IGVwaGVtZXJhID0gcHJvdmlkZUVwaGVtZXJhKHJlc29sdmVyKTtcbiAgICBpZiAoZXBoZW1lcmEucmVzb2x2ZSkge1xuICAgICAgY29uc3QgeyByZXNvbHZlOiBfMSwgcmVqZWN0OiBfMiwgLi4ucmVzdCB9ID0gZXBoZW1lcmE7XG4gICAgICByZXNvbHZlclRvRXBoZW1lcmEuc2V0KHJlc29sdmVyLCBoYXJkZW4ocmVzdCkpO1xuICAgIH1cbiAgICByZXR1cm4gZXBoZW1lcmE7XG4gIH07XG4gIGNvbnN0IG1ha2VWb3dJbnRlcm5hbHNLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgIFwiVm93SW50ZXJuYWxzS2l0XCIsXG4gICAge1xuICAgICAgdm93VjA6IE0uaW50ZXJmYWNlKFwiVm93VjBcIiwge1xuICAgICAgICBzaG9ydGVuOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICAgICAgfSksXG4gICAgICByZXNvbHZlcjogTS5pbnRlcmZhY2UoXCJWb3dSZXNvbHZlclwiLCB7XG4gICAgICAgIHJlc29sdmU6IE0uY2FsbCgpLm9wdGlvbmFsKE0ucmF3KCkpLnJldHVybnMoKSxcbiAgICAgICAgcmVqZWN0OiBNLmNhbGwoKS5vcHRpb25hbChNLnJhdygpKS5yZXR1cm5zKClcbiAgICAgIH0pLFxuICAgICAgd2F0Y2hOZXh0U3RlcDogUHJvbWlzZVdhdGNoZXJJXG4gICAgfSxcbiAgICAoKSA9PiAoe1xuICAgICAgLyogICAgICAgICAgICAgICovXG4gICAgICB2YWx1ZTogdm9pZCAwLFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIHN0ZXBTdGF0dXM6IG51bGwsXG4gICAgICBpc1N0b3JlZFZhbHVlOiBmYWxzZSxcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIHZvd0lzSGFuZGxlZDogZmFsc2UsXG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICBleHRyYTogdm9pZCAwXG4gICAgfSksXG4gICAge1xuICAgICAgdm93VjA6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgYXN5bmMgc2hvcnRlbigpIHtcbiAgICAgICAgICBjb25zdCB7IHN0ZXBTdGF0dXMsIGlzU3RvcmVkVmFsdWUsIHZhbHVlLCB2b3dJc0hhbmRsZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyByZXNvbHZlciwgdm93VjAgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIHN3aXRjaCAoc3RlcFN0YXR1cykge1xuICAgICAgICAgICAgY2FzZSBcImZ1bGZpbGxlZFwiOiB7XG4gICAgICAgICAgICAgIGlmICh2b3dJc0hhbmRsZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS52b3dJc0hhbmRsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChpc1N0b3JlZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc29sdmVyVG9Ob25TdG9yZWRWYWx1ZS5oYXMocmVzb2x2ZXIpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmVyVG9Ob25TdG9yZWRWYWx1ZS5nZXQocmVzb2x2ZXIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHRocm93IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcInJlamVjdGVkXCI6IHtcbiAgICAgICAgICAgICAgaWYgKHZvd0lzSGFuZGxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLnZvd0lzSGFuZGxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdm93UmVqZWN0aW9uVHJhY2tlcj8uaGFuZGxlKHZvd1YwKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zdCByZWFzb24gPSByZXNvbHZlclRvTm9uU3RvcmVkVmFsdWUuaGFzKHJlc29sdmVyKSA/IHJlc29sdmVyVG9Ob25TdG9yZWRWYWx1ZS5nZXQocmVzb2x2ZXIpIDogdmFsdWU7XG4gICAgICAgICAgICAgIHRocm93IHJlYXNvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgbnVsbDpcbiAgICAgICAgICAgIGNhc2UgXCJwZW5kaW5nXCI6XG4gICAgICAgICAgICAgIHJldHVybiBwcm92aWRlRXBoZW1lcmEodGhpcy5mYWNldHMucmVzb2x2ZXIsIHtcbiAgICAgICAgICAgICAgICBwb3RlbnRpYWxseUhhbmRsZWQ6IHRydWVcbiAgICAgICAgICAgICAgfSkucHJvbWlzZTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihgdW5leHBlY3RlZCBzdGVwU3RhdHVzICR7c3RlcFN0YXR1c31gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXNvbHZlcjoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICByZXNvbHZlKHZhbHVlKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGVwU3RhdHVzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChzdGVwU3RhdHVzICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuc3RhdGUuc3RlcFN0YXR1cyA9IFwicGVuZGluZ1wiO1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZTogcmVzb2x2ZTIgfSA9IHByb3ZpZGVFcGhlbWVyYUZvclJlc29sdXRpb24ocmVzb2x2ZXIpO1xuICAgICAgICAgIHJlc29sdmUyICYmIHJlc29sdmUyKHZhbHVlKTtcbiAgICAgICAgICB6b25lLndhdGNoUHJvbWlzZShcbiAgICAgICAgICAgIEhhbmRsZWRQcm9taXNlLnJlc29sdmUodmFsdWUpLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMud2F0Y2hOZXh0U3RlcFxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIHJlamVjdChyZWFzb24pIHtcbiAgICAgICAgICBjb25zdCB7IHN0ZXBTdGF0dXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKHN0ZXBTdGF0dXMgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5zdGF0ZS5zdGVwU3RhdHVzID0gXCJyZWplY3RlZFwiO1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZXIsIHdhdGNoTmV4dFN0ZXAgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IHsgcmVqZWN0IH0gPSBwcm92aWRlRXBoZW1lcmFGb3JSZXNvbHV0aW9uKHJlc29sdmVyKTtcbiAgICAgICAgICByZWplY3QgJiYgcmVqZWN0KHJlYXNvbik7XG4gICAgICAgICAgd2F0Y2hOZXh0U3RlcC5vblJlamVjdGVkKHJlYXNvbik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB3YXRjaE5leHRTdGVwOiB7XG4gICAgICAgIG9uRnVsZmlsbGVkKHZhbHVlKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5zdGVwU3RhdHVzID0gXCJmdWxmaWxsZWRcIjtcbiAgICAgICAgICBjb25zdCB7IHJlc29sdmVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCB7IHJlc29sdmU6IHJlc29sdmUyIH0gPSBwcm92aWRlRXBoZW1lcmFGb3JSZXNvbHV0aW9uKHJlc29sdmVyKTtcbiAgICAgICAgICBoYXJkZW4odmFsdWUpO1xuICAgICAgICAgIHJlc29sdmUyICYmIHJlc29sdmUyKHZhbHVlKTtcbiAgICAgICAgICB0aGlzLnN0YXRlLmlzU3RvcmVkVmFsdWUgPSB6b25lLmlzU3RvcmFibGUodmFsdWUpO1xuICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmlzU3RvcmVkVmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzb2x2ZXJUb05vblN0b3JlZFZhbHVlLnNldChyZXNvbHZlciwgdmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS52YWx1ZSA9IGFzc2VydC5lcnJvcihcbiAgICAgICAgICAgICAgWDNgVm93IGZ1bGZpbGxtZW50IHZhbHVlIHdhcyBub3Qgc3RvcmVkOiAke3ZhbHVlfWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBvblJlamVjdGVkKHJlYXNvbikge1xuICAgICAgICAgIHRoaXMuc3RhdGUuc3RlcFN0YXR1cyA9IFwicmVqZWN0ZWRcIjtcbiAgICAgICAgICBjb25zdCB7IHJlc29sdmVyLCB2b3dWMCB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgeyByZWplY3QsIHBvdGVudGlhbGx5SGFuZGxlZCB9ID0gcHJvdmlkZUVwaGVtZXJhRm9yUmVzb2x1dGlvbihyZXNvbHZlcik7XG4gICAgICAgICAgaGFyZGVuKHJlYXNvbik7XG4gICAgICAgICAgcmVqZWN0ICYmIHJlamVjdChyZWFzb24pO1xuICAgICAgICAgIGlmICh0aGlzLnN0YXRlLnZvd0lzSGFuZGxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlmIChwb3RlbnRpYWxseUhhbmRsZWQpIHtcbiAgICAgICAgICAgICAgdGhpcy5zdGF0ZS52b3dJc0hhbmRsZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdm93UmVqZWN0aW9uVHJhY2tlcj8ucmVqZWN0KHZvd1YwLCByZWFzb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnN0YXRlLmlzU3RvcmVkVmFsdWUgPSB6b25lLmlzU3RvcmFibGUocmVhc29uKTtcbiAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5pc1N0b3JlZFZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gcmVhc29uO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlclRvTm9uU3RvcmVkVmFsdWUuc2V0KHJlc29sdmVyLCByZWFzb24pO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS52YWx1ZSA9IGFzc2VydC5lcnJvcihcbiAgICAgICAgICAgICAgWDNgVm93IHJlamVjdGlvbiByZWFzb24gd2FzIG5vdCBzdG9yZWQ6ICR7cmVhc29ufWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlVm93S2l0ID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgcmVzb2x2ZXIsIHZvd1YwIH0gPSBtYWtlVm93SW50ZXJuYWxzS2l0KCk7XG4gICAgY29uc3Qgdm93ID0gbWFrZVRhZ2dlZChcIlZvd1wiLCBoYXJkZW4oeyB2b3dWMCB9KSk7XG4gICAgcmV0dXJuIGhhcmRlbih7IHJlc29sdmVyLCB2b3cgfSk7XG4gIH07XG4gIHJldHVybiBtYWtlVm93S2l0O1xufTtcbmhhcmRlbihwcmVwYXJlVm93S2l0KTtcblxuLy9cbnZhciB7IGRlZmluZVByb3BlcnR5OiBkZWZpbmVQcm9wZXJ0eTIgfSA9IE9iamVjdDtcbnZhciB0eXBlZE1hcCA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgKi9cbiAgRnVuY3Rpb24ucHJvdG90eXBlLmNhbGwuYmluZChBcnJheS5wcm90b3R5cGUubWFwKVxuKTtcbnZhciBsb2dMZXZlbHMgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIFtcbiAgICBcImRlYnVnXCIsXG4gICAgXCJsb2dcIixcbiAgICBcImluZm9cIixcbiAgICBcIndhcm5cIixcbiAgICBcImVycm9yXCJcbiAgXVxuKTtcbk9iamVjdC5mcmVlemUobG9nTGV2ZWxzKTtcbnZhciBwcm92aWRlTGF6eU1hcCA9IChtYXAsIGtleSwgbWFrZVZhbHVlKSA9PiB7XG4gIGNvbnN0IGZvdW5kID0gbWFwLmdldChrZXkpO1xuICBpZiAoZm91bmQgIT09IHZvaWQgMCB8fCBtYXAuaGFzKGtleSkpIHtcbiAgICByZXR1cm4gKFxuICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAgZm91bmRcbiAgICApO1xuICB9XG4gIGNvbnN0IHZhbHVlID0gbWFrZVZhbHVlKGtleSk7XG4gIG1hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gIHJldHVybiB2YWx1ZTtcbn07XG5cbi8vXG52YXIgeyBGYWlsOiBGYWlsNSwgYmFyZTogYmFyZTIsIGRldGFpbHM6IFg0IH0gPSBhc3NlcnQ7XG52YXIgVm93U2hhcGUyID0gTS50YWdnZWQoXG4gIFwiVm93XCIsXG4gIGhhcmRlbih7XG4gICAgdm93VjA6IE0ucmVtb3RhYmxlKFwiVm93VjBcIilcbiAgfSlcbik7XG52YXIgcHJlcGFyZVdhdGNoVXRpbHMgPSAoem9uZSwgeyB3YXRjaCwgd2hlbiwgbWFrZVZvd0tpdCwgaXNSZXRyeWFibGVSZWFzb246IGlzUmV0cnlhYmxlUmVhc29uMiB9KSA9PiB7XG4gIGNvbnN0IGRldGFjaGVkID0gem9uZS5kZXRhY2hlZCgpO1xuICBjb25zdCB1dGlsc1RvTm9uU3RvcmFibGVSZXN1bHRzID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IG1ha2VXYXRjaFV0aWxzS2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIldhdGNoVXRpbHNcIixcbiAgICB7XG4gICAgICB1dGlsczogTS5pbnRlcmZhY2UoXCJVdGlsc1wiLCB7XG4gICAgICAgIGFsbDogTS5jYWxsKE0uYXJyYXlPZihNLmFueSgpKSkucmV0dXJucyhWb3dTaGFwZTIpLFxuICAgICAgICBhbGxTZXR0bGVkOiBNLmNhbGwoTS5hcnJheU9mKE0uYW55KCkpKS5yZXR1cm5zKFZvd1NoYXBlMiksXG4gICAgICAgIGFzUHJvbWlzZTogTS5jYWxsKE0ucmF3KCkpLnJlc3QoTS5yYXcoKSkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgICAgIH0pLFxuICAgICAgd2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnJhdygpKS5yZXN0KE0ucmF3KCkpLnJldHVybnMoTS5yYXcoKSksXG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLnJhdygpKS5yZXN0KE0ucmF3KCkpLnJldHVybnMoTS5yYXcoKSlcbiAgICAgIH0pLFxuICAgICAgaGVscGVyOiBNLmludGVyZmFjZShcIkhlbHBlclwiLCB7XG4gICAgICAgIGNyZWF0ZVZvdzogTS5jYWxsKE0uYXJyYXlPZihNLmFueSgpKSwgTS5ib29sZWFuKCkpLnJldHVybnMoVm93U2hhcGUyKSxcbiAgICAgICAgcHJvY2Vzc1Jlc3VsdDogTS5jYWxsKE0ucmF3KCkpLnJlc3QoTS5yYXcoKSkucmV0dXJucyhNLnVuZGVmaW5lZCgpKVxuICAgICAgfSksXG4gICAgICByZXRyeVJlamVjdGlvblByb21pc2VXYXRjaGVyOiBQcm9taXNlV2F0Y2hlcklcbiAgICB9LFxuICAgICgpID0+IHtcbiAgICAgIGNvbnN0IGlkVG9Wb3dTdGF0ZSA9IGRldGFjaGVkLm1hcFN0b3JlKFwiaWRUb1Zvd1N0YXRlXCIpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmV4dElkOiAwbixcbiAgICAgICAgaWRUb1Zvd1N0YXRlXG4gICAgICB9O1xuICAgIH0sXG4gICAge1xuICAgICAgdXRpbHM6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgYWxsKHNwZWNpbWVucykge1xuICAgICAgICAgIHJldHVybiB0aGlzLmZhY2V0cy5oZWxwZXIuY3JlYXRlVm93KHNwZWNpbWVucywgZmFsc2UpO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBhbGxTZXR0bGVkKHNwZWNpbWVucykge1xuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLmhlbHBlci5jcmVhdGVWb3coc3BlY2ltZW5zLCB0cnVlKVxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGFzUHJvbWlzZShzcGVjaW1lblAsIC4uLndhdGNoZXJBcmdzKSB7XG4gICAgICAgICAgY29uc3Qgdm93ID0gd2F0Y2goc3BlY2ltZW5QLCAuLi53YXRjaGVyQXJncyk7XG4gICAgICAgICAgY29uc3QgcHJvbWlzZSA9IHdoZW4odm93KTtcbiAgICAgICAgICB6b25lLndhdGNoUHJvbWlzZShwcm9taXNlLCB0aGlzLmZhY2V0cy5yZXRyeVJlamVjdGlvblByb21pc2VXYXRjaGVyKTtcbiAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHZhbHVlLCBjdHgpIHtcbiAgICAgICAgICB0aGlzLmZhY2V0cy5oZWxwZXIucHJvY2Vzc1Jlc3VsdCh2YWx1ZSwgY3R4LCBcImZ1bGZpbGxlZFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uUmVqZWN0ZWQocmVhc29uLCBjdHgpIHtcbiAgICAgICAgICB0aGlzLmZhY2V0cy5oZWxwZXIucHJvY2Vzc1Jlc3VsdChyZWFzb24sIGN0eCwgXCJyZWplY3RlZFwiKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGhlbHBlcjoge1xuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGNyZWF0ZVZvdyhzcGVjaW1lbnMsIGlzQWxsU2V0dGxlZCkge1xuICAgICAgICAgIGNvbnN0IHsgbmV4dElkOiBpZCwgaWRUb1Zvd1N0YXRlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGNvbnN0IGtpdCA9IG1ha2VWb3dLaXQoKTtcbiAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgc3BlY2ltZW5zLmxlbmd0aDsgaW5kZXggKz0gMSkge1xuICAgICAgICAgICAgd2F0Y2goc3BlY2ltZW5zW2luZGV4XSwgdGhpcy5mYWNldHMud2F0Y2hlciwge1xuICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICAgaW5kZXgsXG4gICAgICAgICAgICAgIG51bVJlc3VsdHM6IHNwZWNpbWVucy5sZW5ndGgsXG4gICAgICAgICAgICAgIGlzQWxsU2V0dGxlZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzcGVjaW1lbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS5uZXh0SWQgKz0gMW47XG4gICAgICAgICAgICBpZFRvVm93U3RhdGUuaW5pdChcbiAgICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAgIGhhcmRlbih7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZXI6IGtpdC5yZXNvbHZlcixcbiAgICAgICAgICAgICAgICByZW1haW5pbmc6IHNwZWNpbWVucy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgcmVzdWx0c01hcDogZGV0YWNoZWQubWFwU3RvcmUoXCJyZXN1bHRzTWFwXCIpLFxuICAgICAgICAgICAgICAgIGlzQWxsU2V0dGxlZFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNvbnN0IGlkVG9Ob25TdG9yYWJsZVJlc3VsdHMgPSBwcm92aWRlTGF6eU1hcChcbiAgICAgICAgICAgICAgdXRpbHNUb05vblN0b3JhYmxlUmVzdWx0cyxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMudXRpbHMsXG4gICAgICAgICAgICAgICgpID0+IC8qICAgICAgICAgICAqLyBuZXcgTWFwKClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZFRvTm9uU3RvcmFibGVSZXN1bHRzLnNldChpZCwgLyogICAgICAgICAgICovIG5ldyBNYXAoKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGtpdC5yZXNvbHZlci5yZXNvbHZlKGhhcmRlbihbXSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4ga2l0LnZvdztcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgcHJvY2Vzc1Jlc3VsdChyZXN1bHQsIHsgaWQsIGluZGV4LCBudW1SZXN1bHRzLCBpc0FsbFNldHRsZWQgfSwgc3RhdHVzKSB7XG4gICAgICAgICAgY29uc3QgeyBpZFRvVm93U3RhdGUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKCFpZFRvVm93U3RhdGUuaGFzKGlkKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBpZFRvTm9uU3RvcmFibGVSZXN1bHRzID0gcHJvdmlkZUxhenlNYXAoXG4gICAgICAgICAgICB1dGlsc1RvTm9uU3RvcmFibGVSZXN1bHRzLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMudXRpbHMsXG4gICAgICAgICAgICAoKSA9PiAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCB7IHJlbWFpbmluZywgcmVzdWx0c01hcCwgcmVzb2x2ZXIgfSA9IGlkVG9Wb3dTdGF0ZS5nZXQoaWQpO1xuICAgICAgICAgIGlmICghaXNBbGxTZXR0bGVkICYmIHN0YXR1cyA9PT0gXCJyZWplY3RlZFwiKSB7XG4gICAgICAgICAgICBpZFRvVm93U3RhdGUuZGVsZXRlKGlkKTtcbiAgICAgICAgICAgIGlkVG9Ob25TdG9yYWJsZVJlc3VsdHMuZGVsZXRlKGlkKTtcbiAgICAgICAgICAgIHJlc29sdmVyLnJlamVjdChyZXN1bHQpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBwb3NzaWJseVdyYXBwZWRSZXN1bHQgPSBpc0FsbFNldHRsZWQgPyBoYXJkZW4oe1xuICAgICAgICAgICAgc3RhdHVzLFxuICAgICAgICAgICAgW3N0YXR1cyA9PT0gXCJmdWxmaWxsZWRcIiA/IFwidmFsdWVcIiA6IFwicmVhc29uXCJdOiByZXN1bHRcbiAgICAgICAgICB9KSA6IHJlc3VsdDtcbiAgICAgICAgICBjb25zdCBub25TdG9yYWJsZVJlc3VsdHMgPSBwcm92aWRlTGF6eU1hcChcbiAgICAgICAgICAgIGlkVG9Ob25TdG9yYWJsZVJlc3VsdHMsXG4gICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICgpID0+IC8qICAgICAgICAgICAqLyBuZXcgTWFwKClcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICh6b25lLmlzU3RvcmFibGUocG9zc2libHlXcmFwcGVkUmVzdWx0KSkge1xuICAgICAgICAgICAgcmVzdWx0c01hcC5pbml0KGluZGV4LCBwb3NzaWJseVdyYXBwZWRSZXN1bHQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBub25TdG9yYWJsZVJlc3VsdHMuc2V0KGluZGV4LCBwb3NzaWJseVdyYXBwZWRSZXN1bHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCB2b3dTdGF0ZSA9IGhhcmRlbih7XG4gICAgICAgICAgICByZW1haW5pbmc6IHJlbWFpbmluZyAtIDEsXG4gICAgICAgICAgICByZXN1bHRzTWFwLFxuICAgICAgICAgICAgcmVzb2x2ZXIsXG4gICAgICAgICAgICBpc0FsbFNldHRsZWRcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZiAodm93U3RhdGUucmVtYWluaW5nID4gMCkge1xuICAgICAgICAgICAgaWRUb1Zvd1N0YXRlLnNldChpZCwgdm93U3RhdGUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZFRvVm93U3RhdGUuZGVsZXRlKGlkKTtcbiAgICAgICAgICBpZFRvTm9uU3RvcmFibGVSZXN1bHRzLmRlbGV0ZShpZCk7XG4gICAgICAgICAgY29uc3QgcmVzdWx0cyA9IG5ldyBBcnJheShudW1SZXN1bHRzKTtcbiAgICAgICAgICBsZXQgbnVtTG9zdCA9IDA7XG4gICAgICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IG51bVJlc3VsdHM7IGkyICs9IDEpIHtcbiAgICAgICAgICAgIGlmIChub25TdG9yYWJsZVJlc3VsdHMuaGFzKGkyKSkge1xuICAgICAgICAgICAgICByZXN1bHRzW2kyXSA9IG5vblN0b3JhYmxlUmVzdWx0cy5nZXQoaTIpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHRzTWFwLmhhcyhpMikpIHtcbiAgICAgICAgICAgICAgcmVzdWx0c1tpMl0gPSByZXN1bHRzTWFwLmdldChpMik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBudW1Mb3N0ICs9IDE7XG4gICAgICAgICAgICAgIHJlc3VsdHNbaTJdID0gaXNBbGxTZXR0bGVkID8geyBzdGF0dXM6IFwicmVqZWN0ZWRcIiwgcmVhc29uOiBcIlVuc3RvcmFibGUgcmVzdWx0IHdhcyBsb3N0XCIgfSA6IHZvaWQgMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG51bUxvc3QgPiAwICYmICFpc0FsbFNldHRsZWQpIHtcbiAgICAgICAgICAgIHJlc29sdmVyLnJlamVjdChcbiAgICAgICAgICAgICAgYXNzZXJ0LmVycm9yKFg0YCR7bnVtTG9zdH0gdW5zdG9yYWJsZSByZXN1bHRzIHdlcmUgbG9zdGApXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlci5yZXNvbHZlKGhhcmRlbihyZXN1bHRzKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmV0cnlSZWplY3Rpb25Qcm9taXNlV2F0Y2hlcjoge1xuICAgICAgICBvbkZ1bGZpbGxlZChfcmVzdWx0KSB7XG4gICAgICAgIH0sXG4gICAgICAgIG9uUmVqZWN0ZWQocmVhc29uLCBmYWlsZWRPcCkge1xuICAgICAgICAgIGlmIChpc1JldHJ5YWJsZVJlYXNvbjIocmVhc29uLCB2b2lkIDApKSB7XG4gICAgICAgICAgICBGYWlsNWBQZW5kaW5nICR7YmFyZTIoZmFpbGVkT3ApfSBjb3VsZCBub3QgcmV0cnk7ICR7cmVhc29ufWA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlV2F0Y2hVdGlsID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgdXRpbHMgfSA9IG1ha2VXYXRjaFV0aWxzS2l0KCk7XG4gICAgcmV0dXJuIGhhcmRlbih1dGlscyk7XG4gIH07XG4gIHJldHVybiBtYWtlV2F0Y2hVdGlsO1xufTtcbmhhcmRlbihwcmVwYXJlV2F0Y2hVdGlscyk7XG5cbi8vXG52YXIgeyBhcHBseTogYXBwbHk3IH0gPSBSZWZsZWN0O1xudmFyIG1ha2VXYXRjaE5leHRTdGVwID0gKHpvbmUpID0+IChcbiAgLypcblxuXG5cblxuXG5cbiAgICovXG4gIChzcGVjaW1lbiwgcHJvbWlzZVdhdGNoZXIpID0+IHtcbiAgICBsZXQgcHJvbWlzZTtcbiAgICBjb25zdCBwYXlsb2FkID0gZ2V0Vm93UGF5bG9hZChzcGVjaW1lbik7XG4gICAgaWYgKHBheWxvYWQpIHtcbiAgICAgIHByb21pc2UgPSBFKHBheWxvYWQudm93VjApLnNob3J0ZW4oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcHJvbWlzZSA9IEUucmVzb2x2ZShzcGVjaW1lbik7XG4gICAgfVxuICAgIHpvbmUud2F0Y2hQcm9taXNlKHByb21pc2UsIHByb21pc2VXYXRjaGVyKTtcbiAgfVxuKTtcbnZhciBzZXR0bGUgPSBhc3luYyAocmVzb2x2ZXIsIHdhdGNoZXIsIHdjYiwgdmFsdWUsIHdhdGNoZXJBcmdzID0gW10pID0+IHtcbiAgYXdhaXQgbnVsbDtcbiAgdHJ5IHtcbiAgICBsZXQgY2hhaW5lZFZhbHVlID0gdmFsdWU7XG4gICAgY29uc3QgdzIgPSB3YXRjaGVyICYmIHdhdGNoZXJbd2NiXTtcbiAgICBpZiAodzIpIHtcbiAgICAgIGNoYWluZWRWYWx1ZSA9IGFwcGx5Nyh3Miwgd2F0Y2hlciwgW3ZhbHVlLCAuLi53YXRjaGVyQXJnc10pO1xuICAgIH0gZWxzZSBpZiAod2NiID09PSBcIm9uUmVqZWN0ZWRcIikge1xuICAgICAgdGhyb3cgdmFsdWU7XG4gICAgfVxuICAgIGlmIChyZXNvbHZlcikge1xuICAgICAgcmVzb2x2ZXIucmVzb2x2ZShjaGFpbmVkVmFsdWUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBhd2FpdCBjaGFpbmVkVmFsdWU7XG4gIH0gY2F0Y2ggKGUyKSB7XG4gICAgaWYgKHJlc29sdmVyKSB7XG4gICAgICByZXNvbHZlci5yZWplY3QoZTIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aHJvdyBlMjtcbiAgfVxufTtcbnZhciBwcmVwYXJlUHJvbWlzZVdhdGNoZXIgPSAoem9uZSwgaXNSZXRyeWFibGVSZWFzb24yLCB3YXRjaE5leHRTdGVwKSA9PiB7XG4gIGNvbnN0IHdhdGNoZXJTZWVuUGF5bG9hZHMgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgZ2V0U2VlblBheWxvYWRzID0gKHdhdGNoZXIpID0+IHtcbiAgICBsZXQgc2VlblBheWxvYWRzID0gd2F0Y2hlclNlZW5QYXlsb2Fkcy5nZXQod2F0Y2hlcik7XG4gICAgaWYgKCFzZWVuUGF5bG9hZHMpIHtcbiAgICAgIHNlZW5QYXlsb2FkcyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xuICAgICAgd2F0Y2hlclNlZW5QYXlsb2Fkcy5zZXQod2F0Y2hlciwgc2VlblBheWxvYWRzKTtcbiAgICB9XG4gICAgcmV0dXJuIHNlZW5QYXlsb2FkcztcbiAgfTtcbiAgcmV0dXJuIHpvbmUuZXhvQ2xhc3MoXG4gICAgXCJQcm9taXNlV2F0Y2hlclwiLFxuICAgIFByb21pc2VXYXRjaGVySSxcbiAgICAvKlxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIChyZXNvbHZlciwgd2F0Y2hlciwgd2F0Y2hlckFyZ3MpID0+IHtcbiAgICAgIGNvbnN0IHN0YXRlID0ge1xuICAgICAgICB2b3c6IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgdm9pZCAwXG4gICAgICAgICksXG4gICAgICAgIHByaW9yUmV0cnlWYWx1ZTogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHZvaWQgMFxuICAgICAgICApLFxuICAgICAgICByZXNvbHZlcixcbiAgICAgICAgd2F0Y2hlcixcbiAgICAgICAgd2F0Y2hlckFyZ3M6IGhhcmRlbih3YXRjaGVyQXJncylcbiAgICAgIH07XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgc3RhdGVcbiAgICAgICk7XG4gICAgfSxcbiAgICB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHsgd2F0Y2hlciwgd2F0Y2hlckFyZ3MsIHJlc29sdmVyIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoIXJlc29sdmVyKSB7XG4gICAgICAgICAgdGhyb3cgRXJyb3IoXCJVbmV4cGVjdGVkIG11bHRpcGxlIGNhbGxzIHRvIFByb21pc2VXYXRjaGVyXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBnZXRWb3dQYXlsb2FkKHZhbHVlKTtcbiAgICAgICAgaWYgKHBheWxvYWQpIHtcbiAgICAgICAgICBjb25zdCBzZWVuUGF5bG9hZHMgPSBnZXRTZWVuUGF5bG9hZHModGhpcy5zZWxmKTtcbiAgICAgICAgICBpZiAoc2VlblBheWxvYWRzLmhhcyhwYXlsb2FkLnZvd1YwKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VsZi5vblJlamVjdGVkKEVycm9yKFwiVm93IHJlc29sdXRpb24gY3ljbGUgZGV0ZWN0ZWRcIikpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzZWVuUGF5bG9hZHMuYWRkKHBheWxvYWQudm93VjApO1xuICAgICAgICAgIHRoaXMuc3RhdGUudm93ID0gdmFsdWU7XG4gICAgICAgICAgd2F0Y2hOZXh0U3RlcCh2YWx1ZSwgdGhpcy5zZWxmKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgd2F0Y2hlclNlZW5QYXlsb2Fkcy5kZWxldGUodGhpcy5zZWxmKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5wcmlvclJldHJ5VmFsdWUgPSB2b2lkIDA7XG4gICAgICAgIHRoaXMuc3RhdGUud2F0Y2hlciA9IHZvaWQgMDtcbiAgICAgICAgdGhpcy5zdGF0ZS5yZXNvbHZlciA9IHZvaWQgMDtcbiAgICAgICAgdm9pZCBzZXR0bGUocmVzb2x2ZXIsIHdhdGNoZXIsIFwib25GdWxmaWxsZWRcIiwgdmFsdWUsIHdhdGNoZXJBcmdzKTtcbiAgICAgIH0sXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgb25SZWplY3RlZChyZWFzb24pIHtcbiAgICAgICAgY29uc3QgeyB2b3csIHdhdGNoZXIsIHdhdGNoZXJBcmdzLCByZXNvbHZlciwgcHJpb3JSZXRyeVZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoIXJlc29sdmVyKSB7XG4gICAgICAgICAgdGhyb3cgRXJyb3IoXCJVbmV4cGVjdGVkIG11bHRpcGxlIGNhbGxzIHRvIFByb21pc2VXYXRjaGVyXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJldHJ5VmFsdWUgPSBpc1JldHJ5YWJsZVJlYXNvbjIocmVhc29uLCBwcmlvclJldHJ5VmFsdWUpO1xuICAgICAgICBpZiAocmV0cnlWYWx1ZSkge1xuICAgICAgICAgIHRoaXMuc3RhdGUucHJpb3JSZXRyeVZhbHVlID0gcmV0cnlWYWx1ZTtcbiAgICAgICAgICBpZiAodm93KSB7XG4gICAgICAgICAgICB3YXRjaE5leHRTdGVwKHZvdywgdGhpcy5zZWxmKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgd2F0Y2hlclNlZW5QYXlsb2Fkcy5kZWxldGUodGhpcy5zZWxmKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5wcmlvclJldHJ5VmFsdWUgPSB2b2lkIDA7XG4gICAgICAgIHRoaXMuc3RhdGUucmVzb2x2ZXIgPSB2b2lkIDA7XG4gICAgICAgIHRoaXMuc3RhdGUud2F0Y2hlciA9IHZvaWQgMDtcbiAgICAgICAgdm9pZCBzZXR0bGUocmVzb2x2ZXIsIHdhdGNoZXIsIFwib25SZWplY3RlZFwiLCByZWFzb24sIHdhdGNoZXJBcmdzKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG59O1xudmFyIHByZXBhcmVXYXRjaCA9ICh6b25lLCBtYWtlVm93S2l0LCBpc1JldHJ5YWJsZVJlYXNvbjIgPSAoX3JlYXNvbiwgX2xhc3RWYWx1ZSkgPT4gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IHdhdGNoTmV4dFN0ZXAgPSBtYWtlV2F0Y2hOZXh0U3RlcCh6b25lKTtcbiAgY29uc3QgbWFrZVByb21pc2VXYXRjaGVyID0gcHJlcGFyZVByb21pc2VXYXRjaGVyKFxuICAgIHpvbmUsXG4gICAgaXNSZXRyeWFibGVSZWFzb24yLFxuICAgIHdhdGNoTmV4dFN0ZXBcbiAgKTtcbiAgY29uc3Qgd2F0Y2ggPSAoc3BlY2ltZW5QLCB3YXRjaGVyLCAuLi53YXRjaGVyQXJncykgPT4ge1xuICAgIGNvbnN0IHsgcmVzb2x2ZXIsIHZvdyB9ID0gbWFrZVZvd0tpdCgpO1xuICAgIGNvbnN0IHByb21pc2VXYXRjaGVyID0gbWFrZVByb21pc2VXYXRjaGVyKHJlc29sdmVyLCB3YXRjaGVyLCB3YXRjaGVyQXJncyk7XG4gICAgY29uc3QgcHJvbWlzZSA9IEUucmVzb2x2ZShzcGVjaW1lblApO1xuICAgIHpvbmUud2F0Y2hQcm9taXNlKHByb21pc2UsIHByb21pc2VXYXRjaGVyKTtcbiAgICByZXR1cm4gdm93O1xuICB9O1xuICBoYXJkZW4od2F0Y2gpO1xuICByZXR1cm4gd2F0Y2g7XG59O1xuaGFyZGVuKHByZXBhcmVXYXRjaCk7XG5cbi8vXG52YXIgbWFrZVVuaGFuZGxlZFJlamVjdGlvbkNhbmNlbGxlciA9IChyZWplY3RlZCwgdXBncmFkZWRQSykgPT4ge1xuICByZXR1cm4gKCkgPT4ge1xuICAgIHJlamVjdGVkPy5jYXRjaChzaW5rKTtcbiAgICB1cGdyYWRlZFBLPy5yZXNvbHZlKCk7XG4gIH07XG59O1xudmFyIHByZXBhcmVWb3dSZWplY3Rpb25UcmFja2VyID0gKHpvbmUpID0+IHtcbiAgY29uc3Qgdm93VG9DYW5jZWxVbmhhbmRsZWRSZWplY3Rpb24gPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgdXBncmFkZVJlamVjdGlvbldhdGNoZXIgPSB6b25lLmV4byhcbiAgICBcIlVwZ3JhZGVSZWplY3Rpb25XYXRjaGVyXCIsXG4gICAgTS5pbnRlcmZhY2UoXCJVcGdyYWRlUmVqZWN0aW9uV2F0Y2hlclwiLCB7XG4gICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5yYXcoKSwgTS5yYXcoKSkucmV0dXJucygpXG4gICAgfSksXG4gICAge1xuICAgICAgb25SZWplY3RlZCh1cGdyYWRlUmVhc29uLCBiYXNlUmVhc29uKSB7XG4gICAgICAgIGNvbnN0IHJlYXNvbiA9IGFzc2VydC5lcnJvcihcbiAgICAgICAgICByZWRhY3RlZGBWT1dfUkVKRUNUSU9OICR7YmFzZVJlYXNvbn0gbm90IGhhbmRsZWQgYmVmb3JlIHVwZ3JhZGUgJHt1cGdyYWRlUmVhc29ufWBcbiAgICAgICAgKTtcbiAgICAgICAgdGhyb3cgcmVhc29uO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3Qgdm93UmVqZWN0aW9uVHJhY2tlciA9IHpvbmUuZXhvKFxuICAgIFwiVm93UmVqZWN0aW9uVHJhY2tlclwiLFxuICAgIE0uaW50ZXJmYWNlKFwiVm93UmVqZWN0aW9uVHJhY2tlclwiLCB7XG4gICAgICBoYW5kbGU6IE0uY2FsbChNLnJlbW90YWJsZSgpKS5yZXR1cm5zKCksXG4gICAgICByZWplY3Q6IE0uY2FsbChNLnJlbW90YWJsZSgpLCBNLnJhdygpKS5yZXR1cm5zKClcbiAgICB9KSxcbiAgICB7XG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIGhhbmRsZSh2b3dDYXApIHtcbiAgICAgICAgY29uc3QgY2FuY2VsID0gdm93VG9DYW5jZWxVbmhhbmRsZWRSZWplY3Rpb24uZ2V0KHZvd0NhcCk7XG4gICAgICAgIGlmICghY2FuY2VsKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgYXNzZXJ0LmVycm9yKFxuICAgICAgICAgICAgICByZWRhY3RlZGBOb3cgaGFuZGxpbmcgYSBWT1dfUkVKRUNUSU9OIGZyb20gYSBwcmlvciBpbmNhcm5hdGlvbiBmb3IgJHt2b3dDYXB9YFxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZvd1RvQ2FuY2VsVW5oYW5kbGVkUmVqZWN0aW9uLmRlbGV0ZSh2b3dDYXApO1xuICAgICAgICBjYW5jZWwoKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgcmVqZWN0KHZvd0NhcCwgcmVhc29uKSB7XG4gICAgICAgIGlmICh2b3dUb0NhbmNlbFVuaGFuZGxlZFJlamVjdGlvbi5oYXModm93Q2FwKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBoYXJkZW4ocmVhc29uKTtcbiAgICAgICAgY29uc3QgYmFzZVJlYXNvbiA9IHpvbmUuaXNTdG9yYWJsZShyZWFzb24pID8gcmVhc29uIDogYXNzZXJ0LmVycm9yKHJlZGFjdGVkYFZvdyByZWplY3Rpb24gcmVhc29uIHdhcyBub3Qgc3RvcmVkOiAke3JlYXNvbn1gKTtcbiAgICAgICAgY29uc3QgdXBncmFkZWRQSyA9IG1ha2VQcm9taXNlS2l0KCk7XG4gICAgICAgIHpvbmUud2F0Y2hQcm9taXNlKFxuICAgICAgICAgIHVwZ3JhZGVkUEsucHJvbWlzZSxcbiAgICAgICAgICB1cGdyYWRlUmVqZWN0aW9uV2F0Y2hlcixcbiAgICAgICAgICBiYXNlUmVhc29uXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHJlamVjdGVkID0gUHJvbWlzZS5yZWplY3QocmVhc29uKTtcbiAgICAgICAgY29uc3QgY2FuY2VsID0gbWFrZVVuaGFuZGxlZFJlamVjdGlvbkNhbmNlbGxlcihyZWplY3RlZCwgdXBncmFkZWRQSyk7XG4gICAgICAgIHZvd1RvQ2FuY2VsVW5oYW5kbGVkUmVqZWN0aW9uLnNldCh2b3dDYXAsIGNhbmNlbCk7XG4gICAgICB9XG4gICAgfVxuICApO1xuICByZXR1cm4gdm93UmVqZWN0aW9uVHJhY2tlcjtcbn07XG5cbi8vXG52YXIgeyBkZWZpbmVQcm9wZXJ0aWVzOiBkZWZpbmVQcm9wZXJ0aWVzNCB9ID0gT2JqZWN0O1xudmFyIFJldHJ5YWJsZUZsb3dJS2l0ID0gaGFyZGVuKHtcbiAgZmxvdzogTS5pbnRlcmZhY2UoXCJGbG93XCIsIHtcbiAgICByZXN0YXJ0OiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gICAgZ2V0T3V0Y29tZTogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSlcbiAgfSksXG4gIHJlc3VsdFdhdGNoZXI6IFByb21pc2VXYXRjaGVySVxufSk7XG52YXIgQWRtaW5SZXRyeWFibGVGbG93SSA9IE0uaW50ZXJmYWNlKFwiUmV0cnlhYmxlRmxvd0FkbWluXCIsIHtcbiAgZ2V0Rmxvd0Zvck91dGNvbWVWb3c6IE0uY2FsbChWb3dTaGFwZSkucmV0dXJucyhNLm9wdChNLnJlbW90YWJsZShcImZsb3dcIikpKVxufSk7XG52YXIgcHJlcGFyZVJldHJ5YWJsZVRvb2xzID0gKG91dGVyWm9uZSwgb3V0ZXJPcHRpb25zKSA9PiB7XG4gIGNvbnN0IHsgbWFrZVZvd0tpdCwgaXNSZXRyeWFibGVSZWFzb246IGlzUmV0cnlhYmxlUmVhc29uMiB9ID0gb3V0ZXJPcHRpb25zO1xuICBjb25zdCBhc1ZvdyA9IG1ha2VBc1ZvdyhtYWtlVm93S2l0KTtcbiAgY29uc3QgZmxvd0Zvck91dGNvbWVWb3dLZXkgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgb3V0ZXJab25lLm1hcFN0b3JlKFwicmV0cnlhYmxlRmxvd0Zvck91dGNvbWVWb3dcIiwge1xuICAgICAga2V5U2hhcGU6IE0ucmVtb3RhYmxlKFwidG9QYXNzYWJsZUNhcFwiKSxcbiAgICAgIHZhbHVlU2hhcGU6IE0ucmVtb3RhYmxlKFwiZmxvd1wiKVxuICAgICAgLy9cbiAgICB9KVxuICApO1xuICBjb25zdCBwcmVwYXJlUmV0cnlhYmxlRmxvd0tpdCA9ICh6b25lLCB0YWcsIHJldHJ5YWJsZUZ1bmMpID0+IHtcbiAgICB0eXBlb2YgcmV0cnlhYmxlRnVuYyA9PT0gXCJmdW5jdGlvblwiIHx8IHRocm93UmVkYWN0ZWRgcmV0cnlhYmxlRnVuYyBtdXN0IGJlIGEgY2FsbGFibGUgZnVuY3Rpb24gJHtyZXRyeWFibGVGdW5jfWA7XG4gICAgY29uc3QgaW50ZXJuYWxNYWtlUmV0cnlhYmxlRmxvd0tpdCA9IHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgICB0YWcsXG4gICAgICBSZXRyeWFibGVGbG93SUtpdCxcbiAgICAgIChhY3RpdmF0aW9uQXJncykgPT4ge1xuICAgICAgICBoYXJkZW4oYWN0aXZhdGlvbkFyZ3MpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFjdGl2YXRpb25BcmdzLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgb3V0Y29tZUtpdDogbWFrZVZvd0tpdCgpLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgbGFzdFJldHJ5UmVhc29uOiB2b2lkIDAsXG4gICAgICAgICAgcnVuczogMG4sXG4gICAgICAgICAgaXNEb25lOiBmYWxzZVxuICAgICAgICAgIC8vXG4gICAgICAgIH07XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBmbG93OiB7XG4gICAgICAgICAgLypcblxuXG4gICAgICAgICAgICovXG4gICAgICAgICAgcmVzdGFydCgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgYWN0aXZhdGlvbkFyZ3MsIGlzRG9uZSB9ID0gc3RhdGU7XG4gICAgICAgICAgICBjb25zdCB7IGZsb3csIHJlc3VsdFdhdGNoZXIgfSA9IGZhY2V0cztcbiAgICAgICAgICAgICFpc0RvbmUgfHwgLy9cbiAgICAgICAgICAgIHRocm93UmVkYWN0ZWRgQ2Fubm90IHJlc3RhcnQgYSBkb25lIHJldHJ5YWJsZSBmbG93ICR7Zmxvd31gO1xuICAgICAgICAgICAgY29uc3QgcnVuSWQgPSBzdGF0ZS5ydW5zICsgMW47XG4gICAgICAgICAgICBzdGF0ZS5ydW5zID0gcnVuSWQ7XG4gICAgICAgICAgICBsZXQgcmVzdWx0UDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIHJlc3VsdFAgPSBQcm9taXNlLnJlc29sdmUocmV0cnlhYmxlRnVuYyguLi5hY3RpdmF0aW9uQXJncykpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgIHJlc3VsdFAgPSBQcm9taXNlLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3V0ZXJab25lLndhdGNoUHJvbWlzZShoYXJkZW4ocmVzdWx0UCksIHJlc3VsdFdhdGNoZXIsIHJ1bklkKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldE91dGNvbWUoKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBvdXRjb21lS2l0IH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIHJldHVybiBvdXRjb21lS2l0LnZvdztcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHJlc3VsdFdhdGNoZXI6IHtcbiAgICAgICAgICBvbkZ1bGZpbGxlZCh2YWx1ZSwgcnVuSWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IHJ1bnMsIG91dGNvbWVLaXQgfSA9IHN0YXRlO1xuICAgICAgICAgICAgaWYgKHJ1bklkICE9PSBydW5zKSByZXR1cm47XG4gICAgICAgICAgICAhc3RhdGUuaXNEb25lIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHJlc29sdmUgYSBkb25lIHJldHJ5YWJsZSBmbG93ICR7dGhpcy5mYWNldHMuZmxvd31gO1xuICAgICAgICAgICAgb3V0Y29tZUtpdC5yZXNvbHZlci5yZXNvbHZlKHZhbHVlKTtcbiAgICAgICAgICAgIGZsb3dGb3JPdXRjb21lVm93S2V5LmRlbGV0ZSh0b1Bhc3NhYmxlQ2FwKG91dGNvbWVLaXQudm93KSk7XG4gICAgICAgICAgICBzdGF0ZS5pc0RvbmUgPSB0cnVlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25SZWplY3RlZChyZWFzb24sIHJ1bklkKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBydW5zLCBvdXRjb21lS2l0IH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIGlmIChydW5JZCAhPT0gcnVucykgcmV0dXJuO1xuICAgICAgICAgICAgIXN0YXRlLmlzRG9uZSB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCByZWplY3QgYSBkb25lIHJldHJ5YWJsZSBmbG93ICR7dGhpcy5mYWNldHMuZmxvd31gO1xuICAgICAgICAgICAgY29uc3QgcmV0cnlSZWFzb24gPSBpc1JldHJ5YWJsZVJlYXNvbjIoXG4gICAgICAgICAgICAgIHJlYXNvbixcbiAgICAgICAgICAgICAgc3RhdGUubGFzdFJldHJ5UmVhc29uXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKHJldHJ5UmVhc29uKSB7XG4gICAgICAgICAgICAgIHN0YXRlLmxhc3RSZXRyeVJlYXNvbiA9IHJldHJ5UmVhc29uO1xuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5mbG93LnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIG91dGNvbWVLaXQucmVzb2x2ZXIucmVqZWN0KHJlYXNvbik7XG4gICAgICAgICAgICAgIGZsb3dGb3JPdXRjb21lVm93S2V5LmRlbGV0ZSh0b1Bhc3NhYmxlQ2FwKG91dGNvbWVLaXQudm93KSk7XG4gICAgICAgICAgICAgIHN0YXRlLmlzRG9uZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgICBjb25zdCBtYWtlUmV0cnlhYmxlRmxvd0tpdCA9IChhY3RpdmF0aW9uQXJncykgPT4ge1xuICAgICAgY29uc3QgcmV0cnlhYmxlS2l0ID0gaW50ZXJuYWxNYWtlUmV0cnlhYmxlRmxvd0tpdChhY3RpdmF0aW9uQXJncyk7XG4gICAgICBjb25zdCB7IGZsb3cgfSA9IHJldHJ5YWJsZUtpdDtcbiAgICAgIGNvbnN0IHZvdyA9IGZsb3cuZ2V0T3V0Y29tZSgpO1xuICAgICAgZmxvd0Zvck91dGNvbWVWb3dLZXkuaW5pdCh0b1Bhc3NhYmxlQ2FwKHZvdyksIGZsb3cpO1xuICAgICAgZmxvdy5yZXN0YXJ0KCk7XG4gICAgICByZXR1cm4gcmV0cnlhYmxlS2l0O1xuICAgIH07XG4gICAgcmV0dXJuIGhhcmRlbihtYWtlUmV0cnlhYmxlRmxvd0tpdCk7XG4gIH07XG4gIGNvbnN0IHJldHJ5YWJsZSA9ICh6b25lLCB0YWcsIHJldHJ5YWJsZUZ1bmMpID0+IHtcbiAgICBjb25zdCBtYWtlUmV0cnlhYmxlS2l0ID0gcHJlcGFyZVJldHJ5YWJsZUZsb3dLaXQoem9uZSwgdGFnLCByZXRyeWFibGVGdW5jKTtcbiAgICBjb25zdCB3cmFwcGVyRnVuY05hbWUgPSBgJHt0YWd9X3JldHJ5YWJsZWA7XG4gICAgY29uc3Qgd3JhcHBlckZ1bmMgPSB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgW3dyYXBwZXJGdW5jTmFtZV0oLi4uYXJncykge1xuICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgIHpvbmUuaXNTdG9yYWJsZShoYXJkZW4oYXJncykpIHx8IHRocm93UmVkYWN0ZWRgcmV0cnlhYmxlIGFyZ3VtZW50cyBtdXN0IGJlIHN0b3JhYmxlICR7YXJnc31gO1xuICAgICAgICAgIGNvbnN0IHsgZmxvdyB9ID0gbWFrZVJldHJ5YWJsZUtpdChhcmdzKTtcbiAgICAgICAgICByZXR1cm4gZmxvdy5nZXRPdXRjb21lKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1bd3JhcHBlckZ1bmNOYW1lXTtcbiAgICBkZWZpbmVQcm9wZXJ0aWVzNCh3cmFwcGVyRnVuYywge1xuICAgICAgbGVuZ3RoOiB7IHZhbHVlOiByZXRyeWFibGVGdW5jLmxlbmd0aCB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGhhcmRlbih3cmFwcGVyRnVuYyk7XG4gIH07XG4gIGNvbnN0IGFkbWluUmV0cnlhYmxlRmxvdyA9IG91dGVyWm9uZS5leG8oXG4gICAgXCJBZG1pblJldHJ5YWJsZUZsb3dcIixcbiAgICBBZG1pblJldHJ5YWJsZUZsb3dJLFxuICAgIHtcbiAgICAgIC8qXG5cbiAgICAgICAqL1xuICAgICAgZ2V0Rmxvd0Zvck91dGNvbWVWb3cob3V0Y29tZVZvdykge1xuICAgICAgICByZXR1cm4gZmxvd0Zvck91dGNvbWVWb3dLZXkuZ2V0KHRvUGFzc2FibGVDYXAob3V0Y29tZVZvdykpO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgcHJlcGFyZVJldHJ5YWJsZUZsb3dLaXQsXG4gICAgYWRtaW5SZXRyeWFibGVGbG93LFxuICAgIHJldHJ5YWJsZVxuICB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZVJldHJ5YWJsZVRvb2xzKTtcblxuLy9cbnZhciBtYWtlV2hlbiA9IChpc1JldHJ5YWJsZVJlYXNvbjIgPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICgoKSA9PiBmYWxzZSlcbikpID0+IHtcbiAgY29uc3QgdW53cmFwID0gYXN5bmMgKHNwZWNpbWVuUCkgPT4ge1xuICAgIGF3YWl0IG51bGw7XG4gICAgbGV0IHJlc3VsdCA9IGF3YWl0IHNwZWNpbWVuUDtcbiAgICBsZXQgcGF5bG9hZCA9IGdldFZvd1BheWxvYWQocmVzdWx0KTtcbiAgICBsZXQgcHJpb3JSZXRyeVZhbHVlO1xuICAgIGNvbnN0IHNlZW5QYXlsb2FkcyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xuICAgIHdoaWxlIChwYXlsb2FkKSB7XG4gICAgICBjb25zdCB7IHZvd1YwIH0gPSBwYXlsb2FkO1xuICAgICAgaWYgKHNlZW5QYXlsb2Fkcy5oYXModm93VjApKSB7XG4gICAgICAgIHRocm93IEVycm9yKFwiVm93IHJlc29sdXRpb24gY3ljbGUgZGV0ZWN0ZWRcIik7XG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBFKHZvd1YwKS5zaG9ydGVuKCk7XG4gICAgICAgIHNlZW5QYXlsb2Fkcy5hZGQodm93VjApO1xuICAgICAgICBwcmlvclJldHJ5VmFsdWUgPSB2b2lkIDA7XG4gICAgICAgIHJlc3VsdCA9IHJlcztcbiAgICAgIH0gY2F0Y2ggKGUyKSB7XG4gICAgICAgIGNvbnN0IG5leHRSZXRyeVZhbHVlID0gaXNSZXRyeWFibGVSZWFzb24yKGUyLCBwcmlvclJldHJ5VmFsdWUpO1xuICAgICAgICBpZiAoIW5leHRSZXRyeVZhbHVlKSB7XG4gICAgICAgICAgdGhyb3cgZTI7XG4gICAgICAgIH1cbiAgICAgICAgcHJpb3JSZXRyeVZhbHVlID0gbmV4dFJldHJ5VmFsdWU7XG4gICAgICB9XG4gICAgICBwYXlsb2FkID0gZ2V0Vm93UGF5bG9hZChyZXN1bHQpO1xuICAgIH1cbiAgICBjb25zdCB1bndyYXBwZWQgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICByZXN1bHRcbiAgICApO1xuICAgIHJldHVybiB1bndyYXBwZWQ7XG4gIH07XG4gIGNvbnN0IHdoZW4gPSAoc3BlY2ltZW5QLCBvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkgPT4ge1xuICAgIGNvbnN0IHVud3JhcHBlZCA9IHVud3JhcChzcGVjaW1lblApO1xuICAgIGlmIChvbkZ1bGZpbGxlZCA9PSBudWxsICYmIG9uUmVqZWN0ZWQgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdW53cmFwcGVkXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gRS5yZXNvbHZlKHVud3JhcHBlZCkudGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCk7XG4gIH07XG4gIGhhcmRlbih3aGVuKTtcbiAgcmV0dXJuIHdoZW47XG59O1xuaGFyZGVuKG1ha2VXaGVuKTtcblxuLy9cbnZhciBwcmVwYXJlQmFzaWNWb3dUb29scyA9ICh6b25lLCBwb3dlcnMgPSB7fSkgPT4ge1xuICBjb25zdCB7IGlzUmV0cnlhYmxlUmVhc29uOiBpc1JldHJ5YWJsZVJlYXNvbjIgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAoKCkgPT4gZmFsc2UpXG4gICkgfSA9IHBvd2VycztcbiAgY29uc3Qgdm93UmVqZWN0aW9uVHJhY2tlciA9IHByZXBhcmVWb3dSZWplY3Rpb25UcmFja2VyKHpvbmUpO1xuICBjb25zdCBtYWtlVm93S2l0ID0gcHJlcGFyZVZvd0tpdCh6b25lLCB2b3dSZWplY3Rpb25UcmFja2VyKTtcbiAgY29uc3Qgd2hlbiA9IG1ha2VXaGVuKGlzUmV0cnlhYmxlUmVhc29uMik7XG4gIGNvbnN0IHdhdGNoID0gcHJlcGFyZVdhdGNoKHpvbmUsIG1ha2VWb3dLaXQsIGlzUmV0cnlhYmxlUmVhc29uMik7XG4gIGNvbnN0IG1ha2VXYXRjaFV0aWxzID0gcHJlcGFyZVdhdGNoVXRpbHMoem9uZSwge1xuICAgIHdhdGNoLFxuICAgIHdoZW4sXG4gICAgbWFrZVZvd0tpdCxcbiAgICBpc1JldHJ5YWJsZVJlYXNvbjogaXNSZXRyeWFibGVSZWFzb24yXG4gIH0pO1xuICBjb25zdCB3YXRjaFV0aWxzID0gbWFrZVdhdGNoVXRpbHMoKTtcbiAgY29uc3QgYXNWb3cgPSBtYWtlQXNWb3cobWFrZVZvd0tpdCk7XG4gIGNvbnN0IHsgcmV0cnlhYmxlIH0gPSBwcmVwYXJlUmV0cnlhYmxlVG9vbHMoem9uZSwge1xuICAgIG1ha2VWb3dLaXQsXG4gICAgaXNSZXRyeWFibGVSZWFzb246IGlzUmV0cnlhYmxlUmVhc29uMlxuICB9KTtcbiAgY29uc3QgYWxsID0gKG1heWJlVm93cykgPT4gd2F0Y2hVdGlscy5hbGwobWF5YmVWb3dzKTtcbiAgY29uc3QgYWxsVm93cyA9IGFsbDtcbiAgY29uc3QgYWxsU2V0dGxlZCA9IChtYXliZVZvd3MpID0+IHdhdGNoVXRpbHMuYWxsU2V0dGxlZChtYXliZVZvd3MpO1xuICBjb25zdCBhc1Byb21pc2UgPSAoc3BlY2ltZW5QLCAuLi53YXRjaGVyQXJncykgPT4gd2F0Y2hVdGlscy5hc1Byb21pc2Uoc3BlY2ltZW5QLCAuLi53YXRjaGVyQXJncyk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIHdoZW4sXG4gICAgd2F0Y2gsXG4gICAgbWFrZVZvd0tpdCxcbiAgICBhbGwsXG4gICAgYWxsVm93cyxcbiAgICBhbGxTZXR0bGVkLFxuICAgIGFzVm93LFxuICAgIGFzUHJvbWlzZSxcbiAgICByZXRyeWFibGUsXG4gICAgcmV0cmlhYmxlOiByZXRyeWFibGVcbiAgICAvL1xuICB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZUJhc2ljVm93VG9vbHMpO1xuXG4vL1xudmFyIGhpZGRlblByaW9yRXJyb3IyO1xudmFyIGhpZGRlbkN1cnJlbnRUdXJuMiA9IDA7XG52YXIgaGlkZGVuQ3VycmVudEV2ZW50MiA9IDA7XG52YXIgVkVSQk9TRTIgPSBlbnZpcm9ubWVudE9wdGlvbnNMaXN0SGFzKFwiREVCVUdcIiwgXCJ0cmFjay10dXJuc1wiKTtcbnZhciBFTkFCTEVEMiA9IGdldEVudmlyb25tZW50T3B0aW9uKFwiVFJBQ0tfVFVSTlNcIiwgXCJkaXNhYmxlZFwiLCBbXCJlbmFibGVkXCJdKSA9PT0gXCJlbmFibGVkXCI7XG52YXIgYWRkUmVqZWN0aW9uTm90ZTIgPSAoZGV0YWlsc05vdGUpID0+IChyZWFzb24pID0+IHtcbiAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgbm90ZShyZWFzb24sIGRldGFpbHNOb3RlKTtcbiAgfVxuICBpZiAoVkVSQk9TRTIpIHtcbiAgICBjb25zb2xlLmxvZyhcIlJFSkVDVEVEIGF0IHRvcCBvZiBldmVudCBsb29wXCIsIHJlYXNvbik7XG4gIH1cbn07XG52YXIgd3JhcEZ1bmN0aW9uMiA9IChmdW5jLCBzZW5kaW5nRXJyb3IpID0+ICguLi5hcmdzKSA9PiB7XG4gIGhpZGRlblByaW9yRXJyb3IyID0gc2VuZGluZ0Vycm9yO1xuICBoaWRkZW5DdXJyZW50VHVybjIgKz0gMTtcbiAgaGlkZGVuQ3VycmVudEV2ZW50MiA9IDA7XG4gIHRyeSB7XG4gICAgbGV0IHJlc3VsdDtcbiAgICB0cnkge1xuICAgICAgcmVzdWx0ID0gZnVuYyguLi5hcmdzKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICBub3RlKFxuICAgICAgICAgIGVycixcbiAgICAgICAgICByZWRhY3RlZGBUaHJvd24gZnJvbTogJHtoaWRkZW5QcmlvckVycm9yMn06JHtoaWRkZW5DdXJyZW50VHVybjJ9LiR7aGlkZGVuQ3VycmVudEV2ZW50Mn1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoVkVSQk9TRTIpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJUSFJPV04gdG8gdG9wIG9mIGV2ZW50IGxvb3BcIiwgZXJyKTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgY29uc3QgZGV0YWlsc05vdGUgPSByZWRhY3RlZGBSZWplY3Rpb24gZnJvbTogJHtoaWRkZW5QcmlvckVycm9yMn06JHtoaWRkZW5DdXJyZW50VHVybjJ9LiR7aGlkZGVuQ3VycmVudEV2ZW50Mn1gO1xuICAgIFByb21pc2UucmVzb2x2ZShyZXN1bHQpLmNhdGNoKGFkZFJlamVjdGlvbk5vdGUyKGRldGFpbHNOb3RlKSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBmaW5hbGx5IHtcbiAgICBoaWRkZW5QcmlvckVycm9yMiA9IHZvaWQgMDtcbiAgfVxufTtcbnZhciB0cmFja1R1cm5zMiA9IChmdW5jcykgPT4ge1xuICBpZiAoIUVOQUJMRUQyIHx8IHR5cGVvZiBnbG9iYWxUaGlzID09PSBcInVuZGVmaW5lZFwiIHx8ICFnbG9iYWxUaGlzLmFzc2VydCkge1xuICAgIHJldHVybiBmdW5jcztcbiAgfVxuICBoaWRkZW5DdXJyZW50RXZlbnQyICs9IDE7XG4gIGNvbnN0IHNlbmRpbmdFcnJvciA9IEVycm9yKFxuICAgIGBFdmVudDogJHtoaWRkZW5DdXJyZW50VHVybjJ9LiR7aGlkZGVuQ3VycmVudEV2ZW50Mn1gXG4gICk7XG4gIGlmIChoaWRkZW5QcmlvckVycm9yMiAhPT0gdm9pZCAwKSB7XG4gICAgbm90ZShzZW5kaW5nRXJyb3IsIHJlZGFjdGVkYENhdXNlZCBieTogJHtoaWRkZW5QcmlvckVycm9yMn1gKTtcbiAgfVxuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgKi9cbiAgICBmdW5jcy5tYXAoKGZ1bmMpID0+IGZ1bmMgJiYgd3JhcEZ1bmN0aW9uMihmdW5jLCBzZW5kaW5nRXJyb3IpKVxuICApO1xufTtcblxuLy9cbnZhciB7IGhhc093bjogaGFzT3duMTEsIGZyZWV6ZTogZnJlZXplOCwgZW50cmllczogZW50cmllczggfSA9IE9iamVjdDtcbnZhciBpc0pTT05SZWNvcmQyID0gKHZhbCkgPT4gdHlwZW9mIHZhbCA9PT0gXCJvYmplY3RcIiAmJiB2YWwgIT09IG51bGwgJiYgIUFycmF5LmlzQXJyYXkodmFsKTtcbnZhciBzaW1wbGlmeVRhZzIgPSAodGFnKSA9PiB7XG4gIGZvciAoY29uc3QgcHJlZml4IG9mIFtcIkFsbGVnZWQ6IFwiLCBcIkRlYnVnTmFtZTogXCJdKSB7XG4gICAgaWYgKHRhZy5zdGFydHNXaXRoKHByZWZpeCkpIHtcbiAgICAgIHJldHVybiB0YWcuc2xpY2UocHJlZml4Lmxlbmd0aCk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0YWc7XG59O1xudmFyIG1ha2VNZXNzYWdlQnJlYWtwb2ludFRlc3RlcjIgPSAob3B0aW9uTmFtZSkgPT4ge1xuICBsZXQgYnJlYWtwb2ludHMgPSBKU09OLnBhcnNlKGdldEVudmlyb25tZW50T3B0aW9uKG9wdGlvbk5hbWUsIFwibnVsbFwiKSk7XG4gIGlmIChicmVha3BvaW50cyA9PT0gbnVsbCkge1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH1cbiAgbGV0IGJyZWFrcG9pbnRzVGFibGU7XG4gIGNvbnN0IGdldEJyZWFrcG9pbnRzID0gKCkgPT4gYnJlYWtwb2ludHM7XG4gIGZyZWV6ZTgoZ2V0QnJlYWtwb2ludHMpO1xuICBjb25zdCBzZXRCcmVha3BvaW50cyA9IChuZXdCcmVha3BvaW50cyA9IGJyZWFrcG9pbnRzKSA9PiB7XG4gICAgaXNKU09OUmVjb3JkMihuZXdCcmVha3BvaW50cykgfHwgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCAke3F1b3RlKG9wdGlvbk5hbWUpfSBvcHRpb24gdG8gYmUgYSBKU09OIGJyZWFrcG9pbnRzIHJlY29yZGA7XG4gICAgY29uc3QgbmV3QnJlYWtwb2ludHNUYWJsZSA9IHsgX19wcm90b19fOiBudWxsIH07XG4gICAgZm9yIChjb25zdCBbdGFnLCBtZXRob2RCUHNdIG9mIGVudHJpZXM4KG5ld0JyZWFrcG9pbnRzKSkge1xuICAgICAgdGFnID09PSBzaW1wbGlmeVRhZzIodGFnKSB8fCB0aHJvd1JlZGFjdGVkYEp1c3QgdXNlIHNpbXBsZSB0YWcgJHtxdW90ZShzaW1wbGlmeVRhZzIodGFnKSl9IHJhdGhlciB0aGFuICR7cXVvdGUodGFnKX1gO1xuICAgICAgaXNKU09OUmVjb3JkMihtZXRob2RCUHMpIHx8IHRocm93UmVkYWN0ZWRgRXhwZWN0ZWQgJHtxdW90ZShvcHRpb25OYW1lKX0gb3B0aW9uJ3MgJHtxdW90ZShcbiAgICAgICAgdGFnXG4gICAgICApfSB0byBiZSBhIEpTT04gbWV0aG9kcyBicmVha3BvaW50cyByZWNvcmRgO1xuICAgICAgZm9yIChjb25zdCBbbWV0aG9kTmFtZSwgY291bnRdIG9mIGVudHJpZXM4KG1ldGhvZEJQcykpIHtcbiAgICAgICAgY291bnQgPT09IFwiKlwiIHx8IHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiAmJiBOdW1iZXIuaXNTYWZlSW50ZWdlcihjb3VudCkgJiYgY291bnQgPj0gMCB8fCB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkICR7cXVvdGUob3B0aW9uTmFtZSl9IG9wdGlvbidzICR7cXVvdGUodGFnKX0uJHtxdW90ZShcbiAgICAgICAgICBtZXRob2ROYW1lXG4gICAgICAgICl9IHRvIGJlIFwiKlwiIG9yIGEgbm9uLW5lZ2F0aXZlIGludGVnZXJgO1xuICAgICAgICBjb25zdCBjbGFzc0JQcyA9IGhhc093bjExKG5ld0JyZWFrcG9pbnRzVGFibGUsIG1ldGhvZE5hbWUpID8gbmV3QnJlYWtwb2ludHNUYWJsZVttZXRob2ROYW1lXSA6IG5ld0JyZWFrcG9pbnRzVGFibGVbbWV0aG9kTmFtZV0gPSB7XG4gICAgICAgICAgLy9cbiAgICAgICAgICBfX3Byb3RvX186IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgY2xhc3NCUHNbdGFnXSA9IGNvdW50O1xuICAgICAgfVxuICAgIH1cbiAgICBicmVha3BvaW50cyA9IG5ld0JyZWFrcG9pbnRzO1xuICAgIGJyZWFrcG9pbnRzVGFibGUgPSBuZXdCcmVha3BvaW50c1RhYmxlO1xuICB9O1xuICBmcmVlemU4KHNldEJyZWFrcG9pbnRzKTtcbiAgY29uc3Qgc2hvdWxkQnJlYWtwb2ludCA9IChyZWNpcGllbnQsIG1ldGhvZE5hbWUpID0+IHtcbiAgICBpZiAobWV0aG9kTmFtZSA9PT0gdm9pZCAwIHx8IG1ldGhvZE5hbWUgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgY2xhc3NCUHMgPSBicmVha3BvaW50c1RhYmxlW21ldGhvZE5hbWVdIHx8IGJyZWFrcG9pbnRzVGFibGVbXCIqXCJdO1xuICAgIGlmIChjbGFzc0JQcyA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGxldCB0YWcgPSBzaW1wbGlmeVRhZzIocmVjaXBpZW50W1N5bWJvbC50b1N0cmluZ1RhZ10pO1xuICAgIGxldCBjb3VudCA9IGNsYXNzQlBzW3RhZ107XG4gICAgaWYgKGNvdW50ID09PSB2b2lkIDApIHtcbiAgICAgIHRhZyA9IFwiKlwiO1xuICAgICAgY291bnQgPSBjbGFzc0JQc1t0YWddO1xuICAgICAgaWYgKGNvdW50ID09PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoY291bnQgPT09IFwiKlwiKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGNvdW50ID09PSAwKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgYXNzZXJ0KHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiAmJiBjb3VudCA+PSAxKTtcbiAgICBjbGFzc0JQc1t0YWddID0gY291bnQgLSAxO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgZnJlZXplOChzaG91bGRCcmVha3BvaW50KTtcbiAgY29uc3QgYnJlYWtwb2ludFRlc3RlciA9IGZyZWV6ZTgoe1xuICAgIGdldEJyZWFrcG9pbnRzLFxuICAgIHNldEJyZWFrcG9pbnRzLFxuICAgIHNob3VsZEJyZWFrcG9pbnRcbiAgfSk7XG4gIGJyZWFrcG9pbnRUZXN0ZXIuc2V0QnJlYWtwb2ludHMoKTtcbiAgcmV0dXJuIGJyZWFrcG9pbnRUZXN0ZXI7XG59O1xuZnJlZXplOChtYWtlTWVzc2FnZUJyZWFrcG9pbnRUZXN0ZXIyKTtcblxuLy9cbnZhciB7IGFzc2lnbjogYXNzaWduMiwgY3JlYXRlOiBjcmVhdGU0IH0gPSBPYmplY3Q7XG52YXIgb25TZW5kMiA9IG1ha2VNZXNzYWdlQnJlYWtwb2ludFRlc3RlcjIoXCJFTkRPX1NFTkRfQlJFQUtQT0lOVFNcIik7XG52YXIgYmFzZUZyZWV6YWJsZVByb3h5SGFuZGxlcjIgPSB7XG4gIHNldChfdGFyZ2V0LCBfcHJvcCwgX3ZhbHVlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBpc0V4dGVuc2libGUoX3RhcmdldCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbiAgc2V0UHJvdG90eXBlT2YoX3RhcmdldCwgX3ZhbHVlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBkZWxldGVQcm9wZXJ0eShfdGFyZ2V0LCBfcHJvcCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcbnZhciBtYWtlRVByb3h5SGFuZGxlcjIgPSAocmVjaXBpZW50LCBIYW5kbGVkUHJvbWlzZTIsIHVud3JhcCkgPT4gaGFyZGVuKHtcbiAgLi4uYmFzZUZyZWV6YWJsZVByb3h5SGFuZGxlcjIsXG4gIGdldDogKF90YXJnZXQsIHByb3BlcnR5S2V5LCByZWNlaXZlcikgPT4ge1xuICAgIHJldHVybiBoYXJkZW4oXG4gICAgICB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgW3Byb3BlcnR5S2V5XSguLi5hcmdzKSB7XG4gICAgICAgICAgaWYgKHRoaXMgIT09IHJlY2VpdmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gSGFuZGxlZFByb21pc2UyLnJlamVjdChcbiAgICAgICAgICAgICAgbWFrZUVycm9yKFxuICAgICAgICAgICAgICAgIHJlZGFjdGVkYFVuZXhwZWN0ZWQgcmVjZWl2ZXIgZm9yIFwiJHtxdW90ZShwcm9wZXJ0eUtleSl9XCIgbWV0aG9kIG9mIEUoJHtxdW90ZShcbiAgICAgICAgICAgICAgICAgIHJlY2lwaWVudFxuICAgICAgICAgICAgICAgICl9KWBcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG9uU2VuZDIgJiYgb25TZW5kMi5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgcHJvcGVydHlLZXkpKSB7XG4gICAgICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHVud3JhcChcbiAgICAgICAgICAgIEhhbmRsZWRQcm9taXNlMi5hcHBseU1ldGhvZCh1bndyYXAocmVjaXBpZW50KSwgcHJvcGVydHlLZXksIGFyZ3MpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICAvL1xuICAgICAgfVtwcm9wZXJ0eUtleV1cbiAgICApO1xuICB9LFxuICBhcHBseTogKF90YXJnZXQsIF90aGlzQXJnLCBhcmdBcnJheSA9IFtdKSA9PiB7XG4gICAgaWYgKG9uU2VuZDIgJiYgb25TZW5kMi5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgdm9pZCAwKSkge1xuICAgICAgZGVidWdnZXI7XG4gICAgfVxuICAgIHJldHVybiB1bndyYXAoSGFuZGxlZFByb21pc2UyLmFwcGx5RnVuY3Rpb24odW53cmFwKHJlY2lwaWVudCksIGFyZ0FycmF5KSk7XG4gIH0sXG4gIGhhczogKF90YXJnZXQsIF9wKSA9PiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn0pO1xudmFyIG1ha2VFU2VuZE9ubHlQcm94eUhhbmRsZXIyID0gKHJlY2lwaWVudCwgSGFuZGxlZFByb21pc2UyLCB1bndyYXApID0+IGhhcmRlbih7XG4gIC4uLmJhc2VGcmVlemFibGVQcm94eUhhbmRsZXIyLFxuICBnZXQ6IChfdGFyZ2V0LCBwcm9wZXJ0eUtleSwgcmVjZWl2ZXIpID0+IHtcbiAgICByZXR1cm4gaGFyZGVuKFxuICAgICAge1xuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIFtwcm9wZXJ0eUtleV0oLi4uYXJncykge1xuICAgICAgICAgIHRoaXMgPT09IHJlY2VpdmVyIHx8IHRocm93UmVkYWN0ZWRgVW5leHBlY3RlZCByZWNlaXZlciBmb3IgXCIke3F1b3RlKFxuICAgICAgICAgICAgcHJvcGVydHlLZXlcbiAgICAgICAgICApfVwiIG1ldGhvZCBvZiBFLnNlbmRPbmx5KCR7cXVvdGUocmVjaXBpZW50KX0pYDtcbiAgICAgICAgICBpZiAob25TZW5kMiAmJiBvblNlbmQyLnNob3VsZEJyZWFrcG9pbnQocmVjaXBpZW50LCBwcm9wZXJ0eUtleSkpIHtcbiAgICAgICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICAgIH1cbiAgICAgICAgICBIYW5kbGVkUHJvbWlzZTIuYXBwbHlNZXRob2RTZW5kT25seShcbiAgICAgICAgICAgIHVud3JhcChyZWNpcGllbnQpLFxuICAgICAgICAgICAgcHJvcGVydHlLZXksXG4gICAgICAgICAgICBhcmdzXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICB9XG4gICAgICAgIC8vXG4gICAgICB9W3Byb3BlcnR5S2V5XVxuICAgICk7XG4gIH0sXG4gIGFwcGx5OiAoX3RhcmdldCwgX3RoaXNBcmcsIGFyZ3NBcnJheSA9IFtdKSA9PiB7XG4gICAgaWYgKG9uU2VuZDIgJiYgb25TZW5kMi5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgdm9pZCAwKSkge1xuICAgICAgZGVidWdnZXI7XG4gICAgfVxuICAgIEhhbmRsZWRQcm9taXNlMi5hcHBseUZ1bmN0aW9uU2VuZE9ubHkodW53cmFwKHJlY2lwaWVudCksIGFyZ3NBcnJheSk7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfSxcbiAgaGFzOiAoX3RhcmdldCwgX3ApID0+IHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufSk7XG52YXIgbWFrZUVHZXRQcm94eUhhbmRsZXIyID0gKHgsIEhhbmRsZWRQcm9taXNlMiwgdW53cmFwKSA9PiBoYXJkZW4oe1xuICAuLi5iYXNlRnJlZXphYmxlUHJveHlIYW5kbGVyMixcbiAgaGFzOiAoX3RhcmdldCwgX3Byb3ApID0+IHRydWUsXG4gIGdldDogKF90YXJnZXQsIHByb3ApID0+IEhhbmRsZWRQcm9taXNlMi5nZXQodW53cmFwKHgpLCBwcm9wKVxufSk7XG52YXIgcmVzb2x2ZSA9ICh4KSA9PiBIYW5kbGVkUHJvbWlzZS5yZXNvbHZlKHgpO1xudmFyIG1ha2VFMiA9IChIYW5kbGVkUHJvbWlzZTIsIHBvd2VycyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBhZGRpdGlvbmFsID0gKFxuICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAge31cbiAgICApLFxuICAgIHVud3JhcCA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgcmVzb2x2ZVxuICAgIClcbiAgfSA9IHBvd2VycztcbiAgcmV0dXJuIGhhcmRlbihcbiAgICBhc3NpZ24yKFxuICAgICAgLypcblxuXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICAoeCkgPT4gaGFyZGVuKFxuICAgICAgICBuZXcgUHJveHkoKCkgPT4ge1xuICAgICAgICB9LCBtYWtlRVByb3h5SGFuZGxlcjIoeCwgSGFuZGxlZFByb21pc2UyLCB1bndyYXApKVxuICAgICAgKSxcbiAgICAgIHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGdldDogKHgpID0+IGhhcmRlbihcbiAgICAgICAgICBuZXcgUHJveHkoXG4gICAgICAgICAgICBjcmVhdGU0KG51bGwpLFxuICAgICAgICAgICAgbWFrZUVHZXRQcm94eUhhbmRsZXIyKHgsIEhhbmRsZWRQcm9taXNlMiwgdW53cmFwKVxuICAgICAgICAgIClcbiAgICAgICAgKSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgcmVzb2x2ZTogKHgpID0+IHJlc29sdmUodW53cmFwKHgpKSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgc2VuZE9ubHk6ICh4KSA9PiBoYXJkZW4oXG4gICAgICAgICAgbmV3IFByb3h5KFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1ha2VFU2VuZE9ubHlQcm94eUhhbmRsZXIyKHgsIEhhbmRsZWRQcm9taXNlMiwgdW53cmFwKVxuICAgICAgICAgIClcbiAgICAgICAgKSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICB3aGVuOiAoeCwgb25mdWxmaWxsZWQsIG9ucmVqZWN0ZWQpID0+IHtcbiAgICAgICAgICBjb25zdCB1bndyYXBwZWQgPSByZXNvbHZlKHVud3JhcCh4KSk7XG4gICAgICAgICAgaWYgKG9uZnVsZmlsbGVkID09IG51bGwgJiYgb25yZWplY3RlZCA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gdW53cmFwcGVkO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdW53cmFwcGVkLnRoZW4oXG4gICAgICAgICAgICAuLi50cmFja1R1cm5zMihcbiAgICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgW29uZnVsZmlsbGVkLCBvbnJlamVjdGVkXVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBhZGRpdGlvbmFsXG4gICAgKVxuICApO1xufTtcbnZhciBFX2RlZmF1bHQyID0gbWFrZUUyO1xuXG4vL1xudmFyIGlzUmV0cnlhYmxlUmVhc29uID0gKHJlYXNvbiwgcHJpb3JSZXRyeVZhbHVlKSA9PiB7XG4gIGlmIChpc1VwZ3JhZGVEaXNjb25uZWN0aW9uKHJlYXNvbikgJiYgKCFpc1VwZ3JhZGVEaXNjb25uZWN0aW9uKHByaW9yUmV0cnlWYWx1ZSkgfHwgcmVhc29uLmluY2FybmF0aW9uTnVtYmVyID4gcHJpb3JSZXRyeVZhbHVlLmluY2FybmF0aW9uTnVtYmVyKSkge1xuICAgIHJldHVybiByZWFzb247XG4gIH1cbiAgaWYgKGlzQWJhbmRvbmVkRXJyb3IocmVhc29uKSAmJiAhaXNBYmFuZG9uZWRFcnJvcihwcmlvclJldHJ5VmFsdWUpKSB7XG4gICAgcmV0dXJuIHJlYXNvbjtcbiAgfVxuICByZXR1cm4gdm9pZCAwO1xufTtcbnZhciBkZWZhdWx0UG93ZXJzID0gaGFyZGVuKHtcbiAgaXNSZXRyeWFibGVSZWFzb25cbn0pO1xudmFyIHByZXBhcmVTd2luZ3NldFZvd1Rvb2xzID0gKHpvbmUsIHBvd2VycyA9IHt9KSA9PiBwcmVwYXJlQmFzaWNWb3dUb29scyh6b25lLCB7IC4uLmRlZmF1bHRQb3dlcnMsIC4uLnBvd2VycyB9KTtcbmhhcmRlbihwcmVwYXJlU3dpbmdzZXRWb3dUb29scyk7XG52YXIgaGVhcFZvd1Rvb2xzID0gcHJlcGFyZVN3aW5nc2V0Vm93VG9vbHMobWFrZUhlYXBab25lKCkpO1xudmFyIGhlYXBWb3dFID0gRV9kZWZhdWx0MihnbG9iYWxUaGlzLkhhbmRsZWRQcm9taXNlLCB7XG4gIHVud3JhcDogaGVhcFZvd1Rvb2xzLndoZW4sXG4gIGFkZGl0aW9uYWw6IHsgd2hlbjogaGVhcFZvd1Rvb2xzLndoZW4gfVxufSk7XG5cbi8vXG52YXIgQnJhbmRTaGFwZSA9IE0ucmVtb3RhYmxlKFwiQnJhbmRcIik7XG52YXIgSXNzdWVyU2hhcGUgPSBNLnJlbW90YWJsZShcIklzc3VlclwiKTtcbnZhciBQYXltZW50U2hhcGUgPSBNLnJlbW90YWJsZShcIlBheW1lbnRcIik7XG52YXIgUHVyc2VTaGFwZSA9IE0ucmVtb3RhYmxlKFwiUHVyc2VcIik7XG52YXIgRGVwb3NpdEZhY2V0U2hhcGUgPSBNLnJlbW90YWJsZShcIkRlcG9zaXRGYWNldFwiKTtcbnZhciBOb3RpZmllclNoYXBlID0gTS5yZW1vdGFibGUoXCJOb3RpZmllclwiKTtcbnZhciBNaW50U2hhcGUgPSBNLnJlbW90YWJsZShcIk1pbnRcIik7XG52YXIgTmF0VmFsdWVTaGFwZSA9IE0ubmF0KCk7XG52YXIgQ29weVNldFZhbHVlU2hhcGUgPSBNLnNldCgpO1xudmFyIFNldFZhbHVlU2hhcGUgPSBNLmFycmF5T2YoTS5rZXkoKSk7XG52YXIgQ29weUJhZ1ZhbHVlU2hhcGUgPSBNLmJhZygpO1xudmFyIEFtb3VudFZhbHVlU2hhcGUgPSBNLm9yKFxuICBOYXRWYWx1ZVNoYXBlLFxuICBDb3B5U2V0VmFsdWVTaGFwZSxcbiAgU2V0VmFsdWVTaGFwZSxcbiAgQ29weUJhZ1ZhbHVlU2hhcGVcbik7XG52YXIgQW1vdW50U2hhcGUgPSB7IGJyYW5kOiBCcmFuZFNoYXBlLCB2YWx1ZTogQW1vdW50VmFsdWVTaGFwZSB9O1xuaGFyZGVuKEFtb3VudFNoYXBlKTtcbnZhciBBbW91bnRQYXR0ZXJuU2hhcGUgPSBNLnBhdHRlcm4oKTtcbnZhciBSYXRpb1NoYXBlID0geyBudW1lcmF0b3I6IEFtb3VudFNoYXBlLCBkZW5vbWluYXRvcjogQW1vdW50U2hhcGUgfTtcbmhhcmRlbihSYXRpb1NoYXBlKTtcbnZhciBpc05hdFZhbHVlID0gKHZhbHVlKSA9PiBtYXRjaGVzKHZhbHVlLCBOYXRWYWx1ZVNoYXBlKTtcbmhhcmRlbihpc05hdFZhbHVlKTtcbnZhciBpc0NvcHlTZXRWYWx1ZSA9ICh2YWx1ZSkgPT4gbWF0Y2hlcyh2YWx1ZSwgQ29weVNldFZhbHVlU2hhcGUpO1xuaGFyZGVuKGlzQ29weVNldFZhbHVlKTtcbnZhciBpc1NldFZhbHVlID0gKHZhbHVlKSA9PiBtYXRjaGVzKHZhbHVlLCBTZXRWYWx1ZVNoYXBlKTtcbmhhcmRlbihpc1NldFZhbHVlKTtcbnZhciBpc0NvcHlCYWdWYWx1ZSA9ICh2YWx1ZSkgPT4gbWF0Y2hlcyh2YWx1ZSwgQ29weUJhZ1ZhbHVlU2hhcGUpO1xuaGFyZGVuKGlzQ29weUJhZ1ZhbHVlKTtcbnZhciBNQVhfQUJTT0xVVEVfREVDSU1BTF9QTEFDRVMgPSAxMDA7XG52YXIgQXNzZXRLaW5kU2hhcGUgPSBNLm9yKFwibmF0XCIsIFwic2V0XCIsIFwiY29weVNldFwiLCBcImNvcHlCYWdcIik7XG52YXIgRGlzcGxheUluZm9TaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHt9LFxuICB7XG4gICAgZGVjaW1hbFBsYWNlczogTS5hbmQoXG4gICAgICBNLmd0ZSgtTUFYX0FCU09MVVRFX0RFQ0lNQUxfUExBQ0VTKSxcbiAgICAgIE0ubHRlKE1BWF9BQlNPTFVURV9ERUNJTUFMX1BMQUNFUylcbiAgICApLFxuICAgIGFzc2V0S2luZDogQXNzZXRLaW5kU2hhcGVcbiAgfSxcbiAge1xuICAgIC8vXG4gICAgLy9cbiAgfVxuKTtcbnZhciBJc3N1ZXJLaXRTaGFwZSA9IHtcbiAgYnJhbmQ6IEJyYW5kU2hhcGUsXG4gIG1pbnQ6IE1pbnRTaGFwZSxcbiAgbWludFJlY292ZXJ5UHVyc2U6IFB1cnNlU2hhcGUsXG4gIGlzc3VlcjogSXNzdWVyU2hhcGUsXG4gIGRpc3BsYXlJbmZvOiBEaXNwbGF5SW5mb1NoYXBlXG59O1xuaGFyZGVuKElzc3VlcktpdFNoYXBlKTtcbnZhciBCcmFuZEkgPSBNLmludGVyZmFjZShcIkJyYW5kXCIsIHtcbiAgaXNNeUlzc3VlcjogTS5jYWxsV2hlbihNLmF3YWl0KElzc3VlclNoYXBlKSkucmV0dXJucyhNLmJvb2xlYW4oKSksXG4gIGdldEFsbGVnZWROYW1lOiBNLmNhbGwoKS5yZXR1cm5zKE0uc3RyaW5nKCkpLFxuICBnZXREaXNwbGF5SW5mbzogTS5jYWxsKCkucmV0dXJucyhEaXNwbGF5SW5mb1NoYXBlKSxcbiAgZ2V0QW1vdW50U2hhcGU6IE0uY2FsbCgpLnJldHVybnMoTS5wYXR0ZXJuKCkpXG59KTtcbnZhciBtYWtlSXNzdWVySW50ZXJmYWNlcyA9IChicmFuZFNoYXBlID0gQnJhbmRTaGFwZSwgYXNzZXRLaW5kU2hhcGUgPSBBc3NldEtpbmRTaGFwZSwgYW1vdW50U2hhcGUgPSBBbW91bnRTaGFwZSkgPT4ge1xuICBjb25zdCBJc3N1ZXJJID0gTS5pbnRlcmZhY2UoXCJJc3N1ZXJcIiwge1xuICAgIGdldEJyYW5kOiBNLmNhbGwoKS5yZXR1cm5zKGJyYW5kU2hhcGUpLFxuICAgIGdldEFsbGVnZWROYW1lOiBNLmNhbGwoKS5yZXR1cm5zKE0uc3RyaW5nKCkpLFxuICAgIGdldEFzc2V0S2luZDogTS5jYWxsKCkucmV0dXJucyhhc3NldEtpbmRTaGFwZSksXG4gICAgZ2V0RGlzcGxheUluZm86IE0uY2FsbCgpLnJldHVybnMoRGlzcGxheUluZm9TaGFwZSksXG4gICAgbWFrZUVtcHR5UHVyc2U6IE0uY2FsbCgpLnJldHVybnMoUHVyc2VTaGFwZSksXG4gICAgaXNMaXZlOiBNLmNhbGxXaGVuKE0uYXdhaXQoUGF5bWVudFNoYXBlKSkucmV0dXJucyhNLmJvb2xlYW4oKSksXG4gICAgZ2V0QW1vdW50T2Y6IE0uY2FsbFdoZW4oTS5hd2FpdChQYXltZW50U2hhcGUpKS5yZXR1cm5zKGFtb3VudFNoYXBlKSxcbiAgICBidXJuOiBNLmNhbGxXaGVuKE0uYXdhaXQoUGF5bWVudFNoYXBlKSkub3B0aW9uYWwoQW1vdW50UGF0dGVyblNoYXBlKS5yZXR1cm5zKGFtb3VudFNoYXBlKVxuICB9KTtcbiAgY29uc3QgTWludEkgPSBNLmludGVyZmFjZShcIk1pbnRcIiwge1xuICAgIGdldElzc3VlcjogTS5jYWxsKCkucmV0dXJucyhJc3N1ZXJTaGFwZSksXG4gICAgbWludFBheW1lbnQ6IE0uY2FsbChhbW91bnRTaGFwZSkucmV0dXJucyhQYXltZW50U2hhcGUpXG4gIH0pO1xuICBjb25zdCBQYXltZW50SSA9IE0uaW50ZXJmYWNlKFwiUGF5bWVudFwiLCB7XG4gICAgZ2V0QWxsZWdlZEJyYW5kOiBNLmNhbGwoKS5yZXR1cm5zKGJyYW5kU2hhcGUpXG4gIH0pO1xuICBjb25zdCBQdXJzZUkgPSBNLmludGVyZmFjZShcIlB1cnNlXCIsIHtcbiAgICBnZXRBbGxlZ2VkQnJhbmQ6IE0uY2FsbCgpLnJldHVybnMoYnJhbmRTaGFwZSksXG4gICAgZ2V0Q3VycmVudEFtb3VudDogTS5jYWxsKCkucmV0dXJucyhhbW91bnRTaGFwZSksXG4gICAgZ2V0Q3VycmVudEFtb3VudE5vdGlmaWVyOiBNLmNhbGwoKS5yZXR1cm5zKE5vdGlmaWVyU2hhcGUpLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgZGVwb3NpdDogTS5jYWxsKFBheW1lbnRTaGFwZSkub3B0aW9uYWwoQW1vdW50UGF0dGVyblNoYXBlKS5yZXR1cm5zKGFtb3VudFNoYXBlKSxcbiAgICBnZXREZXBvc2l0RmFjZXQ6IE0uY2FsbCgpLnJldHVybnMoRGVwb3NpdEZhY2V0U2hhcGUpLFxuICAgIHdpdGhkcmF3OiBNLmNhbGwoYW1vdW50U2hhcGUpLnJldHVybnMoUGF5bWVudFNoYXBlKSxcbiAgICBnZXRSZWNvdmVyeVNldDogTS5jYWxsKCkucmV0dXJucyhNLnNldE9mKFBheW1lbnRTaGFwZSkpLFxuICAgIHJlY292ZXJBbGw6IE0uY2FsbCgpLnJldHVybnMoYW1vdW50U2hhcGUpXG4gIH0pO1xuICBjb25zdCBEZXBvc2l0RmFjZXRJID0gTS5pbnRlcmZhY2UoXCJEZXBvc2l0RmFjZXRcIiwge1xuICAgIHJlY2VpdmU6IGdldEludGVyZmFjZUd1YXJkUGF5bG9hZChQdXJzZUkpLm1ldGhvZEd1YXJkcy5kZXBvc2l0XG4gIH0pO1xuICBjb25zdCBQdXJzZUlLaXQgPSB7XG4gICAgcHVyc2U6IFB1cnNlSSxcbiAgICBkZXBvc2l0RmFjZXQ6IERlcG9zaXRGYWNldElcbiAgfTtcbiAgaGFyZGVuKFB1cnNlSUtpdCk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIElzc3VlckksXG4gICAgTWludEksXG4gICAgUGF5bWVudEksXG4gICAgUHVyc2VJS2l0XG4gIH0pO1xufTtcbmhhcmRlbihtYWtlSXNzdWVySW50ZXJmYWNlcyk7XG5cbi8vXG52YXIgeyBmcmVlemU6IGZyZWV6ZTkgfSA9IE9iamVjdDtcbnZhciBwYWRkaW5nID0gXCI9XCI7XG52YXIgYWxwaGFiZXQ2NCA9IFwiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrL1wiO1xudmFyIG1vbm9kdTY0ID0ge307XG5mb3IgKGxldCBpMiA9IDA7IGkyIDwgYWxwaGFiZXQ2NC5sZW5ndGg7IGkyICs9IDEpIHtcbiAgY29uc3QgYzIgPSBhbHBoYWJldDY0W2kyXTtcbiAgbW9ub2R1NjRbYzJdID0gaTI7XG59XG5mcmVlemU5KG1vbm9kdTY0KTtcblxuLy9cbnZhciBqc0VuY29kZUJhc2U2NCA9IChkYXRhKSA9PiB7XG4gIGxldCBzdHJpbmcgPSBcIlwiO1xuICBsZXQgcmVnaXN0ZXIgPSAwO1xuICBsZXQgcXVhbnR1bSA9IDA7XG4gIGZvciAobGV0IGkyID0gMDsgaTIgPCBkYXRhLmxlbmd0aDsgaTIgKz0gMSkge1xuICAgIGNvbnN0IGIzID0gZGF0YVtpMl07XG4gICAgcmVnaXN0ZXIgPSByZWdpc3RlciA8PCA4IHwgYjM7XG4gICAgcXVhbnR1bSArPSA4O1xuICAgIGlmIChxdWFudHVtID09PSAyNCkge1xuICAgICAgc3RyaW5nICs9IGFscGhhYmV0NjRbcmVnaXN0ZXIgPj4+IDE4ICYgNjNdICsgYWxwaGFiZXQ2NFtyZWdpc3RlciA+Pj4gMTIgJiA2M10gKyBhbHBoYWJldDY0W3JlZ2lzdGVyID4+PiA2ICYgNjNdICsgYWxwaGFiZXQ2NFtyZWdpc3RlciA+Pj4gMCAmIDYzXTtcbiAgICAgIHJlZ2lzdGVyID0gMDtcbiAgICAgIHF1YW50dW0gPSAwO1xuICAgIH1cbiAgfVxuICBzd2l0Y2ggKHF1YW50dW0pIHtcbiAgICBjYXNlIDA6XG4gICAgICBicmVhaztcbiAgICBjYXNlIDg6XG4gICAgICBzdHJpbmcgKz0gYWxwaGFiZXQ2NFtyZWdpc3RlciA+Pj4gMiAmIDYzXSArIGFscGhhYmV0NjRbcmVnaXN0ZXIgPDwgNCAmIDYzXSArIHBhZGRpbmcgKyBwYWRkaW5nO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAxNjpcbiAgICAgIHN0cmluZyArPSBhbHBoYWJldDY0W3JlZ2lzdGVyID4+PiAxMCAmIDYzXSArIGFscGhhYmV0NjRbcmVnaXN0ZXIgPj4+IDQgJiA2M10gKyBhbHBoYWJldDY0W3JlZ2lzdGVyIDw8IDIgJiA2M10gKyBwYWRkaW5nO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IEVycm9yKGBpbnRlcm5hbDogYmFkIHF1YW50dW0gJHtxdWFudHVtfWApO1xuICB9XG4gIHJldHVybiBzdHJpbmc7XG59O1xudmFyIGVuY29kZUJhc2U2NCA9IGdsb2JhbFRoaXMuQmFzZTY0ICE9PSB2b2lkIDAgPyBnbG9iYWxUaGlzLkJhc2U2NC5lbmNvZGUgOiBqc0VuY29kZUJhc2U2NDtcblxuLy9cbnZhciBqc0RlY29kZUJhc2U2NCA9IChzdHJpbmcsIG5hbWUgPSBcIjx1bmtub3duPlwiKSA9PiB7XG4gIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShNYXRoLmNlaWwoc3RyaW5nLmxlbmd0aCAqIDQgLyAzKSk7XG4gIGxldCByZWdpc3RlciA9IDA7XG4gIGxldCBxdWFudHVtID0gMDtcbiAgbGV0IGkyID0gMDtcbiAgbGV0IGogPSAwO1xuICB3aGlsZSAoaTIgPCBzdHJpbmcubGVuZ3RoICYmIHN0cmluZ1tpMl0gIT09IHBhZGRpbmcpIHtcbiAgICBjb25zdCBudW1iZXIgPSBtb25vZHU2NFtzdHJpbmdbaTJdXTtcbiAgICBpZiAobnVtYmVyID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IEVycm9yKGBJbnZhbGlkIGJhc2U2NCBjaGFyYWN0ZXIgJHtzdHJpbmdbaTJdfSBpbiBzdHJpbmcgJHtuYW1lfWApO1xuICAgIH1cbiAgICByZWdpc3RlciA9IHJlZ2lzdGVyIDw8IDYgfCBudW1iZXI7XG4gICAgcXVhbnR1bSArPSA2O1xuICAgIGlmIChxdWFudHVtID49IDgpIHtcbiAgICAgIHF1YW50dW0gLT0gODtcbiAgICAgIGRhdGFbal0gPSByZWdpc3RlciA+Pj4gcXVhbnR1bTtcbiAgICAgIGogKz0gMTtcbiAgICAgIHJlZ2lzdGVyICY9ICgxIDw8IHF1YW50dW0pIC0gMTtcbiAgICB9XG4gICAgaTIgKz0gMTtcbiAgfVxuICB3aGlsZSAocXVhbnR1bSA+IDApIHtcbiAgICBpZiAoaTIgPT09IHN0cmluZy5sZW5ndGggfHwgc3RyaW5nW2kyXSAhPT0gcGFkZGluZykge1xuICAgICAgdGhyb3cgRXJyb3IoYE1pc3NpbmcgcGFkZGluZyBhdCBvZmZzZXQgJHtpMn0gb2Ygc3RyaW5nICR7bmFtZX1gKTtcbiAgICB9XG4gICAgaTIgKz0gMTtcbiAgICBxdWFudHVtIC09IDI7XG4gIH1cbiAgaWYgKGkyIDwgc3RyaW5nLmxlbmd0aCkge1xuICAgIHRocm93IEVycm9yKFxuICAgICAgYEJhc2U2NCBzdHJpbmcgaGFzIHRyYWlsaW5nIGdhcmJhZ2UgJHtzdHJpbmcuc3Vic3RyKFxuICAgICAgICBpMlxuICAgICAgKX0gaW4gc3RyaW5nICR7bmFtZX1gXG4gICAgKTtcbiAgfVxuICByZXR1cm4gZGF0YS5zdWJhcnJheSgwLCBqKTtcbn07XG52YXIgYWRhcHREZWNvZGVyID0gKG5hdGl2ZURlY29kZUJhc2U2NCkgPT4gKC4uLmFyZ3MpID0+IHtcbiAgY29uc3QgZGVjb2RlZCA9IG5hdGl2ZURlY29kZUJhc2U2NCguLi5hcmdzKTtcbiAgaWYgKGRlY29kZWQgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XG4gICAgcmV0dXJuIGRlY29kZWQ7XG4gIH1cbiAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGRlY29kZWQpO1xufTtcbnZhciBkZWNvZGVCYXNlNjQgPSBnbG9iYWxUaGlzLkJhc2U2NCAhPT0gdm9pZCAwID8gYWRhcHREZWNvZGVyKGdsb2JhbFRoaXMuQmFzZTY0LmRlY29kZSkgOiBqc0RlY29kZUJhc2U2NDtcblxuLy9cbnZhciBjb2VyY2VUb0J5dGVBcnJheSA9IChjb250ZW50cykgPT4ge1xuICBpZiAodHlwZW9mIGNvbnRlbnRzID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIFVpbnQ4QXJyYXkuZnJvbShjb250ZW50cywgKGMyKSA9PiB7XG4gICAgICBjb25zdCBiMyA9IGMyLmNoYXJDb2RlQXQoMCk7XG4gICAgICBiMyA8PSAyNTUgfHwgdGhyb3dSZWRhY3RlZGBjaGFyYWN0ZXIgY2Fubm90IGJlIGNvZXJjZWQgdG8gYW4gb2N0ZXQ6ICR7YzJ9YDtcbiAgICAgIHJldHVybiBiMztcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChjb250ZW50cyBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHtcbiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoXG4gICAgICBjb250ZW50cy5idWZmZXIsXG4gICAgICBjb250ZW50cy5ieXRlT2Zmc2V0LFxuICAgICAgY29udGVudHMuYnl0ZUxlbmd0aFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGNvbnRlbnRzKTtcbn07XG5mdW5jdGlvbiB0b0J5dGVzKGJ5dGVTb3VyY2UpIHtcbiAgY29uc3QgYnVmID0gY29lcmNlVG9CeXRlQXJyYXkoYnl0ZVNvdXJjZSk7XG4gIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLmJ1Zik7XG59XG5mdW5jdGlvbiBiYXNlNjRUb0J5dGVzKHN0cmluZykge1xuICByZXR1cm4gdG9CeXRlcyhkZWNvZGVCYXNlNjQoc3RyaW5nKSk7XG59XG5cbi8vXG52YXIgU2hhcGUxID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgLypcblxuXG4gICAgICovXG4gICAgRGF0YTogTS5zdHJpbmcoKSxcbiAgICBCeXRlczogTS5zdHJpbmcoKSxcbiAgICBFbmRwb2ludDogTS5zdHJpbmcoKSxcbiAgICBWb3c6IE0udGFnZ2VkKFxuICAgICAgXCJWb3dcIixcbiAgICAgIGhhcmRlbih7XG4gICAgICAgIHZvd1YwOiBNLnJlbW90YWJsZShcIlZvd1YwXCIpXG4gICAgICB9KVxuICAgICksXG4gICAgQ29ubmVjdGlvbkhhbmRsZXI6IE0ucmVtb3RhYmxlKFwiQ29ubmVjdGlvbkhhbmRsZXJcIiksXG4gICAgQ29ubmVjdGlvbjogTS5yZW1vdGFibGUoXCJDb25uZWN0aW9uXCIpLFxuICAgIEluYm91bmRBdHRlbXB0OiBNLnJlbW90YWJsZShcIkluYm91bmRBdHRlbXB0XCIpLFxuICAgIExpc3RlbmVyOiBNLnJlbW90YWJsZShcIkxpc3RlbmVyXCIpLFxuICAgIExpc3RlbkhhbmRsZXI6IE0ucmVtb3RhYmxlKFwiTGlzdGVuSGFuZGxlclwiKSxcbiAgICBQb3J0OiBNLnJlbW90YWJsZShcIlBvcnRcIiksXG4gICAgUHJvdG9jb2xIYW5kbGVyOiBNLnJlbW90YWJsZShcIlByb3RvY29sSGFuZGxlclwiKSxcbiAgICBQcm90b2NvbEltcGw6IE0ucmVtb3RhYmxlKFwiUHJvdG9jb2xJbXBsXCIpXG4gIH1cbik7XG52YXIgU2VuZE9wdGlvbnNTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHt9LFxuICB7IHJlbGF0aXZlVGltZW91dE5zOiBNLmJpZ2ludCgpIH1cbik7XG52YXIgU2hhcGUyID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgLi4uU2hhcGUxLFxuICAgIFZvdyQ6IChzaGFwZSkgPT4gTS5vcihzaGFwZSwgU2hhcGUxLlZvdyksXG4gICAgQXR0ZW1wdERlc2NyaXB0aW9uOiBNLnNwbGl0UmVjb3JkKFxuICAgICAgeyBoYW5kbGVyOiBTaGFwZTEuQ29ubmVjdGlvbkhhbmRsZXIgfSxcbiAgICAgIHsgcmVtb3RlQWRkcmVzczogU2hhcGUxLkVuZHBvaW50LCBsb2NhbEFkZHJlc3M6IFNoYXBlMS5FbmRwb2ludCB9XG4gICAgKSxcbiAgICBPcHRzOiBTZW5kT3B0aW9uc1NoYXBlXG4gIH1cbik7XG52YXIgU2hhcGUgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIGhhcmRlbih7XG4gICAgLi4uU2hhcGUyLFxuICAgIENvbm5lY3Rpb25JOiB7XG4gICAgICBjb25uZWN0aW9uOiBNLmludGVyZmFjZShcIkNvbm5lY3Rpb25cIiwge1xuICAgICAgICBzZW5kOiBNLmNhbGxXaGVuKFNoYXBlMi5EYXRhKS5vcHRpb25hbChTaGFwZTIuT3B0cykucmV0dXJucyhTaGFwZTIuVm93JChTaGFwZTIuQnl0ZXMpKSxcbiAgICAgICAgY2xvc2U6IE0uY2FsbFdoZW4oKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpKSxcbiAgICAgICAgZ2V0TG9jYWxBZGRyZXNzOiBNLmNhbGwoKS5yZXR1cm5zKFNoYXBlMi5FbmRwb2ludCksXG4gICAgICAgIGdldFJlbW90ZUFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoU2hhcGUyLkVuZHBvaW50KVxuICAgICAgfSksXG4gICAgICBvcGVuQ29ubmVjdGlvbkFja1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwiT3BlbkNvbm5lY3Rpb25BY2tXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcmV0aHJvd1VubGVzc01pc3NpbmdXYXRjaGVyOiBNLmludGVyZmFjZShcIlJldGhyb3dVbmxlc3NNaXNzaW5nV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgc2lua1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwiU2lua1dhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucygpXG4gICAgICB9KVxuICAgIH0sXG4gICAgSW5ib3VuZEF0dGVtcHRJOiB7XG4gICAgICBpbmJvdW5kQXR0ZW1wdDogTS5pbnRlcmZhY2UoXCJJbmJvdW5kQXR0ZW1wdFwiLCB7XG4gICAgICAgIGFjY2VwdDogTS5jYWxsV2hlbihTaGFwZTIuQXR0ZW1wdERlc2NyaXB0aW9uKS5yZXR1cm5zKFxuICAgICAgICAgIFNoYXBlMi5Wb3ckKFNoYXBlMi5Db25uZWN0aW9uKVxuICAgICAgICApLFxuICAgICAgICBnZXRMb2NhbEFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoU2hhcGUyLkVuZHBvaW50KSxcbiAgICAgICAgZ2V0UmVtb3RlQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhTaGFwZTIuRW5kcG9pbnQpLFxuICAgICAgICBjbG9zZTogTS5jYWxsV2hlbigpLnJldHVybnMoU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSkpXG4gICAgICB9KSxcbiAgICAgIGluYm91bmRBdHRlbXB0QWNjZXB0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJJbmJvdW5kQXR0ZW1wdEFjY2VwdFdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICByZXRocm93VW5sZXNzTWlzc2luZ1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUmV0aHJvd1VubGVzc01pc3NpbmdXYXRjaGVyXCIsIHtcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBzaW5rV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJTaW5rV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKClcbiAgICAgIH0pXG4gICAgfSxcbiAgICBQb3J0SToge1xuICAgICAgcG9ydDogTS5pbnRlcmZhY2UoXCJQb3J0XCIsIHtcbiAgICAgICAgZ2V0TG9jYWxBZGRyZXNzOiBNLmNhbGwoKS5yZXR1cm5zKFNoYXBlMi5FbmRwb2ludCksXG4gICAgICAgIGFkZExpc3RlbmVyOiBNLmNhbGxXaGVuKFNoYXBlMi5MaXN0ZW5lcikucmV0dXJucyhcbiAgICAgICAgICBTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKVxuICAgICAgICApLFxuICAgICAgICBjb25uZWN0OiBNLmNhbGxXaGVuKFNoYXBlMi5FbmRwb2ludCkub3B0aW9uYWwoU2hhcGUyLkNvbm5lY3Rpb25IYW5kbGVyKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKFNoYXBlMi5Db25uZWN0aW9uKSksXG4gICAgICAgIHJlbW92ZUxpc3RlbmVyOiBNLmNhbGxXaGVuKFNoYXBlMi5MaXN0ZW5lcikucmV0dXJucyhcbiAgICAgICAgICBTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKVxuICAgICAgICApLFxuICAgICAgICByZXZva2U6IE0uY2FsbFdoZW4oKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpKVxuICAgICAgfSksXG4gICAgICBwb3J0QWRkTGlzdGVuZXJXYXRjaGVyOiBNLmludGVyZmFjZShcIlBvcnRBZGRMaXN0ZW5lcldhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBwb3J0UmVtb3ZlTGlzdGVuZXJXYXRjaGVyOiBNLmludGVyZmFjZShcIlBvcnRSZW1vdmVMaXN0ZW5lcldhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBwb3J0Q29ubmVjdFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUG9ydENvbm5lY3RXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcG9ydFJldm9rZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUG9ydFJldm9rZVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBwb3J0UmV2b2tlQ2xlYW51cFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUG9ydFJldm9rZUNsZWFudXBXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcmV0aHJvd1VubGVzc01pc3NpbmdXYXRjaGVyOiBNLmludGVyZmFjZShcIlJldGhyb3dVbmxlc3NNaXNzaW5nV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgc2lua1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwiU2lua1dhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucygpLFxuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KVxuICAgIH0sXG4gICAgUHJvdG9jb2xIYW5kbGVySToge1xuICAgICAgcHJvdG9jb2xIYW5kbGVyOiBNLmludGVyZmFjZShcIlByb3RvY29sSGFuZGxlclwiLCB7XG4gICAgICAgIG9uQ3JlYXRlOiBNLmNhbGxXaGVuKE0ucmVtb3RhYmxlKCksIFNoYXBlMi5Qcm90b2NvbEhhbmRsZXIpLnJldHVybnMoXG4gICAgICAgICAgU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSlcbiAgICAgICAgKSxcbiAgICAgICAgZ2VuZXJhdGVQb3J0SUQ6IE0uY2FsbFdoZW4oXG4gICAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICAgIFNoYXBlMi5Qcm90b2NvbEhhbmRsZXJcbiAgICAgICAgKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKE0uc3RyaW5nKCkpKSxcbiAgICAgICAgb25CaW5kOiBNLmNhbGxXaGVuKFxuICAgICAgICAgIFNoYXBlMi5Qb3J0LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyXG4gICAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKSksXG4gICAgICAgIG9uTGlzdGVuOiBNLmNhbGxXaGVuKFxuICAgICAgICAgIFNoYXBlMi5Qb3J0LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuTGlzdGVuSGFuZGxlcixcbiAgICAgICAgICBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyXG4gICAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKSksXG4gICAgICAgIG9uTGlzdGVuUmVtb3ZlOiBNLmNhbGxXaGVuKFxuICAgICAgICAgIFNoYXBlMi5Qb3J0LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuTGlzdGVuSGFuZGxlcixcbiAgICAgICAgICBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyXG4gICAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKSksXG4gICAgICAgIG9uSW5zdGFudGlhdGU6IE0uY2FsbFdoZW4oXG4gICAgICAgICAgU2hhcGUyLlBvcnQsXG4gICAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyXG4gICAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChTaGFwZTIuRW5kcG9pbnQpKSxcbiAgICAgICAgb25Db25uZWN0OiBNLmNhbGxXaGVuKFxuICAgICAgICAgIFNoYXBlMi5Qb3J0LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLkNvbm5lY3Rpb25IYW5kbGVyLFxuICAgICAgICAgIFNoYXBlMi5Qcm90b2NvbEhhbmRsZXJcbiAgICAgICAgKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKFNoYXBlMi5BdHRlbXB0RGVzY3JpcHRpb24pKSxcbiAgICAgICAgb25SZXZva2U6IE0uY2FsbFdoZW4oXG4gICAgICAgICAgU2hhcGUyLlBvcnQsXG4gICAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICAgIFNoYXBlMi5Qcm90b2NvbEhhbmRsZXJcbiAgICAgICAgKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpKVxuICAgICAgfSksXG4gICAgICBwcm90b2NvbEhhbmRsZXJBY2NlcHRXYXRjaGVyOiBNLmludGVyZmFjZShcIlByb3RvY29sSGFuZGxlckFjY2VwdFdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBwcm90b2NvbEhhbmRsZXJJbnN0YW50aWF0ZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFxuICAgICAgICBcIlByb3RvY29sSGFuZGxlckluc3RhbnRpYXRlV2F0Y2hlclwiLFxuICAgICAgICB7XG4gICAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHByb3RvY29sSGFuZGxlckNvbm5lY3RXYXRjaGVyOiBNLmludGVyZmFjZShcbiAgICAgICAgXCJQcm90b2NvbEhhbmRsZXJDb25uZWN0V2F0Y2hlclwiLFxuICAgICAgICB7XG4gICAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHJldGhyb3dVbmxlc3NNaXNzaW5nV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJSZXRocm93VW5sZXNzTWlzc2luZ1dhdGNoZXJcIiwge1xuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KVxuICAgIH0sXG4gICAgUHJvdG9jb2xJbXBsSTogTS5pbnRlcmZhY2UoXCJQcm90b2NvbEltcGxcIiwge1xuICAgICAgYmluZFBvcnQ6IE0uY2FsbFdoZW4oU2hhcGUyLkVuZHBvaW50KS5yZXR1cm5zKFNoYXBlMi5Wb3ckKFNoYXBlMi5Qb3J0KSksXG4gICAgICBpbmJvdW5kOiBNLmNhbGxXaGVuKFNoYXBlMi5FbmRwb2ludCwgU2hhcGUyLkVuZHBvaW50KS5yZXR1cm5zKFxuICAgICAgICBTaGFwZTIuVm93JChTaGFwZTIuSW5ib3VuZEF0dGVtcHQpXG4gICAgICApLFxuICAgICAgb3V0Ym91bmQ6IE0uY2FsbFdoZW4oXG4gICAgICAgIFNoYXBlMi5Qb3J0LFxuICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgIFNoYXBlMi5Db25uZWN0aW9uSGFuZGxlclxuICAgICAgKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKFNoYXBlMi5Db25uZWN0aW9uKSlcbiAgICB9KVxuICB9KVxuKTtcblxuLy9cbnZhciBzaW5rMiA9ICgpID0+IHtcbn07XG5oYXJkZW4oc2luazIpO1xudmFyIENMT1NFX1JFQVNPTl9GSU5BTElaRVIgPSBcImNsb3NlZC1ieS1maW5hbGl6ZXJcIjtcbnZhciBSZXZva2VTdGF0ZSA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIE5PVF9SRVZPS0VEOiAwLFxuICAgIFJFVk9LSU5HOiAxLFxuICAgIFJFVk9LRUQ6IDJcbiAgfVxuKTtcbmhhcmRlbihSZXZva2VTdGF0ZSk7XG52YXIgcHJlcGFyZUZpbmFsaXplciA9ICh6b25lLCB7IHdhdGNoIH0pID0+IHtcbiAgY29uc3Qgb2JqVG9GaW5hbGl6ZXJJbmZvID0gem9uZS5tYXBTdG9yZShcIm9ialRvRmluYWxpemVySW5mb1wiKTtcbiAgcmV0dXJuIHpvbmUuZXhvKFwiTmV0d29ya0ZpbmFsaXplclwiLCB2b2lkIDAsIHtcbiAgICBoYXMob2JqKSB7XG4gICAgICByZXR1cm4gb2JqVG9GaW5hbGl6ZXJJbmZvLmhhcyhvYmopO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgIGluaXRDb25uZWN0aW9uKGNvbm4sIGhhbmRsZXIpIHtcbiAgICAgIG9ialRvRmluYWxpemVySW5mby5pbml0KGNvbm4sIGhhcmRlbih7IGNvbm4sIGhhbmRsZXIgfSkpO1xuICAgIH0sXG4gICAgLypcblxuXG5cbiAgICAgKi9cbiAgICBpbml0Q2xvc2VyKGNsb3Nlcikge1xuICAgICAgb2JqVG9GaW5hbGl6ZXJJbmZvLmluaXQoY2xvc2VyLCBoYXJkZW4oeyBjbG9zZXIgfSkpO1xuICAgIH0sXG4gICAgZmluYWxpemUob2JqKSB7XG4gICAgICBpZiAoIW9ialRvRmluYWxpemVySW5mby5oYXMob2JqKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBkaXNwb3NlSW5mbyA9IG9ialRvRmluYWxpemVySW5mby5nZXQob2JqKTtcbiAgICAgIGlmIChcImNvbm5cIiBpbiBkaXNwb3NlSW5mbykge1xuICAgICAgICBjb25zdCB7IGNvbm4sIGhhbmRsZXIgfSA9IGRpc3Bvc2VJbmZvO1xuICAgICAgICBvYmpUb0ZpbmFsaXplckluZm8uZGVsZXRlKG9iaik7XG4gICAgICAgIHJldHVybiB3YXRjaChFKGhhbmRsZXIpLm9uQ2xvc2UoY29ubiwgQ0xPU0VfUkVBU09OX0ZJTkFMSVpFUiwgaGFuZGxlcikpO1xuICAgICAgfSBlbHNlIGlmIChcImNsb3NlclwiIGluIGRpc3Bvc2VJbmZvKSB7XG4gICAgICAgIGNvbnN0IHsgY2xvc2VyIH0gPSBkaXNwb3NlSW5mbztcbiAgICAgICAgb2JqVG9GaW5hbGl6ZXJJbmZvLmRlbGV0ZShvYmopO1xuICAgICAgICByZXR1cm4gd2F0Y2goRShjbG9zZXIpLmNsb3NlKCkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgdW5waW4ob2JqKSB7XG4gICAgICBvYmpUb0ZpbmFsaXplckluZm8uZGVsZXRlKG9iaik7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZUZpbmFsaXplcik7XG5cbi8vXG52YXIgUm91dGVySSA9IE0uaW50ZXJmYWNlKFwiUm91dGVyXCIsIHtcbiAgZ2V0Um91dGVzOiBNLmNhbGwoU2hhcGUuRW5kcG9pbnQpLnJldHVybnMoTS5hcnJheU9mKFtNLnN0cmluZygpLCBNLmFueSgpXSkpLFxuICByZWdpc3RlcjogTS5jYWxsKE0uc3RyaW5nKCksIE0uYW55KCkpLnJldHVybnMoTS51bmRlZmluZWQoKSksXG4gIHVucmVnaXN0ZXI6IE0uY2FsbChNLnN0cmluZygpLCBNLmFueSgpKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpXG59KTtcblxuLy9cbnZhciBPdXRib3VuZENvbm5lY3Rpb25IYW5kbGVySSA9IE0uaW50ZXJmYWNlKFxuICBcIk91dGJvdW5kQ29ubmVjdGlvbkhhbmRsZXJcIixcbiAge1xuICAgIG9uT3BlbjogTS5jYWxsV2hlbihNLmFueSgpLCBNLnN0cmluZygpLCBNLnN0cmluZygpLCBNLmFueSgpKS5yZXR1cm5zKFxuICAgICAgTS5hbnkoKVxuICAgICksXG4gICAgb25DbG9zZTogTS5jYWxsV2hlbihNLmFueSgpLCBNLmFueSgpLCBNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gIH1cbik7XG52YXIgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUgPSB7XG4gIGNoYWluSWQ6IE0uc3RyaW5nKCksXG4gIC8vXG4gIGVuY29kaW5nOiBNLnN0cmluZygpLFxuICB2YWx1ZTogTS5zdHJpbmcoKVxufTtcbmhhcmRlbihDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSk7XG52YXIgQ2FpcDEwUmVjb3JkU2hhcGUgPSB7XG4gIG5hbWVzcGFjZTogTS5zdHJpbmcoKSxcbiAgcmVmZXJlbmNlOiBNLnN0cmluZygpLFxuICBhY2NvdW50QWRkcmVzczogTS5zdHJpbmcoKVxufTtcbmhhcmRlbihDYWlwMTBSZWNvcmRTaGFwZSk7XG52YXIgQWNjb3VudElkQXJnU2hhcGUgPSBNLm9yKE0uc3RyaW5nKCksIENvc21vc0NoYWluQWRkcmVzc1NoYXBlKTtcbnZhciBQcm90bzNTaGFwZSA9IHsgdHlwZVVybDogTS5zdHJpbmcoKSwgdmFsdWU6IE0uc3RyaW5nKCkgfTtcbmhhcmRlbihQcm90bzNTaGFwZSk7XG52YXIgSUJDQ2hhbm5lbElEU2hhcGUgPSBNLnN0cmluZygpO1xudmFyIElCQ0NoYW5uZWxJbmZvU2hhcGUgPSBNLnNwbGl0UmVjb3JkKHtcbiAgcG9ydElkOiBNLnN0cmluZygpLFxuICBjaGFubmVsSWQ6IElCQ0NoYW5uZWxJRFNoYXBlLFxuICBjb3VudGVyUGFydHlQb3J0SWQ6IE0uc3RyaW5nKCksXG4gIGNvdW50ZXJQYXJ0eUNoYW5uZWxJZDogSUJDQ2hhbm5lbElEU2hhcGUsXG4gIG9yZGVyaW5nOiBNLnNjYWxhcigpLFxuICAvL1xuICBzdGF0ZTogTS5zY2FsYXIoKSxcbiAgLy9cbiAgdmVyc2lvbjogTS5zdHJpbmcoKVxufSk7XG52YXIgSUJDQ29ubmVjdGlvbklEU2hhcGUgPSBNLnN0cmluZygpO1xudmFyIElCQ0Nvbm5lY3Rpb25JbmZvU2hhcGUgPSBNLnNwbGl0UmVjb3JkKHtcbiAgaWQ6IElCQ0Nvbm5lY3Rpb25JRFNoYXBlLFxuICBjbGllbnRfaWQ6IE0uc3RyaW5nKCksXG4gIHN0YXRlOiBNLnNjYWxhcigpLFxuICAvL1xuICBjb3VudGVycGFydHk6IHtcbiAgICBjbGllbnRfaWQ6IE0uc3RyaW5nKCksXG4gICAgY29ubmVjdGlvbl9pZDogSUJDQ29ubmVjdGlvbklEU2hhcGVcbiAgfSxcbiAgdHJhbnNmZXJDaGFubmVsOiBJQkNDaGFubmVsSW5mb1NoYXBlXG59KTtcbnZhciBDb3Ntb3NBc3NldEluZm9TaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICBiYXNlOiBNLnN0cmluZygpLFxuICBuYW1lOiBNLnN0cmluZygpLFxuICBkaXNwbGF5OiBNLnN0cmluZygpLFxuICBzeW1ib2w6IE0uc3RyaW5nKCksXG4gIGRlbm9tX3VuaXRzOiBNLmFycmF5T2YoXG4gICAgTS5zcGxpdFJlY29yZCh7IGRlbm9tOiBNLnN0cmluZygpLCBleHBvbmVudDogTS5udW1iZXIoKSB9KVxuICApXG59KTtcbnZhciBDaGFpbkluZm9SZXF1aXJlZFNoYXBlID0ge1xuICBuYW1lc3BhY2U6IE0uc3RyaW5nKCksXG4gIHJlZmVyZW5jZTogTS5zdHJpbmcoKVxufTtcbnZhciBDaGFpbkluZm9PcHRpb25hbFNoYXBlID0ge1xuICBjY3RwRGVzdGluYXRpb25Eb21haW46IE0ubnVtYmVyKClcbn07XG52YXIgQmFzZUNoYWluSW5mb1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAgQ2hhaW5JbmZvUmVxdWlyZWRTaGFwZSxcbiAgQ2hhaW5JbmZvT3B0aW9uYWxTaGFwZVxuKTtcbmhhcmRlbihCYXNlQ2hhaW5JbmZvU2hhcGUpO1xudmFyIENvc21vc0NoYWluSW5mb1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIGNoYWluSWQ6IE0uc3RyaW5nKCksXG4gICAgYmVjaDMyUHJlZml4OiBNLnN0cmluZygpLFxuICAgIC4uLkNoYWluSW5mb1JlcXVpcmVkU2hhcGVcbiAgfSxcbiAge1xuICAgIGNvbm5lY3Rpb25zOiBNLnJlY29yZCgpLFxuICAgIC8vXG4gICAgaWNxRW5hYmxlZDogTS5ib29sZWFuKCksXG4gICAgcGZtRW5hYmxlZDogTS5ib29sZWFuKCksXG4gICAgc3Rha2luZ1Rva2VuczogTS5hcnJheU9mKHsgZGVub206IE0uc3RyaW5nKCkgfSksXG4gICAgLi4uQ2hhaW5JbmZvT3B0aW9uYWxTaGFwZVxuICB9XG4pO1xuaGFyZGVuKENvc21vc0NoYWluSW5mb1NoYXBlKTtcbnZhciBDaGFpbkluZm9TaGFwZSA9IE0ub3IoQ29zbW9zQ2hhaW5JbmZvU2hhcGUsIEJhc2VDaGFpbkluZm9TaGFwZSk7XG5oYXJkZW4oQ2hhaW5JbmZvU2hhcGUpO1xudmFyIERlbm9tU2hhcGUgPSBNLnN0cmluZygpO1xudmFyIENvaW5TaGFwZSA9IHtcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgYW1vdW50OiBNLnN0cmluZygpLFxuICBkZW5vbTogRGVub21TaGFwZVxufTtcbmhhcmRlbihDb2luU2hhcGUpO1xudmFyIERlbm9tSW5mb1NoYXBlID0ge1xuICBjaGFpbjogTS5yZW1vdGFibGUoXCJDaGFpblwiKSxcbiAgYmFzZTogTS5yZW1vdGFibGUoXCJDaGFpblwiKSxcbiAgYnJhbmQ6IE0ub3IoTS5yZW1vdGFibGUoXCJCcmFuZFwiKSwgTS51bmRlZmluZWQoKSksXG4gIGJhc2VEZW5vbTogTS5zdHJpbmcoKVxufTtcbmhhcmRlbihEZW5vbUluZm9TaGFwZSk7XG52YXIgRGVub21EZXRhaWxTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHsgY2hhaW5OYW1lOiBNLnN0cmluZygpLCBiYXNlTmFtZTogTS5zdHJpbmcoKSwgYmFzZURlbm9tOiBNLnN0cmluZygpIH0sXG4gIHsgYnJhbmQ6IEJyYW5kU2hhcGUgfVxuKTtcbmhhcmRlbihEZW5vbURldGFpbFNoYXBlKTtcbnZhciBEZW5vbUFtb3VudFNoYXBlID0geyBkZW5vbTogRGVub21TaGFwZSwgdmFsdWU6IE0ubmF0KCkgfTtcbmhhcmRlbihEZW5vbUFtb3VudFNoYXBlKTtcbnZhciBBbnlOYXRBbW91bnRTaGFwZSA9IHtcbiAgYnJhbmQ6IE0ucmVtb3RhYmxlKFwiQnJhbmRcIiksXG4gIHZhbHVlOiBNLm5hdCgpXG59O1xuaGFyZGVuKEFueU5hdEFtb3VudFNoYXBlKTtcbnZhciBBbW91bnRBcmdTaGFwZSA9IE0ub3IoQW55TmF0QW1vdW50U2hhcGUsIERlbm9tQW1vdW50U2hhcGUpO1xudmFyIERlbGVnYXRpb25TaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICB2YWxpZGF0b3I6IENvc21vc0NoYWluQWRkcmVzc1NoYXBlLFxuICAgIGFtb3VudDogQW1vdW50QXJnU2hhcGVcbiAgfSxcbiAgeyBkZWxlZ2F0b3I6IENvc21vc0NoYWluQWRkcmVzc1NoYXBlIH1cbik7XG52YXIgSUNRTXNnU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7IHBhdGg6IE0uc3RyaW5nKCksIGRhdGE6IE0uc3RyaW5nKCkgfSxcbiAgeyBoZWlnaHQ6IE0uc3RyaW5nKCksIHByb3ZlOiBNLmJvb2xlYW4oKSB9XG4pO1xudmFyIFR5cGVkSnNvblNoYXBlID0gTS5zcGxpdFJlY29yZCh7IFwiQHR5cGVcIjogTS5zdHJpbmcoKSB9KTtcbnZhciBjaGFpbkZhY2FkZU1ldGhvZHMgPSB7XG4gIGdldENoYWluSW5mbzogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIG1ha2VBY2NvdW50OiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKVxufTtcbmhhcmRlbihjaGFpbkZhY2FkZU1ldGhvZHMpO1xudmFyIFRpbWVzdGFtcFByb3RvU2hhcGUgPSB7IHNlY29uZHM6IE0uc3RyaW5nKCksIG5hbm9zOiBNLm51bWJlcigpIH07XG5oYXJkZW4oVGltZXN0YW1wUHJvdG9TaGFwZSk7XG52YXIgRXhlY3V0ZUlDQVR4T3B0c1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge30sXG4gIHtcbiAgICBtZW1vOiBNLnN0cmluZygpLFxuICAgIHRpbWVvdXRIZWlnaHQ6IE0uYmlnaW50KCksXG4gICAgZXh0ZW5zaW9uT3B0aW9uczogTS5hcnJheU9mKE0uYW55KCkpLFxuICAgIG5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9uczogTS5hcnJheU9mKE0uYW55KCkpLFxuICAgIHNlbmRPcHRzOiBTZW5kT3B0aW9uc1NoYXBlXG4gIH1cbik7XG52YXIgQW55TmF0QW1vdW50c1JlY29yZCA9IE0uYW5kKFxuICBNLnJlY29yZE9mKE0uc3RyaW5nKCksIEFueU5hdEFtb3VudFNoYXBlKSxcbiAgTS5ub3Qoe30pXG4pO1xudmFyIE9yY2hlc3RyYXRpb25Qb3dlcnNTaGFwZSA9IHtcbiAgYWdvcmljTmFtZXM6IE0ucmVtb3RhYmxlKCksXG4gIGxvY2FsY2hhaW46IE0ucmVtb3RhYmxlKCksXG4gIG9yY2hlc3RyYXRpb25TZXJ2aWNlOiBNLnJlbW90YWJsZSgpLFxuICBzdG9yYWdlTm9kZTogTS5yZW1vdGFibGUoKSxcbiAgdGltZXJTZXJ2aWNlOiBNLnJlbW90YWJsZSgpXG59O1xuaGFyZGVuKE9yY2hlc3RyYXRpb25Qb3dlcnNTaGFwZSk7XG52YXIgRm9yd2FyZEFyZ3NTaGFwZSA9IHtcbiAgcmVjZWl2ZXI6IE0uc3RyaW5nKCksXG4gIHBvcnQ6IFwidHJhbnNmZXJcIixcbiAgY2hhbm5lbDogTS5zdHJpbmcoKSxcbiAgdGltZW91dDogTS5zdHJpbmcoKSxcbiAgcmV0cmllczogTS5udW1iZXIoKVxufTtcbmhhcmRlbihGb3J3YXJkQXJnc1NoYXBlKTtcbnZhciBGb3J3YXJkSW5mb1NoYXBlID0ge1xuICBmb3J3YXJkOiBNLnNwbGl0UmVjb3JkKEZvcndhcmRBcmdzU2hhcGUsIHtcbiAgICAvKlxuXG5cbiAgICAgKi9cbiAgICBuZXh0OiB7XG4gICAgICBmb3J3YXJkOiBGb3J3YXJkQXJnc1NoYXBlXG4gICAgfVxuICB9KVxufTtcbmhhcmRlbihGb3J3YXJkSW5mb1NoYXBlKTtcbnZhciBGb3J3YXJkT3B0c1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge30sXG4gIHtcbiAgICB0aW1lb3V0OiBNLnN0cmluZygpLFxuICAgIHJldHJpZXM6IE0ubnVtYmVyKCksXG4gICAgaW50ZXJtZWRpYXRlUmVjaXBpZW50OiBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZVxuICB9LFxuICB7fVxuKTtcbnZhciBJQkNUcmFuc2Zlck9wdGlvbnNTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHt9LFxuICB7XG4gICAgdGltZW91dFRpbWVzdGFtcDogTS5iaWdpbnQoKSxcbiAgICB0aW1lb3V0SGVpZ2h0OiB7XG4gICAgICByZXZpc2lvbkhlaWdodDogTS5iaWdpbnQoKSxcbiAgICAgIHJldmlzaW9uTnVtYmVyOiBNLmJpZ2ludCgpXG4gICAgfSxcbiAgICB0aW1lb3V0UmVsYXRpdmVTZWNvbmRzOiBNLmJpZ2ludCgpLFxuICAgIG1lbW86IE0uc3RyaW5nKCksXG4gICAgZm9yd2FyZE9wdHM6IEZvcndhcmRPcHRzU2hhcGVcbiAgfVxuKTtcblxuLy9cbnZhciBwcmVwYXJlQ2hhaW5IdWJBZG1pbiA9ICh6b25lLCBjaGFpbkh1YikgPT4ge1xuICBjb25zdCBDb25uZWN0aW9uSW5mb1NoYXBlID0gTS5yZWNvcmQoKTtcbiAgY29uc3QgbWFrZUNyZWF0b3JGYWNldCA9IHpvbmUuZXhvKFxuICAgIFwiQ2hhaW5IdWIgQWRtaW5cIixcbiAgICBNLmludGVyZmFjZShcIkNoYWluSHViIEFkbWluXCIsIHtcbiAgICAgIHJlZ2lzdGVyQ2hhaW46IE0uY2FsbFdoZW4oTS5zdHJpbmcoKSwgQ2hhaW5JbmZvU2hhcGUpLm9wdGlvbmFsKENvbm5lY3Rpb25JbmZvU2hhcGUpLnJldHVybnMoTS51bmRlZmluZWQoKSksXG4gICAgICByZWdpc3RlckFzc2V0OiBNLmNhbGwoTS5zdHJpbmcoKSwgRGVub21EZXRhaWxTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgICB9KSxcbiAgICB7XG4gICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgYXN5bmMgcmVnaXN0ZXJDaGFpbihjaGFpbk5hbWUsIGNoYWluSW5mbywgaWJjQ29ubmVjdGlvbkluZm8pIHtcbiAgICAgICAgY29uc3QgYWdvcmljQ2hhaW5JbmZvID0gYXdhaXQgaGVhcFZvd0Uud2hlbihcbiAgICAgICAgICBjaGFpbkh1Yi5nZXRDaGFpbkluZm8oXCJhZ29yaWNcIilcbiAgICAgICAgKTtcbiAgICAgICAgY2hhaW5IdWIucmVnaXN0ZXJDaGFpbihjaGFpbk5hbWUsIGNoYWluSW5mbyk7XG4gICAgICAgIGlmIChpYmNDb25uZWN0aW9uSW5mbykge1xuICAgICAgICAgIGNoYWluSHViLnJlZ2lzdGVyQ29ubmVjdGlvbihcbiAgICAgICAgICAgIGFnb3JpY0NoYWluSW5mby5jaGFpbklkLFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICBjaGFpbkluZm8uY2hhaW5JZCxcbiAgICAgICAgICAgIGliY0Nvbm5lY3Rpb25JbmZvXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGFzeW5jIHJlZ2lzdGVyQXNzZXQoZGVub20sIGRldGFpbCkge1xuICAgICAgICBhd2FpdCBoZWFwVm93RS53aGVuKGNoYWluSHViLmdldENoYWluSW5mbyhcImFnb3JpY1wiKSk7XG4gICAgICAgIGNoYWluSHViLnJlZ2lzdGVyQXNzZXQoZGVub20sIGRldGFpbCk7XG4gICAgICB9XG4gICAgfVxuICApO1xuICByZXR1cm4gbWFrZUNyZWF0b3JGYWNldDtcbn07XG5cbi8vXG52YXIgbWFrZVdlYWtTZXRTdG9yZU1ldGhvZHMyID0gKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCBrZXlOYW1lID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiBqc3NldC5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUoa2V5TmFtZSl9IG5vdCBmb3VuZDogJHtrZXl9YDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgaGFzOiAoa2V5KSA9PiB7XG4gICAgICByZXR1cm4ganNzZXQuaGFzKGtleSk7XG4gICAgfSxcbiAgICBhZGQ6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleU9rVG9BZGQoa2V5KTtcbiAgICAgIGpzc2V0LmFkZChrZXkpO1xuICAgIH0sXG4gICAgZGVsZXRlOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIGlmIChhc3NlcnRLZXlPa1RvRGVsZXRlICE9PSB2b2lkIDApIHtcbiAgICAgICAgYXNzZXJ0S2V5T2tUb0RlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgICAganNzZXQuZGVsZXRlKGtleSk7XG4gICAgfSxcbiAgICBhZGRBbGw6IChrZXlzNSkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBrZXlzNVtTeW1ib2wuaXRlcmF0b3JdICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgaWYgKE9iamVjdC5pc0Zyb3plbihrZXlzNSkgJiYgaXNDb3B5U2V0KGtleXM1KSkge1xuICAgICAgICAgIGtleXM1ID0gZ2V0Q29weVNldEtleXMoa2V5czUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93UmVkYWN0ZWRgcHJvdmlkZWQgZGF0YSBzb3VyY2UgaXMgbm90IGl0ZXJhYmxlOiAke2tleXM1fWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoXG4gICAgICAgIGNvbnN0IGtleSBvZlxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBrZXlzNVxuICAgICAgKSB7XG4gICAgICAgIGFzc2VydEtleU9rVG9BZGQoa2V5KTtcbiAgICAgICAganNzZXQuYWRkKGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgbWFrZVNjYWxhcldlYWtTZXRTdG9yZTIgPSAodGFnID0gXCJrZXlcIiwgeyBsb25nTGl2ZWQgPSB0cnVlLCBrZXlTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNzZXQgPSBuZXcgKGxvbmdMaXZlZCA/IFdlYWtTZXQgOiBTZXQpKCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S2V5T2tUb0FkZCA9IChrZXkpID0+IHtcbiAgICBoYXJkZW4oa2V5KTtcbiAgICBwYXNzU3R5bGVPZihrZXkpID09PSBcInJlbW90YWJsZVwiIHx8IHRocm93UmVkYWN0ZWRgT25seSByZW1vdGFibGVzIGNhbiBiZSBrZXlzIG9mIHNjYWxhciBXZWFrU3RvcmVzOiAke2tleX1gO1xuICAgIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2goa2V5LCBrZXlTaGFwZSwgXCJ3ZWFrU2V0U3RvcmUga2V5XCIpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIEZhcihgc2NhbGFyIFdlYWtTZXRTdG9yZSBvZiAke3F1b3RlKHRhZyl9YCwge1xuICAgIC4uLm1ha2VXZWFrU2V0U3RvcmVNZXRob2RzMihqc3NldCwgYXNzZXJ0S2V5T2tUb0FkZCwgdm9pZCAwLCB0YWcpXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU2NhbGFyV2Vha1NldFN0b3JlMik7XG5cbi8vXG52YXIgbWFrZUN1cnJlbnRLZXlzS2l0MiA9IChnZXRSYXdLZXlzLCBjaGVja0hhcywgY29tcGFyZSwgYXNzZXJ0T2tUb0FkZCwgYXNzZXJ0T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgbGV0IHVwZGF0ZUNvdW50ID0gMDtcbiAgbGV0IHNvcnRlZEtleXNNZW1vO1xuICBjb25zdCBhc3NlcnRVcGRhdGVPbkFkZCA9IChrLCB2MiA9IHZvaWQgMCkgPT4ge1xuICAgIGFzc2VydE9rVG9BZGQoaywgdjIpO1xuICAgIHVwZGF0ZUNvdW50ICs9IDE7XG4gICAgc29ydGVkS2V5c01lbW8gPSB2b2lkIDA7XG4gIH07XG4gIGNvbnN0IGFzc2VydFVwZGF0ZU9uRGVsZXRlID0gKGspID0+IGFzc2VydE9rVG9EZWxldGUgJiYgYXNzZXJ0T2tUb0RlbGV0ZShrKTtcbiAgY29uc3QgZ2V0U29ydGVkS2V5cyA9ICgpID0+IHtcbiAgICBpZiAoc29ydGVkS2V5c01lbW8gPT09IHZvaWQgMCkge1xuICAgICAgc29ydGVkS2V5c01lbW8gPSBoYXJkZW4oWy4uLmdldFJhd0tleXMoKV0uc29ydChjb21wYXJlKSk7XG4gICAgfVxuICAgIHJldHVybiBzb3J0ZWRLZXlzTWVtbztcbiAgfTtcbiAgY29uc3QgaXRlcmFibGVLZXlzID0gRmFyKFwiSXRlcmFibGUgb2Yga2V5c1wiLCB7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGNvbnN0IGdlbmVyYXRpb24gPSB1cGRhdGVDb3VudDtcbiAgICAgIGdldFNvcnRlZEtleXMoKTtcbiAgICAgIGNvbnN0IGxlbiA9IHNvcnRlZEtleXNNZW1vLmxlbmd0aDtcbiAgICAgIGxldCBpMiA9IDA7XG4gICAgICByZXR1cm4gRmFyKFwiSXRlcmF0b3Igb2Yga2V5c1wiLCB7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBnZW5lcmF0aW9uID09PSB1cGRhdGVDb3VudCB8fCB0aHJvd1JlZGFjdGVkYFN0b3JlICR7cXVvdGUoa2V5TmFtZSl9IGN1cnNvciBzdGFsZWA7XG4gICAgICAgICAgZm9yICg7IDsgKSB7XG4gICAgICAgICAgICBpZiAoaTIgPCBsZW4pIHtcbiAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBzb3J0ZWRLZXlzTWVtb1tpMl07XG4gICAgICAgICAgICAgIGkyICs9IDE7XG4gICAgICAgICAgICAgIGlmIChjaGVja0hhcyh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHZvaWQgMCB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGFzc2VydFVwZGF0ZU9uQWRkLFxuICAgIGFzc2VydFVwZGF0ZU9uRGVsZXRlLFxuICAgIGl0ZXJhYmxlS2V5c1xuICB9KTtcbn07XG5oYXJkZW4obWFrZUN1cnJlbnRLZXlzS2l0Mik7XG52YXIgcHJvdmlkZUxhenkyID0gKG1hcFN0b3JlLCBrZXksIG1ha2VWYWx1ZSkgPT4ge1xuICBpZiAoIW1hcFN0b3JlLmhhcyhrZXkpKSB7XG4gICAgbWFwU3RvcmUuaW5pdChrZXksIG1ha2VWYWx1ZShrZXkpKTtcbiAgfVxuICByZXR1cm4gbWFwU3RvcmUuZ2V0KGtleSk7XG59O1xuaGFyZGVuKHByb3ZpZGVMYXp5Mik7XG52YXIgbWFrZUF0b21pY1Byb3ZpZGVyMiA9IChzdG9yZSkgPT4ge1xuICBjb25zdCBwZW5kaW5nID0gLyogICAgICAgICAgICovIG5ldyBNYXAoKTtcbiAgY29uc3QgcHJvdmlkZUFzeW5jID0gKGtleSwgbWFrZVZhbHVlLCBmaW5pc2hWYWx1ZSkgPT4ge1xuICAgIGlmIChzdG9yZS5oYXMoa2V5KSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShzdG9yZS5nZXQoa2V5KSk7XG4gICAgfVxuICAgIGlmICghcGVuZGluZy5oYXMoa2V5KSkge1xuICAgICAgY29uc3QgdmFsUDIgPSBtYWtlVmFsdWUoa2V5KS50aGVuKCh2MikgPT4ge1xuICAgICAgICBzdG9yZS5pbml0KGtleSwgdjIpO1xuICAgICAgICByZXR1cm4gdjI7XG4gICAgICB9KS50aGVuKCh2MikgPT4ge1xuICAgICAgICBpZiAoZmluaXNoVmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gZmluaXNoVmFsdWUoa2V5LCB2MikudGhlbigoKSA9PiB2Mik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHYyO1xuICAgICAgfSkuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIHBlbmRpbmcuZGVsZXRlKGtleSk7XG4gICAgICB9KTtcbiAgICAgIHBlbmRpbmcuc2V0KGtleSwgdmFsUDIpO1xuICAgIH1cbiAgICBjb25zdCB2YWxQID0gcGVuZGluZy5nZXQoa2V5KTtcbiAgICBhc3NlcnQodmFsUCk7XG4gICAgcmV0dXJuIHZhbFA7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oeyBwcm92aWRlQXN5bmMgfSk7XG59O1xuaGFyZGVuKG1ha2VBdG9taWNQcm92aWRlcjIpO1xudmFyIGFwcGVuZFRvU3RvcmVkQXJyYXkyID0gKG1hcFN0b3JlLCBrZXksIGl0ZW0pID0+IHtcbiAgaWYgKG1hcFN0b3JlLmhhcyhrZXkpKSB7XG4gICAgY29uc3QgZXh0YW50ID0gbWFwU3RvcmUuZ2V0KGtleSk7XG4gICAgbWFwU3RvcmUuc2V0KGtleSwgaGFyZGVuKFsuLi5leHRhbnQsIGl0ZW1dKSk7XG4gIH0gZWxzZSB7XG4gICAgbWFwU3RvcmUuaW5pdChrZXksIGhhcmRlbihbaXRlbV0pKTtcbiAgfVxufTtcbmhhcmRlbihhcHBlbmRUb1N0b3JlZEFycmF5Mik7XG5cbi8vXG52YXIgbWFrZVNldFN0b3JlTWV0aG9kczIgPSAoanNzZXQsIGFzc2VydEtleU9rVG9BZGQsIGFzc2VydEtleU9rVG9EZWxldGUgPSB2b2lkIDAsIGtleU5hbWUgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IHsgYXNzZXJ0VXBkYXRlT25BZGQsIGFzc2VydFVwZGF0ZU9uRGVsZXRlLCBpdGVyYWJsZUtleXMgfSA9IG1ha2VDdXJyZW50S2V5c0tpdDIoXG4gICAgKCkgPT4ganNzZXQua2V5cygpLFxuICAgIChrKSA9PiBqc3NldC5oYXMoayksXG4gICAgY29tcGFyZVJhbmssXG4gICAgYXNzZXJ0S2V5T2tUb0FkZCxcbiAgICBhc3NlcnRLZXlPa1RvRGVsZXRlLFxuICAgIGtleU5hbWVcbiAgKTtcbiAgY29uc3Qga2V5czUgPSAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ga2V5UGF0dCA9PT0gdm9pZCAwID8gaXRlcmFibGVLZXlzIDogZmlsdGVySXRlcmFibGUoaXRlcmFibGVLZXlzLCAoaykgPT4gbWF0Y2hlcyhrLCBrZXlQYXR0KSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIC4uLm1ha2VXZWFrU2V0U3RvcmVNZXRob2RzMihcbiAgICAgIGpzc2V0LFxuICAgICAgYXNzZXJ0VXBkYXRlT25BZGQsXG4gICAgICBhc3NlcnRVcGRhdGVPbkRlbGV0ZSxcbiAgICAgIGtleU5hbWVcbiAgICApLFxuICAgIGtleXM6IGtleXM1LFxuICAgIHZhbHVlczoga2V5czUsXG4gICAgc25hcHNob3Q6IChrZXlQYXR0ID0gdm9pZCAwKSA9PiBtYWtlQ29weVNldChrZXlzNShrZXlQYXR0KSksXG4gICAgZ2V0U2l6ZTogKGtleVBhdHQgPSB2b2lkIDApID0+IGtleVBhdHQgPT09IHZvaWQgMCA/IGpzc2V0LnNpemUgOiBbLi4ua2V5czUoa2V5UGF0dCldLmxlbmd0aCxcbiAgICBjbGVhcjogKGtleVBhdHQgPSB2b2lkIDApID0+IHtcbiAgICAgIGlmIChrZXlQYXR0ID09PSB2b2lkIDApIHtcbiAgICAgICAganNzZXQuY2xlYXIoKTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXM1KGtleVBhdHQpKSB7XG4gICAgICAgIGpzc2V0LmRlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xudmFyIG1ha2VTY2FsYXJTZXRTdG9yZTIgPSAodGFnID0gXCJrZXlcIiwgeyBrZXlTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNzZXQgPSAvKiAgICAgICAgICAgKi8gbmV3IFNldCgpO1xuICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oa2V5U2hhcGUpO1xuICB9XG4gIGNvbnN0IGFzc2VydEtleU9rVG9BZGQgPSAoa2V5KSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgYXNzZXJ0U2NhbGFyS2V5KGtleSk7XG4gICAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaChrZXksIGtleVNoYXBlLCBcInNldFN0b3JlIGtleVwiKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBGYXIoYHNjYWxhciBTZXRTdG9yZSBvZiAke3F1b3RlKHRhZyl9YCwge1xuICAgIC4uLm1ha2VTZXRTdG9yZU1ldGhvZHMyKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCB2b2lkIDAsIHRhZylcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJTZXRTdG9yZTIpO1xuXG4vL1xudmFyIG1ha2VXZWFrTWFwU3RvcmVNZXRob2RzMiA9IChqc21hcCwgYXNzZXJ0S1ZPa1RvQWRkLCBhc3NlcnRLVk9rVG9TZXQsIGFzc2VydEtleU9rVG9EZWxldGUgPSB2b2lkIDAsIGtleU5hbWUgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IGFzc2VydEtleURvZXNOb3RFeGlzdCA9IChrZXkpID0+ICFqc21hcC5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUoa2V5TmFtZSl9IGFscmVhZHkgcmVnaXN0ZXJlZDogJHtrZXl9YDtcbiAgY29uc3QgYXNzZXJ0S2V5RXhpc3RzID0gKGtleSkgPT4ganNtYXAuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKGtleU5hbWUpfSBub3QgZm91bmQ6ICR7a2V5fWA7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGhhczogKGtleSkgPT4ge1xuICAgICAgcmV0dXJuIGpzbWFwLmhhcyhrZXkpO1xuICAgIH0sXG4gICAgZ2V0OiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgICAganNtYXAuZ2V0KGtleSlcbiAgICAgICk7XG4gICAgfSxcbiAgICBpbml0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RG9lc05vdEV4aXN0KGtleSk7XG4gICAgICBhc3NlcnRLVk9rVG9BZGQoa2V5LCB2YWx1ZSk7XG4gICAgICBqc21hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBzZXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIGFzc2VydEtWT2tUb1NldChrZXksIHZhbHVlKTtcbiAgICAgIGpzbWFwLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBpZiAoYXNzZXJ0S2V5T2tUb0RlbGV0ZSAhPT0gdm9pZCAwKSB7XG4gICAgICAgIGFzc2VydEtleU9rVG9EZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICAgIGpzbWFwLmRlbGV0ZShrZXkpO1xuICAgIH0sXG4gICAgYWRkQWxsOiAoZW50cmllczExKSA9PiB7XG4gICAgICBpZiAodHlwZW9mIGVudHJpZXMxMVtTeW1ib2wuaXRlcmF0b3JdICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgaWYgKE9iamVjdC5pc0Zyb3plbihlbnRyaWVzMTEpICYmIGlzQ29weU1hcChlbnRyaWVzMTEpKSB7XG4gICAgICAgICAgZW50cmllczExID0gZ2V0Q29weU1hcEVudHJpZXMoZW50cmllczExKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvd1JlZGFjdGVkYHByb3ZpZGVkIGRhdGEgc291cmNlIGlzIG5vdCBpdGVyYWJsZTogJHtlbnRyaWVzMTF9YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChcbiAgICAgICAgY29uc3QgW2tleSwgdmFsdWVdIG9mXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZW50cmllczExXG4gICAgICApIHtcbiAgICAgICAgYXNzZXJ0S1ZPa1RvQWRkKGtleSwgdmFsdWUpO1xuICAgICAgICBqc21hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgbWFrZVNjYWxhcldlYWtNYXBTdG9yZTIgPSAodGFnID0gXCJrZXlcIiwgeyBsb25nTGl2ZWQgPSB0cnVlLCBrZXlTaGFwZSA9IHZvaWQgMCwgdmFsdWVTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNtYXAgPSBuZXcgKGxvbmdMaXZlZCA/IFdlYWtNYXAgOiBNYXApKCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4odmFsdWVTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S1ZPa1RvU2V0ID0gKF9rZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKHZhbHVlKTtcbiAgICBhc3NlcnRQYXNzYWJsZSh2YWx1ZSk7XG4gICAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKHZhbHVlLCB2YWx1ZVNoYXBlLCBcIndlYWtNYXBTdG9yZSB2YWx1ZVwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFzc2VydEtWT2tUb0FkZCA9IChrZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgcGFzc1N0eWxlT2Yoa2V5KSA9PT0gXCJyZW1vdGFibGVcIiB8fCB0aHJvd1JlZGFjdGVkYE9ubHkgcmVtb3RhYmxlcyBjYW4gYmUga2V5cyBvZiBzY2FsYXIgV2Vha01hcFN0b3JlczogJHtrZXl9YDtcbiAgICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKGtleSwga2V5U2hhcGUsIFwid2Vha01hcFN0b3JlIGtleVwiKTtcbiAgICB9XG4gICAgYXNzZXJ0S1ZPa1RvU2V0KGtleSwgdmFsdWUpO1xuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgV2Vha01hcFN0b3JlIG9mICR7cXVvdGUodGFnKX1gLCB7XG4gICAgLi4ubWFrZVdlYWtNYXBTdG9yZU1ldGhvZHMyKFxuICAgICAganNtYXAsXG4gICAgICBhc3NlcnRLVk9rVG9BZGQsXG4gICAgICBhc3NlcnRLVk9rVG9TZXQsXG4gICAgICB2b2lkIDAsXG4gICAgICB0YWdcbiAgICApXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU2NhbGFyV2Vha01hcFN0b3JlMik7XG5cbi8vXG52YXIgbWFrZU1hcFN0b3JlTWV0aG9kczIgPSAoanNtYXAsIGFzc2VydEtWT2tUb0FkZCwgYXNzZXJ0S1ZPa1RvU2V0LCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCB0YWcgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IHsgYXNzZXJ0VXBkYXRlT25BZGQsIGFzc2VydFVwZGF0ZU9uRGVsZXRlLCBpdGVyYWJsZUtleXMgfSA9IG1ha2VDdXJyZW50S2V5c0tpdDIoXG4gICAgKCkgPT4ganNtYXAua2V5cygpLFxuICAgIChrKSA9PiBqc21hcC5oYXMoayksXG4gICAgY29tcGFyZVJhbmssXG4gICAgYXNzZXJ0S1ZPa1RvQWRkLFxuICAgIGFzc2VydEtleU9rVG9EZWxldGUsXG4gICAgdGFnXG4gICk7XG4gIGNvbnN0IGtleXM1ID0gKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4ge1xuICAgIGlmIChrZXlQYXR0ID09PSB2b2lkIDAgJiYgdmFsdWVQYXR0ID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBpdGVyYWJsZUtleXM7XG4gICAgfVxuICAgIGNvbnN0IGZpbHRlciA9IChrKSA9PiB7XG4gICAgICBpZiAoa2V5UGF0dCAhPT0gdm9pZCAwICYmICFtYXRjaGVzKGssIGtleVBhdHQpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmICh2YWx1ZVBhdHQgIT09IHZvaWQgMCAmJiAhbWF0Y2hlcyhqc21hcC5nZXQoayksIHZhbHVlUGF0dCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcbiAgICByZXR1cm4gZmlsdGVySXRlcmFibGUoaXRlcmFibGVLZXlzLCBmaWx0ZXIpO1xuICB9O1xuICBjb25zdCB2YWx1ZXM4ID0gKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4gbWFwSXRlcmFibGUoa2V5czUoa2V5UGF0dCwgdmFsdWVQYXR0KSwgKGspID0+IChcbiAgICAvKiAgICAgICAgICAgICovXG4gICAganNtYXAuZ2V0KGspXG4gICkpO1xuICBjb25zdCBlbnRyaWVzMTEgPSAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBtYXBJdGVyYWJsZShrZXlzNShrZXlQYXR0LCB2YWx1ZVBhdHQpLCAoaykgPT4gW1xuICAgIGssXG4gICAgLyogICAgICAgICAgICAqL1xuICAgIGpzbWFwLmdldChrKVxuICBdKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgLi4ubWFrZVdlYWtNYXBTdG9yZU1ldGhvZHMyKFxuICAgICAganNtYXAsXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgYXNzZXJ0VXBkYXRlT25BZGQsXG4gICAgICBhc3NlcnRLVk9rVG9TZXQsXG4gICAgICBhc3NlcnRVcGRhdGVPbkRlbGV0ZSxcbiAgICAgIHRhZ1xuICAgICksXG4gICAga2V5czoga2V5czUsXG4gICAgdmFsdWVzOiB2YWx1ZXM4LFxuICAgIGVudHJpZXM6IGVudHJpZXMxMSxcbiAgICBzbmFwc2hvdDogKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4gbWFrZUNvcHlNYXAoZW50cmllczExKGtleVBhdHQsIHZhbHVlUGF0dCkpLFxuICAgIGdldFNpemU6IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IGtleVBhdHQgPT09IHZvaWQgMCAmJiB2YWx1ZVBhdHQgPT09IHZvaWQgMCA/IGpzbWFwLnNpemUgOiBbLi4ua2V5czUoa2V5UGF0dCwgdmFsdWVQYXR0KV0ubGVuZ3RoLFxuICAgIGNsZWFyOiAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiB7XG4gICAgICBpZiAoa2V5UGF0dCA9PT0gdm9pZCAwICYmIHZhbHVlUGF0dCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGpzbWFwLmNsZWFyKCk7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzNShrZXlQYXR0LCB2YWx1ZVBhdHQpKSB7XG4gICAgICAgIGpzbWFwLmRlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xudmFyIG1ha2VTY2FsYXJNYXBTdG9yZTIgPSAodGFnID0gXCJrZXlcIiwgeyBrZXlTaGFwZSA9IHZvaWQgMCwgdmFsdWVTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNtYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oa2V5U2hhcGUpO1xuICB9XG4gIGlmICh2YWx1ZVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKHZhbHVlU2hhcGUpO1xuICB9XG4gIGNvbnN0IGFzc2VydEtWT2tUb1NldCA9IChfa2V5LCB2YWx1ZSkgPT4ge1xuICAgIGhhcmRlbih2YWx1ZSk7XG4gICAgYXNzZXJ0UGFzc2FibGUodmFsdWUpO1xuICAgIGlmICh2YWx1ZVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaCh2YWx1ZSwgdmFsdWVTaGFwZSwgXCJtYXBTdG9yZSB2YWx1ZVwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFzc2VydEtWT2tUb0FkZCA9IChrZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgYXNzZXJ0U2NhbGFyS2V5KGtleSk7XG4gICAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaChrZXksIGtleVNoYXBlLCBcIm1hcFN0b3JlIGtleVwiKTtcbiAgICB9XG4gICAgYXNzZXJ0S1ZPa1RvU2V0KGtleSwgdmFsdWUpO1xuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgTWFwU3RvcmUgb2YgJHtxdW90ZSh0YWcpfWAsIHtcbiAgICAuLi5tYWtlTWFwU3RvcmVNZXRob2RzMihcbiAgICAgIGpzbWFwLFxuICAgICAgYXNzZXJ0S1ZPa1RvQWRkLFxuICAgICAgYXNzZXJ0S1ZPa1RvU2V0LFxuICAgICAgdm9pZCAwLFxuICAgICAgdGFnXG4gICAgKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZVNjYWxhck1hcFN0b3JlMik7XG5cbi8vXG52YXIgbWFrZUxlZ2FjeU1hcDIgPSAodGFnID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCBtMiA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIGNvbnN0IGFzc2VydEtleURvZXNOb3RFeGlzdCA9IChrZXkpID0+ICFtMi5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gYWxyZWFkeSByZWdpc3RlcmVkOiAke2tleX1gO1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiBtMi5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiBtMi5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGluaXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlEb2VzTm90RXhpc3Qoa2V5KTtcbiAgICAgIG0yLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICByZXR1cm4gbTIuZ2V0KGtleSk7XG4gICAgfSxcbiAgICBzZXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIG0yLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBtMi5kZWxldGUoa2V5KTtcbiAgICB9LFxuICAgIGtleXM6ICgpID0+IG0yLmtleXMoKSxcbiAgICB2YWx1ZXM6ICgpID0+IG0yLnZhbHVlcygpLFxuICAgIGVudHJpZXM6ICgpID0+IG0yLmVudHJpZXMoKSxcbiAgICBnZXRTaXplOiAoKSA9PiBtMi5zaXplLFxuICAgIGNsZWFyOiAoKSA9PiBtMi5jbGVhcigpXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlTGVnYWN5TWFwMik7XG5cbi8vXG52YXIgbWFrZUxlZ2FjeVdlYWtNYXAyID0gKHRhZyA9IFwia2V5XCIpID0+IHtcbiAgY29uc3Qgd20gPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgYXNzZXJ0S2V5RG9lc05vdEV4aXN0ID0gKGtleSkgPT4gIXdtLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBhbHJlYWR5IHJlZ2lzdGVyZWQ6ICR7a2V5fWA7XG4gIGNvbnN0IGFzc2VydEtleUV4aXN0cyA9IChrZXkpID0+IHdtLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBub3QgZm91bmQ6ICR7a2V5fWA7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGhhczogKGtleSkgPT4ge1xuICAgICAgcmV0dXJuIHdtLmhhcyhrZXkpO1xuICAgIH0sXG4gICAgaW5pdDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleURvZXNOb3RFeGlzdChrZXkpO1xuICAgICAgd20uc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZ2V0OiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgICAgd20uZ2V0KGtleSlcbiAgICAgICk7XG4gICAgfSxcbiAgICBzZXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHdtLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICB3bS5kZWxldGUoa2V5KTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihtYWtlTGVnYWN5V2Vha01hcDIpO1xuXG4vL1xudmFyIG1ha2VDb252ZXJ0ID0gKGNvbnZlcnRSZW1vdGFibGUsIGNvbnZlcnRQcm9taXNlT3JWb3csIGNvbnZlcnRFcnJvcikgPT4ge1xuICBjb25zdCBjb252ZXJ0UmVjdXIgPSAoc3BlY2ltZW4sIGxhYmVsKSA9PiB7XG4gICAgaWYgKGxhYmVsID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBpbm5lckNvbnZlcnQoc3BlY2ltZW4pO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGlubmVyQ29udmVydChzcGVjaW1lbik7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICB0aHJvd0xhYmVsZWQoZXJyLCBsYWJlbCk7XG4gICAgfVxuICB9O1xuICBjb25zdCBpbm5lckNvbnZlcnQgPSAoc3BlY2ltZW4pID0+IHtcbiAgICBpZiAoaXNQcmltaXRpdmUyKHNwZWNpbWVuKSkge1xuICAgICAgcmV0dXJuIHNwZWNpbWVuO1xuICAgIH1cbiAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihzcGVjaW1lbik7XG4gICAgc3dpdGNoIChwYXNzU3R5bGUpIHtcbiAgICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgICByZXR1cm4gc3BlY2ltZW4ubWFwKChlbGVtZW50LCBpMikgPT4gY29udmVydFJlY3VyKGVsZW1lbnQsIGkyKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIHJldHVybiBvYmplY3RNYXAoc3BlY2ltZW4sICh2YWx1ZSwgbmFtZSkgPT4gY29udmVydFJlY3VyKHZhbHVlLCBuYW1lKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgaWYgKGlzVm93KHNwZWNpbWVuKSkge1xuICAgICAgICAgIHJldHVybiBjb252ZXJ0UHJvbWlzZU9yVm93KHNwZWNpbWVuKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0YWcgPSBnZXRUYWcoc3BlY2ltZW4pO1xuICAgICAgICBjb25zdCB7IHBheWxvYWQgfSA9IHNwZWNpbWVuO1xuICAgICAgICByZXR1cm4gbWFrZVRhZ2dlZCh0YWcsIGNvbnZlcnRSZWN1cihwYXlsb2FkLCBgJHt0YWd9IHBheWxvYWRgKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZXJyb3JcIjoge1xuICAgICAgICByZXR1cm4gY29udmVydEVycm9yKHNwZWNpbWVuKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJyZW1vdGFibGVcIjoge1xuICAgICAgICByZXR1cm4gY29udmVydFJlbW90YWJsZShzcGVjaW1lbik7XG4gICAgICB9XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIHJldHVybiBjb252ZXJ0UHJvbWlzZU9yVm93KHNwZWNpbWVuKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIHBhc3NTdHlsZSAke3F1b3RlKHBhc3NTdHlsZSl9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IGNvbnZlcnQgPSAoc3BlY2ltZW4sIGxhYmVsID0gdm9pZCAwKSA9PiBjb252ZXJ0UmVjdXIoaGFyZGVuKHNwZWNpbWVuKSwgbGFiZWwpO1xuICByZXR1cm4gaGFyZGVuKGNvbnZlcnQpO1xufTtcbnZhciBtYWtlQ29udmVydEtpdCA9IChiaWplY3Rpb24sIG1ha2VHdWVzdEZvckhvc3RSZW1vdGFibGUsIG1ha2VHdWVzdEZvckhvc3RWb3cpID0+IHtcbiAgY29uc3QgZ3Vlc3RUb0hvc3QgPSBtYWtlQ29udmVydChcbiAgICAoZ1JlbSkgPT4ge1xuICAgICAgaWYgKGJpamVjdGlvbi5oYXNHdWVzdChnUmVtKSkge1xuICAgICAgICByZXR1cm4gYmlqZWN0aW9uLmd1ZXN0VG9Ib3N0KGdSZW0pO1xuICAgICAgfVxuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBjYW5ub3QgeWV0IHNlbmQgZ3Vlc3QgcmVtb3RhYmxlcyAke2dSZW19YDtcbiAgICB9LFxuICAgIChnUHJvbSkgPT4ge1xuICAgICAgaWYgKGJpamVjdGlvbi5oYXNHdWVzdChnUHJvbSkpIHtcbiAgICAgICAgcmV0dXJuIGJpamVjdGlvbi5ndWVzdFRvSG9zdChnUHJvbSk7XG4gICAgICB9XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGNhbm5vdCB5ZXQgc2VuZCBndWVzdCBwcm9taXNlcyAke2dQcm9tfWA7XG4gICAgfSxcbiAgICAoZ0VycikgPT4ge1xuICAgICAgY29uc3QgaEVyciA9IGhhcmRlbihcbiAgICAgICAgbWFrZUVycm9yKGdFcnIubWVzc2FnZSwgZ2V0RXJyb3JDb25zdHJ1Y3RvcihnRXJyLm5hbWUpKVxuICAgICAgKTtcbiAgICAgIG5vdGUoaEVyciwgcmVkYWN0ZWRgZnJvbSBndWVzdCBlcnJvciAke2dFcnJ9YCk7XG4gICAgICByZXR1cm4gaEVycjtcbiAgICB9XG4gICk7XG4gIGNvbnN0IGhvc3RUb0d1ZXN0ID0gbWFrZUNvbnZlcnQoXG4gICAgKGhSZW0pID0+IHtcbiAgICAgIGlmIChiaWplY3Rpb24uaGFzSG9zdChoUmVtKSkge1xuICAgICAgICByZXR1cm4gYmlqZWN0aW9uLmhvc3RUb0d1ZXN0KGhSZW0pO1xuICAgICAgfVxuICAgICAgY29uc3QgZ1JlbSA9IG1ha2VHdWVzdEZvckhvc3RSZW1vdGFibGUoaFJlbSk7XG4gICAgICByZXR1cm4gYmlqZWN0aW9uLnVud3JhcEluaXQoZ1JlbSwgaFJlbSk7XG4gICAgfSxcbiAgICAoaFZvdykgPT4ge1xuICAgICAgaWYgKGJpamVjdGlvbi5oYXNIb3N0KGhWb3cpKSB7XG4gICAgICAgIHJldHVybiBiaWplY3Rpb24uaG9zdFRvR3Vlc3QoaFZvdyk7XG4gICAgICB9XG4gICAgICBjb25zdCBnUCA9IG1ha2VHdWVzdEZvckhvc3RWb3coaFZvdyk7XG4gICAgICByZXR1cm4gYmlqZWN0aW9uLnVud3JhcEluaXQoZ1AsIGhWb3cpO1xuICAgIH0sXG4gICAgKGhFcnIpID0+IHtcbiAgICAgIGNvbnN0IGdFcnIgPSBoYXJkZW4oXG4gICAgICAgIG1ha2VFcnJvcihoRXJyLm1lc3NhZ2UsIGdldEVycm9yQ29uc3RydWN0b3IoaEVyci5uYW1lKSlcbiAgICAgICk7XG4gICAgICBub3RlKGdFcnIsIHJlZGFjdGVkYGZyb20gaG9zdCBlcnJvciAke2hFcnJ9YCk7XG4gICAgICByZXR1cm4gZ0VycjtcbiAgICB9XG4gICk7XG4gIHJldHVybiBoYXJkZW4oeyBndWVzdFRvSG9zdCwgaG9zdFRvR3Vlc3QgfSk7XG59O1xuaGFyZGVuKG1ha2VDb252ZXJ0S2l0KTtcblxuLy9cbnZhciB7IGlzOiBpczUgfSA9IE9iamVjdDtcbnZhciBtYWtlRXF1YXRlID0gKGJpamVjdGlvbikgPT4ge1xuICBjb25zdCBlcXVhdGUgPSAoZzIsIGgsIGxhYmVsKSA9PiB7XG4gICAgaWYgKGxhYmVsID09PSB2b2lkIDApIHtcbiAgICAgIGlubmVyRXF1YXRlKGcyLCBoKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGlubmVyRXF1YXRlKGcyLCBoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHRocm93TGFiZWxlZChlcnIsIGxhYmVsKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGlubmVyRXF1YXRlID0gKGcyLCBoKSA9PiB7XG4gICAgaWYgKGlzUHJpbWl0aXZlMihnMikpIHtcbiAgICAgIGlzNShnMiwgaCkgfHwgLy9cbiAgICAgIHRocm93UmVkYWN0ZWRgdW5lcXVhbCAke2cyfSB2cyAke2h9YDtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGJpamVjdGlvbi5oYXNHdWVzdChnMikgJiYgYmlqZWN0aW9uLmd1ZXN0VG9Ib3N0KGcyKSA9PT0gaCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBnUGFzc1N0eWxlID0gcGFzc1N0eWxlT2YoZzIpO1xuICAgIGlmIChnUGFzc1N0eWxlID09PSBcInByb21pc2VcIiAmJiBpc1ZvdyhoKSkge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBndWVzdCBwcm9taXNlcyBub3QgeWV0IHBhc3NhYmxlYDtcbiAgICB9XG4gICAgY29uc3QgaFBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKGgpO1xuICAgIGdQYXNzU3R5bGUgPT09IGhQYXNzU3R5bGUgfHwgdGhyb3dSZWRhY3RlZGB1bmVxdWFsIHBhc3NTdHlsZXMgJHtxdW90ZShnUGFzc1N0eWxlKX0gdnMgJHtxdW90ZShoUGFzc1N0eWxlKX1gO1xuICAgIHN3aXRjaCAoZ1Bhc3NTdHlsZSkge1xuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIGVxdWF0ZShnMi5sZW5ndGgsIGgubGVuZ3RoLCBcImxlbmd0aFwiKTtcbiAgICAgICAgZzIuZm9yRWFjaCgoZ0VsLCBpMikgPT4gZXF1YXRlKGdFbCwgaFtpMl0sIGkyKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgICAgY29uc3QgZ05hbWVzID0gcmVjb3JkTmFtZXMoZzIpO1xuICAgICAgICBjb25zdCBoTmFtZXMgPSByZWNvcmROYW1lcyhoKTtcbiAgICAgICAgZXF1YXRlKGdOYW1lcywgaE5hbWVzLCBcInByb3BlcnR5TmFtZXNcIik7XG4gICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBnTmFtZXMpIHtcbiAgICAgICAgICBlcXVhdGUoZzJbbmFtZV0sIGhbbmFtZV0sIG5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICBlcXVhdGUoZ2V0VGFnKGcyKSwgZ2V0VGFnKGgpLCBcInRhZ1wiKTtcbiAgICAgICAgZXF1YXRlKGcyLnBheWxvYWQsIGgucGF5bG9hZCwgXCJwYXlsb2FkXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjYXNlIFwiZXJyb3JcIjoge1xuICAgICAgICBlcXVhdGUoZzIubmFtZSwgaC5uYW1lLCBcImVycm9yIG5hbWVcIik7XG4gICAgICAgIG5vdGUoZzIsIHJlZGFjdGVkYHJlcGxheSBvZiBlcnJvciAke2h9YCk7XG4gICAgICAgIG5vdGUoaCwgcmVkYWN0ZWRgcmVwbGF5ZWQgYXMgZXJyb3IgJHtnMn1gKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgY2Fubm90IHlldCBzZW5kIGd1ZXN0IHJlbW90YWJsZXMgdG8gaG9zdCAke2cyfSB2cyAke2h9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBjYW5ub3QgeWV0IHNlbmQgZ3Vlc3QgcHJvbWlzZXMgdG8gaG9zdCAke2cyfSB2cyAke2h9YDtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIHBhc3NTdHlsZSAke3F1b3RlKGdQYXNzU3R5bGUpfWA7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gaGFyZGVuKGVxdWF0ZSk7XG59O1xuaGFyZGVuKG1ha2VFcXVhdGUpO1xuXG4vL1xudmFyIHsgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzOSwgZGVmaW5lUHJvcGVydGllczogZGVmaW5lUHJvcGVydGllczUsIGFzc2lnbjogYXNzaWduMyB9ID0gT2JqZWN0O1xudmFyIG1ha2VSZXBsYXlNZW1icmFuZSA9IChhcmcpID0+IHtcbiAgY29uc3Qgbm9EdW5kZXJBcmcgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAqL1xuICAgIE9iamVjdC5mcm9tRW50cmllcyhPYmplY3QuZW50cmllcyhhcmcpLmZpbHRlcigoW2tdKSA9PiAhay5zdGFydHNXaXRoKFwiX19cIikpKVxuICApO1xuICByZXR1cm4gbWFrZVJlcGxheU1lbWJyYW5lRm9yVGVzdGluZyhub0R1bmRlckFyZyk7XG59O1xudmFyIG1ha2VSZXBsYXlNZW1icmFuZUZvclRlc3RpbmcgPSAoe1xuICBsb2csXG4gIGJpamVjdGlvbixcbiAgdm93VG9vbHMsXG4gIHdhdGNoV2FrZSxcbiAgcGFuaWMsXG4gIF9fZXZlbnR1YWxTZW5kRm9yVGVzdGluZ1xufSkgPT4ge1xuICBjb25zdCB7IHdoZW4sIG1ha2VWb3dLaXQgfSA9IHZvd1Rvb2xzO1xuICBjb25zdCBlcXVhdGUgPSBtYWtlRXF1YXRlKGJpamVjdGlvbik7XG4gIGNvbnN0IGd1ZXN0UHJvbWlzZU1hcCA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBsZXQgc3RvcHBlZCA9IGZhbHNlO1xuICBjb25zdCBQYW5pYyA9ICh0ZW1wbGF0ZSwgLi4uYXJncykgPT4gcGFuaWMobWFrZUVycm9yKHJlZGFjdGVkKHRlbXBsYXRlLCAuLi5hcmdzKSkpO1xuICBjb25zdCBzdGFydEdlbmVyYXRpb24gPSAoZ2VuZXJhdGlvbikgPT4ge1xuICAgIE51bWJlci5pc1NhZmVJbnRlZ2VyKGdlbmVyYXRpb24pIHx8IHRocm93UmVkYWN0ZWRgZ2VuZXJhdGlvbiBleHBlY3RlZCBpbnRlZ2VyOyBnb3QgJHtnZW5lcmF0aW9ufWA7XG4gICAgZ2VuZXJhdGlvbiA+PSAwIHx8IHRocm93UmVkYWN0ZWRgZ2VuZXJhdGlvbiBleHBlY3RlZCBub24tbmVnYXRpdmU7IGdvdCAke2dlbmVyYXRpb259YDtcbiAgfTtcbiAgY29uc3QgZG9GdWxmaWxsID0gKGhvc3RWb3csIGhvc3RGdWxmaWxsbWVudCkgPT4ge1xuICAgIGNvbnN0IGd1ZXN0UHJvbWlzZSA9IGhvc3RUb0d1ZXN0KGhvc3RWb3cpO1xuICAgIGNvbnN0IHN0YXR1cyA9IGd1ZXN0UHJvbWlzZU1hcC5nZXQoZ3Vlc3RQcm9taXNlKTtcbiAgICBpZiAoIXN0YXR1cyB8fCBzdGF0dXMgPT09IFwic2V0dGxlZFwiKSB7XG4gICAgICB0aHJvd1JlZGFjdGVkYGRvRnVsZmlsbCBzaG91bGQgb25seSBiZSBjYWxsZWQgb24gYSByZWdpc3RlcmVkIHVucmVzb2x2ZWQgcHJvbWlzZWA7XG4gICAgfVxuICAgIGNvbnN0IGd1ZXN0RnVsZmlsbG1lbnQgPSBob3N0VG9HdWVzdChob3N0RnVsZmlsbG1lbnQpO1xuICAgIHN0YXR1cy5yZXNvbHZlKGd1ZXN0RnVsZmlsbG1lbnQpO1xuICAgIGd1ZXN0UHJvbWlzZU1hcC5zZXQoZ3Vlc3RQcm9taXNlLCBcInNldHRsZWRcIik7XG4gIH07XG4gIGNvbnN0IGRvUmVqZWN0ID0gKGhvc3RWb3csIGhvc3RSZWFzb24pID0+IHtcbiAgICBjb25zdCBndWVzdFByb21pc2UgPSBob3N0VG9HdWVzdChob3N0Vm93KTtcbiAgICBjb25zdCBzdGF0dXMgPSBndWVzdFByb21pc2VNYXAuZ2V0KGd1ZXN0UHJvbWlzZSk7XG4gICAgaWYgKCFzdGF0dXMgfHwgc3RhdHVzID09PSBcInNldHRsZWRcIikge1xuICAgICAgdGhyb3dSZWRhY3RlZGBkb1JlamVjdCBzaG91bGQgb25seSBiZSBjYWxsZWQgb24gYSByZWdpc3RlcmVkIHVucmVzb2x2ZWQgcHJvbWlzZWA7XG4gICAgfVxuICAgIGNvbnN0IGd1ZXN0UmVhc29uID0gaG9zdFRvR3Vlc3QoaG9zdFJlYXNvbik7XG4gICAgc3RhdHVzLnJlamVjdChndWVzdFJlYXNvbik7XG4gICAgZ3Vlc3RQcm9taXNlTWFwLnNldChndWVzdFByb21pc2UsIFwic2V0dGxlZFwiKTtcbiAgfTtcbiAgY29uc3QgZG9SZXR1cm4gPSAoY2FsbEluZGV4LCBob3N0UmVzdWx0KSA9PiB7XG4gICAgdW5uZXN0SW50ZXJwcmV0ZXIoY2FsbEluZGV4KTtcbiAgICBjb25zdCBndWVzdFJlc3VsdCA9IGhvc3RUb0d1ZXN0KGhvc3RSZXN1bHQpO1xuICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAga2luZDogXCJyZXR1cm5cIixcbiAgICAgIHJlc3VsdDogZ3Vlc3RSZXN1bHRcbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgZG9UaHJvdyA9IChjYWxsSW5kZXgsIGhvc3RQcm9ibGVtKSA9PiB7XG4gICAgdW5uZXN0SW50ZXJwcmV0ZXIoY2FsbEluZGV4KTtcbiAgICBjb25zdCBndWVzdFByb2JsZW0gPSBob3N0VG9HdWVzdChob3N0UHJvYmxlbSk7XG4gICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICBraW5kOiBcInRocm93XCIsXG4gICAgICBwcm9ibGVtOiBndWVzdFByb2JsZW1cbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgcGVyZm9ybUNhbGwgPSAoaG9zdFRhcmdldCwgb3B0VmVyYiwgaG9zdEFyZ3MsIGNhbGxJbmRleCkgPT4ge1xuICAgIGxldCBob3N0UmVzdWx0O1xuICAgIHRyeSB7XG4gICAgICBob3N0UmVzdWx0ID0gb3B0VmVyYiA/IGhvc3RUYXJnZXRbb3B0VmVyYl0oLi4uaG9zdEFyZ3MpIDogaG9zdFRhcmdldCguLi5ob3N0QXJncyk7XG4gICAgICBob3N0VG9HdWVzdChob3N0UmVzdWx0LCBgY29udmVydGluZyAke29wdFZlcmIgfHwgXCJob3N0XCJ9IHJlc3VsdGApO1xuICAgIH0gY2F0Y2ggKGhvc3RQcm9ibGVtKSB7XG4gICAgICByZXR1cm4gbG9nRG8obmVzdERpc3BhdGNoLCBoYXJkZW4oW1wiZG9UaHJvd1wiLCBjYWxsSW5kZXgsIGhvc3RQcm9ibGVtXSkpO1xuICAgIH1cbiAgICByZXR1cm4gbG9nRG8obmVzdERpc3BhdGNoLCBoYXJkZW4oW1wiZG9SZXR1cm5cIiwgY2FsbEluZGV4LCBob3N0UmVzdWx0XSkpO1xuICB9O1xuICBjb25zdCBndWVzdENhbGxzSG9zdCA9IChndWVzdFRhcmdldCwgb3B0VmVyYiwgZ3Vlc3RBcmdzLCBjYWxsSW5kZXgpID0+IHtcbiAgICBpZiAoc3RvcHBlZCB8fCAhYmlqZWN0aW9uLmhhc0d1ZXN0KGd1ZXN0VGFyZ2V0KSkge1xuICAgICAgY29uc3QgZXh0cmFEaWFnbm9zdGljID0gY2FsbFN0YWNrLmxlbmd0aCA9PT0gMCA/IFwiXCIgOiAoXG4gICAgICAgIC8vXG4gICAgICAgIGAgd2l0aCBub24tZW1wdHkgY2FsbHN0YWNrICR7cXVvdGUoY2FsbFN0YWNrKX07YFxuICAgICAgKTtcbiAgICAgIHRocm93UmVkYWN0ZWRgQ2FsbGVkIGZyb20gYSBwcmV2aW91cyBydW46ICR7Z3Vlc3RUYXJnZXR9JHtiYXJlT3JRdW90ZShleHRyYURpYWdub3N0aWMpfWA7XG4gICAgfVxuICAgIGxldCBvdXRjb21lO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBndWVzdEVudHJ5ID0gaGFyZGVuKFtcbiAgICAgICAgXCJjaGVja0NhbGxcIixcbiAgICAgICAgZ3Vlc3RUYXJnZXQsXG4gICAgICAgIG9wdFZlcmIsXG4gICAgICAgIGd1ZXN0QXJncyxcbiAgICAgICAgY2FsbEluZGV4XG4gICAgICBdKTtcbiAgICAgIGlmIChsb2cuaXNSZXBsYXlpbmcoKSkge1xuICAgICAgICBjb25zdCBlbnRyeSA9IGxvZy5uZXh0RW50cnkoKTtcbiAgICAgICAgZXF1YXRlKFxuICAgICAgICAgIGd1ZXN0RW50cnksXG4gICAgICAgICAgZW50cnksXG4gICAgICAgICAgYHJlcGxheSAke2NhbGxJbmRleH06XG4gICAgICR7cXVvdGUoZ3Vlc3RFbnRyeSl9XG4gIHZzICR7cXVvdGUoZW50cnkpfVxuICAgIGBcbiAgICAgICAgKTtcbiAgICAgICAgb3V0Y29tZSA9IC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgbmVzdEludGVycHJldGVyKGNhbGxJbmRleCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBlbnRyeSA9IGd1ZXN0VG9Ib3N0KGd1ZXN0RW50cnkpO1xuICAgICAgICBsb2cucHVzaEVudHJ5KGVudHJ5KTtcbiAgICAgICAgY29uc3QgW18sIC4uLmFyZ3NdID0gZW50cnk7XG4gICAgICAgIG5lc3RJbnRlcnByZXRlcihjYWxsSW5kZXgpO1xuICAgICAgICBvdXRjb21lID0gcGVyZm9ybUNhbGwoLi4uYXJncyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZmF0YWxFcnJvcikge1xuICAgICAgdGhyb3cgcGFuaWMoZmF0YWxFcnJvcik7XG4gICAgfVxuICAgIHN3aXRjaCAob3V0Y29tZS5raW5kKSB7XG4gICAgICBjYXNlIFwicmV0dXJuXCI6IHtcbiAgICAgICAgcmV0dXJuIG91dGNvbWUucmVzdWx0O1xuICAgICAgfVxuICAgICAgY2FzZSBcInRocm93XCI6IHtcbiAgICAgICAgdGhyb3cgb3V0Y29tZS5wcm9ibGVtO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyBQYW5pY2B1bmV4cGVjdGVkIG91dGNvbWUga2luZCAke3F1b3RlKG91dGNvbWUua2luZCl9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IHBlcmZvcm1TZW5kT25seSA9IChob3N0VGFyZ2V0LCBvcHRWZXJiLCBob3N0QXJncykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBvcHRWZXJiID09PSB2b2lkIDAgPyBoZWFwVm93RS5zZW5kT25seShob3N0VGFyZ2V0KSguLi5ob3N0QXJncykgOiBoZWFwVm93RS5zZW5kT25seShob3N0VGFyZ2V0KVtvcHRWZXJiXSguLi5ob3N0QXJncyk7XG4gICAgfSBjYXRjaCAoaG9zdFByb2JsZW0pIHtcbiAgICAgIHRocm93IFBhbmljYGludGVybmFsOiBldmVudHVhbCBzZW5kT25seSBzeW5jaHJvbm91c2x5IGZhaWxlZCAke2hvc3RQcm9ibGVtfWA7XG4gICAgfVxuICB9O1xuICBjb25zdCBwZXJmb3JtU2VuZCA9IChob3N0VGFyZ2V0LCBvcHRWZXJiLCBob3N0QXJncywgY2FsbEluZGV4LCBob3N0UmVzdWx0S2l0LCBndWVzdFJldHVybmVkUCkgPT4ge1xuICAgIGNvbnN0IHsgdm93LCByZXNvbHZlciB9ID0gaG9zdFJlc3VsdEtpdDtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaG9zdFByb21pc2UgPSBvcHRWZXJiID09PSB2b2lkIDAgPyBoZWFwVm93RShob3N0VGFyZ2V0KSguLi5ob3N0QXJncykgOiBoZWFwVm93RShob3N0VGFyZ2V0KVtvcHRWZXJiXSguLi5ob3N0QXJncyk7XG4gICAgICByZXNvbHZlci5yZXNvbHZlKGhvc3RQcm9taXNlKTtcbiAgICB9IGNhdGNoIChob3N0UHJvYmxlbSkge1xuICAgICAgdGhyb3cgUGFuaWNgaW50ZXJuYWw6IGV2ZW50dWFsIHNlbmQgc3luY2hyb25vdXNseSBmYWlsZWQgJHtob3N0UHJvYmxlbX1gO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgZW50cnkgPSBoYXJkZW4oW1wiZG9SZXR1cm5cIiwgY2FsbEluZGV4LCB2b3ddKTtcbiAgICAgIGxvZy5wdXNoRW50cnkoZW50cnkpO1xuICAgICAgY29uc3QgZ3Vlc3RQcm9taXNlID0gbWFrZUd1ZXN0Rm9ySG9zdFZvdyh2b3csIGd1ZXN0UmV0dXJuZWRQKTtcbiAgICAgIGRvUmV0dXJuKGNhbGxJbmRleCwgdm93KTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBraW5kOiBcInJldHVyblwiLFxuICAgICAgICByZXN1bHQ6IGd1ZXN0UHJvbWlzZVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAocHJvYmxlbSkge1xuICAgICAgdGhyb3cgcGFuaWMocHJvYmxlbSk7XG4gICAgfVxuICB9O1xuICBjb25zdCBndWVzdEhhbmRsZXIgPSBoYXJkZW4oe1xuICAgIGFwcGx5TWV0aG9kU2VuZE9ubHkoZ3Vlc3RUYXJnZXQsIG9wdFZlcmIsIGd1ZXN0QXJncykge1xuICAgICAgX19ldmVudHVhbFNlbmRGb3JUZXN0aW5nIHx8IFBhbmljYGd1ZXN0IGV2ZW50dWFsIGFwcGx5TWV0aG9kU2VuZE9ubHkgbm90IHlldCBzdXBwb3J0ZWQ6ICR7Z3Vlc3RUYXJnZXR9LiR7YmFyZU9yUXVvdGUob3B0VmVyYil9YDtcbiAgICAgIGNvbnN0IGNhbGxJbmRleCA9IGxvZy5nZXRJbmRleCgpO1xuICAgICAgaWYgKHN0b3BwZWQgfHwgIWJpamVjdGlvbi5oYXNHdWVzdChndWVzdFRhcmdldCkpIHtcbiAgICAgICAgdGhyb3dSZWRhY3RlZGBTZW50IGZyb20gYSBwcmV2aW91cyBydW46ICR7Z3Vlc3RUYXJnZXR9YDtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGd1ZXN0RW50cnkgPSBoYXJkZW4oW1xuICAgICAgICAgIFwiY2hlY2tTZW5kT25seVwiLFxuICAgICAgICAgIGd1ZXN0VGFyZ2V0LFxuICAgICAgICAgIG9wdFZlcmIsXG4gICAgICAgICAgZ3Vlc3RBcmdzLFxuICAgICAgICAgIGNhbGxJbmRleFxuICAgICAgICBdKTtcbiAgICAgICAgaWYgKGxvZy5pc1JlcGxheWluZygpKSB7XG4gICAgICAgICAgY29uc3QgZW50cnkgPSBsb2cubmV4dEVudHJ5KCk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGVxdWF0ZShndWVzdEVudHJ5LCBlbnRyeSk7XG4gICAgICAgICAgfSBjYXRjaCAoZXF1YXRlRXJyKSB7XG4gICAgICAgICAgICB0aHJvd0xhYmVsZWQoXG4gICAgICAgICAgICAgIGVxdWF0ZUVycixcbiAgICAgICAgICAgICAgYHJlcGxheSAke2NhbGxJbmRleH06XG4gICAgICR7cXVvdGUoZ3Vlc3RFbnRyeSl9XG4gIHZzICR7cXVvdGUoZW50cnkpfVxuICAgIGBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGVudHJ5ID0gZ3Vlc3RUb0hvc3QoZ3Vlc3RFbnRyeSk7XG4gICAgICAgICAgbG9nLnB1c2hFbnRyeShlbnRyeSk7XG4gICAgICAgICAgY29uc3QgW19vcCwgaG9zdFRhcmdldCwgX29wdFZlcmIsIGhvc3RBcmdzLCBfY2FsbEluZGV4XSA9IGVudHJ5O1xuICAgICAgICAgIHBlcmZvcm1TZW5kT25seShob3N0VGFyZ2V0LCBvcHRWZXJiLCBob3N0QXJncyk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGZhdGFsRXJyb3IpIHtcbiAgICAgICAgdGhyb3cgcGFuaWMoZmF0YWxFcnJvcik7XG4gICAgICB9XG4gICAgfSxcbiAgICBhcHBseU1ldGhvZChndWVzdFRhcmdldCwgb3B0VmVyYiwgZ3Vlc3RBcmdzLCBndWVzdFJldHVybmVkUCkge1xuICAgICAgX19ldmVudHVhbFNlbmRGb3JUZXN0aW5nIHx8IFBhbmljYGd1ZXN0IGV2ZW50dWFsIGFwcGx5TWV0aG9kIG5vdCB5ZXQgc3VwcG9ydGVkOiAke2d1ZXN0VGFyZ2V0fS4ke2JhcmVPclF1b3RlKG9wdFZlcmIpfSAtPiAke2JhcmVPclF1b3RlKGd1ZXN0UmV0dXJuZWRQKX1gO1xuICAgICAgY29uc3QgY2FsbEluZGV4ID0gbG9nLmdldEluZGV4KCk7XG4gICAgICBpZiAoc3RvcHBlZCB8fCAhYmlqZWN0aW9uLmhhc0d1ZXN0KGd1ZXN0VGFyZ2V0KSkge1xuICAgICAgICB0aHJvd1JlZGFjdGVkYFNlbnQgZnJvbSBhIHByZXZpb3VzIHJ1bjogJHtndWVzdFRhcmdldH1gO1xuICAgICAgfVxuICAgICAgY29uc3QgaG9zdFJlc3VsdEtpdCA9IG1ha2VWb3dLaXQoKTtcbiAgICAgIGNvbnN0IGcyID0gYmlqZWN0aW9uLnVud3JhcEluaXQoZ3Vlc3RSZXR1cm5lZFAsIGhvc3RSZXN1bHRLaXQudm93KTtcbiAgICAgIGcyID09PSBndWVzdFJldHVybmVkUCB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBndWVzdFJldHVybmVkUCBzaG91bGQgbm90IHVud3JhcDogJHtnMn0gdnMgJHtndWVzdFJldHVybmVkUH1gO1xuICAgICAgbGV0IG91dGNvbWU7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBndWVzdEVudHJ5ID0gaGFyZGVuKFtcbiAgICAgICAgICBcImNoZWNrU2VuZFwiLFxuICAgICAgICAgIGd1ZXN0VGFyZ2V0LFxuICAgICAgICAgIG9wdFZlcmIsXG4gICAgICAgICAgZ3Vlc3RBcmdzLFxuICAgICAgICAgIGNhbGxJbmRleFxuICAgICAgICBdKTtcbiAgICAgICAgaWYgKGxvZy5pc1JlcGxheWluZygpKSB7XG4gICAgICAgICAgY29uc3QgZW50cnkgPSBsb2cubmV4dEVudHJ5KCk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGVxdWF0ZShndWVzdEVudHJ5LCBlbnRyeSk7XG4gICAgICAgICAgfSBjYXRjaCAoZXF1YXRlRXJyKSB7XG4gICAgICAgICAgICB0aHJvd0xhYmVsZWQoXG4gICAgICAgICAgICAgIGVxdWF0ZUVycixcbiAgICAgICAgICAgICAgYHJlcGxheSAke2NhbGxJbmRleH06XG4gICAgICR7cXVvdGUoZ3Vlc3RFbnRyeSl9XG4gIHZzICR7cXVvdGUoZW50cnkpfVxuICAgIGBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG91dGNvbWUgPSAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgbmVzdEludGVycHJldGVyKGNhbGxJbmRleCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgZW50cnkgPSBndWVzdFRvSG9zdChndWVzdEVudHJ5KTtcbiAgICAgICAgICBsb2cucHVzaEVudHJ5KGVudHJ5KTtcbiAgICAgICAgICBjb25zdCBbX29wLCBob3N0VGFyZ2V0LCBfb3B0VmVyYiwgaG9zdEFyZ3MsIF9jYWxsSW5kZXhdID0gZW50cnk7XG4gICAgICAgICAgbmVzdEludGVycHJldGVyKGNhbGxJbmRleCk7XG4gICAgICAgICAgb3V0Y29tZSA9IHBlcmZvcm1TZW5kKFxuICAgICAgICAgICAgaG9zdFRhcmdldCxcbiAgICAgICAgICAgIG9wdFZlcmIsXG4gICAgICAgICAgICBob3N0QXJncyxcbiAgICAgICAgICAgIGNhbGxJbmRleCxcbiAgICAgICAgICAgIGhvc3RSZXN1bHRLaXQsXG4gICAgICAgICAgICBndWVzdFJldHVybmVkUFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGZhdGFsRXJyb3IpIHtcbiAgICAgICAgdGhyb3cgcGFuaWMoZmF0YWxFcnJvcik7XG4gICAgICB9XG4gICAgICBzd2l0Y2ggKG91dGNvbWUua2luZCkge1xuICAgICAgICBjYXNlIFwicmV0dXJuXCI6IHtcbiAgICAgICAgICByZXR1cm4gb3V0Y29tZS5yZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInRocm93XCI6IHtcbiAgICAgICAgICB0aHJvdyBvdXRjb21lLnByb2JsZW07XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHRocm93IFBhbmljYHVuZXhwZWN0ZWQgb3V0Y29tZSBraW5kICR7cXVvdGUob3V0Y29tZS5raW5kKX1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBhcHBseUZ1bmN0aW9uU2VuZE9ubHkoZ3Vlc3RUYXJnZXQsIGd1ZXN0QXJncykge1xuICAgICAgX19ldmVudHVhbFNlbmRGb3JUZXN0aW5nIHx8IFBhbmljYGd1ZXN0IGV2ZW50dWFsIGFwcGx5RnVuY3Rpb25TZW5kT25seSBub3QgeWV0IHN1cHBvcnRlZDogJHtndWVzdFRhcmdldH1gO1xuICAgICAgcmV0dXJuIGd1ZXN0SGFuZGxlci5hcHBseU1ldGhvZFNlbmRPbmx5KFxuICAgICAgICBndWVzdFRhcmdldCxcbiAgICAgICAgdm9pZCAwLFxuICAgICAgICBndWVzdEFyZ3NcbiAgICAgICk7XG4gICAgfSxcbiAgICBhcHBseUZ1bmN0aW9uKGd1ZXN0VGFyZ2V0LCBndWVzdEFyZ3MsIGd1ZXN0UmV0dXJuZWRQKSB7XG4gICAgICBfX2V2ZW50dWFsU2VuZEZvclRlc3RpbmcgfHwgUGFuaWNgZ3Vlc3QgZXZlbnR1YWwgYXBwbHlGdW5jdGlvbiBub3QgeWV0IHN1cHBvcnRlZDogJHtndWVzdFRhcmdldH0gLT4gJHtiYXJlT3JRdW90ZShndWVzdFJldHVybmVkUCl9YDtcbiAgICAgIHJldHVybiBndWVzdEhhbmRsZXIuYXBwbHlNZXRob2QoXG4gICAgICAgIGd1ZXN0VGFyZ2V0LFxuICAgICAgICB2b2lkIDAsXG4gICAgICAgIGd1ZXN0QXJncyxcbiAgICAgICAgZ3Vlc3RSZXR1cm5lZFBcbiAgICAgICk7XG4gICAgfSxcbiAgICBnZXRTZW5kT25seShndWVzdFRhcmdldCwgcHJvcCkge1xuICAgICAgdGhyb3cgUGFuaWNgZ3Vlc3QgZXZlbnR1YWwgZ2V0U2VuZE9ubHkgbm90IHlldCBzdXBwb3J0ZWQ6ICR7Z3Vlc3RUYXJnZXR9LiR7YmFyZU9yUXVvdGUocHJvcCl9YDtcbiAgICB9LFxuICAgIGdldChndWVzdFRhcmdldCwgcHJvcCwgZ3Vlc3RSZXR1cm5lZFApIHtcbiAgICAgIHRocm93IFBhbmljYGd1ZXN0IGV2ZW50dWFsIGdldCBub3QgeWV0IHN1cHBvcnRlZDogJHtndWVzdFRhcmdldH0uJHtiYXJlT3JRdW90ZShwcm9wKX0gLT4gJHtiYXJlT3JRdW90ZShndWVzdFJldHVybmVkUCl9YDtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBtYWtlR3Vlc3RQcmVzZW5jZSA9IChpZmFjZSwgbWV0aG9kRW50cmllcykgPT4ge1xuICAgIGxldCBndWVzdFByZXNlbmNlO1xuICAgIHZvaWQgbmV3IEhhbmRsZWRQcm9taXNlKChfcmVzLCBfcmVqLCByZXNvbHZlV2l0aFByZXNlbmNlKSA9PiB7XG4gICAgICBndWVzdFByZXNlbmNlID0gcmVzb2x2ZVdpdGhQcmVzZW5jZShndWVzdEhhbmRsZXIpO1xuICAgIH0pO1xuICAgIGlmICh0eXBlb2YgZ3Vlc3RQcmVzZW5jZSAhPT0gXCJvYmplY3RcIikge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBwcmVzZW5jZSBleHBlY3RlZCB0byBiZSBvYmplY3QgJHtndWVzdFByZXNlbmNlfWA7XG4gICAgfVxuICAgIGFzc2lnbjMoZ3Vlc3RQcmVzZW5jZSwgZnJvbUVudHJpZXM5KG1ldGhvZEVudHJpZXMpKTtcbiAgICBjb25zdCByZXN1bHQgPSBSZW1vdGFibGUoaWZhY2UsIHZvaWQgMCwgZ3Vlc3RQcmVzZW5jZSk7XG4gICAgcmVzdWx0ID09PSBndWVzdFByZXNlbmNlIHx8IHRocm93UmVkYWN0ZWRgUmVtb3RhYmxlIGV4cGVjdGVkIHRvIG1ha2UgcHJlc2VuY2UgaW4gcGxhY2U6ICR7Z3Vlc3RQcmVzZW5jZX0gdnMgJHtyZXN1bHR9YDtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuICBjb25zdCBtYWtlR3Vlc3RQcm9taXNlS2l0ID0gKCkgPT4ge1xuICAgIGxldCByZXNvbHZlMjtcbiAgICBsZXQgcmVqZWN0O1xuICAgIGNvbnN0IHByb21pc2UgPSBuZXcgSGFuZGxlZFByb21pc2UoKHJlcywgcmVqLCBfcmVzUHJlcykgPT4ge1xuICAgICAgcmVzb2x2ZTIgPSByZXM7XG4gICAgICByZWplY3QgPSByZWo7XG4gICAgfSwgZ3Vlc3RIYW5kbGVyKTtcbiAgICByZXR1cm4gaGFyZGVuKHsgcHJvbWlzZSwgcmVzb2x2ZTogcmVzb2x2ZTIsIHJlamVjdCB9KTtcbiAgfTtcbiAgY29uc3QgbWFrZUd1ZXN0Rm9ySG9zdFJlbW90YWJsZSA9IChoUmVtKSA9PiB7XG4gICAgbGV0IGdSZW07XG4gICAgY29uc3QgbWFrZUd1ZXN0TWV0aG9kID0gKG9wdFZlcmIgPSB2b2lkIDApID0+IHtcbiAgICAgIGNvbnN0IGd1ZXN0TWV0aG9kID0gKC4uLmd1ZXN0QXJncykgPT4ge1xuICAgICAgICBjb25zdCBjYWxsSW5kZXggPSBsb2cuZ2V0SW5kZXgoKTtcbiAgICAgICAgcmV0dXJuIGd1ZXN0Q2FsbHNIb3N0KGdSZW0sIG9wdFZlcmIsIGd1ZXN0QXJncywgY2FsbEluZGV4KTtcbiAgICAgIH07XG4gICAgICBpZiAob3B0VmVyYikge1xuICAgICAgICBkZWZpbmVQcm9wZXJ0aWVzNShndWVzdE1ldGhvZCwge1xuICAgICAgICAgIG5hbWU6IHsgdmFsdWU6IFN0cmluZyhoUmVtW29wdFZlcmJdLm5hbWUgfHwgb3B0VmVyYikgfSxcbiAgICAgICAgICBsZW5ndGg6IHsgdmFsdWU6IE51bWJlcihoUmVtW29wdFZlcmJdLmxlbmd0aCB8fCAwKSB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGVmaW5lUHJvcGVydGllczUoZ3Vlc3RNZXRob2QsIHtcbiAgICAgICAgICBuYW1lOiB7IHZhbHVlOiBTdHJpbmcoaFJlbS5uYW1lIHx8IFwiYW5vblwiKSB9LFxuICAgICAgICAgIGxlbmd0aDogeyB2YWx1ZTogTnVtYmVyKGhSZW0ubGVuZ3RoIHx8IDApIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZ3Vlc3RNZXRob2Q7XG4gICAgfTtcbiAgICBjb25zdCBpZmFjZSA9IFN0cmluZyhnZXRJbnRlcmZhY2VPZihoUmVtKSB8fCBcInJlbW90YWJsZVwiKTtcbiAgICBjb25zdCBndWVzdElmYWNlID0gYCR7aWZhY2V9IGd1ZXN0IHdyYXBwZXJgO1xuICAgIGlmICh0eXBlb2YgaFJlbSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBnUmVtID0gUmVtb3RhYmxlKGd1ZXN0SWZhY2UsIHZvaWQgMCwgbWFrZUd1ZXN0TWV0aG9kKCkpO1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBob3N0IGZhciBmdW5jdGlvbnMgbm90IHlldCBwYXNzYWJsZWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG1ldGhvZE5hbWVzID0gZ2V0TWV0aG9kTmFtZXMoaFJlbSk7XG4gICAgICBjb25zdCBndWVzdE1ldGhvZHMgPSBtZXRob2ROYW1lcy5tYXAoKG5hbWUpID0+IFtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgbWFrZUd1ZXN0TWV0aG9kKG5hbWUpXG4gICAgICBdKTtcbiAgICAgIGdSZW0gPSBtYWtlR3Vlc3RQcmVzZW5jZShndWVzdElmYWNlLCBndWVzdE1ldGhvZHMpO1xuICAgIH1cbiAgICBoUmVtID0gdm9pZCAwO1xuICAgIHJldHVybiBnUmVtO1xuICB9O1xuICBoYXJkZW4obWFrZUd1ZXN0Rm9ySG9zdFJlbW90YWJsZSk7XG4gIGNvbnN0IG1ha2VHdWVzdEZvckhvc3RWb3cgPSAoaFZvdywgcHJvbWlzZUtleSA9IHZvaWQgMCkgPT4ge1xuICAgIGlzVm93KGhWb3cpIHx8IHRocm93UmVkYWN0ZWRgdm93IGV4cGVjdGVkICR7aFZvd31gO1xuICAgIGNvbnN0IHsgcHJvbWlzZSwgcmVzb2x2ZTogcmVzb2x2ZTIsIHJlamVjdCB9ID0gbWFrZUd1ZXN0UHJvbWlzZUtpdCgpO1xuICAgIHByb21pc2VLZXkgPz89IHByb21pc2U7XG4gICAgZ3Vlc3RQcm9taXNlTWFwLnNldChwcm9taXNlS2V5LCBoYXJkZW4oeyByZXNvbHZlOiByZXNvbHZlMiwgcmVqZWN0IH0pKTtcbiAgICB3YXRjaFdha2UoaFZvdyk7XG4gICAgdm9pZCB3aGVuKFxuICAgICAgaFZvdyxcbiAgICAgIGFzeW5jIChob3N0RnVsZmlsbG1lbnQpID0+IHtcbiAgICAgICAgYXdhaXQgbG9nLnByb21pc2VSZXBsYXlEb25lKCk7XG4gICAgICAgIGlmICghc3RvcHBlZCAmJiBndWVzdFByb21pc2VNYXAuZ2V0KHByb21pc2VLZXkpICE9PSBcInNldHRsZWRcIikge1xuICAgICAgICAgIGNvbnN0IGVudHJ5ID0gaGFyZGVuKFtcImRvRnVsZmlsbFwiLCBoVm93LCBob3N0RnVsZmlsbG1lbnRdKTtcbiAgICAgICAgICBsb2cucHVzaEVudHJ5KGVudHJ5KTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaW50ZXJwcmV0T25lKHRvcERpc3BhdGNoLCBlbnRyeSk7XG4gICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYXN5bmMgKGhvc3RSZWFzb24pID0+IHtcbiAgICAgICAgYXdhaXQgbG9nLnByb21pc2VSZXBsYXlEb25lKCk7XG4gICAgICAgIGlmICghc3RvcHBlZCAmJiBndWVzdFByb21pc2VNYXAuZ2V0KHByb21pc2VLZXkpICE9PSBcInNldHRsZWRcIikge1xuICAgICAgICAgIGNvbnN0IGVudHJ5ID0gaGFyZGVuKFtcImRvUmVqZWN0XCIsIGhWb3csIGhvc3RSZWFzb25dKTtcbiAgICAgICAgICBsb2cucHVzaEVudHJ5KGVudHJ5KTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaW50ZXJwcmV0T25lKHRvcERpc3BhdGNoLCBlbnRyeSk7XG4gICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgICByZXR1cm4gcHJvbWlzZTtcbiAgfTtcbiAgaGFyZGVuKG1ha2VHdWVzdEZvckhvc3RWb3cpO1xuICBjb25zdCB7IGd1ZXN0VG9Ib3N0LCBob3N0VG9HdWVzdCB9ID0gbWFrZUNvbnZlcnRLaXQoXG4gICAgYmlqZWN0aW9uLFxuICAgIG1ha2VHdWVzdEZvckhvc3RSZW1vdGFibGUsXG4gICAgbWFrZUd1ZXN0Rm9ySG9zdFZvd1xuICApO1xuICBjb25zdCB0b3BEaXNwYXRjaCA9IGhhcmRlbih7XG4gICAgc3RhcnRHZW5lcmF0aW9uLFxuICAgIGRvRnVsZmlsbCxcbiAgICBkb1JlamVjdFxuICAgIC8vXG4gIH0pO1xuICBjb25zdCBuZXN0RGlzcGF0Y2ggPSBoYXJkZW4oe1xuICAgIGRvUmV0dXJuLFxuICAgIGRvVGhyb3dcbiAgICAvL1xuICB9KTtcbiAgY29uc3QgaW50ZXJwcmV0T25lID0gKGRpc3BhdGNoLCBbb3AsIC4uLmFyZ3NdKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIG9wIGluIGRpc3BhdGNoIHx8IC8vXG4gICAgICB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgZGlzcGF0Y2ggb3A6ICR7cXVvdGUob3ApfWA7XG4gICAgICByZXR1cm4gZGlzcGF0Y2hbb3BdKC4uLmFyZ3MpO1xuICAgIH0gY2F0Y2ggKHByb2JsZW0pIHtcbiAgICAgIHRocm93IHBhbmljKHByb2JsZW0pO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgbG9nRG8gPSAoZGlzcGF0Y2gsIGVudHJ5KSA9PiB7XG4gICAgbG9nLnB1c2hFbnRyeShlbnRyeSk7XG4gICAgcmV0dXJuIGludGVycHJldE9uZShkaXNwYXRjaCwgZW50cnkpO1xuICB9O1xuICBjb25zdCBjYWxsU3RhY2sgPSBbXTtcbiAgbGV0IHVubmVzdEZsYWcgPSBmYWxzZTtcbiAgY29uc3QgbmVzdEludGVycHJldGVyID0gKGNhbGxJbmRleCkgPT4ge1xuICAgIGNhbGxTdGFjay5wdXNoKGNhbGxJbmRleCk7XG4gICAgd2hpbGUgKGxvZy5pc1JlcGxheWluZygpICYmICFzdG9wcGVkKSB7XG4gICAgICBjb25zdCBlbnRyeSA9IGxvZy5uZXh0VW5maWx0ZXJlZEVudHJ5KCk7XG4gICAgICBjb25zdCBvcHRPdXRjb21lID0gaW50ZXJwcmV0T25lKG5lc3REaXNwYXRjaCwgZW50cnkpO1xuICAgICAgaWYgKHVubmVzdEZsYWcpIHtcbiAgICAgICAgb3B0T3V0Y29tZSB8fCAvL1xuICAgICAgICB0aHJvd1JlZGFjdGVkYG9ubHkgdW5uZXN0IHdpdGggYW4gb3V0Y29tZTogJHtxdW90ZShlbnRyeVswXSl9YDtcbiAgICAgICAgdW5uZXN0RmxhZyA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gb3B0T3V0Y29tZTtcbiAgICAgIH1cbiAgICB9XG4gICAgdW5uZXN0RmxhZyA9IGZhbHNlO1xuICB9O1xuICBjb25zdCB1bm5lc3RJbnRlcnByZXRlciA9IChjYWxsSW5kZXgpID0+IHtcbiAgICAhc3RvcHBlZCB8fCB0aHJvd1JlZGFjdGVkYFRoaXMgbWVtYnJhbmUgc3RvcHBlZC4gUmVzdGFydCB3aXRoIG5ldyBtZW1icmFuZSAke3JlcGxheU1lbWJyYW5lfWA7XG4gICAgY2FsbFN0YWNrLmxlbmd0aCA+PSAxIHx8IC8vXG4gICAgdGhyb3dSZWRhY3RlZGBVbm1hdGNoZWQgdW5uZXN0OiAke3F1b3RlKGNhbGxJbmRleCl9YDtcbiAgICBjb25zdCBpMiA9IGNhbGxTdGFjay5wb3AoKTtcbiAgICBpMiA9PT0gY2FsbEluZGV4IHx8IC8vXG4gICAgdGhyb3dSZWRhY3RlZGBVbmV4cGVjdGVkIHVubmVzdDogJHtxdW90ZShjYWxsSW5kZXgpfSB2cyAke3F1b3RlKGkyKX1gO1xuICAgIHVubmVzdEZsYWcgPSB0cnVlO1xuICAgIGlmIChjYWxsU3RhY2subGVuZ3RoID09PSAwKSB7XG4gICAgICB2b2lkIEUud2hlbih2b2lkIDAsIHdha2UpO1xuICAgIH1cbiAgfTtcbiAgY29uc3Qgd2FrZSA9ICgpID0+IHtcbiAgICB3aGlsZSAobG9nLmlzUmVwbGF5aW5nKCkgJiYgIXN0b3BwZWQpIHtcbiAgICAgIGNhbGxTdGFjay5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGB3YWtlIG9ubHkgd2l0aCBlbXB0eSBjYWxsU3RhY2s6ICR7cXVvdGUoY2FsbFN0YWNrKX1gO1xuICAgICAgY29uc3QgZW50cnkgPSBsb2cucGVla0VudHJ5KCk7XG4gICAgICBjb25zdCBvcCA9IGVudHJ5WzBdO1xuICAgICAgaWYgKCEob3AgaW4gdG9wRGlzcGF0Y2gpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZvaWQgbG9nLm5leHRVbmZpbHRlcmVkRW50cnkoKTtcbiAgICAgIGludGVycHJldE9uZSh0b3BEaXNwYXRjaCwgZW50cnkpO1xuICAgIH1cbiAgfTtcbiAgY29uc3Qgc3RvcCA9ICgpID0+IHtcbiAgICBzdG9wcGVkID0gdHJ1ZTtcbiAgfTtcbiAgY29uc3QgcmVwbGF5TWVtYnJhbmUgPSBGYXIoXCJyZXBsYXlNZW1icmFuZVwiLCB7XG4gICAgaG9zdFRvR3Vlc3QsXG4gICAgZ3Vlc3RUb0hvc3QsXG4gICAgd2FrZSxcbiAgICBzdG9wXG4gIH0pO1xuICByZXR1cm4gcmVwbGF5TWVtYnJhbmU7XG59O1xuaGFyZGVuKG1ha2VSZXBsYXlNZW1icmFuZSk7XG5cbi8vXG52YXIgRmxvd1N0YXRlU2hhcGUgPSBNLm9yKFxuICBcIlJ1bm5pbmdcIixcbiAgXCJTbGVlcGluZ1wiLFxuICBcIlJlcGxheWluZ1wiLFxuICBcIkZhaWxlZFwiLFxuICBcIkRvbmVcIlxuKTtcbnZhciBQcm9wZXJ0eUtleVNoYXBlID0gTS5vcihNLnN0cmluZygpLCBNLnN5bWJvbCgpKTtcbnZhciBMb2dFbnRyeVNoYXBlID0gTS5vcihcbiAgW1wic3RhcnRHZW5lcmF0aW9uXCIsIE0ubnVtYmVyKCldLFxuICAvL1xuICBbXCJkb0Z1bGZpbGxcIiwgVm93U2hhcGUsIE0uYW55KCldLFxuICBbXCJkb1JlamVjdFwiLCBWb3dTaGFwZSwgTS5hbnkoKV0sXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIFtcImRvUmV0dXJuXCIsIE0ubnVtYmVyKCksIE0uYW55KCldLFxuICBbXCJkb1Rocm93XCIsIE0ubnVtYmVyKCksIE0uYW55KCldLFxuICAvL1xuICAvL1xuICAvL1xuICBbXG4gICAgXCJjaGVja0NhbGxcIixcbiAgICBNLnJlbW90YWJsZShcImhvc3QgdGFyZ2V0XCIpLFxuICAgIE0ub3B0KFByb3BlcnR5S2V5U2hhcGUpLFxuICAgIE0uYXJyYXlPZihNLmFueSgpKSxcbiAgICBNLm51bWJlcigpXG4gIF0sXG4gIFtcbiAgICBcImNoZWNrU2VuZE9ubHlcIixcbiAgICBNLm9yKE0ucmVtb3RhYmxlKFwiaG9zdCB0YXJnZXRcIiksIFZvd1NoYXBlKSxcbiAgICBNLm9wdChQcm9wZXJ0eUtleVNoYXBlKSxcbiAgICBNLmFycmF5T2YoTS5hbnkoKSksXG4gICAgTS5udW1iZXIoKVxuICBdLFxuICBbXG4gICAgXCJjaGVja1NlbmRcIixcbiAgICBNLm9yKE0ucmVtb3RhYmxlKFwiaG9zdCB0YXJnZXRcIiksIFZvd1NoYXBlKSxcbiAgICBNLm9wdChQcm9wZXJ0eUtleVNoYXBlKSxcbiAgICBNLmFycmF5T2YoTS5hbnkoKSksXG4gICAgTS5udW1iZXIoKVxuICBdXG4gIC8vXG4gIC8vXG4pO1xuXG4vL1xudmFyIG1ha2VFcGhlbWVyYSA9IChyZWluaXQpID0+IHtcbiAgY29uc3QgbWFwID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGZvcihzZWxmKSB7XG4gICAgICBpZiAoIW1hcC5oYXMoc2VsZikpIHtcbiAgICAgICAgbWFwLnNldChzZWxmLCByZWluaXQoc2VsZikpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIChcbiAgICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAgICBtYXAuZ2V0KHNlbGYpXG4gICAgICApO1xuICAgIH0sXG4gICAgcmVzZXRGb3Ioc2VsZikge1xuICAgICAgcmV0dXJuIG1hcC5kZWxldGUoc2VsZik7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUVwaGVtZXJhKTtcblxuLy9cbnZhciBMb2dTdG9yZUkgPSBNLmludGVyZmFjZShcIkxvZ1N0b3JlXCIsIHtcbiAgcmVzZXQ6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgZGlzcG9zZTogTS5jYWxsKCkucmV0dXJucygpLFxuICBnZXRVbmZpbHRlcmVkSW5kZXg6IE0uY2FsbCgpLnJldHVybnMoTS5udW1iZXIoKSksXG4gIGdldEluZGV4OiBNLmNhbGwoKS5yZXR1cm5zKE0ubnVtYmVyKCkpLFxuICBnZXRMZW5ndGg6IE0uY2FsbCgpLnJldHVybnMoTS5udW1iZXIoKSksXG4gIGlzUmVwbGF5aW5nOiBNLmNhbGwoKS5yZXR1cm5zKE0uYm9vbGVhbigpKSxcbiAgcGVla0VudHJ5OiBNLmNhbGwoKS5yZXR1cm5zKExvZ0VudHJ5U2hhcGUpLFxuICBuZXh0RW50cnk6IE0uY2FsbCgpLnJldHVybnMoTG9nRW50cnlTaGFwZSksXG4gIG5leHRVbmZpbHRlcmVkRW50cnk6IE0uY2FsbCgpLnJldHVybnMoTG9nRW50cnlTaGFwZSksXG4gIHB1c2hFbnRyeTogTS5jYWxsKExvZ0VudHJ5U2hhcGUpLnJldHVybnMoTS5udW1iZXIoKSksXG4gIGR1bXBVbmZpbHRlcmVkOiBNLmNhbGwoKS5yZXR1cm5zKE0uYXJyYXlPZihMb2dFbnRyeVNoYXBlKSksXG4gIGR1bXA6IE0uY2FsbCgpLnJldHVybnMoTS5hcnJheU9mKExvZ0VudHJ5U2hhcGUpKSxcbiAgcHJvbWlzZVJlcGxheURvbmU6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpXG59KTtcbnZhciBuZXh0R2VuZXJhdGlvbiA9ICh6b25lKSA9PiB7XG4gIGNvbnN0IGxvZ1N0b3JlTWV0YWRhdGEgPSB6b25lLm1hcFN0b3JlKFwiTG9nU3RvcmVNZXRhZGF0YVwiKTtcbiAgY29uc3QgZ2VuZXJhdGlvbktleSA9IFwiZ2VuZXJhdGlvblwiO1xuICBpZiAoIWxvZ1N0b3JlTWV0YWRhdGEuaGFzKGdlbmVyYXRpb25LZXkpKSB7XG4gICAgY29uc3QgZmlyc3RHZW4gPSAwO1xuICAgIGxvZ1N0b3JlTWV0YWRhdGEuaW5pdChnZW5lcmF0aW9uS2V5LCBmaXJzdEdlbik7XG4gICAgcmV0dXJuIGZpcnN0R2VuO1xuICB9XG4gIGNvbnN0IG5leHRHZW4gPSBsb2dTdG9yZU1ldGFkYXRhLmdldChnZW5lcmF0aW9uS2V5KSArIDE7XG4gIGxvZ1N0b3JlTWV0YWRhdGEuc2V0KGdlbmVyYXRpb25LZXksIG5leHRHZW4pO1xuICByZXR1cm4gbmV4dEdlbjtcbn07XG52YXIgcHJlcGFyZUxvZ1N0b3JlID0gKHpvbmUpID0+IHtcbiAgY29uc3QgaW5pdGlhbFB1c2ggPSBoYXJkZW4oW1tcInN0YXJ0R2VuZXJhdGlvblwiLCBuZXh0R2VuZXJhdGlvbih6b25lKV1dKTtcbiAgY29uc3QgZW50cnlJc1Zpc2libGUgPSAoZW50cnkpID0+IGVudHJ5WzBdICE9PSBcInN0YXJ0R2VuZXJhdGlvblwiO1xuICBjb25zdCB0bXAgPSBtYWtlRXBoZW1lcmEoKGxvZykgPT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgIGluZGV4OiAwLFxuICAgICAgdW5maWx0ZXJlZEluZGV4OiAwLFxuICAgICAgaW5pdGlhbFB1c2gsXG4gICAgICByZXBsYXlEb25lS2l0OiBtYWtlUHJvbWlzZUtpdCgpXG4gICAgfTtcbiAgICBpZiAobG9nLmdldExlbmd0aCgpID09PSAwKSB7XG4gICAgICByZXN1bHQucmVwbGF5RG9uZUtpdC5yZXNvbHZlKHZvaWQgMCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH0pO1xuICByZXR1cm4gem9uZS5leG9DbGFzcyhcbiAgICBcIkxvZ1N0b3JlXCIsXG4gICAgTG9nU3RvcmVJLFxuICAgICgpID0+IHtcbiAgICAgIGNvbnN0IG1hcFN0b3JlID0gem9uZS5kZXRhY2hlZCgpLm1hcFN0b3JlKFwibG9nTWFwU3RvcmVcIiwge1xuICAgICAgICBrZXlTaGFwZTogTS5udW1iZXIoKSxcbiAgICAgICAgdmFsdWVTaGFwZTogTG9nRW50cnlTaGFwZVxuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtYXBTdG9yZVxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIHJlc2V0KCkge1xuICAgICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICAgIHRtcC5yZXNldEZvcihzZWxmKTtcbiAgICAgIH0sXG4gICAgICBkaXNwb3NlKCkge1xuICAgICAgICBjb25zdCB7IHN0YXRlLCBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IG1hcFN0b3JlIH0gPSBzdGF0ZTtcbiAgICAgICAgdG1wLnJlc2V0Rm9yKHNlbGYpO1xuICAgICAgICBtYXBTdG9yZS5jbGVhcigpO1xuICAgICAgfSxcbiAgICAgIGdldFVuZmlsdGVyZWRJbmRleCgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBlcGggPSB0bXAuZm9yKHNlbGYpO1xuICAgICAgICByZXR1cm4gZXBoLnVuZmlsdGVyZWRJbmRleDtcbiAgICAgIH0sXG4gICAgICBnZXRJbmRleCgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBlcGggPSB0bXAuZm9yKHNlbGYpO1xuICAgICAgICByZXR1cm4gZXBoLmluZGV4O1xuICAgICAgfSxcbiAgICAgIGdldExlbmd0aCgpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBtYXBTdG9yZSB9ID0gc3RhdGU7XG4gICAgICAgIHJldHVybiBtYXBTdG9yZS5nZXRTaXplKCk7XG4gICAgICB9LFxuICAgICAgaXNSZXBsYXlpbmcoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGUsIHNlbGYgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbWFwU3RvcmUgfSA9IHN0YXRlO1xuICAgICAgICBjb25zdCBlcGggPSB0bXAuZm9yKHNlbGYpO1xuICAgICAgICByZXR1cm4gZXBoLnVuZmlsdGVyZWRJbmRleCA8IG1hcFN0b3JlLmdldFNpemUoKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIHBlZWtFbnRyeSgpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSwgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBtYXBTdG9yZSB9ID0gc3RhdGU7XG4gICAgICAgIGNvbnN0IGVwaCA9IHRtcC5mb3Ioc2VsZik7XG4gICAgICAgIHNlbGYuaXNSZXBsYXlpbmcoKSB8fCB0aHJvd1JlZGFjdGVkYE5vIGxvbmdlciByZXBsYXlpbmc6ICR7cXVvdGUoZXBoLnVuZmlsdGVyZWRJbmRleCl9IHZzICR7cXVvdGUoXG4gICAgICAgICAgbWFwU3RvcmUuZ2V0U2l6ZSgpXG4gICAgICAgICl9YDtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbWFwU3RvcmUuZ2V0KGVwaC51bmZpbHRlcmVkSW5kZXgpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfSxcbiAgICAgIC8qXG5cbiAgICAgICAqL1xuICAgICAgbmV4dFVuZmlsdGVyZWRFbnRyeSgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBlcGggPSB0bXAuZm9yKHNlbGYpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBzZWxmLnBlZWtFbnRyeSgpO1xuICAgICAgICBlcGgudW5maWx0ZXJlZEluZGV4ICs9IDE7XG4gICAgICAgIGlmIChlbnRyeUlzVmlzaWJsZShyZXN1bHQpKSB7XG4gICAgICAgICAgZXBoLmluZGV4ICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFzZWxmLmlzUmVwbGF5aW5nKCkpIHtcbiAgICAgICAgICBlcGgucmVwbGF5RG9uZUtpdC5yZXNvbHZlKHZvaWQgMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0sXG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIG5leHRFbnRyeSgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBsZXQgcmVzdWx0ID0gc2VsZi5uZXh0VW5maWx0ZXJlZEVudHJ5KCk7XG4gICAgICAgIHdoaWxlICghZW50cnlJc1Zpc2libGUocmVzdWx0KSkge1xuICAgICAgICAgIHNlbGYuaXNSZXBsYXlpbmcoKSB8fCB0aHJvd1JlZGFjdGVkYFVuZXhwZWN0ZWQgZW50cnkgYXQgbG9nIHRhaWw6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgcmVzdWx0ID0gc2VsZi5uZXh0VW5maWx0ZXJlZEVudHJ5KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0sXG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIHB1c2hFbnRyeShsYXRlc3RFbnRyeSkge1xuICAgICAgICBjb25zdCB7IHN0YXRlLCBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IG1hcFN0b3JlIH0gPSBzdGF0ZTtcbiAgICAgICAgY29uc3QgZXBoID0gdG1wLmZvcihzZWxmKTtcbiAgICAgICAgIXNlbGYuaXNSZXBsYXlpbmcoKSB8fCB0aHJvd1JlZGFjdGVkYHN0aWxsIHJlcGxheWluZzogJHtxdW90ZShlcGgudW5maWx0ZXJlZEluZGV4KX0gdnMgJHtxdW90ZShtYXBTdG9yZS5nZXRTaXplKCkpfWA7XG4gICAgICAgIGNvbnN0IHB1c2hPbmUgPSAoZW50cnkpID0+IHtcbiAgICAgICAgICBlcGgudW5maWx0ZXJlZEluZGV4ID09PSBtYXBTdG9yZS5nZXRTaXplKCkgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogdW5maWx0ZXJlZEluZGV4IGNvbmZ1c2lvbiAke3F1b3RlKGVwaC51bmZpbHRlcmVkSW5kZXgpfSB2cyAke3F1b3RlKFxuICAgICAgICAgICAgbWFwU3RvcmUuZ2V0U2l6ZSgpXG4gICAgICAgICAgKX1gO1xuICAgICAgICAgIG1hcFN0b3JlLmluaXQoZXBoLnVuZmlsdGVyZWRJbmRleCwgZW50cnkpO1xuICAgICAgICAgIGVwaC51bmZpbHRlcmVkSW5kZXggKz0gMTtcbiAgICAgICAgICBpZiAoZW50cnlJc1Zpc2libGUoZW50cnkpKSB7XG4gICAgICAgICAgICBlcGguaW5kZXggKz0gMTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZXBoLnVuZmlsdGVyZWRJbmRleCA9PT0gbWFwU3RvcmUuZ2V0U2l6ZSgpIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IHVuZmlsdGVyZWRJbmRleCBjb25mdXNpb24gJHtxdW90ZShlcGgudW5maWx0ZXJlZEluZGV4KX0gdnMgJHtxdW90ZShcbiAgICAgICAgICAgIG1hcFN0b3JlLmdldFNpemUoKVxuICAgICAgICAgICl9YDtcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGVwaC5pbml0aWFsUHVzaCkge1xuICAgICAgICAgIGNvbnN0IGluaXRpYWxFbnRyaWVzID0gZXBoLmluaXRpYWxQdXNoO1xuICAgICAgICAgIGVwaC5pbml0aWFsUHVzaCA9IHZvaWQgMDtcbiAgICAgICAgICBmb3IgKGNvbnN0IGluaXRpYWxFbnRyeSBvZiBpbml0aWFsRW50cmllcykge1xuICAgICAgICAgICAgcHVzaE9uZShpbml0aWFsRW50cnkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwdXNoT25lKGxhdGVzdEVudHJ5KTtcbiAgICAgICAgcmV0dXJuIGVwaC51bmZpbHRlcmVkSW5kZXg7XG4gICAgICB9LFxuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBkdW1wVW5maWx0ZXJlZCgpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBtYXBTdG9yZSB9ID0gc3RhdGU7XG4gICAgICAgIGNvbnN0IGxlbiA9IG1hcFN0b3JlLmdldFNpemUoKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBsZW47IGkyICs9IDEpIHtcbiAgICAgICAgICByZXN1bHQucHVzaChtYXBTdG9yZS5nZXQoaTIpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaGFyZGVuKHJlc3VsdCk7XG4gICAgICB9LFxuICAgICAgZHVtcCgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHNlbGYuZHVtcFVuZmlsdGVyZWQoKS5maWx0ZXIoZW50cnlJc1Zpc2libGUpKTtcbiAgICAgIH0sXG4gICAgICBwcm9taXNlUmVwbGF5RG9uZSgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBlcGggPSB0bXAuZm9yKHNlbGYpO1xuICAgICAgICByZXR1cm4gZXBoLnJlcGxheURvbmVLaXQucHJvbWlzZTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG59O1xuXG4vL1xudmFyIEJpamVjdGlvbkkgPSBNLmludGVyZmFjZShcIkJpamVjdGlvblwiLCB7XG4gIHJlc2V0OiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gIHVud3JhcEluaXQ6IE0uY2FsbChNLnJhdygpLCBNLmFueSgpKS5yZXR1cm5zKE0ucmF3KCkpLFxuICBoYXNHdWVzdDogTS5jYWxsKE0ucmF3KCkpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICBoYXNIb3N0OiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucyhNLmJvb2xlYW4oKSksXG4gIGhhczogTS5jYWxsKE0ucmF3KCksIE0uYW55KCkpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICBndWVzdFRvSG9zdDogTS5jYWxsKE0ucmF3KCkpLnJldHVybnMoTS5hbnkoKSksXG4gIGhvc3RUb0d1ZXN0OiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucyhNLnJhdygpKVxufSk7XG52YXIgdG9LZXkgPSAoaykgPT4gKFxuICAvL1xuICBpc1Bhc3NhYmxlKGspID8gdG9QYXNzYWJsZUNhcChrKSA6IGtcbik7XG52YXIgbWFrZVZvd2lzaFN0b3JlID0gKG5hbWUpID0+IHtcbiAgY29uc3QgbWFwID0gLyogICAgICAgICAgICovIG5ldyBNYXAoKTtcbiAgcmV0dXJuIEZhcihuYW1lLCB7XG4gICAgaW5pdDogKGssIHYyKSA9PiB7XG4gICAgICBjb25zdCBrMiA9IHRvS2V5KGspO1xuICAgICAgIW1hcC5oYXMoazIpIHx8IC8vXG4gICAgICB0aHJvd1JlZGFjdGVkYCR7YmFyZU9yUXVvdGUobmFtZSl9IGtleSBhbHJlYWR5IGJvdW5kOiAke2t9IC0+ICR7bWFwLmdldChrMil9IHZzICR7djJ9YDtcbiAgICAgIG1hcC5zZXQoazIsIHYyKTtcbiAgICB9LFxuICAgIGhhczogKGspID0+IG1hcC5oYXModG9LZXkoaykpLFxuICAgIGdldDogKGspID0+IHtcbiAgICAgIGNvbnN0IGsyID0gdG9LZXkoayk7XG4gICAgICBtYXAuaGFzKGsyKSB8fCAvL1xuICAgICAgdGhyb3dSZWRhY3RlZGAke2JhcmVPclF1b3RlKG5hbWUpfSBrZXkgbm90IGZvdW5kOiAke2t9YDtcbiAgICAgIHJldHVybiBtYXAuZ2V0KGsyKTtcbiAgICB9XG4gIH0pO1xufTtcbnZhciBwcmVwYXJlQmlqZWN0aW9uID0gKHpvbmUsIHVud3JhcCA9IChfaG9zdFdyYXBwZXIsIGd1ZXN0V3JhcHBlcikgPT4gZ3Vlc3RXcmFwcGVyKSA9PiB7XG4gIGNvbnN0IGcyaCA9IG1ha2VFcGhlbWVyYSgoKSA9PiBtYWtlVm93aXNoU3RvcmUoXCJndWVzdFRvSG9zdFwiKSk7XG4gIGNvbnN0IGgyZyA9IG1ha2VFcGhlbWVyYSgoKSA9PiBtYWtlVm93aXNoU3RvcmUoXCJob3N0VG9HdWVzdFwiKSk7XG4gIHJldHVybiB6b25lLmV4b0NsYXNzKFwiQmlqZWN0aW9uXCIsIEJpamVjdGlvbkksICgpID0+ICh7fSksIHtcbiAgICByZXNldCgpIHtcbiAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgIGcyaC5yZXNldEZvcihzZWxmKTtcbiAgICAgIGgyZy5yZXNldEZvcihzZWxmKTtcbiAgICB9LFxuICAgIHVud3JhcEluaXQoZzIsIGgpIHtcbiAgICAgIGhhcmRlbihnMik7XG4gICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICBjb25zdCBndWVzdFRvSG9zdCA9IGcyaC5mb3Ioc2VsZik7XG4gICAgICBjb25zdCBob3N0VG9HdWVzdCA9IGgyZy5mb3Ioc2VsZik7XG4gICAgICBjb25zdCBnVW53cmFwcGVkID0gdW53cmFwKGgsIGcyKTtcbiAgICAgICFob3N0VG9HdWVzdC5oYXMoaCkgfHwgdGhyb3dSZWRhY3RlZGBob3N0VG9HdWVzdCBrZXkgYWxyZWFkeSBib3VuZDogJHtofSAtPiAke2hvc3RUb0d1ZXN0LmdldChoKX0gdnMgJHtnVW53cmFwcGVkfWA7XG4gICAgICBndWVzdFRvSG9zdC5pbml0KGdVbndyYXBwZWQsIGgpO1xuICAgICAgaG9zdFRvR3Vlc3QuaW5pdChoLCBnVW53cmFwcGVkKTtcbiAgICAgIHNlbGYuaGFzKGdVbndyYXBwZWQsIGgpIHx8IC8vXG4gICAgICB0aHJvd1JlZGFjdGVkYGludGVybmFsOiAke2cyfSA8LT4gJHtofWA7XG4gICAgICBpZiAoZzIgIT09IGdVbndyYXBwZWQpIHtcbiAgICAgICAgIWd1ZXN0VG9Ib3N0LmhhcyhnMikgfHwgLy9cbiAgICAgICAgdGhyb3dSZWRhY3RlZGBoaWRkZW4gZ3Vlc3Qgd3JhcHBlciBhbHJlYWR5IGJvdW5kICR7ZzJ9YDtcbiAgICAgICAgZ3Vlc3RUb0hvc3QuaW5pdChnMiwgaCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZ1Vud3JhcHBlZDtcbiAgICB9LFxuICAgIGhhc0d1ZXN0KGcyKSB7XG4gICAgICBoYXJkZW4oZzIpO1xuICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgY29uc3QgZ3Vlc3RUb0hvc3QgPSBnMmguZm9yKHNlbGYpO1xuICAgICAgcmV0dXJuIGd1ZXN0VG9Ib3N0LmhhcyhnMik7XG4gICAgfSxcbiAgICBoYXNIb3N0KGgpIHtcbiAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgIGNvbnN0IGhvc3RUb0d1ZXN0ID0gaDJnLmZvcihzZWxmKTtcbiAgICAgIHJldHVybiBob3N0VG9HdWVzdC5oYXMoaCk7XG4gICAgfSxcbiAgICBoYXMoZzIsIGgpIHtcbiAgICAgIGhhcmRlbihnMik7XG4gICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICBjb25zdCBndWVzdFRvSG9zdCA9IGcyaC5mb3Ioc2VsZik7XG4gICAgICBjb25zdCBob3N0VG9HdWVzdCA9IGgyZy5mb3Ioc2VsZik7XG4gICAgICBpZiAoZ3Vlc3RUb0hvc3QuaGFzKGcyKSkge1xuICAgICAgICB0b1Bhc3NhYmxlQ2FwKGd1ZXN0VG9Ib3N0LmdldChnMikpID09PSB0b1Bhc3NhYmxlQ2FwKGgpIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGctPmggJHtnMn0gLT4gJHtofSB2cyAke2d1ZXN0VG9Ib3N0LmdldChnMil9YDtcbiAgICAgICAgaG9zdFRvR3Vlc3QuZ2V0KGgpID09PSBnMiB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsIGgtPmc6ICR7aH0gLT4gJHtnMn0gdnMgJHtob3N0VG9HdWVzdC5nZXQoaCl9YDtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAhaG9zdFRvR3Vlc3QuaGFzKGgpIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IHVuZXhwZWN0ZWQgaC0+ZyAke2h9IC0+ICR7aG9zdFRvR3Vlc3QuZ2V0KGgpfWA7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGd1ZXN0VG9Ib3N0KGcyKSB7XG4gICAgICBoYXJkZW4oZzIpO1xuICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgY29uc3QgZ3Vlc3RUb0hvc3QgPSBnMmguZm9yKHNlbGYpO1xuICAgICAgcmV0dXJuIGd1ZXN0VG9Ib3N0LmdldChnMik7XG4gICAgfSxcbiAgICBob3N0VG9HdWVzdChoKSB7XG4gICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICBjb25zdCBob3N0VG9HdWVzdCA9IGgyZy5mb3Ioc2VsZik7XG4gICAgICByZXR1cm4gaG9zdFRvR3Vlc3QuZ2V0KGgpO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKHByZXBhcmVCaWplY3Rpb24pO1xuXG4vL1xudmFyIHsgaXNGcm96ZW46IGlzRnJvemVuNyB9ID0gT2JqZWN0O1xudmFyIFVwZ3JhZGVEaXNjb25uZWN0aW9uU2hhcGUyID0gaGFyZGVuKHtcbiAgbmFtZTogXCJ2YXRVcGdyYWRlZFwiLFxuICB1cGdyYWRlTWVzc2FnZTogTS5zdHJpbmcoKSxcbiAgaW5jYXJuYXRpb25OdW1iZXI6IE0ubnVtYmVyKClcbn0pO1xudmFyIG1ha2VVcGdyYWRlRGlzY29ubmVjdGlvbjIgPSAodXBncmFkZU1lc3NhZ2UsIHRvSW5jYXJuYXRpb25OdW1iZXIpID0+IGhhcmRlbih7XG4gIG5hbWU6IFwidmF0VXBncmFkZWRcIixcbiAgdXBncmFkZU1lc3NhZ2UsXG4gIGluY2FybmF0aW9uTnVtYmVyOiB0b0luY2FybmF0aW9uTnVtYmVyXG59KTtcbmhhcmRlbihtYWtlVXBncmFkZURpc2Nvbm5lY3Rpb24yKTtcbnZhciBpc1VwZ3JhZGVEaXNjb25uZWN0aW9uMiA9IChyZWFzb24pID0+IHJlYXNvbiAhPSBudWxsICYmIC8vXG5pc0Zyb3plbjcocmVhc29uKSAmJiBtYXRjaGVzKHJlYXNvbiwgVXBncmFkZURpc2Nvbm5lY3Rpb25TaGFwZTIpO1xuaGFyZGVuKGlzVXBncmFkZURpc2Nvbm5lY3Rpb24yKTtcbnZhciBpc0FiYW5kb25lZEVycm9yMiA9IChyZWFzb24pID0+IHJlYXNvbiAhPSBudWxsICYmIC8vXG5pc0Zyb3plbjcocmVhc29uKSAmJiBtYXRjaGVzKHJlYXNvbiwgTS5lcnJvcigpKSAmJiAvL1xuLy9cbnJlYXNvbi5tZXNzYWdlID09PSBcInZhdCB0ZXJtaW5hdGVkXCI7XG5oYXJkZW4oaXNBYmFuZG9uZWRFcnJvcjIpO1xuXG4vL1xudmFyIHtcbiAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I0LFxuICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzOiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzNyxcbiAgY3JlYXRlOiBjcmVhdGU1LFxuICBmcm9tRW50cmllczogZnJvbUVudHJpZXMxMCxcbiAgZW50cmllczogZW50cmllczksXG4gIHByb3RvdHlwZTogb2JqZWN0UHJvdG90eXBlNlxufSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IG93bktleXMyMCB9ID0gUmVmbGVjdDtcbnZhciBGdW5jdGlvbldyYXBwZXJJID0gTS5pbnRlcmZhY2UoXCJGdW5jdGlvbldyYXBwZXJcIiwge1xuICBhcHBseTogTS5jYWxsKE0uYXJyYXkoKSkucmV0dXJucyhNLmFueSgpKVxufSk7XG52YXIgU3RhdGVBY2Nlc3NvckkgPSBNLmludGVyZmFjZShcIlN0YXRlQWNjZXNzb3JcIiwge1xuICBnZXQ6IE0uY2FsbChQcm9wZXJ0eUtleVNoYXBlKS5yZXR1cm5zKE0uYW55KCkpLFxuICBzZXQ6IE0uY2FsbChQcm9wZXJ0eUtleVNoYXBlLCBNLmFueSgpKS5yZXR1cm5zKClcbn0pO1xudmFyIFVud3JhcHBlckkgPSBNLmludGVyZmFjZShcIlVud3JhcHBlclwiLCB7XG4gIHVud3JhcDogTS5jYWxsKE0ucmVtb3RhYmxlKFwiZ3Vlc3RXcmFwcGVkXCIpKS5yZXR1cm5zKE0ucmF3KCkpXG59KTtcbnZhciBmb3J3YXJkaW5nTWV0aG9kcyA9IChyZW0pID0+IHtcbiAgY29uc3Qga2V5czUgPSByZW1bR0VUX01FVEhPRF9OQU1FU10oKTtcbiAgY29uc3QgbWFrZU1ldGhvZEVudHJ5ID0gKGtleSkgPT4gZW50cmllczkoe1xuICAgIFtrZXldKC4uLmFyZ3MpIHtcbiAgICAgIHJldHVybiByZW1ba2V5XSguLi5hcmdzKTtcbiAgICB9XG4gIH0pWzBdO1xuICByZXR1cm4gZnJvbUVudHJpZXMxMChrZXlzNS5tYXAobWFrZU1ldGhvZEVudHJ5KSk7XG59O1xudmFyIHByZXBhcmVFbmRvd21lbnRUb29scyA9IChvdXRlclpvbmUsIG91dGVyT3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHsgdm93VG9vbHMgPSBwcmVwYXJlU3dpbmdzZXRWb3dUb29scyhvdXRlclpvbmUpIH0gPSBvdXRlck9wdGlvbnM7XG4gIGNvbnN0IHsgbWFrZVZvd0tpdCB9ID0gdm93VG9vbHM7XG4gIGNvbnN0IGZ1bmN0aW9uVW53cmFwcGVyID0gb3V0ZXJab25lLmV4byhcIkZ1bmN0aW9uVW53cmFwcGVyXCIsIFVud3JhcHBlckksIHtcbiAgICB1bndyYXAoZ3Vlc3RXcmFwcGVkKSB7XG4gICAgICByZXR1cm4gRmFyKFwiVW53cmFwcGVkRnVuY3Rpb25cIiwgKC4uLmFyZ3MpID0+IGd1ZXN0V3JhcHBlZC5hcHBseShhcmdzKSk7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgbWFrZVN0YXRlVW53cmFwcGVyID0gb3V0ZXJab25lLmV4b0NsYXNzKFxuICAgIFwiU3RhdGVVbndyYXBwZXJcIixcbiAgICBVbndyYXBwZXJJLFxuICAgIChrZXlzNSkgPT4gKHsga2V5czoga2V5czUgfSksXG4gICAge1xuICAgICAgdW53cmFwKGd1ZXN0V3JhcHBlZCkge1xuICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGtleXM6IGtleXM1IH0gPSBzdGF0ZTtcbiAgICAgICAgcmV0dXJuIGhhcmRlbihcbiAgICAgICAgICBjcmVhdGU1KFxuICAgICAgICAgICAgb2JqZWN0UHJvdG90eXBlNixcbiAgICAgICAgICAgIGZyb21FbnRyaWVzMTAoXG4gICAgICAgICAgICAgIGtleXM1LmZsYXRNYXAoXG4gICAgICAgICAgICAgICAgKGtleSkgPT4gZW50cmllczkoXG4gICAgICAgICAgICAgICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzNyh7XG4gICAgICAgICAgICAgICAgICAgIGdldCBba2V5XSgpIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ3Vlc3RXcmFwcGVkLmdldChrZXkpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzZXQgW2tleV0obmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICBndWVzdFdyYXBwZWQuc2V0KGtleSwgbmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IGVuZG93bWVudEtpbmRPZiA9IChlMikgPT4ge1xuICAgIGhhcmRlbihlMik7XG4gICAgaWYgKGlzUHJvbWlzZShlMikpIHtcbiAgICAgIHJldHVybiBcInByb21pc2VcIjtcbiAgICB9IGVsc2UgaWYgKG91dGVyWm9uZS5pc1N0b3JhYmxlKGUyKSkge1xuICAgICAgcmV0dXJuIFwic3RvcmFibGVcIjtcbiAgICB9IGVsc2UgaWYgKGlzUGFzc2FibGUoZTIpICYmIGlzUmVtb3RhYmxlKGUyKSkge1xuICAgICAgcmV0dXJuIFwiZmFyXCI7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZTIgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgcmV0dXJuIFwiZnVuY3Rpb25cIjtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBlMiA9PT0gXCJvYmplY3RcIikge1xuICAgICAgaWYgKGUyID09PSBudWxsKSB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IG51bGwgaXMgYWx3YXlzIHN0b3JhYmxlYDtcbiAgICAgIH1cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGUyKSkge1xuICAgICAgICByZXR1cm4gXCJhcnJheVwiO1xuICAgICAgfVxuICAgICAgY29uc3Qga2V5czUgPSBvd25LZXlzMjAoZTIpO1xuICAgICAga2V5czUubGVuZ3RoID49IDEgfHwgdGhyb3dSZWRhY3RlZGBlbXB0eSByZWNvcmQgc2hvdWxkIGJlIHN0b3JhYmxlICR7ZTJ9YDtcbiAgICAgIGNvbnN0IGRlc2MgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I0KGUyLCBrZXlzNVswXSlcbiAgICAgICk7XG4gICAgICBpZiAoXCJ2YWx1ZVwiIGluIGRlc2MpIHtcbiAgICAgICAgcmV0dXJuIFwicmVjb3JkXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBcImdldFwiIGluIGRlc2MgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogdW5leHBlY3RlZCBkZXNjcmlwdG9yICR7ZGVzY31gO1xuICAgICAgICByZXR1cm4gXCJzdGF0ZVwiO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgZW5kb3dtZW50ICR7ZTJ9YDtcbiAgICB9XG4gIH07XG4gIGhhcmRlbihlbmRvd21lbnRLaW5kT2YpO1xuICBjb25zdCB1bndyYXBNYXAgPSBvdXRlclpvbmUud2Vha01hcFN0b3JlKFwidW53cmFwTWFwXCIsIHtcbiAgICBrZXlTaGFwZTogTS5yZW1vdGFibGUoXCJ3cmFwcGVkXCIpLFxuICAgIHZhbHVlU2hhcGU6IE0ucmVtb3RhYmxlKFwidW53cmFwcGVyXCIpXG4gIH0pO1xuICBjb25zdCB1bndyYXBNYXBIYXMgPSAoaykgPT4ge1xuICAgIGlmIChpc1ZvdyhrKSB8fCBpc1JlbW90YWJsZShrKSkge1xuICAgICAgcmV0dXJuIHVud3JhcE1hcC5oYXModG9QYXNzYWJsZUNhcChrKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHVud3JhcE1hcEdldCA9IChrKSA9PiB1bndyYXBNYXAuZ2V0KHRvUGFzc2FibGVDYXAoaykpO1xuICBjb25zdCB1bndyYXBNYXBTZXQgPSAoaywgdjIpID0+IHtcbiAgICBjb25zdCBrMiA9IHRvUGFzc2FibGVDYXAoayk7XG4gICAgaWYgKHVud3JhcE1hcEhhcyhrKSkge1xuICAgICAgdW53cmFwTWFwLnNldChrMiwgdjIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB1bndyYXBNYXAuaW5pdChrMiwgdjIpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgcHJlcGFyZUVuZG93bWVudCA9ICh6b25lLCB0YWcsIGUyKSA9PiB7XG4gICAgY29uc3QgZUtpbmQgPSBlbmRvd21lbnRLaW5kT2YoZTIpO1xuICAgIHN3aXRjaCAoZUtpbmQpIHtcbiAgICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgICAgY29uc3QgcDIgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIGUyXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHsgdm93LCByZXNvbHZlciB9ID0gbWFrZVZvd0tpdCgpO1xuICAgICAgICB2b2lkIEUud2hlbihcbiAgICAgICAgICBwMixcbiAgICAgICAgICAodjIpID0+IHtcbiAgICAgICAgICAgIHJlc29sdmVyLnJlc29sdmUodjIpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgKHJlYXNvbikgPT4ge1xuICAgICAgICAgICAgaWYgKCFpc1VwZ3JhZGVEaXNjb25uZWN0aW9uMihyZWFzb24pKSB7XG4gICAgICAgICAgICAgIHJlc29sdmVyLnJlamVjdChyZWFzb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHZvdztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJzdG9yYWJsZVwiOiB7XG4gICAgICAgIHJldHVybiBlMjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJmYXJcIjoge1xuICAgICAgICBjb25zdCByNiA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBlMlxuICAgICAgICApO1xuICAgICAgICBjb25zdCBtZXRob2RzID0gZm9yd2FyZGluZ01ldGhvZHMocjYpO1xuICAgICAgICByZXR1cm4gem9uZS5leG8oXG4gICAgICAgICAgdGFnLFxuICAgICAgICAgIE0uaW50ZXJmYWNlKFwiRmFyV3JhcHBlZFwiLCB7fSwgeyBkZWZhdWx0R3VhcmRzOiBcInJhd1wiIH0pLFxuICAgICAgICAgIG1ldGhvZHNcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJmdW5jdGlvblwiOiB7XG4gICAgICAgIGNvbnN0IGYyID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgZTJcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3Qgd3JhcHBlZCA9IHpvbmUuZXhvKHRhZywgRnVuY3Rpb25XcmFwcGVySSwge1xuICAgICAgICAgIGFwcGx5KGFyZ3MpIHtcbiAgICAgICAgICAgIHJldHVybiBmMiguLi5hcmdzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB1bndyYXBNYXBTZXQod3JhcHBlZCwgZnVuY3Rpb25VbndyYXBwZXIpO1xuICAgICAgICByZXR1cm4gd3JhcHBlZDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJhcnJheVwiOiB7XG4gICAgICAgIGNvbnN0IGEyID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIGUyXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHN1YlpvbmUgPSB6b25lLnN1YlpvbmUodGFnKTtcbiAgICAgICAgcmV0dXJuIGEyLm1hcCgoc3ViRSwgaTIpID0+IHByZXBhcmVFbmRvd21lbnQoc3ViWm9uZSwgYCR7aTJ9YCwgc3ViRSkpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInJlY29yZFwiOiB7XG4gICAgICAgIGNvbnN0IHI2ID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBlMlxuICAgICAgICApO1xuICAgICAgICBjb25zdCBzdWJab25lID0gem9uZS5zdWJab25lKHRhZyk7XG4gICAgICAgIHJldHVybiBvYmplY3RNYXAoXG4gICAgICAgICAgcjYsXG4gICAgICAgICAgKHN1YkUsIGspID0+IHByZXBhcmVFbmRvd21lbnQoc3ViWm9uZSwgU3RyaW5nKGspLCBzdWJFKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN0YXRlXCI6IHtcbiAgICAgICAgY29uc3Qgc3RhdGUgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIGUyXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IGtleXM1ID0gaGFyZGVuKG93bktleXMyMChzdGF0ZSkpO1xuICAgICAgICBjb25zdCB3cmFwcGVkID0gem9uZS5leG8odGFnLCBTdGF0ZUFjY2Vzc29ySSwge1xuICAgICAgICAgIGdldChrZXkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZVtrZXldO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2V0KGtleSwgbmV3VmFsdWUpIHtcbiAgICAgICAgICAgIHN0YXRlW2tleV0gPSBuZXdWYWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBzdGF0ZVVud3JhcHBlciA9IG1ha2VTdGF0ZVVud3JhcHBlcihrZXlzNSk7XG4gICAgICAgIHVud3JhcE1hcFNldCh3cmFwcGVkLCBzdGF0ZVVud3JhcHBlcik7XG4gICAgICAgIHJldHVybiB3cmFwcGVkO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgZW5kb3dtZW50ICR7ZTJ9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IHVud3JhcCA9ICh3cmFwcGVkLCBndWVzdFdyYXBwZWQpID0+IHtcbiAgICBpZiAodW53cmFwTWFwSGFzKHdyYXBwZWQpKSB7XG4gICAgICBjb25zdCB1bndyYXBwZXIgPSB1bndyYXBNYXBHZXQod3JhcHBlZCk7XG4gICAgICByZXR1cm4gdW53cmFwcGVyLnVud3JhcChndWVzdFdyYXBwZWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZ3Vlc3RXcmFwcGVkO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IHByZXBhcmVFbmRvd21lbnQsIHVud3JhcCB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZUVuZG93bWVudFRvb2xzKTtcblxuLy9cbnZhciB7IGRlZmluZVByb3BlcnRpZXM6IGRlZmluZVByb3BlcnRpZXM2IH0gPSBPYmplY3Q7XG52YXIgQXN5bmNGbG93SUtpdCA9IGhhcmRlbih7XG4gIGZsb3c6IE0uaW50ZXJmYWNlKFwiRmxvd1wiLCB7XG4gICAgZ2V0Rmxvd1N0YXRlOiBNLmNhbGwoKS5yZXR1cm5zKEZsb3dTdGF0ZVNoYXBlKSxcbiAgICByZXN0YXJ0OiBNLmNhbGwoKS5vcHRpb25hbChNLmJvb2xlYW4oKSkucmV0dXJucygpLFxuICAgIHdha2U6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgICBnZXRPdXRjb21lOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgICBkdW1wOiBNLmNhbGwoKS5yZXR1cm5zKE0uYXJyYXlPZihMb2dFbnRyeVNoYXBlKSksXG4gICAgZ2V0T3B0RmF0YWxQcm9ibGVtOiBNLmNhbGwoKS5yZXR1cm5zKE0ub3B0KE0uZXJyb3IoKSkpXG4gIH0pLFxuICBhZG1pbjogTS5pbnRlcmZhY2UoXCJGbG93QWRtaW5cIiwge1xuICAgIHJlc2V0OiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gICAgY29tcGxldGU6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgICBwYW5pYzogTS5jYWxsKE0uZXJyb3IoKSkucmV0dXJucyhNLm5vdChNLmFueSgpKSlcbiAgICAvL1xuICB9KSxcbiAgd2FrZVdhdGNoZXI6IFByb21pc2VXYXRjaGVySVxufSk7XG52YXIgQWRtaW5Bc3luY0Zsb3dJID0gTS5pbnRlcmZhY2UoXCJBc3luY0Zsb3dBZG1pblwiLCB7XG4gIGdldEZhaWx1cmVzOiBNLmNhbGwoKS5yZXR1cm5zKE0ubWFwT2YoTS5yZW1vdGFibGUoXCJhc3luY0Zsb3dcIiksIE0uZXJyb3IoKSkpLFxuICB3YWtlQWxsOiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gIGdldEZsb3dGb3JPdXRjb21lVm93OiBNLmNhbGwoVm93U2hhcGUpLnJldHVybnMoTS5vcHQoTS5yZW1vdGFibGUoXCJmbG93XCIpKSlcbn0pO1xudmFyIHByZXBhcmVBc3luY0Zsb3dUb29scyA9IChvdXRlclpvbmUsIG91dGVyT3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICB2b3dUb29scyA9IHByZXBhcmVTd2luZ3NldFZvd1Rvb2xzKG91dGVyWm9uZSksXG4gICAgbWFrZUxvZ1N0b3JlID0gcHJlcGFyZUxvZ1N0b3JlKG91dGVyWm9uZSksXG4gICAgZW5kb3dtZW50VG9vbHM6IHsgcHJlcGFyZUVuZG93bWVudCwgdW53cmFwIH0gPSBwcmVwYXJlRW5kb3dtZW50VG9vbHMoXG4gICAgICBvdXRlclpvbmUsXG4gICAgICB7IHZvd1Rvb2xzIH1cbiAgICApLFxuICAgIG1ha2VCaWplY3Rpb24gPSBwcmVwYXJlQmlqZWN0aW9uKG91dGVyWm9uZSwgdW53cmFwKSxcbiAgICBwYW5pY0hhbmRsZXIgPSAoZXJyKSA9PiB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9ID0gb3V0ZXJPcHRpb25zO1xuICBjb25zdCB7IHdhdGNoLCBtYWtlVm93S2l0IH0gPSB2b3dUb29scztcbiAgY29uc3QgZmFpbHVyZXMgPSBvdXRlclpvbmUubWFwU3RvcmUoXCJhc3luY0Z1bmNGYWlsdXJlc1wiLCB7XG4gICAga2V5U2hhcGU6IE0ucmVtb3RhYmxlKFwiZmxvd1wiKSxcbiAgICAvL1xuICAgIHZhbHVlU2hhcGU6IE0uZXJyb3IoKVxuICB9KTtcbiAgY29uc3QgZWFnZXJXYWtlcnMgPSBvdXRlclpvbmUuc2V0U3RvcmUoYGFzeW5jRnVuY0VhZ2VyV2FrZXJzYCwge1xuICAgIGtleVNoYXBlOiBNLnJlbW90YWJsZShcImZsb3dcIilcbiAgICAvL1xuICB9KTtcbiAgY29uc3QgbWVtYnJhbmVNYXAgPSBtYWtlU2NhbGFyV2Vha01hcFN0b3JlMihcIm1lbWJyYW5lRm9yXCIsIHtcbiAgICBrZXlTaGFwZTogTS5yZW1vdGFibGUoXCJmbG93XCIpLFxuICAgIHZhbHVlU2hhcGU6IE0ucmVtb3RhYmxlKFwibWVtYnJhbmVcIilcbiAgfSk7XG4gIGNvbnN0IGhhc01lbWJyYW5lID0gKGZsb3cpID0+IG1lbWJyYW5lTWFwLmhhcyhmbG93KTtcbiAgY29uc3QgZ2V0TWVtYnJhbmUgPSAoZmxvdykgPT4gbWVtYnJhbmVNYXAuZ2V0KGZsb3cpO1xuICBjb25zdCBpbml0TWVtYnJhbmUgPSAoZmxvdywgbWVtYnJhbmUpID0+IG1lbWJyYW5lTWFwLmluaXQoZmxvdywgbWVtYnJhbmUpO1xuICBjb25zdCBkZWxldGVNZW1icmFuZSA9IChmbG93KSA9PiBtZW1icmFuZU1hcC5kZWxldGUoZmxvdyk7XG4gIGNvbnN0IGZsb3dGb3JPdXRjb21lVm93S2V5ID0gb3V0ZXJab25lLm1hcFN0b3JlKFwiZmxvd0Zvck91dGNvbWVWb3dcIiwge1xuICAgIGtleVNoYXBlOiBNLnJlbW90YWJsZShcInRvUGFzc2FibGVDYXBcIiksXG4gICAgdmFsdWVTaGFwZTogTS5yZW1vdGFibGUoXCJmbG93XCIpXG4gICAgLy9cbiAgfSk7XG4gIGNvbnN0IHByZXBhcmVBc3luY0Zsb3dLaXQgPSAoem9uZSwgdGFnLCBndWVzdEFzeW5jRnVuYywgb3B0aW9ucyA9IHt9KSA9PiB7XG4gICAgdHlwZW9mIGd1ZXN0QXN5bmNGdW5jID09PSBcImZ1bmN0aW9uXCIgfHwgdGhyb3dSZWRhY3RlZGBndWVzdEFzeW5jRnVuYyBtdXN0IGJlIGEgY2FsbGFibGUgZnVuY3Rpb24gJHtndWVzdEFzeW5jRnVuY31gO1xuICAgIGNvbnN0IHtcbiAgICAgIC8vXG4gICAgICBzdGFydEVhZ2VyID0gdHJ1ZVxuICAgIH0gPSBvcHRpb25zO1xuICAgIGNvbnN0IGludGVybmFsTWFrZUFzeW5jRmxvd0tpdCA9IHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgICB0YWcsXG4gICAgICBBc3luY0Zsb3dJS2l0LFxuICAgICAgKGFjdGl2YXRpb25BcmdzKSA9PiB7XG4gICAgICAgIGhhcmRlbihhY3RpdmF0aW9uQXJncyk7XG4gICAgICAgIGNvbnN0IGxvZyA9IG1ha2VMb2dTdG9yZSgpO1xuICAgICAgICBjb25zdCBiaWplY3Rpb24gPSBtYWtlQmlqZWN0aW9uKCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWN0aXZhdGlvbkFyZ3MsXG4gICAgICAgICAgLy9cbiAgICAgICAgICBsb2csXG4gICAgICAgICAgLy9cbiAgICAgICAgICBiaWplY3Rpb24sXG4gICAgICAgICAgLy9cbiAgICAgICAgICBvdXRjb21lS2l0OiBtYWtlVm93S2l0KCksXG4gICAgICAgICAgLy9cbiAgICAgICAgICBpc0RvbmU6IGZhbHNlXG4gICAgICAgICAgLy9cbiAgICAgICAgfTtcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGZsb3c6IHtcbiAgICAgICAgICAvKlxuXG4gICAgICAgICAgICovXG4gICAgICAgICAgZ2V0Rmxvd1N0YXRlKCkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBsb2csIG91dGNvbWVLaXQsIGlzRG9uZSB9ID0gc3RhdGU7XG4gICAgICAgICAgICBjb25zdCB7IGZsb3cgfSA9IGZhY2V0cztcbiAgICAgICAgICAgIGlmIChpc0RvbmUpIHtcbiAgICAgICAgICAgICAgIWhhc01lbWJyYW5lKGZsb3cpIHx8IHRocm93UmVkYWN0ZWRgRG9uZSBmbG93IG11c3QgZHJvcCBtZW1icmFuZSAke2Zsb3d9ICR7Z2V0TWVtYnJhbmUoZmxvdyl9YDtcbiAgICAgICAgICAgICAgIWZhaWx1cmVzLmhhcyhmbG93KSB8fCB0aHJvd1JlZGFjdGVkYERvbmUgZmxvdyBtdXN0IG5vdCBiZSBpbiBmYWlsdXJlcyAke2Zsb3d9ICR7ZmFpbHVyZXMuZ2V0KGZsb3cpfWA7XG4gICAgICAgICAgICAgICFlYWdlcldha2Vycy5oYXMoZmxvdykgfHwgdGhyb3dSZWRhY3RlZGBEb25lIGZsb3cgbXVzdCBub3QgYmUgaW4gZWFnZXJXYWtlcnMgJHtmbG93fWA7XG4gICAgICAgICAgICAgICFmbG93Rm9yT3V0Y29tZVZvd0tleS5oYXMob3V0Y29tZUtpdC52b3cpIHx8IHRocm93UmVkYWN0ZWRgRG9uZSBmbG93IG11c3QgZHJvcCBmbG93IGxvb2t1cCBmcm9tIHZvdyAke291dGNvbWVLaXQudm93fWA7XG4gICAgICAgICAgICAgIGxvZy5nZXRJbmRleCgpID09PSAwICYmIGxvZy5nZXRMZW5ndGgoKSA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYERvbmUgZmxvdyBtdXN0IGVtcHR5IGxvZyAke2Zsb3d9ICR7bG9nfWA7XG4gICAgICAgICAgICAgIHJldHVybiBcIkRvbmVcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmYWlsdXJlcy5oYXMoZmxvdykpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFwiRmFpbGVkXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWhhc01lbWJyYW5lKGZsb3cpKSB7XG4gICAgICAgICAgICAgIGxvZy5nZXRJbmRleCgpID09PSAwIHx8IHRocm93UmVkYWN0ZWRgU2xlZXBpbmcgZmxvdyBtdXN0IHBsYXkgZnJvbSBsb2cgc3RhcnQgJHtmbG93fSAke2xvZy5nZXRJbmRleCgpfWA7XG4gICAgICAgICAgICAgIHJldHVybiBcIlNsZWVwaW5nXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobG9nLmlzUmVwbGF5aW5nKCkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFwiUmVwbGF5aW5nXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gXCJSdW5uaW5nXCI7XG4gICAgICAgICAgfSxcbiAgICAgICAgICAvKlxuXG5cblxuXG4gICAgICAgICAgICovXG4gICAgICAgICAgcmVzdGFydChlYWdlciA9IHN0YXJ0RWFnZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgYWN0aXZhdGlvbkFyZ3MsIGxvZywgYmlqZWN0aW9uLCBvdXRjb21lS2l0IH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvdywgYWRtaW4sIHdha2VXYXRjaGVyIH0gPSBmYWNldHM7XG4gICAgICAgICAgICBjb25zdCBzdGFydEZsb3dTdGF0ZSA9IGZsb3cuZ2V0Rmxvd1N0YXRlKCk7XG4gICAgICAgICAgICBzdGFydEZsb3dTdGF0ZSAhPT0gXCJEb25lXCIgfHwgLy9cbiAgICAgICAgICAgIHRocm93UmVkYWN0ZWRgQ2Fubm90IHJlc3RhcnQgYSBkb25lIGZsb3cgJHtmbG93fWA7XG4gICAgICAgICAgICBhZG1pbi5yZXNldCgpO1xuICAgICAgICAgICAgaWYgKGVhZ2VyKSB7XG4gICAgICAgICAgICAgIGVhZ2VyV2FrZXJzLmFkZChmbG93KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWFnZXJXYWtlcnMuaGFzKGZsb3cpKSB7XG4gICAgICAgICAgICAgIGVhZ2VyV2FrZXJzLmRlbGV0ZShmbG93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHdhdGNoV2FrZSA9ICh2b3dpc2gpID0+IHtcbiAgICAgICAgICAgICAgem9uZS5pc1N0b3JhYmxlKHZvd2lzaCkgfHwgdGhyb3dSZWRhY3RlZGB2b3dpc2ggbXVzdCBiZSBzdG9yYWJsZSBpbiB0aGlzIHpvbmUgKHVzdWFsbHksIG11c3QgYmUgZHVyYWJsZSk6ICR7dm93aXNofWA7XG4gICAgICAgICAgICAgIHpvbmUuaXNTdG9yYWJsZSh3YWtlV2F0Y2hlcikgfHwgdGhyb3dSZWRhY3RlZGB3YWtlV2F0Y2hlciBtdXN0IGJlIHN0b3JhYmxlIGluIHRoaXMgem9uZSAodXN1YWxseSwgbXVzdCBiZSBkdXJhYmxlKTogJHt3YWtlV2F0Y2hlcn1gO1xuICAgICAgICAgICAgICB3YXRjaCh2b3dpc2gsIHdha2VXYXRjaGVyKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCBwYW5pYyA9IChlcnIpID0+IGFkbWluLnBhbmljKGVycik7XG4gICAgICAgICAgICBjb25zdCBtZW1icmFuZSA9IG1ha2VSZXBsYXlNZW1icmFuZSh7XG4gICAgICAgICAgICAgIGxvZyxcbiAgICAgICAgICAgICAgYmlqZWN0aW9uLFxuICAgICAgICAgICAgICB2b3dUb29scyxcbiAgICAgICAgICAgICAgd2F0Y2hXYWtlLFxuICAgICAgICAgICAgICBwYW5pY1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpbml0TWVtYnJhbmUoZmxvdywgbWVtYnJhbmUpO1xuICAgICAgICAgICAgY29uc3QgZ3Vlc3RBcmdzID0gbWVtYnJhbmUuaG9zdFRvR3Vlc3QoYWN0aXZhdGlvbkFyZ3MpO1xuICAgICAgICAgICAgY29uc3QgZmxvd1N0YXRlID0gZmxvdy5nZXRGbG93U3RhdGUoKTtcbiAgICAgICAgICAgIGZsb3dTdGF0ZSA9PT0gXCJSdW5uaW5nXCIgfHwgZmxvd1N0YXRlID09PSBcIlJlcGxheWluZ1wiIHx8IHRocm93UmVkYWN0ZWRgUmVzdGFydGVkIGZsb3cgbXVzdCBiZSBSdW5uaW5nIG9yIFJlcGxheWluZyAke2Zsb3d9YDtcbiAgICAgICAgICAgIG1lbWJyYW5lLndha2UoKTtcbiAgICAgICAgICAgIGNvbnN0IGd1ZXN0UmVzdWx0UCA9IChhc3luYyAoKSA9PiAoXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIGd1ZXN0QXN5bmNGdW5jKC4uLmd1ZXN0QXJncylcbiAgICAgICAgICAgICkpKCk7XG4gICAgICAgICAgICBpZiAoZmxvdy5nZXRGbG93U3RhdGUoKSAhPT0gXCJGYWlsZWRcIikge1xuICAgICAgICAgICAgICBjb25zdCBnMiA9IGJpamVjdGlvbi51bndyYXBJbml0KGd1ZXN0UmVzdWx0UCwgb3V0Y29tZUtpdC52b3cpO1xuICAgICAgICAgICAgICBnMiA9PT0gZ3Vlc3RSZXN1bHRQIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IHByb21pc2VzIHNob3VsZCBub3QgYmUgdW53cmFwcGVkICR7ZzJ9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZvaWQgRS53aGVuKFxuICAgICAgICAgICAgICBndWVzdFJlc3VsdFAsXG4gICAgICAgICAgICAgIChnRnVsZmlsbG1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoYmlqZWN0aW9uLmhhc0d1ZXN0KGd1ZXN0UmVzdWx0UCkpIHtcbiAgICAgICAgICAgICAgICAgICFsb2cuaXNSZXBsYXlpbmcoKSB8fCBwYW5pYyhcbiAgICAgICAgICAgICAgICAgICAgbWFrZUVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgIHJlZGFjdGVkYGd1ZXN0IGZ1bGZpbGxlZCB3aXRoICR7Z0Z1bGZpbGxtZW50fSBiZWZvcmUgZmluaXNoaW5nIHJlcGxheWBcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIG91dGNvbWVLaXQucmVzb2x2ZXIucmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgbWVtYnJhbmUuZ3Vlc3RUb0hvc3QoZ0Z1bGZpbGxtZW50KVxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIGFkbWluLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAoZ3Vlc3RSZWFzb24pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoYmlqZWN0aW9uLmhhc0d1ZXN0KGd1ZXN0UmVzdWx0UCkpIHtcbiAgICAgICAgICAgICAgICAgICFsb2cuaXNSZXBsYXlpbmcoKSB8fCBwYW5pYyhcbiAgICAgICAgICAgICAgICAgICAgbWFrZUVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgIHJlZGFjdGVkYGd1ZXN0IHJlamVjdGVkIHdpdGggJHtndWVzdFJlYXNvbn0gYmVmb3JlIGZpbmlzaGluZyByZXBsYXlgXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICBvdXRjb21lS2l0LnJlc29sdmVyLnJlamVjdChtZW1icmFuZS5ndWVzdFRvSG9zdChndWVzdFJlYXNvbikpO1xuICAgICAgICAgICAgICAgICAgYWRtaW4uY29tcGxldGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICkudGhlbihcbiAgICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChmbG93LmdldEZsb3dTdGF0ZSgpID09PSBcIkZhaWxlZFwiKSB7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBmbG93LmdldE9wdEZhdGFsUHJvYmxlbSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgKG1heWJlUGFuaWNSZWFzb24pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZmxvdy5nZXRGbG93U3RhdGUoKSA9PT0gXCJGYWlsZWRcIikge1xuICAgICAgICAgICAgICAgICAgY29uc3QgZXJyMiA9IGZsb3cuZ2V0T3B0RmF0YWxQcm9ibGVtKCk7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBlcnIyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBlcnIgPSBtYWtlRXJyb3IoXG4gICAgICAgICAgICAgICAgICByZWRhY3RlZGBpbnRlcm5hbDogdW5leHBlY3RlZCBlcnJvciBpbiBndWVzdCBjb21wbGV0aW9uIGhhbmRsaW5nICR7bWF5YmVQYW5pY1JlYXNvbn1gXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgcGFuaWMoZXJyKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChfZSkge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKS5jYXRjaChwYW5pY0hhbmRsZXIpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgd2FrZSgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBmbG93IH0gPSBmYWNldHM7XG4gICAgICAgICAgICBjb25zdCBmbG93U3RhdGUgPSBmbG93LmdldEZsb3dTdGF0ZSgpO1xuICAgICAgICAgICAgc3dpdGNoIChmbG93U3RhdGUpIHtcbiAgICAgICAgICAgICAgY2FzZSBcIkRvbmVcIjpcbiAgICAgICAgICAgICAgY2FzZSBcIkZhaWxlZFwiOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNhc2UgXCJSdW5uaW5nXCI6XG4gICAgICAgICAgICAgIGNhc2UgXCJSZXBsYXlpbmdcIjoge1xuICAgICAgICAgICAgICAgIGdldE1lbWJyYW5lKGZsb3cpLndha2UoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY2FzZSBcIlNsZWVwaW5nXCI6IHtcbiAgICAgICAgICAgICAgICBmbG93LnJlc3RhcnQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBmbG93U3RhdGUgJHtxdW90ZShmbG93U3RhdGUpfWA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldE91dGNvbWUoKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBvdXRjb21lS2l0IH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIHJldHVybiBvdXRjb21lS2l0LnZvdztcbiAgICAgICAgICB9LFxuICAgICAgICAgIGR1bXAoKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBsb2cgfSA9IHN0YXRlO1xuICAgICAgICAgICAgcmV0dXJuIGxvZy5kdW1wKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZXRPcHRGYXRhbFByb2JsZW0oKSB7XG4gICAgICAgICAgICBjb25zdCB7IGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvdyB9ID0gZmFjZXRzO1xuICAgICAgICAgICAgcmV0dXJuIGZhaWx1cmVzLmhhcyhmbG93KSA/IGZhaWx1cmVzLmdldChmbG93KSA6IHZvaWQgMDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGFkbWluOiB7XG4gICAgICAgICAgcmVzZXQoKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlLCBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGJpamVjdGlvbiwgbG9nIH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvdyB9ID0gZmFjZXRzO1xuICAgICAgICAgICAgIXN0YXRlLmlzRG9uZSB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCByZXNldCBhIGRvbmUgZmxvd2A7XG4gICAgICAgICAgICBpZiAoZmFpbHVyZXMuaGFzKGZsb3cpKSB7XG4gICAgICAgICAgICAgIGZhaWx1cmVzLmRlbGV0ZShmbG93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChoYXNNZW1icmFuZShmbG93KSkge1xuICAgICAgICAgICAgICBnZXRNZW1icmFuZShmbG93KS5zdG9wKCk7XG4gICAgICAgICAgICAgIGRlbGV0ZU1lbWJyYW5lKGZsb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbG9nLnJlc2V0KCk7XG4gICAgICAgICAgICBiaWplY3Rpb24ucmVzZXQoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbXBsZXRlKCkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBsb2cgfSA9IHN0YXRlO1xuICAgICAgICAgICAgY29uc3QgeyBmbG93LCBhZG1pbiB9ID0gZmFjZXRzO1xuICAgICAgICAgICAgYWRtaW4ucmVzZXQoKTtcbiAgICAgICAgICAgIGlmIChlYWdlcldha2Vycy5oYXMoZmxvdykpIHtcbiAgICAgICAgICAgICAgZWFnZXJXYWtlcnMuZGVsZXRlKGZsb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmxvd0Zvck91dGNvbWVWb3dLZXkuZGVsZXRlKHRvUGFzc2FibGVDYXAoZmxvdy5nZXRPdXRjb21lKCkpKTtcbiAgICAgICAgICAgIHN0YXRlLmlzRG9uZSA9IHRydWU7XG4gICAgICAgICAgICBsb2cuZGlzcG9zZSgpO1xuICAgICAgICAgICAgZmxvdy5nZXRGbG93U3RhdGUoKSA9PT0gXCJEb25lXCIgfHwgdGhyb3dSZWRhY3RlZGBDb21wbGV0ZSBmbG93IG11c3QgYmUgRG9uZSAke2Zsb3d9YDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBhbmljKGZhdGFsUHJvYmxlbSkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBiaWplY3Rpb24sIGxvZyB9ID0gc3RhdGU7XG4gICAgICAgICAgICBjb25zdCB7IGZsb3cgfSA9IGZhY2V0cztcbiAgICAgICAgICAgIGlmIChmYWlsdXJlcy5oYXMoZmxvdykpIHtcbiAgICAgICAgICAgICAgY29uc3QgcHJldkVyciA9IGZhaWx1cmVzLmdldChmbG93KTtcbiAgICAgICAgICAgICAgbm90ZShcbiAgICAgICAgICAgICAgICBwcmV2RXJyLFxuICAgICAgICAgICAgICAgIHJlZGFjdGVkYGRvdWJseSBmYWlsZWQgc29tZWhvdyB3aXRoICR7ZmF0YWxQcm9ibGVtfWBcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgZmF0YWxQcm9ibGVtID0gcHJldkVycjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGZhaWx1cmVzLmluaXQoZmxvdywgZmF0YWxQcm9ibGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChoYXNNZW1icmFuZShmbG93KSkge1xuICAgICAgICAgICAgICBnZXRNZW1icmFuZShmbG93KS5zdG9wKCk7XG4gICAgICAgICAgICAgIGRlbGV0ZU1lbWJyYW5lKGZsb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbG9nLnJlc2V0KCk7XG4gICAgICAgICAgICBiaWplY3Rpb24ucmVzZXQoKTtcbiAgICAgICAgICAgIGZsb3cuZ2V0Rmxvd1N0YXRlKCkgPT09IFwiRmFpbGVkXCIgfHwgdGhyb3dSZWRhY3RlZGBQYW5pY2tlZCBmbG93IG11c3QgYmUgRmFpbGVkICR7Zmxvd31gO1xuICAgICAgICAgICAgY29uc3QgZXJyID0gbWFrZUVycm9yKFxuICAgICAgICAgICAgICByZWRhY3RlZGBJbiBhIEZhaWxlZCBzdGF0ZTogc2VlIGdldEZhaWx1cmVzKCkgb3IgZ2V0T3B0RmF0YWxQcm9ibGVtKCkgZm9yIG1vcmUgaW5mb3JtYXRpb25gXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgbm90ZShlcnIsIHJlZGFjdGVkYGR1ZSB0byAke2ZhdGFsUHJvYmxlbX1gKTtcbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHdha2VXYXRjaGVyOiB7XG4gICAgICAgICAgb25GdWxmaWxsZWQoX2Z1bGZpbGxtZW50KSB7XG4gICAgICAgICAgICBjb25zdCB7IGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGZhY2V0cy5mbG93Lndha2UoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9uUmVqZWN0ZWQoX2Z1bGZpbGxtZW50KSB7XG4gICAgICAgICAgICBjb25zdCB7IGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGZhY2V0cy5mbG93Lndha2UoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICAgIGNvbnN0IG1ha2VBc3luY0Zsb3dLaXQgPSAoYWN0aXZhdGlvbkFyZ3MpID0+IHtcbiAgICAgIGNvbnN0IGFzeW5jRmxvd0tpdCA9IGludGVybmFsTWFrZUFzeW5jRmxvd0tpdChhY3RpdmF0aW9uQXJncyk7XG4gICAgICBjb25zdCB7IGZsb3cgfSA9IGFzeW5jRmxvd0tpdDtcbiAgICAgIGNvbnN0IHZvdyA9IGZsb3cuZ2V0T3V0Y29tZSgpO1xuICAgICAgZmxvd0Zvck91dGNvbWVWb3dLZXkuaW5pdCh0b1Bhc3NhYmxlQ2FwKHZvdyksIGZsb3cpO1xuICAgICAgZmxvdy5yZXN0YXJ0KCk7XG4gICAgICByZXR1cm4gYXN5bmNGbG93S2l0O1xuICAgIH07XG4gICAgcmV0dXJuIGhhcmRlbihtYWtlQXN5bmNGbG93S2l0KTtcbiAgfTtcbiAgY29uc3QgYXN5bmNGbG93ID0gKHpvbmUsIHRhZywgZ3Vlc3RGdW5jLCBvcHRpb25zID0gdm9pZCAwKSA9PiB7XG4gICAgY29uc3QgbWFrZUFzeW5jRmxvd0tpdCA9IHByZXBhcmVBc3luY0Zsb3dLaXQoem9uZSwgdGFnLCBndWVzdEZ1bmMsIG9wdGlvbnMpO1xuICAgIGNvbnN0IGhvc3RGdW5jTmFtZSA9IGAke3RhZ31faG9zdEZsb3dgO1xuICAgIGNvbnN0IHdyYXBwZXJGdW5jID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICB7XG4gICAgICAgIFtob3N0RnVuY05hbWVdKC4uLmFyZ3MpIHtcbiAgICAgICAgICBjb25zdCB7IGZsb3cgfSA9IG1ha2VBc3luY0Zsb3dLaXQoYXJncyk7XG4gICAgICAgICAgcmV0dXJuIGZsb3cuZ2V0T3V0Y29tZSgpO1xuICAgICAgICB9XG4gICAgICB9W2hvc3RGdW5jTmFtZV1cbiAgICApO1xuICAgIGRlZmluZVByb3BlcnRpZXM2KHdyYXBwZXJGdW5jLCB7XG4gICAgICBsZW5ndGg6IHsgdmFsdWU6IGd1ZXN0RnVuYy5sZW5ndGggfVxuICAgIH0pO1xuICAgIHJldHVybiBoYXJkZW4od3JhcHBlckZ1bmMpO1xuICB9O1xuICBjb25zdCBhZG1pbkFzeW5jRmxvdyA9IG91dGVyWm9uZS5leG8oXCJBZG1pbkFzeW5jRmxvd1wiLCBBZG1pbkFzeW5jRmxvd0ksIHtcbiAgICBnZXRGYWlsdXJlcygpIHtcbiAgICAgIHJldHVybiBmYWlsdXJlcy5zbmFwc2hvdCgpO1xuICAgIH0sXG4gICAgd2FrZUFsbCgpIHtcbiAgICAgIGNvbnN0IGZhaWx1cmVzVG9SZXN0YXJ0ID0gWy4uLmZhaWx1cmVzLmtleXMoKV07XG4gICAgICBjb25zdCBmbG93c1RvV2FrZSA9IFsuLi5lYWdlcldha2Vycy5rZXlzKCldO1xuICAgICAgZm9yIChjb25zdCBmbG93IG9mIGZhaWx1cmVzVG9SZXN0YXJ0KSB7XG4gICAgICAgIGZsb3cucmVzdGFydCgpO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBmbG93IG9mIGZsb3dzVG9XYWtlKSB7XG4gICAgICAgIGZsb3cud2FrZSgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZ2V0Rmxvd0Zvck91dGNvbWVWb3cob3V0Y29tZVZvdykge1xuICAgICAgcmV0dXJuIGZsb3dGb3JPdXRjb21lVm93S2V5LmdldCh0b1Bhc3NhYmxlQ2FwKG91dGNvbWVWb3cpKTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBhbGxXb2tlblAgPSBFLndoZW4obnVsbCwgKCkgPT4gYWRtaW5Bc3luY0Zsb3cud2FrZUFsbCgpKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgcHJlcGFyZUFzeW5jRmxvd0tpdCxcbiAgICBhc3luY0Zsb3csXG4gICAgYWRtaW5Bc3luY0Zsb3csXG4gICAgYWxsV29rZW5QLFxuICAgIHByZXBhcmVFbmRvd21lbnRcbiAgfSk7XG59O1xuaGFyZGVuKHByZXBhcmVBc3luY0Zsb3dUb29scyk7XG5cbi8vXG52YXIgQnJpZGdlSWQgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBCQU5LOiBcImJhbmtcIixcbiAgICBDT1JFOiBcImNvcmVcIixcbiAgICBESUJDOiBcImRpYmNcIixcbiAgICBTVE9SQUdFOiBcInN0b3JhZ2VcIixcbiAgICBQUk9WSVNJT046IFwicHJvdmlzaW9uXCIsXG4gICAgUFJPVklTSU9OX1NNQVJUX1dBTExFVDogXCJwcm92aXNpb25XYWxsZXRcIixcbiAgICBWTE9DQUxDSEFJTjogXCJ2bG9jYWxjaGFpblwiLFxuICAgIFZUUkFOU0ZFUjogXCJ2dHJhbnNmZXJcIixcbiAgICBXQUxMRVQ6IFwid2FsbGV0XCJcbiAgfVxuKTtcbmhhcmRlbihCcmlkZ2VJZCk7XG52YXIgQ29zbW9zSW5pdEtleVRvQnJpZGdlSWQgPSB7XG4gIHZiYW5rUG9ydDogXCJiYW5rXCIsXG4gIHZpYmNQb3J0OiBcImRpYmNcIlxufTtcbmhhcmRlbihDb3Ntb3NJbml0S2V5VG9CcmlkZ2VJZCk7XG52YXIgV2FsbGV0TmFtZSA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIGRlcG9zaXRGYWNldDogXCJkZXBvc2l0RmFjZXRcIlxuICB9XG4pO1xuaGFyZGVuKFdhbGxldE5hbWUpO1xudmFyIFZCYW5rQWNjb3VudCA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIHJlc2VydmU6IHtcbiAgICAgIG1vZHVsZTogXCJ2YmFuay9yZXNlcnZlXCIsXG4gICAgICBhZGRyZXNzOiBcImFnb3JpYzFhZTBsbXR6bGdyY25sYTl4amtwYWFycTVkNWRmZXo2M2gzbnVjbFwiXG4gICAgfSxcbiAgICBwcm92aXNpb246IHtcbiAgICAgIG1vZHVsZTogXCJ2YmFuay9wcm92aXNpb25cIixcbiAgICAgIGFkZHJlc3M6IFwiYWdvcmljMW1lZ3p5dGc2NWN5cmd6czZmdnp4Z3JjcXZ3d2w3dWdwdDYyMzQ2XCJcbiAgICB9XG4gIH1cbik7XG5oYXJkZW4oVkJhbmtBY2NvdW50KTtcblxuLy9cbnZhciBkZWJ1Z0luc3RhbmNlID0gMTtcbnZhciBtYWtlVHJhY2VyID0gKG5hbWUsIGVuYWJsZSA9IHRydWUpID0+IHtcbiAgZGVidWdJbnN0YW5jZSArPSAxO1xuICBsZXQgZGVidWdDb3VudCA9IDE7XG4gIGNvbnN0IGtleSA9IGAtLS0tLSAke25hbWV9LiR7ZGVidWdJbnN0YW5jZX0gYDtcbiAgc3dpdGNoIChlbmFibGUpIHtcbiAgICBjYXNlIGZhbHNlOiB7XG4gICAgICBjb25zdCBsb2dEaXNhYmxlZCA9ICguLi5fYXJncykgPT4ge1xuICAgICAgfTtcbiAgICAgIHJldHVybiBsb2dEaXNhYmxlZDtcbiAgICB9XG4gICAgY2FzZSBcInZlcmJvc2VcIjoge1xuICAgICAgY29uc3QgaW5mb1RpY2sgPSAob3B0TG9nLCAuLi5hcmdzKSA9PiB7XG4gICAgICAgIGlmIChvcHRMb2cubG9nKSB7XG4gICAgICAgICAgY29uc29sZS5pbmZvKGtleSwgZGVidWdDb3VudCArPSAxLCAuLi5hcmdzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmluZm8oa2V5LCBkZWJ1Z0NvdW50ICs9IDEsIG9wdExvZywgLi4uYXJncyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4gaW5mb1RpY2s7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIGNvbnN0IGRlYnVnVGljayA9IChvcHRMb2csIC4uLmFyZ3MpID0+IHtcbiAgICAgICAgaWYgKG9wdExvZy5sb2cpIHtcbiAgICAgICAgICBvcHRMb2cubG9nKGtleSwgZGVidWdDb3VudCArPSAxLCAuLi5hcmdzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmluZm8oa2V5LCBkZWJ1Z0NvdW50ICs9IDEsIG9wdExvZywgLi4uYXJncyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4gZGVidWdUaWNrO1xuICAgIH1cbiAgfVxufTtcbmhhcmRlbihtYWtlVHJhY2VyKTtcblxuLy9cbnZhciBOb25OdWxsaXNoID0gKHZhbCwgb3B0RGV0YWlscyA9IGB1bmV4cGVjdGVkICR7cXVvdGUodmFsKX1gKSA9PiB7XG4gIGlmICh2YWwgIT0gbnVsbCkge1xuICAgIHJldHVybiB2YWw7XG4gIH1cbiAgYXNzZXJ0LmZhaWwob3B0RGV0YWlscyk7XG59O1xuaGFyZGVuKE5vbk51bGxpc2gpO1xuXG4vL1xudmFyIHsgZGVmaW5lUHJvcGVydHk6IGRlZmluZVByb3BlcnR5MyB9ID0gT2JqZWN0O1xudmFyIHR5cGVkTWFwMiA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgKi9cbiAgRnVuY3Rpb24ucHJvdG90eXBlLmNhbGwuYmluZChBcnJheS5wcm90b3R5cGUubWFwKVxuKTtcbnZhciBsb2dMZXZlbHMyID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBbXG4gICAgXCJkZWJ1Z1wiLFxuICAgIFwibG9nXCIsXG4gICAgXCJpbmZvXCIsXG4gICAgXCJ3YXJuXCIsXG4gICAgXCJlcnJvclwiXG4gIF1cbik7XG5PYmplY3QuZnJlZXplKGxvZ0xldmVsczIpO1xuXG4vL1xudmFyIHsgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMTEgfSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IHJhd093bktleXMgfSA9IFJlZmxlY3Q7XG52YXIgb3duS2V5czIxID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICByYXdPd25LZXlzXG4pO1xudmFyIGlzUHJvcGVydHlLZXkgPSAoa2V5KSA9PiB7XG4gIHN3aXRjaCAodHlwZW9mIGtleSkge1xuICAgIGNhc2UgXCJzdHJpbmdcIjpcbiAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgY2FzZSBcInN5bWJvbFwiOlxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcbnZhciBjYWxsU3luYyA9IChjYWxsYmFjaywgLi4uYXJncykgPT4ge1xuICBjb25zdCB7IHRhcmdldCwgbWV0aG9kTmFtZSwgYm91bmQgfSA9IGNhbGxiYWNrO1xuICBpZiAobWV0aG9kTmFtZSA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRhcmdldCguLi5ib3VuZCwgLi4uYXJncyk7XG4gIH1cbiAgcmV0dXJuIHRhcmdldFttZXRob2ROYW1lXSguLi5ib3VuZCwgLi4uYXJncyk7XG59O1xuaGFyZGVuKGNhbGxTeW5jKTtcbnZhciBjYWxsRSA9IChjYWxsYmFjaywgLi4uYXJncykgPT4ge1xuICBjb25zdCB7IHRhcmdldCwgbWV0aG9kTmFtZSwgYm91bmQgfSA9IGNhbGxiYWNrO1xuICBpZiAobWV0aG9kTmFtZSA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIEUodGFyZ2V0KSguLi5ib3VuZCwgLi4uYXJncyk7XG4gIH1cbiAgcmV0dXJuIEUodGFyZ2V0KVttZXRob2ROYW1lXSguLi5ib3VuZCwgLi4uYXJncyk7XG59O1xuaGFyZGVuKGNhbGxFKTtcbnZhciBtYWtlU3luY0Z1bmN0aW9uQ2FsbGJhY2sgPSAodGFyZ2V0LCAuLi5ib3VuZCkgPT4ge1xuICB0eXBlb2YgdGFyZ2V0ID09PSBcImZ1bmN0aW9uXCIgfHwgdGhyb3dSZWRhY3RlZGBzeW5jIGZ1bmN0aW9uIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGEgZnVuY3Rpb246ICR7dGFyZ2V0fWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBib3VuZCwgaXNTeW5jOiB0cnVlIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VTeW5jRnVuY3Rpb25DYWxsYmFjayk7XG52YXIgbWFrZUZ1bmN0aW9uQ2FsbGJhY2sgPSAodGFyZ2V0LCAuLi5ib3VuZCkgPT4ge1xuICAhaXNQcmltaXRpdmUyKHRhcmdldCkgfHwgdGhyb3dSZWRhY3RlZGBmdW5jdGlvbiBjYWxsYmFjayB0YXJnZXQgbXVzdCBiZSBhIGZ1bmN0aW9uIHByZXNlbmNlOiAke3RhcmdldH1gO1xuICBjb25zdCBjYiA9IGhhcmRlbih7IHRhcmdldCwgYm91bmQgfSk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBjYlxuICApO1xufTtcbmhhcmRlbihtYWtlRnVuY3Rpb25DYWxsYmFjayk7XG52YXIgbWFrZVN5bmNNZXRob2RDYWxsYmFjayA9ICh0YXJnZXQsIG1ldGhvZE5hbWUsIC4uLmJvdW5kKSA9PiB7XG4gICFpc1ByaW1pdGl2ZTIodGFyZ2V0KSB8fCB0aHJvd1JlZGFjdGVkYHN5bmMgbWV0aG9kIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGFuIG9iamVjdDogJHt0YXJnZXR9YDtcbiAgdHlwZW9mIG1ldGhvZE5hbWUgPT09IFwic3RyaW5nXCIgfHwgaXNQYXNzYWJsZVN5bWJvbChtZXRob2ROYW1lKSB8fCB0aHJvd1JlZGFjdGVkYG1ldGhvZCBuYW1lIG11c3QgYmUgYSBzdHJpbmcgb3IgcGFzc2FibGUgc3ltYm9sOiAke21ldGhvZE5hbWV9YDtcbiAgY29uc3QgY2IgPSBoYXJkZW4oeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kLCBpc1N5bmM6IHRydWUgfSk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgY2JcbiAgKTtcbn07XG5oYXJkZW4obWFrZVN5bmNNZXRob2RDYWxsYmFjayk7XG52YXIgbWFrZU1ldGhvZENhbGxiYWNrID0gKHRhcmdldCwgbWV0aG9kTmFtZSwgLi4uYm91bmQpID0+IHtcbiAgIWlzUHJpbWl0aXZlMih0YXJnZXQpIHx8IHRocm93UmVkYWN0ZWRgbWV0aG9kIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGFuIG9iamVjdDogJHt0YXJnZXR9YDtcbiAgdHlwZW9mIG1ldGhvZE5hbWUgPT09IFwic3RyaW5nXCIgfHwgaXNQYXNzYWJsZVN5bWJvbChtZXRob2ROYW1lKSB8fCB0aHJvd1JlZGFjdGVkYG1ldGhvZCBuYW1lIG11c3QgYmUgYSBzdHJpbmcgb3IgcGFzc2FibGUgc3ltYm9sOiAke21ldGhvZE5hbWV9YDtcbiAgY29uc3QgY2IgPSBoYXJkZW4oeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgY2JcbiAgKTtcbn07XG5oYXJkZW4obWFrZU1ldGhvZENhbGxiYWNrKTtcbnZhciBpc0NhbGxiYWNrID0gKGNhbGxiYWNrKSA9PiB7XG4gIGlmIChpc1ByaW1pdGl2ZTIoY2FsbGJhY2spKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IHsgdGFyZ2V0LCBtZXRob2ROYW1lLCBib3VuZCB9ID0gY2FsbGJhY2s7XG4gIHJldHVybiAhaXNQcmltaXRpdmUyKHRhcmdldCkgJiYgKG1ldGhvZE5hbWUgPT09IHZvaWQgMCB8fCB0eXBlb2YgbWV0aG9kTmFtZSA9PT0gXCJzdHJpbmdcIiB8fCBpc1Bhc3NhYmxlU3ltYm9sKG1ldGhvZE5hbWUpKSAmJiBBcnJheS5pc0FycmF5KGJvdW5kKTtcbn07XG5oYXJkZW4oaXNDYWxsYmFjayk7XG52YXIgcHJlcGFyZUF0dGVudWF0b3IgPSAoem9uZSwgbWV0aG9kTmFtZXMsIHsgaW50ZXJmYWNlR3VhcmQsIHRhZyA9IFwiQXR0ZW51YXRvclwiIH0gPSB7fSkgPT4ge1xuICBjb25zdCBtZXRob2RzID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICBmcm9tRW50cmllczExKFxuICAgICAgbWV0aG9kTmFtZXMubWFwKChrZXkpID0+IHtcbiAgICAgICAgaWYgKCFpc1Byb3BlcnR5S2V5KGtleSkpIHtcbiAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGtleSAke3F1b3RlKGtleSl9IGlzIG5vdCBhIFByb3BlcnR5S2V5YDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtMiA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFtrZXldKC4uLmFyZ3MpIHtcbiAgICAgICAgICAgICAgY29uc3QgY2IgPSB0aGlzLnN0YXRlLmNic1trZXldO1xuICAgICAgICAgICAgICBpZiAoIWNiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXJyID0gbWFrZUVycm9yKGB1bmltcGxlbWVudGVkICR7cXVvdGUodGFnKX0gbWV0aG9kICR7cXVvdGUoa2V5KX1gKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5pc1N5bmMpIHtcbiAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGNiLmlzU3luYykge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsU3luYyhjYiwgLi4uYXJncyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxFKGNiLCAuLi5hcmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9W2tleV1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIFtrZXksIG0yXVxuICAgICAgICApO1xuICAgICAgfSlcbiAgICApXG4gICk7XG4gIGNvbnN0IG1ha2VBdHRlbnVhdG9yID0gem9uZS5leG9DbGFzcyhcbiAgICB0YWcsXG4gICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgICh7XG4gICAgICB0YXJnZXQgPSBudWxsLFxuICAgICAgaXNTeW5jID0gZmFsc2UsXG4gICAgICBvdmVycmlkZXMgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB7fVxuICAgICAgKVxuICAgIH0pID0+IHtcbiAgICAgIGNvbnN0IGNicyA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHt9XG4gICAgICApO1xuICAgICAgY29uc3QgcmVtYWluaW5nID0gbmV3IFNldChtZXRob2ROYW1lcyk7XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBvd25LZXlzMjEob3ZlcnJpZGVzKSkge1xuICAgICAgICByZW1haW5pbmcuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKHRhZyl9IG92ZXJyaWRlc1ske3F1b3RlKGtleSl9XSBub3QgYWxsb3dlZCBieSBtZXRob2ROYW1lc2A7XG4gICAgICAgIHJlbWFpbmluZy5kZWxldGUoa2V5KTtcbiAgICAgICAgY29uc3QgY2IgPSBvdmVycmlkZXNba2V5XTtcbiAgICAgICAgY2IgPT0gbnVsbCB8fCBpc0NhbGxiYWNrKGNiKSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gb3ZlcnJpZGVzWyR7cXVvdGUoa2V5KX1dIGlzIG5vdCBhIGNhbGxiYWNrOyBnb3QgJHtjYn1gO1xuICAgICAgICBjYnNba2V5XSA9IGNiO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBrZXkgb2YgcmVtYWluaW5nKSB7XG4gICAgICAgIGlmIChpc1N5bmMpIHtcbiAgICAgICAgICBjYnNba2V5XSA9IG1ha2VTeW5jTWV0aG9kQ2FsbGJhY2sodGFyZ2V0LCBrZXkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNic1trZXldID0gbWFrZU1ldGhvZENhbGxiYWNrKHRhcmdldCwga2V5KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGhhcmRlbih7IGNicywgaXNTeW5jIH0pO1xuICAgIH0sXG4gICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgIG1ldGhvZHNcbiAgKTtcbiAgcmV0dXJuIG1ha2VBdHRlbnVhdG9yO1xufTtcbmhhcmRlbihwcmVwYXJlQXR0ZW51YXRvcik7XG52YXIgcHJlcGFyZUd1YXJkZWRBdHRlbnVhdG9yID0gKHpvbmUsIGludGVyZmFjZUd1YXJkLCBvcHRzID0ge30pID0+IHtcbiAgY29uc3QgbWV0aG9kTmFtZXMgPSBnZXRJbnRlcmZhY2VNZXRob2RLZXlzKGludGVyZmFjZUd1YXJkKTtcbiAgY29uc3QgbWFrZUF0dGVudWF0b3IgPSBwcmVwYXJlQXR0ZW51YXRvcih6b25lLCBtZXRob2ROYW1lcywge1xuICAgIC4uLm9wdHMsXG4gICAgaW50ZXJmYWNlR3VhcmRcbiAgfSk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIG1ha2VBdHRlbnVhdG9yXG4gICk7XG59O1xuaGFyZGVuKHByZXBhcmVHdWFyZGVkQXR0ZW51YXRvcik7XG5cbi8vXG52YXIgU3RyZWFtQ2VsbFNoYXBlID0gaGFyZGVuKHtcbiAgYmxvY2tIZWlnaHQ6IE0uc3RyaW5nKCksXG4gIHZhbHVlczogTS5hcnJheSgpXG59KTtcbnZhciBDaGFpblN0b3JhZ2VOb2RlSSA9IE0uaW50ZXJmYWNlKFwiU3RvcmFnZU5vZGVcIiwge1xuICBzZXRWYWx1ZTogTS5jYWxsV2hlbihNLnN0cmluZygpKS5yZXR1cm5zKCksXG4gIGdldFBhdGg6IE0uY2FsbCgpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gIGdldFN0b3JlS2V5OiBNLmNhbGxXaGVuKCkucmV0dXJucyhNLnJlY29yZCgpKSxcbiAgbWFrZUNoaWxkTm9kZTogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uc3BsaXRSZWNvcmQoe30sIHsgc2VxdWVuY2U6IE0uYm9vbGVhbigpIH0sIHt9KSkucmV0dXJucyhNLnJlbW90YWJsZShcIlN0b3JhZ2VOb2RlXCIpKVxufSk7XG52YXIgaXNTdHJlYW1DZWxsID0gKGNlbGwpID0+IGNlbGwgJiYgdHlwZW9mIGNlbGwgPT09IFwib2JqZWN0XCIgJiYgQXJyYXkuaXNBcnJheShjZWxsLnZhbHVlcykgJiYgdHlwZW9mIGNlbGwuYmxvY2tIZWlnaHQgPT09IFwic3RyaW5nXCIgJiYgL14wJHxeWzEtOV1bMC05XSokLy50ZXN0KGNlbGwuYmxvY2tIZWlnaHQpO1xuaGFyZGVuKGlzU3RyZWFtQ2VsbCk7XG52YXIgcGF0aFNlZ21lbnRQYXR0ZXJuID0gL15bYS16QS1aMC05Xy1dezEsMTAwfSQvO1xudmFyIGFzc2VydFBhdGhTZWdtZW50ID0gKG5hbWUpID0+IHtcbiAgcGF0aFNlZ21lbnRQYXR0ZXJuLnRlc3QobmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBQYXRoIHNlZ21lbnQgbmFtZXMgbXVzdCBjb25zaXN0IG9mIDEgdG8gMTAwIGNoYXJhY3RlcnMgbGltaXRlZCB0byBBU0NJSSBhbHBoYW51bWVyaWNzLCB1bmRlcnNjb3JlcywgYW5kL29yIGRhc2hlczogJHtuYW1lfWA7XG59O1xuaGFyZGVuKGFzc2VydFBhdGhTZWdtZW50KTtcbnZhciBwcmVwYXJlQ2hhaW5TdG9yYWdlTm9kZSA9ICh6b25lKSA9PiB7XG4gIGNvbnN0IG1ha2VDaGFpblN0b3JhZ2VOb2RlID0gem9uZS5leG9DbGFzcyhcbiAgICBcIkNoYWluU3RvcmFnZU5vZGVcIixcbiAgICBDaGFpblN0b3JhZ2VOb2RlSSxcbiAgICAvKlxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIChtZXNzZW5nZXIsIHBhdGgsIHsgc2VxdWVuY2UgPSBmYWxzZSB9ID0ge30pID0+IHtcbiAgICAgIGFzc2VydC50eXBlb2YocGF0aCwgXCJzdHJpbmdcIik7XG4gICAgICBhc3NlcnQudHlwZW9mKHNlcXVlbmNlLCBcImJvb2xlYW5cIik7XG4gICAgICByZXR1cm4gaGFyZGVuKHsgcGF0aCwgbWVzc2VuZ2VyLCBzZXF1ZW5jZSB9KTtcbiAgICB9LFxuICAgIHtcbiAgICAgIGdldFBhdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnBhdGg7XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIGFzeW5jIGdldFN0b3JlS2V5KCkge1xuICAgICAgICBjb25zdCB7IHBhdGgsIG1lc3NlbmdlciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgcmV0dXJuIGNhbGxFKG1lc3Nlbmdlciwge1xuICAgICAgICAgIG1ldGhvZDogXCJnZXRTdG9yZUtleVwiLFxuICAgICAgICAgIGFyZ3M6IFtwYXRoXVxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIG1ha2VDaGlsZE5vZGUobmFtZSwgY2hpbGROb2RlT3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IHsgc2VxdWVuY2UsIHBhdGgsIG1lc3NlbmdlciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgYXNzZXJ0UGF0aFNlZ21lbnQobmFtZSk7XG4gICAgICAgIGNvbnN0IG1lcmdlZE9wdGlvbnMgPSB7IHNlcXVlbmNlLCAuLi5jaGlsZE5vZGVPcHRpb25zIH07XG4gICAgICAgIHJldHVybiBtYWtlQ2hhaW5TdG9yYWdlTm9kZShcbiAgICAgICAgICBtZXNzZW5nZXIsXG4gICAgICAgICAgYCR7cGF0aH0uJHtuYW1lfWAsXG4gICAgICAgICAgbWVyZ2VkT3B0aW9uc1xuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBhc3luYyBzZXRWYWx1ZSh2YWx1ZSkge1xuICAgICAgICBjb25zdCB7IHNlcXVlbmNlLCBwYXRoLCBtZXNzZW5nZXIgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGFzc2VydC50eXBlb2YodmFsdWUsIFwic3RyaW5nXCIpO1xuICAgICAgICBsZXQgZW50cnk7XG4gICAgICAgIGlmICghc2VxdWVuY2UgJiYgIXZhbHVlKSB7XG4gICAgICAgICAgZW50cnkgPSBbcGF0aF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZW50cnkgPSBbcGF0aCwgdmFsdWVdO1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0IGNhbGxFKG1lc3Nlbmdlciwge1xuICAgICAgICAgIG1ldGhvZDogc2VxdWVuY2UgPyBcImFwcGVuZFwiIDogXCJzZXRcIixcbiAgICAgICAgICBhcmdzOiBbZW50cnldXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLy9cbiAgICB9XG4gICk7XG4gIHJldHVybiBtYWtlQ2hhaW5TdG9yYWdlTm9kZTtcbn07XG52YXIgbWFrZUhlYXBDaGFpblN0b3JhZ2VOb2RlID0gcHJlcGFyZUNoYWluU3RvcmFnZU5vZGUobWFrZUhlYXBab25lKCkpO1xuZnVuY3Rpb24gbWFrZUNoYWluU3RvcmFnZVJvb3QoaGFuZGxlU3RvcmFnZU1lc3NhZ2UsIHJvb3RQYXRoLCByb290T3B0aW9ucyA9IHt9KSB7XG4gIGNvbnN0IG1lc3NlbmdlciA9IG1ha2VGdW5jdGlvbkNhbGxiYWNrKGhhbmRsZVN0b3JhZ2VNZXNzYWdlKTtcbiAgY29uc3Qgcm9vdE5vZGUgPSBtYWtlSGVhcENoYWluU3RvcmFnZU5vZGUobWVzc2VuZ2VyLCByb290UGF0aCwgcm9vdE9wdGlvbnMpO1xuICByZXR1cm4gcm9vdE5vZGU7XG59XG52YXIgbWFrZU51bGxTdG9yYWdlTm9kZSA9ICgpID0+IHtcbiAgcmV0dXJuIG1ha2VDaGFpblN0b3JhZ2VSb290KFxuICAgIEZhcihcIk51bGxNZXNzZW5nZXJcIiwgKCkgPT4gbnVsbCksXG4gICAgXCJudWxsXCJcbiAgKTtcbn07XG5hc3luYyBmdW5jdGlvbiBtYWtlU3RvcmFnZU5vZGVDaGlsZChzdG9yYWdlTm9kZVJlZiwgY2hpbGROYW1lKSB7XG4gIGNvbnN0IGV4aXN0aW5nU3RvcmFnZU5vZGUgPSBhd2FpdCBzdG9yYWdlTm9kZVJlZjtcbiAgY29uc3Qgc3RvcmFnZU5vZGUgPSBleGlzdGluZ1N0b3JhZ2VOb2RlIHx8IG1ha2VOdWxsU3RvcmFnZU5vZGUoKTtcbiAgcmV0dXJuIEUoc3RvcmFnZU5vZGUpLm1ha2VDaGlsZE5vZGUoY2hpbGROYW1lKTtcbn1cbmhhcmRlbihtYWtlU3RvcmFnZU5vZGVDaGlsZCk7XG52YXIgbWFrZVNlcmlhbGl6ZVRvU3RvcmFnZSA9IChzdG9yYWdlTm9kZSwgbWFyc2hhbGxlcikgPT4ge1xuICByZXR1cm4gYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgY29uc3QgbWFyc2hhbGxlZCA9IGF3YWl0IEUobWFyc2hhbGxlcikudG9DYXBEYXRhKHZhbHVlKTtcbiAgICBjb25zdCBzZXJpYWxpemVkID0gSlNPTi5zdHJpbmdpZnkobWFyc2hhbGxlZCk7XG4gICAgcmV0dXJuIEUoc3RvcmFnZU5vZGUpLnNldFZhbHVlKHNlcmlhbGl6ZWQpO1xuICB9O1xufTtcblxuLy9cbnZhciBDYXBEYXRhU2hhcGUgPSB7IGJvZHk6IE0uc3RyaW5nKCksIHNsb3RzOiBNLmFycmF5KCkgfTtcbmhhcmRlbihDYXBEYXRhU2hhcGUpO1xudmFyIGFzc2VydENhcERhdGEgPSAoZGF0YSkgPT4ge1xuICBhc3NlcnQudHlwZW9mKGRhdGEsIFwib2JqZWN0XCIpO1xuICBhc3NlcnQoZGF0YSk7XG4gIHR5cGVvZiBkYXRhLmJvZHkgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBkYXRhIGhhcyBub24tc3RyaW5nIC5ib2R5ICR7ZGF0YS5ib2R5fWA7XG4gIEFycmF5LmlzQXJyYXkoZGF0YS5zbG90cykgfHwgdGhyb3dSZWRhY3RlZGBkYXRhIGhhcyBub24tQXJyYXkgc2xvdHMgJHtkYXRhLnNsb3RzfWA7XG59O1xuaGFyZGVuKGFzc2VydENhcERhdGEpO1xudmFyIHVubWFyc2hhbEZyb21Wc3RvcmFnZSA9IChkYXRhLCBrZXksIGZyb21DYXBEYXRhLCBpbmRleCkgPT4ge1xuICBjb25zdCBzZXJpYWxpemVkID0gZGF0YS5nZXQoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYG5vIGRhdGEgZm9yICR7a2V5fWA7XG4gIGFzc2VydC50eXBlb2Yoc2VyaWFsaXplZCwgXCJzdHJpbmdcIik7XG4gIGFzc2VydC50eXBlb2YoaW5kZXgsIFwibnVtYmVyXCIpO1xuICBjb25zdCBzdHJlYW1DZWxsID0gSlNPTi5wYXJzZShzZXJpYWxpemVkKTtcbiAgaWYgKCFpc1N0cmVhbUNlbGwoc3RyZWFtQ2VsbCkpIHtcbiAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYG5vdCBhIFN0cmVhbUNlbGw6ICR7c3RyZWFtQ2VsbH1gO1xuICB9XG4gIGNvbnN0IHsgdmFsdWVzOiB2YWx1ZXM4IH0gPSBzdHJlYW1DZWxsO1xuICB2YWx1ZXM4Lmxlbmd0aCA+IDAgfHwgdGhyb3dSZWRhY3RlZGBubyBTdHJlYW1DZWxsIHZhbHVlczogJHtzdHJlYW1DZWxsfWA7XG4gIGNvbnN0IG1hcnNoYWxsZWQgPSB2YWx1ZXM4LmF0KGluZGV4KTtcbiAgYXNzZXJ0LnR5cGVvZihtYXJzaGFsbGVkLCBcInN0cmluZ1wiKTtcbiAgY29uc3QgY2FwRGF0YSA9IGhhcmRlbihKU09OLnBhcnNlKG1hcnNoYWxsZWQpKTtcbiAgYXNzZXJ0Q2FwRGF0YShjYXBEYXRhKTtcbiAgY29uc3QgdW5tYXJzaGFsbGVkID0gZnJvbUNhcERhdGEoY2FwRGF0YSk7XG4gIHJldHVybiB1bm1hcnNoYWxsZWQ7XG59O1xuaGFyZGVuKHVubWFyc2hhbEZyb21Wc3RvcmFnZSk7XG52YXIgcmVqZWN0T0NhcCA9IChjYXApID0+IHRocm93UmVkYWN0ZWRgJHtjYXB9IGlzIG5vdCBwdXJlIGRhdGFgO1xudmFyIHB1cmVEYXRhTWFyc2hhbGxlciA9IG1ha2VNYXJzaGFsKHJlamVjdE9DYXAsIHJlamVjdE9DYXAsIHtcbiAgc2VyaWFsaXplQm9keUZvcm1hdDogXCJzbWFsbGNhcHNcIlxufSk7XG5oYXJkZW4ocHVyZURhdGFNYXJzaGFsbGVyKTtcblxuLy9cbnZhciB7IGNyZWF0ZTogY3JlYXRlNiwgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMTIgfSA9IE9iamVjdDtcbnZhciB7IGFwcGx5OiBhcHBseTggfSA9IFJlZmxlY3Q7XG52YXIgZ2V0TWV0aG9kTmFtZXMyID0gKHZhbCkgPT4gKFxuICAvKiAgICAgICAgICAgICAgKi9cbiAgZ2V0TWV0aG9kTmFtZXModmFsKVxuKTtcbmhhcmRlbihnZXRNZXRob2ROYW1lczIpO1xudmFyIGJpbmRBbGxNZXRob2RzID0gKG9iaikgPT4gaGFyZGVuKFxuICBjcmVhdGU2KFxuICAgIG9iaixcbiAgICBmcm9tRW50cmllczEyKFxuICAgICAgZ2V0TWV0aG9kTmFtZXMob2JqKS5tYXAoKG5hbWUpID0+IFtcbiAgICAgICAgbmFtZSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiAoLi4uYXJncykgPT4gYXBwbHk4KG9ialtuYW1lXSwgb2JqLCBhcmdzKSxcbiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgICAgIH1cbiAgICAgIF0pXG4gICAgKVxuICApXG4pO1xuaGFyZGVuKGJpbmRBbGxNZXRob2RzKTtcblxuLy9cbnZhciBISVNUT0dSQU1fTVNfTEFURU5DWV9CT1VOREFSSUVTID0gW1xuICA1LFxuICAxMCxcbiAgMjUsXG4gIDUwLFxuICAxMDAsXG4gIDI1MCxcbiAgNTAwLFxuICAxZTMsXG4gIDI1MDAsXG4gIDVlMyxcbiAgMWU0LFxuICBJbmZpbml0eVxuXTtcbnZhciBISVNUT0dSQU1fU0VDT05EU19MQVRFTkNZX0JPVU5EQVJJRVMgPSBISVNUT0dSQU1fTVNfTEFURU5DWV9CT1VOREFSSUVTLm1hcCgobXMpID0+IG1zIC8gMWUzKTtcbnZhciBISVNUT0dSQU1fTUVUUklDUyA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIHN3aW5nc2V0X2NyYW5rX3Byb2Nlc3NpbmdfdGltZToge1xuICAgICAgZGVzY3JpcHRpb246IFwiUHJvY2Vzc2luZyB0aW1lIHBlciBjcmFuayAobXMpXCIsXG4gICAgICB1bml0OiBcIm1zXCIsXG4gICAgICBib3VuZGFyaWVzOiBBcnJheS5vZigxLCAxMSwgMjEsIDMxLCA0MSwgNTEsIDYxLCA3MSwgODEsIDkxLCBJbmZpbml0eSlcbiAgICB9LFxuICAgIHN3aW5nc2V0X2Jsb2NrX3Byb2Nlc3Npbmdfc2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUHJvY2Vzc2luZyB0aW1lIHBlciBibG9ja1wiLFxuICAgICAgdW5pdDogXCJzXCIsXG4gICAgICBib3VuZGFyaWVzOiBISVNUT0dSQU1fU0VDT05EU19MQVRFTkNZX0JPVU5EQVJJRVNcbiAgICB9LFxuICAgIHN3aW5nc2V0X3ZhdF9zdGFydHVwOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJWYXQgc3RhcnR1cCB0aW1lIChtcylcIixcbiAgICAgIHVuaXQ6IFwibXNcIixcbiAgICAgIGJvdW5kYXJpZXM6IEhJU1RPR1JBTV9NU19MQVRFTkNZX0JPVU5EQVJJRVNcbiAgICB9LFxuICAgIHN3aW5nc2V0X3ZhdF9kZWxpdmVyeToge1xuICAgICAgZGVzY3JpcHRpb246IFwiVmF0IGRlbGl2ZXJ5IHRpbWUgKG1zKVwiLFxuICAgICAgdW5pdDogXCJtc1wiLFxuICAgICAgYm91bmRhcmllczogSElTVE9HUkFNX01TX0xBVEVOQ1lfQk9VTkRBUklFU1xuICAgIH0sXG4gICAgc3dpbmdzZXRfbWV0ZXJfdXNhZ2U6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlZhdCBtZXRlciB1c2FnZVwiLFxuICAgICAgdW5pdDogXCJtc1wiLFxuICAgICAgYm91bmRhcmllczogSElTVE9HUkFNX01TX0xBVEVOQ1lfQk9VTkRBUklFU1xuICAgIH1cbiAgfVxuKTtcbnZhciBibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MgPSB7XG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIHVuaXQ6IFwic1wiLFxuICBhZHZpY2U6IHtcbiAgICBleHBsaWNpdEJ1Y2tldEJvdW5kYXJpZXM6IFtcbiAgICAgIDAuMSxcbiAgICAgIDAuMixcbiAgICAgIDAuMyxcbiAgICAgIDAuNCxcbiAgICAgIDAuNSxcbiAgICAgIDEsXG4gICAgICAyLFxuICAgICAgMyxcbiAgICAgIDQsXG4gICAgICA1LFxuICAgICAgNixcbiAgICAgIDcsXG4gICAgICAxMCxcbiAgICAgIDE1LFxuICAgICAgMzBcbiAgICBdXG4gIH1cbn07XG52YXIgQkxPQ0tfSElTVE9HUkFNX01FVFJJQ1MgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBzd2luZ3NldFJ1blNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IGV4ZWN1dGluZyBTd2luZ1NldFwiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjXG4gICAgfSxcbiAgICBzd2luZ3NldENoYWluU2F2ZVNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IHByb3BhZ2F0aW5nIFN3aW5nU2V0IHN0YXRlIGludG8gY29zbW9zXCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2NcbiAgICB9LFxuICAgIHN3aW5nc2V0Q29tbWl0U2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgY29tbWl0dGluZyBTd2luZ1NldCBzdGF0ZSB0byBob3N0IHN0b3JhZ2VcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzY1xuICAgIH0sXG4gICAgY29zbW9zQ29tbWl0U2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgY29tbWl0dGluZyBjb3Ntb3Mgc3RhdGVcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzY1xuICAgIH0sXG4gICAgZnVsbENvbW1pdFNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IGNvbW1pdHRpbmcgc3RhdGUsIGluY2x1c2l2ZSBvZiBDT01NSVRfQkxPQ0sgcHJvY2Vzc2luZyBwbHVzIHRpbWUgc3BlbnQgW291dHNpZGUgb2YgY29zbWljLXN3aW5nc2V0XSBiZWZvcmUgYW5kIGFmdGVyIGl0XCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2NcbiAgICB9LFxuICAgIGludGVyQmxvY2tTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJUaW1lIHNwZW50IGlkbGUgYmV0d2VlbiBibG9ja3NcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzY1xuICAgIH0sXG4gICAgYWZ0ZXJDb21taXRIYW5nb3ZlclNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IHdhaXRpbmcgZm9yIHByZXZpb3VzLWJsb2NrIGFmdGVyQ29tbWl0IHdvcmtcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzY1xuICAgIH0sXG4gICAgYmxvY2tMYWdTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJUaGUgZGVsYXkgb2YgZWFjaCBibG9jayBmcm9tIGl0cyBleHBlY3RlZCBiZWdpbiB0aW1lXCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MsXG4gICAgICAvL1xuICAgICAgYWR2aWNlOiB7XG4gICAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzYy5hZHZpY2UsXG4gICAgICAgIGV4cGxpY2l0QnVja2V0Qm91bmRhcmllczogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgW1xuICAgICAgICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjLmFkdmljZS5leHBsaWNpdEJ1Y2tldEJvdW5kYXJpZXMsXG4gICAgICAgICAgICAuLi5bNjAsIDEyMCwgMTgwLCAyNDAsIDMwMCwgNjAwLCAzNjAwXVxuICAgICAgICAgIF1cbiAgICAgICAgKVxuICAgICAgfVxuICAgIH1cbiAgfVxuKTtcbnZhciBNZXRyaWNUeXBlID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgQ291bnRlcjogXCJjb3VudGVyXCIsXG4gICAgR2F1Z2U6IFwiZ2F1Z2VcIlxuICB9XG4pO1xudmFyIEtFUk5FTF9TVEFUU19TVU1fTUVUUklDUyA9IFtcbiAge1xuICAgIGtleTogXCJzeXNjYWxsc1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfYWxsX3N5c2NhbGxfdG90YWxcIixcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsU2VuZFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJzZW5kXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgbWVzc2FnZSBzZW5kIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbENhbGxOb3dcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwiY2FsbE5vd1wiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHN5bmNocm9ub3VzIGRldmljZSBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxTdWJzY3JpYmVcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwic3Vic2NyaWJlXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgcHJvbWlzZSBzdWJzY3JpcHRpb24ga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsUmVzb2x2ZVwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJyZXNvbHZlXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgcHJvbWlzZSByZXNvbHV0aW9uIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbEV4aXRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwiZXhpdFwiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHZhdCBleGl0IGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFZhdHN0b3JlR2V0XCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInZhdHN0b3JlR2V0XCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0c3RvcmUgZ2V0IGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFZhdHN0b3JlU2V0XCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInZhdHN0b3JlU2V0XCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0c3RvcmUgc2V0IGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFZhdHN0b3JlR2V0TmV4dEtleVwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJ2YXRzdG9yZUdldE5leHRcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXRzdG9yZSBnZXROZXh0S2V5IGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFZhdHN0b3JlRGVsZXRlXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInZhdHN0b3JlRGVsZXRlXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0c3RvcmUgZGVsZXRlIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbERyb3BJbXBvcnRzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcImRyb3BJbXBvcnRzXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgZHJvcCBpbXBvcnRzIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwiZGlzcGF0Y2hlc1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfZGlzcGF0Y2hfdG90YWxcIixcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0IGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJkaXNwYXRjaERlbGl2ZXJcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2Rpc3BhdGNoX2RlbGl2ZXJfdG90YWxcIixcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0IG1lc3NhZ2UgZGVsaXZlcmllc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwiZGlzcGF0Y2hOb3RpZnlcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2Rpc3BhdGNoX25vdGlmeV90b3RhbFwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXQgcHJvbWlzZSBub3RpZmljYXRpb25zXCJcbiAgfVxuXTtcbnZhciBLRVJORUxfU1RBVFNfVVBET1dOX01FVFJJQ1MgPSBbXG4gIHtcbiAgICBrZXk6IFwia2VybmVsT2JqZWN0c1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfa2VybmVsX29iamVjdHNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJBY3RpdmUga2VybmVsIG9iamVjdHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImtlcm5lbERldmljZXNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2tlcm5lbF9kZXZpY2VzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiQWN0aXZlIGtlcm5lbCBkZXZpY2VzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJrZXJuZWxQcm9taXNlc1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfa2VybmVsX3Byb21pc2VzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiQWN0aXZlIGtlcm5lbCBwcm9taXNlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwia3BVbnJlc29sdmVkXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF91bnJlc29sdmVkX2tlcm5lbF9wcm9taXNlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlVucmVzb2x2ZWQga2VybmVsIHByb21pc2VzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJrcEZ1bGZpbGxlZFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfZnVsZmlsbGVkX2tlcm5lbF9wcm9taXNlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIkZ1bGZpbGxlZCBrZXJuZWwgcHJvbWlzZXNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImtwUmVqZWN0ZWRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3JlamVjdGVkX2tlcm5lbF9wcm9taXNlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlJlamVjdGVkIGtlcm5lbCBwcm9taXNlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwicnVuUXVldWVMZW5ndGhcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3J1bl9xdWV1ZV9sZW5ndGhcIixcbiAgICBjb25zZW5zdXM6IHRydWUsXG4gICAgZGVzY3JpcHRpb246IFwiTGVuZ3RoIG9mIHRoZSBrZXJuZWwgcnVuIHF1ZXVlXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJhY2NlcHRhbmNlUXVldWVMZW5ndGhcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2FjY2VwdGFuY2VfcXVldWVfbGVuZ3RoXCIsXG4gICAgY29uc2Vuc3VzOiB0cnVlLFxuICAgIGRlc2NyaXB0aW9uOiBcIkxlbmd0aCBvZiB0aGUga2VybmVsIGFjY2VwdGFuY2UgcXVldWVcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInByb21pc2VRdWV1ZXNMZW5ndGhcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3Byb21pc2VfcXVldWVzX2xlbmd0aFwiLFxuICAgIGNvbnNlbnN1czogdHJ1ZSxcbiAgICBkZXNjcmlwdGlvbjogXCJDb21iaW5lZCBsZW5ndGggb2YgYWxsIGtlcm5lbCBwcm9taXNlIHF1ZXVlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwiY2xpc3RFbnRyaWVzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9jbGlzdF9lbnRyaWVzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiTnVtYmVyIG9mIGVudHJpZXMgaW4gdGhlIGtlcm5lbCBjLWxpc3RcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInZhdHNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3ZhdHNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJOdW1iZXIgb2YgYWN0aXZlIHZhdHNcIlxuICB9XG5dO1xudmFyIHsgQ291bnRlciwgR2F1Z2UgfSA9IE1ldHJpY1R5cGU7XG52YXIgS0VSTkVMX1NUQVRTX01FVFJJQ1MgPSBoYXJkZW4oW1xuICAuLi5LRVJORUxfU1RBVFNfU1VNX01FVFJJQ1MubWFwKChtMikgPT4gKHsgLi4ubTIsIG1ldHJpY1R5cGU6IENvdW50ZXIgfSkpLFxuICAuLi5LRVJORUxfU1RBVFNfVVBET1dOX01FVFJJQ1MubWFwKChtMikgPT4gKHsgLi4ubTIsIG1ldHJpY1R5cGU6IEdhdWdlIH0pKVxuXSk7XG52YXIga2VybmVsU3RhdHNLZXlzID0gLyogICAgICAgICAgICovIG5ldyBNYXAoKTtcbmZvciAoY29uc3QgeyBrZXkgfSBvZiBLRVJORUxfU1RBVFNfTUVUUklDUykge1xuICBrZXJuZWxTdGF0c0tleXMuc2V0KGtleSwgKGtlcm5lbFN0YXRzS2V5cy5nZXQoa2V5KSB8fCAwKSArIDEpO1xufVxudmFyIGR1cGxpY2F0ZUtlcm5lbFN0YXRzS2V5cyA9IFsuLi5rZXJuZWxTdGF0c0tleXMuZW50cmllcygpXS5mbGF0TWFwKFxuICAoW2tleSwgdmFsdWVdKSA9PiB2YWx1ZSA+IDEgPyBba2V5XSA6IFtdXG4pO1xuaWYgKGR1cGxpY2F0ZUtlcm5lbFN0YXRzS2V5cy5sZW5ndGggPiAwKSB7XG4gIGNvbnN0IG1zZyA9IGBEdXBsaWNhdGUga2VybmVsIHN0YXRzIGtleXMgJHtKU09OLnN0cmluZ2lmeShkdXBsaWNhdGVLZXJuZWxTdGF0c0tleXMpfWA7XG4gIHRocm93IEVycm9yKG1zZyk7XG59XG5cbi8vXG52YXIgY29tcGFyZU5hdHMgPSAoYTIsIGIzKSA9PiB7XG4gIGNvbnN0IGRpZmYgPSArYTIgLSArYjM7XG4gIGNvbnN0IGZpbml0ZURpZmYgPSBOdW1iZXIuaXNGaW5pdGUoZGlmZikgJiYgZGlmZiB8fCAoYTIgPT09IGIzID8gMCA6IE51bWJlcihCaWdJbnQoYTIpIC0gQmlnSW50KGIzKSkgfHwgYTIubGVuZ3RoIC0gYjMubGVuZ3RoKTtcbiAgcmV0dXJuIE1hdGguc2lnbihmaW5pdGVEaWZmKTtcbn07XG52YXIgY29tcGFyZVN0cmluZ3MgPSAoYTIsIGIzKSA9PiBhMiA+IGIzID8gMSA6IGEyIDwgYjMgPyAtMSA6IDA7XG52YXIgclByZWZpeGVkRGlnaXRzID0gL14oXFxEKikoXFxkKykoXFxELip8KS9zO1xudmFyIG5hdHVyYWxDb21wYXJlID0gKGEyLCBiMykgPT4ge1xuICBjb25zdCBbX2EsIGFQcmVmaXgsIGFEaWdpdHMsIGFTdWZmaXhdID0gclByZWZpeGVkRGlnaXRzLmV4ZWMoYTIpIHx8IFtdO1xuICBpZiAoYVByZWZpeCAhPT0gdm9pZCAwKSB7XG4gICAgY29uc3QgW19iLCBiUHJlZml4LCBiRGlnaXRzLCBiU3VmZml4XSA9IHJQcmVmaXhlZERpZ2l0cy5leGVjKGIzKSB8fCBbXTtcbiAgICBpZiAoYlByZWZpeCA9PT0gYVByZWZpeCkge1xuICAgICAgcmV0dXJuIGNvbXBhcmVOYXRzKGFEaWdpdHMsIGJEaWdpdHMpIHx8IGNvbXBhcmVTdHJpbmdzKGFTdWZmaXgsIGJTdWZmaXgpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gY29tcGFyZVN0cmluZ3MoYTIsIGIzKTtcbn07XG5oYXJkZW4obmF0dXJhbENvbXBhcmUpO1xuXG4vL1xudmFyIHsgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczgsIGNyZWF0ZTogY3JlYXRlNywgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMTMgfSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IG93bktleXMyMiB9ID0gUmVmbGVjdDtcbnZhciBvYmplY3RNZXRhTWFwID0gKG9yaWdpbmFsLCBtZXRhTWFwRm4sIHByb3RvID0gT2JqZWN0LnByb3RvdHlwZSkgPT4ge1xuICBjb25zdCBkZXNjcyA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM4KG9yaWdpbmFsKTtcbiAgY29uc3Qga2V5czUgPSBvd25LZXlzMjIob3JpZ2luYWwpO1xuICBjb25zdCBkZXNjRW50cmllcyA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAga2V5czUubWFwKChrZXkpID0+IFtrZXksIG1ldGFNYXBGbihkZXNjc1trZXldLCBrZXkpXSkuZmlsdGVyKChbX2tleSwgb3B0RGVzY10pID0+IG9wdERlc2MgIT09IHZvaWQgMClcbiAgKTtcbiAgcmV0dXJuIGhhcmRlbihjcmVhdGU3KHByb3RvLCBmcm9tRW50cmllczEzKGRlc2NFbnRyaWVzKSkpO1xufTtcbmhhcmRlbihvYmplY3RNZXRhTWFwKTtcblxuLy9cbnZhciBmcmVlemUxMCA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICBPYmplY3QuZnJlZXplXG4pO1xudmFyIG1ha2VRdWV1ZSA9ICgpID0+IHtcbiAgbGV0IHsgcHJvbWlzZTogdGFpbFByb21pc2UsIHJlc29sdmU6IHRhaWxSZXNvbHZlIH0gPSBtYWtlUHJvbWlzZUtpdCgpO1xuICByZXR1cm4ge1xuICAgIHB1dCh2YWx1ZSkge1xuICAgICAgY29uc3QgeyByZXNvbHZlOiByZXNvbHZlMiwgcHJvbWlzZSB9ID0gbWFrZVByb21pc2VLaXQoKTtcbiAgICAgIHRhaWxSZXNvbHZlKGZyZWV6ZTEwKHsgdmFsdWUsIHByb21pc2UgfSkpO1xuICAgICAgdGFpbFJlc29sdmUgPSByZXNvbHZlMjtcbiAgICB9LFxuICAgIGdldCgpIHtcbiAgICAgIGNvbnN0IHByb21pc2UgPSB0YWlsUHJvbWlzZS50aGVuKChuZXh0KSA9PiBuZXh0LnZhbHVlKTtcbiAgICAgIHRhaWxQcm9taXNlID0gdGFpbFByb21pc2UudGhlbigobmV4dCkgPT4gbmV4dC5wcm9taXNlKTtcbiAgICAgIHJldHVybiBoYXJkZW4ocHJvbWlzZSk7XG4gICAgfVxuICB9O1xufTtcbmhhcmRlbihtYWtlUXVldWUpO1xudmFyIG1ha2VTdHJlYW0gPSAoYWNrcywgZGF0YSkgPT4ge1xuICBjb25zdCBzdHJlYW0gPSBoYXJkZW4oe1xuICAgIC8qXG5cbiAgICAgKi9cbiAgICBuZXh0KHZhbHVlKSB7XG4gICAgICBkYXRhLnB1dChmcmVlemUxMCh7IHZhbHVlLCBkb25lOiBmYWxzZSB9KSk7XG4gICAgICByZXR1cm4gYWNrcy5nZXQoKTtcbiAgICB9LFxuICAgIC8qXG5cbiAgICAgKi9cbiAgICByZXR1cm4odmFsdWUpIHtcbiAgICAgIGRhdGEucHV0KGZyZWV6ZTEwKHsgdmFsdWUsIGRvbmU6IHRydWUgfSkpO1xuICAgICAgcmV0dXJuIGFja3MuZ2V0KCk7XG4gICAgfSxcbiAgICAvKlxuXG4gICAgICovXG4gICAgdGhyb3coZXJyb3IpIHtcbiAgICAgIGRhdGEucHV0KGhhcmRlbihQcm9taXNlLnJlamVjdChlcnJvcikpKTtcbiAgICAgIHJldHVybiBhY2tzLmdldCgpO1xuICAgIH0sXG4gICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpIHtcbiAgICAgIHJldHVybiBzdHJlYW07XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHN0cmVhbTtcbn07XG5oYXJkZW4obWFrZVN0cmVhbSk7XG52YXIgbWFrZVBpcGUgPSAoKSA9PiB7XG4gIGNvbnN0IGRhdGEgPSBtYWtlUXVldWUoKTtcbiAgY29uc3QgYWNrcyA9IG1ha2VRdWV1ZSgpO1xuICBjb25zdCByZWFkZXIgPSBtYWtlU3RyZWFtKGFja3MsIGRhdGEpO1xuICBjb25zdCB3cml0ZXIgPSBtYWtlU3RyZWFtKGRhdGEsIGFja3MpO1xuICByZXR1cm4gaGFyZGVuKFt3cml0ZXIsIHJlYWRlcl0pO1xufTtcbmhhcmRlbihtYWtlUGlwZSk7XG52YXIgcHVtcCA9IGFzeW5jICh3cml0ZXIsIHJlYWRlciwgcHJpbWVyKSA9PiB7XG4gIGNvbnN0IHRpY2sgPSAocHJvbWlzZSkgPT4gRS53aGVuKFxuICAgIHByb21pc2UsXG4gICAgKHJlc3VsdCkgPT4ge1xuICAgICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICAgIHJldHVybiB3cml0ZXIucmV0dXJuKHJlc3VsdC52YWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdG9jayh3cml0ZXIubmV4dChyZXN1bHQudmFsdWUpKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIChlcnJvcikgPT4ge1xuICAgICAgcmV0dXJuIHdyaXRlci50aHJvdyhlcnJvcik7XG4gICAgfVxuICApO1xuICBjb25zdCB0b2NrID0gKHByb21pc2UpID0+IEUud2hlbihcbiAgICBwcm9taXNlLFxuICAgIChyZXN1bHQpID0+IHtcbiAgICAgIGlmIChyZXN1bHQuZG9uZSkge1xuICAgICAgICByZXR1cm4gcmVhZGVyLnJldHVybihyZXN1bHQudmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRpY2socmVhZGVyLm5leHQocmVzdWx0LnZhbHVlKSk7XG4gICAgICB9XG4gICAgfSxcbiAgICAoZXJyb3IpID0+IHtcbiAgICAgIHJldHVybiByZWFkZXIudGhyb3coZXJyb3IpO1xuICAgIH1cbiAgKTtcbiAgYXdhaXQgdGljayhyZWFkZXIubmV4dChwcmltZXIpKTtcbiAgcmV0dXJuIHZvaWQgMDtcbn07XG5oYXJkZW4ocHVtcCk7XG52YXIgcHJpbWUgPSAoZ2VuZXJhdG9yLCBwcmltZXIpID0+IHtcbiAgY29uc3QgZmlyc3QgPSBnZW5lcmF0b3IubmV4dChwcmltZXIpO1xuICBsZXQgcmVzdWx0O1xuICBjb25zdCBwcmltZWQgPSBoYXJkZW4oe1xuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBhc3luYyBuZXh0KHZhbHVlKSB7XG4gICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHtcbiAgICAgICAgcmVzdWx0ID0gYXdhaXQgZmlyc3Q7XG4gICAgICAgIGlmIChyZXN1bHQuZG9uZSkge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBnZW5lcmF0b3IubmV4dCh2YWx1ZSk7XG4gICAgfSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGFzeW5jIHJldHVybih2YWx1ZSkge1xuICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJlc3VsdCA9IGF3YWl0IGZpcnN0O1xuICAgICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZ2VuZXJhdG9yLnJldHVybih2YWx1ZSk7XG4gICAgfSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBhc3luYyB0aHJvdyhlcnJvcikge1xuICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJlc3VsdCA9IGF3YWl0IGZpcnN0O1xuICAgICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGdlbmVyYXRvci50aHJvdyhlcnJvcik7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHByaW1lZDtcbn07XG5oYXJkZW4ocHJpbWUpO1xudmFyIG1hcFJlYWRlciA9IChyZWFkZXIsIHRyYW5zZm9ybSkgPT4ge1xuICBhc3luYyBmdW5jdGlvbiogdHJhbnNmb3JtR2VuZXJhdG9yKCkge1xuICAgIGZvciBhd2FpdCAoY29uc3QgdmFsdWUgb2YgcmVhZGVyKSB7XG4gICAgICB5aWVsZCB0cmFuc2Zvcm0odmFsdWUpO1xuICAgIH1cbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG4gIGhhcmRlbih0cmFuc2Zvcm1HZW5lcmF0b3IpO1xuICByZXR1cm4gaGFyZGVuKHRyYW5zZm9ybUdlbmVyYXRvcigpKTtcbn07XG5oYXJkZW4obWFwUmVhZGVyKTtcbnZhciBtYXBXcml0ZXIgPSAod3JpdGVyLCB0cmFuc2Zvcm0pID0+IHtcbiAgY29uc3QgdHJhbnNmb3JtZWRXcml0ZXIgPSBoYXJkZW4oe1xuICAgIC8qXG5cbiAgICAgKi9cbiAgICBhc3luYyBuZXh0KHZhbHVlKSB7XG4gICAgICByZXR1cm4gd3JpdGVyLm5leHQodHJhbnNmb3JtKHZhbHVlKSk7XG4gICAgfSxcbiAgICAvKlxuXG4gICAgICovXG4gICAgYXN5bmMgdGhyb3coZXJyb3IpIHtcbiAgICAgIHJldHVybiB3cml0ZXIudGhyb3coZXJyb3IpO1xuICAgIH0sXG4gICAgLypcblxuICAgICAqL1xuICAgIGFzeW5jIHJldHVybih2YWx1ZSkge1xuICAgICAgcmV0dXJuIHdyaXRlci5yZXR1cm4odmFsdWUpO1xuICAgIH0sXG4gICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpIHtcbiAgICAgIHJldHVybiB0cmFuc2Zvcm1lZFdyaXRlcjtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gdHJhbnNmb3JtZWRXcml0ZXI7XG59O1xuaGFyZGVuKG1hcFdyaXRlcik7XG5cbi8vXG52YXIgbWFrZVByb21pc2UgPSAoZXhlY3V0b3IpID0+IGhhcmRlbihuZXcgUHJvbWlzZShleGVjdXRvcikpO1xuaGFyZGVuKG1ha2VQcm9taXNlKTtcbnZhciBtYWtlTWFwID0gKGVudHJpZXNPckl0ZXJhYmxlKSA9PiBoYXJkZW4obmV3IE1hcChlbnRyaWVzT3JJdGVyYWJsZSkpO1xuaGFyZGVuKG1ha2VNYXApO1xudmFyIG1ha2VTZXQgPSAodmFsdWVzOCkgPT4gaGFyZGVuKG5ldyBTZXQodmFsdWVzOCkpO1xuaGFyZGVuKG1ha2VTZXQpO1xudmFyIG1ha2VXZWFrTWFwID0gKGVudHJpZXMxMSkgPT4gaGFyZGVuKG5ldyBXZWFrTWFwKGVudHJpZXMxMSkpO1xuaGFyZGVuKG1ha2VXZWFrTWFwKTtcbnZhciBtYWtlV2Vha1NldCA9ICh2YWx1ZXM4KSA9PiBoYXJkZW4obmV3IFdlYWtTZXQodmFsdWVzOCkpO1xuaGFyZGVuKG1ha2VXZWFrU2V0KTtcblxuLy9cbnZhciBhc3luY0dlbmVyYXRlID0gKG5leHQpID0+IHtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgIG5leHQ6IGFzeW5jICgpID0+IGhhcmRlbihuZXh0KCkpXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihhc3luY0dlbmVyYXRlKTtcblxuLy9cbnZhciBhc3luY0RvV2hpbGUgPSAoYm9keSkgPT4ge1xuICByZXR1cm4gbWFrZVByb21pc2UoKHJlc29sdmUyLCByZWplY3QpID0+IHtcbiAgICBjb25zdCBsb29wID0gYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZG9Db250aW51ZSA9IGF3YWl0IGJvZHkoKTtcbiAgICAgIGlmICghZG9Db250aW51ZSkge1xuICAgICAgICByZXNvbHZlMih2b2lkIDApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsb29wKCkuY2F0Y2gocmVqZWN0KTtcbiAgICB9O1xuICAgIGxvb3AoKS5jYXRjaChyZWplY3QpO1xuICB9KTtcbn07XG5oYXJkZW4oYXN5bmNEb1doaWxlKTtcblxuLy9cbnZhciB7IGZyb21FbnRyaWVzOiBmcm9tRW50cmllczE0LCBrZXlzLCB2YWx1ZXM6IHZhbHVlczQgfSA9IE9iamVjdDtcbnZhciBtYWtlTGltaXRlZENvbnNvbGUgPSAobWFrZUxvZ2dlcikgPT4ge1xuICBjb25zdCBsaW1pdGVkQ29uc29sZSA9IChcbiAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICBmcm9tRW50cmllczE0KGxvZ0xldmVsczIubWFwKChsZXZlbCkgPT4gW2xldmVsLCBtYWtlTG9nZ2VyKGxldmVsKV0pKVxuICApO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgaGFyZGVuKGxpbWl0ZWRDb25zb2xlKVxuICApO1xufTtcbmhhcmRlbihtYWtlTGltaXRlZENvbnNvbGUpO1xudmFyIGFzc2VydEFsbERlZmluZWQgPSAob2JqKSA9PiB7XG4gIGNvbnN0IG1pc3NpbmcyID0gW107XG4gIGZvciAoY29uc3QgW2tleSwgdmFsXSBvZiBPYmplY3QuZW50cmllcyhvYmopKSB7XG4gICAgaWYgKHZhbCA9PT0gdm9pZCAwKSB7XG4gICAgICBtaXNzaW5nMi5wdXNoKGtleSk7XG4gICAgfVxuICB9XG4gIGlmIChtaXNzaW5nMi5sZW5ndGggPiAwKSB7XG4gICAgdGhyb3dSZWRhY3RlZGBtaXNzaW5nICR7cXVvdGUobWlzc2luZzIpfWA7XG4gIH1cbn07XG52YXIgbm90RG9uZSA9IGhhcmRlbih7IGRvbmU6IGZhbHNlLCB2YWx1ZTogdm9pZCAwIH0pO1xudmFyIGFsd2F5c0RvbmUgPSBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZTogdm9pZCAwIH0pO1xudmFyIGZvcmV2ZXIgPSBhc3luY0dlbmVyYXRlKCgpID0+IG5vdERvbmUpO1xudmFyIHppcCA9ICh4cywgeXMpID0+IGhhcmRlbih4cy5tYXAoKHgsIGkyKSA9PiBbeCwgeXNbK2kyXV0pKTtcbnZhciBhbGxWYWx1ZXMgPSBhc3luYyAob2JqKSA9PiB7XG4gIGNvbnN0IHJlc29sdmVkID0gYXdhaXQgUHJvbWlzZS5hbGwodmFsdWVzNChvYmopKTtcbiAgcmV0dXJuIGhhcmRlbihmcm9tRW50cmllczE0KHppcChrZXlzKG9iaiksIHJlc29sdmVkKSkpO1xufTtcblxuLy9cbnZhciBTdG9yYWdlTm9kZVNoYXBlID0gTS5yZW1vdGFibGUoXCJTdG9yYWdlTm9kZVwiKTtcbnZhciBVbmd1YXJkZWRIZWxwZXJJID0gTS5pbnRlcmZhY2UoXG4gIFwiaGVscGVyXCIsXG4gIHt9LFxuICAvL1xuICB7IHNsb3BweTogdHJ1ZSB9XG4pO1xudmFyIEJyaWRnZUJpZ0ludFNoYXBlID0gTS5vcihNLm51bWJlcigpLCBNLnN0cmluZygpKTtcblxuLy9cbnZhciBtYWtlV2Vha1NldFN0b3JlTWV0aG9kczMgPSAoanNzZXQsIGFzc2VydEtleU9rVG9BZGQsIGFzc2VydEtleU9rVG9EZWxldGUgPSB2b2lkIDAsIGtleU5hbWUgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IGFzc2VydEtleUV4aXN0cyA9IChrZXkpID0+IGpzc2V0LmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShrZXlOYW1lKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiBqc3NldC5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGFkZDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5T2tUb0FkZChrZXkpO1xuICAgICAganNzZXQuYWRkKGtleSk7XG4gICAgfSxcbiAgICBkZWxldGU6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgaWYgKGFzc2VydEtleU9rVG9EZWxldGUgIT09IHZvaWQgMCkge1xuICAgICAgICBhc3NlcnRLZXlPa1RvRGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgICBqc3NldC5kZWxldGUoa2V5KTtcbiAgICB9LFxuICAgIGFkZEFsbDogKGtleXM1KSA9PiB7XG4gICAgICBpZiAodHlwZW9mIGtleXM1W1N5bWJvbC5pdGVyYXRvcl0gIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBpZiAoT2JqZWN0LmlzRnJvemVuKGtleXM1KSAmJiBpc0NvcHlTZXQoa2V5czUpKSB7XG4gICAgICAgICAga2V5czUgPSBnZXRDb3B5U2V0S2V5cyhrZXlzNSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3dSZWRhY3RlZGBwcm92aWRlZCBkYXRhIHNvdXJjZSBpcyBub3QgaXRlcmFibGU6ICR7a2V5czV9YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChcbiAgICAgICAgY29uc3Qga2V5IG9mXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGtleXM1XG4gICAgICApIHtcbiAgICAgICAgYXNzZXJ0S2V5T2tUb0FkZChrZXkpO1xuICAgICAgICBqc3NldC5hZGQoa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBtYWtlU2NhbGFyV2Vha1NldFN0b3JlMyA9ICh0YWcgPSBcImtleVwiLCB7IGxvbmdMaXZlZCA9IHRydWUsIGtleVNoYXBlID0gdm9pZCAwIH0gPSB7fSkgPT4ge1xuICBjb25zdCBqc3NldCA9IG5ldyAobG9uZ0xpdmVkID8gV2Vha1NldCA6IFNldCkoKTtcbiAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKGtleVNoYXBlKTtcbiAgfVxuICBjb25zdCBhc3NlcnRLZXlPa1RvQWRkID0gKGtleSkgPT4ge1xuICAgIGhhcmRlbihrZXkpO1xuICAgIHBhc3NTdHlsZU9mKGtleSkgPT09IFwicmVtb3RhYmxlXCIgfHwgdGhyb3dSZWRhY3RlZGBPbmx5IHJlbW90YWJsZXMgY2FuIGJlIGtleXMgb2Ygc2NhbGFyIFdlYWtTdG9yZXM6ICR7a2V5fWA7XG4gICAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaChrZXksIGtleVNoYXBlLCBcIndlYWtTZXRTdG9yZSBrZXlcIik7XG4gICAgfVxuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgV2Vha1NldFN0b3JlIG9mICR7cXVvdGUodGFnKX1gLCB7XG4gICAgLi4ubWFrZVdlYWtTZXRTdG9yZU1ldGhvZHMzKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCB2b2lkIDAsIHRhZylcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJXZWFrU2V0U3RvcmUzKTtcblxuLy9cbnZhciBtYWtlQ3VycmVudEtleXNLaXQzID0gKGdldFJhd0tleXMsIGNoZWNrSGFzLCBjb21wYXJlLCBhc3NlcnRPa1RvQWRkLCBhc3NlcnRPa1RvRGVsZXRlID0gdm9pZCAwLCBrZXlOYW1lID0gXCJrZXlcIikgPT4ge1xuICBsZXQgdXBkYXRlQ291bnQgPSAwO1xuICBsZXQgc29ydGVkS2V5c01lbW87XG4gIGNvbnN0IGFzc2VydFVwZGF0ZU9uQWRkID0gKGssIHYyID0gdm9pZCAwKSA9PiB7XG4gICAgYXNzZXJ0T2tUb0FkZChrLCB2Mik7XG4gICAgdXBkYXRlQ291bnQgKz0gMTtcbiAgICBzb3J0ZWRLZXlzTWVtbyA9IHZvaWQgMDtcbiAgfTtcbiAgY29uc3QgYXNzZXJ0VXBkYXRlT25EZWxldGUgPSAoaykgPT4gYXNzZXJ0T2tUb0RlbGV0ZSAmJiBhc3NlcnRPa1RvRGVsZXRlKGspO1xuICBjb25zdCBnZXRTb3J0ZWRLZXlzID0gKCkgPT4ge1xuICAgIGlmIChzb3J0ZWRLZXlzTWVtbyA9PT0gdm9pZCAwKSB7XG4gICAgICBzb3J0ZWRLZXlzTWVtbyA9IGhhcmRlbihbLi4uZ2V0UmF3S2V5cygpXS5zb3J0KGNvbXBhcmUpKTtcbiAgICB9XG4gICAgcmV0dXJuIHNvcnRlZEtleXNNZW1vO1xuICB9O1xuICBjb25zdCBpdGVyYWJsZUtleXMgPSBGYXIoXCJJdGVyYWJsZSBvZiBrZXlzXCIsIHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgY29uc3QgZ2VuZXJhdGlvbiA9IHVwZGF0ZUNvdW50O1xuICAgICAgZ2V0U29ydGVkS2V5cygpO1xuICAgICAgY29uc3QgbGVuID0gc29ydGVkS2V5c01lbW8ubGVuZ3RoO1xuICAgICAgbGV0IGkyID0gMDtcbiAgICAgIHJldHVybiBGYXIoXCJJdGVyYXRvciBvZiBrZXlzXCIsIHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGdlbmVyYXRpb24gPT09IHVwZGF0ZUNvdW50IHx8IHRocm93UmVkYWN0ZWRgU3RvcmUgJHtxdW90ZShrZXlOYW1lKX0gY3Vyc29yIHN0YWxlYDtcbiAgICAgICAgICBmb3IgKDsgOyApIHtcbiAgICAgICAgICAgIGlmIChpMiA8IGxlbikge1xuICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHNvcnRlZEtleXNNZW1vW2kyXTtcbiAgICAgICAgICAgICAgaTIgKz0gMTtcbiAgICAgICAgICAgICAgaWYgKGNoZWNrSGFzKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWUgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZTogdm9pZCAwIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgYXNzZXJ0VXBkYXRlT25BZGQsXG4gICAgYXNzZXJ0VXBkYXRlT25EZWxldGUsXG4gICAgaXRlcmFibGVLZXlzXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlQ3VycmVudEtleXNLaXQzKTtcbnZhciBwcm92aWRlTGF6eTMgPSAobWFwU3RvcmUsIGtleSwgbWFrZVZhbHVlKSA9PiB7XG4gIGlmICghbWFwU3RvcmUuaGFzKGtleSkpIHtcbiAgICBtYXBTdG9yZS5pbml0KGtleSwgbWFrZVZhbHVlKGtleSkpO1xuICB9XG4gIHJldHVybiBtYXBTdG9yZS5nZXQoa2V5KTtcbn07XG5oYXJkZW4ocHJvdmlkZUxhenkzKTtcbnZhciBtYWtlQXRvbWljUHJvdmlkZXIzID0gKHN0b3JlKSA9PiB7XG4gIGNvbnN0IHBlbmRpbmcgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICBjb25zdCBwcm92aWRlQXN5bmMgPSAoa2V5LCBtYWtlVmFsdWUsIGZpbmlzaFZhbHVlKSA9PiB7XG4gICAgaWYgKHN0b3JlLmhhcyhrZXkpKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHN0b3JlLmdldChrZXkpKTtcbiAgICB9XG4gICAgaWYgKCFwZW5kaW5nLmhhcyhrZXkpKSB7XG4gICAgICBjb25zdCB2YWxQMiA9IG1ha2VWYWx1ZShrZXkpLnRoZW4oKHYyKSA9PiB7XG4gICAgICAgIHN0b3JlLmluaXQoa2V5LCB2Mik7XG4gICAgICAgIHJldHVybiB2MjtcbiAgICAgIH0pLnRoZW4oKHYyKSA9PiB7XG4gICAgICAgIGlmIChmaW5pc2hWYWx1ZSkge1xuICAgICAgICAgIHJldHVybiBmaW5pc2hWYWx1ZShrZXksIHYyKS50aGVuKCgpID0+IHYyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdjI7XG4gICAgICB9KS5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgcGVuZGluZy5kZWxldGUoa2V5KTtcbiAgICAgIH0pO1xuICAgICAgcGVuZGluZy5zZXQoa2V5LCB2YWxQMik7XG4gICAgfVxuICAgIGNvbnN0IHZhbFAgPSBwZW5kaW5nLmdldChrZXkpO1xuICAgIGFzc2VydCh2YWxQKTtcbiAgICByZXR1cm4gdmFsUDtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IHByb3ZpZGVBc3luYyB9KTtcbn07XG5oYXJkZW4obWFrZUF0b21pY1Byb3ZpZGVyMyk7XG52YXIgYXBwZW5kVG9TdG9yZWRBcnJheTMgPSAobWFwU3RvcmUsIGtleSwgaXRlbSkgPT4ge1xuICBpZiAobWFwU3RvcmUuaGFzKGtleSkpIHtcbiAgICBjb25zdCBleHRhbnQgPSBtYXBTdG9yZS5nZXQoa2V5KTtcbiAgICBtYXBTdG9yZS5zZXQoa2V5LCBoYXJkZW4oWy4uLmV4dGFudCwgaXRlbV0pKTtcbiAgfSBlbHNlIHtcbiAgICBtYXBTdG9yZS5pbml0KGtleSwgaGFyZGVuKFtpdGVtXSkpO1xuICB9XG59O1xuaGFyZGVuKGFwcGVuZFRvU3RvcmVkQXJyYXkzKTtcblxuLy9cbnZhciBtYWtlU2V0U3RvcmVNZXRob2RzMyA9IChqc3NldCwgYXNzZXJ0S2V5T2tUb0FkZCwgYXNzZXJ0S2V5T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgeyBhc3NlcnRVcGRhdGVPbkFkZCwgYXNzZXJ0VXBkYXRlT25EZWxldGUsIGl0ZXJhYmxlS2V5cyB9ID0gbWFrZUN1cnJlbnRLZXlzS2l0MyhcbiAgICAoKSA9PiBqc3NldC5rZXlzKCksXG4gICAgKGspID0+IGpzc2V0LmhhcyhrKSxcbiAgICBjb21wYXJlUmFuayxcbiAgICBhc3NlcnRLZXlPa1RvQWRkLFxuICAgIGFzc2VydEtleU9rVG9EZWxldGUsXG4gICAga2V5TmFtZVxuICApO1xuICBjb25zdCBrZXlzNSA9IChrZXlQYXR0ID0gdm9pZCAwKSA9PiBrZXlQYXR0ID09PSB2b2lkIDAgPyBpdGVyYWJsZUtleXMgOiBmaWx0ZXJJdGVyYWJsZShpdGVyYWJsZUtleXMsIChrKSA9PiBtYXRjaGVzKGssIGtleVBhdHQpKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgLi4ubWFrZVdlYWtTZXRTdG9yZU1ldGhvZHMzKFxuICAgICAganNzZXQsXG4gICAgICBhc3NlcnRVcGRhdGVPbkFkZCxcbiAgICAgIGFzc2VydFVwZGF0ZU9uRGVsZXRlLFxuICAgICAga2V5TmFtZVxuICAgICksXG4gICAga2V5czoga2V5czUsXG4gICAgdmFsdWVzOiBrZXlzNSxcbiAgICBzbmFwc2hvdDogKGtleVBhdHQgPSB2b2lkIDApID0+IG1ha2VDb3B5U2V0KGtleXM1KGtleVBhdHQpKSxcbiAgICBnZXRTaXplOiAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ga2V5UGF0dCA9PT0gdm9pZCAwID8ganNzZXQuc2l6ZSA6IFsuLi5rZXlzNShrZXlQYXR0KV0ubGVuZ3RoLFxuICAgIGNsZWFyOiAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ge1xuICAgICAgaWYgKGtleVBhdHQgPT09IHZvaWQgMCkge1xuICAgICAgICBqc3NldC5jbGVhcigpO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5czUoa2V5UGF0dCkpIHtcbiAgICAgICAganNzZXQuZGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgbWFrZVNjYWxhclNldFN0b3JlMyA9ICh0YWcgPSBcImtleVwiLCB7IGtleVNoYXBlID0gdm9pZCAwIH0gPSB7fSkgPT4ge1xuICBjb25zdCBqc3NldCA9IC8qICAgICAgICAgICAqLyBuZXcgU2V0KCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S2V5T2tUb0FkZCA9IChrZXkpID0+IHtcbiAgICBoYXJkZW4oa2V5KTtcbiAgICBhc3NlcnRTY2FsYXJLZXkoa2V5KTtcbiAgICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKGtleSwga2V5U2hhcGUsIFwic2V0U3RvcmUga2V5XCIpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIEZhcihgc2NhbGFyIFNldFN0b3JlIG9mICR7cXVvdGUodGFnKX1gLCB7XG4gICAgLi4ubWFrZVNldFN0b3JlTWV0aG9kczMoanNzZXQsIGFzc2VydEtleU9rVG9BZGQsIHZvaWQgMCwgdGFnKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZVNjYWxhclNldFN0b3JlMyk7XG5cbi8vXG52YXIgbWFrZVdlYWtNYXBTdG9yZU1ldGhvZHMzID0gKGpzbWFwLCBhc3NlcnRLVk9rVG9BZGQsIGFzc2VydEtWT2tUb1NldCwgYXNzZXJ0S2V5T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgYXNzZXJ0S2V5RG9lc05vdEV4aXN0ID0gKGtleSkgPT4gIWpzbWFwLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShrZXlOYW1lKX0gYWxyZWFkeSByZWdpc3RlcmVkOiAke2tleX1gO1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiBqc21hcC5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUoa2V5TmFtZSl9IG5vdCBmb3VuZDogJHtrZXl9YDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgaGFzOiAoa2V5KSA9PiB7XG4gICAgICByZXR1cm4ganNtYXAuaGFzKGtleSk7XG4gICAgfSxcbiAgICBnZXQ6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAgICBqc21hcC5nZXQoa2V5KVxuICAgICAgKTtcbiAgICB9LFxuICAgIGluaXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlEb2VzTm90RXhpc3Qoa2V5KTtcbiAgICAgIGFzc2VydEtWT2tUb0FkZChrZXksIHZhbHVlKTtcbiAgICAgIGpzbWFwLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIHNldDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgYXNzZXJ0S1ZPa1RvU2V0KGtleSwgdmFsdWUpO1xuICAgICAganNtYXAuc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZGVsZXRlOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIGlmIChhc3NlcnRLZXlPa1RvRGVsZXRlICE9PSB2b2lkIDApIHtcbiAgICAgICAgYXNzZXJ0S2V5T2tUb0RlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgICAganNtYXAuZGVsZXRlKGtleSk7XG4gICAgfSxcbiAgICBhZGRBbGw6IChlbnRyaWVzMTEpID0+IHtcbiAgICAgIGlmICh0eXBlb2YgZW50cmllczExW1N5bWJvbC5pdGVyYXRvcl0gIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBpZiAoT2JqZWN0LmlzRnJvemVuKGVudHJpZXMxMSkgJiYgaXNDb3B5TWFwKGVudHJpZXMxMSkpIHtcbiAgICAgICAgICBlbnRyaWVzMTEgPSBnZXRDb3B5TWFwRW50cmllcyhlbnRyaWVzMTEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93UmVkYWN0ZWRgcHJvdmlkZWQgZGF0YSBzb3VyY2UgaXMgbm90IGl0ZXJhYmxlOiAke2VudHJpZXMxMX1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKFxuICAgICAgICBjb25zdCBba2V5LCB2YWx1ZV0gb2ZcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBlbnRyaWVzMTFcbiAgICAgICkge1xuICAgICAgICBhc3NlcnRLVk9rVG9BZGQoa2V5LCB2YWx1ZSk7XG4gICAgICAgIGpzbWFwLnNldChrZXksIHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBtYWtlU2NhbGFyV2Vha01hcFN0b3JlMyA9ICh0YWcgPSBcImtleVwiLCB7IGxvbmdMaXZlZCA9IHRydWUsIGtleVNoYXBlID0gdm9pZCAwLCB2YWx1ZVNoYXBlID0gdm9pZCAwIH0gPSB7fSkgPT4ge1xuICBjb25zdCBqc21hcCA9IG5ldyAobG9uZ0xpdmVkID8gV2Vha01hcCA6IE1hcCkoKTtcbiAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKGtleVNoYXBlKTtcbiAgfVxuICBpZiAodmFsdWVTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybih2YWx1ZVNoYXBlKTtcbiAgfVxuICBjb25zdCBhc3NlcnRLVk9rVG9TZXQgPSAoX2tleSwgdmFsdWUpID0+IHtcbiAgICBoYXJkZW4odmFsdWUpO1xuICAgIGFzc2VydFBhc3NhYmxlKHZhbHVlKTtcbiAgICBpZiAodmFsdWVTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2godmFsdWUsIHZhbHVlU2hhcGUsIFwid2Vha01hcFN0b3JlIHZhbHVlXCIpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgYXNzZXJ0S1ZPa1RvQWRkID0gKGtleSwgdmFsdWUpID0+IHtcbiAgICBoYXJkZW4oa2V5KTtcbiAgICBwYXNzU3R5bGVPZihrZXkpID09PSBcInJlbW90YWJsZVwiIHx8IHRocm93UmVkYWN0ZWRgT25seSByZW1vdGFibGVzIGNhbiBiZSBrZXlzIG9mIHNjYWxhciBXZWFrTWFwU3RvcmVzOiAke2tleX1gO1xuICAgIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2goa2V5LCBrZXlTaGFwZSwgXCJ3ZWFrTWFwU3RvcmUga2V5XCIpO1xuICAgIH1cbiAgICBhc3NlcnRLVk9rVG9TZXQoa2V5LCB2YWx1ZSk7XG4gIH07XG4gIHJldHVybiBGYXIoYHNjYWxhciBXZWFrTWFwU3RvcmUgb2YgJHtxdW90ZSh0YWcpfWAsIHtcbiAgICAuLi5tYWtlV2Vha01hcFN0b3JlTWV0aG9kczMoXG4gICAgICBqc21hcCxcbiAgICAgIGFzc2VydEtWT2tUb0FkZCxcbiAgICAgIGFzc2VydEtWT2tUb1NldCxcbiAgICAgIHZvaWQgMCxcbiAgICAgIHRhZ1xuICAgIClcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJXZWFrTWFwU3RvcmUzKTtcblxuLy9cbnZhciBtYWtlTWFwU3RvcmVNZXRob2RzMyA9IChqc21hcCwgYXNzZXJ0S1ZPa1RvQWRkLCBhc3NlcnRLVk9rVG9TZXQsIGFzc2VydEtleU9rVG9EZWxldGUgPSB2b2lkIDAsIHRhZyA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgeyBhc3NlcnRVcGRhdGVPbkFkZCwgYXNzZXJ0VXBkYXRlT25EZWxldGUsIGl0ZXJhYmxlS2V5cyB9ID0gbWFrZUN1cnJlbnRLZXlzS2l0MyhcbiAgICAoKSA9PiBqc21hcC5rZXlzKCksXG4gICAgKGspID0+IGpzbWFwLmhhcyhrKSxcbiAgICBjb21wYXJlUmFuayxcbiAgICBhc3NlcnRLVk9rVG9BZGQsXG4gICAgYXNzZXJ0S2V5T2tUb0RlbGV0ZSxcbiAgICB0YWdcbiAgKTtcbiAgY29uc3Qga2V5czUgPSAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiB7XG4gICAgaWYgKGtleVBhdHQgPT09IHZvaWQgMCAmJiB2YWx1ZVBhdHQgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGl0ZXJhYmxlS2V5cztcbiAgICB9XG4gICAgY29uc3QgZmlsdGVyID0gKGspID0+IHtcbiAgICAgIGlmIChrZXlQYXR0ICE9PSB2b2lkIDAgJiYgIW1hdGNoZXMoaywga2V5UGF0dCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKHZhbHVlUGF0dCAhPT0gdm9pZCAwICYmICFtYXRjaGVzKGpzbWFwLmdldChrKSwgdmFsdWVQYXR0KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIHJldHVybiBmaWx0ZXJJdGVyYWJsZShpdGVyYWJsZUtleXMsIGZpbHRlcik7XG4gIH07XG4gIGNvbnN0IHZhbHVlczggPSAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBtYXBJdGVyYWJsZShrZXlzNShrZXlQYXR0LCB2YWx1ZVBhdHQpLCAoaykgPT4gKFxuICAgIC8qICAgICAgICAgICAgKi9cbiAgICBqc21hcC5nZXQoaylcbiAgKSk7XG4gIGNvbnN0IGVudHJpZXMxMSA9IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IG1hcEl0ZXJhYmxlKGtleXM1KGtleVBhdHQsIHZhbHVlUGF0dCksIChrKSA9PiBbXG4gICAgayxcbiAgICAvKiAgICAgICAgICAgICovXG4gICAganNtYXAuZ2V0KGspXG4gIF0pO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICAuLi5tYWtlV2Vha01hcFN0b3JlTWV0aG9kczMoXG4gICAgICBqc21hcCxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBhc3NlcnRVcGRhdGVPbkFkZCxcbiAgICAgIGFzc2VydEtWT2tUb1NldCxcbiAgICAgIGFzc2VydFVwZGF0ZU9uRGVsZXRlLFxuICAgICAgdGFnXG4gICAgKSxcbiAgICBrZXlzOiBrZXlzNSxcbiAgICB2YWx1ZXM6IHZhbHVlczgsXG4gICAgZW50cmllczogZW50cmllczExLFxuICAgIHNuYXBzaG90OiAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBtYWtlQ29weU1hcChlbnRyaWVzMTEoa2V5UGF0dCwgdmFsdWVQYXR0KSksXG4gICAgZ2V0U2l6ZTogKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4ga2V5UGF0dCA9PT0gdm9pZCAwICYmIHZhbHVlUGF0dCA9PT0gdm9pZCAwID8ganNtYXAuc2l6ZSA6IFsuLi5rZXlzNShrZXlQYXR0LCB2YWx1ZVBhdHQpXS5sZW5ndGgsXG4gICAgY2xlYXI6IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IHtcbiAgICAgIGlmIChrZXlQYXR0ID09PSB2b2lkIDAgJiYgdmFsdWVQYXR0ID09PSB2b2lkIDApIHtcbiAgICAgICAganNtYXAuY2xlYXIoKTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXM1KGtleVBhdHQsIHZhbHVlUGF0dCkpIHtcbiAgICAgICAganNtYXAuZGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgbWFrZVNjYWxhck1hcFN0b3JlMyA9ICh0YWcgPSBcImtleVwiLCB7IGtleVNoYXBlID0gdm9pZCAwLCB2YWx1ZVNoYXBlID0gdm9pZCAwIH0gPSB7fSkgPT4ge1xuICBjb25zdCBqc21hcCA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4odmFsdWVTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S1ZPa1RvU2V0ID0gKF9rZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKHZhbHVlKTtcbiAgICBhc3NlcnRQYXNzYWJsZSh2YWx1ZSk7XG4gICAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKHZhbHVlLCB2YWx1ZVNoYXBlLCBcIm1hcFN0b3JlIHZhbHVlXCIpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgYXNzZXJ0S1ZPa1RvQWRkID0gKGtleSwgdmFsdWUpID0+IHtcbiAgICBoYXJkZW4oa2V5KTtcbiAgICBhc3NlcnRTY2FsYXJLZXkoa2V5KTtcbiAgICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKGtleSwga2V5U2hhcGUsIFwibWFwU3RvcmUga2V5XCIpO1xuICAgIH1cbiAgICBhc3NlcnRLVk9rVG9TZXQoa2V5LCB2YWx1ZSk7XG4gIH07XG4gIHJldHVybiBGYXIoYHNjYWxhciBNYXBTdG9yZSBvZiAke3F1b3RlKHRhZyl9YCwge1xuICAgIC4uLm1ha2VNYXBTdG9yZU1ldGhvZHMzKFxuICAgICAganNtYXAsXG4gICAgICBhc3NlcnRLVk9rVG9BZGQsXG4gICAgICBhc3NlcnRLVk9rVG9TZXQsXG4gICAgICB2b2lkIDAsXG4gICAgICB0YWdcbiAgICApXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU2NhbGFyTWFwU3RvcmUzKTtcblxuLy9cbnZhciBtYWtlTGVnYWN5TWFwMyA9ICh0YWcgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IG0yID0gLyogICAgICAgICAgICovIG5ldyBNYXAoKTtcbiAgY29uc3QgYXNzZXJ0S2V5RG9lc05vdEV4aXN0ID0gKGtleSkgPT4gIW0yLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBhbHJlYWR5IHJlZ2lzdGVyZWQ6ICR7a2V5fWA7XG4gIGNvbnN0IGFzc2VydEtleUV4aXN0cyA9IChrZXkpID0+IG0yLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBub3QgZm91bmQ6ICR7a2V5fWA7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGhhczogKGtleSkgPT4ge1xuICAgICAgcmV0dXJuIG0yLmhhcyhrZXkpO1xuICAgIH0sXG4gICAgaW5pdDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleURvZXNOb3RFeGlzdChrZXkpO1xuICAgICAgbTIuc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZ2V0OiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHJldHVybiBtMi5nZXQoa2V5KTtcbiAgICB9LFxuICAgIHNldDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgbTIuc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZGVsZXRlOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIG0yLmRlbGV0ZShrZXkpO1xuICAgIH0sXG4gICAga2V5czogKCkgPT4gbTIua2V5cygpLFxuICAgIHZhbHVlczogKCkgPT4gbTIudmFsdWVzKCksXG4gICAgZW50cmllczogKCkgPT4gbTIuZW50cmllcygpLFxuICAgIGdldFNpemU6ICgpID0+IG0yLnNpemUsXG4gICAgY2xlYXI6ICgpID0+IG0yLmNsZWFyKClcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VMZWdhY3lNYXAzKTtcblxuLy9cbnZhciBtYWtlTGVnYWN5V2Vha01hcDMgPSAodGFnID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCB3bSA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBjb25zdCBhc3NlcnRLZXlEb2VzTm90RXhpc3QgPSAoa2V5KSA9PiAhd20uaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKHRhZyl9IGFscmVhZHkgcmVnaXN0ZXJlZDogJHtrZXl9YDtcbiAgY29uc3QgYXNzZXJ0S2V5RXhpc3RzID0gKGtleSkgPT4gd20uaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKHRhZyl9IG5vdCBmb3VuZDogJHtrZXl9YDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgaGFzOiAoa2V5KSA9PiB7XG4gICAgICByZXR1cm4gd20uaGFzKGtleSk7XG4gICAgfSxcbiAgICBpbml0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RG9lc05vdEV4aXN0KGtleSk7XG4gICAgICB3bS5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBnZXQ6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAgICB3bS5nZXQoa2V5KVxuICAgICAgKTtcbiAgICB9LFxuICAgIHNldDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgd20uc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZGVsZXRlOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHdtLmRlbGV0ZShrZXkpO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VMZWdhY3lXZWFrTWFwMyk7XG5cbi8vXG52YXIgbXVzdE1hdGNoMiA9IG11c3RNYXRjaDtcblxuLy9cbnZhciBWYXREYXRhR2xvYmFsO1xuaWYgKFwiVmF0RGF0YVwiIGluIGdsb2JhbFRoaXMpIHtcbiAgZ2xvYmFsVGhpcy5WYXREYXRhIHx8IHRocm93UmVkYWN0ZWRgVmF0RGF0YSBkZWZpbmVkIGluIGdsb2JhbCBhcyBudWxsIG9yIHVuZGVmaW5lZGA7XG4gIFZhdERhdGFHbG9iYWwgPSAvKiAgICAgICAgICAgICAgKi9cbiAgZ2xvYmFsVGhpcy5WYXREYXRhO1xufSBlbHNlIHtcbiAgY29uc3QgdW5hdmFpbGFibGUgPSAoKSA9PiB0aHJvd1JlZGFjdGVkYFZhdERhdGEgdW5hdmFpbGFibGVgO1xuICBWYXREYXRhR2xvYmFsID0ge1xuICAgIGRlZmluZUtpbmQ6IHVuYXZhaWxhYmxlLFxuICAgIGRlZmluZUtpbmRNdWx0aTogdW5hdmFpbGFibGUsXG4gICAgZGVmaW5lRHVyYWJsZUtpbmQ6IHVuYXZhaWxhYmxlLFxuICAgIGRlZmluZUR1cmFibGVLaW5kTXVsdGk6IHVuYXZhaWxhYmxlLFxuICAgIG1ha2VLaW5kSGFuZGxlOiB1bmF2YWlsYWJsZSxcbiAgICBwcm92aWRlUHJvbWlzZVdhdGNoZXI6IHVuYXZhaWxhYmxlLFxuICAgIHdhdGNoUHJvbWlzZTogdW5hdmFpbGFibGUsXG4gICAgbWFrZVNjYWxhckJpZ01hcFN0b3JlOiB1bmF2YWlsYWJsZSxcbiAgICBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlOiB1bmF2YWlsYWJsZSxcbiAgICBtYWtlU2NhbGFyQmlnU2V0U3RvcmU6IHVuYXZhaWxhYmxlLFxuICAgIG1ha2VTY2FsYXJCaWdXZWFrU2V0U3RvcmU6IHVuYXZhaWxhYmxlLFxuICAgIGNhbkJlRHVyYWJsZTogdW5hdmFpbGFibGVcbiAgfTtcbn1cbnZhciBWYXREYXRhRXhwb3J0ID0gVmF0RGF0YUdsb2JhbDtcbnZhciB7XG4gIGRlZmluZUtpbmQsXG4gIGRlZmluZUtpbmRNdWx0aSxcbiAgZGVmaW5lRHVyYWJsZUtpbmQsXG4gIGRlZmluZUR1cmFibGVLaW5kTXVsdGlcbn0gPSBWYXREYXRhR2xvYmFsO1xudmFyIHtcbiAgbWFrZUtpbmRIYW5kbGUsXG4gIHByb3ZpZGVQcm9taXNlV2F0Y2hlcixcbiAgd2F0Y2hQcm9taXNlOiB3YXRjaFByb21pc2UyLFxuICBtYWtlU2NhbGFyQmlnTWFwU3RvcmUsXG4gIG1ha2VTY2FsYXJCaWdXZWFrTWFwU3RvcmUsXG4gIG1ha2VTY2FsYXJCaWdTZXRTdG9yZSxcbiAgbWFrZVNjYWxhckJpZ1dlYWtTZXRTdG9yZSxcbiAgY2FuQmVEdXJhYmxlXG59ID0gVmF0RGF0YUdsb2JhbDtcbnZhciBwaWNrRmFjZXQgPSAobWFrZXIsIGZhY2V0TmFtZSkgPT4gKC4uLmFyZ3MpID0+IG1ha2VyKC4uLmFyZ3MpW2ZhY2V0TmFtZV07XG5oYXJkZW4ocGlja0ZhY2V0KTtcbnZhciBwYXJ0aWFsQXNzaWduID0gKHRhcmdldCwgc291cmNlKSA9PiB7XG4gIE9iamVjdC5hc3NpZ24odGFyZ2V0LCBzb3VyY2UpO1xufTtcbmhhcmRlbihwYXJ0aWFsQXNzaWduKTtcbnZhciBwcm92aWRlID0gKFxuICAvL1xuICAvKlxuXG5cblxuXG5cbiAgICovXG4gIHByb3ZpZGVMYXp5M1xuKTtcbnZhciBtYWtlU3RvcmVVdGlscyA9IChWYXREYXRhKSA9PiB7XG4gIGNvbnN0IHtcbiAgICAvL1xuICAgIG1ha2VTY2FsYXJCaWdNYXBTdG9yZTogbWFrZVNjYWxhckJpZ01hcFN0b3JlNCxcbiAgICAvL1xuICAgIG1ha2VTY2FsYXJCaWdXZWFrTWFwU3RvcmU6IG1ha2VTY2FsYXJCaWdXZWFrTWFwU3RvcmU0LFxuICAgIC8vXG4gICAgbWFrZVNjYWxhckJpZ1NldFN0b3JlOiBtYWtlU2NhbGFyQmlnU2V0U3RvcmU0LFxuICAgIC8vXG4gICAgbWFrZVNjYWxhckJpZ1dlYWtTZXRTdG9yZTogbWFrZVNjYWxhckJpZ1dlYWtTZXRTdG9yZTRcbiAgfSA9IFZhdERhdGE7XG4gIGNvbnN0IHByb3ZpZGVEdXJhYmxlTWFwU3RvcmU0ID0gKGJhZ2dhZ2UsIG5hbWUsIG9wdGlvbnMgPSB7fSkgPT4gcHJvdmlkZShcbiAgICBiYWdnYWdlLFxuICAgIG5hbWUsXG4gICAgKCkgPT4gbWFrZVNjYWxhckJpZ01hcFN0b3JlNChuYW1lLCB7IGR1cmFibGU6IHRydWUsIC4uLm9wdGlvbnMgfSlcbiAgKTtcbiAgaGFyZGVuKHByb3ZpZGVEdXJhYmxlTWFwU3RvcmU0KTtcbiAgY29uc3QgcHJvdmlkZUR1cmFibGVXZWFrTWFwU3RvcmU0ID0gKGJhZ2dhZ2UsIG5hbWUsIG9wdGlvbnMgPSB7fSkgPT4gcHJvdmlkZShcbiAgICBiYWdnYWdlLFxuICAgIG5hbWUsXG4gICAgKCkgPT4gbWFrZVNjYWxhckJpZ1dlYWtNYXBTdG9yZTQobmFtZSwgeyBkdXJhYmxlOiB0cnVlLCAuLi5vcHRpb25zIH0pXG4gICk7XG4gIGhhcmRlbihwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZTQpO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZVNldFN0b3JlNCA9IChiYWdnYWdlLCBuYW1lLCBvcHRpb25zID0ge30pID0+IHByb3ZpZGUoXG4gICAgYmFnZ2FnZSxcbiAgICBuYW1lLFxuICAgICgpID0+IG1ha2VTY2FsYXJCaWdTZXRTdG9yZTQobmFtZSwgeyBkdXJhYmxlOiB0cnVlLCAuLi5vcHRpb25zIH0pXG4gICk7XG4gIGhhcmRlbihwcm92aWRlRHVyYWJsZVNldFN0b3JlNCk7XG4gIGNvbnN0IHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlNCA9IChiYWdnYWdlLCBuYW1lLCBvcHRpb25zID0ge30pID0+IHByb3ZpZGUoXG4gICAgYmFnZ2FnZSxcbiAgICBuYW1lLFxuICAgICgpID0+IG1ha2VTY2FsYXJCaWdXZWFrU2V0U3RvcmU0KG5hbWUsIHsgZHVyYWJsZTogdHJ1ZSwgLi4ub3B0aW9ucyB9KVxuICApO1xuICBoYXJkZW4ocHJvdmlkZUR1cmFibGVXZWFrU2V0U3RvcmU0KTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgcHJvdmlkZUR1cmFibGVNYXBTdG9yZTogcHJvdmlkZUR1cmFibGVNYXBTdG9yZTQsXG4gICAgcHJvdmlkZUR1cmFibGVXZWFrTWFwU3RvcmU6IHByb3ZpZGVEdXJhYmxlV2Vha01hcFN0b3JlNCxcbiAgICBwcm92aWRlRHVyYWJsZVNldFN0b3JlOiBwcm92aWRlRHVyYWJsZVNldFN0b3JlNCxcbiAgICBwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZTogcHJvdmlkZUR1cmFibGVXZWFrU2V0U3RvcmU0XG4gIH0pO1xufTtcbnZhciBnbG9iYWxTdG9yZVV0aWxzID0gbWFrZVN0b3JlVXRpbHMoVmF0RGF0YUdsb2JhbCk7XG52YXIge1xuICBwcm92aWRlRHVyYWJsZU1hcFN0b3JlLFxuICBwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZSxcbiAgcHJvdmlkZUR1cmFibGVTZXRTdG9yZSxcbiAgcHJvdmlkZUR1cmFibGVXZWFrU2V0U3RvcmVcbn0gPSBnbG9iYWxTdG9yZVV0aWxzO1xuXG4vL1xudmFyIGlnbm9yZUNvbnRleHQgPSAoZm4pID0+IChfY29udGV4dCwgLi4uYXJncykgPT4gZm4oLi4uYXJncyk7XG5oYXJkZW4oaWdub3JlQ29udGV4dCk7XG52YXIgbWFrZUV4b1V0aWxzID0gKFZhdERhdGEpID0+IHtcbiAgY29uc3Qge1xuICAgIGRlZmluZUtpbmQ6IGRlZmluZUtpbmQ0LFxuICAgIGRlZmluZUtpbmRNdWx0aTogZGVmaW5lS2luZE11bHRpNCxcbiAgICBkZWZpbmVEdXJhYmxlS2luZDogZGVmaW5lRHVyYWJsZUtpbmQ0LFxuICAgIGRlZmluZUR1cmFibGVLaW5kTXVsdGk6IGRlZmluZUR1cmFibGVLaW5kTXVsdGk0LFxuICAgIG1ha2VLaW5kSGFuZGxlOiBtYWtlS2luZEhhbmRsZTRcbiAgfSA9IFZhdERhdGE7XG4gIGNvbnN0IHByb3ZpZGVLaW5kSGFuZGxlNCA9IChiYWdnYWdlLCBraW5kTmFtZSkgPT4gcHJvdmlkZShiYWdnYWdlLCBgJHtraW5kTmFtZX1fa2luZEhhbmRsZWAsICgpID0+IG1ha2VLaW5kSGFuZGxlNChraW5kTmFtZSkpO1xuICBoYXJkZW4ocHJvdmlkZUtpbmRIYW5kbGU0KTtcbiAgY29uc3QgcHJlcGFyZUtpbmQ0ID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBpbml0LCBiZWhhdmlvciwgb3B0aW9ucyA9IHZvaWQgMCkgPT4gZGVmaW5lRHVyYWJsZUtpbmQ0KFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlNChiYWdnYWdlLCBraW5kTmFtZSksXG4gICAgaW5pdCxcbiAgICBiZWhhdmlvcixcbiAgICBvcHRpb25zXG4gICk7XG4gIGhhcmRlbihwcmVwYXJlS2luZDQpO1xuICBjb25zdCBwcmVwYXJlS2luZE11bHRpNCA9IChiYWdnYWdlLCBraW5kTmFtZSwgaW5pdCwgYmVoYXZpb3IsIG9wdGlvbnMgPSB2b2lkIDApID0+IGRlZmluZUR1cmFibGVLaW5kTXVsdGk0KFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlNChiYWdnYWdlLCBraW5kTmFtZSksXG4gICAgaW5pdCxcbiAgICBiZWhhdmlvcixcbiAgICBvcHRpb25zXG4gICk7XG4gIGhhcmRlbihwcmVwYXJlS2luZE11bHRpNCk7XG4gIGNvbnN0IGRlZmluZVZpcnR1YWxFeG9DbGFzczQgPSAodGFnLCBpbnRlcmZhY2VHdWFyZCwgaW5pdCwgbWV0aG9kcywgb3B0aW9ucykgPT4gKFxuICAgIC8vXG4gICAgZGVmaW5lS2luZDQodGFnLCBpbml0LCBtZXRob2RzLCB7XG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgdGhpc2Z1bE1ldGhvZHM6IHRydWUsXG4gICAgICBpbnRlcmZhY2VHdWFyZFxuICAgIH0pXG4gICk7XG4gIGhhcmRlbihkZWZpbmVWaXJ0dWFsRXhvQ2xhc3M0KTtcbiAgY29uc3QgZGVmaW5lVmlydHVhbEV4b0NsYXNzS2l0NCA9ICh0YWcsIGludGVyZmFjZUd1YXJkS2l0LCBpbml0LCBmYWNldHMsIG9wdGlvbnMpID0+IChcbiAgICAvL1xuICAgIGRlZmluZUtpbmRNdWx0aTQodGFnLCBpbml0LCBmYWNldHMsIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICB0aGlzZnVsTWV0aG9kczogdHJ1ZSxcbiAgICAgIGludGVyZmFjZUd1YXJkS2l0XG4gICAgfSlcbiAgKTtcbiAgaGFyZGVuKGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdDQpO1xuICBjb25zdCBkZWZpbmVEdXJhYmxlRXhvQ2xhc3M0ID0gKGtpbmRIYW5kbGUsIGludGVyZmFjZUd1YXJkLCBpbml0LCBtZXRob2RzLCBvcHRpb25zKSA9PiAoXG4gICAgLy9cbiAgICBkZWZpbmVEdXJhYmxlS2luZDQoa2luZEhhbmRsZSwgaW5pdCwgbWV0aG9kcywge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIHRoaXNmdWxNZXRob2RzOiB0cnVlLFxuICAgICAgaW50ZXJmYWNlR3VhcmRcbiAgICB9KVxuICApO1xuICBoYXJkZW4oZGVmaW5lRHVyYWJsZUV4b0NsYXNzNCk7XG4gIGNvbnN0IGRlZmluZUR1cmFibGVFeG9DbGFzc0tpdDQgPSAoa2luZEhhbmRsZSwgaW50ZXJmYWNlR3VhcmRLaXQsIGluaXQsIGZhY2V0cywgb3B0aW9ucykgPT4gKFxuICAgIC8vXG4gICAgZGVmaW5lRHVyYWJsZUtpbmRNdWx0aTQoa2luZEhhbmRsZSwgaW5pdCwgZmFjZXRzLCB7XG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgdGhpc2Z1bE1ldGhvZHM6IHRydWUsXG4gICAgICBpbnRlcmZhY2VHdWFyZEtpdFxuICAgIH0pXG4gICk7XG4gIGhhcmRlbihkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQ0KTtcbiAgY29uc3QgcHJlcGFyZUV4b0NsYXNzNCA9IChiYWdnYWdlLCBraW5kTmFtZSwgaW50ZXJmYWNlR3VhcmQsIGluaXQsIG1ldGhvZHMsIG9wdGlvbnMgPSB2b2lkIDApID0+IGRlZmluZUR1cmFibGVFeG9DbGFzczQoXG4gICAgcHJvdmlkZUtpbmRIYW5kbGU0KGJhZ2dhZ2UsIGtpbmROYW1lKSxcbiAgICBpbnRlcmZhY2VHdWFyZCxcbiAgICBpbml0LFxuICAgIG1ldGhvZHMsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUV4b0NsYXNzNCk7XG4gIGNvbnN0IHByZXBhcmVFeG9DbGFzc0tpdDQgPSAoYmFnZ2FnZSwga2luZE5hbWUsIGludGVyZmFjZUd1YXJkS2l0LCBpbml0LCBmYWNldHMsIG9wdGlvbnMgPSB2b2lkIDApID0+IGRlZmluZUR1cmFibGVFeG9DbGFzc0tpdDQoXG4gICAgcHJvdmlkZUtpbmRIYW5kbGU0KGJhZ2dhZ2UsIGtpbmROYW1lKSxcbiAgICBpbnRlcmZhY2VHdWFyZEtpdCxcbiAgICBpbml0LFxuICAgIGZhY2V0cyxcbiAgICBvcHRpb25zXG4gICk7XG4gIGhhcmRlbihwcmVwYXJlRXhvQ2xhc3NLaXQ0KTtcbiAgY29uc3QgcHJlcGFyZUV4bzQgPSAoYmFnZ2FnZSwga2luZE5hbWUsIGludGVyZmFjZUd1YXJkLCBtZXRob2RzLCBvcHRpb25zID0gdm9pZCAwKSA9PiB7XG4gICAgY29uc3QgbWFrZVNpbmdsZXRvbiA9IHByZXBhcmVFeG9DbGFzczQoXG4gICAgICBiYWdnYWdlLFxuICAgICAga2luZE5hbWUsXG4gICAgICBpbnRlcmZhY2VHdWFyZCxcbiAgICAgIGluaXRFbXB0eSxcbiAgICAgIG1ldGhvZHMsXG4gICAgICBvcHRpb25zXG4gICAgKTtcbiAgICByZXR1cm4gcHJvdmlkZShiYWdnYWdlLCBgJHtraW5kTmFtZX1fc2luZ2xldG9uYCwgKCkgPT4gbWFrZVNpbmdsZXRvbigpKTtcbiAgfTtcbiAgaGFyZGVuKHByZXBhcmVFeG80KTtcbiAgY29uc3QgcHJlcGFyZVNpbmdsZXRvbjQgPSAoYmFnZ2FnZSwga2luZE5hbWUsIG1ldGhvZHMsIG9wdGlvbnMgPSB2b2lkIDApID0+IHByZXBhcmVFeG80KGJhZ2dhZ2UsIGtpbmROYW1lLCB2b2lkIDAsIG1ldGhvZHMsIG9wdGlvbnMpO1xuICBoYXJkZW4ocHJlcGFyZVNpbmdsZXRvbjQpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3M6IGRlZmluZVZpcnR1YWxFeG9DbGFzczQsXG4gICAgZGVmaW5lVmlydHVhbEV4b0NsYXNzS2l0OiBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3NLaXQ0LFxuICAgIGRlZmluZUR1cmFibGVFeG9DbGFzczogZGVmaW5lRHVyYWJsZUV4b0NsYXNzNCxcbiAgICBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQ6IGRlZmluZUR1cmFibGVFeG9DbGFzc0tpdDQsXG4gICAgcHJlcGFyZUV4b0NsYXNzOiBwcmVwYXJlRXhvQ2xhc3M0LFxuICAgIHByZXBhcmVFeG9DbGFzc0tpdDogcHJlcGFyZUV4b0NsYXNzS2l0NCxcbiAgICBwcmVwYXJlRXhvOiBwcmVwYXJlRXhvNCxcbiAgICBwcmVwYXJlU2luZ2xldG9uOiBwcmVwYXJlU2luZ2xldG9uNCxcbiAgICBwcm92aWRlS2luZEhhbmRsZTogcHJvdmlkZUtpbmRIYW5kbGU0LFxuICAgIHByZXBhcmVLaW5kOiBwcmVwYXJlS2luZDQsXG4gICAgcHJlcGFyZUtpbmRNdWx0aTogcHJlcGFyZUtpbmRNdWx0aTRcbiAgfSk7XG59O1xudmFyIGdsb2JhbEV4b1V0aWxzID0gbWFrZUV4b1V0aWxzKFZhdERhdGFFeHBvcnQpO1xudmFyIHtcbiAgZGVmaW5lVmlydHVhbEV4b0NsYXNzLFxuICBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3NLaXQsXG4gIGRlZmluZUR1cmFibGVFeG9DbGFzcyxcbiAgZGVmaW5lRHVyYWJsZUV4b0NsYXNzS2l0LFxuICBwcmVwYXJlRXhvQ2xhc3MsXG4gIHByZXBhcmVFeG9DbGFzc0tpdCxcbiAgcHJlcGFyZUV4byxcbiAgcHJlcGFyZVNpbmdsZXRvblxufSA9IGdsb2JhbEV4b1V0aWxzO1xudmFyIHsgcHJvdmlkZUtpbmRIYW5kbGUsIHByZXBhcmVLaW5kLCBwcmVwYXJlS2luZE11bHRpIH0gPSBnbG9iYWxFeG9VdGlscztcblxuLy9cbnZhciBzaW5rMyA9ICgpID0+IHtcbn07XG52YXIgbWFrZVF1aWV0UmVqZWN0aW9uID0gKHJlYXNvbikgPT4ge1xuICBjb25zdCByZWplY3Rpb24gPSBoYXJkZW4oUHJvbWlzZS5yZWplY3QocmVhc29uKSk7XG4gIHZvaWQgRS53aGVuKHJlamVjdGlvbiwgc2luazMsIHNpbmszKTtcbiAgcmV0dXJuIHJlamVjdGlvbjtcbn07XG52YXIgdG9vRmFyUmVqZWN0aW9uID0gbWFrZVF1aWV0UmVqZWN0aW9uKFxuICBoYXJkZW4oRXJyb3IoXCJDYW5ub3QgcmVhZCBwYXN0IGVuZCBvZiBpdGVyYXRpb24uXCIpKVxuKTtcbnZhciBQdWJsaXNoZXJJID0gTS5pbnRlcmZhY2UoXCJQdWJsaXNoZXJcIiwge1xuICBwdWJsaXNoOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucygpLFxuICBmaW5pc2g6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKCksXG4gIGZhaWw6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKClcbn0pO1xudmFyIFVwZGF0ZUNvdW50U2hhcGUgPSBNLm9yKE0uYmlnaW50KCksIE0ubnVtYmVyKCkpO1xudmFyIFN1YnNjcmliZXJJID0gTS5pbnRlcmZhY2UoXCJTdWJzY3JpYmVyXCIsIHtcbiAgc3Vic2NyaWJlQWZ0ZXI6IE0uY2FsbCgpLm9wdGlvbmFsKE0uYmlnaW50KCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBnZXRVcGRhdGVTaW5jZTogTS5jYWxsKCkub3B0aW9uYWwoVXBkYXRlQ291bnRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSlcbn0pO1xudmFyIHB1Ymxpc2hLaXRJS2l0ID0gaGFyZGVuKHtcbiAgcHVibGlzaGVyOiBQdWJsaXNoZXJJLFxuICBzdWJzY3JpYmVyOiBTdWJzY3JpYmVySVxufSk7XG52YXIgRm9ya2FibGVBc3luY0l0ZXJhYmxlSXRlcmF0b3JTaGFwZSA9IE0uaW50ZXJmYWNlKFxuICBcIkZvcmthYmxlQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXCIsXG4gIHtcbiAgICBmb3JrOiBNLmNhbGwoKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06IE0uY2FsbCgpLnJldHVybnMoTS5hbnkoKSksXG4gICAgLy9cbiAgICBuZXh0OiBNLmNhbGxXaGVuKCkucmV0dXJucyhNLmFueSgpKVxuICB9XG4pO1xudmFyIEl0ZXJhYmxlRWFjaFRvcGljSSA9IE0uaW50ZXJmYWNlKFwiSXRlcmFibGVFYWNoVG9waWNcIiwge1xuICBzdWJzY3JpYmVBZnRlcjogZ2V0SW50ZXJmYWNlR3VhcmRQYXlsb2FkKFN1YnNjcmliZXJJKS5tZXRob2RHdWFyZHMuc3Vic2NyaWJlQWZ0ZXIsXG4gIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06IE0uY2FsbCgpLnJldHVybnMoXG4gICAgTS5yZW1vdGFibGUoXCJGb3JrYWJsZUFzeW5jSXRlcmFibGVJdGVyYXRvclwiKVxuICApXG59KTtcbnZhciBJdGVyYWJsZUxhdGVzdFRvcGljSSA9IE0uaW50ZXJmYWNlKFwiSXRlcmFibGVMYXRlc3RUb3BpY1wiLCB7XG4gIGdldFVwZGF0ZVNpbmNlOiBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQoU3Vic2NyaWJlckkpLm1ldGhvZEd1YXJkcy5nZXRVcGRhdGVTaW5jZSxcbiAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogTS5jYWxsKCkucmV0dXJucyhcbiAgICBNLnJlbW90YWJsZShcIkZvcmthYmxlQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXCIpXG4gIClcbn0pO1xudmFyIHdlYWtNZW1vaXplVW5hcnkgPSAoZm4pID0+IHtcbiAgY29uc3QgY2FjaGUgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgcmV0dXJuIChhcmcpID0+IHtcbiAgICBjb25zdCBvYXJnID0gYXJnO1xuICAgIGlmIChjYWNoZS5oYXMob2FyZykpIHtcbiAgICAgIHJldHVybiBjYWNoZS5nZXQob2FyZyk7XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdCA9IGZuKGFyZyk7XG4gICAgY2FjaGUuc2V0KG9hcmcsIHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbn07XG52YXIgbWFrZVVwZGF0ZVJlY29yZEZyb21QdWJsaWNhdGlvblJlY29yZCA9IChyZWNvcmQpID0+IHtcbiAgY29uc3Qge1xuICAgIGhlYWQ6IHsgdmFsdWUsIGRvbmUgfSxcbiAgICBwdWJsaXNoQ291bnRcbiAgfSA9IHJlY29yZDtcbiAgaWYgKGRvbmUpIHtcbiAgICByZXR1cm4gaGFyZGVuKHsgdmFsdWUsIHVwZGF0ZUNvdW50OiB2b2lkIDAgfSk7XG4gIH1cbiAgcmV0dXJuIGhhcmRlbih7IHZhbHVlLCB1cGRhdGVDb3VudDogcHVibGlzaENvdW50IH0pO1xufTtcbnZhciBtYWtlUHVibGlzaEtpdCA9ICgpID0+IHtcbiAgbGV0IHRhaWxQO1xuICBsZXQgdGFpbFI7XG4gICh7IHByb21pc2U6IHRhaWxQLCByZXNvbHZlOiB0YWlsUiB9ID0gbWFrZVByb21pc2VLaXQoKSk7XG4gIGxldCBjdXJyZW50UHVibGlzaENvdW50ID0gMG47XG4gIGxldCBjdXJyZW50UCA9IHRhaWxQO1xuICBjb25zdCBhZHZhbmNlQ3VycmVudCA9IChkb25lLCB2YWx1ZSwgcmVqZWN0aW9uKSA9PiB7XG4gICAgaWYgKHRhaWxSID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IEVycm9yKFwiQ2Fubm90IHVwZGF0ZSBzdGF0ZSBhZnRlciB0ZXJtaW5hdGlvbi5cIik7XG4gICAgfVxuICAgIGN1cnJlbnRQdWJsaXNoQ291bnQgKz0gMW47XG4gICAgY3VycmVudFAgPSB0YWlsUDtcbiAgICBjb25zdCByZXNvbHZlQ3VycmVudCA9IHRhaWxSO1xuICAgIGlmIChkb25lKSB7XG4gICAgICB0YWlsUCA9IHRvb0ZhclJlamVjdGlvbjtcbiAgICAgIHRhaWxSID0gdm9pZCAwO1xuICAgIH0gZWxzZSB7XG4gICAgICAoeyBwcm9taXNlOiB0YWlsUCwgcmVzb2x2ZTogdGFpbFIgfSA9IG1ha2VQcm9taXNlS2l0KCkpO1xuICAgIH1cbiAgICBpZiAocmVqZWN0aW9uKSB7XG4gICAgICByZXNvbHZlQ3VycmVudChyZWplY3Rpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNvbHZlQ3VycmVudChcbiAgICAgICAgaGFyZGVuKHtcbiAgICAgICAgICBoZWFkOiB7IHZhbHVlLCBkb25lIH0sXG4gICAgICAgICAgcHVibGlzaENvdW50OiBjdXJyZW50UHVibGlzaENvdW50LFxuICAgICAgICAgIHRhaWw6IHRhaWxQXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgbWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkID0gd2Vha01lbW9pemVVbmFyeShcbiAgICBtYWtlVXBkYXRlUmVjb3JkRnJvbVB1YmxpY2F0aW9uUmVjb3JkXG4gICk7XG4gIGNvbnN0IHN1YnNjcmliZXIgPSBGYXIoXCJTdWJzY3JpYmVyXCIsIHtcbiAgICBzdWJzY3JpYmVBZnRlcjogKHB1Ymxpc2hDb3VudCA9IC0xbikgPT4ge1xuICAgICAgYXNzZXJ0LnR5cGVvZihwdWJsaXNoQ291bnQsIFwiYmlnaW50XCIpO1xuICAgICAgaWYgKHB1Ymxpc2hDb3VudCA9PT0gY3VycmVudFB1Ymxpc2hDb3VudCkge1xuICAgICAgICByZXR1cm4gdGFpbFA7XG4gICAgICB9IGVsc2UgaWYgKHB1Ymxpc2hDb3VudCA8IGN1cnJlbnRQdWJsaXNoQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRQO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgXCJzdWJzY3JpYmVBZnRlciBhcmd1bWVudCBtdXN0IGJlIGEgcHJldmlvdXNseS1pc3N1ZWQgcHVibGlzaENvdW50LlwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSxcbiAgICBnZXRVcGRhdGVTaW5jZTogKHVwZGF0ZUNvdW50KSA9PiB7XG4gICAgICBpZiAodXBkYXRlQ291bnQgPT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4gc3Vic2NyaWJlci5zdWJzY3JpYmVBZnRlcigpLnRoZW4obWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkKTtcbiAgICAgIH1cbiAgICAgIHVwZGF0ZUNvdW50ID0gQmlnSW50KHVwZGF0ZUNvdW50KTtcbiAgICAgIHJldHVybiBzdWJzY3JpYmVyLnN1YnNjcmliZUFmdGVyKHVwZGF0ZUNvdW50KS50aGVuKCgpID0+IHN1YnNjcmliZXIuZ2V0VXBkYXRlU2luY2UoKSk7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgcHVibGlzaGVyID0gRmFyKFwiUHVibGlzaGVyXCIsIHtcbiAgICBwdWJsaXNoOiAodmFsdWUpID0+IHtcbiAgICAgIGFkdmFuY2VDdXJyZW50KGZhbHNlLCB2YWx1ZSk7XG4gICAgfSxcbiAgICBmaW5pc2g6IChmaW5hbFZhbHVlKSA9PiB7XG4gICAgICBhZHZhbmNlQ3VycmVudCh0cnVlLCBmaW5hbFZhbHVlKTtcbiAgICB9LFxuICAgIGZhaWw6IChyZWFzb24pID0+IHtcbiAgICAgIGFkdmFuY2VDdXJyZW50KHRydWUsIHZvaWQgMCwgbWFrZVF1aWV0UmVqZWN0aW9uKHJlYXNvbikpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oeyBwdWJsaXNoZXIsIHN1YnNjcmliZXIgfSk7XG59O1xuaGFyZGVuKG1ha2VQdWJsaXNoS2l0KTtcbnZhciBEdXJhYmxlUHVibGlzaEtpdFN0YXRlU2hhcGUgPSBoYXJkZW4oe1xuICB2YWx1ZUR1cmFiaWxpdHk6IE0uYW55KCksXG4gIHB1Ymxpc2hDb3VudDogTS5hbnkoKSxcbiAgc3RhdHVzOiBNLmFueSgpLFxuICBoYXNWYWx1ZTogTS5hbnkoKSxcbiAgdmFsdWU6IE0uYW55KClcbn0pO1xudmFyIGluaXREdXJhYmxlUHVibGlzaEtpdFN0YXRlID0gKG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7IHZhbHVlRHVyYWJpbGl0eSA9IFwibWFuZGF0b3J5XCIgfSA9IG9wdGlvbnM7XG4gIGFzc2VydC5lcXVhbCh2YWx1ZUR1cmFiaWxpdHksIFwibWFuZGF0b3J5XCIpO1xuICByZXR1cm4ge1xuICAgIC8vXG4gICAgdmFsdWVEdXJhYmlsaXR5LFxuICAgIC8vXG4gICAgcHVibGlzaENvdW50OiAwbixcbiAgICBzdGF0dXM6IFwibGl2ZVwiLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgaGFzVmFsdWU6IGZhbHNlLFxuICAgIHZhbHVlOiB2b2lkIDBcbiAgfTtcbn07XG52YXIgZ2V0RXBoZW1lcmFsS2V5ID0gKGZhY2V0cykgPT4gZmFjZXRzLnB1Ymxpc2hlcjtcbnZhciBkdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbnZhciBwcm92aWRlQ3VycmVudFAgPSAoc3RhdGUsIGZhY2V0cywgdGFpbCkgPT4ge1xuICBjb25zdCBlcGhlbWVyYWxLZXkgPSBnZXRFcGhlbWVyYWxLZXkoZmFjZXRzKTtcbiAgY29uc3QgZm91bmREYXRhID0gZHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhLmdldChlcGhlbWVyYWxLZXkpO1xuICBjb25zdCBjdXJyZW50UCA9IGZvdW5kRGF0YSAmJiBmb3VuZERhdGEuY3VycmVudFA7XG4gIGlmIChjdXJyZW50UCkge1xuICAgIHJldHVybiBjdXJyZW50UDtcbiAgfVxuICBjb25zdCB7IHB1Ymxpc2hDb3VudCwgc3RhdHVzLCBoYXNWYWx1ZSwgdmFsdWUgfSA9IHN0YXRlO1xuICBpZiAoIWhhc1ZhbHVlKSB7XG4gICAgYXNzZXJ0KHN0YXR1cyA9PT0gXCJsaXZlXCIpO1xuICAgIHJldHVybiB0YWlsO1xuICB9XG4gIGlmIChzdGF0dXMgPT09IFwibGl2ZVwiIHx8IHN0YXR1cyA9PT0gXCJmaW5pc2hlZFwiKSB7XG4gICAgY29uc3QgY2VsbCA9IGhhcmRlbih7XG4gICAgICBoZWFkOiB7IHZhbHVlLCBkb25lOiBzdGF0dXMgIT09IFwibGl2ZVwiIH0sXG4gICAgICBwdWJsaXNoQ291bnQsXG4gICAgICB0YWlsXG4gICAgfSk7XG4gICAgcmV0dXJuIEUucmVzb2x2ZShjZWxsKTtcbiAgfSBlbHNlIGlmIChzdGF0dXMgPT09IFwiZmFpbGVkXCIpIHtcbiAgICByZXR1cm4gbWFrZVF1aWV0UmVqZWN0aW9uKHZhbHVlKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEludmFsaWQgZHVyYWJsZSBwcm9taXNlIGtpdCBzdGF0dXM6ICR7cXVvdGUoc3RhdHVzKX1gO1xuICB9XG59O1xudmFyIHByb3ZpZGVEdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEgPSAoc3RhdGUsIGZhY2V0cykgPT4ge1xuICBjb25zdCBlcGhlbWVyYWxLZXkgPSBnZXRFcGhlbWVyYWxLZXkoZmFjZXRzKTtcbiAgY29uc3QgZm91bmREYXRhID0gZHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhLmdldChlcGhlbWVyYWxLZXkpO1xuICBpZiAoZm91bmREYXRhKSB7XG4gICAgcmV0dXJuIGZvdW5kRGF0YTtcbiAgfVxuICBjb25zdCB7IHN0YXR1cyB9ID0gc3RhdGU7XG4gIGxldCB0YWlsUDtcbiAgbGV0IHRhaWxSO1xuICBpZiAoc3RhdHVzID09PSBcImxpdmVcIikge1xuICAgICh7IHByb21pc2U6IHRhaWxQLCByZXNvbHZlOiB0YWlsUiB9ID0gbWFrZVByb21pc2VLaXQoKSk7XG4gICAgdm9pZCBFLndoZW4odGFpbFAsIHNpbmszLCBzaW5rMyk7XG4gIH0gZWxzZSBpZiAoc3RhdHVzID09PSBcImZpbmlzaGVkXCIgfHwgc3RhdHVzID09PSBcImZhaWxlZFwiKSB7XG4gICAgdGFpbFAgPSB0b29GYXJSZWplY3Rpb247XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBJbnZhbGlkIGR1cmFibGUgcHJvbWlzZSBraXQgc3RhdHVzOiAke3F1b3RlKHN0YXR1cyl9YDtcbiAgfVxuICBjb25zdCBvYmogPSBoYXJkZW4oeyBjdXJyZW50UDogdm9pZCAwLCB0YWlsUCwgdGFpbFIgfSk7XG4gIGR1cmFibGVQdWJsaXNoS2l0RXBoZW1lcmFsRGF0YS5zZXQoZXBoZW1lcmFsS2V5LCBvYmopO1xuICByZXR1cm4gb2JqO1xufTtcbnZhciBhZHZhbmNlRHVyYWJsZVB1Ymxpc2hLaXQgPSAoY29udGV4dCwgdmFsdWUsIHRhcmdldFN0YXR1cyA9IFwibGl2ZVwiKSA9PiB7XG4gIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gY29udGV4dDtcbiAgY29uc3QgeyB2YWx1ZUR1cmFiaWxpdHksIHN0YXR1cyB9ID0gc3RhdGU7XG4gIGlmIChzdGF0dXMgIT09IFwibGl2ZVwiKSB7XG4gICAgdGhyb3cgRXJyb3IoXCJDYW5ub3QgdXBkYXRlIHN0YXRlIGFmdGVyIHRlcm1pbmF0aW9uLlwiKTtcbiAgfVxuICBjb25zdCBkb25lID0gdGFyZ2V0U3RhdHVzICE9PSBcImxpdmVcIjtcbiAgaWYgKGRvbmUgfHwgdmFsdWVEdXJhYmlsaXR5ID09PSBcIm1hbmRhdG9yeVwiKSB7XG4gICAgY2FuQmVEdXJhYmxlKHZhbHVlKSB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCBhY2NlcHQgbm9uLWR1cmFibGUgdmFsdWU6ICR7dmFsdWV9YDtcbiAgfVxuICBjb25zdCB7IHRhaWxQOiBvbGRUYWlsUCwgdGFpbFI6IHJlc29sdmVPbGRUYWlsIH0gPSBwcm92aWRlRHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhKHN0YXRlLCBmYWNldHMpO1xuICBhc3NlcnQudHlwZW9mKHJlc29sdmVPbGRUYWlsLCBcImZ1bmN0aW9uXCIpO1xuICBjb25zdCBwdWJsaXNoQ291bnQgPSBzdGF0ZS5wdWJsaXNoQ291bnQgKyAxbjtcbiAgc3RhdGUucHVibGlzaENvdW50ID0gcHVibGlzaENvdW50O1xuICBsZXQgdGFpbFA7XG4gIGxldCB0YWlsUjtcbiAgaWYgKGRvbmUpIHtcbiAgICBzdGF0ZS5zdGF0dXMgPSB0YXJnZXRTdGF0dXM7XG4gICAgdGFpbFAgPSB0b29GYXJSZWplY3Rpb247XG4gICAgdGFpbFIgPSB2b2lkIDA7XG4gIH0gZWxzZSB7XG4gICAgKHsgcHJvbWlzZTogdGFpbFAsIHJlc29sdmU6IHRhaWxSIH0gPSBtYWtlUHJvbWlzZUtpdCgpKTtcbiAgICB2b2lkIEUud2hlbih0YWlsUCwgc2luazMsIHNpbmszKTtcbiAgfVxuICBsZXQgY3VycmVudFA7XG4gIGlmICh0YXJnZXRTdGF0dXMgPT09IFwiZmFpbGVkXCIpIHtcbiAgICBzdGF0ZS5oYXNWYWx1ZSA9IHRydWU7XG4gICAgc3RhdGUudmFsdWUgPSB2YWx1ZTtcbiAgICBjb25zdCByZWplY3Rpb24gPSBtYWtlUXVpZXRSZWplY3Rpb24odmFsdWUpO1xuICAgIHJlc29sdmVPbGRUYWlsKHJlamVjdGlvbik7XG4gIH0gZWxzZSB7XG4gICAgaWYgKGRvbmUgfHwgdmFsdWVEdXJhYmlsaXR5ICE9PSBcImlnbm9yZWRcIiAmJiBjYW5CZUR1cmFibGUodmFsdWUpKSB7XG4gICAgICBzdGF0ZS5oYXNWYWx1ZSA9IHRydWU7XG4gICAgICBzdGF0ZS52YWx1ZSA9IHZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdGF0ZS5oYXNWYWx1ZSA9IGZhbHNlO1xuICAgICAgc3RhdGUudmFsdWUgPSB2b2lkIDA7XG4gICAgICBjdXJyZW50UCA9IG9sZFRhaWxQO1xuICAgIH1cbiAgICByZXNvbHZlT2xkVGFpbChcbiAgICAgIGhhcmRlbih7XG4gICAgICAgIGhlYWQ6IHsgdmFsdWUsIGRvbmUgfSxcbiAgICAgICAgcHVibGlzaENvdW50LFxuICAgICAgICB0YWlsOiB0YWlsUFxuICAgICAgfSlcbiAgICApO1xuICB9XG4gIGR1cmFibGVQdWJsaXNoS2l0RXBoZW1lcmFsRGF0YS5zZXQoXG4gICAgZ2V0RXBoZW1lcmFsS2V5KGZhY2V0cyksXG4gICAgaGFyZGVuKHsgY3VycmVudFAsIHRhaWxQLCB0YWlsUiB9KVxuICApO1xufTtcbnZhciBwcmVwYXJlRHVyYWJsZVB1Ymxpc2hLaXQgPSAoYmFnZ2FnZSwga2luZE5hbWUpID0+IHtcbiAgY29uc3QgbWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkID0gbWFrZVVwZGF0ZVJlY29yZEZyb21QdWJsaWNhdGlvblJlY29yZDtcbiAgcmV0dXJuIHByZXBhcmVFeG9DbGFzc0tpdChcbiAgICBiYWdnYWdlLFxuICAgIGtpbmROYW1lLFxuICAgIHB1Ymxpc2hLaXRJS2l0LFxuICAgIGluaXREdXJhYmxlUHVibGlzaEtpdFN0YXRlLFxuICAgIHtcbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgcHVibGlzaGVyOiB7XG4gICAgICAgIHB1Ymxpc2godmFsdWUpIHtcbiAgICAgICAgICBhZHZhbmNlRHVyYWJsZVB1Ymxpc2hLaXQodGhpcywgdmFsdWUpO1xuICAgICAgICB9LFxuICAgICAgICBmaW5pc2goZmluYWxWYWx1ZSkge1xuICAgICAgICAgIGFkdmFuY2VEdXJhYmxlUHVibGlzaEtpdCh0aGlzLCBmaW5hbFZhbHVlLCBcImZpbmlzaGVkXCIpO1xuICAgICAgICB9LFxuICAgICAgICBmYWlsKHJlYXNvbikge1xuICAgICAgICAgIGFkdmFuY2VEdXJhYmxlUHVibGlzaEtpdCh0aGlzLCByZWFzb24sIFwiZmFpbGVkXCIpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICBzdWJzY3JpYmVyOiB7XG4gICAgICAgIHN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudCA9IC0xbikge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICBjb25zdCB7IHB1Ymxpc2hDb3VudDogY3VycmVudFB1Ymxpc2hDb3VudCB9ID0gc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyBjdXJyZW50UCwgdGFpbFAgfSA9IHByb3ZpZGVEdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEoXG4gICAgICAgICAgICBzdGF0ZSxcbiAgICAgICAgICAgIGZhY2V0c1xuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHB1Ymxpc2hDb3VudCA9PT0gY3VycmVudFB1Ymxpc2hDb3VudCkge1xuICAgICAgICAgICAgcmV0dXJuIHRhaWxQO1xuICAgICAgICAgIH0gZWxzZSBpZiAocHVibGlzaENvdW50IDwgY3VycmVudFB1Ymxpc2hDb3VudCkge1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRQIHx8IHByb3ZpZGVDdXJyZW50UChzdGF0ZSwgZmFjZXRzLCB0YWlsUCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICAgICBcInN1YnNjcmliZUFmdGVyIGFyZ3VtZW50IG11c3QgYmUgYSBwcmV2aW91c2x5LWlzc3VlZCBwdWJsaXNoQ291bnQuXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBnZXRVcGRhdGVTaW5jZSh1cGRhdGVDb3VudCkge1xuICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIGZhY2V0czogeyBzdWJzY3JpYmVyIH1cbiAgICAgICAgICB9ID0gdGhpcztcbiAgICAgICAgICBpZiAodXBkYXRlQ291bnQgPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgcmV0dXJuIHN1YnNjcmliZXIuc3Vic2NyaWJlQWZ0ZXIoKS50aGVuKG1ha2VNZW1vaXplZFVwZGF0ZVJlY29yZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHVwZGF0ZUNvdW50ID0gQmlnSW50KHVwZGF0ZUNvdW50KTtcbiAgICAgICAgICByZXR1cm4gc3Vic2NyaWJlci5zdWJzY3JpYmVBZnRlcih1cGRhdGVDb3VudCkudGhlbigoKSA9PiBzdWJzY3JpYmVyLmdldFVwZGF0ZVNpbmNlKCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBzdGF0ZVNoYXBlOiBEdXJhYmxlUHVibGlzaEtpdFN0YXRlU2hhcGVcbiAgICB9XG4gICk7XG59O1xuaGFyZGVuKHByZXBhcmVEdXJhYmxlUHVibGlzaEtpdCk7XG52YXIgU3Vic2NyaWJlclNoYXBlID0gTS5yZW1vdGFibGUoXCJTdWJzY3JpYmVyXCIpO1xuXG4vL1xudmFyIHsgaXNGcm96ZW46IGlzRnJvemVuOCB9ID0gT2JqZWN0O1xudmFyIFVwZ3JhZGVEaXNjb25uZWN0aW9uU2hhcGUzID0gaGFyZGVuKHtcbiAgbmFtZTogXCJ2YXRVcGdyYWRlZFwiLFxuICB1cGdyYWRlTWVzc2FnZTogTS5zdHJpbmcoKSxcbiAgaW5jYXJuYXRpb25OdW1iZXI6IE0ubnVtYmVyKClcbn0pO1xudmFyIG1ha2VVcGdyYWRlRGlzY29ubmVjdGlvbjMgPSAodXBncmFkZU1lc3NhZ2UsIHRvSW5jYXJuYXRpb25OdW1iZXIpID0+IGhhcmRlbih7XG4gIG5hbWU6IFwidmF0VXBncmFkZWRcIixcbiAgdXBncmFkZU1lc3NhZ2UsXG4gIGluY2FybmF0aW9uTnVtYmVyOiB0b0luY2FybmF0aW9uTnVtYmVyXG59KTtcbmhhcmRlbihtYWtlVXBncmFkZURpc2Nvbm5lY3Rpb24zKTtcbnZhciBpc1VwZ3JhZGVEaXNjb25uZWN0aW9uMyA9IChyZWFzb24pID0+IHJlYXNvbiAhPSBudWxsICYmIC8vXG5pc0Zyb3plbjgocmVhc29uKSAmJiBtYXRjaGVzKHJlYXNvbiwgVXBncmFkZURpc2Nvbm5lY3Rpb25TaGFwZTMpO1xuaGFyZGVuKGlzVXBncmFkZURpc2Nvbm5lY3Rpb24zKTtcbnZhciBpc0FiYW5kb25lZEVycm9yMyA9IChyZWFzb24pID0+IHJlYXNvbiAhPSBudWxsICYmIC8vXG5pc0Zyb3plbjgocmVhc29uKSAmJiBtYXRjaGVzKHJlYXNvbiwgTS5lcnJvcigpKSAmJiAvL1xuLy9cbnJlYXNvbi5tZXNzYWdlID09PSBcInZhdCB0ZXJtaW5hdGVkXCI7XG5oYXJkZW4oaXNBYmFuZG9uZWRFcnJvcjMpO1xuXG4vL1xudmFyIHNpbms0ID0gKCkgPT4ge1xufTtcbnZhciByZWNvbm5lY3RBc05lZWRlZCA9IGFzeW5jIChnZXR0ZXIsIHNlZWQgPSBbXSkgPT4ge1xuICBsZXQgZGlzY29ubmVjdGlvbjtcbiAgbGV0IGxhc3RWZXJzaW9uID0gLUluZmluaXR5O1xuICBhd2FpdCBudWxsO1xuICBmb3IgKGxldCBpMiA9IDA7IDsgaTIgKz0gMSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHRQID0gaTIgPCBzZWVkLmxlbmd0aCA/IHNlZWRbaTJdIDogZ2V0dGVyKCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXN1bHRQO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChpc1VwZ3JhZGVEaXNjb25uZWN0aW9uMyhlcnIpKSB7XG4gICAgICAgIGlmICghZGlzY29ubmVjdGlvbikge1xuICAgICAgICAgIGRpc2Nvbm5lY3Rpb24gPSBlcnI7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBpbmNhcm5hdGlvbk51bWJlcjogdmVyc2lvbiB9ID0gZXJyO1xuICAgICAgICBpZiAodmVyc2lvbiA+IGxhc3RWZXJzaW9uKSB7XG4gICAgICAgICAgbGFzdFZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIWlzUHJpbWl0aXZlMihlcnIpICYmIGRpc2Nvbm5lY3Rpb24gJiYgZGlzY29ubmVjdGlvbiAhPT0gZXJyKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgbm90ZShcbiAgICAgICAgICAgIGVycixcbiAgICAgICAgICAgIHJlZGFjdGVkYEF0dGVtcHRpbmcgdG8gcmVjb3ZlciBmcm9tIGRpc2Nvbm5lY3Rpb246ICR7ZGlzY29ubmVjdGlvbn1gXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBjYXRjaCAoX2Vycikge1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG59O1xudmFyIG1ha2VFYWNoSXRlcmF0b3IgPSAodG9waWMsIG5leHRDZWxsUCkgPT4ge1xuICBjb25zdCBzZWxmID0gRmFyKFwiRWFjaEl0ZXJhdG9yXCIsIHtcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiAoKSA9PiBzZWxmLFxuICAgIG5leHQ6ICgpID0+IHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgaGVhZDogcmVzdWx0UCxcbiAgICAgICAgcHVibGlzaENvdW50OiBwdWJsaXNoQ291bnRQLFxuICAgICAgICB0YWlsOiB0YWlsUFxuICAgICAgfSA9IEUuZ2V0KG5leHRDZWxsUCk7XG4gICAgICBjb25zdCBnZXRTdWNjZXNzb3IgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHB1Ymxpc2hDb3VudCA9IGF3YWl0IHB1Ymxpc2hDb3VudFA7XG4gICAgICAgIGFzc2VydC50eXBlb2YocHVibGlzaENvdW50LCBcImJpZ2ludFwiKTtcbiAgICAgICAgY29uc3Qgc3VjY2Vzc29yID0gYXdhaXQgRSh0b3BpYykuc3Vic2NyaWJlQWZ0ZXIocHVibGlzaENvdW50KTtcbiAgICAgICAgY29uc3QgbmV3UHVibGlzaENvdW50ID0gc3VjY2Vzc29yLnB1Ymxpc2hDb3VudDtcbiAgICAgICAgaWYgKG5ld1B1Ymxpc2hDb3VudCAhPT0gcHVibGlzaENvdW50ICsgMW4pIHtcbiAgICAgICAgICB0aHJvd1JlZGFjdGVkYGVhY2hJdGVyYXRvciBicm9rZW4gYnkgZ2FwIGZyb20gcHVibGlzaENvdW50ICR7cHVibGlzaENvdW50fSB0byAke25ld1B1Ymxpc2hDb3VudH1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdWNjZXNzb3I7XG4gICAgICB9O1xuICAgICAgbmV4dENlbGxQID0gcmVjb25uZWN0QXNOZWVkZWQoZ2V0U3VjY2Vzc29yLCBbdGFpbFBdKTtcbiAgICAgIHZvaWQgRS53aGVuKHB1Ymxpc2hDb3VudFAsIHNpbms0LCBzaW5rNCk7XG4gICAgICB2b2lkIEUud2hlbihuZXh0Q2VsbFAsIHNpbms0LCBzaW5rNCk7XG4gICAgICByZXR1cm4gcmVzdWx0UDtcbiAgICB9LFxuICAgIGZvcms6ICgpID0+IG1ha2VFYWNoSXRlcmF0b3IodG9waWMsIG5leHRDZWxsUClcbiAgfSk7XG4gIHJldHVybiBzZWxmO1xufTtcbnZhciBzdWJzY3JpYmVFYWNoID0gKHRvcGljKSA9PiB7XG4gIGNvbnN0IGl0ZXJhYmxlID0gRmFyKFwiRWFjaEl0ZXJhYmxlXCIsIHtcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBjb25zdCBmaXJzdENlbGxQID0gcmVjb25uZWN0QXNOZWVkZWQoKCkgPT4gRSh0b3BpYykuc3Vic2NyaWJlQWZ0ZXIoKSk7XG4gICAgICByZXR1cm4gbWFrZUVhY2hJdGVyYXRvcih0b3BpYywgZmlyc3RDZWxsUCk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGl0ZXJhYmxlO1xufTtcbmhhcmRlbihzdWJzY3JpYmVFYWNoKTtcbnZhciBjbG9uZUxhdGVzdEl0ZXJhdG9yID0gKHRvcGljLCBsb2NhbFVwZGF0ZUNvdW50LCB0ZXJtaW5hbFJlc3VsdCkgPT4ge1xuICBsZXQgbXV0ZXggPSBQcm9taXNlLnJlc29sdmUoKTtcbiAgY29uc3QgbWF5YmVSZXF1ZXN0TmV4dFJlc3VsdCA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAodGVybWluYWxSZXN1bHQpIHtcbiAgICAgIHJldHVybiB0ZXJtaW5hbFJlc3VsdDtcbiAgICB9XG4gICAgY29uc3QgeyB2YWx1ZSwgdXBkYXRlQ291bnQgfSA9IGF3YWl0IHJlY29ubmVjdEFzTmVlZGVkKFxuICAgICAgKCkgPT4gRSh0b3BpYykuZ2V0VXBkYXRlU2luY2UobG9jYWxVcGRhdGVDb3VudClcbiAgICApO1xuICAgIGxvY2FsVXBkYXRlQ291bnQgPSB1cGRhdGVDb3VudDtcbiAgICBpZiAodXBkYXRlQ291bnQgPT09IHZvaWQgMCkge1xuICAgICAgdGVybWluYWxSZXN1bHQgPSBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZSB9KTtcbiAgICAgIHJldHVybiB0ZXJtaW5hbFJlc3VsdDtcbiAgICB9XG4gICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IGZhbHNlLCB2YWx1ZSB9KTtcbiAgfTtcbiAgY29uc3Qgc2VsZiA9IEZhcihcIkxhdGVzdEl0ZXJhdG9yXCIsIHtcbiAgICBmb3JrOiAoKSA9PiBjbG9uZUxhdGVzdEl0ZXJhdG9yKHRvcGljLCBsb2NhbFVwZGF0ZUNvdW50LCB0ZXJtaW5hbFJlc3VsdCksXG4gICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogKCkgPT4gc2VsZixcbiAgICBuZXh0OiBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAodGVybWluYWxSZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuIHRlcm1pbmFsUmVzdWx0O1xuICAgICAgfVxuICAgICAgY29uc3QgbmV4dFJlc3VsdCA9IG11dGV4LnRoZW4obWF5YmVSZXF1ZXN0TmV4dFJlc3VsdCk7XG4gICAgICBtdXRleCA9IG5leHRSZXN1bHQudGhlbihzaW5rNCwgc2luazQpO1xuICAgICAgcmV0dXJuIG5leHRSZXN1bHQ7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHNlbGY7XG59O1xudmFyIG1ha2VMYXRlc3RJdGVyYXRvciA9ICh0b3BpYykgPT4gY2xvbmVMYXRlc3RJdGVyYXRvcih0b3BpYyk7XG52YXIgc3Vic2NyaWJlTGF0ZXN0ID0gKHRvcGljKSA9PiB7XG4gIGNvbnN0IGl0ZXJhYmxlID0gRmFyKFwiTGF0ZXN0SXRlcmFibGVcIiwge1xuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06ICgpID0+IG1ha2VMYXRlc3RJdGVyYXRvcih0b3BpYylcbiAgfSk7XG4gIHJldHVybiBpdGVyYWJsZTtcbn07XG5oYXJkZW4oc3Vic2NyaWJlTGF0ZXN0KTtcblxuLy9cbnZhciBtYWtlTm90aWZpZXIgPSAoc2hhcmFibGVJbnRlcm5hbHNQKSA9PiB7XG4gIGNvbnN0IG5vdGlmaWVyID0gRmFyKFwibm90aWZpZXJcIiwge1xuICAgIC4uLnN1YnNjcmliZUxhdGVzdChzaGFyYWJsZUludGVybmFsc1ApLFxuICAgIGdldFVwZGF0ZVNpbmNlOiBhc3luYyAodXBkYXRlQ291bnQpID0+IEUoc2hhcmFibGVJbnRlcm5hbHNQKS5nZXRVcGRhdGVTaW5jZSh1cGRhdGVDb3VudCksXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgIGdldFNoYXJhYmxlTm90aWZpZXJJbnRlcm5hbHM6IGFzeW5jICgpID0+IHNoYXJhYmxlSW50ZXJuYWxzUCxcbiAgICAvKlxuXG5cblxuICAgICAqL1xuICAgIGdldFN0b3JlS2V5OiAoKSA9PiBoYXJkZW4oeyBub3RpZmllciB9KVxuICB9KTtcbiAgcmV0dXJuIG5vdGlmaWVyO1xufTtcbnZhciBtYWtlTm90aWZpZXJGcm9tU3Vic2NyaWJlciA9IChzdWJzY3JpYmVyKSA9PiB7XG4gIGNvbnN0IGJhc2VOb3RpZmllciA9IGhhcmRlbih7XG4gICAgZ2V0VXBkYXRlU2luY2U6ICh1cGRhdGVDb3VudCA9IHZvaWQgMCkgPT4gRShzdWJzY3JpYmVyKS5nZXRVcGRhdGVTaW5jZSh1cGRhdGVDb3VudClcbiAgfSk7XG4gIGNvbnN0IG5vdGlmaWVyID0gRmFyKFwibm90aWZpZXJcIiwge1xuICAgIC4uLm1ha2VOb3RpZmllcihiYXNlTm90aWZpZXIpLFxuICAgIC4uLmJhc2VOb3RpZmllclxuICB9KTtcbiAgcmV0dXJuIG5vdGlmaWVyO1xufTtcbmhhcmRlbihtYWtlTm90aWZpZXJGcm9tU3Vic2NyaWJlcik7XG52YXIgbWFrZU5vdGlmaWVyS2l0ID0gKC4uLmluaXRpYWxTdGF0ZUFycikgPT4ge1xuICBjb25zdCB7IHB1Ymxpc2hlciwgc3Vic2NyaWJlciB9ID0gbWFrZVB1Ymxpc2hLaXQoKTtcbiAgY29uc3Qgbm90aWZpZXIgPSBtYWtlTm90aWZpZXJGcm9tU3Vic2NyaWJlcihzdWJzY3JpYmVyKTtcbiAgY29uc3QgdXBkYXRlciA9IEZhcihcInVwZGF0ZXJcIiwge1xuICAgIHVwZGF0ZVN0YXRlOiAoc3RhdGUpID0+IHB1Ymxpc2hlci5wdWJsaXNoKHN0YXRlKSxcbiAgICBmaW5pc2g6IChjb21wbGV0aW9uKSA9PiBwdWJsaXNoZXIuZmluaXNoKGNvbXBsZXRpb24pLFxuICAgIGZhaWw6IChyZWFzb24pID0+IHB1Ymxpc2hlci5mYWlsKHJlYXNvbilcbiAgfSk7XG4gIGFzc2VydDIoaW5pdGlhbFN0YXRlQXJyLmxlbmd0aCA8PSAxLCBcInRvbyBtYW55IGFyZ3VtZW50c1wiKTtcbiAgaWYgKGluaXRpYWxTdGF0ZUFyci5sZW5ndGggPT09IDEpIHtcbiAgICB1cGRhdGVyLnVwZGF0ZVN0YXRlKGluaXRpYWxTdGF0ZUFyclswXSk7XG4gIH1cbiAgcmV0dXJuIGhhcmRlbih7IG5vdGlmaWVyLCB1cGRhdGVyIH0pO1xufTtcbnZhciBtYWtlTm90aWZpZXJGcm9tQXN5bmNJdGVyYWJsZSA9IChhc3luY0l0ZXJhYmxlUCkgPT4ge1xuICBjb25zdCBpdGVyYXRvclAgPSBFKGFzeW5jSXRlcmFibGVQKVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKTtcbiAgbGV0IG9wdE5leHRQcm9taXNlO1xuICBsZXQgY3VycmVudFVwZGF0ZUNvdW50ID0gMG47XG4gIGxldCBjdXJyZW50UmVzcG9uc2U7XG4gIGxldCBmaW5hbCA9IGZhbHNlO1xuICBjb25zdCBiYXNlTm90aWZpZXIgPSBGYXIoXCJiYXNlTm90aWZpZXJcIiwge1xuICAgIGdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50ID0gLTFuKSB7XG4gICAgICBpZiAodXBkYXRlQ291bnQgPCBjdXJyZW50VXBkYXRlQ291bnQpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRSZXNwb25zZSkge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY3VycmVudFJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh1cGRhdGVDb3VudCAhPT0gY3VycmVudFVwZGF0ZUNvdW50KSB7XG4gICAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgIFwiZ2V0VXBkYXRlU2luY2UgYXJndW1lbnQgbXVzdCBiZSBhIHByZXZpb3VzbHktaXNzdWVkIHVwZGF0ZUNvdW50LlwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoZmluYWwpIHtcbiAgICAgICAgYXNzZXJ0MihjdXJyZW50UmVzcG9uc2UgIT09IHZvaWQgMCk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY3VycmVudFJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICAgIGlmICghb3B0TmV4dFByb21pc2UpIHtcbiAgICAgICAgY29uc3QgbmV4dEl0ZXJSZXN1bHRQID0gRShpdGVyYXRvclApLm5leHQoKTtcbiAgICAgICAgb3B0TmV4dFByb21pc2UgPSBFLndoZW4oXG4gICAgICAgICAgbmV4dEl0ZXJSZXN1bHRQLFxuICAgICAgICAgICh7IGRvbmUsIHZhbHVlIH0pID0+IHtcbiAgICAgICAgICAgIGFzc2VydDIoIWZpbmFsKTtcbiAgICAgICAgICAgIGlmIChkb25lKSB7XG4gICAgICAgICAgICAgIGZpbmFsID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1cnJlbnRVcGRhdGVDb3VudCArPSAxbjtcbiAgICAgICAgICAgIGN1cnJlbnRSZXNwb25zZSA9IGhhcmRlbih7XG4gICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICB1cGRhdGVDb3VudDogZG9uZSA/IHZvaWQgMCA6IGN1cnJlbnRVcGRhdGVDb3VudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBvcHROZXh0UHJvbWlzZSA9IHZvaWQgMDtcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50UmVzcG9uc2U7XG4gICAgICAgICAgfSxcbiAgICAgICAgICAoX3JlYXNvbikgPT4ge1xuICAgICAgICAgICAgZmluYWwgPSB0cnVlO1xuICAgICAgICAgICAgY3VycmVudFJlc3BvbnNlID0gLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICBuZXh0SXRlclJlc3VsdFA7XG4gICAgICAgICAgICBvcHROZXh0UHJvbWlzZSA9IHZvaWQgMDtcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50UmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG9wdE5leHRQcm9taXNlO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IG5vdGlmaWVyID0gRmFyKFwibm90aWZpZXJcIiwge1xuICAgIC8vXG4gICAgLy9cbiAgICAuLi5tYWtlTm90aWZpZXIoYmFzZU5vdGlmaWVyKSxcbiAgICAuLi5iYXNlTm90aWZpZXJcbiAgfSk7XG4gIHJldHVybiBub3RpZmllcjtcbn07XG5oYXJkZW4obWFrZU5vdGlmaWVyRnJvbUFzeW5jSXRlcmFibGUpO1xuXG4vL1xudmFyIG1ha2VQaW5uZWRIaXN0b3J5VG9waWMgPSAodG9waWMpID0+IHtcbiAgY29uc3QgcGlubmVkUHViTGlzdCA9IHRvcGljLnN1YnNjcmliZUFmdGVyKCk7XG4gIHJldHVybiBGYXIoXCJQaW5uZWRIaXN0b3J5VG9waWNcIiwge1xuICAgIHN1YnNjcmliZUFmdGVyOiBhc3luYyAocHVibGlzaENvdW50ID0gLTFuKSA9PiB7XG4gICAgICBpZiAocHVibGlzaENvdW50ID09PSAtMW4pIHtcbiAgICAgICAgcmV0dXJuIHBpbm5lZFB1Ykxpc3Q7XG4gICAgICB9XG4gICAgICByZXR1cm4gdG9waWMuc3Vic2NyaWJlQWZ0ZXIocHVibGlzaENvdW50KTtcbiAgICB9LFxuICAgIGdldFVwZGF0ZVNpbmNlOiBhc3luYyAodXBkYXRlQ291bnQgPSB2b2lkIDApID0+IHtcbiAgICAgIHJldHVybiB0b3BpYy5nZXRVcGRhdGVTaW5jZSh1cGRhdGVDb3VudCk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4obWFrZVBpbm5lZEhpc3RvcnlUb3BpYyk7XG5cbi8vXG52YXIgbWFrZVN1YnNjcmlwdGlvbiA9ICh0b3BpYykgPT4ge1xuICBjb25zdCBzdWJzY3JpcHRpb24gPSBGYXIoXCJTdWJzY3JpcHRpb25cIiwge1xuICAgIC4uLnN1YnNjcmliZUVhY2godG9waWMpLFxuICAgIHN1YnNjcmliZUFmdGVyOiBhc3luYyAocHVibGlzaENvdW50KSA9PiBFKHRvcGljKS5zdWJzY3JpYmVBZnRlcihwdWJsaXNoQ291bnQpLFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICBnZXRTaGFyYWJsZVN1YnNjcmlwdGlvbkludGVybmFsczogYXN5bmMgKCkgPT4gdG9waWMsXG4gICAgZ2V0U3RvcmVLZXk6ICgpID0+IGhhcmRlbih7IHN1YnNjcmlwdGlvbiB9KVxuICB9KTtcbiAgcmV0dXJuIHN1YnNjcmlwdGlvbjtcbn07XG5oYXJkZW4obWFrZVN1YnNjcmlwdGlvbik7XG52YXIgbWFrZVN1YnNjcmlwdGlvbktpdCA9ICgpID0+IHtcbiAgY29uc3QgeyBwdWJsaXNoZXIsIHN1YnNjcmliZXIgfSA9IG1ha2VQdWJsaXNoS2l0KCk7XG4gIGNvbnN0IHBpbm5lZEhpc3RvcnlUb3BpYyA9IG1ha2VQaW5uZWRIaXN0b3J5VG9waWMoc3Vic2NyaWJlcik7XG4gIGNvbnN0IHN1YnNjcmlwdGlvbiA9IG1ha2VTdWJzY3JpcHRpb24ocGlubmVkSGlzdG9yeVRvcGljKTtcbiAgY29uc3QgcHVibGljYXRpb24gPSBGYXIoXCJwdWJsaWNhdGlvblwiLCB7XG4gICAgdXBkYXRlU3RhdGU6IChub25GaW5hbFZhbHVlKSA9PiBwdWJsaXNoZXIucHVibGlzaChub25GaW5hbFZhbHVlKSxcbiAgICBmaW5pc2g6IChjb21wbGV0aW9uKSA9PiBwdWJsaXNoZXIuZmluaXNoKGNvbXBsZXRpb24pLFxuICAgIGZhaWw6IChyZWFzb24pID0+IHB1Ymxpc2hlci5mYWlsKHJlYXNvbilcbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oeyBwdWJsaWNhdGlvbiwgc3Vic2NyaXB0aW9uIH0pO1xufTtcbmhhcmRlbihtYWtlU3Vic2NyaXB0aW9uS2l0KTtcblxuLy9cbnZhciBvYnNlcnZlSXRlcmF0b3IgPSAoYXN5bmNJdGVyYXRvclAsIGl0ZXJhdGlvbk9ic2VydmVyKSA9PiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgoYWNrLCBvYnNlcnZlckVycm9yKSA9PiB7XG4gICAgY29uc3QgcmVjdXIgPSAoKSA9PiB7XG4gICAgICBFLndoZW4oXG4gICAgICAgIEUoYXN5bmNJdGVyYXRvclApLm5leHQoKSxcbiAgICAgICAgKHsgdmFsdWUsIGRvbmUgfSkgPT4ge1xuICAgICAgICAgIGlmIChkb25lKSB7XG4gICAgICAgICAgICBpdGVyYXRpb25PYnNlcnZlci5maW5pc2ggJiYgaXRlcmF0aW9uT2JzZXJ2ZXIuZmluaXNoKHZhbHVlKTtcbiAgICAgICAgICAgIGFjayh2b2lkIDApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpdGVyYXRpb25PYnNlcnZlci51cGRhdGVTdGF0ZSAmJiBpdGVyYXRpb25PYnNlcnZlci51cGRhdGVTdGF0ZSh2YWx1ZSk7XG4gICAgICAgICAgICByZWN1cigpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgKHJlYXNvbikgPT4ge1xuICAgICAgICAgIGl0ZXJhdGlvbk9ic2VydmVyLmZhaWwgJiYgaXRlcmF0aW9uT2JzZXJ2ZXIuZmFpbChyZWFzb24pO1xuICAgICAgICAgIGFjayh2b2lkIDApO1xuICAgICAgICB9XG4gICAgICApLmNhdGNoKG9ic2VydmVyRXJyb3IpO1xuICAgIH07XG4gICAgcmVjdXIoKTtcbiAgfSk7XG59O1xudmFyIG9ic2VydmVJdGVyYXRpb24gPSAoYXN5bmNJdGVyYWJsZVAsIGl0ZXJhdGlvbk9ic2VydmVyKSA9PiB7XG4gIGNvbnN0IGl0ZXJhdG9yUCA9IEUoYXN5bmNJdGVyYWJsZVApW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpO1xuICByZXR1cm4gb2JzZXJ2ZUl0ZXJhdG9yKGl0ZXJhdG9yUCwgaXRlcmF0aW9uT2JzZXJ2ZXIpO1xufTtcblxuLy9cbnZhciBmb3JFYWNoUHVibGljYXRpb25SZWNvcmQgPSBhc3luYyAoc3Vic2NyaWJlciwgY29uc3VtZVZhbHVlKSA9PiB7XG4gIGNvbnN0IGl0ZXJhdG9yID0gc3Vic2NyaWJlRWFjaChzdWJzY3JpYmVyKVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKTtcbiAgbGV0IGZpbmlzaGVkID0gZmFsc2U7XG4gIGF3YWl0IG51bGw7XG4gIHdoaWxlICghZmluaXNoZWQpIHtcbiAgICBjb25zdCB7IHZhbHVlLCBkb25lIH0gPSBhd2FpdCBpdGVyYXRvci5uZXh0KCk7XG4gICAgYXdhaXQgY29uc3VtZVZhbHVlKHZhbHVlKTtcbiAgICBmaW5pc2hlZCA9ICEhZG9uZTtcbiAgfVxufTtcbnZhciBtYWtlU3RvcmVkU3Vic2NyaWJlciA9IChzdWJzY3JpYmVyLCBzdG9yYWdlTm9kZSwgbWFyc2hhbGxlcikgPT4ge1xuICBhc3NlcnRBbGxEZWZpbmVkKHsgc3Vic2NyaWJlciwgc3RvcmFnZU5vZGUsIG1hcnNoYWxsZXIgfSk7XG4gIGNvbnN0IG1hcnNoYWxsVG9TdG9yYWdlID0gbWFrZVNlcmlhbGl6ZVRvU3RvcmFnZShzdG9yYWdlTm9kZSwgbWFyc2hhbGxlcik7XG4gIGZvckVhY2hQdWJsaWNhdGlvblJlY29yZChzdWJzY3JpYmVyLCBtYXJzaGFsbFRvU3RvcmFnZSkuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJTdG9yZWRTdWJzY3JpYmVyIGZhaWxlZCB0byBpdGVyYXRlXCIsIGVycik7XG4gIH0pO1xuICBjb25zdCB1bnNlcmlhbGl6ZXIgPSBGYXIoXCJ1bnNlcmlhbGl6ZXJcIiwge1xuICAgIGZyb21DYXBEYXRhOiAoZGF0YSkgPT4gRShtYXJzaGFsbGVyKS5mcm9tQ2FwRGF0YShkYXRhKSxcbiAgICB1bnNlcmlhbGl6ZTogKGRhdGEpID0+IEUobWFyc2hhbGxlcikuZnJvbUNhcERhdGEoZGF0YSlcbiAgfSk7XG4gIGNvbnN0IHN0b3Jlc3ViID0gRmFyKFwiU3RvcmVkU3Vic2NyaWJlclwiLCB7XG4gICAgc3Vic2NyaWJlQWZ0ZXI6IChwdWJsaXNoQ291bnQpID0+IHN1YnNjcmliZXIuc3Vic2NyaWJlQWZ0ZXIocHVibGlzaENvdW50KSxcbiAgICBnZXRVcGRhdGVTaW5jZTogKHVwZGF0ZUNvdW50KSA9PiBzdWJzY3JpYmVyLmdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50KSxcbiAgICBnZXRQYXRoOiAoKSA9PiBFKHN0b3JhZ2VOb2RlKS5nZXRQYXRoKCksXG4gICAgZ2V0U3RvcmVLZXk6ICgpID0+IEUoc3RvcmFnZU5vZGUpLmdldFN0b3JlS2V5KCksXG4gICAgZ2V0VW5zZXJpYWxpemVyOiAoKSA9PiB1bnNlcmlhbGl6ZXJcbiAgfSk7XG4gIHJldHVybiBzdG9yZXN1Yjtcbn07XG52YXIgbWFrZVN0b3JlZFN1YnNjcmlwdGlvbiA9IChzdWJzY3JpcHRpb24sIHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyID0gbWFrZU1hcnNoYWwodm9pZCAwLCB2b2lkIDAsIHtcbiAgbWFyc2hhbFNhdmVFcnJvcjogKCkgPT4ge1xuICB9LFxuICBzZXJpYWxpemVCb2R5Rm9ybWF0OiBcInNtYWxsY2Fwc1wiXG59KSkgPT4ge1xuICBjb25zdCB1bnNlcmlhbGl6ZXIgPSBGYXIoXCJ1bnNlcmlhbGl6ZXJcIiwge1xuICAgIGZyb21DYXBEYXRhOiAoZGF0YSkgPT4gRShtYXJzaGFsbGVyKS5mcm9tQ2FwRGF0YShkYXRhKSxcbiAgICB1bnNlcmlhbGl6ZTogKGRhdGEpID0+IEUobWFyc2hhbGxlcikuZnJvbUNhcERhdGEoZGF0YSlcbiAgfSk7XG4gIGxldCBwdWJsaXNoRmFpbGVkID0gZmFsc2U7XG4gIGxldCBwdWJsaXNoRXhjZXB0aW9uO1xuICBjb25zdCBmYWlsID0gKGVycikgPT4ge1xuICAgIHB1Ymxpc2hGYWlsZWQgPSB0cnVlO1xuICAgIHB1Ymxpc2hFeGNlcHRpb24gPSBlcnI7XG4gIH07XG4gIGNvbnN0IHB1Ymxpc2hWYWx1ZSA9IChvYmopID0+IHtcbiAgICBhc3NlcnQoc3RvcmFnZU5vZGUpO1xuICAgIGlmIChwdWJsaXNoRmFpbGVkKSB7XG4gICAgICB0aHJvdyBwdWJsaXNoRXhjZXB0aW9uO1xuICAgIH1cbiAgICBFKG1hcnNoYWxsZXIpLnRvQ2FwRGF0YShvYmopLnRoZW4oKHNlcmlhbGl6ZWQpID0+IHtcbiAgICAgIGNvbnN0IGVuY29kZWQgPSBKU09OLnN0cmluZ2lmeShzZXJpYWxpemVkKTtcbiAgICAgIHJldHVybiBFKHN0b3JhZ2VOb2RlKS5zZXRWYWx1ZShlbmNvZGVkKTtcbiAgICB9KS5jYXRjaChmYWlsKTtcbiAgfTtcbiAgaWYgKHN0b3JhZ2VOb2RlKSB7XG4gICAgb2JzZXJ2ZUl0ZXJhdGlvbihzdWJzY3JpcHRpb24sIHtcbiAgICAgIHVwZGF0ZVN0YXRlOiBwdWJsaXNoVmFsdWUsXG4gICAgICBmaW5pc2g6IHB1Ymxpc2hWYWx1ZVxuICAgIH0pLmNhdGNoKGZhaWwpO1xuICB9XG4gIGNvbnN0IHN0b3Jlc3ViID0gRmFyKFwiU3RvcmVkU3Vic2NyaXB0aW9uXCIsIHtcbiAgICAvL1xuICAgIGdldFN0b3JlS2V5OiBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIXN0b3JhZ2VOb2RlKSB7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBzdWJzY3JpcHRpb24gfSk7XG4gICAgICB9XG4gICAgICBjb25zdCBzdG9yZUtleSA9IGF3YWl0IEUoc3RvcmFnZU5vZGUpLmdldFN0b3JlS2V5KCk7XG4gICAgICByZXR1cm4gaGFyZGVuKHsgLi4uc3RvcmVLZXksIHN1YnNjcmlwdGlvbiB9KTtcbiAgICB9LFxuICAgIGdldFVuc2VyaWFsaXplcjogKCkgPT4gdW5zZXJpYWxpemVyLFxuICAgIGdldFNoYXJhYmxlU3Vic2NyaXB0aW9uSW50ZXJuYWxzOiAoKSA9PiBzdWJzY3JpcHRpb24uZ2V0U2hhcmFibGVTdWJzY3JpcHRpb25JbnRlcm5hbHMoKSxcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiAoKSA9PiBzdWJzY3JpcHRpb25bU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCksXG4gICAgc3Vic2NyaWJlQWZ0ZXI6IChwdWJsaXNoQ291bnQpID0+IHN1YnNjcmlwdGlvbi5zdWJzY3JpYmVBZnRlcihwdWJsaXNoQ291bnQpXG4gIH0pO1xuICByZXR1cm4gc3RvcmVzdWI7XG59O1xuaGFyZGVuKG1ha2VTdG9yZWRTdWJzY3JpcHRpb24pO1xudmFyIG1ha2VTdG9yZWRQdWJsaXNoS2l0ID0gKHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyKSA9PiB7XG4gIGNvbnN0IHsgcHVibGlzaGVyLCBzdWJzY3JpYmVyIH0gPSBtYWtlUHVibGlzaEtpdCgpO1xuICByZXR1cm4ge1xuICAgIHB1Ymxpc2hlcixcbiAgICAvL1xuICAgIHN1YnNjcmliZXI6IG1ha2VTdG9yZWRTdWJzY3JpYmVyKHN1YnNjcmliZXIsIHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyKVxuICB9O1xufTtcbmhhcmRlbihtYWtlU3RvcmVkUHVibGlzaEtpdCk7XG5cbi8vXG52YXIgZXZlbnRMb29wSXRlcmF0aW9uID0gYXN5bmMgKCkgPT4gbmV3IFByb21pc2UoKHJlc29sdmUyKSA9PiBzZXRJbW1lZGlhdGUocmVzb2x2ZTIpKTtcbmhhcmRlbihldmVudExvb3BJdGVyYXRpb24pO1xudmFyIHN0cmluZ09yVGFnID0gKHZhbHVlKSA9PiB7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIFN5bWJvbC50b1N0cmluZ1RhZyBpbiB2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZVtTeW1ib2wudG9TdHJpbmdUYWddO1xuICB9XG4gIHJldHVybiBTdHJpbmcodmFsdWUpO1xufTtcbnZhciBpbnNwZWN0TWFwU3RvcmUgPSAoc3RvcmUpID0+IHtcbiAgY29uc3Qgb2JqID0ge307XG4gIGZvciAoY29uc3Qga2V5IG9mIHN0b3JlLmtleXMoKSkge1xuICAgIGNvbnN0IHZhbHVlID0gc3RvcmUuZ2V0KGtleSk7XG4gICAgY29uc3QgaGFzS2V5cyA9IHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIiAmJiBcImtleXNcIiBpbiB2YWx1ZTtcbiAgICBjb25zdCBpbmRleCA9IHN0cmluZ09yVGFnKGtleSk7XG4gICAgaWYgKGhhc0tleXMgJiYgXCJnZXRcIiBpbiB2YWx1ZSkge1xuICAgICAgb2JqW2luZGV4XSA9IGluc3BlY3RNYXBTdG9yZSh2YWx1ZSk7XG4gICAgfSBlbHNlIGlmIChoYXNLZXlzKSB7XG4gICAgICBvYmpbaW5kZXhdID0gQXJyYXkuZnJvbSh2YWx1ZS5rZXlzKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBvYmpbaW5kZXhdID0gdmFsdWUgaW5zdGFuY2VvZiBPYmplY3QgJiYgU3ltYm9sLnRvU3RyaW5nVGFnIGluIHZhbHVlID8gdmFsdWVbU3ltYm9sLnRvU3RyaW5nVGFnXSA6IHZhbHVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gb2JqO1xufTtcbmhhcmRlbihpbnNwZWN0TWFwU3RvcmUpO1xuXG4vL1xudmFyIG1ha2VGYWtlU3RvcmFnZSA9IChwYXRoLCBwdWJsaWNhdGlvbikgPT4ge1xuICBsZXQgc2V0VmFsdWVDYWxscyA9IDA7XG4gIGNvbnN0IGZ1bGxQYXRoID0gYHB1Ymxpc2guJHtwYXRofWA7XG4gIGNvbnN0IHN0b3JlS2V5ID0gaGFyZGVuKHtcbiAgICBzdG9yZU5hbWU6IFwic3dpbmdzZXRcIixcbiAgICBzdG9yZVN1YmtleTogYHN3aW5nc2V0L2RhdGE6JHtmdWxsUGF0aH1gLFxuICAgIGRhdGFQcmVmaXhCeXRlczogXCJcIlxuICB9KTtcbiAgY29uc3Qgc3RvcmFnZSA9IEZhcihcIlN0b3JhZ2VOb2RlXCIsIHtcbiAgICBnZXRQYXRoOiAoKSA9PiBwYXRoLFxuICAgIGdldFN0b3JlS2V5OiBhc3luYyAoKSA9PiBzdG9yZUtleSxcbiAgICBzZXRWYWx1ZTogYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICBzZXRWYWx1ZUNhbGxzICs9IDE7XG4gICAgICBhc3NlcnQudHlwZW9mKHZhbHVlLCBcInN0cmluZ1wiKTtcbiAgICAgIGlmIChwdWJsaWNhdGlvbikge1xuICAgICAgICBwdWJsaWNhdGlvbi51cGRhdGVTdGF0ZSh2YWx1ZSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBtYWtlQ2hpbGROb2RlOiAoKSA9PiBzdG9yYWdlLFxuICAgIGNvdW50U2V0VmFsdWVDYWxsczogKCkgPT4gc2V0VmFsdWVDYWxsc1xuICB9KTtcbiAgcmV0dXJuIHN0b3JhZ2U7XG59O1xuaGFyZGVuKG1ha2VGYWtlU3RvcmFnZSk7XG52YXIgbWFrZUZha2VNYXJzaGFsbGVyID0gKCkgPT4gbWFrZU1hcnNoYWwodm9pZCAwLCB2b2lkIDAsIHtcbiAgbWFyc2hhbFNhdmVFcnJvcjogKCkgPT4ge1xuICB9XG59KTtcbmhhcmRlbihtYWtlRmFrZU1hcnNoYWxsZXIpO1xuXG4vL1xudmFyIHByZXBhcmVSZWNvcmRlciA9IChiYWdnYWdlLCBtYXJzaGFsbGVyKSA9PiB7XG4gIGNvbnN0IG1ha2VSZWNvcmRlciA9IHByZXBhcmVFeG9DbGFzcyhcbiAgICBiYWdnYWdlLFxuICAgIFwiUmVjb3JkZXJcIixcbiAgICBNLmludGVyZmFjZShcIlJlY29yZGVyXCIsIHtcbiAgICAgIGdldFN0b3JhZ2VOb2RlOiBNLmNhbGwoKS5yZXR1cm5zKFN0b3JhZ2VOb2RlU2hhcGUpLFxuICAgICAgZ2V0U3RvcmFnZVBhdGg6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKFxuICAgICAgICAvKiAgICAgICAgKi9cbiAgICAgICkpLFxuICAgICAgd3JpdGU6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgIHdyaXRlRmluYWw6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICAgIH0pLFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICAocHVibGlzaGVyLCBzdG9yYWdlTm9kZSwgdmFsdWVTaGFwZSA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBNLmFueSgpXG4gICAgKSkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY2xvc2VkOiBmYWxzZSxcbiAgICAgICAgcHVibGlzaGVyLFxuICAgICAgICBzdG9yYWdlTm9kZSxcbiAgICAgICAgc3RvcmFnZVBhdGg6IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICB2b2lkIDBcbiAgICAgICAgKSxcbiAgICAgICAgdmFsdWVTaGFwZVxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIGdldFN0b3JhZ2VOb2RlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5zdG9yYWdlTm9kZTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICBhc3luYyBnZXRTdG9yYWdlUGF0aCgpIHtcbiAgICAgICAgY29uc3QgeyBzdG9yYWdlUGF0aDogaGVsZFBhdGggfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGF3YWl0IG51bGw7XG4gICAgICAgIGlmIChoZWxkUGF0aCAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgcmV0dXJuIGhlbGRQYXRoO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhdGggPSBhd2FpdCBFKHRoaXMuc3RhdGUuc3RvcmFnZU5vZGUpLmdldFBhdGgoKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5zdG9yYWdlUGF0aCA9IHBhdGg7XG4gICAgICAgIHJldHVybiBwYXRoO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgYXN5bmMgd3JpdGUodmFsdWUpIHtcbiAgICAgICAgY29uc3QgeyBjbG9zZWQsIHB1Ymxpc2hlciwgc3RvcmFnZU5vZGUsIHZhbHVlU2hhcGUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICFjbG9zZWQgfHwgdGhyb3dSZWRhY3RlZGBjYW5ub3Qgd3JpdGUgdG8gY2xvc2VkIHJlY29yZGVyYDtcbiAgICAgICAgbXVzdE1hdGNoMih2YWx1ZSwgdmFsdWVTaGFwZSk7XG4gICAgICAgIGNvbnN0IGVuY29kZWQgPSBhd2FpdCBFKG1hcnNoYWxsZXIpLnRvQ2FwRGF0YSh2YWx1ZSk7XG4gICAgICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSBKU09OLnN0cmluZ2lmeShlbmNvZGVkKTtcbiAgICAgICAgYXdhaXQgRShzdG9yYWdlTm9kZSkuc2V0VmFsdWUoc2VyaWFsaXplZCk7XG4gICAgICAgIHJldHVybiBwdWJsaXNoZXIucHVibGlzaCh2YWx1ZSk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuICAgICAgICovXG4gICAgICBhc3luYyB3cml0ZUZpbmFsKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHsgY2xvc2VkLCBwdWJsaXNoZXIsIHN0b3JhZ2VOb2RlLCB2YWx1ZVNoYXBlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAhY2xvc2VkIHx8IHRocm93UmVkYWN0ZWRgY2Fubm90IHdyaXRlIHRvIGNsb3NlZCByZWNvcmRlcmA7XG4gICAgICAgIG11c3RNYXRjaDIodmFsdWUsIHZhbHVlU2hhcGUpO1xuICAgICAgICBjb25zdCBlbmNvZGVkID0gYXdhaXQgRShtYXJzaGFsbGVyKS50b0NhcERhdGEodmFsdWUpO1xuICAgICAgICBjb25zdCBzZXJpYWxpemVkID0gSlNPTi5zdHJpbmdpZnkoZW5jb2RlZCk7XG4gICAgICAgIGF3YWl0IEUoc3RvcmFnZU5vZGUpLnNldFZhbHVlKHNlcmlhbGl6ZWQpO1xuICAgICAgICB0aGlzLnN0YXRlLmNsb3NlZCA9IHRydWU7XG4gICAgICAgIHJldHVybiBwdWJsaXNoZXIuZmluaXNoKHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiBtYWtlUmVjb3JkZXI7XG59O1xuaGFyZGVuKHByZXBhcmVSZWNvcmRlcik7XG52YXIgZGVmaW5lUmVjb3JkZXJLaXQgPSAoeyBtYWtlUmVjb3JkZXIsIG1ha2VEdXJhYmxlUHVibGlzaEtpdCB9KSA9PiB7XG4gIGNvbnN0IG1ha2VSZWNvcmRlcktpdCA9IChzdG9yYWdlTm9kZSwgdmFsdWVTaGFwZSkgPT4ge1xuICAgIGNvbnN0IHsgc3Vic2NyaWJlciwgcHVibGlzaGVyIH0gPSBtYWtlRHVyYWJsZVB1Ymxpc2hLaXQoKTtcbiAgICBjb25zdCByZWNvcmRlciA9IG1ha2VSZWNvcmRlcihcbiAgICAgIHB1Ymxpc2hlcixcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBzdG9yYWdlTm9kZSxcbiAgICAgIHZhbHVlU2hhcGVcbiAgICApO1xuICAgIHJldHVybiBoYXJkZW4oeyBzdWJzY3JpYmVyLCByZWNvcmRlciB9KTtcbiAgfTtcbiAgcmV0dXJuIG1ha2VSZWNvcmRlcktpdDtcbn07XG52YXIgZGVmaW5lRVJlY29yZGVyS2l0ID0gKHsgbWFrZVJlY29yZGVyLCBtYWtlRHVyYWJsZVB1Ymxpc2hLaXQgfSkgPT4ge1xuICBjb25zdCBtYWtlRVJlY29yZGVyS2l0ID0gKHN0b3JhZ2VOb2RlUCwgdmFsdWVTaGFwZSkgPT4ge1xuICAgIGNvbnN0IHsgcHVibGlzaGVyLCBzdWJzY3JpYmVyIH0gPSBtYWtlRHVyYWJsZVB1Ymxpc2hLaXQoKTtcbiAgICBjb25zdCByZWNvcmRlclAgPSBFLndoZW4oXG4gICAgICBzdG9yYWdlTm9kZVAsXG4gICAgICAoc3RvcmFnZU5vZGUpID0+IG1ha2VSZWNvcmRlcihcbiAgICAgICAgcHVibGlzaGVyLFxuICAgICAgICAvL1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBzdG9yYWdlTm9kZSxcbiAgICAgICAgdmFsdWVTaGFwZVxuICAgICAgKVxuICAgICk7XG4gICAgcmV0dXJuIHsgc3Vic2NyaWJlciwgcmVjb3JkZXJQIH07XG4gIH07XG4gIHJldHVybiBtYWtlRVJlY29yZGVyS2l0O1xufTtcbmhhcmRlbihkZWZpbmVFUmVjb3JkZXJLaXQpO1xudmFyIHByZXBhcmVSZWNvcmRlcktpdE1ha2VycyA9IChiYWdnYWdlLCBtYXJzaGFsbGVyKSA9PiB7XG4gIGNvbnN0IG1ha2VEdXJhYmxlUHVibGlzaEtpdCA9IHByZXBhcmVEdXJhYmxlUHVibGlzaEtpdChcbiAgICBiYWdnYWdlLFxuICAgIFwiRHVyYWJsZSBQdWJsaXNoIEtpdFwiXG4gICk7XG4gIGNvbnN0IG1ha2VSZWNvcmRlciA9IHByZXBhcmVSZWNvcmRlcihiYWdnYWdlLCBtYXJzaGFsbGVyKTtcbiAgY29uc3QgbWFrZVJlY29yZGVyS2l0ID0gZGVmaW5lUmVjb3JkZXJLaXQoe1xuICAgIG1ha2VSZWNvcmRlcixcbiAgICBtYWtlRHVyYWJsZVB1Ymxpc2hLaXRcbiAgfSk7XG4gIGNvbnN0IG1ha2VFUmVjb3JkZXJLaXQgPSBkZWZpbmVFUmVjb3JkZXJLaXQoe1xuICAgIG1ha2VSZWNvcmRlcixcbiAgICBtYWtlRHVyYWJsZVB1Ymxpc2hLaXRcbiAgfSk7XG4gIHJldHVybiB7XG4gICAgbWFrZUR1cmFibGVQdWJsaXNoS2l0LFxuICAgIG1ha2VSZWNvcmRlcixcbiAgICBtYWtlUmVjb3JkZXJLaXQsXG4gICAgbWFrZUVSZWNvcmRlcktpdFxuICB9O1xufTtcbnZhciBSZWNvcmRlcktpdFNoYXBlID0ge1xuICByZWNvcmRlcjogTS5yZW1vdGFibGUoKSxcbiAgc3Vic2NyaWJlcjogTS5yZW1vdGFibGUoKVxufTtcbmhhcmRlbihSZWNvcmRlcktpdFNoYXBlKTtcblxuLy9cbnZhciBtYWtlV2Vha1NldFN0b3JlTWV0aG9kczQgPSAoanNzZXQsIGFzc2VydEtleU9rVG9BZGQsIGFzc2VydEtleU9rVG9EZWxldGUgPSB2b2lkIDAsIGtleU5hbWUgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IGFzc2VydEtleUV4aXN0cyA9IChrZXkpID0+IGpzc2V0LmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShrZXlOYW1lKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiBqc3NldC5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGFkZDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5T2tUb0FkZChrZXkpO1xuICAgICAganNzZXQuYWRkKGtleSk7XG4gICAgfSxcbiAgICBkZWxldGU6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgaWYgKGFzc2VydEtleU9rVG9EZWxldGUgIT09IHZvaWQgMCkge1xuICAgICAgICBhc3NlcnRLZXlPa1RvRGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgICBqc3NldC5kZWxldGUoa2V5KTtcbiAgICB9LFxuICAgIGFkZEFsbDogKGtleXM1KSA9PiB7XG4gICAgICBpZiAodHlwZW9mIGtleXM1W1N5bWJvbC5pdGVyYXRvcl0gIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBpZiAoT2JqZWN0LmlzRnJvemVuKGtleXM1KSAmJiBpc0NvcHlTZXQoa2V5czUpKSB7XG4gICAgICAgICAga2V5czUgPSBnZXRDb3B5U2V0S2V5cyhrZXlzNSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3dSZWRhY3RlZGBwcm92aWRlZCBkYXRhIHNvdXJjZSBpcyBub3QgaXRlcmFibGU6ICR7a2V5czV9YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChcbiAgICAgICAgY29uc3Qga2V5IG9mXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGtleXM1XG4gICAgICApIHtcbiAgICAgICAgYXNzZXJ0S2V5T2tUb0FkZChrZXkpO1xuICAgICAgICBqc3NldC5hZGQoa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBtYWtlU2NhbGFyV2Vha1NldFN0b3JlNCA9ICh0YWcgPSBcImtleVwiLCB7IGxvbmdMaXZlZCA9IHRydWUsIGtleVNoYXBlID0gdm9pZCAwIH0gPSB7fSkgPT4ge1xuICBjb25zdCBqc3NldCA9IG5ldyAobG9uZ0xpdmVkID8gV2Vha1NldCA6IFNldCkoKTtcbiAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKGtleVNoYXBlKTtcbiAgfVxuICBjb25zdCBhc3NlcnRLZXlPa1RvQWRkID0gKGtleSkgPT4ge1xuICAgIGhhcmRlbihrZXkpO1xuICAgIHBhc3NTdHlsZU9mKGtleSkgPT09IFwicmVtb3RhYmxlXCIgfHwgdGhyb3dSZWRhY3RlZGBPbmx5IHJlbW90YWJsZXMgY2FuIGJlIGtleXMgb2Ygc2NhbGFyIFdlYWtTdG9yZXM6ICR7a2V5fWA7XG4gICAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaChrZXksIGtleVNoYXBlLCBcIndlYWtTZXRTdG9yZSBrZXlcIik7XG4gICAgfVxuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgV2Vha1NldFN0b3JlIG9mICR7cXVvdGUodGFnKX1gLCB7XG4gICAgLi4ubWFrZVdlYWtTZXRTdG9yZU1ldGhvZHM0KGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCB2b2lkIDAsIHRhZylcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJXZWFrU2V0U3RvcmU0KTtcblxuLy9cbnZhciBtYWtlQ3VycmVudEtleXNLaXQ0ID0gKGdldFJhd0tleXMsIGNoZWNrSGFzLCBjb21wYXJlLCBhc3NlcnRPa1RvQWRkLCBhc3NlcnRPa1RvRGVsZXRlID0gdm9pZCAwLCBrZXlOYW1lID0gXCJrZXlcIikgPT4ge1xuICBsZXQgdXBkYXRlQ291bnQgPSAwO1xuICBsZXQgc29ydGVkS2V5c01lbW87XG4gIGNvbnN0IGFzc2VydFVwZGF0ZU9uQWRkID0gKGssIHYyID0gdm9pZCAwKSA9PiB7XG4gICAgYXNzZXJ0T2tUb0FkZChrLCB2Mik7XG4gICAgdXBkYXRlQ291bnQgKz0gMTtcbiAgICBzb3J0ZWRLZXlzTWVtbyA9IHZvaWQgMDtcbiAgfTtcbiAgY29uc3QgYXNzZXJ0VXBkYXRlT25EZWxldGUgPSAoaykgPT4gYXNzZXJ0T2tUb0RlbGV0ZSAmJiBhc3NlcnRPa1RvRGVsZXRlKGspO1xuICBjb25zdCBnZXRTb3J0ZWRLZXlzID0gKCkgPT4ge1xuICAgIGlmIChzb3J0ZWRLZXlzTWVtbyA9PT0gdm9pZCAwKSB7XG4gICAgICBzb3J0ZWRLZXlzTWVtbyA9IGhhcmRlbihbLi4uZ2V0UmF3S2V5cygpXS5zb3J0KGNvbXBhcmUpKTtcbiAgICB9XG4gICAgcmV0dXJuIHNvcnRlZEtleXNNZW1vO1xuICB9O1xuICBjb25zdCBpdGVyYWJsZUtleXMgPSBGYXIoXCJJdGVyYWJsZSBvZiBrZXlzXCIsIHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgY29uc3QgZ2VuZXJhdGlvbiA9IHVwZGF0ZUNvdW50O1xuICAgICAgZ2V0U29ydGVkS2V5cygpO1xuICAgICAgY29uc3QgbGVuID0gc29ydGVkS2V5c01lbW8ubGVuZ3RoO1xuICAgICAgbGV0IGkyID0gMDtcbiAgICAgIHJldHVybiBGYXIoXCJJdGVyYXRvciBvZiBrZXlzXCIsIHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGdlbmVyYXRpb24gPT09IHVwZGF0ZUNvdW50IHx8IHRocm93UmVkYWN0ZWRgU3RvcmUgJHtxdW90ZShrZXlOYW1lKX0gY3Vyc29yIHN0YWxlYDtcbiAgICAgICAgICBmb3IgKDsgOyApIHtcbiAgICAgICAgICAgIGlmIChpMiA8IGxlbikge1xuICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHNvcnRlZEtleXNNZW1vW2kyXTtcbiAgICAgICAgICAgICAgaTIgKz0gMTtcbiAgICAgICAgICAgICAgaWYgKGNoZWNrSGFzKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWUgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZTogdm9pZCAwIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgYXNzZXJ0VXBkYXRlT25BZGQsXG4gICAgYXNzZXJ0VXBkYXRlT25EZWxldGUsXG4gICAgaXRlcmFibGVLZXlzXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlQ3VycmVudEtleXNLaXQ0KTtcbnZhciBwcm92aWRlTGF6eTQgPSAobWFwU3RvcmUsIGtleSwgbWFrZVZhbHVlKSA9PiB7XG4gIGlmICghbWFwU3RvcmUuaGFzKGtleSkpIHtcbiAgICBtYXBTdG9yZS5pbml0KGtleSwgbWFrZVZhbHVlKGtleSkpO1xuICB9XG4gIHJldHVybiBtYXBTdG9yZS5nZXQoa2V5KTtcbn07XG5oYXJkZW4ocHJvdmlkZUxhenk0KTtcbnZhciBtYWtlQXRvbWljUHJvdmlkZXI0ID0gKHN0b3JlKSA9PiB7XG4gIGNvbnN0IHBlbmRpbmcgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICBjb25zdCBwcm92aWRlQXN5bmMgPSAoa2V5LCBtYWtlVmFsdWUsIGZpbmlzaFZhbHVlKSA9PiB7XG4gICAgaWYgKHN0b3JlLmhhcyhrZXkpKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHN0b3JlLmdldChrZXkpKTtcbiAgICB9XG4gICAgaWYgKCFwZW5kaW5nLmhhcyhrZXkpKSB7XG4gICAgICBjb25zdCB2YWxQMiA9IG1ha2VWYWx1ZShrZXkpLnRoZW4oKHYyKSA9PiB7XG4gICAgICAgIHN0b3JlLmluaXQoa2V5LCB2Mik7XG4gICAgICAgIHJldHVybiB2MjtcbiAgICAgIH0pLnRoZW4oKHYyKSA9PiB7XG4gICAgICAgIGlmIChmaW5pc2hWYWx1ZSkge1xuICAgICAgICAgIHJldHVybiBmaW5pc2hWYWx1ZShrZXksIHYyKS50aGVuKCgpID0+IHYyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdjI7XG4gICAgICB9KS5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgcGVuZGluZy5kZWxldGUoa2V5KTtcbiAgICAgIH0pO1xuICAgICAgcGVuZGluZy5zZXQoa2V5LCB2YWxQMik7XG4gICAgfVxuICAgIGNvbnN0IHZhbFAgPSBwZW5kaW5nLmdldChrZXkpO1xuICAgIGFzc2VydCh2YWxQKTtcbiAgICByZXR1cm4gdmFsUDtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IHByb3ZpZGVBc3luYyB9KTtcbn07XG5oYXJkZW4obWFrZUF0b21pY1Byb3ZpZGVyNCk7XG52YXIgYXBwZW5kVG9TdG9yZWRBcnJheTQgPSAobWFwU3RvcmUsIGtleSwgaXRlbSkgPT4ge1xuICBpZiAobWFwU3RvcmUuaGFzKGtleSkpIHtcbiAgICBjb25zdCBleHRhbnQgPSBtYXBTdG9yZS5nZXQoa2V5KTtcbiAgICBtYXBTdG9yZS5zZXQoa2V5LCBoYXJkZW4oWy4uLmV4dGFudCwgaXRlbV0pKTtcbiAgfSBlbHNlIHtcbiAgICBtYXBTdG9yZS5pbml0KGtleSwgaGFyZGVuKFtpdGVtXSkpO1xuICB9XG59O1xuaGFyZGVuKGFwcGVuZFRvU3RvcmVkQXJyYXk0KTtcblxuLy9cbnZhciBtYWtlU2V0U3RvcmVNZXRob2RzNCA9IChqc3NldCwgYXNzZXJ0S2V5T2tUb0FkZCwgYXNzZXJ0S2V5T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgeyBhc3NlcnRVcGRhdGVPbkFkZCwgYXNzZXJ0VXBkYXRlT25EZWxldGUsIGl0ZXJhYmxlS2V5cyB9ID0gbWFrZUN1cnJlbnRLZXlzS2l0NChcbiAgICAoKSA9PiBqc3NldC5rZXlzKCksXG4gICAgKGspID0+IGpzc2V0LmhhcyhrKSxcbiAgICBjb21wYXJlUmFuayxcbiAgICBhc3NlcnRLZXlPa1RvQWRkLFxuICAgIGFzc2VydEtleU9rVG9EZWxldGUsXG4gICAga2V5TmFtZVxuICApO1xuICBjb25zdCBrZXlzNSA9IChrZXlQYXR0ID0gdm9pZCAwKSA9PiBrZXlQYXR0ID09PSB2b2lkIDAgPyBpdGVyYWJsZUtleXMgOiBmaWx0ZXJJdGVyYWJsZShpdGVyYWJsZUtleXMsIChrKSA9PiBtYXRjaGVzKGssIGtleVBhdHQpKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgLi4ubWFrZVdlYWtTZXRTdG9yZU1ldGhvZHM0KFxuICAgICAganNzZXQsXG4gICAgICBhc3NlcnRVcGRhdGVPbkFkZCxcbiAgICAgIGFzc2VydFVwZGF0ZU9uRGVsZXRlLFxuICAgICAga2V5TmFtZVxuICAgICksXG4gICAga2V5czoga2V5czUsXG4gICAgdmFsdWVzOiBrZXlzNSxcbiAgICBzbmFwc2hvdDogKGtleVBhdHQgPSB2b2lkIDApID0+IG1ha2VDb3B5U2V0KGtleXM1KGtleVBhdHQpKSxcbiAgICBnZXRTaXplOiAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ga2V5UGF0dCA9PT0gdm9pZCAwID8ganNzZXQuc2l6ZSA6IFsuLi5rZXlzNShrZXlQYXR0KV0ubGVuZ3RoLFxuICAgIGNsZWFyOiAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ge1xuICAgICAgaWYgKGtleVBhdHQgPT09IHZvaWQgMCkge1xuICAgICAgICBqc3NldC5jbGVhcigpO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5czUoa2V5UGF0dCkpIHtcbiAgICAgICAganNzZXQuZGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgbWFrZVNjYWxhclNldFN0b3JlNCA9ICh0YWcgPSBcImtleVwiLCB7IGtleVNoYXBlID0gdm9pZCAwIH0gPSB7fSkgPT4ge1xuICBjb25zdCBqc3NldCA9IC8qICAgICAgICAgICAqLyBuZXcgU2V0KCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S2V5T2tUb0FkZCA9IChrZXkpID0+IHtcbiAgICBoYXJkZW4oa2V5KTtcbiAgICBhc3NlcnRTY2FsYXJLZXkoa2V5KTtcbiAgICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKGtleSwga2V5U2hhcGUsIFwic2V0U3RvcmUga2V5XCIpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIEZhcihgc2NhbGFyIFNldFN0b3JlIG9mICR7cXVvdGUodGFnKX1gLCB7XG4gICAgLi4ubWFrZVNldFN0b3JlTWV0aG9kczQoanNzZXQsIGFzc2VydEtleU9rVG9BZGQsIHZvaWQgMCwgdGFnKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZVNjYWxhclNldFN0b3JlNCk7XG5cbi8vXG52YXIgbWFrZVdlYWtNYXBTdG9yZU1ldGhvZHM0ID0gKGpzbWFwLCBhc3NlcnRLVk9rVG9BZGQsIGFzc2VydEtWT2tUb1NldCwgYXNzZXJ0S2V5T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgYXNzZXJ0S2V5RG9lc05vdEV4aXN0ID0gKGtleSkgPT4gIWpzbWFwLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShrZXlOYW1lKX0gYWxyZWFkeSByZWdpc3RlcmVkOiAke2tleX1gO1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiBqc21hcC5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUoa2V5TmFtZSl9IG5vdCBmb3VuZDogJHtrZXl9YDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgaGFzOiAoa2V5KSA9PiB7XG4gICAgICByZXR1cm4ganNtYXAuaGFzKGtleSk7XG4gICAgfSxcbiAgICBnZXQ6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAgICBqc21hcC5nZXQoa2V5KVxuICAgICAgKTtcbiAgICB9LFxuICAgIGluaXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlEb2VzTm90RXhpc3Qoa2V5KTtcbiAgICAgIGFzc2VydEtWT2tUb0FkZChrZXksIHZhbHVlKTtcbiAgICAgIGpzbWFwLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIHNldDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgYXNzZXJ0S1ZPa1RvU2V0KGtleSwgdmFsdWUpO1xuICAgICAganNtYXAuc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZGVsZXRlOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIGlmIChhc3NlcnRLZXlPa1RvRGVsZXRlICE9PSB2b2lkIDApIHtcbiAgICAgICAgYXNzZXJ0S2V5T2tUb0RlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgICAganNtYXAuZGVsZXRlKGtleSk7XG4gICAgfSxcbiAgICBhZGRBbGw6IChlbnRyaWVzMTEpID0+IHtcbiAgICAgIGlmICh0eXBlb2YgZW50cmllczExW1N5bWJvbC5pdGVyYXRvcl0gIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBpZiAoT2JqZWN0LmlzRnJvemVuKGVudHJpZXMxMSkgJiYgaXNDb3B5TWFwKGVudHJpZXMxMSkpIHtcbiAgICAgICAgICBlbnRyaWVzMTEgPSBnZXRDb3B5TWFwRW50cmllcyhlbnRyaWVzMTEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93UmVkYWN0ZWRgcHJvdmlkZWQgZGF0YSBzb3VyY2UgaXMgbm90IGl0ZXJhYmxlOiAke2VudHJpZXMxMX1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKFxuICAgICAgICBjb25zdCBba2V5LCB2YWx1ZV0gb2ZcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBlbnRyaWVzMTFcbiAgICAgICkge1xuICAgICAgICBhc3NlcnRLVk9rVG9BZGQoa2V5LCB2YWx1ZSk7XG4gICAgICAgIGpzbWFwLnNldChrZXksIHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBtYWtlU2NhbGFyV2Vha01hcFN0b3JlNCA9ICh0YWcgPSBcImtleVwiLCB7IGxvbmdMaXZlZCA9IHRydWUsIGtleVNoYXBlID0gdm9pZCAwLCB2YWx1ZVNoYXBlID0gdm9pZCAwIH0gPSB7fSkgPT4ge1xuICBjb25zdCBqc21hcCA9IG5ldyAobG9uZ0xpdmVkID8gV2Vha01hcCA6IE1hcCkoKTtcbiAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKGtleVNoYXBlKTtcbiAgfVxuICBpZiAodmFsdWVTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybih2YWx1ZVNoYXBlKTtcbiAgfVxuICBjb25zdCBhc3NlcnRLVk9rVG9TZXQgPSAoX2tleSwgdmFsdWUpID0+IHtcbiAgICBoYXJkZW4odmFsdWUpO1xuICAgIGFzc2VydFBhc3NhYmxlKHZhbHVlKTtcbiAgICBpZiAodmFsdWVTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2godmFsdWUsIHZhbHVlU2hhcGUsIFwid2Vha01hcFN0b3JlIHZhbHVlXCIpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgYXNzZXJ0S1ZPa1RvQWRkID0gKGtleSwgdmFsdWUpID0+IHtcbiAgICBoYXJkZW4oa2V5KTtcbiAgICBwYXNzU3R5bGVPZihrZXkpID09PSBcInJlbW90YWJsZVwiIHx8IHRocm93UmVkYWN0ZWRgT25seSByZW1vdGFibGVzIGNhbiBiZSBrZXlzIG9mIHNjYWxhciBXZWFrTWFwU3RvcmVzOiAke2tleX1gO1xuICAgIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2goa2V5LCBrZXlTaGFwZSwgXCJ3ZWFrTWFwU3RvcmUga2V5XCIpO1xuICAgIH1cbiAgICBhc3NlcnRLVk9rVG9TZXQoa2V5LCB2YWx1ZSk7XG4gIH07XG4gIHJldHVybiBGYXIoYHNjYWxhciBXZWFrTWFwU3RvcmUgb2YgJHtxdW90ZSh0YWcpfWAsIHtcbiAgICAuLi5tYWtlV2Vha01hcFN0b3JlTWV0aG9kczQoXG4gICAgICBqc21hcCxcbiAgICAgIGFzc2VydEtWT2tUb0FkZCxcbiAgICAgIGFzc2VydEtWT2tUb1NldCxcbiAgICAgIHZvaWQgMCxcbiAgICAgIHRhZ1xuICAgIClcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJXZWFrTWFwU3RvcmU0KTtcblxuLy9cbnZhciBtYWtlTWFwU3RvcmVNZXRob2RzNCA9IChqc21hcCwgYXNzZXJ0S1ZPa1RvQWRkLCBhc3NlcnRLVk9rVG9TZXQsIGFzc2VydEtleU9rVG9EZWxldGUgPSB2b2lkIDAsIHRhZyA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgeyBhc3NlcnRVcGRhdGVPbkFkZCwgYXNzZXJ0VXBkYXRlT25EZWxldGUsIGl0ZXJhYmxlS2V5cyB9ID0gbWFrZUN1cnJlbnRLZXlzS2l0NChcbiAgICAoKSA9PiBqc21hcC5rZXlzKCksXG4gICAgKGspID0+IGpzbWFwLmhhcyhrKSxcbiAgICBjb21wYXJlUmFuayxcbiAgICBhc3NlcnRLVk9rVG9BZGQsXG4gICAgYXNzZXJ0S2V5T2tUb0RlbGV0ZSxcbiAgICB0YWdcbiAgKTtcbiAgY29uc3Qga2V5czUgPSAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiB7XG4gICAgaWYgKGtleVBhdHQgPT09IHZvaWQgMCAmJiB2YWx1ZVBhdHQgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGl0ZXJhYmxlS2V5cztcbiAgICB9XG4gICAgY29uc3QgZmlsdGVyID0gKGspID0+IHtcbiAgICAgIGlmIChrZXlQYXR0ICE9PSB2b2lkIDAgJiYgIW1hdGNoZXMoaywga2V5UGF0dCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKHZhbHVlUGF0dCAhPT0gdm9pZCAwICYmICFtYXRjaGVzKGpzbWFwLmdldChrKSwgdmFsdWVQYXR0KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIHJldHVybiBmaWx0ZXJJdGVyYWJsZShpdGVyYWJsZUtleXMsIGZpbHRlcik7XG4gIH07XG4gIGNvbnN0IHZhbHVlczggPSAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBtYXBJdGVyYWJsZShrZXlzNShrZXlQYXR0LCB2YWx1ZVBhdHQpLCAoaykgPT4gKFxuICAgIC8qICAgICAgICAgICAgKi9cbiAgICBqc21hcC5nZXQoaylcbiAgKSk7XG4gIGNvbnN0IGVudHJpZXMxMSA9IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IG1hcEl0ZXJhYmxlKGtleXM1KGtleVBhdHQsIHZhbHVlUGF0dCksIChrKSA9PiBbXG4gICAgayxcbiAgICAvKiAgICAgICAgICAgICovXG4gICAganNtYXAuZ2V0KGspXG4gIF0pO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICAuLi5tYWtlV2Vha01hcFN0b3JlTWV0aG9kczQoXG4gICAgICBqc21hcCxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBhc3NlcnRVcGRhdGVPbkFkZCxcbiAgICAgIGFzc2VydEtWT2tUb1NldCxcbiAgICAgIGFzc2VydFVwZGF0ZU9uRGVsZXRlLFxuICAgICAgdGFnXG4gICAgKSxcbiAgICBrZXlzOiBrZXlzNSxcbiAgICB2YWx1ZXM6IHZhbHVlczgsXG4gICAgZW50cmllczogZW50cmllczExLFxuICAgIHNuYXBzaG90OiAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBtYWtlQ29weU1hcChlbnRyaWVzMTEoa2V5UGF0dCwgdmFsdWVQYXR0KSksXG4gICAgZ2V0U2l6ZTogKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4ga2V5UGF0dCA9PT0gdm9pZCAwICYmIHZhbHVlUGF0dCA9PT0gdm9pZCAwID8ganNtYXAuc2l6ZSA6IFsuLi5rZXlzNShrZXlQYXR0LCB2YWx1ZVBhdHQpXS5sZW5ndGgsXG4gICAgY2xlYXI6IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IHtcbiAgICAgIGlmIChrZXlQYXR0ID09PSB2b2lkIDAgJiYgdmFsdWVQYXR0ID09PSB2b2lkIDApIHtcbiAgICAgICAganNtYXAuY2xlYXIoKTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXM1KGtleVBhdHQsIHZhbHVlUGF0dCkpIHtcbiAgICAgICAganNtYXAuZGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgbWFrZVNjYWxhck1hcFN0b3JlNCA9ICh0YWcgPSBcImtleVwiLCB7IGtleVNoYXBlID0gdm9pZCAwLCB2YWx1ZVNoYXBlID0gdm9pZCAwIH0gPSB7fSkgPT4ge1xuICBjb25zdCBqc21hcCA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4odmFsdWVTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S1ZPa1RvU2V0ID0gKF9rZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKHZhbHVlKTtcbiAgICBhc3NlcnRQYXNzYWJsZSh2YWx1ZSk7XG4gICAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKHZhbHVlLCB2YWx1ZVNoYXBlLCBcIm1hcFN0b3JlIHZhbHVlXCIpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgYXNzZXJ0S1ZPa1RvQWRkID0gKGtleSwgdmFsdWUpID0+IHtcbiAgICBoYXJkZW4oa2V5KTtcbiAgICBhc3NlcnRTY2FsYXJLZXkoa2V5KTtcbiAgICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKGtleSwga2V5U2hhcGUsIFwibWFwU3RvcmUga2V5XCIpO1xuICAgIH1cbiAgICBhc3NlcnRLVk9rVG9TZXQoa2V5LCB2YWx1ZSk7XG4gIH07XG4gIHJldHVybiBGYXIoYHNjYWxhciBNYXBTdG9yZSBvZiAke3F1b3RlKHRhZyl9YCwge1xuICAgIC4uLm1ha2VNYXBTdG9yZU1ldGhvZHM0KFxuICAgICAganNtYXAsXG4gICAgICBhc3NlcnRLVk9rVG9BZGQsXG4gICAgICBhc3NlcnRLVk9rVG9TZXQsXG4gICAgICB2b2lkIDAsXG4gICAgICB0YWdcbiAgICApXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU2NhbGFyTWFwU3RvcmU0KTtcblxuLy9cbnZhciBtYWtlTGVnYWN5TWFwNCA9ICh0YWcgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IG0yID0gLyogICAgICAgICAgICovIG5ldyBNYXAoKTtcbiAgY29uc3QgYXNzZXJ0S2V5RG9lc05vdEV4aXN0ID0gKGtleSkgPT4gIW0yLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBhbHJlYWR5IHJlZ2lzdGVyZWQ6ICR7a2V5fWA7XG4gIGNvbnN0IGFzc2VydEtleUV4aXN0cyA9IChrZXkpID0+IG0yLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBub3QgZm91bmQ6ICR7a2V5fWA7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGhhczogKGtleSkgPT4ge1xuICAgICAgcmV0dXJuIG0yLmhhcyhrZXkpO1xuICAgIH0sXG4gICAgaW5pdDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleURvZXNOb3RFeGlzdChrZXkpO1xuICAgICAgbTIuc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZ2V0OiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHJldHVybiBtMi5nZXQoa2V5KTtcbiAgICB9LFxuICAgIHNldDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgbTIuc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZGVsZXRlOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIG0yLmRlbGV0ZShrZXkpO1xuICAgIH0sXG4gICAga2V5czogKCkgPT4gbTIua2V5cygpLFxuICAgIHZhbHVlczogKCkgPT4gbTIudmFsdWVzKCksXG4gICAgZW50cmllczogKCkgPT4gbTIuZW50cmllcygpLFxuICAgIGdldFNpemU6ICgpID0+IG0yLnNpemUsXG4gICAgY2xlYXI6ICgpID0+IG0yLmNsZWFyKClcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VMZWdhY3lNYXA0KTtcblxuLy9cbnZhciBtYWtlTGVnYWN5V2Vha01hcDQgPSAodGFnID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCB3bSA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBjb25zdCBhc3NlcnRLZXlEb2VzTm90RXhpc3QgPSAoa2V5KSA9PiAhd20uaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKHRhZyl9IGFscmVhZHkgcmVnaXN0ZXJlZDogJHtrZXl9YDtcbiAgY29uc3QgYXNzZXJ0S2V5RXhpc3RzID0gKGtleSkgPT4gd20uaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKHRhZyl9IG5vdCBmb3VuZDogJHtrZXl9YDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgaGFzOiAoa2V5KSA9PiB7XG4gICAgICByZXR1cm4gd20uaGFzKGtleSk7XG4gICAgfSxcbiAgICBpbml0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RG9lc05vdEV4aXN0KGtleSk7XG4gICAgICB3bS5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBnZXQ6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAgICB3bS5nZXQoa2V5KVxuICAgICAgKTtcbiAgICB9LFxuICAgIHNldDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgd20uc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZGVsZXRlOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHdtLmRlbGV0ZShrZXkpO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VMZWdhY3lXZWFrTWFwNCk7XG5cbi8vXG52YXIgVmF0RGF0YUdsb2JhbDI7XG5pZiAoXCJWYXREYXRhXCIgaW4gZ2xvYmFsVGhpcykge1xuICBnbG9iYWxUaGlzLlZhdERhdGEgfHwgdGhyb3dSZWRhY3RlZGBWYXREYXRhIGRlZmluZWQgaW4gZ2xvYmFsIGFzIG51bGwgb3IgdW5kZWZpbmVkYDtcbiAgVmF0RGF0YUdsb2JhbDIgPSAvKiAgICAgICAgICAgICAgKi9cbiAgZ2xvYmFsVGhpcy5WYXREYXRhO1xufSBlbHNlIHtcbiAgY29uc3QgdW5hdmFpbGFibGUgPSAoKSA9PiB0aHJvd1JlZGFjdGVkYFZhdERhdGEgdW5hdmFpbGFibGVgO1xuICBWYXREYXRhR2xvYmFsMiA9IHtcbiAgICBkZWZpbmVLaW5kOiB1bmF2YWlsYWJsZSxcbiAgICBkZWZpbmVLaW5kTXVsdGk6IHVuYXZhaWxhYmxlLFxuICAgIGRlZmluZUR1cmFibGVLaW5kOiB1bmF2YWlsYWJsZSxcbiAgICBkZWZpbmVEdXJhYmxlS2luZE11bHRpOiB1bmF2YWlsYWJsZSxcbiAgICBtYWtlS2luZEhhbmRsZTogdW5hdmFpbGFibGUsXG4gICAgcHJvdmlkZVByb21pc2VXYXRjaGVyOiB1bmF2YWlsYWJsZSxcbiAgICB3YXRjaFByb21pc2U6IHVuYXZhaWxhYmxlLFxuICAgIG1ha2VTY2FsYXJCaWdNYXBTdG9yZTogdW5hdmFpbGFibGUsXG4gICAgbWFrZVNjYWxhckJpZ1dlYWtNYXBTdG9yZTogdW5hdmFpbGFibGUsXG4gICAgbWFrZVNjYWxhckJpZ1NldFN0b3JlOiB1bmF2YWlsYWJsZSxcbiAgICBtYWtlU2NhbGFyQmlnV2Vha1NldFN0b3JlOiB1bmF2YWlsYWJsZSxcbiAgICBjYW5CZUR1cmFibGU6IHVuYXZhaWxhYmxlXG4gIH07XG59XG52YXIgVmF0RGF0YUV4cG9ydDIgPSBWYXREYXRhR2xvYmFsMjtcbnZhciB7XG4gIGRlZmluZUtpbmQ6IGRlZmluZUtpbmQyLFxuICBkZWZpbmVLaW5kTXVsdGk6IGRlZmluZUtpbmRNdWx0aTIsXG4gIGRlZmluZUR1cmFibGVLaW5kOiBkZWZpbmVEdXJhYmxlS2luZDIsXG4gIGRlZmluZUR1cmFibGVLaW5kTXVsdGk6IGRlZmluZUR1cmFibGVLaW5kTXVsdGkyXG59ID0gVmF0RGF0YUdsb2JhbDI7XG52YXIge1xuICBtYWtlS2luZEhhbmRsZTogbWFrZUtpbmRIYW5kbGUyLFxuICBwcm92aWRlUHJvbWlzZVdhdGNoZXI6IHByb3ZpZGVQcm9taXNlV2F0Y2hlcjIsXG4gIHdhdGNoUHJvbWlzZTogd2F0Y2hQcm9taXNlMyxcbiAgbWFrZVNjYWxhckJpZ01hcFN0b3JlOiBtYWtlU2NhbGFyQmlnTWFwU3RvcmUyLFxuICBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlOiBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlMixcbiAgbWFrZVNjYWxhckJpZ1NldFN0b3JlOiBtYWtlU2NhbGFyQmlnU2V0U3RvcmUyLFxuICBtYWtlU2NhbGFyQmlnV2Vha1NldFN0b3JlOiBtYWtlU2NhbGFyQmlnV2Vha1NldFN0b3JlMixcbiAgY2FuQmVEdXJhYmxlOiBjYW5CZUR1cmFibGUyXG59ID0gVmF0RGF0YUdsb2JhbDI7XG52YXIgcGlja0ZhY2V0MiA9IChtYWtlciwgZmFjZXROYW1lKSA9PiAoLi4uYXJncykgPT4gbWFrZXIoLi4uYXJncylbZmFjZXROYW1lXTtcbmhhcmRlbihwaWNrRmFjZXQyKTtcbnZhciBwYXJ0aWFsQXNzaWduMiA9ICh0YXJnZXQsIHNvdXJjZSkgPT4ge1xuICBPYmplY3QuYXNzaWduKHRhcmdldCwgc291cmNlKTtcbn07XG5oYXJkZW4ocGFydGlhbEFzc2lnbjIpO1xudmFyIHByb3ZpZGUyID0gKFxuICAvL1xuICAvKlxuXG5cblxuXG5cbiAgICovXG4gIHByb3ZpZGVMYXp5NFxuKTtcbnZhciBtYWtlU3RvcmVVdGlsczIgPSAoVmF0RGF0YSkgPT4ge1xuICBjb25zdCB7XG4gICAgLy9cbiAgICBtYWtlU2NhbGFyQmlnTWFwU3RvcmU6IG1ha2VTY2FsYXJCaWdNYXBTdG9yZTQsXG4gICAgLy9cbiAgICBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlOiBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlNCxcbiAgICAvL1xuICAgIG1ha2VTY2FsYXJCaWdTZXRTdG9yZTogbWFrZVNjYWxhckJpZ1NldFN0b3JlNCxcbiAgICAvL1xuICAgIG1ha2VTY2FsYXJCaWdXZWFrU2V0U3RvcmU6IG1ha2VTY2FsYXJCaWdXZWFrU2V0U3RvcmU0XG4gIH0gPSBWYXREYXRhO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZU1hcFN0b3JlNCA9IChiYWdnYWdlLCBuYW1lLCBvcHRpb25zID0ge30pID0+IHByb3ZpZGUyKFxuICAgIGJhZ2dhZ2UsXG4gICAgbmFtZSxcbiAgICAoKSA9PiBtYWtlU2NhbGFyQmlnTWFwU3RvcmU0KG5hbWUsIHsgZHVyYWJsZTogdHJ1ZSwgLi4ub3B0aW9ucyB9KVxuICApO1xuICBoYXJkZW4ocHJvdmlkZUR1cmFibGVNYXBTdG9yZTQpO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZTQgPSAoYmFnZ2FnZSwgbmFtZSwgb3B0aW9ucyA9IHt9KSA9PiBwcm92aWRlMihcbiAgICBiYWdnYWdlLFxuICAgIG5hbWUsXG4gICAgKCkgPT4gbWFrZVNjYWxhckJpZ1dlYWtNYXBTdG9yZTQobmFtZSwgeyBkdXJhYmxlOiB0cnVlLCAuLi5vcHRpb25zIH0pXG4gICk7XG4gIGhhcmRlbihwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZTQpO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZVNldFN0b3JlNCA9IChiYWdnYWdlLCBuYW1lLCBvcHRpb25zID0ge30pID0+IHByb3ZpZGUyKFxuICAgIGJhZ2dhZ2UsXG4gICAgbmFtZSxcbiAgICAoKSA9PiBtYWtlU2NhbGFyQmlnU2V0U3RvcmU0KG5hbWUsIHsgZHVyYWJsZTogdHJ1ZSwgLi4ub3B0aW9ucyB9KVxuICApO1xuICBoYXJkZW4ocHJvdmlkZUR1cmFibGVTZXRTdG9yZTQpO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZTQgPSAoYmFnZ2FnZSwgbmFtZSwgb3B0aW9ucyA9IHt9KSA9PiBwcm92aWRlMihcbiAgICBiYWdnYWdlLFxuICAgIG5hbWUsXG4gICAgKCkgPT4gbWFrZVNjYWxhckJpZ1dlYWtTZXRTdG9yZTQobmFtZSwgeyBkdXJhYmxlOiB0cnVlLCAuLi5vcHRpb25zIH0pXG4gICk7XG4gIGhhcmRlbihwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZTQpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBwcm92aWRlRHVyYWJsZU1hcFN0b3JlOiBwcm92aWRlRHVyYWJsZU1hcFN0b3JlNCxcbiAgICBwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZTogcHJvdmlkZUR1cmFibGVXZWFrTWFwU3RvcmU0LFxuICAgIHByb3ZpZGVEdXJhYmxlU2V0U3RvcmU6IHByb3ZpZGVEdXJhYmxlU2V0U3RvcmU0LFxuICAgIHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlOiBwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZTRcbiAgfSk7XG59O1xudmFyIGdsb2JhbFN0b3JlVXRpbHMyID0gbWFrZVN0b3JlVXRpbHMyKFZhdERhdGFHbG9iYWwyKTtcbnZhciB7XG4gIHByb3ZpZGVEdXJhYmxlTWFwU3RvcmU6IHByb3ZpZGVEdXJhYmxlTWFwU3RvcmUyLFxuICBwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZTogcHJvdmlkZUR1cmFibGVXZWFrTWFwU3RvcmUyLFxuICBwcm92aWRlRHVyYWJsZVNldFN0b3JlOiBwcm92aWRlRHVyYWJsZVNldFN0b3JlMixcbiAgcHJvdmlkZUR1cmFibGVXZWFrU2V0U3RvcmU6IHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlMlxufSA9IGdsb2JhbFN0b3JlVXRpbHMyO1xuXG4vL1xudmFyIGlnbm9yZUNvbnRleHQyID0gKGZuKSA9PiAoX2NvbnRleHQsIC4uLmFyZ3MpID0+IGZuKC4uLmFyZ3MpO1xuaGFyZGVuKGlnbm9yZUNvbnRleHQyKTtcbnZhciBtYWtlRXhvVXRpbHMyID0gKFZhdERhdGEpID0+IHtcbiAgY29uc3Qge1xuICAgIGRlZmluZUtpbmQ6IGRlZmluZUtpbmQ0LFxuICAgIGRlZmluZUtpbmRNdWx0aTogZGVmaW5lS2luZE11bHRpNCxcbiAgICBkZWZpbmVEdXJhYmxlS2luZDogZGVmaW5lRHVyYWJsZUtpbmQ0LFxuICAgIGRlZmluZUR1cmFibGVLaW5kTXVsdGk6IGRlZmluZUR1cmFibGVLaW5kTXVsdGk0LFxuICAgIG1ha2VLaW5kSGFuZGxlOiBtYWtlS2luZEhhbmRsZTRcbiAgfSA9IFZhdERhdGE7XG4gIGNvbnN0IHByb3ZpZGVLaW5kSGFuZGxlNCA9IChiYWdnYWdlLCBraW5kTmFtZSkgPT4gcHJvdmlkZTIoYmFnZ2FnZSwgYCR7a2luZE5hbWV9X2tpbmRIYW5kbGVgLCAoKSA9PiBtYWtlS2luZEhhbmRsZTQoa2luZE5hbWUpKTtcbiAgaGFyZGVuKHByb3ZpZGVLaW5kSGFuZGxlNCk7XG4gIGNvbnN0IHByZXBhcmVLaW5kNCA9IChiYWdnYWdlLCBraW5kTmFtZSwgaW5pdCwgYmVoYXZpb3IsIG9wdGlvbnMgPSB2b2lkIDApID0+IGRlZmluZUR1cmFibGVLaW5kNChcbiAgICBwcm92aWRlS2luZEhhbmRsZTQoYmFnZ2FnZSwga2luZE5hbWUpLFxuICAgIGluaXQsXG4gICAgYmVoYXZpb3IsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUtpbmQ0KTtcbiAgY29uc3QgcHJlcGFyZUtpbmRNdWx0aTQgPSAoYmFnZ2FnZSwga2luZE5hbWUsIGluaXQsIGJlaGF2aW9yLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlS2luZE11bHRpNChcbiAgICBwcm92aWRlS2luZEhhbmRsZTQoYmFnZ2FnZSwga2luZE5hbWUpLFxuICAgIGluaXQsXG4gICAgYmVoYXZpb3IsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUtpbmRNdWx0aTQpO1xuICBjb25zdCBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3M0ID0gKHRhZywgaW50ZXJmYWNlR3VhcmQsIGluaXQsIG1ldGhvZHMsIG9wdGlvbnMpID0+IChcbiAgICAvL1xuICAgIGRlZmluZUtpbmQ0KHRhZywgaW5pdCwgbWV0aG9kcywge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIHRoaXNmdWxNZXRob2RzOiB0cnVlLFxuICAgICAgaW50ZXJmYWNlR3VhcmRcbiAgICB9KVxuICApO1xuICBoYXJkZW4oZGVmaW5lVmlydHVhbEV4b0NsYXNzNCk7XG4gIGNvbnN0IGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdDQgPSAodGFnLCBpbnRlcmZhY2VHdWFyZEtpdCwgaW5pdCwgZmFjZXRzLCBvcHRpb25zKSA9PiAoXG4gICAgLy9cbiAgICBkZWZpbmVLaW5kTXVsdGk0KHRhZywgaW5pdCwgZmFjZXRzLCB7XG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgdGhpc2Z1bE1ldGhvZHM6IHRydWUsXG4gICAgICBpbnRlcmZhY2VHdWFyZEtpdFxuICAgIH0pXG4gICk7XG4gIGhhcmRlbihkZWZpbmVWaXJ0dWFsRXhvQ2xhc3NLaXQ0KTtcbiAgY29uc3QgZGVmaW5lRHVyYWJsZUV4b0NsYXNzNCA9IChraW5kSGFuZGxlLCBpbnRlcmZhY2VHdWFyZCwgaW5pdCwgbWV0aG9kcywgb3B0aW9ucykgPT4gKFxuICAgIC8vXG4gICAgZGVmaW5lRHVyYWJsZUtpbmQ0KGtpbmRIYW5kbGUsIGluaXQsIG1ldGhvZHMsIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICB0aGlzZnVsTWV0aG9kczogdHJ1ZSxcbiAgICAgIGludGVyZmFjZUd1YXJkXG4gICAgfSlcbiAgKTtcbiAgaGFyZGVuKGRlZmluZUR1cmFibGVFeG9DbGFzczQpO1xuICBjb25zdCBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQ0ID0gKGtpbmRIYW5kbGUsIGludGVyZmFjZUd1YXJkS2l0LCBpbml0LCBmYWNldHMsIG9wdGlvbnMpID0+IChcbiAgICAvL1xuICAgIGRlZmluZUR1cmFibGVLaW5kTXVsdGk0KGtpbmRIYW5kbGUsIGluaXQsIGZhY2V0cywge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIHRoaXNmdWxNZXRob2RzOiB0cnVlLFxuICAgICAgaW50ZXJmYWNlR3VhcmRLaXRcbiAgICB9KVxuICApO1xuICBoYXJkZW4oZGVmaW5lRHVyYWJsZUV4b0NsYXNzS2l0NCk7XG4gIGNvbnN0IHByZXBhcmVFeG9DbGFzczQgPSAoYmFnZ2FnZSwga2luZE5hbWUsIGludGVyZmFjZUd1YXJkLCBpbml0LCBtZXRob2RzLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3M0KFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlNChiYWdnYWdlLCBraW5kTmFtZSksXG4gICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgaW5pdCxcbiAgICBtZXRob2RzLFxuICAgIG9wdGlvbnNcbiAgKTtcbiAgaGFyZGVuKHByZXBhcmVFeG9DbGFzczQpO1xuICBjb25zdCBwcmVwYXJlRXhvQ2xhc3NLaXQ0ID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBpbnRlcmZhY2VHdWFyZEtpdCwgaW5pdCwgZmFjZXRzLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQ0KFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlNChiYWdnYWdlLCBraW5kTmFtZSksXG4gICAgaW50ZXJmYWNlR3VhcmRLaXQsXG4gICAgaW5pdCxcbiAgICBmYWNldHMsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUV4b0NsYXNzS2l0NCk7XG4gIGNvbnN0IHByZXBhcmVFeG80ID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBpbnRlcmZhY2VHdWFyZCwgbWV0aG9kcywgb3B0aW9ucyA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IG1ha2VTaW5nbGV0b24gPSBwcmVwYXJlRXhvQ2xhc3M0KFxuICAgICAgYmFnZ2FnZSxcbiAgICAgIGtpbmROYW1lLFxuICAgICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgICBpbml0RW1wdHksXG4gICAgICBtZXRob2RzLFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gICAgcmV0dXJuIHByb3ZpZGUyKGJhZ2dhZ2UsIGAke2tpbmROYW1lfV9zaW5nbGV0b25gLCAoKSA9PiBtYWtlU2luZ2xldG9uKCkpO1xuICB9O1xuICBoYXJkZW4ocHJlcGFyZUV4bzQpO1xuICBjb25zdCBwcmVwYXJlU2luZ2xldG9uNCA9IChiYWdnYWdlLCBraW5kTmFtZSwgbWV0aG9kcywgb3B0aW9ucyA9IHZvaWQgMCkgPT4gcHJlcGFyZUV4bzQoYmFnZ2FnZSwga2luZE5hbWUsIHZvaWQgMCwgbWV0aG9kcywgb3B0aW9ucyk7XG4gIGhhcmRlbihwcmVwYXJlU2luZ2xldG9uNCk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGRlZmluZVZpcnR1YWxFeG9DbGFzczogZGVmaW5lVmlydHVhbEV4b0NsYXNzNCxcbiAgICBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3NLaXQ6IGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdDQsXG4gICAgZGVmaW5lRHVyYWJsZUV4b0NsYXNzOiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3M0LFxuICAgIGRlZmluZUR1cmFibGVFeG9DbGFzc0tpdDogZGVmaW5lRHVyYWJsZUV4b0NsYXNzS2l0NCxcbiAgICBwcmVwYXJlRXhvQ2xhc3M6IHByZXBhcmVFeG9DbGFzczQsXG4gICAgcHJlcGFyZUV4b0NsYXNzS2l0OiBwcmVwYXJlRXhvQ2xhc3NLaXQ0LFxuICAgIHByZXBhcmVFeG86IHByZXBhcmVFeG80LFxuICAgIHByZXBhcmVTaW5nbGV0b246IHByZXBhcmVTaW5nbGV0b240LFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlOiBwcm92aWRlS2luZEhhbmRsZTQsXG4gICAgcHJlcGFyZUtpbmQ6IHByZXBhcmVLaW5kNCxcbiAgICBwcmVwYXJlS2luZE11bHRpOiBwcmVwYXJlS2luZE11bHRpNFxuICB9KTtcbn07XG52YXIgZ2xvYmFsRXhvVXRpbHMyID0gbWFrZUV4b1V0aWxzMihWYXREYXRhRXhwb3J0Mik7XG52YXIge1xuICBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3M6IGRlZmluZVZpcnR1YWxFeG9DbGFzczIsXG4gIGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdDogZGVmaW5lVmlydHVhbEV4b0NsYXNzS2l0MixcbiAgZGVmaW5lRHVyYWJsZUV4b0NsYXNzOiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3MyLFxuICBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQ6IGRlZmluZUR1cmFibGVFeG9DbGFzc0tpdDIsXG4gIHByZXBhcmVFeG9DbGFzczogcHJlcGFyZUV4b0NsYXNzMixcbiAgcHJlcGFyZUV4b0NsYXNzS2l0OiBwcmVwYXJlRXhvQ2xhc3NLaXQyLFxuICBwcmVwYXJlRXhvOiBwcmVwYXJlRXhvMixcbiAgcHJlcGFyZVNpbmdsZXRvbjogcHJlcGFyZVNpbmdsZXRvbjJcbn0gPSBnbG9iYWxFeG9VdGlsczI7XG52YXIgeyBwcm92aWRlS2luZEhhbmRsZTogcHJvdmlkZUtpbmRIYW5kbGUyLCBwcmVwYXJlS2luZDogcHJlcGFyZUtpbmQyLCBwcmVwYXJlS2luZE11bHRpOiBwcmVwYXJlS2luZE11bHRpMiB9ID0gZ2xvYmFsRXhvVXRpbHMyO1xuXG4vL1xudmFyIGlzU3RvcmFibGUgPSAoc3BlY2ltZW4pID0+IGlzUGFzc2FibGUoc3BlY2ltZW4pICYmIGNhbkJlRHVyYWJsZTIoc3BlY2ltZW4pO1xuaGFyZGVuKGlzU3RvcmFibGUpO1xudmFyIGF0dGFjaER1cmFibGVTdG9yZXMgPSAoZ2V0QmFnZ2FnZSkgPT4ge1xuICBjb25zdCBtYXBTdG9yZSA9IChsYWJlbCwgb3B0aW9ucykgPT4ge1xuICAgIGNvbnN0IGJhZ2dhZ2UgPSBnZXRCYWdnYWdlKCk7XG4gICAgY29uc3QgcmV0ID0gcHJvdmlkZUR1cmFibGVNYXBTdG9yZTIoYmFnZ2FnZSwgbGFiZWwsIG9wdGlvbnMpO1xuICAgIHJldHVybiByZXQ7XG4gIH07XG4gIGNvbnN0IHNldFN0b3JlID0gKGxhYmVsLCBvcHRpb25zKSA9PiBwcm92aWRlRHVyYWJsZVNldFN0b3JlMihnZXRCYWdnYWdlKCksIGxhYmVsLCBvcHRpb25zKTtcbiAgY29uc3Qgd2Vha1NldFN0b3JlID0gKGxhYmVsLCBvcHRpb25zKSA9PiBwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZTIoZ2V0QmFnZ2FnZSgpLCBsYWJlbCwgb3B0aW9ucyk7XG4gIGNvbnN0IHdlYWtNYXBTdG9yZSA9IChsYWJlbCwgb3B0aW9ucykgPT4gcHJvdmlkZUR1cmFibGVXZWFrTWFwU3RvcmUyKGdldEJhZ2dhZ2UoKSwgbGFiZWwsIG9wdGlvbnMpO1xuICByZXR1cm4gRmFyKFwiZHVyYWJsZVN0b3Jlc1wiLCB7XG4gICAgZGV0YWNoZWQ6ICgpID0+IGRldGFjaGVkRHVyYWJsZVN0b3JlcyxcbiAgICBpc1N0b3JhYmxlLFxuICAgIG1hcFN0b3JlLFxuICAgIHNldFN0b3JlLFxuICAgIHdlYWtNYXBTdG9yZSxcbiAgICB3ZWFrU2V0U3RvcmVcbiAgfSk7XG59O1xudmFyIGRldGFjaGVkRHVyYWJsZVN0b3JlcyA9IGF0dGFjaER1cmFibGVTdG9yZXMoXG4gICgpID0+IG1ha2VTY2FsYXJNYXBTdG9yZTQoXCJkZXRhY2hlZFwiKVxuKTtcbnZhciBtYWtlRHVyYWJsZVpvbmUgPSAoYmFnZ2FnZSwgYmFzZUxhYmVsID0gXCJkdXJhYmxlWm9uZVwiKSA9PiB7XG4gIGJhZ2dhZ2UgfHwgdGhyb3dSZWRhY3RlZGBiYWdnYWdlIHJlcXVpcmVkYDtcbiAgY29uc3QgYXR0YWNoZWRTdG9yZXMgPSBhdHRhY2hEdXJhYmxlU3RvcmVzKCgpID0+IGJhZ2dhZ2UpO1xuICBjb25zdCB7IG1ha2VPbmNlLCB3cmFwUHJvdmlkZXIgfSA9IG1ha2VPbmNlS2l0KFxuICAgIGJhc2VMYWJlbCxcbiAgICBhdHRhY2hlZFN0b3JlcyxcbiAgICBiYWdnYWdlXG4gICk7XG4gIGNvbnN0IGV4b0NsYXNzID0gKC4uLmFyZ3MpID0+IHByZXBhcmVFeG9DbGFzczIoYmFnZ2FnZSwgLi4uYXJncyk7XG4gIGNvbnN0IGV4b0NsYXNzS2l0ID0gKC4uLmFyZ3MpID0+IHByZXBhcmVFeG9DbGFzc0tpdDIoYmFnZ2FnZSwgLi4uYXJncyk7XG4gIGNvbnN0IGV4byA9ICguLi5hcmdzKSA9PiBwcmVwYXJlRXhvMihiYWdnYWdlLCAuLi5hcmdzKTtcbiAgY29uc3Qgc3ViWm9uZVN0b3JlID0gd3JhcFByb3ZpZGVyKGF0dGFjaGVkU3RvcmVzLm1hcFN0b3JlLCBhZ29yaWNWYXREYXRhS2V5cy56b25lKTtcbiAgY29uc3Qgc3ViWm9uZSA9IChsYWJlbCwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gICAgY29uc3Qgc3ViQmFnZ2FnZSA9IHN1YlpvbmVTdG9yZShsYWJlbCwgb3B0aW9ucyk7XG4gICAgcmV0dXJuIG1ha2VEdXJhYmxlWm9uZShzdWJCYWdnYWdlLCBgJHtiYXNlTGFiZWx9LiR7bGFiZWx9YCk7XG4gIH07XG4gIHJldHVybiBGYXIoXCJkdXJhYmxlWm9uZVwiLCB7XG4gICAgZXhvOiB3cmFwUHJvdmlkZXIoZXhvLCBhZ29yaWNWYXREYXRhS2V5cy5leG8pLFxuICAgIGV4b0NsYXNzOiB3cmFwUHJvdmlkZXIoZXhvQ2xhc3MsIGFnb3JpY1ZhdERhdGFLZXlzLmV4b0NsYXNzKSxcbiAgICBleG9DbGFzc0tpdDogd3JhcFByb3ZpZGVyKGV4b0NsYXNzS2l0LCBhZ29yaWNWYXREYXRhS2V5cy5leG9DbGFzc0tpdCksXG4gICAgc3ViWm9uZSxcbiAgICBtYWtlT25jZSxcbiAgICB3YXRjaFByb21pc2U6IHdhdGNoUHJvbWlzZTMsXG4gICAgZGV0YWNoZWQ6IGF0dGFjaGVkU3RvcmVzLmRldGFjaGVkLFxuICAgIGlzU3RvcmFibGU6IGF0dGFjaGVkU3RvcmVzLmlzU3RvcmFibGUsXG4gICAgbWFwU3RvcmU6IHdyYXBQcm92aWRlcihhdHRhY2hlZFN0b3Jlcy5tYXBTdG9yZSwgYWdvcmljVmF0RGF0YUtleXMuc3RvcmUpLFxuICAgIHNldFN0b3JlOiB3cmFwUHJvdmlkZXIoYXR0YWNoZWRTdG9yZXMuc2V0U3RvcmUsIGFnb3JpY1ZhdERhdGFLZXlzLnN0b3JlKSxcbiAgICB3ZWFrTWFwU3RvcmU6IHdyYXBQcm92aWRlcihhdHRhY2hlZFN0b3Jlcy53ZWFrTWFwU3RvcmUsIGFnb3JpY1ZhdERhdGFLZXlzLnN0b3JlKSxcbiAgICB3ZWFrU2V0U3RvcmU6IHdyYXBQcm92aWRlcihhdHRhY2hlZFN0b3Jlcy53ZWFrU2V0U3RvcmUsIGFnb3JpY1ZhdERhdGFLZXlzLnN0b3JlKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUR1cmFibGVab25lKTtcblxuLy9cbnZhciBpbXBvcnRfZW5jb2RpbmcgPSBfX3RvRVNNKHJlcXVpcmVfYnVpbGQoKSwgMSk7XG5cbi8vXG5mdW5jdGlvbiBiYXNlKEFMUEhBQkVUMikge1xuICBpZiAoQUxQSEFCRVQyLmxlbmd0aCA+PSAyNTUpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQWxwaGFiZXQgdG9vIGxvbmdcIik7XG4gIH1cbiAgY29uc3QgQkFTRV9NQVAgPSBuZXcgVWludDhBcnJheSgyNTYpO1xuICBmb3IgKGxldCBqID0gMDsgaiA8IEJBU0VfTUFQLmxlbmd0aDsgaisrKSB7XG4gICAgQkFTRV9NQVBbal0gPSAyNTU7XG4gIH1cbiAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IEFMUEhBQkVUMi5sZW5ndGg7IGkyKyspIHtcbiAgICBjb25zdCB4ID0gQUxQSEFCRVQyLmNoYXJBdChpMik7XG4gICAgY29uc3QgeGMgPSB4LmNoYXJDb2RlQXQoMCk7XG4gICAgaWYgKEJBU0VfTUFQW3hjXSAhPT0gMjU1KSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHggKyBcIiBpcyBhbWJpZ3VvdXNcIik7XG4gICAgfVxuICAgIEJBU0VfTUFQW3hjXSA9IGkyO1xuICB9XG4gIGNvbnN0IEJBU0UgPSBBTFBIQUJFVDIubGVuZ3RoO1xuICBjb25zdCBMRUFERVIgPSBBTFBIQUJFVDIuY2hhckF0KDApO1xuICBjb25zdCBGQUNUT1IgPSBNYXRoLmxvZyhCQVNFKSAvIE1hdGgubG9nKDI1Nik7XG4gIGNvbnN0IGlGQUNUT1IgPSBNYXRoLmxvZygyNTYpIC8gTWF0aC5sb2coQkFTRSk7XG4gIGZ1bmN0aW9uIGVuY29kZShzb3VyY2UpIHtcbiAgICBpZiAoc291cmNlIGluc3RhbmNlb2YgVWludDhBcnJheSkge1xuICAgIH0gZWxzZSBpZiAoQXJyYXlCdWZmZXIuaXNWaWV3KHNvdXJjZSkpIHtcbiAgICAgIHNvdXJjZSA9IG5ldyBVaW50OEFycmF5KHNvdXJjZS5idWZmZXIsIHNvdXJjZS5ieXRlT2Zmc2V0LCBzb3VyY2UuYnl0ZUxlbmd0aCk7XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHNvdXJjZSkpIHtcbiAgICAgIHNvdXJjZSA9IFVpbnQ4QXJyYXkuZnJvbShzb3VyY2UpO1xuICAgIH1cbiAgICBpZiAoIShzb3VyY2UgaW5zdGFuY2VvZiBVaW50OEFycmF5KSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkV4cGVjdGVkIFVpbnQ4QXJyYXlcIik7XG4gICAgfVxuICAgIGlmIChzb3VyY2UubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gICAgbGV0IHplcm9lczIgPSAwO1xuICAgIGxldCBsZW5ndGggPSAwO1xuICAgIGxldCBwYmVnaW4gPSAwO1xuICAgIGNvbnN0IHBlbmQgPSBzb3VyY2UubGVuZ3RoO1xuICAgIHdoaWxlIChwYmVnaW4gIT09IHBlbmQgJiYgc291cmNlW3BiZWdpbl0gPT09IDApIHtcbiAgICAgIHBiZWdpbisrO1xuICAgICAgemVyb2VzMisrO1xuICAgIH1cbiAgICBjb25zdCBzaXplID0gKHBlbmQgLSBwYmVnaW4pICogaUZBQ1RPUiArIDEgPj4+IDA7XG4gICAgY29uc3QgYjU4ID0gbmV3IFVpbnQ4QXJyYXkoc2l6ZSk7XG4gICAgd2hpbGUgKHBiZWdpbiAhPT0gcGVuZCkge1xuICAgICAgbGV0IGNhcnJ5ID0gc291cmNlW3BiZWdpbl07XG4gICAgICBsZXQgaTIgPSAwO1xuICAgICAgZm9yIChsZXQgaXQxID0gc2l6ZSAtIDE7IChjYXJyeSAhPT0gMCB8fCBpMiA8IGxlbmd0aCkgJiYgaXQxICE9PSAtMTsgaXQxLS0sIGkyKyspIHtcbiAgICAgICAgY2FycnkgKz0gMjU2ICogYjU4W2l0MV0gPj4+IDA7XG4gICAgICAgIGI1OFtpdDFdID0gY2FycnkgJSBCQVNFID4+PiAwO1xuICAgICAgICBjYXJyeSA9IGNhcnJ5IC8gQkFTRSA+Pj4gMDtcbiAgICAgIH1cbiAgICAgIGlmIChjYXJyeSAhPT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb24temVybyBjYXJyeVwiKTtcbiAgICAgIH1cbiAgICAgIGxlbmd0aCA9IGkyO1xuICAgICAgcGJlZ2luKys7XG4gICAgfVxuICAgIGxldCBpdDIgPSBzaXplIC0gbGVuZ3RoO1xuICAgIHdoaWxlIChpdDIgIT09IHNpemUgJiYgYjU4W2l0Ml0gPT09IDApIHtcbiAgICAgIGl0MisrO1xuICAgIH1cbiAgICBsZXQgc3RyID0gTEVBREVSLnJlcGVhdCh6ZXJvZXMyKTtcbiAgICBmb3IgKDsgaXQyIDwgc2l6ZTsgKytpdDIpIHtcbiAgICAgIHN0ciArPSBBTFBIQUJFVDIuY2hhckF0KGI1OFtpdDJdKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0cjtcbiAgfVxuICBmdW5jdGlvbiBkZWNvZGVVbnNhZmUoc291cmNlKSB7XG4gICAgaWYgKHR5cGVvZiBzb3VyY2UgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJFeHBlY3RlZCBTdHJpbmdcIik7XG4gICAgfVxuICAgIGlmIChzb3VyY2UubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoKTtcbiAgICB9XG4gICAgbGV0IHBzeiA9IDA7XG4gICAgbGV0IHplcm9lczIgPSAwO1xuICAgIGxldCBsZW5ndGggPSAwO1xuICAgIHdoaWxlIChzb3VyY2VbcHN6XSA9PT0gTEVBREVSKSB7XG4gICAgICB6ZXJvZXMyKys7XG4gICAgICBwc3orKztcbiAgICB9XG4gICAgY29uc3Qgc2l6ZSA9IChzb3VyY2UubGVuZ3RoIC0gcHN6KSAqIEZBQ1RPUiArIDEgPj4+IDA7XG4gICAgY29uc3QgYjI1NiA9IG5ldyBVaW50OEFycmF5KHNpemUpO1xuICAgIHdoaWxlIChwc3ogPCBzb3VyY2UubGVuZ3RoKSB7XG4gICAgICBjb25zdCBjaGFyQ29kZSA9IHNvdXJjZS5jaGFyQ29kZUF0KHBzeik7XG4gICAgICBpZiAoY2hhckNvZGUgPiAyNTUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgbGV0IGNhcnJ5ID0gQkFTRV9NQVBbY2hhckNvZGVdO1xuICAgICAgaWYgKGNhcnJ5ID09PSAyNTUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgbGV0IGkyID0gMDtcbiAgICAgIGZvciAobGV0IGl0MyA9IHNpemUgLSAxOyAoY2FycnkgIT09IDAgfHwgaTIgPCBsZW5ndGgpICYmIGl0MyAhPT0gLTE7IGl0My0tLCBpMisrKSB7XG4gICAgICAgIGNhcnJ5ICs9IEJBU0UgKiBiMjU2W2l0M10gPj4+IDA7XG4gICAgICAgIGIyNTZbaXQzXSA9IGNhcnJ5ICUgMjU2ID4+PiAwO1xuICAgICAgICBjYXJyeSA9IGNhcnJ5IC8gMjU2ID4+PiAwO1xuICAgICAgfVxuICAgICAgaWYgKGNhcnJ5ICE9PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vbi16ZXJvIGNhcnJ5XCIpO1xuICAgICAgfVxuICAgICAgbGVuZ3RoID0gaTI7XG4gICAgICBwc3orKztcbiAgICB9XG4gICAgbGV0IGl0NCA9IHNpemUgLSBsZW5ndGg7XG4gICAgd2hpbGUgKGl0NCAhPT0gc2l6ZSAmJiBiMjU2W2l0NF0gPT09IDApIHtcbiAgICAgIGl0NCsrO1xuICAgIH1cbiAgICBjb25zdCB2Y2ggPSBuZXcgVWludDhBcnJheSh6ZXJvZXMyICsgKHNpemUgLSBpdDQpKTtcbiAgICBsZXQgaiA9IHplcm9lczI7XG4gICAgd2hpbGUgKGl0NCAhPT0gc2l6ZSkge1xuICAgICAgdmNoW2orK10gPSBiMjU2W2l0NCsrXTtcbiAgICB9XG4gICAgcmV0dXJuIHZjaDtcbiAgfVxuICBmdW5jdGlvbiBkZWNvZGUoc3RyaW5nKSB7XG4gICAgY29uc3QgYnVmZmVyID0gZGVjb2RlVW5zYWZlKHN0cmluZyk7XG4gICAgaWYgKGJ1ZmZlcikge1xuICAgICAgcmV0dXJuIGJ1ZmZlcjtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTm9uLWJhc2VcIiArIEJBU0UgKyBcIiBjaGFyYWN0ZXJcIik7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBlbmNvZGUsXG4gICAgZGVjb2RlVW5zYWZlLFxuICAgIGRlY29kZVxuICB9O1xufVxudmFyIGVzbV9kZWZhdWx0ID0gYmFzZTtcblxuLy9cbnZhciBBTFBIQUJFVCA9IFwiMTIzNDU2Nzg5QUJDREVGR0hKS0xNTlBRUlNUVVZXWFlaYWJjZGVmZ2hpamttbm9wcXJzdHV2d3h5elwiO1xudmFyIGVzbV9kZWZhdWx0MiA9IGVzbV9kZWZhdWx0KEFMUEhBQkVUKTtcblxuLy9cbnZhciBtYWtlSUNBQ2hhbm5lbEFkZHJlc3MgPSAoaG9zdENvbm5lY3Rpb25JZCwgY29udHJvbGxlckNvbm5lY3Rpb25JZCwge1xuICB2ZXJzaW9uID0gXCJpY3MyNy0xXCIsXG4gIGVuY29kaW5nID0gXCJwcm90bzNcIixcbiAgb3JkZXJpbmcgPSBcIm9yZGVyZWRcIixcbiAgdHhUeXBlID0gXCJzZGtfbXVsdGlfbXNnXCJcbn0gPSB7fSkgPT4ge1xuICBob3N0Q29ubmVjdGlvbklkIHx8IHRocm93UmVkYWN0ZWRgaG9zdENvbm5lY3Rpb25JZCBpcyByZXF1aXJlZGA7XG4gIGNvbnRyb2xsZXJDb25uZWN0aW9uSWQgfHwgdGhyb3dSZWRhY3RlZGBjb250cm9sbGVyQ29ubmVjdGlvbklkIGlzIHJlcXVpcmVkYDtcbiAgY29uc3QgY29ublN0cmluZyA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICB2ZXJzaW9uLFxuICAgIGNvbnRyb2xsZXJDb25uZWN0aW9uSWQsXG4gICAgaG9zdENvbm5lY3Rpb25JZCxcbiAgICBhZGRyZXNzOiBcIlwiLFxuICAgIC8vXG4gICAgZW5jb2RpbmcsXG4gICAgdHhUeXBlXG4gIH0pO1xuICByZXR1cm4gYC9pYmMtaG9wLyR7Y29udHJvbGxlckNvbm5lY3Rpb25JZH0vaWJjLXBvcnQvaWNhaG9zdC8ke29yZGVyaW5nfS8ke2Nvbm5TdHJpbmd9YDtcbn07XG5oYXJkZW4obWFrZUlDQUNoYW5uZWxBZGRyZXNzKTtcbnZhciBERUZBVUxUX0lDUV9WRVJTSU9OID0gXCJpY3EtMVwiO1xudmFyIG1ha2VJQ1FDaGFubmVsQWRkcmVzcyA9IChjb250cm9sbGVyQ29ubmVjdGlvbklkLCB2ZXJzaW9uID0gREVGQVVMVF9JQ1FfVkVSU0lPTikgPT4ge1xuICBjb250cm9sbGVyQ29ubmVjdGlvbklkIHx8IHRocm93UmVkYWN0ZWRgY29udHJvbGxlckNvbm5lY3Rpb25JZCBpcyByZXF1aXJlZGA7XG4gIHJldHVybiBgL2liYy1ob3AvJHtjb250cm9sbGVyQ29ubmVjdGlvbklkfS9pYmMtcG9ydC9pY3Fob3N0L3Vub3JkZXJlZC8ke3ZlcnNpb259YDtcbn07XG5oYXJkZW4obWFrZUlDUUNoYW5uZWxBZGRyZXNzKTtcbnZhciBmaW5kQWRkcmVzc0ZpZWxkID0gKHJlbW90ZUFkZHJlc3NTdHJpbmcpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBqc29uU3RyID0gcmVtb3RlQWRkcmVzc1N0cmluZz8ubWF0Y2goL3suKj99Lyk/LlswXTtcbiAgICBjb25zdCBqc29uT2JqID0ganNvblN0ciA/IEpTT04ucGFyc2UoanNvblN0cikgOiB2b2lkIDA7XG4gICAgaWYgKCFqc29uT2JqPy5hZGRyZXNzPy5sZW5ndGgpIHJldHVybiB2b2lkIDA7XG4gICAgcmV0dXJuIGpzb25PYmouYWRkcmVzcztcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG59O1xuaGFyZGVuKGZpbmRBZGRyZXNzRmllbGQpO1xudmFyIGdldEJlY2gzMlByZWZpeCA9IChhZGRyZXNzKSA9PiB7XG4gIGFzc2VydChhZGRyZXNzLCBcImFkZHJlc3MgaXMgcmVxdWlyZWRcIik7XG4gIGNvbnN0IHNwbGl0ID0gYWRkcmVzcy5sYXN0SW5kZXhPZihcIjFcIik7XG4gIGlmIChzcGxpdCA9PT0gLTEpIHJldHVybiB0aHJvd1JlZGFjdGVkYE5vIHNlcGFyYXRvciBjaGFyYWN0ZXIgZm9yICR7cXVvdGUoYWRkcmVzcyl9YDtcbiAgaWYgKHNwbGl0ID09PSAwKSByZXR1cm4gdGhyb3dSZWRhY3RlZGBNaXNzaW5nIHByZWZpeCBmb3IgJHtxdW90ZShhZGRyZXNzKX1gO1xuICByZXR1cm4gYWRkcmVzcy5zbGljZSgwLCBzcGxpdCk7XG59O1xudmFyIGNvZXJjZUFjY291bnRJZCA9IChpZEFyZykgPT4ge1xuICBpZiAodHlwZW9mIGlkQXJnID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIGlkQXJnO1xuICB9XG4gIHJldHVybiBgY29zbW9zOiR7aWRBcmcuY2hhaW5JZH06JHtpZEFyZy52YWx1ZX1gO1xufTtcbmhhcmRlbihjb2VyY2VBY2NvdW50SWQpO1xudmFyIHBhcnNlQWNjb3VudElkQXJnID0gKGlkQXJnKSA9PiB7XG4gIGlmICh0eXBlb2YgaWRBcmcgPT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gcGFyc2VBY2NvdW50SWQoaWRBcmcpO1xuICB9XG4gIHJldHVybiB7XG4gICAgbmFtZXNwYWNlOiBcImNvc21vc1wiLFxuICAgIHJlZmVyZW5jZTogaWRBcmcuY2hhaW5JZCxcbiAgICBhY2NvdW50QWRkcmVzczogaWRBcmcudmFsdWVcbiAgfTtcbn07XG5oYXJkZW4ocGFyc2VBY2NvdW50SWRBcmcpO1xudmFyIHBhcnNlQWNjb3VudElkID0gKGFjY291bnRJZCkgPT4ge1xuICBjb25zdCBwYXJ0cyA9IGFjY291bnRJZC5zcGxpdChcIjpcIik7XG4gIHBhcnRzLmxlbmd0aCA9PT0gMyB8fCB0aHJvd1JlZGFjdGVkYG1hbGZvcm1lZCBDQUlQLTEwIGFjY291bnRJZDogJHtxdW90ZShhY2NvdW50SWQpfWA7XG4gIGNvbnN0IFtuYW1lc3BhY2UsIHJlZmVyZW5jZSwgYWNjb3VudEFkZHJlc3NdID0gcGFydHM7XG4gIHJldHVybiB7XG4gICAgbmFtZXNwYWNlLFxuICAgIHJlZmVyZW5jZSxcbiAgICBhY2NvdW50QWRkcmVzc1xuICB9O1xufTtcbmhhcmRlbihwYXJzZUFjY291bnRJZCk7XG52YXIgaXNCZWNoMzJBZGRyZXNzID0gKGFkZHJlc3MpID0+IHtcbiAgaWYgKHR5cGVvZiBhZGRyZXNzICE9PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHRyeSB7XG4gICAgY29uc3QgZGVjb2RlZCA9ICgwLCBpbXBvcnRfZW5jb2RpbmcuZnJvbUJlY2gzMikoYWRkcmVzcyk7XG4gICAgcmV0dXJuICEhZGVjb2RlZCAmJiBkZWNvZGVkLmRhdGEubGVuZ3RoID4gMDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5oYXJkZW4oaXNCZWNoMzJBZGRyZXNzKTtcbnZhciBhc3NlcnRCZWNoMzJBZGRyZXNzID0gKGFkZHJlc3MpID0+IHtcbiAgaWYgKCFpc0JlY2gzMkFkZHJlc3MoYWRkcmVzcykpIHtcbiAgICB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkIGEgdmFsaWQgQmVjaDMyIGFkZHJlc3MsIGdvdCAke3F1b3RlKGFkZHJlc3MpfWA7XG4gIH1cbn07XG5oYXJkZW4oYXNzZXJ0QmVjaDMyQWRkcmVzcyk7XG52YXIgbGVmdFBhZEV0aEFkZHJlc3NUbzMyQnl0ZXMgPSAocmF3QWRkcmVzcykgPT4ge1xuICBjb25zdCBjbGVhbmVkQWRkcmVzcyA9IHJhd0FkZHJlc3MucmVwbGFjZSgvXjB4LywgXCJcIik7XG4gIGNvbnN0IHplcm9lc05lZWRlZCA9IDY0IC0gY2xlYW5lZEFkZHJlc3MubGVuZ3RoO1xuICBjb25zdCBwYWRkZWRBZGRyZXNzID0gXCIwXCIucmVwZWF0KHplcm9lc05lZWRlZCkgKyBjbGVhbmVkQWRkcmVzcztcbiAgcmV0dXJuICgwLCBpbXBvcnRfZW5jb2RpbmcuZnJvbUhleCkocGFkZGVkQWRkcmVzcyk7XG59O1xudmFyIHNvbGFuYUFkZHJlc3NUb0NjdHBSZWNpcGllbnQgPSAoc29sYW5hQWRkcmVzcykgPT4gZXNtX2RlZmF1bHQyLmRlY29kZShzb2xhbmFBZGRyZXNzKTtcbnZhciBhY2NvdW50SWRUbzMyQnl0ZXMgPSAoYWNjb3VudElkKSA9PiB7XG4gIGNvbnN0IHsgbmFtZXNwYWNlLCBhY2NvdW50QWRkcmVzcyB9ID0gcGFyc2VBY2NvdW50SWQoYWNjb3VudElkKTtcbiAgc3dpdGNoIChuYW1lc3BhY2UpIHtcbiAgICBjYXNlIFwiZWlwMTU1XCI6XG4gICAgICByZXR1cm4gbGVmdFBhZEV0aEFkZHJlc3NUbzMyQnl0ZXMoYWNjb3VudEFkZHJlc3MpO1xuICAgIGNhc2UgXCJzb2xhbmFcIjpcbiAgICAgIHJldHVybiBzb2xhbmFBZGRyZXNzVG9DY3RwUmVjaXBpZW50KGFjY291bnRBZGRyZXNzKTtcbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBuYW1lc3BhY2UgJHtuYW1lc3BhY2V9IG5vdCBzdXBwb3J0ZWRgKTtcbiAgfVxufTtcblxuLy9cbnZhciBjYWlwSWRGcm9tSW5mbyA9IChpbmZvKSA9PiB7XG4gIHJldHVybiBgJHtpbmZvLm5hbWVzcGFjZX06JHtpbmZvLnJlZmVyZW5jZX1gO1xufTtcblxuLy9cbnZhciBQRk1fUkVDRUlWRVIgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIFwicGZtXCJcbik7XG52YXIgSHViTmFtZSA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBDaGFpbjogXCJjaGFpblwiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIENoYWluQXNzZXRzOiBcImNoYWluQXNzZXRzXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIENoYWluQ29ubmVjdGlvbjogXCJjaGFpbkNvbm5lY3Rpb25cIlxuICB9XG4pO1xuaGFyZGVuKEh1Yk5hbWUpO1xudmFyIENIQUlOX0tFWSA9IEh1Yk5hbWUuQ2hhaW47XG52YXIgQ09OTkVDVElPTlNfS0VZID0gSHViTmFtZS5DaGFpbkNvbm5lY3Rpb247XG52YXIgQVNTRVRTX0tFWSA9IEh1Yk5hbWUuQ2hhaW5Bc3NldHM7XG52YXIgQ0hBSU5fSURfU0VQQVJBVE9SID0gXCJfXCI7XG52YXIgZW5jb2RlQ2hhaW5JZCA9IChjaGFpbklkKSA9PiBjaGFpbklkLnJlcGxhY2VBbGwoXG4gIENIQUlOX0lEX1NFUEFSQVRPUixcbiAgYCR7Q0hBSU5fSURfU0VQQVJBVE9SfSR7Q0hBSU5fSURfU0VQQVJBVE9SfWBcbik7XG52YXIgY29ubmVjdGlvbktleSA9IChjaGFpbklkMSwgY2hhaW5JZDIpID0+IHtcbiAgY29uc3QgY2hhaW5JZDFTYW5pdGl6ZWQgPSBlbmNvZGVDaGFpbklkKGNoYWluSWQxKTtcbiAgY29uc3QgY2hhaW5JZDJTYW5pdGl6ZWQgPSBlbmNvZGVDaGFpbklkKGNoYWluSWQyKTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgW2NoYWluSWQxU2FuaXRpemVkLCBjaGFpbklkMlNhbml0aXplZF0uc29ydCgpLmpvaW4oQ0hBSU5fSURfU0VQQVJBVE9SKVxuICApO1xufTtcbnZhciByZXZlcnNlQ29ubkluZm8gPSAoY29ubkluZm8pID0+IHtcbiAgY29uc3QgeyB0cmFuc2ZlckNoYW5uZWwgfSA9IGNvbm5JbmZvO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBpZDogY29ubkluZm8uY291bnRlcnBhcnR5LmNvbm5lY3Rpb25faWQsXG4gICAgY2xpZW50X2lkOiBjb25uSW5mby5jb3VudGVycGFydHkuY2xpZW50X2lkLFxuICAgIGNvdW50ZXJwYXJ0eToge1xuICAgICAgY2xpZW50X2lkOiBjb25uSW5mby5jbGllbnRfaWQsXG4gICAgICBjb25uZWN0aW9uX2lkOiBjb25uSW5mby5pZFxuICAgIH0sXG4gICAgc3RhdGU6IGNvbm5JbmZvLnN0YXRlLFxuICAgIHRyYW5zZmVyQ2hhbm5lbDoge1xuICAgICAgLi4udHJhbnNmZXJDaGFubmVsLFxuICAgICAgY2hhbm5lbElkOiB0cmFuc2ZlckNoYW5uZWwuY291bnRlclBhcnR5Q2hhbm5lbElkLFxuICAgICAgY291bnRlclBhcnR5Q2hhbm5lbElkOiB0cmFuc2ZlckNoYW5uZWwuY2hhbm5lbElkLFxuICAgICAgcG9ydElkOiB0cmFuc2ZlckNoYW5uZWwuY291bnRlclBhcnR5UG9ydElkLFxuICAgICAgY291bnRlclBhcnR5UG9ydElkOiB0cmFuc2ZlckNoYW5uZWwucG9ydElkXG4gICAgfVxuICB9KTtcbn07XG52YXIgbm9ybWFsaXplQ29ubmVjdGlvbkluZm8gPSAocHJpbWFyeUNoYWluSWQsIGNvdW50ZXJDaGFpbklkLCBkaXJlY3RlZCkgPT4ge1xuICBjb25zdCBrZXkgPSBjb25uZWN0aW9uS2V5KHByaW1hcnlDaGFpbklkLCBjb3VudGVyQ2hhaW5JZCk7XG4gIGlmIChwcmltYXJ5Q2hhaW5JZCA8IGNvdW50ZXJDaGFpbklkKSB7XG4gICAgcmV0dXJuIFtrZXksIGRpcmVjdGVkXTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gW2tleSwgcmV2ZXJzZUNvbm5JbmZvKGRpcmVjdGVkKV07XG4gIH1cbn07XG52YXIgZGVub3JtYWxpemVDb25uZWN0aW9uSW5mbyA9IChwcmltYXJ5Q2hhaW5JZCwgY291bnRlckNoYWluSWQsIG5vcm1hbGl6ZWQpID0+IHtcbiAgaWYgKHByaW1hcnlDaGFpbklkIDwgY291bnRlckNoYWluSWQpIHtcbiAgICByZXR1cm4gbm9ybWFsaXplZDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcmV2ZXJzZUNvbm5JbmZvKG5vcm1hbGl6ZWQpO1xuICB9XG59O1xudmFyIENoYWluSWRBcmdTaGFwZSA9IE0ub3IoXG4gIE0uc3RyaW5nKCksXG4gIE0uc3BsaXRSZWNvcmQoXG4gICAge1xuICAgICAgY2hhaW5JZDogTS5zdHJpbmcoKVxuICAgIH0sXG4gICAgdm9pZCAwLFxuICAgIE0uYW55KClcbiAgKVxuKTtcbnZhciBEZWZhdWx0UGZtVGltZW91dE9wdHMgPSBoYXJkZW4oXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICByZXRyaWVzOiAzLFxuICAgIHRpbWVvdXQ6IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICBcIjEwbVwiXG4gICAgKVxuICB9XG4pO1xudmFyIFRyYW5zZmVyUm91dGVTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBzb3VyY2VQb3J0OiBNLnN0cmluZygpLFxuICAgIHNvdXJjZUNoYW5uZWw6IElCQ0NoYW5uZWxJRFNoYXBlLFxuICAgIHRva2VuOiBDb2luU2hhcGUsXG4gICAgcmVjZWl2ZXI6IE0uc3RyaW5nKClcbiAgfSxcbiAgeyBmb3J3YXJkSW5mbzogRm9yd2FyZEluZm9TaGFwZSB9LFxuICB7fVxuKTtcbnZhciBDaGFpbkh1YkkgPSBNLmludGVyZmFjZShcIkNoYWluSHViXCIsIHtcbiAgcmVnaXN0ZXJDaGFpbjogTS5jYWxsKE0uc3RyaW5nKCksIENoYWluSW5mb1NoYXBlKS5yZXR1cm5zKCksXG4gIHVwZGF0ZUNoYWluOiBNLmNhbGwoTS5zdHJpbmcoKSwgQ2hhaW5JbmZvU2hhcGUpLnJldHVybnMoKSxcbiAgZ2V0Q2hhaW5JbmZvOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldENoYWluSW5mb0J5Q2hhaW5JZDogTS5jYWxsKE0uc3RyaW5nKCkpLnJldHVybnMoQ2hhaW5JbmZvU2hhcGUpLFxuICByZWdpc3RlckNvbm5lY3Rpb246IE0uY2FsbChcbiAgICBNLnN0cmluZygpLFxuICAgIE0uc3RyaW5nKCksXG4gICAgSUJDQ29ubmVjdGlvbkluZm9TaGFwZVxuICApLnJldHVybnMoKSxcbiAgdXBkYXRlQ29ubmVjdGlvbjogTS5jYWxsKFxuICAgIE0uc3RyaW5nKCksXG4gICAgTS5zdHJpbmcoKSxcbiAgICBJQkNDb25uZWN0aW9uSW5mb1NoYXBlXG4gICkucmV0dXJucygpLFxuICBnZXRDb25uZWN0aW9uSW5mbzogTS5jYWxsKENoYWluSWRBcmdTaGFwZSwgQ2hhaW5JZEFyZ1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZ2V0Q2hhaW5zQW5kQ29ubmVjdGlvbjogTS5jYWxsKE0uc3RyaW5nKCksIE0uc3RyaW5nKCkpLnJldHVybnMoVm93U2hhcGUpLFxuICByZWdpc3RlckFzc2V0OiBNLmNhbGwoTS5zdHJpbmcoKSwgRGVub21EZXRhaWxTaGFwZSkucmV0dXJucygpLFxuICB1cGRhdGVBc3NldDogTS5jYWxsKE0uc3RyaW5nKCksIERlbm9tRGV0YWlsU2hhcGUpLnJldHVybnMoKSxcbiAgZ2V0QXNzZXQ6IE0uY2FsbChNLnN0cmluZygpLCBNLnN0cmluZygpKS5yZXR1cm5zKFxuICAgIE0ub3IoRGVub21EZXRhaWxTaGFwZSwgTS51bmRlZmluZWQoKSlcbiAgKSxcbiAgZ2V0RGVub206IE0uY2FsbChCcmFuZFNoYXBlKS5yZXR1cm5zKE0ub3IoTS5zdHJpbmcoKSwgTS51bmRlZmluZWQoKSkpLFxuICBjb2VyY2VDb3Ntb3NBZGRyZXNzOiBNLmNhbGwoQWNjb3VudElkQXJnU2hhcGUpLnJldHVybnMoXG4gICAgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGVcbiAgKSxcbiAgcmVzb2x2ZUFjY291bnRJZDogTS5jYWxsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gIG1ha2VUcmFuc2ZlclJvdXRlOiBNLmNhbGwoQWNjb3VudElkQXJnU2hhcGUsIERlbm9tQW1vdW50U2hhcGUsIE0uc3RyaW5nKCkpLm9wdGlvbmFsKEZvcndhcmRPcHRzU2hhcGUpLnJldHVybnMoTS5vcihNLnVuZGVmaW5lZCgpLCBUcmFuc2ZlclJvdXRlU2hhcGUpKSxcbiAgaXNFbXB0eTogTS5jYWxsKCkucmV0dXJucyhNLmJvb2xlYW4oKSlcbn0pO1xudmFyIG1ha2VDaGFpbkh1YiA9ICh6b25lLCBhZ29yaWNOYW1lcywgdm93VG9vbHMsIHsgY2hhaW5JbmZvVmFsdWVTaGFwZSA9IChcbiAgLyogICAgICAgICAgICAgICAgICAqL1xuICBDaGFpbkluZm9TaGFwZVxuKSB9ID0ge30pID0+IHtcbiAgY29uc3QgY2hhaW5JbmZvcyA9IHpvbmUubWFwU3RvcmUoXCJjaGFpbkluZm9zXCIsIHtcbiAgICBrZXlTaGFwZTogTS5zdHJpbmcoKSxcbiAgICB2YWx1ZVNoYXBlOiBjaGFpbkluZm9WYWx1ZVNoYXBlXG4gIH0pO1xuICBjb25zdCBjb25uZWN0aW9uSW5mb3MgPSB6b25lLm1hcFN0b3JlKFwiY29ubmVjdGlvbkluZm9zXCIsIHtcbiAgICBrZXlTaGFwZTogTS5zdHJpbmcoKSxcbiAgICB2YWx1ZVNoYXBlOiBJQkNDb25uZWN0aW9uSW5mb1NoYXBlXG4gIH0pO1xuICBjb25zdCBkZW5vbURldGFpbHMgPSB6b25lLm1hcFN0b3JlKFwiZGVub21cIiwge1xuICAgIGtleVNoYXBlOiBNLnN0cmluZygpLFxuICAgIHZhbHVlU2hhcGU6IERlbm9tRGV0YWlsU2hhcGVcbiAgfSk7XG4gIGNvbnN0IGJyYW5kRGVub21zID0gem9uZS5tYXBTdG9yZShcImJyYW5kRGVub21cIiwge1xuICAgIGtleVNoYXBlOiBCcmFuZFNoYXBlLFxuICAgIHZhbHVlU2hhcGU6IE0uc3RyaW5nKClcbiAgfSk7XG4gIGNvbnN0IGJlY2gzMlByZWZpeFRvQ2hhaW5OYW1lID0gem9uZS5tYXBTdG9yZShcImJlY2gzMlByZWZpeFRvQ2hhaW5OYW1lXCIsIHtcbiAgICBrZXlTaGFwZTogTS5zdHJpbmcoKSxcbiAgICB2YWx1ZVNoYXBlOiBNLnN0cmluZygpXG4gIH0pO1xuICBjb25zdCBjaGFpbklkVG9DaGFpbk5hbWUgPSB6b25lLm1hcFN0b3JlKFwiY2hhaW5JZFRvQ2hhaW5OYW1lXCIsIHtcbiAgICBrZXlTaGFwZTogTS5zdHJpbmcoKSxcbiAgICB2YWx1ZVNoYXBlOiBNLnN0cmluZygpXG4gIH0pO1xuICBjb25zdCBtYWtlRGVub21LZXkgPSAoZGVub20sIHNyY0NoYWluTmFtZSkgPT4gYCR7c3JjQ2hhaW5OYW1lfToke2Rlbm9tfWA7XG4gIGNvbnN0IHJlc29sdmVDb3Ntb3NDaGFpbklkID0gKGFkZHJlc3MpID0+IHtcbiAgICBjb25zdCBwcmVmaXggPSBnZXRCZWNoMzJQcmVmaXgoYWRkcmVzcyk7XG4gICAgaWYgKCFiZWNoMzJQcmVmaXhUb0NoYWluTmFtZS5oYXMocHJlZml4KSkge1xuICAgICAgdGhyb3cgbWFrZUVycm9yKGBDaGFpbiBpbmZvIG5vdCBmb3VuZCBmb3IgYmVjaDMyUHJlZml4ICR7cXVvdGUocHJlZml4KX1gKTtcbiAgICB9XG4gICAgY29uc3QgY2hhaW5OYW1lID0gYmVjaDMyUHJlZml4VG9DaGFpbk5hbWUuZ2V0KHByZWZpeCk7XG4gICAgY29uc3QgeyBjaGFpbklkIH0gPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGNoYWluSW5mb3MuZ2V0KGNoYWluTmFtZSlcbiAgICApO1xuICAgIHJldHVybiBjaGFpbklkO1xuICB9O1xuICBjb25zdCBsb29rdXBDaGFpbkluZm8gPSB2b3dUb29scy5yZXRyeWFibGUoXG4gICAgem9uZSxcbiAgICBcImxvb2t1cENoYWluSW5mb1wiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgLy9cbiAgICBhc3luYyAoY2hhaW5OYW1lKSA9PiB7XG4gICAgICBhd2FpdCBudWxsO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY2hhaW5JbmZvID0gYXdhaXQgRShhZ29yaWNOYW1lcykubG9va3VwKEh1Yk5hbWUuQ2hhaW4sIGNoYWluTmFtZSk7XG4gICAgICAgIGlmICghY2hhaW5JbmZvcy5oYXMoY2hhaW5OYW1lKSkge1xuICAgICAgICAgIGNoYWluSW5mb3MuaW5pdChjaGFpbk5hbWUsIGNoYWluSW5mbyk7XG4gICAgICAgICAgY2hhaW5JZFRvQ2hhaW5OYW1lLmluaXQoY2FpcElkRnJvbUluZm8oY2hhaW5JbmZvKSwgY2hhaW5OYW1lKTtcbiAgICAgICAgICBpZiAoY2hhaW5JbmZvLmJlY2gzMlByZWZpeCkge1xuICAgICAgICAgICAgYmVjaDMyUHJlZml4VG9DaGFpbk5hbWUuaW5pdChjaGFpbkluZm8uYmVjaDMyUHJlZml4LCBjaGFpbk5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hhaW5JbmZvO1xuICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcImxvb2t1cENoYWluSW5mb1wiLCBjaGFpbk5hbWUsIFwiZXJyb3JcIiwgZTIpO1xuICAgICAgICB0aHJvdyBtYWtlRXJyb3IoYGNoYWluIG5vdCBmb3VuZDoke2NoYWluTmFtZX1gKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IGxvb2t1cENvbm5lY3Rpb25JbmZvID0gdm93VG9vbHMucmV0cnlhYmxlKFxuICAgIHpvbmUsXG4gICAgXCJsb29rdXBDb25uZWN0aW9uSW5mb1wiLFxuICAgIC8qXG5cblxuICAgICAqL1xuICAgIC8vXG4gICAgYXN5bmMgKGNoYWluSWQxLCBjaGFpbklkMikgPT4ge1xuICAgICAgYXdhaXQgbnVsbDtcbiAgICAgIGNvbnN0IGtleSA9IGNvbm5lY3Rpb25LZXkoY2hhaW5JZDEsIGNoYWluSWQyKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbm5lY3Rpb25JbmZvID0gYXdhaXQgRShhZ29yaWNOYW1lcykubG9va3VwKFxuICAgICAgICAgIEh1Yk5hbWUuQ2hhaW5Db25uZWN0aW9uLFxuICAgICAgICAgIGtleVxuICAgICAgICApO1xuICAgICAgICBpZiAoIWNvbm5lY3Rpb25JbmZvcy5oYXMoa2V5KSkge1xuICAgICAgICAgIGNvbm5lY3Rpb25JbmZvcy5pbml0KGtleSwgY29ubmVjdGlvbkluZm8pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkZW5vcm1hbGl6ZUNvbm5lY3Rpb25JbmZvKGNoYWluSWQxLCBjaGFpbklkMiwgY29ubmVjdGlvbkluZm8pO1xuICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcImxvb2t1cENvbm5lY3Rpb25JbmZvXCIsIGNoYWluSWQxLCBjaGFpbklkMiwgXCJlcnJvclwiLCBlMik7XG4gICAgICAgIHRocm93IG1ha2VFcnJvcihgY29ubmVjdGlvbiBub3QgZm91bmQ6ICR7Y2hhaW5JZDF9PC0+JHtjaGFpbklkMn1gKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IGxvb2t1cENoYWluc0FuZENvbm5lY3Rpb24gPSB2b3dUb29scy5yZXRyeWFibGUoXG4gICAgem9uZSxcbiAgICBcImxvb2t1cENoYWluc0FuZENvbm5lY3Rpb25cIixcbiAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICAvL1xuICAgIGFzeW5jIChwcmltYXJ5TmFtZSwgY291bnRlck5hbWUpID0+IHtcbiAgICAgIGNvbnN0IFtwcmltYXJ5LCBjb3VudGVyXSA9IGF3YWl0IHZvd1Rvb2xzLmFzUHJvbWlzZShcbiAgICAgICAgdm93VG9vbHMuYWxsVm93cyhbXG4gICAgICAgICAgY2hhaW5IdWIuZ2V0Q2hhaW5JbmZvKHByaW1hcnlOYW1lKSxcbiAgICAgICAgICBjaGFpbkh1Yi5nZXRDaGFpbkluZm8oY291bnRlck5hbWUpXG4gICAgICAgIF0pXG4gICAgICApO1xuICAgICAgY29uc3QgY29ubmVjdGlvbkluZm8gPSBwcmltYXJ5Lm5hbWVzcGFjZSA9PT0gXCJjb3Ntb3NcIiAmJiBjb3VudGVyLm5hbWVzcGFjZSA9PT0gXCJjb3Ntb3NcIiA/IGF3YWl0IHZvd1Rvb2xzLmFzUHJvbWlzZShcbiAgICAgICAgY2hhaW5IdWIuZ2V0Q29ubmVjdGlvbkluZm8ocHJpbWFyeSwgY291bnRlcilcbiAgICAgICkgOiB2b2lkIDA7XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIFtwcmltYXJ5LCBjb3VudGVyLCBjb25uZWN0aW9uSW5mb11cbiAgICAgICk7XG4gICAgfVxuICApO1xuICBjb25zdCBjaGFpbkh1YiA9IHpvbmUuZXhvKFwiQ2hhaW5IdWJcIiwgQ2hhaW5IdWJJLCB7XG4gICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIHJlZ2lzdGVyQ2hhaW4obmFtZSwgY2hhaW5JbmZvKSB7XG4gICAgICBjaGFpbkluZm9zLmluaXQobmFtZSwgY2hhaW5JbmZvKTtcbiAgICAgIGNoYWluSWRUb0NoYWluTmFtZS5pbml0KGNhaXBJZEZyb21JbmZvKGNoYWluSW5mbyksIG5hbWUpO1xuICAgICAgaWYgKGNoYWluSW5mby5uYW1lc3BhY2UgPT09IFwiY29zbW9zXCIgJiYgY2hhaW5JbmZvLmJlY2gzMlByZWZpeCkge1xuICAgICAgICBiZWNoMzJQcmVmaXhUb0NoYWluTmFtZS5pbml0KGNoYWluSW5mby5iZWNoMzJQcmVmaXgsIG5hbWUpO1xuICAgICAgfVxuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG4gICAgICovXG4gICAgdXBkYXRlQ2hhaW4oY2hhaW5OYW1lLCBjaGFpbkluZm8pIHtcbiAgICAgIGlmICghY2hhaW5JbmZvcy5oYXMoY2hhaW5OYW1lKSkge1xuICAgICAgICB0aHJvdyBtYWtlRXJyb3IoYENoYWluICR7cXVvdGUoY2hhaW5OYW1lKX0gbm90IHJlZ2lzdGVyZWRgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG9sZEluZm8gPSBjaGFpbkluZm9zLmdldChjaGFpbk5hbWUpO1xuICAgICAgaWYgKGNoYWluSWRUb0NoYWluTmFtZS5oYXMoY2FpcElkRnJvbUluZm8ob2xkSW5mbykpKSB7XG4gICAgICAgIGNoYWluSWRUb0NoYWluTmFtZS5kZWxldGUoY2FpcElkRnJvbUluZm8ob2xkSW5mbykpO1xuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgb2xkSW5mby5iZWNoMzJQcmVmaXhcbiAgICAgICkge1xuICAgICAgICBiZWNoMzJQcmVmaXhUb0NoYWluTmFtZS5kZWxldGUoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgb2xkSW5mby5iZWNoMzJQcmVmaXhcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNoYWluSW5mb3Muc2V0KGNoYWluTmFtZSwgY2hhaW5JbmZvKTtcbiAgICAgIGNoYWluSWRUb0NoYWluTmFtZS5pbml0KGNhaXBJZEZyb21JbmZvKGNoYWluSW5mbyksIGNoYWluTmFtZSk7XG4gICAgICBpZiAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBjaGFpbkluZm8uYmVjaDMyUHJlZml4XG4gICAgICApIHtcbiAgICAgICAgYmVjaDMyUHJlZml4VG9DaGFpbk5hbWUuaW5pdChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBjaGFpbkluZm8uYmVjaDMyUHJlZml4LFxuICAgICAgICAgIGNoYWluTmFtZVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG4gICAgLypcblxuXG5cbiAgICAgKi9cbiAgICBnZXRDaGFpbkluZm8oY2hhaW5OYW1lKSB7XG4gICAgICBjaGFpbk5hbWUuaW5jbHVkZXMoXCI6XCIpICYmIHRocm93UmVkYWN0ZWRgJHtjaGFpbk5hbWV9IG11c3QgYmUgYSBiYXJlIGNoYWluIG5hbWUuIE1heWJlIHRyeSBnZXRDaGFpbkluZm9CeUNoYWluSWQoKWA7XG4gICAgICBpZiAoY2hhaW5JbmZvcy5oYXMoY2hhaW5OYW1lKSkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgdm93VG9vbHMuYXNWb3coXG4gICAgICAgICAgICAoKSA9PiAoXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIGNoYWluSW5mb3MuZ2V0KGNoYWluTmFtZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbG9va3VwQ2hhaW5JbmZvKGNoYWluTmFtZSk7XG4gICAgfSxcbiAgICAvKlxuXG5cbiAgICAgKi9cbiAgICBnZXRDaGFpbkluZm9CeUNoYWluSWQoY2hhaW5JZCkge1xuICAgICAgY2hhaW5JZFRvQ2hhaW5OYW1lLmhhcyhjaGFpbklkKSB8fCB0aHJvd1JlZGFjdGVkYENoYWluIG5hbWUgbm90IGZvdW5kIGZvciAke3F1b3RlKGNoYWluSWQpfWA7XG4gICAgICBjb25zdCBjaGFpbk5hbWUgPSBjaGFpbklkVG9DaGFpbk5hbWUuZ2V0KGNoYWluSWQpO1xuICAgICAgY2hhaW5JbmZvcy5oYXMoY2hhaW5OYW1lKSB8fCB0aHJvd1JlZGFjdGVkYENoYWluIEluZm8gbm90IGZvdW5kIGZvciAke3F1b3RlKGNoYWluSWQpfWA7XG4gICAgICByZXR1cm4gY2hhaW5JbmZvcy5nZXQoY2hhaW5OYW1lKTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuICAgICAqL1xuICAgIHJlZ2lzdGVyQ29ubmVjdGlvbihwcmltYXJ5Q2hhaW5JZCwgY291bnRlcnBhcnR5Q2hhaW5JZCwgY29ubmVjdGlvbkluZm8pIHtcbiAgICAgIGNvbnN0IFtrZXksIG5vcm1hbGl6ZWRdID0gbm9ybWFsaXplQ29ubmVjdGlvbkluZm8oXG4gICAgICAgIHByaW1hcnlDaGFpbklkLFxuICAgICAgICBjb3VudGVycGFydHlDaGFpbklkLFxuICAgICAgICBjb25uZWN0aW9uSW5mb1xuICAgICAgKTtcbiAgICAgIGNvbm5lY3Rpb25JbmZvcy5pbml0KGtleSwgbm9ybWFsaXplZCk7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgdXBkYXRlQ29ubmVjdGlvbihwcmltYXJ5Q2hhaW5JZCwgY291bnRlcnBhcnR5Q2hhaW5JZCwgY29ubmVjdGlvbkluZm8pIHtcbiAgICAgIGNvbnN0IGtleSA9IGNvbm5lY3Rpb25LZXkocHJpbWFyeUNoYWluSWQsIGNvdW50ZXJwYXJ0eUNoYWluSWQpO1xuICAgICAgaWYgKCFjb25uZWN0aW9uSW5mb3MuaGFzKGtleSkpIHtcbiAgICAgICAgdGhyb3cgbWFrZUVycm9yKFxuICAgICAgICAgIGBDb25uZWN0aW9uICR7cXVvdGUocHJpbWFyeUNoYWluSWQpfTwtPiR7cXVvdGUoY291bnRlcnBhcnR5Q2hhaW5JZCl9IG5vdCByZWdpc3RlcmVkYFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3QgW18sIG5vcm1hbGl6ZWRJbmZvXSA9IG5vcm1hbGl6ZUNvbm5lY3Rpb25JbmZvKFxuICAgICAgICBwcmltYXJ5Q2hhaW5JZCxcbiAgICAgICAgY291bnRlcnBhcnR5Q2hhaW5JZCxcbiAgICAgICAgY29ubmVjdGlvbkluZm9cbiAgICAgICk7XG4gICAgICBjb25uZWN0aW9uSW5mb3Muc2V0KGtleSwgbm9ybWFsaXplZEluZm8pO1xuICAgIH0sXG4gICAgLypcblxuXG5cbiAgICAgKi9cbiAgICBnZXRDb25uZWN0aW9uSW5mbyhwcmltYXJ5LCBjb3VudGVyKSB7XG4gICAgICBjb25zdCBwcmltYXJ5SWQgPSB0eXBlb2YgcHJpbWFyeSA9PT0gXCJzdHJpbmdcIiA/IHByaW1hcnkgOiBwcmltYXJ5LmNoYWluSWQ7XG4gICAgICBjb25zdCBjb3VudGVySWQgPSB0eXBlb2YgY291bnRlciA9PT0gXCJzdHJpbmdcIiA/IGNvdW50ZXIgOiBjb3VudGVyLmNoYWluSWQ7XG4gICAgICBjb25zdCBrZXkgPSBjb25uZWN0aW9uS2V5KHByaW1hcnlJZCwgY291bnRlcklkKTtcbiAgICAgIGlmIChjb25uZWN0aW9uSW5mb3MuaGFzKGtleSkpIHtcbiAgICAgICAgcmV0dXJuIHZvd1Rvb2xzLmFzVm93KFxuICAgICAgICAgICgpID0+IGRlbm9ybWFsaXplQ29ubmVjdGlvbkluZm8oXG4gICAgICAgICAgICBwcmltYXJ5SWQsXG4gICAgICAgICAgICBjb3VudGVySWQsXG4gICAgICAgICAgICBjb25uZWN0aW9uSW5mb3MuZ2V0KGtleSlcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbG9va3VwQ29ubmVjdGlvbkluZm8ocHJpbWFyeUlkLCBjb3VudGVySWQpO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIGdldENoYWluc0FuZENvbm5lY3Rpb24ocHJpbWFyeU5hbWUsIGNvdW50ZXJOYW1lKSB7XG4gICAgICByZXR1cm4gbG9va3VwQ2hhaW5zQW5kQ29ubmVjdGlvbihwcmltYXJ5TmFtZSwgY291bnRlck5hbWUpO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICByZWdpc3RlckFzc2V0KGRlbm9tLCBkZXRhaWwpIHtcbiAgICAgIGNvbnN0IHsgY2hhaW5OYW1lLCBiYXNlTmFtZSB9ID0gZGV0YWlsO1xuICAgICAgY2hhaW5JbmZvcy5oYXMoY2hhaW5OYW1lKSB8fCB0aHJvd1JlZGFjdGVkYG11c3QgcmVnaXN0ZXIgY2hhaW4gJHtxdW90ZShjaGFpbk5hbWUpfSBmaXJzdGA7XG4gICAgICBjaGFpbkluZm9zLmhhcyhiYXNlTmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBtdXN0IHJlZ2lzdGVyIGNoYWluICR7cXVvdGUoYmFzZU5hbWUpfSBmaXJzdGA7XG4gICAgICBjb25zdCBkZW5vbUtleSA9IG1ha2VEZW5vbUtleShkZW5vbSwgZGV0YWlsLmNoYWluTmFtZSk7XG4gICAgICBkZW5vbURldGFpbHMuaGFzKGRlbm9tS2V5KSAmJiB0aHJvd1JlZGFjdGVkYGFscmVhZHkgcmVnaXN0ZXJlZCAke3F1b3RlKGRlbm9tKX0gb24gJHtxdW90ZShjaGFpbk5hbWUpfWA7XG4gICAgICBkZW5vbURldGFpbHMuaW5pdChkZW5vbUtleSwgZGV0YWlsKTtcbiAgICAgIGlmIChkZXRhaWwuYnJhbmQpIHtcbiAgICAgICAgY2hhaW5OYW1lID09PSBcImFnb3JpY1wiIHx8IHRocm93UmVkYWN0ZWRgYnJhbmRzIG9ubHkgcmVnaXN0ZXJhYmxlIGZvciBhZ29yaWMtaGVsZCBhc3NldHNgO1xuICAgICAgICBicmFuZERlbm9tcy5pbml0KGRldGFpbC5icmFuZCwgZGVub20pO1xuICAgICAgfVxuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICB1cGRhdGVBc3NldChkZW5vbSwgZGV0YWlsKSB7XG4gICAgICBjb25zdCB7IGJhc2VOYW1lLCBicmFuZCwgY2hhaW5OYW1lIH0gPSBkZXRhaWw7XG4gICAgICBjb25zdCBkZW5vbUtleSA9IG1ha2VEZW5vbUtleShkZW5vbSwgY2hhaW5OYW1lKTtcbiAgICAgIGlmICghZGVub21EZXRhaWxzLmhhcyhkZW5vbUtleSkpIHtcbiAgICAgICAgdGhyb3cgbWFrZUVycm9yKGBBc3NldCAke3F1b3RlKGRlbm9tKX0gb24gJHtxdW90ZShjaGFpbk5hbWUpfSBub3QgcmVnaXN0ZXJlZGApO1xuICAgICAgfVxuICAgICAgaWYgKCFjaGFpbkluZm9zLmhhcyhjaGFpbk5hbWUpKSB7XG4gICAgICAgIHRocm93IG1ha2VFcnJvcihgQ2hhaW4gJHtxdW90ZShjaGFpbk5hbWUpfSBub3QgcmVnaXN0ZXJlZGApO1xuICAgICAgfVxuICAgICAgaWYgKCFjaGFpbkluZm9zLmhhcyhiYXNlTmFtZSkpIHtcbiAgICAgICAgdGhyb3cgbWFrZUVycm9yKGBDaGFpbiAke3F1b3RlKGJhc2VOYW1lKX0gbm90IHJlZ2lzdGVyZWRgKTtcbiAgICAgIH1cbiAgICAgIGlmIChicmFuZCkge1xuICAgICAgICBpZiAoY2hhaW5OYW1lICE9PSBcImFnb3JpY1wiKSB7XG4gICAgICAgICAgdGhyb3cgbWFrZUVycm9yKFwiQnJhbmRzIG9ubHkgcmVnaXN0ZXJhYmxlIGZvciBhZ29yaWMtaGVsZCBhc3NldHNcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnN0IG9sZERldGFpbCA9IGRlbm9tRGV0YWlscy5nZXQoZGVub21LZXkpO1xuICAgICAgaWYgKG9sZERldGFpbC5icmFuZCkge1xuICAgICAgICBicmFuZERlbm9tcy5kZWxldGUob2xkRGV0YWlsLmJyYW5kKTtcbiAgICAgIH1cbiAgICAgIGRlbm9tRGV0YWlscy5zZXQoZGVub21LZXksIGRldGFpbCk7XG4gICAgICBpZiAoYnJhbmQpIHtcbiAgICAgICAgYnJhbmREZW5vbXMuaW5pdChicmFuZCwgZGVub20pO1xuICAgICAgfVxuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG4gICAgICovXG4gICAgZ2V0QXNzZXQoZGVub20sIHNyY0NoYWluTmFtZSkge1xuICAgICAgY29uc3QgZGVub21LZXkgPSBtYWtlRGVub21LZXkoZGVub20sIHNyY0NoYWluTmFtZSk7XG4gICAgICBpZiAoZGVub21EZXRhaWxzLmhhcyhkZW5vbUtleSkpIHtcbiAgICAgICAgcmV0dXJuIGRlbm9tRGV0YWlscy5nZXQoZGVub21LZXkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICBnZXREZW5vbShicmFuZCkge1xuICAgICAgaWYgKGJyYW5kRGVub21zLmhhcyhicmFuZCkpIHtcbiAgICAgICAgcmV0dXJuIGJyYW5kRGVub21zLmdldChicmFuZCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdm9pZCAwO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgIHJlc29sdmVBY2NvdW50SWQocGFydGlhbElkKSB7XG4gICAgICBpZiAocGFydGlhbElkLnNwbGl0KFwiOlwiKS5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBwYXJ0aWFsSWRcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvc21vc0NoYWluSWQgPSByZXNvbHZlQ29zbW9zQ2hhaW5JZChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBwYXJ0aWFsSWRcbiAgICAgICk7XG4gICAgICByZXR1cm4gYGNvc21vczoke2Nvc21vc0NoYWluSWR9OiR7cGFydGlhbElkfWA7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIGNvZXJjZUNvc21vc0FkZHJlc3MocGFydGlhbElkKSB7XG4gICAgICBpZiAodHlwZW9mIHBhcnRpYWxJZCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICByZXR1cm4gcGFydGlhbElkO1xuICAgICAgfVxuICAgICAgY29uc3QgcGFydHMgPSBwYXJ0aWFsSWQuc3BsaXQoXCI6XCIpO1xuICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykge1xuICAgICAgICBhc3NlcnQuZXF1YWwocGFydHNbMF0sIFwiY29zbW9zXCIpO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgICBjaGFpbklkOiBwYXJ0c1sxXSxcbiAgICAgICAgICBlbmNvZGluZzogXCJiZWNoMzJcIixcbiAgICAgICAgICB2YWx1ZTogKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgcGFydHNbMl1cbiAgICAgICAgICApXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgYXNzZXJ0LmVxdWFsKHBhcnRzLmxlbmd0aCwgMSk7XG4gICAgICBjb25zdCB2YWx1ZSA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBwYXJ0aWFsSWRcbiAgICAgICk7XG4gICAgICBjb25zdCBjb3Ntb3NDaGFpbklkID0gcmVzb2x2ZUNvc21vc0NoYWluSWQodmFsdWUpO1xuICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgIGNoYWluSWQ6IGNvc21vc0NoYWluSWQsXG4gICAgICAgIHZhbHVlLFxuICAgICAgICBlbmNvZGluZzogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgXCJiZWNoMzJcIlxuICAgICAgICApXG4gICAgICB9KTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIG1ha2VUcmFuc2ZlclJvdXRlKGRlc3RpbmF0aW9uLCBkZW5vbUFtb3VudCwgc3JjQ2hhaW5OYW1lLCBmb3J3YXJkT3B0cykge1xuICAgICAgY2hhaW5JbmZvcy5oYXMoc3JjQ2hhaW5OYW1lKSB8fCB0aHJvd1JlZGFjdGVkYGNoYWluIGluZm8gbm90IGZvdW5kIGZvciBob2xkaW5nIGNoYWluOiAke3F1b3RlKHNyY0NoYWluTmFtZSl9YDtcbiAgICAgIGNvbnN0IGRlbm9tRGV0YWlsID0gY2hhaW5IdWIuZ2V0QXNzZXQoZGVub21BbW91bnQuZGVub20sIHNyY0NoYWluTmFtZSk7XG4gICAgICBkZW5vbURldGFpbCB8fCB0aHJvd1JlZGFjdGVkYG5vIGRlbm9tIGRldGFpbCBmb3I6ICR7cXVvdGUoZGVub21BbW91bnQuZGVub20pfSBvbiAke3F1b3RlKHNyY0NoYWluTmFtZSl9LiBlbnN1cmUgaXQgaXMgcmVnaXN0ZXJlZCBpbiBjaGFpbkh1Yi5gO1xuICAgICAgY29uc3QgeyBiYXNlTmFtZSwgY2hhaW5OYW1lIH0gPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGRlbm9tRGV0YWlsXG4gICAgICApO1xuICAgICAgY2hhaW5OYW1lID09PSBzcmNDaGFpbk5hbWUgfHwgdGhyb3dSZWRhY3RlZGBjYW5ub3QgdHJhbnNmZXIgYXNzZXQgJHtxdW90ZShkZW5vbUFtb3VudC5kZW5vbSl9LiBoZWxkIG9uICR7cXVvdGUoY2hhaW5OYW1lKX0gbm90ICR7cXVvdGUoc3JjQ2hhaW5OYW1lKX0uYDtcbiAgICAgIGNoYWluSW5mb3MuaGFzKGJhc2VOYW1lKSB8fCB0aHJvd1JlZGFjdGVkYGNoYWluIGluZm8gbm90IGZvdW5kIGZvciBpc3N1aW5nIGNoYWluOiAke3F1b3RlKGJhc2VOYW1lKX1gO1xuICAgICAgY29uc3QgYmFzZUNoYWluSW5mbyA9IGNoYWluSW5mb3MuZ2V0KGJhc2VOYW1lKTtcbiAgICAgIGlmIChiYXNlQ2hhaW5JbmZvLm5hbWVzcGFjZSAhPT0gXCJjb3Ntb3NcIilcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBPbmx5IGNvc21vcyBzdXBwb3J0ZWQ7IGdvdCAke3F1b3RlKGJhc2VDaGFpbkluZm8ubmFtZXNwYWNlKX1gO1xuICAgICAgY29uc3QgeyBjaGFpbklkOiBiYXNlQ2hhaW5JZCwgcGZtRW5hYmxlZCB9ID0gYmFzZUNoYWluSW5mbztcbiAgICAgIGNvbnN0IGhvbGRpbmdDaGFpbkluZm8gPSBjaGFpbkluZm9zLmdldChzcmNDaGFpbk5hbWUpO1xuICAgICAgaWYgKGhvbGRpbmdDaGFpbkluZm8ubmFtZXNwYWNlICE9PSBcImNvc21vc1wiKSB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgT25seSBjb3Ntb3Mgc3VwcG9ydGVkOyBnb3QgJHtxdW90ZShob2xkaW5nQ2hhaW5JbmZvLm5hbWVzcGFjZSl9YDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgY2hhaW5JZDogaG9sZGluZ0NoYWluSWQgfSA9IGhvbGRpbmdDaGFpbkluZm87XG4gICAgICBjb25zdCBjb3Ntb3NEZXN0ID0gY2hhaW5IdWIuY29lcmNlQ29zbW9zQWRkcmVzcyhkZXN0aW5hdGlvbik7XG4gICAgICBpZiAoYmFzZUNoYWluSWQgPT09IGNvc21vc0Rlc3QuY2hhaW5JZCB8fCBiYXNlTmFtZSA9PT0gc3JjQ2hhaW5OYW1lKSB7XG4gICAgICAgIGNvbnN0IGNvbm5LZXkgPSBjb25uZWN0aW9uS2V5KGhvbGRpbmdDaGFpbklkLCBjb3Ntb3NEZXN0LmNoYWluSWQpO1xuICAgICAgICBjb25uZWN0aW9uSW5mb3MuaGFzKGNvbm5LZXkpIHx8IHRocm93UmVkYWN0ZWRgbm8gY29ubmVjdGlvbiBpbmZvIGZvdW5kIGZvciAke2hvbGRpbmdDaGFpbklkfTwtPiR7Y29zbW9zRGVzdC5jaGFpbklkfWA7XG4gICAgICAgIGNvbnN0IHsgdHJhbnNmZXJDaGFubmVsIH0gPSBkZW5vcm1hbGl6ZUNvbm5lY3Rpb25JbmZvKFxuICAgICAgICAgIGhvbGRpbmdDaGFpbklkLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgY29zbW9zRGVzdC5jaGFpbklkLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgY29ubmVjdGlvbkluZm9zLmdldChjb25uS2V5KVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgICBzb3VyY2VQb3J0OiB0cmFuc2ZlckNoYW5uZWwucG9ydElkLFxuICAgICAgICAgIHNvdXJjZUNoYW5uZWw6IHRyYW5zZmVyQ2hhbm5lbC5jaGFubmVsSWQsXG4gICAgICAgICAgdG9rZW46IHtcbiAgICAgICAgICAgIGFtb3VudDogU3RyaW5nKGRlbm9tQW1vdW50LnZhbHVlKSxcbiAgICAgICAgICAgIGRlbm9tOiBkZW5vbUFtb3VudC5kZW5vbVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVjZWl2ZXI6IGNvc21vc0Rlc3QudmFsdWVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBwZm1FbmFibGVkIHx8IHRocm93UmVkYWN0ZWRgcGZtIG5vdCBlbmFibGVkIG9uIGlzc3VpbmcgY2hhaW46ICR7cXVvdGUoYmFzZU5hbWUpfWA7XG4gICAgICBjb25zdCBjdXJyVG9Jc3N1ZXJLZXkgPSBjb25uZWN0aW9uS2V5KGhvbGRpbmdDaGFpbklkLCBiYXNlQ2hhaW5JZCk7XG4gICAgICBjb25uZWN0aW9uSW5mb3MuaGFzKGN1cnJUb0lzc3VlcktleSkgfHwgdGhyb3dSZWRhY3RlZGBubyBjb25uZWN0aW9uIGluZm8gZm91bmQgZm9yICR7aG9sZGluZ0NoYWluSWR9PC0+JHtiYXNlQ2hhaW5JZH1gO1xuICAgICAgY29uc3QgaXNzdWVyVG9EZXN0S2V5ID0gY29ubmVjdGlvbktleShiYXNlQ2hhaW5JZCwgY29zbW9zRGVzdC5jaGFpbklkKTtcbiAgICAgIGNvbm5lY3Rpb25JbmZvcy5oYXMoaXNzdWVyVG9EZXN0S2V5KSB8fCB0aHJvd1JlZGFjdGVkYG5vIGNvbm5lY3Rpb24gaW5mbyBmb3VuZCBmb3IgJHtiYXNlQ2hhaW5JZH08LT4ke2Nvc21vc0Rlc3QuY2hhaW5JZH1gO1xuICAgICAgY29uc3QgY3VyclRvSXNzdWVyID0gZGVub3JtYWxpemVDb25uZWN0aW9uSW5mbyhcbiAgICAgICAgaG9sZGluZ0NoYWluSWQsXG4gICAgICAgIGJhc2VDaGFpbklkLFxuICAgICAgICBjb25uZWN0aW9uSW5mb3MuZ2V0KGN1cnJUb0lzc3VlcktleSlcbiAgICAgICk7XG4gICAgICBjb25zdCBpc3N1ZXJUb0Rlc3QgPSBkZW5vcm1hbGl6ZUNvbm5lY3Rpb25JbmZvKFxuICAgICAgICBiYXNlQ2hhaW5JZCxcbiAgICAgICAgY29zbW9zRGVzdC5jaGFpbklkLFxuICAgICAgICBjb25uZWN0aW9uSW5mb3MuZ2V0KGlzc3VlclRvRGVzdEtleSlcbiAgICAgICk7XG4gICAgICBjb25zdCB7IGludGVybWVkaWF0ZVJlY2lwaWVudCwgLi4ucmVzdCB9ID0gZm9yd2FyZE9wdHMgPz8ge307XG4gICAgICBjb25zdCBmb3J3YXJkSW5mbyA9IGhhcmRlbih7XG4gICAgICAgIGZvcndhcmQ6IHtcbiAgICAgICAgICByZWNlaXZlcjogY29zbW9zRGVzdC52YWx1ZSxcbiAgICAgICAgICBwb3J0OiBpc3N1ZXJUb0Rlc3QudHJhbnNmZXJDaGFubmVsLnBvcnRJZCxcbiAgICAgICAgICBjaGFubmVsOiBpc3N1ZXJUb0Rlc3QudHJhbnNmZXJDaGFubmVsLmNoYW5uZWxJZCxcbiAgICAgICAgICAuLi5EZWZhdWx0UGZtVGltZW91dE9wdHMsXG4gICAgICAgICAgLi4uLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICByZXN0XG4gICAgICAgICAgLy9cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgc291cmNlUG9ydDogY3VyclRvSXNzdWVyLnRyYW5zZmVyQ2hhbm5lbC5wb3J0SWQsXG4gICAgICAgIHNvdXJjZUNoYW5uZWw6IGN1cnJUb0lzc3Vlci50cmFuc2ZlckNoYW5uZWwuY2hhbm5lbElkLFxuICAgICAgICB0b2tlbjoge1xuICAgICAgICAgIGFtb3VudDogU3RyaW5nKGRlbm9tQW1vdW50LnZhbHVlKSxcbiAgICAgICAgICBkZW5vbTogZGVub21BbW91bnQuZGVub21cbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICByZWNlaXZlcjogaW50ZXJtZWRpYXRlUmVjaXBpZW50Py52YWx1ZSB8fCBQRk1fUkVDRUlWRVIsXG4gICAgICAgIGZvcndhcmRJbmZvXG4gICAgICB9KTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICBpc0VtcHR5KCkge1xuICAgICAgcmV0dXJuIGNoYWluSW5mb3MuZ2V0U2l6ZSgpID09PSAwICYmIGNvbm5lY3Rpb25JbmZvcy5nZXRTaXplKCkgPT09IDAgJiYgZGVub21EZXRhaWxzLmdldFNpemUoKSA9PT0gMDtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gY2hhaW5IdWI7XG59O1xuXG4vL1xuZnVuY3Rpb24gdXRmOExlbmd0aCh0NSkge1xuICBsZXQgcjYgPSAwLCBlMiA9IDA7XG4gIGZvciAobGV0IG8yID0gMDsgbzIgPCB0NS5sZW5ndGg7ICsrbzIpIGUyID0gdDUuY2hhckNvZGVBdChvMiksIGUyIDwgMTI4ID8gcjYgKz0gMSA6IGUyIDwgMjA0OCA/IHI2ICs9IDIgOiA1NTI5NiA9PSAoNjQ1MTIgJiBlMikgJiYgNTYzMjAgPT0gKDY0NTEyICYgdDUuY2hhckNvZGVBdChvMiArIDEpKSA/ICgrK28yLCByNiArPSA0KSA6IHI2ICs9IDM7XG4gIHJldHVybiByNjtcbn1cbmZ1bmN0aW9uIHV0ZjhSZWFkKHQ1LCByNiwgZTIpIHtcbiAgaWYgKGUyIC0gcjYgPCAxKSByZXR1cm4gXCJcIjtcbiAgY29uc3QgbzIgPSBbXTtcbiAgbGV0IG4yLCBmMiA9IFtdLCBoID0gMDtcbiAgZm9yICg7IHI2IDwgZTI7ICkgbjIgPSB0NVtyNisrXSwgbjIgPCAxMjggPyBvMltoKytdID0gbjIgOiBuMiA+IDE5MSAmJiBuMiA8IDIyNCA/IG8yW2grK10gPSAoMzEgJiBuMikgPDwgNiB8IDYzICYgdDVbcjYrK10gOiBuMiA+IDIzOSAmJiBuMiA8IDM2NSA/IChuMiA9ICgoNyAmIG4yKSA8PCAxOCB8ICg2MyAmIHQ1W3I2KytdKSA8PCAxMiB8ICg2MyAmIHQ1W3I2KytdKSA8PCA2IHwgNjMgJiB0NVtyNisrXSkgLSA2NTUzNiwgbzJbaCsrXSA9IDU1Mjk2ICsgKG4yID4+IDEwKSwgbzJbaCsrXSA9IDU2MzIwICsgKDEwMjMgJiBuMikpIDogbzJbaCsrXSA9ICgxNSAmIG4yKSA8PCAxMiB8ICg2MyAmIHQ1W3I2KytdKSA8PCA2IHwgNjMgJiB0NVtyNisrXSwgaCA+IDgxOTEgJiYgKChmMiB8fCAoZjIgPSBbXSkpLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSguLi5vMikpLCBoID0gMCk7XG4gIHJldHVybiBmMiA/IChoICYmIGYyLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSguLi5vMi5zbGljZSgwLCBoKSkpLCBmMi5qb2luKFwiXCIpKSA6IFN0cmluZy5mcm9tQ2hhckNvZGUoLi4ubzIuc2xpY2UoMCwgaCkpO1xufVxuZnVuY3Rpb24gdXRmOFdyaXRlKHQ1LCByNiwgZTIpIHtcbiAgY29uc3QgbzIgPSBlMjtcbiAgbGV0IG4yLCBmMjtcbiAgZm9yIChsZXQgbzMgPSAwOyBvMyA8IHQ1Lmxlbmd0aDsgKytvMykgbjIgPSB0NS5jaGFyQ29kZUF0KG8zKSwgbjIgPCAxMjggPyByNltlMisrXSA9IG4yIDogbjIgPCAyMDQ4ID8gKHI2W2UyKytdID0gbjIgPj4gNiB8IDE5MiwgcjZbZTIrK10gPSA2MyAmIG4yIHwgMTI4KSA6IDU1Mjk2ID09ICg2NDUxMiAmIG4yKSAmJiA1NjMyMCA9PSAoNjQ1MTIgJiAoZjIgPSB0NS5jaGFyQ29kZUF0KG8zICsgMSkpKSA/IChuMiA9IDY1NTM2ICsgKCgxMDIzICYgbjIpIDw8IDEwKSArICgxMDIzICYgZjIpLCArK28zLCByNltlMisrXSA9IG4yID4+IDE4IHwgMjQwLCByNltlMisrXSA9IG4yID4+IDEyICYgNjMgfCAxMjgsIHI2W2UyKytdID0gbjIgPj4gNiAmIDYzIHwgMTI4LCByNltlMisrXSA9IDYzICYgbjIgfCAxMjgpIDogKHI2W2UyKytdID0gbjIgPj4gMTIgfCAyMjQsIHI2W2UyKytdID0gbjIgPj4gNiAmIDYzIHwgMTI4LCByNltlMisrXSA9IDYzICYgbjIgfCAxMjgpO1xuICByZXR1cm4gZTIgLSBvMjtcbn1cblxuLy9cbmZ1bmN0aW9uIHZhcmludDY0cmVhZCgpIHtcbiAgbGV0IHQ1ID0gMCwgcjYgPSAwO1xuICBmb3IgKGxldCBuMyA9IDA7IG4zIDwgMjg7IG4zICs9IDcpIHtcbiAgICBsZXQgbzIgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXTtcbiAgICBpZiAodDUgfD0gKDEyNyAmIG8yKSA8PCBuMywgISgxMjggJiBvMikpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCBbdDUsIHI2XTtcbiAgfVxuICBsZXQgbjIgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXTtcbiAgaWYgKHQ1IHw9ICgxNSAmIG4yKSA8PCAyOCwgcjYgPSAoMTEyICYgbjIpID4+IDQsICEoMTI4ICYgbjIpKSByZXR1cm4gdGhpcy5hc3NlcnRCb3VuZHMoKSwgW3Q1LCByNl07XG4gIGZvciAobGV0IG4zID0gMzsgbjMgPD0gMzE7IG4zICs9IDcpIHtcbiAgICBsZXQgbzIgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXTtcbiAgICBpZiAocjYgfD0gKDEyNyAmIG8yKSA8PCBuMywgISgxMjggJiBvMikpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCBbdDUsIHI2XTtcbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoXCJpbnZhbGlkIHZhcmludFwiKTtcbn1cbnZhciB0ID0gNDI5NDk2NzI5NjtcbmZ1bmN0aW9uIGludDY0RnJvbVN0cmluZyhvMikge1xuICBjb25zdCBpMiA9IFwiLVwiID09PSBvMlswXTtcbiAgaTIgJiYgKG8yID0gbzIuc2xpY2UoMSkpO1xuICBjb25zdCBlMiA9IDFlNjtcbiAgbGV0IHMyID0gMCwgdSA9IDA7XG4gIGZ1bmN0aW9uIGYyKHI2LCBuMikge1xuICAgIGNvbnN0IGkzID0gTnVtYmVyKG8yLnNsaWNlKHI2LCBuMikpO1xuICAgIHUgKj0gZTIsIHMyID0gczIgKiBlMiArIGkzLCBzMiA+PSB0ICYmICh1ICs9IHMyIC8gdCB8IDAsIHMyICU9IHQpO1xuICB9XG4gIHJldHVybiBmMigtMjQsIC0xOCksIGYyKC0xOCwgLTEyKSwgZjIoLTEyLCAtNiksIGYyKC02KSwgaTIgPyBuKHMyLCB1KSA6IHIoczIsIHUpO1xufVxuZnVuY3Rpb24gaW50NjRUb1N0cmluZyh0NSwgbzIpIHtcbiAgbGV0IGkyID0gcih0NSwgbzIpO1xuICBjb25zdCBlMiA9IDIxNDc0ODM2NDggJiBpMi5oaTtcbiAgZTIgJiYgKGkyID0gbihpMi5sbywgaTIuaGkpKTtcbiAgY29uc3QgczIgPSB1SW50NjRUb1N0cmluZyhpMi5sbywgaTIuaGkpO1xuICByZXR1cm4gZTIgPyBcIi1cIiArIHMyIDogczI7XG59XG5mdW5jdGlvbiB1SW50NjRUb1N0cmluZyhyNiwgbjIpIHtcbiAgaWYgKHsgbG86IHI2LCBoaTogbjIgfSA9IChmdW5jdGlvbih0NSwgcjcpIHtcbiAgICByZXR1cm4geyBsbzogdDUgPj4+IDAsIGhpOiByNyA+Pj4gMCB9O1xuICB9KShyNiwgbjIpLCBuMiA8PSAyMDk3MTUxKSByZXR1cm4gU3RyaW5nKHQgKiBuMiArIHI2KTtcbiAgY29uc3QgaTIgPSAxNjc3NzIxNSAmIChyNiA+Pj4gMjQgfCBuMiA8PCA4KSwgZTIgPSBuMiA+PiAxNiAmIDY1NTM1O1xuICBsZXQgczIgPSAoMTY3NzcyMTUgJiByNikgKyA2Nzc3MjE2ICogaTIgKyA2NzEwNjU2ICogZTIsIHUgPSBpMiArIDgxNDc0OTcgKiBlMiwgZjIgPSAyICogZTI7XG4gIGNvbnN0IGggPSAxZTc7XG4gIHJldHVybiBzMiA+PSBoICYmICh1ICs9IE1hdGguZmxvb3IoczIgLyBoKSwgczIgJT0gaCksIHUgPj0gaCAmJiAoZjIgKz0gTWF0aC5mbG9vcih1IC8gaCksIHUgJT0gaCksIGYyLnRvU3RyaW5nKCkgKyBvKHUpICsgbyhzMik7XG59XG5mdW5jdGlvbiByKHQ1LCByNikge1xuICByZXR1cm4geyBsbzogMCB8IHQ1LCBoaTogMCB8IHI2IH07XG59XG5mdW5jdGlvbiBuKHQ1LCBuMikge1xuICByZXR1cm4gbjIgPSB+bjIsIHQ1ID8gdDUgPSAxICsgfnQ1IDogbjIgKz0gMSwgcih0NSwgbjIpO1xufVxudmFyIG8gPSAodDUpID0+IHtcbiAgY29uc3QgcjYgPSBTdHJpbmcodDUpO1xuICByZXR1cm4gXCIwMDAwMDAwXCIuc2xpY2UocjYubGVuZ3RoKSArIHI2O1xufTtcbmZ1bmN0aW9uIHZhcmludDMycmVhZCgpIHtcbiAgbGV0IHQ1ID0gdGhpcy5idWZbdGhpcy5wb3MrK10sIHI2ID0gMTI3ICYgdDU7XG4gIGlmICghKDEyOCAmIHQ1KSkgcmV0dXJuIHRoaXMuYXNzZXJ0Qm91bmRzKCksIHI2O1xuICBpZiAodDUgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXSwgcjYgfD0gKDEyNyAmIHQ1KSA8PCA3LCAhKDEyOCAmIHQ1KSkgcmV0dXJuIHRoaXMuYXNzZXJ0Qm91bmRzKCksIHI2O1xuICBpZiAodDUgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXSwgcjYgfD0gKDEyNyAmIHQ1KSA8PCAxNCwgISgxMjggJiB0NSkpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCByNjtcbiAgaWYgKHQ1ID0gdGhpcy5idWZbdGhpcy5wb3MrK10sIHI2IHw9ICgxMjcgJiB0NSkgPDwgMjEsICEoMTI4ICYgdDUpKSByZXR1cm4gdGhpcy5hc3NlcnRCb3VuZHMoKSwgcjY7XG4gIHQ1ID0gdGhpcy5idWZbdGhpcy5wb3MrK10sIHI2IHw9ICgxNSAmIHQ1KSA8PCAyODtcbiAgZm9yIChsZXQgcjcgPSA1OyAxMjggJiB0NSAmJiByNyA8IDEwOyByNysrKSB0NSA9IHRoaXMuYnVmW3RoaXMucG9zKytdO1xuICBpZiAoMTI4ICYgdDUpIHRocm93IG5ldyBFcnJvcihcImludmFsaWQgdmFyaW50XCIpO1xuICByZXR1cm4gdGhpcy5hc3NlcnRCb3VuZHMoKSwgcjYgPj4+IDA7XG59XG5mdW5jdGlvbiB6ekVuY29kZSh0NSwgcjYpIHtcbiAgbGV0IG4yID0gcjYgPj4gMzE7XG4gIHJldHVybiByNiA9ICgocjYgPDwgMSB8IHQ1ID4+PiAzMSkgXiBuMikgPj4+IDAsIFt0NSA9ICh0NSA8PCAxIF4gbjIpID4+PiAwLCByNl07XG59XG5mdW5jdGlvbiB6ekRlY29kZSh0NSwgcjYpIHtcbiAgbGV0IG4yID0gLSgxICYgdDUpO1xuICByZXR1cm4gW3Q1ID0gKCh0NSA+Pj4gMSB8IHI2IDw8IDMxKSBeIG4yKSA+Pj4gMCwgcjYgPSAocjYgPj4+IDEgXiBuMikgPj4+IDBdO1xufVxuZnVuY3Rpb24gcmVhZFVJbnQzMih0NSwgcjYpIHtcbiAgcmV0dXJuICh0NVtyNl0gfCB0NVtyNiArIDFdIDw8IDggfCB0NVtyNiArIDJdIDw8IDE2KSArIDE2Nzc3MjE2ICogdDVbcjYgKyAzXTtcbn1cbmZ1bmN0aW9uIHJlYWRJbnQzMih0NSwgcjYpIHtcbiAgcmV0dXJuICh0NVtyNl0gfCB0NVtyNiArIDFdIDw8IDggfCB0NVtyNiArIDJdIDw8IDE2KSArICh0NVtyNiArIDNdIDw8IDI0KTtcbn1cbmZ1bmN0aW9uIHdyaXRlVmFyaW50MzIodDUsIHI2LCBuMikge1xuICBmb3IgKDsgdDUgPiAxMjc7ICkgcjZbbjIrK10gPSAxMjcgJiB0NSB8IDEyOCwgdDUgPj4+PSA3O1xuICByNltuMl0gPSB0NTtcbn1cbmZ1bmN0aW9uIHdyaXRlVmFyaW50NjQodDUsIHI2LCBuMikge1xuICBmb3IgKDsgdDUuaGk7ICkgcjZbbjIrK10gPSAxMjcgJiB0NS5sbyB8IDEyOCwgdDUubG8gPSAodDUubG8gPj4+IDcgfCB0NS5oaSA8PCAyNSkgPj4+IDAsIHQ1LmhpID4+Pj0gNztcbiAgZm9yICg7IHQ1LmxvID4gMTI3OyApIHI2W24yKytdID0gMTI3ICYgdDUubG8gfCAxMjgsIHQ1LmxvID0gdDUubG8gPj4+IDc7XG4gIHI2W24yKytdID0gdDUubG87XG59XG5mdW5jdGlvbiBpbnQ2NExlbmd0aCh0NSwgcjYpIHtcbiAgbGV0IG4yID0gKHQ1ID4+PiAyOCB8IHI2IDw8IDQpID4+PiAwLCBvMiA9IHI2ID4+PiAyNDtcbiAgcmV0dXJuIDAgPT09IG8yID8gMCA9PT0gbjIgPyB0NSA8IDE2Mzg0ID8gdDUgPCAxMjggPyAxIDogMiA6IHQ1IDwgMjA5NzE1MiA/IDMgOiA0IDogbjIgPCAxNjM4NCA/IG4yIDwgMTI4ID8gNSA6IDYgOiBuMiA8IDIwOTcxNTIgPyA3IDogOCA6IG8yIDwgMTI4ID8gOSA6IDEwO1xufVxuZnVuY3Rpb24gd3JpdGVGaXhlZDMyKHQ1LCByNiwgbjIpIHtcbiAgcjZbbjJdID0gMjU1ICYgdDUsIHI2W24yICsgMV0gPSB0NSA+Pj4gOCAmIDI1NSwgcjZbbjIgKyAyXSA9IHQ1ID4+PiAxNiAmIDI1NSwgcjZbbjIgKyAzXSA9IHQ1ID4+PiAyNDtcbn1cbmZ1bmN0aW9uIHdyaXRlQnl0ZSh0NSwgcjYsIG4yKSB7XG4gIHI2W24yXSA9IDI1NSAmIHQ1O1xufVxuXG4vL1xudmFyIFdpcmVUeXBlO1xuIShmdW5jdGlvbih0NSkge1xuICB0NVt0NS5WYXJpbnQgPSAwXSA9IFwiVmFyaW50XCIsIHQ1W3Q1LkZpeGVkNjQgPSAxXSA9IFwiRml4ZWQ2NFwiLCB0NVt0NS5CeXRlcyA9IDJdID0gXCJCeXRlc1wiLCB0NVt0NS5GaXhlZDMyID0gNV0gPSBcIkZpeGVkMzJcIjtcbn0pKFdpcmVUeXBlIHx8IChXaXJlVHlwZSA9IHt9KSk7XG52YXIgQmluYXJ5UmVhZGVyID0gY2xhc3Mge1xuICBidWY7XG4gIHBvcztcbiAgdHlwZTtcbiAgbGVuO1xuICBhc3NlcnRCb3VuZHMoKSB7XG4gICAgaWYgKHRoaXMucG9zID4gdGhpcy5sZW4pIHRocm93IG5ldyBSYW5nZUVycm9yKFwicHJlbWF0dXJlIEVPRlwiKTtcbiAgfVxuICBjb25zdHJ1Y3Rvcih0NSkge1xuICAgIHRoaXMuYnVmID0gdDUgPyBuZXcgVWludDhBcnJheSh0NSkgOiBuZXcgVWludDhBcnJheSgwKSwgdGhpcy5wb3MgPSAwLCB0aGlzLnR5cGUgPSAwLCB0aGlzLmxlbiA9IHRoaXMuYnVmLmxlbmd0aDtcbiAgfVxuICB0YWcoKSB7XG4gICAgY29uc3QgdDUgPSB0aGlzLnVpbnQzMigpLCBpMiA9IHQ1ID4+PiAzLCBzMiA9IDcgJiB0NTtcbiAgICBpZiAoaTIgPD0gMCB8fCBzMiA8IDAgfHwgczIgPiA1KSB0aHJvdyBuZXcgRXJyb3IoXCJpbGxlZ2FsIHRhZzogZmllbGQgbm8gXCIgKyBpMiArIFwiIHdpcmUgdHlwZSBcIiArIHMyKTtcbiAgICByZXR1cm4gW2kyLCBzMiwgdDVdO1xuICB9XG4gIHNraXAodDUpIHtcbiAgICBpZiAoXCJudW1iZXJcIiA9PSB0eXBlb2YgdDUpIHtcbiAgICAgIGlmICh0aGlzLnBvcyArIHQ1ID4gdGhpcy5sZW4pIHRocm93IEIodGhpcywgdDUpO1xuICAgICAgdGhpcy5wb3MgKz0gdDU7XG4gICAgfSBlbHNlIGRvIHtcbiAgICAgIGlmICh0aGlzLnBvcyA+PSB0aGlzLmxlbikgdGhyb3cgQih0aGlzKTtcbiAgICB9IHdoaWxlICgxMjggJiB0aGlzLmJ1Zlt0aGlzLnBvcysrXSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgc2tpcFR5cGUodDUpIHtcbiAgICBzd2l0Y2ggKHQ1KSB7XG4gICAgICBjYXNlIFdpcmVUeXBlLlZhcmludDpcbiAgICAgICAgdGhpcy5za2lwKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBXaXJlVHlwZS5GaXhlZDY0OlxuICAgICAgICB0aGlzLnNraXAoOCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBXaXJlVHlwZS5CeXRlczpcbiAgICAgICAgdGhpcy5za2lwKHRoaXMudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgZm9yICg7IDQgIT0gKHQ1ID0gNyAmIHRoaXMudWludDMyKCkpOyApIHRoaXMuc2tpcFR5cGUodDUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgV2lyZVR5cGUuRml4ZWQzMjpcbiAgICAgICAgdGhpcy5za2lwKDQpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IEVycm9yKFwiaW52YWxpZCB3aXJlIHR5cGUgXCIgKyB0NSArIFwiIGF0IG9mZnNldCBcIiArIHRoaXMucG9zKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgdWludDMyKCkge1xuICAgIHJldHVybiB2YXJpbnQzMnJlYWQuYmluZCh0aGlzKSgpO1xuICB9XG4gIGludDMyKCkge1xuICAgIHJldHVybiAwIHwgdGhpcy51aW50MzIoKTtcbiAgfVxuICBzaW50MzIoKSB7XG4gICAgY29uc3QgdDUgPSB0aGlzLnVpbnQzMigpO1xuICAgIHJldHVybiB0NSAlIDIgPT0gMSA/ICh0NSArIDEpIC8gLTIgOiB0NSAvIDI7XG4gIH1cbiAgZml4ZWQzMigpIHtcbiAgICBjb25zdCB0NSA9IHJlYWRVSW50MzIodGhpcy5idWYsIHRoaXMucG9zKTtcbiAgICByZXR1cm4gdGhpcy5wb3MgKz0gNCwgdDU7XG4gIH1cbiAgc2ZpeGVkMzIoKSB7XG4gICAgY29uc3QgdDUgPSByZWFkSW50MzIodGhpcy5idWYsIHRoaXMucG9zKTtcbiAgICByZXR1cm4gdGhpcy5wb3MgKz0gNCwgdDU7XG4gIH1cbiAgaW50NjQoKSB7XG4gICAgY29uc3QgW3Q1LCBpMl0gPSB2YXJpbnQ2NHJlYWQuYmluZCh0aGlzKSgpO1xuICAgIHJldHVybiBCaWdJbnQoaW50NjRUb1N0cmluZyh0NSwgaTIpKTtcbiAgfVxuICB1aW50NjQoKSB7XG4gICAgY29uc3QgW3Q1LCBpMl0gPSB2YXJpbnQ2NHJlYWQuYmluZCh0aGlzKSgpO1xuICAgIHJldHVybiBCaWdJbnQodUludDY0VG9TdHJpbmcodDUsIGkyKSk7XG4gIH1cbiAgc2ludDY0KCkge1xuICAgIGxldCBbdDUsIGkyXSA9IHZhcmludDY0cmVhZC5iaW5kKHRoaXMpKCk7XG4gICAgcmV0dXJuIFt0NSwgaTJdID0genpEZWNvZGUodDUsIGkyKSwgQmlnSW50KGludDY0VG9TdHJpbmcodDUsIGkyKSk7XG4gIH1cbiAgZml4ZWQ2NCgpIHtcbiAgICBjb25zdCB0NSA9IHRoaXMuc2ZpeGVkMzIoKSwgaTIgPSB0aGlzLnNmaXhlZDMyKCk7XG4gICAgcmV0dXJuIEJpZ0ludCh1SW50NjRUb1N0cmluZyh0NSwgaTIpKTtcbiAgfVxuICBzZml4ZWQ2NCgpIHtcbiAgICBjb25zdCB0NSA9IHRoaXMuc2ZpeGVkMzIoKSwgaTIgPSB0aGlzLnNmaXhlZDMyKCk7XG4gICAgcmV0dXJuIEJpZ0ludChpbnQ2NFRvU3RyaW5nKHQ1LCBpMikpO1xuICB9XG4gIGZsb2F0KCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcImZsb2F0IG5vdCBzdXBwb3J0ZWRcIik7XG4gIH1cbiAgZG91YmxlKCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcImRvdWJsZSBub3Qgc3VwcG9ydGVkXCIpO1xuICB9XG4gIGJvb2woKSB7XG4gICAgY29uc3QgW3Q1LCBpMl0gPSB2YXJpbnQ2NHJlYWQuYmluZCh0aGlzKSgpO1xuICAgIHJldHVybiAwICE9PSB0NSB8fCAwICE9PSBpMjtcbiAgfVxuICBieXRlcygpIHtcbiAgICBjb25zdCB0NSA9IHRoaXMudWludDMyKCksIGkyID0gdGhpcy5wb3M7XG4gICAgcmV0dXJuIHRoaXMucG9zICs9IHQ1LCB0aGlzLmFzc2VydEJvdW5kcygpLCB0aGlzLmJ1Zi5zdWJhcnJheShpMiwgaTIgKyB0NSk7XG4gIH1cbiAgc3RyaW5nKCkge1xuICAgIGNvbnN0IHQ1ID0gdGhpcy5ieXRlcygpO1xuICAgIHJldHVybiB1dGY4UmVhZCh0NSwgMCwgdDUubGVuZ3RoKTtcbiAgfVxufTtcbnZhciB3ID0gY2xhc3Mge1xuICBmbjtcbiAgbGVuO1xuICB2YWw7XG4gIG5leHQ7XG4gIGNvbnN0cnVjdG9yKHQ1LCBpMiwgczIpIHtcbiAgICB0aGlzLmZuID0gdDUsIHRoaXMubGVuID0gaTIsIHRoaXMudmFsID0gczI7XG4gIH1cbiAgcHJvY2VlZCh0NSwgaTIpIHtcbiAgICB0aGlzLmZuICYmIHRoaXMuZm4odGhpcy52YWwsIHQ1LCBpMik7XG4gIH1cbn07XG52YXIgYiA9IGNsYXNzIHtcbiAgaGVhZDtcbiAgdGFpbDtcbiAgbGVuO1xuICBuZXh0O1xuICBjb25zdHJ1Y3Rvcih0NSkge1xuICAgIHRoaXMuaGVhZCA9IHQ1LmhlYWQsIHRoaXMudGFpbCA9IHQ1LnRhaWwsIHRoaXMubGVuID0gdDUubGVuLCB0aGlzLm5leHQgPSB0NS5zdGF0ZXM7XG4gIH1cbn07XG52YXIgQmluYXJ5V3JpdGVyID0gY2xhc3MgX0JpbmFyeVdyaXRlciB7XG4gIGxlbiA9IDA7XG4gIGhlYWQ7XG4gIHRhaWw7XG4gIHN0YXRlcztcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5oZWFkID0gbmV3IHcobnVsbCwgMCwgMCksIHRoaXMudGFpbCA9IHRoaXMuaGVhZCwgdGhpcy5zdGF0ZXMgPSBudWxsO1xuICB9XG4gIHN0YXRpYyBjcmVhdGUoKSB7XG4gICAgcmV0dXJuIG5ldyBfQmluYXJ5V3JpdGVyKCk7XG4gIH1cbiAgc3RhdGljIGFsbG9jKHQ1KSB7XG4gICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIFVpbnQ4QXJyYXkgPyAoZnVuY3Rpb24odDYsIGkyLCBzMikge1xuICAgICAgY29uc3QgZTIgPSBzMiB8fCA4MTkyLCBuMiA9IGUyID4+PiAxO1xuICAgICAgbGV0IHI2ID0gbnVsbCwgaCA9IGUyO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKHMzKSB7XG4gICAgICAgIGlmIChzMyA8IDEgfHwgczMgPiBuMikgcmV0dXJuIHQ2KHMzKTtcbiAgICAgICAgaCArIHMzID4gZTIgJiYgKHI2ID0gdDYoZTIpLCBoID0gMCk7XG4gICAgICAgIGNvbnN0IG8yID0gaTIuY2FsbChyNiwgaCwgaCArPSBzMyk7XG4gICAgICAgIHJldHVybiA3ICYgaCAmJiAoaCA9IDEgKyAoNyB8IGgpKSwgbzI7XG4gICAgICB9O1xuICAgIH0pKCgodDYpID0+IG5ldyBVaW50OEFycmF5KHQ2KSksIFVpbnQ4QXJyYXkucHJvdG90eXBlLnN1YmFycmF5KSh0NSkgOiBuZXcgQXJyYXkodDUpO1xuICB9XG4gIF9wdXNoKHQ1LCBpMiwgczIpIHtcbiAgICByZXR1cm4gdGhpcy50YWlsID0gdGhpcy50YWlsLm5leHQgPSBuZXcgdyh0NSwgaTIsIHMyKSwgdGhpcy5sZW4gKz0gaTIsIHRoaXM7XG4gIH1cbiAgZmluaXNoKCkge1xuICAgIGxldCB0NSA9IHRoaXMuaGVhZC5uZXh0LCBpMiA9IDA7XG4gICAgY29uc3QgczIgPSBfQmluYXJ5V3JpdGVyLmFsbG9jKHRoaXMubGVuKTtcbiAgICBmb3IgKDsgdDU7ICkgdDUucHJvY2VlZChzMiwgaTIpLCBpMiArPSB0NS5sZW4sIHQ1ID0gdDUubmV4dDtcbiAgICByZXR1cm4gczI7XG4gIH1cbiAgZm9yaygpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZXMgPSBuZXcgYih0aGlzKSwgdGhpcy5oZWFkID0gdGhpcy50YWlsID0gbmV3IHcobnVsbCwgMCwgMCksIHRoaXMubGVuID0gMCwgdGhpcztcbiAgfVxuICByZXNldCgpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZXMgPyAodGhpcy5oZWFkID0gdGhpcy5zdGF0ZXMuaGVhZCwgdGhpcy50YWlsID0gdGhpcy5zdGF0ZXMudGFpbCwgdGhpcy5sZW4gPSB0aGlzLnN0YXRlcy5sZW4sIHRoaXMuc3RhdGVzID0gdGhpcy5zdGF0ZXMubmV4dCkgOiAodGhpcy5oZWFkID0gdGhpcy50YWlsID0gbmV3IHcobnVsbCwgMCwgMCksIHRoaXMubGVuID0gMCksIHRoaXM7XG4gIH1cbiAgbGRlbGltKCkge1xuICAgIGNvbnN0IHQ1ID0gdGhpcy5oZWFkLCBpMiA9IHRoaXMudGFpbCwgczIgPSB0aGlzLmxlbjtcbiAgICByZXR1cm4gdGhpcy5yZXNldCgpLnVpbnQzMihzMiksIHMyICYmICh0aGlzLnRhaWwubmV4dCA9IHQ1Lm5leHQsIHRoaXMudGFpbCA9IGkyLCB0aGlzLmxlbiArPSBzMiksIHRoaXM7XG4gIH1cbiAgdGFnKHQ1LCBpMikge1xuICAgIHJldHVybiB0aGlzLnVpbnQzMigodDUgPDwgMyB8IGkyKSA+Pj4gMCk7XG4gIH1cbiAgdWludDMyKHQ1KSB7XG4gICAgcmV0dXJuIHRoaXMubGVuICs9ICh0aGlzLnRhaWwgPSB0aGlzLnRhaWwubmV4dCA9IG5ldyB3KHdyaXRlVmFyaW50MzIsICh0NSA+Pj49IDApIDwgMTI4ID8gMSA6IHQ1IDwgMTYzODQgPyAyIDogdDUgPCAyMDk3MTUyID8gMyA6IHQ1IDwgMjY4NDM1NDU2ID8gNCA6IDUsIHQ1KSkubGVuLCB0aGlzO1xuICB9XG4gIGludDMyKHQ1KSB7XG4gICAgcmV0dXJuIHQ1IDwgMCA/IHRoaXMuX3B1c2god3JpdGVWYXJpbnQ2NCwgMTAsIGludDY0RnJvbVN0cmluZyh0NS50b1N0cmluZygpKSkgOiB0aGlzLnVpbnQzMih0NSk7XG4gIH1cbiAgc2ludDMyKHQ1KSB7XG4gICAgcmV0dXJuIHRoaXMudWludDMyKCh0NSA8PCAxIF4gdDUgPj4gMzEpID4+PiAwKTtcbiAgfVxuICBpbnQ2NCh0NSkge1xuICAgIGNvbnN0IHsgbG86IGkyLCBoaTogczIgfSA9IGludDY0RnJvbVN0cmluZyh0NS50b1N0cmluZygpKTtcbiAgICByZXR1cm4gdGhpcy5fcHVzaCh3cml0ZVZhcmludDY0LCBpbnQ2NExlbmd0aChpMiwgczIpLCB7IGxvOiBpMiwgaGk6IHMyIH0pO1xuICB9XG4gIHVpbnQ2NCA9IF9CaW5hcnlXcml0ZXIucHJvdG90eXBlLmludDY0O1xuICBzaW50NjQodDUpIHtcbiAgICBsZXQgeyBsbzogaTIsIGhpOiBzMiB9ID0gaW50NjRGcm9tU3RyaW5nKHQ1LnRvU3RyaW5nKCkpO1xuICAgIHJldHVybiBbaTIsIHMyXSA9IHp6RW5jb2RlKGkyLCBzMiksIHRoaXMuX3B1c2god3JpdGVWYXJpbnQ2NCwgaW50NjRMZW5ndGgoaTIsIHMyKSwgeyBsbzogaTIsIGhpOiBzMiB9KTtcbiAgfVxuICBmaXhlZDY0KHQ1KSB7XG4gICAgY29uc3QgeyBsbzogaTIsIGhpOiBzMiB9ID0gaW50NjRGcm9tU3RyaW5nKHQ1LnRvU3RyaW5nKCkpO1xuICAgIHJldHVybiB0aGlzLl9wdXNoKHdyaXRlRml4ZWQzMiwgNCwgaTIpLl9wdXNoKHdyaXRlRml4ZWQzMiwgNCwgczIpO1xuICB9XG4gIHNmaXhlZDY0ID0gX0JpbmFyeVdyaXRlci5wcm90b3R5cGUuZml4ZWQ2NDtcbiAgYm9vbCh0NSkge1xuICAgIHJldHVybiB0aGlzLl9wdXNoKHdyaXRlQnl0ZSwgMSwgdDUgPyAxIDogMCk7XG4gIH1cbiAgZml4ZWQzMih0NSkge1xuICAgIHJldHVybiB0aGlzLl9wdXNoKHdyaXRlRml4ZWQzMiwgNCwgdDUgPj4+IDApO1xuICB9XG4gIHNmaXhlZDMyID0gX0JpbmFyeVdyaXRlci5wcm90b3R5cGUuZml4ZWQzMjtcbiAgZmxvYXQodDUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJmbG9hdCBub3Qgc3VwcG9ydGVkXCIgKyB0NSk7XG4gIH1cbiAgZG91YmxlKHQ1KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiZG91YmxlIG5vdCBzdXBwb3J0ZWRcIiArIHQ1KTtcbiAgfVxuICBieXRlcyh0NSkge1xuICAgIGNvbnN0IGkyID0gdDUubGVuZ3RoID4+PiAwO1xuICAgIHJldHVybiBpMiA/IHRoaXMudWludDMyKGkyKS5fcHVzaChnLCBpMiwgdDUpIDogdGhpcy5fcHVzaCh3cml0ZUJ5dGUsIDEsIDApO1xuICB9XG4gIHN0cmluZyhpMikge1xuICAgIGNvbnN0IGUyID0gdXRmOExlbmd0aChpMik7XG4gICAgcmV0dXJuIGUyID8gdGhpcy51aW50MzIoZTIpLl9wdXNoKHV0ZjhXcml0ZSwgZTIsIGkyKSA6IHRoaXMuX3B1c2god3JpdGVCeXRlLCAxLCAwKTtcbiAgfVxufTtcbmZ1bmN0aW9uIGcodDUsIGkyLCBzMikge1xuICBpZiAoXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgVWludDhBcnJheSkgaTIuc2V0KHQ1LCBzMik7XG4gIGVsc2UgZm9yIChsZXQgZTIgPSAwOyBlMiA8IHQ1Lmxlbmd0aDsgKytlMikgaTJbczIgKyBlMl0gPSB0NVtlMl07XG59XG5mdW5jdGlvbiBCKHQ1LCBpMikge1xuICByZXR1cm4gUmFuZ2VFcnJvcihcImluZGV4IG91dCBvZiByYW5nZTogXCIgKyB0NS5wb3MgKyBcIiArIFwiICsgKGkyIHx8IDEpICsgXCIgPiBcIiArIHQ1Lmxlbik7XG59XG5cbi8vXG5mdW5jdGlvbiBpc1NldCh0NSkge1xuICByZXR1cm4gbnVsbCAhPSB0NTtcbn1cbmZ1bmN0aW9uIHRvVGltZXN0YW1wKHQ1KSB7XG4gIHZhciBuMjtcbiAgcmV0dXJuIHsgc2Vjb25kczogKG4yID0gdDUuZ2V0VGltZSgpIC8gMWUzLCBCaWdJbnQoTWF0aC50cnVuYyhuMikpKSwgbmFub3M6IHQ1LmdldFRpbWUoKSAlIDFlMyAqIDFlNiB9O1xufVxuZnVuY3Rpb24gZnJvbVRpbWVzdGFtcCh0NSkge1xuICBsZXQgbjIgPSAxZTMgKiBOdW1iZXIodDUuc2Vjb25kcyk7XG4gIHJldHVybiBuMiArPSB0NS5uYW5vcyAvIDFlNiwgbmV3IERhdGUobjIpO1xufVxuZnVuY3Rpb24gZnJvbUpzb25UaW1lc3RhbXAodDUpIHtcbiAgcmV0dXJuIHQ1IGluc3RhbmNlb2YgRGF0ZSA/IHRvVGltZXN0YW1wKHQ1KSA6IFwic3RyaW5nXCIgPT0gdHlwZW9mIHQ1ID8gdG9UaW1lc3RhbXAobmV3IERhdGUodDUpKSA6IHsgc2Vjb25kczogaXNTZXQoKG4yID0gdDUpLnNlY29uZHMpID8gQmlnSW50KG4yLnNlY29uZHMudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG5hbm9zOiBpc1NldChuMi5uYW5vcykgPyBOdW1iZXIobjIubmFub3MpIDogMCB9O1xuICB2YXIgbjI7XG59XG5cbi8vXG5mdW5jdGlvbiB0MigpIHtcbiAgcmV0dXJuIHsgc2Vjb25kczogQmlnSW50KDApLCBuYW5vczogMCB9O1xufVxudmFyIFRpbWVzdGFtcCA9IHsgdHlwZVVybDogXCIvZ29vZ2xlLnByb3RvYnVmLlRpbWVzdGFtcFwiLCBlbmNvZGU6IChuMiwgczIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChuMi5zZWNvbmRzICE9PSBCaWdJbnQoMCkgJiYgczIudWludDMyKDgpLmludDY0KG4yLnNlY29uZHMpLCAwICE9PSBuMi5uYW5vcyAmJiBzMi51aW50MzIoMTYpLmludDMyKG4yLm5hbm9zKSwgczIpLCBkZWNvZGUobzIsIHMyKSB7XG4gIGNvbnN0IGUyID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IHMyID8gZTIubGVuIDogZTIucG9zICsgczI7XG4gIGNvbnN0IHI2ID0gdDIoKTtcbiAgZm9yICg7IGUyLnBvcyA8IGkyOyApIHtcbiAgICBjb25zdCBuMiA9IGUyLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobjIgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcjYuc2Vjb25kcyA9IGUyLmludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNi5uYW5vcyA9IGUyLmludDMyKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgZTIuc2tpcFR5cGUoNyAmIG4yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI2O1xufSwgZnJvbUpTT046IChuMikgPT4gKHsgc2Vjb25kczogaXNTZXQobjIuc2Vjb25kcykgPyBCaWdJbnQobjIuc2Vjb25kcy50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbmFub3M6IGlzU2V0KG4yLm5hbm9zKSA/IE51bWJlcihuMi5uYW5vcykgOiAwIH0pLCB0b0pTT04objIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbjIuc2Vjb25kcyAmJiAobzIuc2Vjb25kcyA9IChuMi5zZWNvbmRzIHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gbjIubmFub3MgJiYgKG8yLm5hbm9zID0gTWF0aC5yb3VuZChuMi5uYW5vcykpLCBvMjtcbn0sIGZyb21QYXJ0aWFsKG4yKSB7XG4gIGNvbnN0IG8yID0gdDIoKTtcbiAgcmV0dXJuIG8yLnNlY29uZHMgPSB2b2lkIDAgIT09IG4yLnNlY29uZHMgJiYgbnVsbCAhPT0gbjIuc2Vjb25kcyA/IEJpZ0ludChuMi5zZWNvbmRzLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBvMi5uYW5vcyA9IG4yLm5hbm9zID8/IDAsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAobjIpID0+IFRpbWVzdGFtcC5kZWNvZGUobjIudmFsdWUpLCB0b1Byb3RvOiAobjIpID0+IFRpbWVzdGFtcC5lbmNvZGUobjIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobjIpID0+ICh7IHR5cGVVcmw6IFwiL2dvb2dsZS5wcm90b2J1Zi5UaW1lc3RhbXBcIiwgdmFsdWU6IFRpbWVzdGFtcC5lbmNvZGUobjIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgQmxvY2tJREZsYWc7XG4hKGZ1bmN0aW9uKG8yKSB7XG4gIG8yW28yLkJMT0NLX0lEX0ZMQUdfVU5LTk9XTiA9IDBdID0gXCJCTE9DS19JRF9GTEFHX1VOS05PV05cIiwgbzJbbzIuQkxPQ0tfSURfRkxBR19BQlNFTlQgPSAxXSA9IFwiQkxPQ0tfSURfRkxBR19BQlNFTlRcIiwgbzJbbzIuQkxPQ0tfSURfRkxBR19DT01NSVQgPSAyXSA9IFwiQkxPQ0tfSURfRkxBR19DT01NSVRcIiwgbzJbbzIuQkxPQ0tfSURfRkxBR19OSUwgPSAzXSA9IFwiQkxPQ0tfSURfRkxBR19OSUxcIiwgbzJbbzIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0pKEJsb2NrSURGbGFnIHx8IChCbG9ja0lERmxhZyA9IHt9KSk7XG5cbi8vXG52YXIgQ2hlY2tUeFR5cGU7XG4hKGZ1bmN0aW9uKGUyKSB7XG4gIGUyW2UyLk5FVyA9IDBdID0gXCJORVdcIiwgZTJbZTIuUkVDSEVDSyA9IDFdID0gXCJSRUNIRUNLXCIsIGUyW2UyLlVOUkVDT0dOSVpFRCA9IC0xXSA9IFwiVU5SRUNPR05JWkVEXCI7XG59KShDaGVja1R4VHlwZSB8fCAoQ2hlY2tUeFR5cGUgPSB7fSkpO1xudmFyIFJlc3BvbnNlT2ZmZXJTbmFwc2hvdF9SZXN1bHQ7XG4hKGZ1bmN0aW9uKGUyKSB7XG4gIGUyW2UyLlVOS05PV04gPSAwXSA9IFwiVU5LTk9XTlwiLCBlMltlMi5BQ0NFUFQgPSAxXSA9IFwiQUNDRVBUXCIsIGUyW2UyLkFCT1JUID0gMl0gPSBcIkFCT1JUXCIsIGUyW2UyLlJFSkVDVCA9IDNdID0gXCJSRUpFQ1RcIiwgZTJbZTIuUkVKRUNUX0ZPUk1BVCA9IDRdID0gXCJSRUpFQ1RfRk9STUFUXCIsIGUyW2UyLlJFSkVDVF9TRU5ERVIgPSA1XSA9IFwiUkVKRUNUX1NFTkRFUlwiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufSkoUmVzcG9uc2VPZmZlclNuYXBzaG90X1Jlc3VsdCB8fCAoUmVzcG9uc2VPZmZlclNuYXBzaG90X1Jlc3VsdCA9IHt9KSk7XG52YXIgUmVzcG9uc2VBcHBseVNuYXBzaG90Q2h1bmtfUmVzdWx0O1xuIShmdW5jdGlvbihlMikge1xuICBlMltlMi5VTktOT1dOID0gMF0gPSBcIlVOS05PV05cIiwgZTJbZTIuQUNDRVBUID0gMV0gPSBcIkFDQ0VQVFwiLCBlMltlMi5BQk9SVCA9IDJdID0gXCJBQk9SVFwiLCBlMltlMi5SRVRSWSA9IDNdID0gXCJSRVRSWVwiLCBlMltlMi5SRVRSWV9TTkFQU0hPVCA9IDRdID0gXCJSRVRSWV9TTkFQU0hPVFwiLCBlMltlMi5SRUpFQ1RfU05BUFNIT1QgPSA1XSA9IFwiUkVKRUNUX1NOQVBTSE9UXCIsIGUyW2UyLlVOUkVDT0dOSVpFRCA9IC0xXSA9IFwiVU5SRUNPR05JWkVEXCI7XG59KShSZXNwb25zZUFwcGx5U25hcHNob3RDaHVua19SZXN1bHQgfHwgKFJlc3BvbnNlQXBwbHlTbmFwc2hvdENodW5rX1Jlc3VsdCA9IHt9KSk7XG52YXIgUmVzcG9uc2VQcm9jZXNzUHJvcG9zYWxfUHJvcG9zYWxTdGF0dXM7XG4hKGZ1bmN0aW9uKGUyKSB7XG4gIGUyW2UyLlVOS05PV04gPSAwXSA9IFwiVU5LTk9XTlwiLCBlMltlMi5BQ0NFUFQgPSAxXSA9IFwiQUNDRVBUXCIsIGUyW2UyLlJFSkVDVCA9IDJdID0gXCJSRUpFQ1RcIiwgZTJbZTIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0pKFJlc3BvbnNlUHJvY2Vzc1Byb3Bvc2FsX1Byb3Bvc2FsU3RhdHVzIHx8IChSZXNwb25zZVByb2Nlc3NQcm9wb3NhbF9Qcm9wb3NhbFN0YXR1cyA9IHt9KSk7XG52YXIgUmVzcG9uc2VWZXJpZnlWb3RlRXh0ZW5zaW9uX1ZlcmlmeVN0YXR1cztcbiEoZnVuY3Rpb24oZTIpIHtcbiAgZTJbZTIuVU5LTk9XTiA9IDBdID0gXCJVTktOT1dOXCIsIGUyW2UyLkFDQ0VQVCA9IDFdID0gXCJBQ0NFUFRcIiwgZTJbZTIuUkVKRUNUID0gMl0gPSBcIlJFSkVDVFwiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufSkoUmVzcG9uc2VWZXJpZnlWb3RlRXh0ZW5zaW9uX1ZlcmlmeVN0YXR1cyB8fCAoUmVzcG9uc2VWZXJpZnlWb3RlRXh0ZW5zaW9uX1ZlcmlmeVN0YXR1cyA9IHt9KSk7XG52YXIgTWlzYmVoYXZpb3JUeXBlO1xuIShmdW5jdGlvbihlMikge1xuICBlMltlMi5VTktOT1dOID0gMF0gPSBcIlVOS05PV05cIiwgZTJbZTIuRFVQTElDQVRFX1ZPVEUgPSAxXSA9IFwiRFVQTElDQVRFX1ZPVEVcIiwgZTJbZTIuTElHSFRfQ0xJRU5UX0FUVEFDSyA9IDJdID0gXCJMSUdIVF9DTElFTlRfQVRUQUNLXCIsIGUyW2UyLlVOUkVDT0dOSVpFRCA9IC0xXSA9IFwiVU5SRUNPR05JWkVEXCI7XG59KShNaXNiZWhhdmlvclR5cGUgfHwgKE1pc2JlaGF2aW9yVHlwZSA9IHt9KSk7XG5mdW5jdGlvbiBtKCkge1xuICByZXR1cm4geyBkYXRhOiBuZXcgVWludDhBcnJheSgpLCBwYXRoOiBcIlwiLCBoZWlnaHQ6IEJpZ0ludCgwKSwgcHJvdmU6IGZhbHNlIH07XG59XG52YXIgUmVxdWVzdFF1ZXJ5ID0geyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmFiY2kuUmVxdWVzdFF1ZXJ5XCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKDAgIT09IGUyLmRhdGEubGVuZ3RoICYmIHQ1LnVpbnQzMigxMCkuYnl0ZXMoZTIuZGF0YSksIFwiXCIgIT09IGUyLnBhdGggJiYgdDUudWludDMyKDE4KS5zdHJpbmcoZTIucGF0aCksIGUyLmhlaWdodCAhPT0gQmlnSW50KDApICYmIHQ1LnVpbnQzMigyNCkuaW50NjQoZTIuaGVpZ2h0KSwgdHJ1ZSA9PT0gZTIucHJvdmUgJiYgdDUudWludDMyKDMyKS5ib29sKGUyLnByb3ZlKSwgdDUpLCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG8yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgczIgPSB2b2lkIDAgPT09IHQ1ID8gbzIubGVuIDogbzIucG9zICsgdDU7XG4gIGNvbnN0IG4yID0gbSgpO1xuICBmb3IgKDsgbzIucG9zIDwgczI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBuMi5kYXRhID0gbzIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIG4yLnBhdGggPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIG4yLmhlaWdodCA9IG8yLmludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBuMi5wcm92ZSA9IG8yLmJvb2woKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbjI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkYXRhOiBpc1NldChlMi5kYXRhKSA/IGRlY29kZUJhc2U2NChlMi5kYXRhKSA6IG5ldyBVaW50OEFycmF5KCksIHBhdGg6IGlzU2V0KGUyLnBhdGgpID8gU3RyaW5nKGUyLnBhdGgpIDogXCJcIiwgaGVpZ2h0OiBpc1NldChlMi5oZWlnaHQpID8gQmlnSW50KGUyLmhlaWdodC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgcHJvdmU6ICEhaXNTZXQoZTIucHJvdmUpICYmIEJvb2xlYW4oZTIucHJvdmUpIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGF0YSAmJiAodDUuZGF0YSA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IGUyLmRhdGEgPyBlMi5kYXRhIDogbmV3IFVpbnQ4QXJyYXkoKSkpLCB2b2lkIDAgIT09IGUyLnBhdGggJiYgKHQ1LnBhdGggPSBlMi5wYXRoKSwgdm9pZCAwICE9PSBlMi5oZWlnaHQgJiYgKHQ1LmhlaWdodCA9IChlMi5oZWlnaHQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi5wcm92ZSAmJiAodDUucHJvdmUgPSBlMi5wcm92ZSksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSBtKCk7XG4gIHJldHVybiB0NS5kYXRhID0gZTIuZGF0YSA/PyBuZXcgVWludDhBcnJheSgpLCB0NS5wYXRoID0gZTIucGF0aCA/PyBcIlwiLCB0NS5oZWlnaHQgPSB2b2lkIDAgIT09IGUyLmhlaWdodCAmJiBudWxsICE9PSBlMi5oZWlnaHQgPyBCaWdJbnQoZTIuaGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCB0NS5wcm92ZSA9IGUyLnByb3ZlID8/IGZhbHNlLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBSZXF1ZXN0UXVlcnkuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBSZXF1ZXN0UXVlcnkuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmFiY2kuUmVxdWVzdFF1ZXJ5XCIsIHZhbHVlOiBSZXF1ZXN0UXVlcnkuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIHQzID0gL15cXC8oPzxzZXJ2aWNlTmFtZT5cXHcrKD86XFwuXFx3KykqKVxcLlF1ZXJ5KD88bWV0aG9kTmFtZT5cXHcrKVJlcXVlc3QkLztcbnZhciB0eXBlVXJsVG9HcnBjUGF0aCA9IChlMikgPT4ge1xuICBjb25zdCByNiA9IGUyLm1hdGNoKHQzKTtcbiAgaWYgKCFyNiB8fCAhcjYuZ3JvdXBzKSB0aHJvdyBUeXBlRXJyb3IoYEludmFsaWQgdHlwZVVybDogJHtlMn0uIE11c3QgYmUgYSBRdWVyeSBSZXF1ZXN0LmApO1xuICBjb25zdCB7IHNlcnZpY2VOYW1lOiBvMiwgbWV0aG9kTmFtZTogczIgfSA9IHI2Lmdyb3VwcztcbiAgcmV0dXJuIGAvJHtvMn0uUXVlcnkvJHtzMn1gO1xufTtcbnZhciB0b1JlcXVlc3RRdWVyeUpzb24gPSAodDUsIHI2ID0ge30pID0+IFJlcXVlc3RRdWVyeS50b0pTT04oUmVxdWVzdFF1ZXJ5LmZyb21QYXJ0aWFsKHsgcGF0aDogdHlwZVVybFRvR3JwY1BhdGgodDUudHlwZVVybCksIGRhdGE6IHQ1LnZhbHVlLCAuLi5yNiB9KSk7XG5cbi8vXG52YXIgeyBmcmVlemU6IHQ0IH0gPSBPYmplY3Q7XG52YXIgcjIgPSB7IFwiL2liYy5hcHBsaWNhdGlvbnMudHJhbnNmZXIudjEuTXNnVHJhbnNmZXJcIjogW1widGltZW91dF9oZWlnaHRcIiwgXCJ0aW1lb3V0SGVpZ2h0XCJdIH07XG52YXIgZSA9IHsgXCIvY29zbW9zLmF1dGgudjFiZXRhMS5Nb2R1bGVBY2NvdW50XCI6IHsgYmFzZV9hY2NvdW50OiBcImJhc2VBY2NvdW50XCIgfSB9O1xudmFyIENvZGVjID0gKGUyLCBvMikgPT4ge1xuICBjb25zdCBuMiA9IG8yID8/IHIyW2UyLnR5cGVVcmxdID8/IFtdLCBsMiA9IHQ0KHsgdHlwZVVybDogZTIudHlwZVVybCwgZW5jb2RlOiAodDUsIHI2KSA9PiBlMi5lbmNvZGUobDIuZnJvbVBhcnRpYWwodDUpLCByNiksIGRlY29kZTogKHQ1LCByNikgPT4gZTIuZGVjb2RlKHQ1LCByNiksIGZyb21KU09OOiAodDUpID0+IGUyLmZyb21KU09OKHQ1KSwgdG9KU09OOiAodDUpID0+IGUyLnRvSlNPTihsMi5mcm9tUGFydGlhbCh0NSkpLCBmcm9tUGFydGlhbCh0NSkge1xuICAgIGNvbnN0IHI2ID0geyAuLi50NSB9O1xuICAgIGZvciAoY29uc3QgdDYgb2YgbjIpIG51bGwgPT0gcjZbdDZdICYmIChyNlt0Nl0gPSB7fSk7XG4gICAgcmV0dXJuIGUyLmZyb21QYXJ0aWFsKHI2KTtcbiAgfSwgZnJvbVByb3RvTXNnOiAodDUpID0+IGUyLmZyb21Qcm90b01zZyh0NSksIHRvUHJvdG86ICh0NSkgPT4gZTIudG9Qcm90byhsMi5mcm9tUGFydGlhbCh0NSkpLCB0b1Byb3RvTXNnOiAodDUpID0+IGUyLnRvUHJvdG9Nc2cobDIuZnJvbVBhcnRpYWwodDUpKSB9KTtcbiAgcmV0dXJuIGwyO1xufTtcbnZhciBDb2RlY0hlbHBlciA9IChyNiwgbzIpID0+IHtcbiAgY29uc3QgbjIgPSBDb2RlYyhyNiwgbzIpO1xuICByZXR1cm4gdDQoeyAuLi5uMiwgdHlwZWRBbWlubzogKHQ1KSA9PiAoeyB0eXBlOiByNi50eXBlVXJsLCB2YWx1ZTogbjIuZnJvbVBhcnRpYWwodDUpIH0pLCB0eXBlZEVuY29kZTogKHQ1KSA9PiAoeyB0eXBlVXJsOiByNi50eXBlVXJsLCB2YWx1ZTogbjIuZnJvbVBhcnRpYWwodDUpIH0pLCB0eXBlZEpzb246ICh0NSkgPT4gKHsgXCJAdHlwZVwiOiByNi50eXBlVXJsLCAuLi5uMi5mcm9tUGFydGlhbCh0NSkgfSksIGZyb21UeXBlZCh0NSwgbzMpIHtcbiAgICBjb25zdCB7IHR5cGVVcmw6IGwyLCB2YWx1ZTogYTIgfSA9ICgodDYpID0+IHtcbiAgICAgIGlmIChcIkB0eXBlXCIgaW4gdDYpIHtcbiAgICAgICAgY29uc3QgeyBcIkB0eXBlXCI6IHI3LCAuLi5lMiB9ID0gdDY7XG4gICAgICAgIHJldHVybiB7IHR5cGVVcmw6IHI3LCB2YWx1ZTogZTIgfTtcbiAgICAgIH1cbiAgICAgIGlmIChcIiR0eXBlVXJsXCIgaW4gdDYpIHtcbiAgICAgICAgY29uc3QgeyAkdHlwZVVybDogcjcsIC4uLmUyIH0gPSB0NjtcbiAgICAgICAgcmV0dXJuIHsgdHlwZVVybDogcjcsIHZhbHVlOiBlMiB9O1xuICAgICAgfVxuICAgICAgaWYgKFwidHlwZVVybFwiIGluIHQ2KSB7XG4gICAgICAgIGNvbnN0IHsgdHlwZVVybDogcjcsIHZhbHVlOiBlMiB9ID0gdDY7XG4gICAgICAgIHJldHVybiB7IHR5cGVVcmw6IHI3LCB2YWx1ZTogZTIgaW5zdGFuY2VvZiBVaW50OEFycmF5ID8gZTIgOiB7IC4uLmUyIH0gfTtcbiAgICAgIH1cbiAgICAgIGlmIChcInR5cGVcIiBpbiB0Nikge1xuICAgICAgICBjb25zdCB7IHR5cGU6IHI3LCB2YWx1ZTogZTIgfSA9IHQ2O1xuICAgICAgICByZXR1cm4geyB0eXBlVXJsOiByNywgdmFsdWU6IGUyIH07XG4gICAgICB9XG4gICAgICB0aHJvdyBUeXBlRXJyb3IoYFVucmVjb2duaXplZCBpbnB1dDogJHt0Nn1gKTtcbiAgICB9KSh0NSk7XG4gICAgaWYgKGwyICE9PSByNi50eXBlVXJsKSB0aHJvdyBUeXBlRXJyb3IoYEludmFsaWQgdHlwZVVybDogJHtsMn0uIE11c3QgYmUgJHtyNi50eXBlVXJsfS5gKTtcbiAgICBjb25zdCBjMiA9IG8zID8/IGVbbDJdID8/IHt9LCBpMiA9ICh0NikgPT4ge1xuICAgICAgZm9yIChjb25zdCBbcjgsIGUyXSBvZiBPYmplY3QuZW50cmllcyhjMikpIG51bGwgPT0gdDZbZTJdICYmICh0NltlMl0gPSBhMltyOF0gPz8gYTIpO1xuICAgICAgY29uc3QgcjcgPSBuMi5mcm9tUGFydGlhbCh0Nik7XG4gICAgICBmb3IgKGNvbnN0IHQ3IG9mIE9iamVjdC52YWx1ZXMoYzIpKSB7XG4gICAgICAgIGNvbnN0IGUyID0gcjdbdDddID8/IHI3O1xuICAgICAgICBpZiAoT2JqZWN0KGUyKSA9PT0gZTIpIGZvciAoY29uc3QgW3Q4LCBvNF0gb2YgT2JqZWN0LmVudHJpZXMoZTIpKSBudWxsID09IHI3W3Q4XSAmJiAocjdbdDhdID0gbzQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHI3O1xuICAgIH07XG4gICAgcmV0dXJuIGEyIGluc3RhbmNlb2YgVWludDhBcnJheSA/IGkyKG4yLmZyb21Qcm90b01zZyh7IHR5cGVVcmw6IGwyLCB2YWx1ZTogYTIgfSkpIDogaTIobjIuZnJvbVBhcnRpYWwoYTIpKTtcbiAgfSB9KTtcbn07XG5cbi8vXG5mdW5jdGlvbiByMygpIHtcbiAgcmV0dXJuIHsgZnJvbTogXCJcIiwgYW1vdW50OiBcIlwiLCBkZXN0aW5hdGlvbkRvbWFpbjogMCwgbWludFJlY2lwaWVudDogbmV3IFVpbnQ4QXJyYXkoKSwgYnVyblRva2VuOiBcIlwiIH07XG59XG52YXIgTXNnRGVwb3NpdEZvckJ1cm4gPSB7IHR5cGVVcmw6IFwiL2NpcmNsZS5jY3RwLnYxLk1zZ0RlcG9zaXRGb3JCdXJuXCIsIGVuY29kZTogKG4yLCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IG4yLmZyb20gJiYgZTIudWludDMyKDEwKS5zdHJpbmcobjIuZnJvbSksIFwiXCIgIT09IG4yLmFtb3VudCAmJiBlMi51aW50MzIoMTgpLnN0cmluZyhuMi5hbW91bnQpLCAwICE9PSBuMi5kZXN0aW5hdGlvbkRvbWFpbiAmJiBlMi51aW50MzIoMjQpLnVpbnQzMihuMi5kZXN0aW5hdGlvbkRvbWFpbiksIDAgIT09IG4yLm1pbnRSZWNpcGllbnQubGVuZ3RoICYmIGUyLnVpbnQzMigzNCkuYnl0ZXMobjIubWludFJlY2lwaWVudCksIFwiXCIgIT09IG4yLmJ1cm5Ub2tlbiAmJiBlMi51aW50MzIoNDIpLnN0cmluZyhuMi5idXJuVG9rZW4pLCBlMiksIGRlY29kZSh0NSwgZTIpIHtcbiAgY29uc3QgbzIgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gZTIgPyBvMi5sZW4gOiBvMi5wb3MgKyBlMjtcbiAgY29uc3QgczIgPSByMygpO1xuICBmb3IgKDsgbzIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IG4yID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChuMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBzMi5mcm9tID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBzMi5hbW91bnQgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHMyLmRlc3RpbmF0aW9uRG9tYWluID0gbzIudWludDMyKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBzMi5taW50UmVjaXBpZW50ID0gbzIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDU6XG4gICAgICAgIHMyLmJ1cm5Ub2tlbiA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBuMik7XG4gICAgfVxuICB9XG4gIHJldHVybiBzMjtcbn0sIGZyb21KU09OOiAobjIpID0+ICh7IGZyb206IGlzU2V0KG4yLmZyb20pID8gU3RyaW5nKG4yLmZyb20pIDogXCJcIiwgYW1vdW50OiBpc1NldChuMi5hbW91bnQpID8gU3RyaW5nKG4yLmFtb3VudCkgOiBcIlwiLCBkZXN0aW5hdGlvbkRvbWFpbjogaXNTZXQobjIuZGVzdGluYXRpb25Eb21haW4pID8gTnVtYmVyKG4yLmRlc3RpbmF0aW9uRG9tYWluKSA6IDAsIG1pbnRSZWNpcGllbnQ6IGlzU2V0KG4yLm1pbnRSZWNpcGllbnQpID8gZGVjb2RlQmFzZTY0KG4yLm1pbnRSZWNpcGllbnQpIDogbmV3IFVpbnQ4QXJyYXkoKSwgYnVyblRva2VuOiBpc1NldChuMi5idXJuVG9rZW4pID8gU3RyaW5nKG4yLmJ1cm5Ub2tlbikgOiBcIlwiIH0pLCB0b0pTT04objIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbjIuZnJvbSAmJiAodDUuZnJvbSA9IG4yLmZyb20pLCB2b2lkIDAgIT09IG4yLmFtb3VudCAmJiAodDUuYW1vdW50ID0gbjIuYW1vdW50KSwgdm9pZCAwICE9PSBuMi5kZXN0aW5hdGlvbkRvbWFpbiAmJiAodDUuZGVzdGluYXRpb25Eb21haW4gPSBNYXRoLnJvdW5kKG4yLmRlc3RpbmF0aW9uRG9tYWluKSksIHZvaWQgMCAhPT0gbjIubWludFJlY2lwaWVudCAmJiAodDUubWludFJlY2lwaWVudCA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IG4yLm1pbnRSZWNpcGllbnQgPyBuMi5taW50UmVjaXBpZW50IDogbmV3IFVpbnQ4QXJyYXkoKSkpLCB2b2lkIDAgIT09IG4yLmJ1cm5Ub2tlbiAmJiAodDUuYnVyblRva2VuID0gbjIuYnVyblRva2VuKSwgdDU7XG59LCBmcm9tUGFydGlhbChuMikge1xuICBjb25zdCB0NSA9IHIzKCk7XG4gIHJldHVybiB0NS5mcm9tID0gbjIuZnJvbSA/PyBcIlwiLCB0NS5hbW91bnQgPSBuMi5hbW91bnQgPz8gXCJcIiwgdDUuZGVzdGluYXRpb25Eb21haW4gPSBuMi5kZXN0aW5hdGlvbkRvbWFpbiA/PyAwLCB0NS5taW50UmVjaXBpZW50ID0gbjIubWludFJlY2lwaWVudCA/PyBuZXcgVWludDhBcnJheSgpLCB0NS5idXJuVG9rZW4gPSBuMi5idXJuVG9rZW4gPz8gXCJcIiwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChuMikgPT4gTXNnRGVwb3NpdEZvckJ1cm4uZGVjb2RlKG4yLnZhbHVlKSwgdG9Qcm90bzogKG4yKSA9PiBNc2dEZXBvc2l0Rm9yQnVybi5lbmNvZGUobjIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobjIpID0+ICh7IHR5cGVVcmw6IFwiL2NpcmNsZS5jY3RwLnYxLk1zZ0RlcG9zaXRGb3JCdXJuXCIsIHZhbHVlOiBNc2dEZXBvc2l0Rm9yQnVybi5lbmNvZGUobjIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBhKCkge1xuICByZXR1cm4geyBmcm9tOiBcIlwiLCBhbW91bnQ6IFwiXCIsIGRlc3RpbmF0aW9uRG9tYWluOiAwLCBtaW50UmVjaXBpZW50OiBuZXcgVWludDhBcnJheSgpLCBidXJuVG9rZW46IFwiXCIsIGRlc3RpbmF0aW9uQ2FsbGVyOiBuZXcgVWludDhBcnJheSgpIH07XG59XG52YXIgTXNnRGVwb3NpdEZvckJ1cm5XaXRoQ2FsbGVyID0geyB0eXBlVXJsOiBcIi9jaXJjbGUuY2N0cC52MS5Nc2dEZXBvc2l0Rm9yQnVybldpdGhDYWxsZXJcIiwgZW5jb2RlOiAobjIsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gbjIuZnJvbSAmJiBlMi51aW50MzIoMTApLnN0cmluZyhuMi5mcm9tKSwgXCJcIiAhPT0gbjIuYW1vdW50ICYmIGUyLnVpbnQzMigxOCkuc3RyaW5nKG4yLmFtb3VudCksIDAgIT09IG4yLmRlc3RpbmF0aW9uRG9tYWluICYmIGUyLnVpbnQzMigyNCkudWludDMyKG4yLmRlc3RpbmF0aW9uRG9tYWluKSwgMCAhPT0gbjIubWludFJlY2lwaWVudC5sZW5ndGggJiYgZTIudWludDMyKDM0KS5ieXRlcyhuMi5taW50UmVjaXBpZW50KSwgXCJcIiAhPT0gbjIuYnVyblRva2VuICYmIGUyLnVpbnQzMig0Mikuc3RyaW5nKG4yLmJ1cm5Ub2tlbiksIDAgIT09IG4yLmRlc3RpbmF0aW9uQ2FsbGVyLmxlbmd0aCAmJiBlMi51aW50MzIoNTApLmJ5dGVzKG4yLmRlc3RpbmF0aW9uQ2FsbGVyKSwgZTIpLCBkZWNvZGUodDUsIGUyKSB7XG4gIGNvbnN0IG8yID0gdDUgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyB0NSA6IG5ldyBCaW5hcnlSZWFkZXIodDUpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IGUyID8gbzIubGVuIDogbzIucG9zICsgZTI7XG4gIGNvbnN0IHI2ID0gYSgpO1xuICBmb3IgKDsgbzIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IG4yID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChuMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNi5mcm9tID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNi5hbW91bnQgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHI2LmRlc3RpbmF0aW9uRG9tYWluID0gbzIudWludDMyKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICByNi5taW50UmVjaXBpZW50ID0gbzIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDU6XG4gICAgICAgIHI2LmJ1cm5Ub2tlbiA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNjpcbiAgICAgICAgcjYuZGVzdGluYXRpb25DYWxsZXIgPSBvMi5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBuMik7XG4gICAgfVxuICB9XG4gIHJldHVybiByNjtcbn0sIGZyb21KU09OOiAobjIpID0+ICh7IGZyb206IGlzU2V0KG4yLmZyb20pID8gU3RyaW5nKG4yLmZyb20pIDogXCJcIiwgYW1vdW50OiBpc1NldChuMi5hbW91bnQpID8gU3RyaW5nKG4yLmFtb3VudCkgOiBcIlwiLCBkZXN0aW5hdGlvbkRvbWFpbjogaXNTZXQobjIuZGVzdGluYXRpb25Eb21haW4pID8gTnVtYmVyKG4yLmRlc3RpbmF0aW9uRG9tYWluKSA6IDAsIG1pbnRSZWNpcGllbnQ6IGlzU2V0KG4yLm1pbnRSZWNpcGllbnQpID8gZGVjb2RlQmFzZTY0KG4yLm1pbnRSZWNpcGllbnQpIDogbmV3IFVpbnQ4QXJyYXkoKSwgYnVyblRva2VuOiBpc1NldChuMi5idXJuVG9rZW4pID8gU3RyaW5nKG4yLmJ1cm5Ub2tlbikgOiBcIlwiLCBkZXN0aW5hdGlvbkNhbGxlcjogaXNTZXQobjIuZGVzdGluYXRpb25DYWxsZXIpID8gZGVjb2RlQmFzZTY0KG4yLmRlc3RpbmF0aW9uQ2FsbGVyKSA6IG5ldyBVaW50OEFycmF5KCkgfSksIHRvSlNPTihuMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBuMi5mcm9tICYmICh0NS5mcm9tID0gbjIuZnJvbSksIHZvaWQgMCAhPT0gbjIuYW1vdW50ICYmICh0NS5hbW91bnQgPSBuMi5hbW91bnQpLCB2b2lkIDAgIT09IG4yLmRlc3RpbmF0aW9uRG9tYWluICYmICh0NS5kZXN0aW5hdGlvbkRvbWFpbiA9IE1hdGgucm91bmQobjIuZGVzdGluYXRpb25Eb21haW4pKSwgdm9pZCAwICE9PSBuMi5taW50UmVjaXBpZW50ICYmICh0NS5taW50UmVjaXBpZW50ID0gZW5jb2RlQmFzZTY0KHZvaWQgMCAhPT0gbjIubWludFJlY2lwaWVudCA/IG4yLm1pbnRSZWNpcGllbnQgOiBuZXcgVWludDhBcnJheSgpKSksIHZvaWQgMCAhPT0gbjIuYnVyblRva2VuICYmICh0NS5idXJuVG9rZW4gPSBuMi5idXJuVG9rZW4pLCB2b2lkIDAgIT09IG4yLmRlc3RpbmF0aW9uQ2FsbGVyICYmICh0NS5kZXN0aW5hdGlvbkNhbGxlciA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IG4yLmRlc3RpbmF0aW9uQ2FsbGVyID8gbjIuZGVzdGluYXRpb25DYWxsZXIgOiBuZXcgVWludDhBcnJheSgpKSksIHQ1O1xufSwgZnJvbVBhcnRpYWwobjIpIHtcbiAgY29uc3QgdDUgPSBhKCk7XG4gIHJldHVybiB0NS5mcm9tID0gbjIuZnJvbSA/PyBcIlwiLCB0NS5hbW91bnQgPSBuMi5hbW91bnQgPz8gXCJcIiwgdDUuZGVzdGluYXRpb25Eb21haW4gPSBuMi5kZXN0aW5hdGlvbkRvbWFpbiA/PyAwLCB0NS5taW50UmVjaXBpZW50ID0gbjIubWludFJlY2lwaWVudCA/PyBuZXcgVWludDhBcnJheSgpLCB0NS5idXJuVG9rZW4gPSBuMi5idXJuVG9rZW4gPz8gXCJcIiwgdDUuZGVzdGluYXRpb25DYWxsZXIgPSBuMi5kZXN0aW5hdGlvbkNhbGxlciA/PyBuZXcgVWludDhBcnJheSgpLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG4yKSA9PiBNc2dEZXBvc2l0Rm9yQnVybldpdGhDYWxsZXIuZGVjb2RlKG4yLnZhbHVlKSwgdG9Qcm90bzogKG4yKSA9PiBNc2dEZXBvc2l0Rm9yQnVybldpdGhDYWxsZXIuZW5jb2RlKG4yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG4yKSA9PiAoeyB0eXBlVXJsOiBcIi9jaXJjbGUuY2N0cC52MS5Nc2dEZXBvc2l0Rm9yQnVybldpdGhDYWxsZXJcIiwgdmFsdWU6IE1zZ0RlcG9zaXRGb3JCdXJuV2l0aENhbGxlci5lbmNvZGUobjIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG5mdW5jdGlvbiByNCgpIHtcbiAgcmV0dXJuIHsga2V5OiBuZXcgVWludDhBcnJheSgpLCBvZmZzZXQ6IEJpZ0ludCgwKSwgbGltaXQ6IEJpZ0ludCgwKSwgY291bnRUb3RhbDogZmFsc2UsIHJldmVyc2U6IGZhbHNlIH07XG59XG52YXIgUGFnZVJlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnF1ZXJ5LnYxYmV0YTEuUGFnZVJlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoMCAhPT0gZTIua2V5Lmxlbmd0aCAmJiBvMi51aW50MzIoMTApLmJ5dGVzKGUyLmtleSksIGUyLm9mZnNldCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMigxNikudWludDY0KGUyLm9mZnNldCksIGUyLmxpbWl0ICE9PSBCaWdJbnQoMCkgJiYgbzIudWludDMyKDI0KS51aW50NjQoZTIubGltaXQpLCB0cnVlID09PSBlMi5jb3VudFRvdGFsICYmIG8yLnVpbnQzMigzMikuYm9vbChlMi5jb3VudFRvdGFsKSwgdHJ1ZSA9PT0gZTIucmV2ZXJzZSAmJiBvMi51aW50MzIoNDApLmJvb2woZTIucmV2ZXJzZSksIG8yKSwgZGVjb2RlKHQ1LCBvMikge1xuICBjb25zdCBuMiA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSBvMiA/IG4yLmxlbiA6IG4yLnBvcyArIG8yO1xuICBjb25zdCBzMiA9IHI0KCk7XG4gIGZvciAoOyBuMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTIgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUyID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHMyLmtleSA9IG4yLmJ5dGVzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBzMi5vZmZzZXQgPSBuMi51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHMyLmxpbWl0ID0gbjIudWludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBzMi5jb3VudFRvdGFsID0gbjIuYm9vbCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgczIucmV2ZXJzZSA9IG4yLmJvb2woKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gczI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBrZXk6IGlzU2V0KGUyLmtleSkgPyBkZWNvZGVCYXNlNjQoZTIua2V5KSA6IG5ldyBVaW50OEFycmF5KCksIG9mZnNldDogaXNTZXQoZTIub2Zmc2V0KSA/IEJpZ0ludChlMi5vZmZzZXQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGxpbWl0OiBpc1NldChlMi5saW1pdCkgPyBCaWdJbnQoZTIubGltaXQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGNvdW50VG90YWw6ICEhaXNTZXQoZTIuY291bnRUb3RhbCkgJiYgQm9vbGVhbihlMi5jb3VudFRvdGFsKSwgcmV2ZXJzZTogISFpc1NldChlMi5yZXZlcnNlKSAmJiBCb29sZWFuKGUyLnJldmVyc2UpIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIua2V5ICYmICh0NS5rZXkgPSBlbmNvZGVCYXNlNjQodm9pZCAwICE9PSBlMi5rZXkgPyBlMi5rZXkgOiBuZXcgVWludDhBcnJheSgpKSksIHZvaWQgMCAhPT0gZTIub2Zmc2V0ICYmICh0NS5vZmZzZXQgPSAoZTIub2Zmc2V0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIubGltaXQgJiYgKHQ1LmxpbWl0ID0gKGUyLmxpbWl0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIuY291bnRUb3RhbCAmJiAodDUuY291bnRUb3RhbCA9IGUyLmNvdW50VG90YWwpLCB2b2lkIDAgIT09IGUyLnJldmVyc2UgJiYgKHQ1LnJldmVyc2UgPSBlMi5yZXZlcnNlKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHI0KCk7XG4gIHJldHVybiB0NS5rZXkgPSBlMi5rZXkgPz8gbmV3IFVpbnQ4QXJyYXkoKSwgdDUub2Zmc2V0ID0gdm9pZCAwICE9PSBlMi5vZmZzZXQgJiYgbnVsbCAhPT0gZTIub2Zmc2V0ID8gQmlnSW50KGUyLm9mZnNldC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgdDUubGltaXQgPSB2b2lkIDAgIT09IGUyLmxpbWl0ICYmIG51bGwgIT09IGUyLmxpbWl0ID8gQmlnSW50KGUyLmxpbWl0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCB0NS5jb3VudFRvdGFsID0gZTIuY291bnRUb3RhbCA/PyBmYWxzZSwgdDUucmV2ZXJzZSA9IGUyLnJldmVyc2UgPz8gZmFsc2UsIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFBhZ2VSZXF1ZXN0LmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUGFnZVJlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFzZS5xdWVyeS52MWJldGExLlBhZ2VSZXF1ZXN0XCIsIHZhbHVlOiBQYWdlUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBzKCkge1xuICByZXR1cm4geyBuZXh0S2V5OiBuZXcgVWludDhBcnJheSgpLCB0b3RhbDogQmlnSW50KDApIH07XG59XG52YXIgUGFnZVJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFzZS5xdWVyeS52MWJldGExLlBhZ2VSZXNwb25zZVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICgwICE9PSBlMi5uZXh0S2V5Lmxlbmd0aCAmJiBvMi51aW50MzIoMTApLmJ5dGVzKGUyLm5leHRLZXkpLCBlMi50b3RhbCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMigxNikudWludDY0KGUyLnRvdGFsKSwgbzIpLCBkZWNvZGUodDUsIG8yKSB7XG4gIGNvbnN0IG4yID0gdDUgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyB0NSA6IG5ldyBCaW5hcnlSZWFkZXIodDUpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IG8yID8gbjIubGVuIDogbjIucG9zICsgbzI7XG4gIGNvbnN0IHI2ID0gcygpO1xuICBmb3IgKDsgbjIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUyID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNi5uZXh0S2V5ID0gbjIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI2LnRvdGFsID0gbjIudWludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIGUyKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI2O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgbmV4dEtleTogaXNTZXQoZTIubmV4dEtleSkgPyBkZWNvZGVCYXNlNjQoZTIubmV4dEtleSkgOiBuZXcgVWludDhBcnJheSgpLCB0b3RhbDogaXNTZXQoZTIudG90YWwpID8gQmlnSW50KGUyLnRvdGFsLnRvU3RyaW5nKCkpIDogQmlnSW50KDApIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIubmV4dEtleSAmJiAodDUubmV4dEtleSA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IGUyLm5leHRLZXkgPyBlMi5uZXh0S2V5IDogbmV3IFVpbnQ4QXJyYXkoKSkpLCB2b2lkIDAgIT09IGUyLnRvdGFsICYmICh0NS50b3RhbCA9IChlMi50b3RhbCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0gcygpO1xuICByZXR1cm4gdDUubmV4dEtleSA9IGUyLm5leHRLZXkgPz8gbmV3IFVpbnQ4QXJyYXkoKSwgdDUudG90YWwgPSB2b2lkIDAgIT09IGUyLnRvdGFsICYmIG51bGwgIT09IGUyLnRvdGFsID8gQmlnSW50KGUyLnRvdGFsLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBQYWdlUmVzcG9uc2UuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBQYWdlUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFzZS5xdWVyeS52MWJldGExLlBhZ2VSZXNwb25zZVwiLCB2YWx1ZTogUGFnZVJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciBEZWNpbWFsID0gY2xhc3MgX0RlY2ltYWwge1xuICBzdGF0aWMgZnJvbVVzZXJJbnB1dCh0NSwgaTIpIHtcbiAgICBfRGVjaW1hbC52ZXJpZnlGcmFjdGlvbmFsRGlnaXRzKGkyKTtcbiAgICBjb25zdCByNiA9IHQ1Lm1hdGNoKC9bXjAtOS5dLyk7XG4gICAgaWYgKHI2KSB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgY2hhcmFjdGVyIGF0IHBvc2l0aW9uICR7cjYuaW5kZXggKyAxfWApO1xuICAgIGxldCBhMiwgZTI7XG4gICAgaWYgKFwiXCIgPT09IHQ1KSBhMiA9IFwiMFwiLCBlMiA9IFwiXCI7XG4gICAgZWxzZSBpZiAoLTEgPT09IHQ1LnNlYXJjaCgvXFwuLykpIGEyID0gdDUsIGUyID0gXCJcIjtcbiAgICBlbHNlIHtcbiAgICAgIGNvbnN0IGkzID0gdDUuc3BsaXQoXCIuXCIpO1xuICAgICAgc3dpdGNoIChpMy5sZW5ndGgpIHtcbiAgICAgICAgY2FzZSAwOlxuICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmV3ZXIgdGhhbiB0d28gZWxlbWVudHMgaW4gc3BsaXQgcmVzdWx0LiBUaGlzIG11c3Qgbm90IGhhcHBlbiBoZXJlLlwiKTtcbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgIGlmICghaTNbMV0pIHRocm93IG5ldyBFcnJvcihcIkZyYWN0aW9uYWwgcGFydCBtaXNzaW5nXCIpO1xuICAgICAgICAgIGEyID0gaTNbMF0sIGUyID0gaTNbMV0ucmVwbGFjZSgvMCskLywgXCJcIik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTW9yZSB0aGFuIG9uZSBzZXBhcmF0b3IgZm91bmRcIik7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChlMi5sZW5ndGggPiBpMikgdGhyb3cgbmV3IEVycm9yKFwiR290IG1vcmUgZnJhY3Rpb25hbCBkaWdpdHMgdGhhbiBzdXBwb3J0ZWRcIik7XG4gICAgY29uc3QgbjIgPSBgJHthMn0ke2UyLnBhZEVuZChpMiwgXCIwXCIpfWA7XG4gICAgcmV0dXJuIG5ldyBfRGVjaW1hbChuMiwgaTIpO1xuICB9XG4gIHN0YXRpYyBmcm9tQXRvbWljcyh0NSwgaTIpIHtcbiAgICByZXR1cm4gX0RlY2ltYWwudmVyaWZ5RnJhY3Rpb25hbERpZ2l0cyhpMiksIG5ldyBfRGVjaW1hbCh0NSwgaTIpO1xuICB9XG4gIHN0YXRpYyB2ZXJpZnlGcmFjdGlvbmFsRGlnaXRzKHQ1KSB7XG4gICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKHQ1KSkgdGhyb3cgbmV3IEVycm9yKFwiRnJhY3Rpb25hbCBkaWdpdHMgaXMgbm90IGFuIGludGVnZXJcIik7XG4gICAgaWYgKHQ1IDwgMCkgdGhyb3cgbmV3IEVycm9yKFwiRnJhY3Rpb25hbCBkaWdpdHMgbXVzdCBub3QgYmUgbmVnYXRpdmVcIik7XG4gICAgaWYgKHQ1ID4gMzApIHRocm93IG5ldyBFcnJvcihcIkZyYWN0aW9uYWwgZGlnaXRzIG11c3Qgbm90IGV4Y2VlZCAzMFwiKTtcbiAgfVxuICBnZXQgYXRvbWljcygpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLmF0b21pY3MudG9TdHJpbmcoKTtcbiAgfVxuICBnZXQgZnJhY3Rpb25hbERpZ2l0cygpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLmZyYWN0aW9uYWxEaWdpdHM7XG4gIH1cbiAgZGF0YTtcbiAgY29uc3RydWN0b3IodDUsIGkyKSB7XG4gICAgaWYgKCF0NS5tYXRjaCgvXlswLTldKyQvKSkgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBzdHJpbmcgZm9ybWF0LiBPbmx5IG5vbi1uZWdhdGl2ZSBpbnRlZ2VycyBpbiBkZWNpbWFsIHJlcHJlc2VudGF0aW9uIHN1cHBvcnRlZC5cIik7XG4gICAgdGhpcy5kYXRhID0geyBhdG9taWNzOiBCaWdJbnQodDUpLCBmcmFjdGlvbmFsRGlnaXRzOiBpMiB9O1xuICB9XG4gIHRvU3RyaW5nKCkge1xuICAgIGNvbnN0IHQ1ID0gQmlnSW50KDEwKSAqKiBCaWdJbnQodGhpcy5kYXRhLmZyYWN0aW9uYWxEaWdpdHMpLCBpMiA9IHRoaXMuZGF0YS5hdG9taWNzIC8gdDUsIHI2ID0gdGhpcy5kYXRhLmF0b21pY3MgJSB0NTtcbiAgICBpZiAoMG4gPT09IHI2KSByZXR1cm4gaTIudG9TdHJpbmcoKTtcbiAgICB7XG4gICAgICBjb25zdCB0NiA9IHI2LnRvU3RyaW5nKCkucGFkU3RhcnQodGhpcy5kYXRhLmZyYWN0aW9uYWxEaWdpdHMsIFwiMFwiKS5yZXBsYWNlKC8wKyQvLCBcIlwiKTtcbiAgICAgIHJldHVybiBgJHtpMi50b1N0cmluZygpfS4ke3Q2fWA7XG4gICAgfVxuICB9XG59O1xuXG4vL1xudmFyIENvaW4gPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnYxYmV0YTEuQ29pblwiLCBlbmNvZGU6IChvMiwgbjIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBvMi5kZW5vbSAmJiBuMi51aW50MzIoMTApLnN0cmluZyhvMi5kZW5vbSksIFwiXCIgIT09IG8yLmFtb3VudCAmJiBuMi51aW50MzIoMTgpLnN0cmluZyhvMi5hbW91bnQpLCBuMiksIGRlY29kZSh0NSwgbjIpIHtcbiAgY29uc3QgZTIgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCByNiA9IHZvaWQgMCA9PT0gbjIgPyBlMi5sZW4gOiBlMi5wb3MgKyBuMjtcbiAgY29uc3QgczIgPSB7IGRlbm9tOiBcIlwiLCBhbW91bnQ6IFwiXCIgfTtcbiAgZm9yICg7IGUyLnBvcyA8IHI2OyApIHtcbiAgICBjb25zdCBvMiA9IGUyLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzIgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczIuZGVub20gPSBlMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHMyLmFtb3VudCA9IGUyLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGUyLnNraXBUeXBlKDcgJiBvMik7XG4gICAgfVxuICB9XG4gIHJldHVybiBzMjtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IGRlbm9tOiBpc1NldChvMi5kZW5vbSkgPyBTdHJpbmcobzIuZGVub20pIDogXCJcIiwgYW1vdW50OiBpc1NldChvMi5hbW91bnQpID8gU3RyaW5nKG8yLmFtb3VudCkgOiBcIlwiIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuZGVub20gJiYgKHQ1LmRlbm9tID0gbzIuZGVub20pLCB2b2lkIDAgIT09IG8yLmFtb3VudCAmJiAodDUuYW1vdW50ID0gbzIuYW1vdW50KSwgdDU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCB0NSA9IHsgZGVub206IFwiXCIsIGFtb3VudDogXCJcIiB9O1xuICByZXR1cm4gdDUuZGVub20gPSBvMi5kZW5vbSA/PyBcIlwiLCB0NS5hbW91bnQgPSBvMi5hbW91bnQgPz8gXCJcIiwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gQ29pbi5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IENvaW4uZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFzZS52MWJldGExLkNvaW5cIiwgdmFsdWU6IENvaW4uZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIERlY0NvaW4gPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnYxYmV0YTEuRGVjQ29pblwiLCBlbmNvZGU6IChvMiwgbjIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBvMi5kZW5vbSAmJiBuMi51aW50MzIoMTApLnN0cmluZyhvMi5kZW5vbSksIFwiXCIgIT09IG8yLmFtb3VudCAmJiBuMi51aW50MzIoMTgpLnN0cmluZyhEZWNpbWFsLmZyb21Vc2VySW5wdXQobzIuYW1vdW50LCAxOCkuYXRvbWljcyksIG4yKSwgZGVjb2RlKHQ1LCBuMikge1xuICBjb25zdCByNiA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IHMyID0gdm9pZCAwID09PSBuMiA/IHI2LmxlbiA6IHI2LnBvcyArIG4yO1xuICBjb25zdCBpMiA9IHsgZGVub206IFwiXCIsIGFtb3VudDogXCJcIiB9O1xuICBmb3IgKDsgcjYucG9zIDwgczI7ICkge1xuICAgIGNvbnN0IG8yID0gcjYudWludDMyKCk7XG4gICAgc3dpdGNoIChvMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5kZW5vbSA9IHI2LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIuYW1vdW50ID0gRGVjaW1hbC5mcm9tQXRvbWljcyhyNi5zdHJpbmcoKSwgMTgpLnRvU3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcjYuc2tpcFR5cGUoNyAmIG8yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVub206IGlzU2V0KG8yLmRlbm9tKSA/IFN0cmluZyhvMi5kZW5vbSkgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KG8yLmFtb3VudCkgPyBTdHJpbmcobzIuYW1vdW50KSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5kZW5vbSAmJiAodDUuZGVub20gPSBvMi5kZW5vbSksIHZvaWQgMCAhPT0gbzIuYW1vdW50ICYmICh0NS5hbW91bnQgPSBvMi5hbW91bnQpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyBkZW5vbTogXCJcIiwgYW1vdW50OiBcIlwiIH07XG4gIHJldHVybiB0NS5kZW5vbSA9IG8yLmRlbm9tID8/IFwiXCIsIHQ1LmFtb3VudCA9IG8yLmFtb3VudCA/PyBcIlwiLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBEZWNDb2luLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gRGVjQ29pbi5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnYxYmV0YTEuRGVjQ29pblwiLCB2YWx1ZTogRGVjQ29pbi5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgUXVlcnlCYWxhbmNlUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUJhbGFuY2VSZXF1ZXN0XCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmFkZHJlc3MgJiYgbzIudWludDMyKDEwKS5zdHJpbmcoZTIuYWRkcmVzcyksIFwiXCIgIT09IGUyLmRlbm9tICYmIG8yLnVpbnQzMigxOCkuc3RyaW5nKGUyLmRlbm9tKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IG4yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgYTIgPSB2b2lkIDAgPT09IG8yID8gbjIubGVuIDogbjIucG9zICsgbzI7XG4gIGNvbnN0IHQ1ID0geyBhZGRyZXNzOiBcIlwiLCBkZW5vbTogXCJcIiB9O1xuICBmb3IgKDsgbjIucG9zIDwgYTI7ICkge1xuICAgIGNvbnN0IGUzID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICB0NS5hZGRyZXNzID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICB0NS5kZW5vbSA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0NTtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGFkZHJlc3M6IGlzU2V0KGUyLmFkZHJlc3MpID8gU3RyaW5nKGUyLmFkZHJlc3MpIDogXCJcIiwgZGVub206IGlzU2V0KGUyLmRlbm9tKSA/IFN0cmluZyhlMi5kZW5vbSkgOiBcIlwiIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuYWRkcmVzcyAmJiAobzIuYWRkcmVzcyA9IGUyLmFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmRlbm9tICYmIChvMi5kZW5vbSA9IGUyLmRlbm9tKSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHsgYWRkcmVzczogXCJcIiwgZGVub206IFwiXCIgfTtcbiAgcmV0dXJuIG8yLmFkZHJlc3MgPSBlMi5hZGRyZXNzID8/IFwiXCIsIG8yLmRlbm9tID0gZTIuZGVub20gPz8gXCJcIiwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUXVlcnlCYWxhbmNlUmVxdWVzdC5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFF1ZXJ5QmFsYW5jZVJlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLlF1ZXJ5QmFsYW5jZVJlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5QmFsYW5jZVJlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5QmFsYW5jZVJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLlF1ZXJ5QmFsYW5jZVJlc3BvbnNlXCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKHZvaWQgMCAhPT0gZTIuYmFsYW5jZSAmJiBDb2luLmVuY29kZShlMi5iYWxhbmNlLCBvMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCBhMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IHQ1ID0gdm9pZCAwID09PSBvMiA/IGEyLmxlbiA6IGEyLnBvcyArIG8yO1xuICBjb25zdCBzMiA9IHsgYmFsYW5jZTogdm9pZCAwIH07XG4gIGZvciAoOyBhMi5wb3MgPCB0NTsgKSB7XG4gICAgY29uc3QgZTMgPSBhMi51aW50MzIoKTtcbiAgICBpZiAoZTMgPj4+IDMgPT0gMSkgczIuYmFsYW5jZSA9IENvaW4uZGVjb2RlKGEyLCBhMi51aW50MzIoKSk7XG4gICAgZWxzZSBhMi5za2lwVHlwZSg3ICYgZTMpO1xuICB9XG4gIHJldHVybiBzMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGJhbGFuY2U6IGlzU2V0KGUyLmJhbGFuY2UpID8gQ29pbi5mcm9tSlNPTihlMi5iYWxhbmNlKSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmJhbGFuY2UgJiYgKG8yLmJhbGFuY2UgPSBlMi5iYWxhbmNlID8gQ29pbi50b0pTT04oZTIuYmFsYW5jZSkgOiB2b2lkIDApLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0geyBiYWxhbmNlOiB2b2lkIDAgfTtcbiAgcmV0dXJuIG8yLmJhbGFuY2UgPSB2b2lkIDAgIT09IGUyLmJhbGFuY2UgJiYgbnVsbCAhPT0gZTIuYmFsYW5jZSA/IENvaW4uZnJvbVBhcnRpYWwoZTIuYmFsYW5jZSkgOiB2b2lkIDAsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFF1ZXJ5QmFsYW5jZVJlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUXVlcnlCYWxhbmNlUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLlF1ZXJ5QmFsYW5jZVJlc3BvbnNlXCIsIHZhbHVlOiBRdWVyeUJhbGFuY2VSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3RcIiwgZW5jb2RlOiAobzIsIG4yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gbzIuYWRkcmVzcyAmJiBuMi51aW50MzIoMTApLnN0cmluZyhvMi5hZGRyZXNzKSwgdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXF1ZXN0LmVuY29kZShvMi5wYWdpbmF0aW9uLCBuMi51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIHRydWUgPT09IG8yLnJlc29sdmVEZW5vbSAmJiBuMi51aW50MzIoMjQpLmJvb2wobzIucmVzb2x2ZURlbm9tKSwgbjIpLCBkZWNvZGUobzIsIG4yKSB7XG4gIGNvbnN0IGEyID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgdDUgPSB2b2lkIDAgPT09IG4yID8gYTIubGVuIDogYTIucG9zICsgbjI7XG4gIGNvbnN0IHMyID0geyBhZGRyZXNzOiBcIlwiLCBwYWdpbmF0aW9uOiB2b2lkIDAsIHJlc29sdmVEZW5vbTogZmFsc2UgfTtcbiAgZm9yICg7IGEyLnBvcyA8IHQ1OyApIHtcbiAgICBjb25zdCBvMyA9IGEyLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczIuYWRkcmVzcyA9IGEyLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgczIucGFnaW5hdGlvbiA9IFBhZ2VSZXF1ZXN0LmRlY29kZShhMiwgYTIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgczIucmVzb2x2ZURlbm9tID0gYTIuYm9vbCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGEyLnNraXBUeXBlKDcgJiBvMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBzMjtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IGFkZHJlc3M6IGlzU2V0KG8yLmFkZHJlc3MpID8gU3RyaW5nKG8yLmFkZHJlc3MpIDogXCJcIiwgcGFnaW5hdGlvbjogaXNTZXQobzIucGFnaW5hdGlvbikgPyBQYWdlUmVxdWVzdC5mcm9tSlNPTihvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgcmVzb2x2ZURlbm9tOiAhIWlzU2V0KG8yLnJlc29sdmVEZW5vbSkgJiYgQm9vbGVhbihvMi5yZXNvbHZlRGVub20pIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgbjIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuYWRkcmVzcyAmJiAobjIuYWRkcmVzcyA9IG8yLmFkZHJlc3MpLCB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgKG4yLnBhZ2luYXRpb24gPSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlcXVlc3QudG9KU09OKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgdm9pZCAwICE9PSBvMi5yZXNvbHZlRGVub20gJiYgKG4yLnJlc29sdmVEZW5vbSA9IG8yLnJlc29sdmVEZW5vbSksIG4yO1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgbjIgPSB7IGFkZHJlc3M6IFwiXCIsIHBhZ2luYXRpb246IHZvaWQgMCwgcmVzb2x2ZURlbm9tOiBmYWxzZSB9O1xuICByZXR1cm4gbjIuYWRkcmVzcyA9IG8yLmFkZHJlc3MgPz8gXCJcIiwgbjIucGFnaW5hdGlvbiA9IHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBudWxsICE9PSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlcXVlc3QuZnJvbVBhcnRpYWwobzIucGFnaW5hdGlvbikgOiB2b2lkIDAsIG4yLnJlc29sdmVEZW5vbSA9IG8yLnJlc29sdmVEZW5vbSA/PyBmYWxzZSwgbjI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3QuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeUFsbEJhbGFuY2VzUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5QWxsQmFsYW5jZXNSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeUFsbEJhbGFuY2VzUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlXCIsIGVuY29kZShlMiwgYTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBvMiBvZiBlMi5iYWxhbmNlcykgQ29pbi5lbmNvZGUobzIsIGEyLnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiBQYWdlUmVzcG9uc2UuZW5jb2RlKGUyLnBhZ2luYXRpb24sIGEyLnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgYTI7XG59LCBkZWNvZGUoZTIsIGEyKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgczIgPSB2b2lkIDAgPT09IGEyID8gdDUubGVuIDogdDUucG9zICsgYTI7XG4gIGNvbnN0IGkyID0geyBiYWxhbmNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgdDUucG9zIDwgczI7ICkge1xuICAgIGNvbnN0IGUzID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5iYWxhbmNlcy5wdXNoKENvaW4uZGVjb2RlKHQ1LCB0NS51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIucGFnaW5hdGlvbiA9IFBhZ2VSZXNwb25zZS5kZWNvZGUodDUsIHQ1LnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0NS5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBiYWxhbmNlczogQXJyYXkuaXNBcnJheShlMj8uYmFsYW5jZXMpID8gZTIuYmFsYW5jZXMubWFwKCgoZTMpID0+IENvaW4uZnJvbUpTT04oZTMpKSkgOiBbXSwgcGFnaW5hdGlvbjogaXNTZXQoZTIucGFnaW5hdGlvbikgPyBQYWdlUmVzcG9uc2UuZnJvbUpTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBhMiA9IHt9O1xuICByZXR1cm4gZTIuYmFsYW5jZXMgPyBhMi5iYWxhbmNlcyA9IGUyLmJhbGFuY2VzLm1hcCgoKGUzKSA9PiBlMyA/IENvaW4udG9KU09OKGUzKSA6IHZvaWQgMCkpIDogYTIuYmFsYW5jZXMgPSBbXSwgdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIChhMi5wYWdpbmF0aW9uID0gZTIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS50b0pTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDApLCBhMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IGEyID0geyBiYWxhbmNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICByZXR1cm4gYTIuYmFsYW5jZXMgPSBlMi5iYWxhbmNlcz8ubWFwKCgoZTMpID0+IENvaW4uZnJvbVBhcnRpYWwoZTMpKSkgfHwgW10sIGEyLnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gZTIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS5mcm9tUGFydGlhbChlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgYTI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUFsbEJhbGFuY2VzUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5QWxsQmFsYW5jZXNSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgTXNnU2VuZCA9IHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5Nc2dTZW5kXCIsIGVuY29kZShvMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgXCJcIiAhPT0gbzIuZnJvbUFkZHJlc3MgJiYgdDUudWludDMyKDEwKS5zdHJpbmcobzIuZnJvbUFkZHJlc3MpLCBcIlwiICE9PSBvMi50b0FkZHJlc3MgJiYgdDUudWludDMyKDE4KS5zdHJpbmcobzIudG9BZGRyZXNzKTtcbiAgZm9yIChjb25zdCBzMiBvZiBvMi5hbW91bnQpIENvaW4uZW5jb2RlKHMyLCB0NS51aW50MzIoMjYpLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiB0NTtcbn0sIGRlY29kZShvMiwgdDUpIHtcbiAgY29uc3QgczIgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gdDUgPyBzMi5sZW4gOiBzMi5wb3MgKyB0NTtcbiAgY29uc3QgYTIgPSB7IGZyb21BZGRyZXNzOiBcIlwiLCB0b0FkZHJlc3M6IFwiXCIsIGFtb3VudDogW10gfTtcbiAgZm9yICg7IHMyLnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBvMyA9IHMyLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgYTIuZnJvbUFkZHJlc3MgPSBzMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGEyLnRvQWRkcmVzcyA9IHMyLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgYTIuYW1vdW50LnB1c2goQ29pbi5kZWNvZGUoczIsIHMyLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgczIuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGEyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZnJvbUFkZHJlc3M6IGlzU2V0KG8yLmZyb21BZGRyZXNzKSA/IFN0cmluZyhvMi5mcm9tQWRkcmVzcykgOiBcIlwiLCB0b0FkZHJlc3M6IGlzU2V0KG8yLnRvQWRkcmVzcykgPyBTdHJpbmcobzIudG9BZGRyZXNzKSA6IFwiXCIsIGFtb3VudDogQXJyYXkuaXNBcnJheShvMj8uYW1vdW50KSA/IG8yLmFtb3VudC5tYXAoKChvMykgPT4gQ29pbi5mcm9tSlNPTihvMykpKSA6IFtdIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuZnJvbUFkZHJlc3MgJiYgKHQ1LmZyb21BZGRyZXNzID0gbzIuZnJvbUFkZHJlc3MpLCB2b2lkIDAgIT09IG8yLnRvQWRkcmVzcyAmJiAodDUudG9BZGRyZXNzID0gbzIudG9BZGRyZXNzKSwgbzIuYW1vdW50ID8gdDUuYW1vdW50ID0gbzIuYW1vdW50Lm1hcCgoKG8zKSA9PiBvMyA/IENvaW4udG9KU09OKG8zKSA6IHZvaWQgMCkpIDogdDUuYW1vdW50ID0gW10sIHQ1O1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgdDUgPSB7IGZyb21BZGRyZXNzOiBcIlwiLCB0b0FkZHJlc3M6IFwiXCIsIGFtb3VudDogW10gfTtcbiAgcmV0dXJuIHQ1LmZyb21BZGRyZXNzID0gbzIuZnJvbUFkZHJlc3MgPz8gXCJcIiwgdDUudG9BZGRyZXNzID0gbzIudG9BZGRyZXNzID8/IFwiXCIsIHQ1LmFtb3VudCA9IG8yLmFtb3VudD8ubWFwKCgobzMpID0+IENvaW4uZnJvbVBhcnRpYWwobzMpKSkgfHwgW10sIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IE1zZ1NlbmQuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBNc2dTZW5kLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5Nc2dTZW5kXCIsIHZhbHVlOiBNc2dTZW5kLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuRGVsZWdhdGlvbkRlbGVnYXRvclJld2FyZFwiLCBlbmNvZGUodDUsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIFwiXCIgIT09IHQ1LnZhbGlkYXRvckFkZHJlc3MgJiYgZTIudWludDMyKDEwKS5zdHJpbmcodDUudmFsaWRhdG9yQWRkcmVzcyk7XG4gIGZvciAoY29uc3QgcjYgb2YgdDUucmV3YXJkKSBEZWNDb2luLmVuY29kZShyNiwgZTIudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gZTI7XG59LCBkZWNvZGUodDUsIHI2KSB7XG4gIGNvbnN0IGkyID0gdDUgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyB0NSA6IG5ldyBCaW5hcnlSZWFkZXIodDUpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IHI2ID8gaTIubGVuIDogaTIucG9zICsgcjY7XG4gIGNvbnN0IGEyID0geyB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiLCByZXdhcmQ6IFtdIH07XG4gIGZvciAoOyBpMi5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgdDYgPSBpMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKHQ2ID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGEyLnZhbGlkYXRvckFkZHJlc3MgPSBpMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGEyLnJld2FyZC5wdXNoKERlY0NvaW4uZGVjb2RlKGkyLCBpMi51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGkyLnNraXBUeXBlKDcgJiB0Nik7XG4gICAgfVxuICB9XG4gIHJldHVybiBhMjtcbn0sIGZyb21KU09OOiAodDUpID0+ICh7IHZhbGlkYXRvckFkZHJlc3M6IGlzU2V0KHQ1LnZhbGlkYXRvckFkZHJlc3MpID8gU3RyaW5nKHQ1LnZhbGlkYXRvckFkZHJlc3MpIDogXCJcIiwgcmV3YXJkOiBBcnJheS5pc0FycmF5KHQ1Py5yZXdhcmQpID8gdDUucmV3YXJkLm1hcCgoKHQ2KSA9PiBEZWNDb2luLmZyb21KU09OKHQ2KSkpIDogW10gfSksIHRvSlNPTih0NSkge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSB0NS52YWxpZGF0b3JBZGRyZXNzICYmIChlMi52YWxpZGF0b3JBZGRyZXNzID0gdDUudmFsaWRhdG9yQWRkcmVzcyksIHQ1LnJld2FyZCA/IGUyLnJld2FyZCA9IHQ1LnJld2FyZC5tYXAoKCh0NikgPT4gdDYgPyBEZWNDb2luLnRvSlNPTih0NikgOiB2b2lkIDApKSA6IGUyLnJld2FyZCA9IFtdLCBlMjtcbn0sIGZyb21QYXJ0aWFsKHQ1KSB7XG4gIGNvbnN0IGUyID0geyB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiLCByZXdhcmQ6IFtdIH07XG4gIHJldHVybiBlMi52YWxpZGF0b3JBZGRyZXNzID0gdDUudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCBlMi5yZXdhcmQgPSB0NS5yZXdhcmQ/Lm1hcCgoKHQ2KSA9PiBEZWNDb2luLmZyb21QYXJ0aWFsKHQ2KSkpIHx8IFtdLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gRGVsZWdhdGlvbkRlbGVnYXRvclJld2FyZC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5EZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkXCIsIHZhbHVlOiBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXF1ZXN0XCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgbzIudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcyksIFwiXCIgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgbzIudWludDMyKDE4KS5zdHJpbmcoZTIudmFsaWRhdG9yQWRkcmVzcyksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCBzMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IHI2ID0gdm9pZCAwID09PSBvMiA/IHMyLmxlbiA6IHMyLnBvcyArIG8yO1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiB9O1xuICBmb3IgKDsgczIucG9zIDwgcjY7ICkge1xuICAgIGNvbnN0IGUzID0gczIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICB0NS5kZWxlZ2F0b3JBZGRyZXNzID0gczIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICB0NS52YWxpZGF0b3JBZGRyZXNzID0gczIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgczIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHQ1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSA6IFwiXCIgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIChvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiAobzIudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MpLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiIH07XG4gIHJldHVybiBvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVxdWVzdC5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXF1ZXN0XCIsIHZhbHVlOiBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1Jlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1Jlc3BvbnNlXCIsIGVuY29kZShlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBzMiBvZiBlMi5yZXdhcmRzKSBEZWNDb2luLmVuY29kZShzMiwgbzIudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gbzI7XG59LCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHMyID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgcjYgPSB2b2lkIDAgPT09IG8yID8gczIubGVuIDogczIucG9zICsgbzI7XG4gIGNvbnN0IHQ1ID0geyByZXdhcmRzOiBbXSB9O1xuICBmb3IgKDsgczIucG9zIDwgcjY7ICkge1xuICAgIGNvbnN0IGUzID0gczIudWludDMyKCk7XG4gICAgaWYgKGUzID4+PiAzID09IDEpIHQ1LnJld2FyZHMucHVzaChEZWNDb2luLmRlY29kZShzMiwgczIudWludDMyKCkpKTtcbiAgICBlbHNlIHMyLnNraXBUeXBlKDcgJiBlMyk7XG4gIH1cbiAgcmV0dXJuIHQ1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgcmV3YXJkczogQXJyYXkuaXNBcnJheShlMj8ucmV3YXJkcykgPyBlMi5yZXdhcmRzLm1hcCgoKGUzKSA9PiBEZWNDb2luLmZyb21KU09OKGUzKSkpIDogW10gfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gZTIucmV3YXJkcyA/IG8yLnJld2FyZHMgPSBlMi5yZXdhcmRzLm1hcCgoKGUzKSA9PiBlMyA/IERlY0NvaW4udG9KU09OKGUzKSA6IHZvaWQgMCkpIDogbzIucmV3YXJkcyA9IFtdLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0geyByZXdhcmRzOiBbXSB9O1xuICByZXR1cm4gbzIucmV3YXJkcyA9IGUyLnJld2FyZHM/Lm1hcCgoKGUzKSA9PiBEZWNDb2luLmZyb21QYXJ0aWFsKGUzKSkpIHx8IFtdLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2UuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1Jlc3BvbnNlXCIsIHZhbHVlOiBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1JlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5RdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXF1ZXN0XCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgbzIudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcyksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCBzMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IHI2ID0gdm9pZCAwID09PSBvMiA/IHMyLmxlbiA6IHMyLnBvcyArIG8yO1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiB9O1xuICBmb3IgKDsgczIucG9zIDwgcjY7ICkge1xuICAgIGNvbnN0IGUzID0gczIudWludDMyKCk7XG4gICAgaWYgKGUzID4+PiAzID09IDEpIHQ1LmRlbGVnYXRvckFkZHJlc3MgPSBzMi5zdHJpbmcoKTtcbiAgICBlbHNlIHMyLnNraXBUeXBlKDcgJiBlMyk7XG4gIH1cbiAgcmV0dXJuIHQ1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiAobzIuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MpLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiIH07XG4gIHJldHVybiBvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXF1ZXN0LmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5RdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXF1ZXN0XCIsIHZhbHVlOiBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1Jlc3BvbnNlXCIsIGVuY29kZShlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBzMiBvZiBlMi5yZXdhcmRzKSBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLmVuY29kZShzMiwgbzIudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICBmb3IgKGNvbnN0IHMyIG9mIGUyLnRvdGFsKSBEZWNDb2luLmVuY29kZShzMiwgbzIudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gbzI7XG59LCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHMyID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgcjYgPSB2b2lkIDAgPT09IG8yID8gczIubGVuIDogczIucG9zICsgbzI7XG4gIGNvbnN0IHQ1ID0geyByZXdhcmRzOiBbXSwgdG90YWw6IFtdIH07XG4gIGZvciAoOyBzMi5wb3MgPCByNjsgKSB7XG4gICAgY29uc3QgZTMgPSBzMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHQ1LnJld2FyZHMucHVzaChEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLmRlY29kZShzMiwgczIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHQ1LnRvdGFsLnB1c2goRGVjQ29pbi5kZWNvZGUoczIsIHMyLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgczIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHQ1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgcmV3YXJkczogQXJyYXkuaXNBcnJheShlMj8ucmV3YXJkcykgPyBlMi5yZXdhcmRzLm1hcCgoKGUzKSA9PiBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLmZyb21KU09OKGUzKSkpIDogW10sIHRvdGFsOiBBcnJheS5pc0FycmF5KGUyPy50b3RhbCkgPyBlMi50b3RhbC5tYXAoKChlMykgPT4gRGVjQ29pbi5mcm9tSlNPTihlMykpKSA6IFtdIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIGUyLnJld2FyZHMgPyBvMi5yZXdhcmRzID0gZTIucmV3YXJkcy5tYXAoKChlMykgPT4gZTMgPyBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLnRvSlNPTihlMykgOiB2b2lkIDApKSA6IG8yLnJld2FyZHMgPSBbXSwgZTIudG90YWwgPyBvMi50b3RhbCA9IGUyLnRvdGFsLm1hcCgoKGUzKSA9PiBlMyA/IERlY0NvaW4udG9KU09OKGUzKSA6IHZvaWQgMCkpIDogbzIudG90YWwgPSBbXSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHsgcmV3YXJkczogW10sIHRvdGFsOiBbXSB9O1xuICByZXR1cm4gbzIucmV3YXJkcyA9IGUyLnJld2FyZHM/Lm1hcCgoKGUzKSA9PiBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLmZyb21QYXJ0aWFsKGUzKSkpIHx8IFtdLCBvMi50b3RhbCA9IGUyLnRvdGFsPy5tYXAoKChlMykgPT4gRGVjQ29pbi5mcm9tUGFydGlhbChlMykpKSB8fCBbXSwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVzcG9uc2UuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5RdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmRcIiwgZW5jb2RlOiAobzIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gbzIuZGVsZWdhdG9yQWRkcmVzcyAmJiB0NS51aW50MzIoMTApLnN0cmluZyhvMi5kZWxlZ2F0b3JBZGRyZXNzKSwgXCJcIiAhPT0gbzIudmFsaWRhdG9yQWRkcmVzcyAmJiB0NS51aW50MzIoMTgpLnN0cmluZyhvMi52YWxpZGF0b3JBZGRyZXNzKSwgdDUpLCBkZWNvZGUobzIsIHQ1KSB7XG4gIGNvbnN0IHMyID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgcjYgPSB2b2lkIDAgPT09IHQ1ID8gczIubGVuIDogczIucG9zICsgdDU7XG4gIGNvbnN0IGQgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIgfTtcbiAgZm9yICg7IHMyLnBvcyA8IHI2OyApIHtcbiAgICBjb25zdCBvMyA9IHMyLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgZC5kZWxlZ2F0b3JBZGRyZXNzID0gczIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBkLnZhbGlkYXRvckFkZHJlc3MgPSBzMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBzMi5za2lwVHlwZSg3ICYgbzMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZDtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IGRlbGVnYXRvckFkZHJlc3M6IGlzU2V0KG8yLmRlbGVnYXRvckFkZHJlc3MpID8gU3RyaW5nKG8yLmRlbGVnYXRvckFkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogaXNTZXQobzIudmFsaWRhdG9yQWRkcmVzcykgPyBTdHJpbmcobzIudmFsaWRhdG9yQWRkcmVzcykgOiBcIlwiIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuZGVsZWdhdG9yQWRkcmVzcyAmJiAodDUuZGVsZWdhdG9yQWRkcmVzcyA9IG8yLmRlbGVnYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IG8yLnZhbGlkYXRvckFkZHJlc3MgJiYgKHQ1LnZhbGlkYXRvckFkZHJlc3MgPSBvMi52YWxpZGF0b3JBZGRyZXNzKSwgdDU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiB9O1xuICByZXR1cm4gdDUuZGVsZWdhdG9yQWRkcmVzcyA9IG8yLmRlbGVnYXRvckFkZHJlc3MgPz8gXCJcIiwgdDUudmFsaWRhdG9yQWRkcmVzcyA9IG8yLnZhbGlkYXRvckFkZHJlc3MgPz8gXCJcIiwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmQuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5Nc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFwiLCB2YWx1ZTogTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmQuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5Nc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFJlc3BvbnNlXCIsIGVuY29kZSh0NSwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBzMiBvZiB0NS5hbW91bnQpIENvaW4uZW5jb2RlKHMyLCBlMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiBlMjtcbn0sIGRlY29kZSh0NSwgczIpIHtcbiAgY29uc3QgcjYgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCBkID0gdm9pZCAwID09PSBzMiA/IHI2LmxlbiA6IHI2LnBvcyArIHMyO1xuICBjb25zdCBhMiA9IHsgYW1vdW50OiBbXSB9O1xuICBmb3IgKDsgcjYucG9zIDwgZDsgKSB7XG4gICAgY29uc3QgdDYgPSByNi51aW50MzIoKTtcbiAgICBpZiAodDYgPj4+IDMgPT0gMSkgYTIuYW1vdW50LnB1c2goQ29pbi5kZWNvZGUocjYsIHI2LnVpbnQzMigpKSk7XG4gICAgZWxzZSByNi5za2lwVHlwZSg3ICYgdDYpO1xuICB9XG4gIHJldHVybiBhMjtcbn0sIGZyb21KU09OOiAodDUpID0+ICh7IGFtb3VudDogQXJyYXkuaXNBcnJheSh0NT8uYW1vdW50KSA/IHQ1LmFtb3VudC5tYXAoKCh0NikgPT4gQ29pbi5mcm9tSlNPTih0NikpKSA6IFtdIH0pLCB0b0pTT04odDUpIHtcbiAgY29uc3QgZTIgPSB7fTtcbiAgcmV0dXJuIHQ1LmFtb3VudCA/IGUyLmFtb3VudCA9IHQ1LmFtb3VudC5tYXAoKCh0NikgPT4gdDYgPyBDb2luLnRvSlNPTih0NikgOiB2b2lkIDApKSA6IGUyLmFtb3VudCA9IFtdLCBlMjtcbn0sIGZyb21QYXJ0aWFsKHQ1KSB7XG4gIGNvbnN0IGUyID0geyBhbW91bnQ6IFtdIH07XG4gIHJldHVybiBlMi5hbW91bnQgPSB0NS5hbW91bnQ/Lm1hcCgoKHQ2KSA9PiBDb2luLmZyb21QYXJ0aWFsKHQ2KSkpIHx8IFtdLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFJlc3BvbnNlLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmRSZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5Nc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFJlc3BvbnNlXCIsIHZhbHVlOiBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFJlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciBTaWduZWRNc2dUeXBlO1xuIShmdW5jdGlvbihlMikge1xuICBlMltlMi5TSUdORURfTVNHX1RZUEVfVU5LTk9XTiA9IDBdID0gXCJTSUdORURfTVNHX1RZUEVfVU5LTk9XTlwiLCBlMltlMi5TSUdORURfTVNHX1RZUEVfUFJFVk9URSA9IDFdID0gXCJTSUdORURfTVNHX1RZUEVfUFJFVk9URVwiLCBlMltlMi5TSUdORURfTVNHX1RZUEVfUFJFQ09NTUlUID0gMl0gPSBcIlNJR05FRF9NU0dfVFlQRV9QUkVDT01NSVRcIiwgZTJbZTIuU0lHTkVEX01TR19UWVBFX1BST1BPU0FMID0gMzJdID0gXCJTSUdORURfTVNHX1RZUEVfUFJPUE9TQUxcIiwgZTJbZTIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0pKFNpZ25lZE1zZ1R5cGUgfHwgKFNpZ25lZE1zZ1R5cGUgPSB7fSkpO1xuXG4vL1xuZnVuY3Rpb24gbCgpIHtcbiAgcmV0dXJuIHsgJHR5cGVVcmw6IFwiL2dvb2dsZS5wcm90b2J1Zi5BbnlcIiwgdHlwZVVybDogXCJcIiwgdmFsdWU6IG5ldyBVaW50OEFycmF5KCkgfTtcbn1cbnZhciBBbnkgPSB7IHR5cGVVcmw6IFwiL2dvb2dsZS5wcm90b2J1Zi5BbnlcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIudHlwZVVybCAmJiBvMi51aW50MzIoMTApLnN0cmluZyhlMi50eXBlVXJsKSwgMCAhPT0gZTIudmFsdWUubGVuZ3RoICYmIG8yLnVpbnQzMigxOCkuYnl0ZXMoZTIudmFsdWUpLCBvMiksIGRlY29kZShyNiwgbzIpIHtcbiAgY29uc3QgdDUgPSByNiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHI2IDogbmV3IEJpbmFyeVJlYWRlcihyNik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gbzIgPyB0NS5sZW4gOiB0NS5wb3MgKyBvMjtcbiAgY29uc3QgYTIgPSBsKCk7XG4gIGZvciAoOyB0NS5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgZTIgPSB0NS51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUyID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGEyLnR5cGVVcmwgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGEyLnZhbHVlID0gdDUuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0NS5za2lwVHlwZSg3ICYgZTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyB0eXBlVXJsOiBpc1NldChlMi50eXBlVXJsKSA/IFN0cmluZyhlMi50eXBlVXJsKSA6IFwiXCIsIHZhbHVlOiBpc1NldChlMi52YWx1ZSkgPyBkZWNvZGVCYXNlNjQoZTIudmFsdWUpIDogbmV3IFVpbnQ4QXJyYXkoKSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHI2ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLnR5cGVVcmwgJiYgKHI2LnR5cGVVcmwgPSBlMi50eXBlVXJsKSwgdm9pZCAwICE9PSBlMi52YWx1ZSAmJiAocjYudmFsdWUgPSBlbmNvZGVCYXNlNjQodm9pZCAwICE9PSBlMi52YWx1ZSA/IGUyLnZhbHVlIDogbmV3IFVpbnQ4QXJyYXkoKSkpLCByNjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHI2ID0gbCgpO1xuICByZXR1cm4gcjYudHlwZVVybCA9IGUyLnR5cGVVcmwgPz8gXCJcIiwgcjYudmFsdWUgPSBlMi52YWx1ZSA/PyBuZXcgVWludDhBcnJheSgpLCByNjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBBbnkuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBBbnkuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9nb29nbGUucHJvdG9idWYuQW55XCIsIHZhbHVlOiBBbnkuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIEJvbmRTdGF0dXM7XG4hKGZ1bmN0aW9uKGUyKSB7XG4gIGUyW2UyLkJPTkRfU1RBVFVTX1VOU1BFQ0lGSUVEID0gMF0gPSBcIkJPTkRfU1RBVFVTX1VOU1BFQ0lGSUVEXCIsIGUyW2UyLkJPTkRfU1RBVFVTX1VOQk9OREVEID0gMV0gPSBcIkJPTkRfU1RBVFVTX1VOQk9OREVEXCIsIGUyW2UyLkJPTkRfU1RBVFVTX1VOQk9ORElORyA9IDJdID0gXCJCT05EX1NUQVRVU19VTkJPTkRJTkdcIiwgZTJbZTIuQk9ORF9TVEFUVVNfQk9OREVEID0gM10gPSBcIkJPTkRfU1RBVFVTX0JPTkRFRFwiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufSkoQm9uZFN0YXR1cyB8fCAoQm9uZFN0YXR1cyA9IHt9KSk7XG52YXIgSW5mcmFjdGlvbjtcbiEoZnVuY3Rpb24oZTIpIHtcbiAgZTJbZTIuSU5GUkFDVElPTl9VTlNQRUNJRklFRCA9IDBdID0gXCJJTkZSQUNUSU9OX1VOU1BFQ0lGSUVEXCIsIGUyW2UyLklORlJBQ1RJT05fRE9VQkxFX1NJR04gPSAxXSA9IFwiSU5GUkFDVElPTl9ET1VCTEVfU0lHTlwiLCBlMltlMi5JTkZSQUNUSU9OX0RPV05USU1FID0gMl0gPSBcIklORlJBQ1RJT05fRE9XTlRJTUVcIiwgZTJbZTIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0pKEluZnJhY3Rpb24gfHwgKEluZnJhY3Rpb24gPSB7fSkpO1xudmFyIERlbGVnYXRpb24gPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuRGVsZWdhdGlvblwiLCBlbmNvZGU6IChlMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi5zaGFyZXMgJiYgdDUudWludDMyKDI2KS5zdHJpbmcoRGVjaW1hbC5mcm9tVXNlcklucHV0KGUyLnNoYXJlcywgMTgpLmF0b21pY3MpLCB0NSksIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbzIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gdDUgPyBvMi5sZW4gOiBvMi5wb3MgKyB0NTtcbiAgY29uc3QgaTIgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIHNoYXJlczogXCJcIiB9O1xuICBmb3IgKDsgbzIucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5kZWxlZ2F0b3JBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMi52YWxpZGF0b3JBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBpMi5zaGFyZXMgPSBEZWNpbWFsLmZyb21BdG9taWNzKG8yLnN0cmluZygpLCAxOCkudG9TdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyZXNzOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IGlzU2V0KGUyLnZhbGlkYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpIDogXCJcIiwgc2hhcmVzOiBpc1NldChlMi5zaGFyZXMpID8gU3RyaW5nKGUyLnNoYXJlcykgOiBcIlwiIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiAodDUuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgKHQ1LnZhbGlkYXRvckFkZHJlc3MgPSBlMi52YWxpZGF0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5zaGFyZXMgJiYgKHQ1LnNoYXJlcyA9IGUyLnNoYXJlcyksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIHNoYXJlczogXCJcIiB9O1xuICByZXR1cm4gdDUuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MgPz8gXCJcIiwgdDUudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MgPz8gXCJcIiwgdDUuc2hhcmVzID0gZTIuc2hhcmVzID8/IFwiXCIsIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IERlbGVnYXRpb24uZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBEZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5EZWxlZ2F0aW9uXCIsIHZhbHVlOiBEZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbnZhciBVbmJvbmRpbmdEZWxlZ2F0aW9uID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlVuYm9uZGluZ0RlbGVnYXRpb25cIiwgZW5jb2RlKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpO1xuICBmb3IgKGNvbnN0IG8yIG9mIGUyLmVudHJpZXMpIFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5lbmNvZGUobzIsIHQ1LnVpbnQzMigyNikuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHQ1O1xufSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBvMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSB0NSA/IG8yLmxlbiA6IG8yLnBvcyArIHQ1O1xuICBjb25zdCBpMiA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiwgZW50cmllczogW10gfTtcbiAgZm9yICg7IG8yLnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBlMyA9IG8yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaTIuZGVsZWdhdG9yQWRkcmVzcyA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIudmFsaWRhdG9yQWRkcmVzcyA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgaTIuZW50cmllcy5wdXNoKFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5kZWNvZGUobzIsIG8yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbzIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSA6IFwiXCIsIGVudHJpZXM6IEFycmF5LmlzQXJyYXkoZTI/LmVudHJpZXMpID8gZTIuZW50cmllcy5tYXAoKChlMykgPT4gVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LmZyb21KU09OKGUzKSkpIDogW10gfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmICh0NS5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiAodDUudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MpLCBlMi5lbnRyaWVzID8gdDUuZW50cmllcyA9IGUyLmVudHJpZXMubWFwKCgoZTMpID0+IGUzID8gVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LnRvSlNPTihlMykgOiB2b2lkIDApKSA6IHQ1LmVudHJpZXMgPSBbXSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiwgZW50cmllczogW10gfTtcbiAgcmV0dXJuIHQ1LmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzID8/IFwiXCIsIHQ1LnZhbGlkYXRvckFkZHJlc3MgPSBlMi52YWxpZGF0b3JBZGRyZXNzID8/IFwiXCIsIHQ1LmVudHJpZXMgPSBlMi5lbnRyaWVzPy5tYXAoKChlMykgPT4gVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LmZyb21QYXJ0aWFsKGUzKSkpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBVbmJvbmRpbmdEZWxlZ2F0aW9uLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gVW5ib25kaW5nRGVsZWdhdGlvbi5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuVW5ib25kaW5nRGVsZWdhdGlvblwiLCB2YWx1ZTogVW5ib25kaW5nRGVsZWdhdGlvbi5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBmKCkge1xuICByZXR1cm4geyBjcmVhdGlvbkhlaWdodDogQmlnSW50KDApLCBjb21wbGV0aW9uVGltZTogVGltZXN0YW1wLmZyb21QYXJ0aWFsKHt9KSwgaW5pdGlhbEJhbGFuY2U6IFwiXCIsIGJhbGFuY2U6IFwiXCIsIHVuYm9uZGluZ0lkOiBCaWdJbnQoMCksIHVuYm9uZGluZ09uSG9sZFJlZkNvdW50OiBCaWdJbnQoMCkgfTtcbn1cbnZhciBVbmJvbmRpbmdEZWxlZ2F0aW9uRW50cnkgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5XCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKGUyLmNyZWF0aW9uSGVpZ2h0ICE9PSBCaWdJbnQoMCkgJiYgbzIudWludDMyKDgpLmludDY0KGUyLmNyZWF0aW9uSGVpZ2h0KSwgdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBUaW1lc3RhbXAuZW5jb2RlKGUyLmNvbXBsZXRpb25UaW1lLCBvMi51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIFwiXCIgIT09IGUyLmluaXRpYWxCYWxhbmNlICYmIG8yLnVpbnQzMigyNikuc3RyaW5nKGUyLmluaXRpYWxCYWxhbmNlKSwgXCJcIiAhPT0gZTIuYmFsYW5jZSAmJiBvMi51aW50MzIoMzQpLnN0cmluZyhlMi5iYWxhbmNlKSwgZTIudW5ib25kaW5nSWQgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoNDApLnVpbnQ2NChlMi51bmJvbmRpbmdJZCksIGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50ICE9PSBCaWdJbnQoMCkgJiYgbzIudWludDMyKDQ4KS5pbnQ2NChlMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSBvMiA/IG4yLmxlbiA6IG4yLnBvcyArIG8yO1xuICBjb25zdCBzMiA9IGYoKTtcbiAgZm9yICg7IG4yLnBvcyA8IGkyOyApIHtcbiAgICBjb25zdCBlMyA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczIuY3JlYXRpb25IZWlnaHQgPSBuMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgczIuY29tcGxldGlvblRpbWUgPSBUaW1lc3RhbXAuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBzMi5pbml0aWFsQmFsYW5jZSA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgczIuYmFsYW5jZSA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgczIudW5ib25kaW5nSWQgPSBuMi51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDY6XG4gICAgICAgIHMyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50ID0gbjIuaW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gczI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBjcmVhdGlvbkhlaWdodDogaXNTZXQoZTIuY3JlYXRpb25IZWlnaHQpID8gQmlnSW50KGUyLmNyZWF0aW9uSGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBjb21wbGV0aW9uVGltZTogaXNTZXQoZTIuY29tcGxldGlvblRpbWUpID8gZnJvbUpzb25UaW1lc3RhbXAoZTIuY29tcGxldGlvblRpbWUpIDogdm9pZCAwLCBpbml0aWFsQmFsYW5jZTogaXNTZXQoZTIuaW5pdGlhbEJhbGFuY2UpID8gU3RyaW5nKGUyLmluaXRpYWxCYWxhbmNlKSA6IFwiXCIsIGJhbGFuY2U6IGlzU2V0KGUyLmJhbGFuY2UpID8gU3RyaW5nKGUyLmJhbGFuY2UpIDogXCJcIiwgdW5ib25kaW5nSWQ6IGlzU2V0KGUyLnVuYm9uZGluZ0lkKSA/IEJpZ0ludChlMi51bmJvbmRpbmdJZC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgdW5ib25kaW5nT25Ib2xkUmVmQ291bnQ6IGlzU2V0KGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50KSA/IEJpZ0ludChlMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmNyZWF0aW9uSGVpZ2h0ICYmICh0NS5jcmVhdGlvbkhlaWdodCA9IChlMi5jcmVhdGlvbkhlaWdodCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLmNvbXBsZXRpb25UaW1lICYmICh0NS5jb21wbGV0aW9uVGltZSA9IGZyb21UaW1lc3RhbXAoZTIuY29tcGxldGlvblRpbWUpLnRvSVNPU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLmluaXRpYWxCYWxhbmNlICYmICh0NS5pbml0aWFsQmFsYW5jZSA9IGUyLmluaXRpYWxCYWxhbmNlKSwgdm9pZCAwICE9PSBlMi5iYWxhbmNlICYmICh0NS5iYWxhbmNlID0gZTIuYmFsYW5jZSksIHZvaWQgMCAhPT0gZTIudW5ib25kaW5nSWQgJiYgKHQ1LnVuYm9uZGluZ0lkID0gKGUyLnVuYm9uZGluZ0lkIHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgJiYgKHQ1LnVuYm9uZGluZ09uSG9sZFJlZkNvdW50ID0gKGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSBmKCk7XG4gIHJldHVybiBvMi5jcmVhdGlvbkhlaWdodCA9IHZvaWQgMCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgJiYgbnVsbCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgPyBCaWdJbnQoZTIuY3JlYXRpb25IZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG8yLmNvbXBsZXRpb25UaW1lID0gdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBudWxsICE9PSBlMi5jb21wbGV0aW9uVGltZSA/IFRpbWVzdGFtcC5mcm9tUGFydGlhbChlMi5jb21wbGV0aW9uVGltZSkgOiB2b2lkIDAsIG8yLmluaXRpYWxCYWxhbmNlID0gZTIuaW5pdGlhbEJhbGFuY2UgPz8gXCJcIiwgbzIuYmFsYW5jZSA9IGUyLmJhbGFuY2UgPz8gXCJcIiwgbzIudW5ib25kaW5nSWQgPSB2b2lkIDAgIT09IGUyLnVuYm9uZGluZ0lkICYmIG51bGwgIT09IGUyLnVuYm9uZGluZ0lkID8gQmlnSW50KGUyLnVuYm9uZGluZ0lkLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBvMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCA9IHZvaWQgMCAhPT0gZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgJiYgbnVsbCAhPT0gZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgPyBCaWdJbnQoZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5XCIsIHZhbHVlOiBVbmJvbmRpbmdEZWxlZ2F0aW9uRW50cnkuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gYjIoKSB7XG4gIHJldHVybiB7IGNyZWF0aW9uSGVpZ2h0OiBCaWdJbnQoMCksIGNvbXBsZXRpb25UaW1lOiBUaW1lc3RhbXAuZnJvbVBhcnRpYWwoe30pLCBpbml0aWFsQmFsYW5jZTogXCJcIiwgc2hhcmVzRHN0OiBcIlwiLCB1bmJvbmRpbmdJZDogQmlnSW50KDApLCB1bmJvbmRpbmdPbkhvbGRSZWZDb3VudDogQmlnSW50KDApIH07XG59XG52YXIgUmVkZWxlZ2F0aW9uRW50cnkgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUmVkZWxlZ2F0aW9uRW50cnlcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoZTIuY3JlYXRpb25IZWlnaHQgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoOCkuaW50NjQoZTIuY3JlYXRpb25IZWlnaHQpLCB2b2lkIDAgIT09IGUyLmNvbXBsZXRpb25UaW1lICYmIFRpbWVzdGFtcC5lbmNvZGUoZTIuY29tcGxldGlvblRpbWUsIG8yLnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgXCJcIiAhPT0gZTIuaW5pdGlhbEJhbGFuY2UgJiYgbzIudWludDMyKDI2KS5zdHJpbmcoZTIuaW5pdGlhbEJhbGFuY2UpLCBcIlwiICE9PSBlMi5zaGFyZXNEc3QgJiYgbzIudWludDMyKDM0KS5zdHJpbmcoRGVjaW1hbC5mcm9tVXNlcklucHV0KGUyLnNoYXJlc0RzdCwgMTgpLmF0b21pY3MpLCBlMi51bmJvbmRpbmdJZCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMig0MCkudWludDY0KGUyLnVuYm9uZGluZ0lkKSwgZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoNDgpLmludDY0KGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50KSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IG4yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IG8yID8gbjIubGVuIDogbjIucG9zICsgbzI7XG4gIGNvbnN0IHMyID0gYjIoKTtcbiAgZm9yICg7IG4yLnBvcyA8IGkyOyApIHtcbiAgICBjb25zdCBlMyA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczIuY3JlYXRpb25IZWlnaHQgPSBuMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgczIuY29tcGxldGlvblRpbWUgPSBUaW1lc3RhbXAuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBzMi5pbml0aWFsQmFsYW5jZSA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgczIuc2hhcmVzRHN0ID0gRGVjaW1hbC5mcm9tQXRvbWljcyhuMi5zdHJpbmcoKSwgMTgpLnRvU3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA1OlxuICAgICAgICBzMi51bmJvbmRpbmdJZCA9IG4yLnVpbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNjpcbiAgICAgICAgczIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgPSBuMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBzMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGNyZWF0aW9uSGVpZ2h0OiBpc1NldChlMi5jcmVhdGlvbkhlaWdodCkgPyBCaWdJbnQoZTIuY3JlYXRpb25IZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGNvbXBsZXRpb25UaW1lOiBpc1NldChlMi5jb21wbGV0aW9uVGltZSkgPyBmcm9tSnNvblRpbWVzdGFtcChlMi5jb21wbGV0aW9uVGltZSkgOiB2b2lkIDAsIGluaXRpYWxCYWxhbmNlOiBpc1NldChlMi5pbml0aWFsQmFsYW5jZSkgPyBTdHJpbmcoZTIuaW5pdGlhbEJhbGFuY2UpIDogXCJcIiwgc2hhcmVzRHN0OiBpc1NldChlMi5zaGFyZXNEc3QpID8gU3RyaW5nKGUyLnNoYXJlc0RzdCkgOiBcIlwiLCB1bmJvbmRpbmdJZDogaXNTZXQoZTIudW5ib25kaW5nSWQpID8gQmlnSW50KGUyLnVuYm9uZGluZ0lkLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCB1bmJvbmRpbmdPbkhvbGRSZWZDb3VudDogaXNTZXQoZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQpID8gQmlnSW50KGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50LnRvU3RyaW5nKCkpIDogQmlnSW50KDApIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgJiYgKHQ1LmNyZWF0aW9uSGVpZ2h0ID0gKGUyLmNyZWF0aW9uSGVpZ2h0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIuY29tcGxldGlvblRpbWUgJiYgKHQ1LmNvbXBsZXRpb25UaW1lID0gZnJvbVRpbWVzdGFtcChlMi5jb21wbGV0aW9uVGltZSkudG9JU09TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIuaW5pdGlhbEJhbGFuY2UgJiYgKHQ1LmluaXRpYWxCYWxhbmNlID0gZTIuaW5pdGlhbEJhbGFuY2UpLCB2b2lkIDAgIT09IGUyLnNoYXJlc0RzdCAmJiAodDUuc2hhcmVzRHN0ID0gZTIuc2hhcmVzRHN0KSwgdm9pZCAwICE9PSBlMi51bmJvbmRpbmdJZCAmJiAodDUudW5ib25kaW5nSWQgPSAoZTIudW5ib25kaW5nSWQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCAmJiAodDUudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgPSAoZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IGIyKCk7XG4gIHJldHVybiBvMi5jcmVhdGlvbkhlaWdodCA9IHZvaWQgMCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgJiYgbnVsbCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgPyBCaWdJbnQoZTIuY3JlYXRpb25IZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG8yLmNvbXBsZXRpb25UaW1lID0gdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBudWxsICE9PSBlMi5jb21wbGV0aW9uVGltZSA/IFRpbWVzdGFtcC5mcm9tUGFydGlhbChlMi5jb21wbGV0aW9uVGltZSkgOiB2b2lkIDAsIG8yLmluaXRpYWxCYWxhbmNlID0gZTIuaW5pdGlhbEJhbGFuY2UgPz8gXCJcIiwgbzIuc2hhcmVzRHN0ID0gZTIuc2hhcmVzRHN0ID8/IFwiXCIsIG8yLnVuYm9uZGluZ0lkID0gdm9pZCAwICE9PSBlMi51bmJvbmRpbmdJZCAmJiBudWxsICE9PSBlMi51bmJvbmRpbmdJZCA/IEJpZ0ludChlMi51bmJvbmRpbmdJZC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbzIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgPSB2b2lkIDAgIT09IGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50ICYmIG51bGwgIT09IGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50ID8gQmlnSW50KGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBSZWRlbGVnYXRpb25FbnRyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlZGVsZWdhdGlvbkVudHJ5LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25FbnRyeVwiLCB2YWx1ZTogUmVkZWxlZ2F0aW9uRW50cnkuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFJlZGVsZWdhdGlvbiA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25cIiwgZW5jb2RlKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzICYmIHQ1LnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvclNyY0FkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JEc3RBZGRyZXNzICYmIHQ1LnVpbnQzMigyNikuc3RyaW5nKGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpO1xuICBmb3IgKGNvbnN0IG8yIG9mIGUyLmVudHJpZXMpIFJlZGVsZWdhdGlvbkVudHJ5LmVuY29kZShvMiwgdDUudWludDMyKDM0KS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdDU7XG59LCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG8yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IHQ1ID8gbzIubGVuIDogbzIucG9zICsgdDU7XG4gIGNvbnN0IGkyID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JTcmNBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JEc3RBZGRyZXNzOiBcIlwiLCBlbnRyaWVzOiBbXSB9O1xuICBmb3IgKDsgbzIucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5kZWxlZ2F0b3JBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMi52YWxpZGF0b3JTcmNBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBpMi52YWxpZGF0b3JEc3RBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBpMi5lbnRyaWVzLnB1c2goUmVkZWxlZ2F0aW9uRW50cnkuZGVjb2RlKG8yLCBvMi51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRvckFkZHJlc3M6IGlzU2V0KGUyLmRlbGVnYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yU3JjQWRkcmVzczogaXNTZXQoZTIudmFsaWRhdG9yU3JjQWRkcmVzcykgPyBTdHJpbmcoZTIudmFsaWRhdG9yU3JjQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JEc3RBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSA6IFwiXCIsIGVudHJpZXM6IEFycmF5LmlzQXJyYXkoZTI/LmVudHJpZXMpID8gZTIuZW50cmllcy5tYXAoKChlMykgPT4gUmVkZWxlZ2F0aW9uRW50cnkuZnJvbUpTT04oZTMpKSkgOiBbXSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgKHQ1LmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzICYmICh0NS52YWxpZGF0b3JTcmNBZGRyZXNzID0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yRHN0QWRkcmVzcyAmJiAodDUudmFsaWRhdG9yRHN0QWRkcmVzcyA9IGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpLCBlMi5lbnRyaWVzID8gdDUuZW50cmllcyA9IGUyLmVudHJpZXMubWFwKCgoZTMpID0+IGUzID8gUmVkZWxlZ2F0aW9uRW50cnkudG9KU09OKGUzKSA6IHZvaWQgMCkpIDogdDUuZW50cmllcyA9IFtdLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JTcmNBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JEc3RBZGRyZXNzOiBcIlwiLCBlbnRyaWVzOiBbXSB9O1xuICByZXR1cm4gdDUuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MgPz8gXCJcIiwgdDUudmFsaWRhdG9yU3JjQWRkcmVzcyA9IGUyLnZhbGlkYXRvclNyY0FkZHJlc3MgPz8gXCJcIiwgdDUudmFsaWRhdG9yRHN0QWRkcmVzcyA9IGUyLnZhbGlkYXRvckRzdEFkZHJlc3MgPz8gXCJcIiwgdDUuZW50cmllcyA9IGUyLmVudHJpZXM/Lm1hcCgoKGUzKSA9PiBSZWRlbGVnYXRpb25FbnRyeS5mcm9tUGFydGlhbChlMykpKSB8fCBbXSwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUmVkZWxlZ2F0aW9uLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUmVkZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25cIiwgdmFsdWU6IFJlZGVsZWdhdGlvbi5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBTKCkge1xuICByZXR1cm4geyBkZWxlZ2F0aW9uOiBEZWxlZ2F0aW9uLmZyb21QYXJ0aWFsKHt9KSwgYmFsYW5jZTogQ29pbi5mcm9tUGFydGlhbCh7fSkgfTtcbn1cbnZhciBEZWxlZ2F0aW9uUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuRGVsZWdhdGlvblJlc3BvbnNlXCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKHZvaWQgMCAhPT0gZTIuZGVsZWdhdGlvbiAmJiBEZWxlZ2F0aW9uLmVuY29kZShlMi5kZWxlZ2F0aW9uLCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIHZvaWQgMCAhPT0gZTIuYmFsYW5jZSAmJiBDb2luLmVuY29kZShlMi5iYWxhbmNlLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBvMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSB0NSA/IG8yLmxlbiA6IG8yLnBvcyArIHQ1O1xuICBjb25zdCBzMiA9IFMoKTtcbiAgZm9yICg7IG8yLnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBlMyA9IG8yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczIuZGVsZWdhdGlvbiA9IERlbGVnYXRpb24uZGVjb2RlKG8yLCBvMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBzMi5iYWxhbmNlID0gQ29pbi5kZWNvZGUobzIsIG8yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gczI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0aW9uOiBpc1NldChlMi5kZWxlZ2F0aW9uKSA/IERlbGVnYXRpb24uZnJvbUpTT04oZTIuZGVsZWdhdGlvbikgOiB2b2lkIDAsIGJhbGFuY2U6IGlzU2V0KGUyLmJhbGFuY2UpID8gQ29pbi5mcm9tSlNPTihlMi5iYWxhbmNlKSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRpb24gJiYgKHQ1LmRlbGVnYXRpb24gPSBlMi5kZWxlZ2F0aW9uID8gRGVsZWdhdGlvbi50b0pTT04oZTIuZGVsZWdhdGlvbikgOiB2b2lkIDApLCB2b2lkIDAgIT09IGUyLmJhbGFuY2UgJiYgKHQ1LmJhbGFuY2UgPSBlMi5iYWxhbmNlID8gQ29pbi50b0pTT04oZTIuYmFsYW5jZSkgOiB2b2lkIDApLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0gUygpO1xuICByZXR1cm4gdDUuZGVsZWdhdGlvbiA9IHZvaWQgMCAhPT0gZTIuZGVsZWdhdGlvbiAmJiBudWxsICE9PSBlMi5kZWxlZ2F0aW9uID8gRGVsZWdhdGlvbi5mcm9tUGFydGlhbChlMi5kZWxlZ2F0aW9uKSA6IHZvaWQgMCwgdDUuYmFsYW5jZSA9IHZvaWQgMCAhPT0gZTIuYmFsYW5jZSAmJiBudWxsICE9PSBlMi5iYWxhbmNlID8gQ29pbi5mcm9tUGFydGlhbChlMi5iYWxhbmNlKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gRGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gRGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5EZWxlZ2F0aW9uUmVzcG9uc2VcIiwgdmFsdWU6IERlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBBKCkge1xuICByZXR1cm4geyByZWRlbGVnYXRpb25FbnRyeTogUmVkZWxlZ2F0aW9uRW50cnkuZnJvbVBhcnRpYWwoe30pLCBiYWxhbmNlOiBcIlwiIH07XG59XG52YXIgUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlXCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKHZvaWQgMCAhPT0gZTIucmVkZWxlZ2F0aW9uRW50cnkgJiYgUmVkZWxlZ2F0aW9uRW50cnkuZW5jb2RlKGUyLnJlZGVsZWdhdGlvbkVudHJ5LCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIFwiXCIgIT09IGUyLmJhbGFuY2UgJiYgdDUudWludDMyKDM0KS5zdHJpbmcoZTIuYmFsYW5jZSksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBvMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSB0NSA/IG8yLmxlbiA6IG8yLnBvcyArIHQ1O1xuICBjb25zdCBpMiA9IEEoKTtcbiAgZm9yICg7IG8yLnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBlMyA9IG8yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaTIucmVkZWxlZ2F0aW9uRW50cnkgPSBSZWRlbGVnYXRpb25FbnRyeS5kZWNvZGUobzIsIG8yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIGkyLmJhbGFuY2UgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyByZWRlbGVnYXRpb25FbnRyeTogaXNTZXQoZTIucmVkZWxlZ2F0aW9uRW50cnkpID8gUmVkZWxlZ2F0aW9uRW50cnkuZnJvbUpTT04oZTIucmVkZWxlZ2F0aW9uRW50cnkpIDogdm9pZCAwLCBiYWxhbmNlOiBpc1NldChlMi5iYWxhbmNlKSA/IFN0cmluZyhlMi5iYWxhbmNlKSA6IFwiXCIgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5yZWRlbGVnYXRpb25FbnRyeSAmJiAodDUucmVkZWxlZ2F0aW9uRW50cnkgPSBlMi5yZWRlbGVnYXRpb25FbnRyeSA/IFJlZGVsZWdhdGlvbkVudHJ5LnRvSlNPTihlMi5yZWRlbGVnYXRpb25FbnRyeSkgOiB2b2lkIDApLCB2b2lkIDAgIT09IGUyLmJhbGFuY2UgJiYgKHQ1LmJhbGFuY2UgPSBlMi5iYWxhbmNlKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IEEoKTtcbiAgcmV0dXJuIHQ1LnJlZGVsZWdhdGlvbkVudHJ5ID0gdm9pZCAwICE9PSBlMi5yZWRlbGVnYXRpb25FbnRyeSAmJiBudWxsICE9PSBlMi5yZWRlbGVnYXRpb25FbnRyeSA/IFJlZGVsZWdhdGlvbkVudHJ5LmZyb21QYXJ0aWFsKGUyLnJlZGVsZWdhdGlvbkVudHJ5KSA6IHZvaWQgMCwgdDUuYmFsYW5jZSA9IGUyLmJhbGFuY2UgPz8gXCJcIiwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2VcIiwgdmFsdWU6IFJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gRCgpIHtcbiAgcmV0dXJuIHsgcmVkZWxlZ2F0aW9uOiBSZWRlbGVnYXRpb24uZnJvbVBhcnRpYWwoe30pLCBlbnRyaWVzOiBbXSB9O1xufVxudmFyIFJlZGVsZWdhdGlvblJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvblJlc3BvbnNlXCIsIGVuY29kZShlMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgdm9pZCAwICE9PSBlMi5yZWRlbGVnYXRpb24gJiYgUmVkZWxlZ2F0aW9uLmVuY29kZShlMi5yZWRlbGVnYXRpb24sIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgZm9yIChjb25zdCBvMiBvZiBlMi5lbnRyaWVzKSBSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlLmVuY29kZShvMiwgdDUudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdDU7XG59LCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG8yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IHQ1ID8gbzIubGVuIDogbzIucG9zICsgdDU7XG4gIGNvbnN0IGkyID0gRCgpO1xuICBmb3IgKDsgbzIucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5yZWRlbGVnYXRpb24gPSBSZWRlbGVnYXRpb24uZGVjb2RlKG8yLCBvMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMi5lbnRyaWVzLnB1c2goUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS5kZWNvZGUobzIsIG8yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbzIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgcmVkZWxlZ2F0aW9uOiBpc1NldChlMi5yZWRlbGVnYXRpb24pID8gUmVkZWxlZ2F0aW9uLmZyb21KU09OKGUyLnJlZGVsZWdhdGlvbikgOiB2b2lkIDAsIGVudHJpZXM6IEFycmF5LmlzQXJyYXkoZTI/LmVudHJpZXMpID8gZTIuZW50cmllcy5tYXAoKChlMykgPT4gUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS5mcm9tSlNPTihlMykpKSA6IFtdIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIucmVkZWxlZ2F0aW9uICYmICh0NS5yZWRlbGVnYXRpb24gPSBlMi5yZWRlbGVnYXRpb24gPyBSZWRlbGVnYXRpb24udG9KU09OKGUyLnJlZGVsZWdhdGlvbikgOiB2b2lkIDApLCBlMi5lbnRyaWVzID8gdDUuZW50cmllcyA9IGUyLmVudHJpZXMubWFwKCgoZTMpID0+IGUzID8gUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS50b0pTT04oZTMpIDogdm9pZCAwKSkgOiB0NS5lbnRyaWVzID0gW10sIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSBEKCk7XG4gIHJldHVybiB0NS5yZWRlbGVnYXRpb24gPSB2b2lkIDAgIT09IGUyLnJlZGVsZWdhdGlvbiAmJiBudWxsICE9PSBlMi5yZWRlbGVnYXRpb24gPyBSZWRlbGVnYXRpb24uZnJvbVBhcnRpYWwoZTIucmVkZWxlZ2F0aW9uKSA6IHZvaWQgMCwgdDUuZW50cmllcyA9IGUyLmVudHJpZXM/Lm1hcCgoKGUzKSA9PiBSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlLmZyb21QYXJ0aWFsKGUzKSkpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBSZWRlbGVnYXRpb25SZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlZGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25SZXNwb25zZVwiLCB2YWx1ZTogUmVkZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIFF1ZXJ5RGVsZWdhdGlvblJlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdFwiLCBlbmNvZGU6IChvMiwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBvMi5kZWxlZ2F0b3JBZGRyICYmIGUyLnVpbnQzMigxMCkuc3RyaW5nKG8yLmRlbGVnYXRvckFkZHIpLCBcIlwiICE9PSBvMi52YWxpZGF0b3JBZGRyICYmIGUyLnVpbnQzMigxOCkuc3RyaW5nKG8yLnZhbGlkYXRvckFkZHIpLCBlMiksIGRlY29kZShvMiwgZTIpIHtcbiAgY29uc3QgdDUgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gZTIgPyB0NS5sZW4gOiB0NS5wb3MgKyBlMjtcbiAgY29uc3QgYTIgPSB7IGRlbGVnYXRvckFkZHI6IFwiXCIsIHZhbGlkYXRvckFkZHI6IFwiXCIgfTtcbiAgZm9yICg7IHQ1LnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBvMyA9IHQ1LnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgYTIuZGVsZWdhdG9yQWRkciA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgYTIudmFsaWRhdG9yQWRkciA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHQ1LnNraXBUeXBlKDcgJiBvMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBhMjtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IGRlbGVnYXRvckFkZHI6IGlzU2V0KG8yLmRlbGVnYXRvckFkZHIpID8gU3RyaW5nKG8yLmRlbGVnYXRvckFkZHIpIDogXCJcIiwgdmFsaWRhdG9yQWRkcjogaXNTZXQobzIudmFsaWRhdG9yQWRkcikgPyBTdHJpbmcobzIudmFsaWRhdG9yQWRkcikgOiBcIlwiIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgZTIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuZGVsZWdhdG9yQWRkciAmJiAoZTIuZGVsZWdhdG9yQWRkciA9IG8yLmRlbGVnYXRvckFkZHIpLCB2b2lkIDAgIT09IG8yLnZhbGlkYXRvckFkZHIgJiYgKGUyLnZhbGlkYXRvckFkZHIgPSBvMi52YWxpZGF0b3JBZGRyKSwgZTI7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCBlMiA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgdmFsaWRhdG9yQWRkcjogXCJcIiB9O1xuICByZXR1cm4gZTIuZGVsZWdhdG9yQWRkciA9IG8yLmRlbGVnYXRvckFkZHIgPz8gXCJcIiwgZTIudmFsaWRhdG9yQWRkciA9IG8yLnZhbGlkYXRvckFkZHIgPz8gXCJcIiwgZTI7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5RGVsZWdhdGlvblJlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdGlvblJlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlXCIsIGVuY29kZTogKG8yLCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKHZvaWQgMCAhPT0gbzIuZGVsZWdhdGlvblJlc3BvbnNlICYmIERlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUobzIuZGVsZWdhdGlvblJlc3BvbnNlLCBlMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIGUyKSwgZGVjb2RlKG8yLCBlMikge1xuICBjb25zdCB0NSA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IGEyID0gdm9pZCAwID09PSBlMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIGUyO1xuICBjb25zdCBpMiA9IHsgZGVsZWdhdGlvblJlc3BvbnNlOiB2b2lkIDAgfTtcbiAgZm9yICg7IHQ1LnBvcyA8IGEyOyApIHtcbiAgICBjb25zdCBvMyA9IHQ1LnVpbnQzMigpO1xuICAgIGlmIChvMyA+Pj4gMyA9PSAxKSBpMi5kZWxlZ2F0aW9uUmVzcG9uc2UgPSBEZWxlZ2F0aW9uUmVzcG9uc2UuZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgZWxzZSB0NS5za2lwVHlwZSg3ICYgbzMpO1xuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IGRlbGVnYXRpb25SZXNwb25zZTogaXNTZXQobzIuZGVsZWdhdGlvblJlc3BvbnNlKSA/IERlbGVnYXRpb25SZXNwb25zZS5mcm9tSlNPTihvMi5kZWxlZ2F0aW9uUmVzcG9uc2UpIDogdm9pZCAwIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgZTIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuZGVsZWdhdGlvblJlc3BvbnNlICYmIChlMi5kZWxlZ2F0aW9uUmVzcG9uc2UgPSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2UgPyBEZWxlZ2F0aW9uUmVzcG9uc2UudG9KU09OKG8yLmRlbGVnYXRpb25SZXNwb25zZSkgOiB2b2lkIDApLCBlMjtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IGUyID0geyBkZWxlZ2F0aW9uUmVzcG9uc2U6IHZvaWQgMCB9O1xuICByZXR1cm4gZTIuZGVsZWdhdGlvblJlc3BvbnNlID0gdm9pZCAwICE9PSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2UgJiYgbnVsbCAhPT0gbzIuZGVsZWdhdGlvblJlc3BvbnNlID8gRGVsZWdhdGlvblJlc3BvbnNlLmZyb21QYXJ0aWFsKG8yLmRlbGVnYXRpb25SZXNwb25zZSkgOiB2b2lkIDAsIGUyO1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IFF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlXCIsIHZhbHVlOiBRdWVyeURlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0XCIsIGVuY29kZTogKG8yLCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IG8yLmRlbGVnYXRvckFkZHIgJiYgZTIudWludDMyKDEwKS5zdHJpbmcobzIuZGVsZWdhdG9yQWRkciksIFwiXCIgIT09IG8yLnZhbGlkYXRvckFkZHIgJiYgZTIudWludDMyKDE4KS5zdHJpbmcobzIudmFsaWRhdG9yQWRkciksIGUyKSwgZGVjb2RlKG8yLCBlMikge1xuICBjb25zdCB0NSA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSBlMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIGUyO1xuICBjb25zdCBhMiA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgdmFsaWRhdG9yQWRkcjogXCJcIiB9O1xuICBmb3IgKDsgdDUucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IG8zID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBhMi5kZWxlZ2F0b3JBZGRyID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBhMi52YWxpZGF0b3JBZGRyID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdDUuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGEyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVsZWdhdG9yQWRkcjogaXNTZXQobzIuZGVsZWdhdG9yQWRkcikgPyBTdHJpbmcobzIuZGVsZWdhdG9yQWRkcikgOiBcIlwiLCB2YWxpZGF0b3JBZGRyOiBpc1NldChvMi52YWxpZGF0b3JBZGRyKSA/IFN0cmluZyhvMi52YWxpZGF0b3JBZGRyKSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5kZWxlZ2F0b3JBZGRyICYmIChlMi5kZWxlZ2F0b3JBZGRyID0gbzIuZGVsZWdhdG9yQWRkciksIHZvaWQgMCAhPT0gbzIudmFsaWRhdG9yQWRkciAmJiAoZTIudmFsaWRhdG9yQWRkciA9IG8yLnZhbGlkYXRvckFkZHIpLCBlMjtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IGUyID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCB2YWxpZGF0b3JBZGRyOiBcIlwiIH07XG4gIHJldHVybiBlMi5kZWxlZ2F0b3JBZGRyID0gbzIuZGVsZWdhdG9yQWRkciA/PyBcIlwiLCBlMi52YWxpZGF0b3JBZGRyID0gbzIudmFsaWRhdG9yQWRkciA/PyBcIlwiLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0LmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBjKCkge1xuICByZXR1cm4geyB1bmJvbmQ6IFVuYm9uZGluZ0RlbGVnYXRpb24uZnJvbVBhcnRpYWwoe30pIH07XG59XG52YXIgUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVzcG9uc2VcIiwgZW5jb2RlOiAobzIsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAodm9pZCAwICE9PSBvMi51bmJvbmQgJiYgVW5ib25kaW5nRGVsZWdhdGlvbi5lbmNvZGUobzIudW5ib25kLCBlMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIGUyKSwgZGVjb2RlKG8yLCBlMikge1xuICBjb25zdCB0NSA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSBlMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIGUyO1xuICBjb25zdCBpMiA9IGMoKTtcbiAgZm9yICg7IHQ1LnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBvMyA9IHQ1LnVpbnQzMigpO1xuICAgIGlmIChvMyA+Pj4gMyA9PSAxKSBpMi51bmJvbmQgPSBVbmJvbmRpbmdEZWxlZ2F0aW9uLmRlY29kZSh0NSwgdDUudWludDMyKCkpO1xuICAgIGVsc2UgdDUuc2tpcFR5cGUoNyAmIG8zKTtcbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyB1bmJvbmQ6IGlzU2V0KG8yLnVuYm9uZCkgPyBVbmJvbmRpbmdEZWxlZ2F0aW9uLmZyb21KU09OKG8yLnVuYm9uZCkgOiB2b2lkIDAgfSksIHRvSlNPTihvMikge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi51bmJvbmQgJiYgKGUyLnVuYm9uZCA9IG8yLnVuYm9uZCA/IFVuYm9uZGluZ0RlbGVnYXRpb24udG9KU09OKG8yLnVuYm9uZCkgOiB2b2lkIDApLCBlMjtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IGUyID0gYygpO1xuICByZXR1cm4gZTIudW5ib25kID0gdm9pZCAwICE9PSBvMi51bmJvbmQgJiYgbnVsbCAhPT0gbzIudW5ib25kID8gVW5ib25kaW5nRGVsZWdhdGlvbi5mcm9tUGFydGlhbChvMi51bmJvbmQpIDogdm9pZCAwLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXNwb25zZS5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXF1ZXN0ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXF1ZXN0XCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHIgJiYgdDUudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiBQYWdlUmVxdWVzdC5lbmNvZGUoZTIucGFnaW5hdGlvbiwgdDUudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCB0NSksIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbjIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBhMiA9IHZvaWQgMCA9PT0gdDUgPyBuMi5sZW4gOiBuMi5wb3MgKyB0NTtcbiAgY29uc3QgaTIgPSB7IGRlbGVnYXRvckFkZHI6IFwiXCIsIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgbjIucG9zIDwgYTI7ICkge1xuICAgIGNvbnN0IGUzID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5kZWxlZ2F0b3JBZGRyID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMi5wYWdpbmF0aW9uID0gUGFnZVJlcXVlc3QuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcjogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcikgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcikgOiBcIlwiLCBwYWdpbmF0aW9uOiBpc1NldChlMi5wYWdpbmF0aW9uKSA/IFBhZ2VSZXF1ZXN0LmZyb21KU09OKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkciAmJiAodDUuZGVsZWdhdG9yQWRkciA9IGUyLmRlbGVnYXRvckFkZHIpLCB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgKHQ1LnBhZ2luYXRpb24gPSBlMi5wYWdpbmF0aW9uID8gUGFnZVJlcXVlc3QudG9KU09OKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0b3JBZGRyID0gZTIuZGVsZWdhdG9yQWRkciA/PyBcIlwiLCB0NS5wYWdpbmF0aW9uID0gdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIG51bGwgIT09IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC5mcm9tUGFydGlhbChlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1JlcXVlc3QuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1JlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXF1ZXN0LmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1Jlc3BvbnNlXCIsIGVuY29kZShvMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBlMiBvZiBvMi5kZWxlZ2F0aW9uUmVzcG9uc2VzKSBEZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKGUyLCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgUGFnZVJlc3BvbnNlLmVuY29kZShvMi5wYWdpbmF0aW9uLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIHQ1O1xufSwgZGVjb2RlKG8yLCB0NSkge1xuICBjb25zdCBhMiA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSB0NSA/IGEyLmxlbiA6IGEyLnBvcyArIHQ1O1xuICBjb25zdCByNiA9IHsgZGVsZWdhdGlvblJlc3BvbnNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgYTIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IG8zID0gYTIudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNi5kZWxlZ2F0aW9uUmVzcG9uc2VzLnB1c2goRGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShhMiwgYTIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI2LnBhZ2luYXRpb24gPSBQYWdlUmVzcG9uc2UuZGVjb2RlKGEyLCBhMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYTIuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI2O1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVsZWdhdGlvblJlc3BvbnNlczogQXJyYXkuaXNBcnJheShvMj8uZGVsZWdhdGlvblJlc3BvbnNlcykgPyBvMi5kZWxlZ2F0aW9uUmVzcG9uc2VzLm1hcCgoKG8zKSA9PiBEZWxlZ2F0aW9uUmVzcG9uc2UuZnJvbUpTT04obzMpKSkgOiBbXSwgcGFnaW5hdGlvbjogaXNTZXQobzIucGFnaW5hdGlvbikgPyBQYWdlUmVzcG9uc2UuZnJvbUpTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gbzIuZGVsZWdhdGlvblJlc3BvbnNlcyA/IHQ1LmRlbGVnYXRpb25SZXNwb25zZXMgPSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2VzLm1hcCgoKG8zKSA9PiBvMyA/IERlbGVnYXRpb25SZXNwb25zZS50b0pTT04obzMpIDogdm9pZCAwKSkgOiB0NS5kZWxlZ2F0aW9uUmVzcG9uc2VzID0gW10sIHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiAodDUucGFnaW5hdGlvbiA9IG8yLnBhZ2luYXRpb24gPyBQYWdlUmVzcG9uc2UudG9KU09OKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgdDU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdGlvblJlc3BvbnNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICByZXR1cm4gdDUuZGVsZWdhdGlvblJlc3BvbnNlcyA9IG8yLmRlbGVnYXRpb25SZXNwb25zZXM/Lm1hcCgoKG8zKSA9PiBEZWxlZ2F0aW9uUmVzcG9uc2UuZnJvbVBhcnRpYWwobzMpKSkgfHwgW10sIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS5mcm9tUGFydGlhbChvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1Jlc3BvbnNlLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1JlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1JlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkciAmJiB0NS51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyKSwgdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXF1ZXN0LmVuY29kZShlMi5wYWdpbmF0aW9uLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGEyID0gdm9pZCAwID09PSB0NSA/IG4yLmxlbiA6IG4yLnBvcyArIHQ1O1xuICBjb25zdCBpMiA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIGZvciAoOyBuMi5wb3MgPCBhMjsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkyLmRlbGVnYXRvckFkZHIgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkyLnBhZ2luYXRpb24gPSBQYWdlUmVxdWVzdC5kZWNvZGUobjIsIG4yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyKSA6IFwiXCIsIHBhZ2luYXRpb246IGlzU2V0KGUyLnBhZ2luYXRpb24pID8gUGFnZVJlcXVlc3QuZnJvbUpTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyICYmICh0NS5kZWxlZ2F0b3JBZGRyID0gZTIuZGVsZWdhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiAodDUucGFnaW5hdGlvbiA9IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC50b0pTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDApLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgcmV0dXJuIHQ1LmRlbGVnYXRvckFkZHIgPSBlMi5kZWxlZ2F0b3JBZGRyID8/IFwiXCIsIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gZTIucGFnaW5hdGlvbiA/IFBhZ2VSZXF1ZXN0LmZyb21QYXJ0aWFsKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXF1ZXN0LmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1JlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVzcG9uc2VcIiwgZW5jb2RlKG8yLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IGUyIG9mIG8yLnVuYm9uZGluZ1Jlc3BvbnNlcykgVW5ib25kaW5nRGVsZWdhdGlvbi5lbmNvZGUoZTIsIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBQYWdlUmVzcG9uc2UuZW5jb2RlKG8yLnBhZ2luYXRpb24sIHQ1LnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgdDU7XG59LCBkZWNvZGUobzIsIHQ1KSB7XG4gIGNvbnN0IG4yID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IHQ1ID8gbjIubGVuIDogbjIucG9zICsgdDU7XG4gIGNvbnN0IHI2ID0geyB1bmJvbmRpbmdSZXNwb25zZXM6IFtdLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgZm9yICg7IG4yLnBvcyA8IGkyOyApIHtcbiAgICBjb25zdCBvMyA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcjYudW5ib25kaW5nUmVzcG9uc2VzLnB1c2goVW5ib25kaW5nRGVsZWdhdGlvbi5kZWNvZGUobjIsIG4yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNi5wYWdpbmF0aW9uID0gUGFnZVJlc3BvbnNlLmRlY29kZShuMiwgbjIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBvMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiByNjtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IHVuYm9uZGluZ1Jlc3BvbnNlczogQXJyYXkuaXNBcnJheShvMj8udW5ib25kaW5nUmVzcG9uc2VzKSA/IG8yLnVuYm9uZGluZ1Jlc3BvbnNlcy5tYXAoKChvMykgPT4gVW5ib25kaW5nRGVsZWdhdGlvbi5mcm9tSlNPTihvMykpKSA6IFtdLCBwYWdpbmF0aW9uOiBpc1NldChvMi5wYWdpbmF0aW9uKSA/IFBhZ2VSZXNwb25zZS5mcm9tSlNPTihvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiBvMi51bmJvbmRpbmdSZXNwb25zZXMgPyB0NS51bmJvbmRpbmdSZXNwb25zZXMgPSBvMi51bmJvbmRpbmdSZXNwb25zZXMubWFwKCgobzMpID0+IG8zID8gVW5ib25kaW5nRGVsZWdhdGlvbi50b0pTT04obzMpIDogdm9pZCAwKSkgOiB0NS51bmJvbmRpbmdSZXNwb25zZXMgPSBbXSwgdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmICh0NS5wYWdpbmF0aW9uID0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS50b0pTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDApLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyB1bmJvbmRpbmdSZXNwb25zZXM6IFtdLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgcmV0dXJuIHQ1LnVuYm9uZGluZ1Jlc3BvbnNlcyA9IG8yLnVuYm9uZGluZ1Jlc3BvbnNlcz8ubWFwKCgobzMpID0+IFVuYm9uZGluZ0RlbGVnYXRpb24uZnJvbVBhcnRpYWwobzMpKSkgfHwgW10sIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS5mcm9tUGFydGlhbChvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1Jlc3BvbnNlLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlSZWRlbGVnYXRpb25zUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVJlZGVsZWdhdGlvbnNSZXF1ZXN0XCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHIgJiYgdDUudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkciksIFwiXCIgIT09IGUyLnNyY1ZhbGlkYXRvckFkZHIgJiYgdDUudWludDMyKDE4KS5zdHJpbmcoZTIuc3JjVmFsaWRhdG9yQWRkciksIFwiXCIgIT09IGUyLmRzdFZhbGlkYXRvckFkZHIgJiYgdDUudWludDMyKDI2KS5zdHJpbmcoZTIuZHN0VmFsaWRhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiBQYWdlUmVxdWVzdC5lbmNvZGUoZTIucGFnaW5hdGlvbiwgdDUudWludDMyKDM0KS5mb3JrKCkpLmxkZWxpbSgpLCB0NSksIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbjIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBhMiA9IHZvaWQgMCA9PT0gdDUgPyBuMi5sZW4gOiBuMi5wb3MgKyB0NTtcbiAgY29uc3QgaTIgPSB7IGRlbGVnYXRvckFkZHI6IFwiXCIsIHNyY1ZhbGlkYXRvckFkZHI6IFwiXCIsIGRzdFZhbGlkYXRvckFkZHI6IFwiXCIsIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgbjIucG9zIDwgYTI7ICkge1xuICAgIGNvbnN0IGUzID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5kZWxlZ2F0b3JBZGRyID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMi5zcmNWYWxpZGF0b3JBZGRyID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBpMi5kc3RWYWxpZGF0b3JBZGRyID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBpMi5wYWdpbmF0aW9uID0gUGFnZVJlcXVlc3QuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcjogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcikgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcikgOiBcIlwiLCBzcmNWYWxpZGF0b3JBZGRyOiBpc1NldChlMi5zcmNWYWxpZGF0b3JBZGRyKSA/IFN0cmluZyhlMi5zcmNWYWxpZGF0b3JBZGRyKSA6IFwiXCIsIGRzdFZhbGlkYXRvckFkZHI6IGlzU2V0KGUyLmRzdFZhbGlkYXRvckFkZHIpID8gU3RyaW5nKGUyLmRzdFZhbGlkYXRvckFkZHIpIDogXCJcIiwgcGFnaW5hdGlvbjogaXNTZXQoZTIucGFnaW5hdGlvbikgPyBQYWdlUmVxdWVzdC5mcm9tSlNPTihlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHIgJiYgKHQ1LmRlbGVnYXRvckFkZHIgPSBlMi5kZWxlZ2F0b3JBZGRyKSwgdm9pZCAwICE9PSBlMi5zcmNWYWxpZGF0b3JBZGRyICYmICh0NS5zcmNWYWxpZGF0b3JBZGRyID0gZTIuc3JjVmFsaWRhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIuZHN0VmFsaWRhdG9yQWRkciAmJiAodDUuZHN0VmFsaWRhdG9yQWRkciA9IGUyLmRzdFZhbGlkYXRvckFkZHIpLCB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgKHQ1LnBhZ2luYXRpb24gPSBlMi5wYWdpbmF0aW9uID8gUGFnZVJlcXVlc3QudG9KU09OKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgc3JjVmFsaWRhdG9yQWRkcjogXCJcIiwgZHN0VmFsaWRhdG9yQWRkcjogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0b3JBZGRyID0gZTIuZGVsZWdhdG9yQWRkciA/PyBcIlwiLCB0NS5zcmNWYWxpZGF0b3JBZGRyID0gZTIuc3JjVmFsaWRhdG9yQWRkciA/PyBcIlwiLCB0NS5kc3RWYWxpZGF0b3JBZGRyID0gZTIuZHN0VmFsaWRhdG9yQWRkciA/PyBcIlwiLCB0NS5wYWdpbmF0aW9uID0gdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIG51bGwgIT09IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC5mcm9tUGFydGlhbChlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlSZWRlbGVnYXRpb25zUmVxdWVzdC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5UmVkZWxlZ2F0aW9uc1JlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5UmVkZWxlZ2F0aW9uc1JlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5UmVkZWxlZ2F0aW9uc1JlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlXCIsIGVuY29kZShvMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBlMiBvZiBvMi5yZWRlbGVnYXRpb25SZXNwb25zZXMpIFJlZGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShlMiwgdDUudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXNwb25zZS5lbmNvZGUobzIucGFnaW5hdGlvbiwgdDUudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCB0NTtcbn0sIGRlY29kZShvMiwgdDUpIHtcbiAgY29uc3QgbjIgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCBhMiA9IHZvaWQgMCA9PT0gdDUgPyBuMi5sZW4gOiBuMi5wb3MgKyB0NTtcbiAgY29uc3QgcjYgPSB7IHJlZGVsZWdhdGlvblJlc3BvbnNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgbjIucG9zIDwgYTI7ICkge1xuICAgIGNvbnN0IG8zID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNi5yZWRlbGVnYXRpb25SZXNwb25zZXMucHVzaChSZWRlbGVnYXRpb25SZXNwb25zZS5kZWNvZGUobjIsIG4yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNi5wYWdpbmF0aW9uID0gUGFnZVJlc3BvbnNlLmRlY29kZShuMiwgbjIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBvMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiByNjtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IHJlZGVsZWdhdGlvblJlc3BvbnNlczogQXJyYXkuaXNBcnJheShvMj8ucmVkZWxlZ2F0aW9uUmVzcG9uc2VzKSA/IG8yLnJlZGVsZWdhdGlvblJlc3BvbnNlcy5tYXAoKChvMykgPT4gUmVkZWxlZ2F0aW9uUmVzcG9uc2UuZnJvbUpTT04obzMpKSkgOiBbXSwgcGFnaW5hdGlvbjogaXNTZXQobzIucGFnaW5hdGlvbikgPyBQYWdlUmVzcG9uc2UuZnJvbUpTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gbzIucmVkZWxlZ2F0aW9uUmVzcG9uc2VzID8gdDUucmVkZWxlZ2F0aW9uUmVzcG9uc2VzID0gbzIucmVkZWxlZ2F0aW9uUmVzcG9uc2VzLm1hcCgoKG8zKSA9PiBvMyA/IFJlZGVsZWdhdGlvblJlc3BvbnNlLnRvSlNPTihvMykgOiB2b2lkIDApKSA6IHQ1LnJlZGVsZWdhdGlvblJlc3BvbnNlcyA9IFtdLCB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgKHQ1LnBhZ2luYXRpb24gPSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlc3BvbnNlLnRvSlNPTihvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCksIHQ1O1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgdDUgPSB7IHJlZGVsZWdhdGlvblJlc3BvbnNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICByZXR1cm4gdDUucmVkZWxlZ2F0aW9uUmVzcG9uc2VzID0gbzIucmVkZWxlZ2F0aW9uUmVzcG9uc2VzPy5tYXAoKChvMykgPT4gUmVkZWxlZ2F0aW9uUmVzcG9uc2UuZnJvbVBhcnRpYWwobzMpKSkgfHwgW10sIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS5mcm9tUGFydGlhbChvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlSZWRlbGVnYXRpb25zUmVzcG9uc2UuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBRdWVyeVJlZGVsZWdhdGlvbnNSZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlSZWRlbGVnYXRpb25zUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbmZ1bmN0aW9uIHYoKSB7XG4gIHJldHVybiB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIGFtb3VudDogQ29pbi5mcm9tUGFydGlhbCh7fSkgfTtcbn1cbnZhciBNc2dEZWxlZ2F0ZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dEZWxlZ2F0ZVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBDb2luLmVuY29kZShlMi5hbW91bnQsIG8yLnVpbnQzMigyNikuZm9yaygpKS5sZGVsaW0oKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgczIgPSB2b2lkIDAgPT09IG8yID8gdDUubGVuIDogdDUucG9zICsgbzI7XG4gIGNvbnN0IGkyID0gdigpO1xuICBmb3IgKDsgdDUucG9zIDwgczI7ICkge1xuICAgIGNvbnN0IGUzID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5kZWxlZ2F0b3JBZGRyZXNzID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMi52YWxpZGF0b3JBZGRyZXNzID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBpMi5hbW91bnQgPSBDb2luLmRlY29kZSh0NSwgdDUudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHQ1LnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRvckFkZHJlc3M6IGlzU2V0KGUyLmRlbGVnYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogaXNTZXQoZTIudmFsaWRhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIudmFsaWRhdG9yQWRkcmVzcykgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KGUyLmFtb3VudCkgPyBDb2luLmZyb21KU09OKGUyLmFtb3VudCkgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIChvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiAobzIudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiAobzIuYW1vdW50ID0gZTIuYW1vdW50ID8gQ29pbi50b0pTT04oZTIuYW1vdW50KSA6IHZvaWQgMCksIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSB2KCk7XG4gIHJldHVybiBvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi5hbW91bnQgPSB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBudWxsICE9PSBlMi5hbW91bnQgPyBDb2luLmZyb21QYXJ0aWFsKGUyLmFtb3VudCkgOiB2b2lkIDAsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IE1zZ0RlbGVnYXRlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gTXNnRGVsZWdhdGUuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ0RlbGVnYXRlXCIsIHZhbHVlOiBNc2dEZWxlZ2F0ZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBwKCkge1xuICByZXR1cm4geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JTcmNBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JEc3RBZGRyZXNzOiBcIlwiLCBhbW91bnQ6IENvaW4uZnJvbVBhcnRpYWwoe30pIH07XG59XG52YXIgTXNnQmVnaW5SZWRlbGVnYXRlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ0JlZ2luUmVkZWxlZ2F0ZVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzICYmIG8yLnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvclNyY0FkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JEc3RBZGRyZXNzICYmIG8yLnVpbnQzMigyNikuc3RyaW5nKGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBDb2luLmVuY29kZShlMi5hbW91bnQsIG8yLnVpbnQzMigzNCkuZm9yaygpKS5sZGVsaW0oKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgczIgPSB2b2lkIDAgPT09IG8yID8gdDUubGVuIDogdDUucG9zICsgbzI7XG4gIGNvbnN0IGkyID0gcCgpO1xuICBmb3IgKDsgdDUucG9zIDwgczI7ICkge1xuICAgIGNvbnN0IGUzID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5kZWxlZ2F0b3JBZGRyZXNzID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMi52YWxpZGF0b3JTcmNBZGRyZXNzID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBpMi52YWxpZGF0b3JEc3RBZGRyZXNzID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBpMi5hbW91bnQgPSBDb2luLmRlY29kZSh0NSwgdDUudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHQ1LnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRvckFkZHJlc3M6IGlzU2V0KGUyLmRlbGVnYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yU3JjQWRkcmVzczogaXNTZXQoZTIudmFsaWRhdG9yU3JjQWRkcmVzcykgPyBTdHJpbmcoZTIudmFsaWRhdG9yU3JjQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JEc3RBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSA6IFwiXCIsIGFtb3VudDogaXNTZXQoZTIuYW1vdW50KSA/IENvaW4uZnJvbUpTT04oZTIuYW1vdW50KSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgKG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzICYmIChvMi52YWxpZGF0b3JTcmNBZGRyZXNzID0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yRHN0QWRkcmVzcyAmJiAobzIudmFsaWRhdG9yRHN0QWRkcmVzcyA9IGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiAobzIuYW1vdW50ID0gZTIuYW1vdW50ID8gQ29pbi50b0pTT04oZTIuYW1vdW50KSA6IHZvaWQgMCksIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSBwKCk7XG4gIHJldHVybiBvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi52YWxpZGF0b3JTcmNBZGRyZXNzID0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyA/PyBcIlwiLCBvMi52YWxpZGF0b3JEc3RBZGRyZXNzID0gZTIudmFsaWRhdG9yRHN0QWRkcmVzcyA/PyBcIlwiLCBvMi5hbW91bnQgPSB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBudWxsICE9PSBlMi5hbW91bnQgPyBDb2luLmZyb21QYXJ0aWFsKGUyLmFtb3VudCkgOiB2b2lkIDAsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IE1zZ0JlZ2luUmVkZWxlZ2F0ZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IE1zZ0JlZ2luUmVkZWxlZ2F0ZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuTXNnQmVnaW5SZWRlbGVnYXRlXCIsIHZhbHVlOiBNc2dCZWdpblJlZGVsZWdhdGUuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gQTIoKSB7XG4gIHJldHVybiB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIGFtb3VudDogQ29pbi5mcm9tUGFydGlhbCh7fSkgfTtcbn1cbnZhciBNc2dVbmRlbGVnYXRlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ1VuZGVsZWdhdGVcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgXCJcIiAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTgpLnN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgQ29pbi5lbmNvZGUoZTIuYW1vdW50LCBvMi51aW50MzIoMjYpLmZvcmsoKSkubGRlbGltKCksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCB0NSA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IHMyID0gdm9pZCAwID09PSBvMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIG8yO1xuICBjb25zdCBpMiA9IEEyKCk7XG4gIGZvciAoOyB0NS5wb3MgPCBzMjsgKSB7XG4gICAgY29uc3QgZTMgPSB0NS51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkyLmRlbGVnYXRvckFkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkyLnZhbGlkYXRvckFkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGkyLmFtb3VudCA9IENvaW4uZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdDUuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSA6IFwiXCIsIGFtb3VudDogaXNTZXQoZTIuYW1vdW50KSA/IENvaW4uZnJvbUpTT04oZTIuYW1vdW50KSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgKG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIChvMi52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIuYW1vdW50ICYmIChvMi5hbW91bnQgPSBlMi5hbW91bnQgPyBDb2luLnRvSlNPTihlMi5hbW91bnQpIDogdm9pZCAwKSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IEEyKCk7XG4gIHJldHVybiBvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi5hbW91bnQgPSB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBudWxsICE9PSBlMi5hbW91bnQgPyBDb2luLmZyb21QYXJ0aWFsKGUyLmFtb3VudCkgOiB2b2lkIDAsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IE1zZ1VuZGVsZWdhdGUuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBNc2dVbmRlbGVnYXRlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dVbmRlbGVnYXRlXCIsIHZhbHVlOiBNc2dVbmRlbGVnYXRlLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIE0yKCkge1xuICByZXR1cm4geyBjb21wbGV0aW9uVGltZTogVGltZXN0YW1wLmZyb21QYXJ0aWFsKHt9KSwgYW1vdW50OiBDb2luLmZyb21QYXJ0aWFsKHt9KSB9O1xufVxudmFyIE1zZ1VuZGVsZWdhdGVSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dVbmRlbGVnYXRlUmVzcG9uc2VcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAodm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBUaW1lc3RhbXAuZW5jb2RlKGUyLmNvbXBsZXRpb25UaW1lLCBvMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIHZvaWQgMCAhPT0gZTIuYW1vdW50ICYmIENvaW4uZW5jb2RlKGUyLmFtb3VudCwgbzIudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCBvMiksIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgdDUgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBzMiA9IHZvaWQgMCA9PT0gbzIgPyB0NS5sZW4gOiB0NS5wb3MgKyBvMjtcbiAgY29uc3QgZCA9IE0yKCk7XG4gIGZvciAoOyB0NS5wb3MgPCBzMjsgKSB7XG4gICAgY29uc3QgZTMgPSB0NS51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGQuY29tcGxldGlvblRpbWUgPSBUaW1lc3RhbXAuZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBkLmFtb3VudCA9IENvaW4uZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdDUuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGQ7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBjb21wbGV0aW9uVGltZTogaXNTZXQoZTIuY29tcGxldGlvblRpbWUpID8gZnJvbUpzb25UaW1lc3RhbXAoZTIuY29tcGxldGlvblRpbWUpIDogdm9pZCAwLCBhbW91bnQ6IGlzU2V0KGUyLmFtb3VudCkgPyBDb2luLmZyb21KU09OKGUyLmFtb3VudCkgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiAobzIuY29tcGxldGlvblRpbWUgPSBmcm9tVGltZXN0YW1wKGUyLmNvbXBsZXRpb25UaW1lKS50b0lTT1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgKG8yLmFtb3VudCA9IGUyLmFtb3VudCA/IENvaW4udG9KU09OKGUyLmFtb3VudCkgOiB2b2lkIDApLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0gTTIoKTtcbiAgcmV0dXJuIG8yLmNvbXBsZXRpb25UaW1lID0gdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBudWxsICE9PSBlMi5jb21wbGV0aW9uVGltZSA/IFRpbWVzdGFtcC5mcm9tUGFydGlhbChlMi5jb21wbGV0aW9uVGltZSkgOiB2b2lkIDAsIG8yLmFtb3VudCA9IHZvaWQgMCAhPT0gZTIuYW1vdW50ICYmIG51bGwgIT09IGUyLmFtb3VudCA/IENvaW4uZnJvbVBhcnRpYWwoZTIuYW1vdW50KSA6IHZvaWQgMCwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gTXNnVW5kZWxlZ2F0ZVJlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gTXNnVW5kZWxlZ2F0ZVJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dVbmRlbGVnYXRlUmVzcG9uc2VcIiwgdmFsdWU6IE1zZ1VuZGVsZWdhdGVSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG5mdW5jdGlvbiByNSgpIHtcbiAgcmV0dXJuIHsgcmV2aXNpb25OdW1iZXI6IEJpZ0ludCgwKSwgcmV2aXNpb25IZWlnaHQ6IEJpZ0ludCgwKSB9O1xufVxudmFyIEhlaWdodCA9IHsgdHlwZVVybDogXCIvaWJjLmNvcmUuY2xpZW50LnYxLkhlaWdodFwiLCBlbmNvZGU6ICh0NSwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICh0NS5yZXZpc2lvbk51bWJlciAhPT0gQmlnSW50KDApICYmIGUyLnVpbnQzMig4KS51aW50NjQodDUucmV2aXNpb25OdW1iZXIpLCB0NS5yZXZpc2lvbkhlaWdodCAhPT0gQmlnSW50KDApICYmIGUyLnVpbnQzMigxNikudWludDY0KHQ1LnJldmlzaW9uSGVpZ2h0KSwgZTIpLCBkZWNvZGUodDUsIGUyKSB7XG4gIGNvbnN0IG4yID0gdDUgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyB0NSA6IG5ldyBCaW5hcnlSZWFkZXIodDUpO1xuICBsZXQgbzIgPSB2b2lkIDAgPT09IGUyID8gbjIubGVuIDogbjIucG9zICsgZTI7XG4gIGNvbnN0IHMyID0gcjUoKTtcbiAgZm9yICg7IG4yLnBvcyA8IG8yOyApIHtcbiAgICBjb25zdCB0NiA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAodDYgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczIucmV2aXNpb25OdW1iZXIgPSBuMi51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHMyLnJldmlzaW9uSGVpZ2h0ID0gbjIudWludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIHQ2KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHMyO1xufSwgZnJvbUpTT046ICh0NSkgPT4gKHsgcmV2aXNpb25OdW1iZXI6IGlzU2V0KHQ1LnJldmlzaW9uTnVtYmVyKSA/IEJpZ0ludCh0NS5yZXZpc2lvbk51bWJlci50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgcmV2aXNpb25IZWlnaHQ6IGlzU2V0KHQ1LnJldmlzaW9uSGVpZ2h0KSA/IEJpZ0ludCh0NS5yZXZpc2lvbkhlaWdodC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSB9KSwgdG9KU09OKHQ1KSB7XG4gIGNvbnN0IGUyID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IHQ1LnJldmlzaW9uTnVtYmVyICYmIChlMi5yZXZpc2lvbk51bWJlciA9ICh0NS5yZXZpc2lvbk51bWJlciB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IHQ1LnJldmlzaW9uSGVpZ2h0ICYmIChlMi5yZXZpc2lvbkhlaWdodCA9ICh0NS5yZXZpc2lvbkhlaWdodCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCBlMjtcbn0sIGZyb21QYXJ0aWFsKHQ1KSB7XG4gIGNvbnN0IGUyID0gcjUoKTtcbiAgcmV0dXJuIGUyLnJldmlzaW9uTnVtYmVyID0gdm9pZCAwICE9PSB0NS5yZXZpc2lvbk51bWJlciAmJiBudWxsICE9PSB0NS5yZXZpc2lvbk51bWJlciA/IEJpZ0ludCh0NS5yZXZpc2lvbk51bWJlci50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgZTIucmV2aXNpb25IZWlnaHQgPSB2b2lkIDAgIT09IHQ1LnJldmlzaW9uSGVpZ2h0ICYmIG51bGwgIT09IHQ1LnJldmlzaW9uSGVpZ2h0ID8gQmlnSW50KHQ1LnJldmlzaW9uSGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKHQ1KSA9PiBIZWlnaHQuZGVjb2RlKHQ1LnZhbHVlKSwgdG9Qcm90bzogKHQ1KSA9PiBIZWlnaHQuZW5jb2RlKHQ1KS5maW5pc2goKSwgdG9Qcm90b01zZzogKHQ1KSA9PiAoeyB0eXBlVXJsOiBcIi9pYmMuY29yZS5jbGllbnQudjEuSGVpZ2h0XCIsIHZhbHVlOiBIZWlnaHQuZW5jb2RlKHQ1KS5maW5pc2goKSB9KSB9O1xuXG4vL1xuZnVuY3Rpb24gaSgpIHtcbiAgcmV0dXJuIHsgc291cmNlUG9ydDogXCJcIiwgc291cmNlQ2hhbm5lbDogXCJcIiwgdG9rZW46IENvaW4uZnJvbVBhcnRpYWwoe30pLCBzZW5kZXI6IFwiXCIsIHJlY2VpdmVyOiBcIlwiLCB0aW1lb3V0SGVpZ2h0OiBIZWlnaHQuZnJvbVBhcnRpYWwoe30pLCB0aW1lb3V0VGltZXN0YW1wOiBCaWdJbnQoMCksIG1lbW86IFwiXCIgfTtcbn1cbnZhciBNc2dUcmFuc2ZlciA9IHsgdHlwZVVybDogXCIvaWJjLmFwcGxpY2F0aW9ucy50cmFuc2Zlci52MS5Nc2dUcmFuc2ZlclwiLCBlbmNvZGU6IChvMiwgcjYgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBvMi5zb3VyY2VQb3J0ICYmIHI2LnVpbnQzMigxMCkuc3RyaW5nKG8yLnNvdXJjZVBvcnQpLCBcIlwiICE9PSBvMi5zb3VyY2VDaGFubmVsICYmIHI2LnVpbnQzMigxOCkuc3RyaW5nKG8yLnNvdXJjZUNoYW5uZWwpLCB2b2lkIDAgIT09IG8yLnRva2VuICYmIENvaW4uZW5jb2RlKG8yLnRva2VuLCByNi51aW50MzIoMjYpLmZvcmsoKSkubGRlbGltKCksIFwiXCIgIT09IG8yLnNlbmRlciAmJiByNi51aW50MzIoMzQpLnN0cmluZyhvMi5zZW5kZXIpLCBcIlwiICE9PSBvMi5yZWNlaXZlciAmJiByNi51aW50MzIoNDIpLnN0cmluZyhvMi5yZWNlaXZlciksIHZvaWQgMCAhPT0gbzIudGltZW91dEhlaWdodCAmJiBIZWlnaHQuZW5jb2RlKG8yLnRpbWVvdXRIZWlnaHQsIHI2LnVpbnQzMig1MCkuZm9yaygpKS5sZGVsaW0oKSwgbzIudGltZW91dFRpbWVzdGFtcCAhPT0gQmlnSW50KDApICYmIHI2LnVpbnQzMig1NikudWludDY0KG8yLnRpbWVvdXRUaW1lc3RhbXApLCBcIlwiICE9PSBvMi5tZW1vICYmIHI2LnVpbnQzMig2Nikuc3RyaW5nKG8yLm1lbW8pLCByNiksIGRlY29kZShvMiwgczIpIHtcbiAgY29uc3QgbjIgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCBhMiA9IHZvaWQgMCA9PT0gczIgPyBuMi5sZW4gOiBuMi5wb3MgKyBzMjtcbiAgY29uc3QgbTIgPSBpKCk7XG4gIGZvciAoOyBuMi5wb3MgPCBhMjsgKSB7XG4gICAgY29uc3QgbzMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG8zID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIG0yLnNvdXJjZVBvcnQgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIG0yLnNvdXJjZUNoYW5uZWwgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIG0yLnRva2VuID0gQ29pbi5kZWNvZGUobjIsIG4yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIG0yLnNlbmRlciA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgbTIucmVjZWl2ZXIgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDY6XG4gICAgICAgIG0yLnRpbWVvdXRIZWlnaHQgPSBIZWlnaHQuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA3OlxuICAgICAgICBtMi50aW1lb3V0VGltZXN0YW1wID0gbjIudWludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA4OlxuICAgICAgICBtMi5tZW1vID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG0yO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgc291cmNlUG9ydDogaXNTZXQobzIuc291cmNlUG9ydCkgPyBTdHJpbmcobzIuc291cmNlUG9ydCkgOiBcIlwiLCBzb3VyY2VDaGFubmVsOiBpc1NldChvMi5zb3VyY2VDaGFubmVsKSA/IFN0cmluZyhvMi5zb3VyY2VDaGFubmVsKSA6IFwiXCIsIHRva2VuOiBpc1NldChvMi50b2tlbikgPyBDb2luLmZyb21KU09OKG8yLnRva2VuKSA6IHZvaWQgMCwgc2VuZGVyOiBpc1NldChvMi5zZW5kZXIpID8gU3RyaW5nKG8yLnNlbmRlcikgOiBcIlwiLCByZWNlaXZlcjogaXNTZXQobzIucmVjZWl2ZXIpID8gU3RyaW5nKG8yLnJlY2VpdmVyKSA6IFwiXCIsIHRpbWVvdXRIZWlnaHQ6IGlzU2V0KG8yLnRpbWVvdXRIZWlnaHQpID8gSGVpZ2h0LmZyb21KU09OKG8yLnRpbWVvdXRIZWlnaHQpIDogdm9pZCAwLCB0aW1lb3V0VGltZXN0YW1wOiBpc1NldChvMi50aW1lb3V0VGltZXN0YW1wKSA/IEJpZ0ludChvMi50aW1lb3V0VGltZXN0YW1wLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBtZW1vOiBpc1NldChvMi5tZW1vKSA/IFN0cmluZyhvMi5tZW1vKSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCByNiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5zb3VyY2VQb3J0ICYmIChyNi5zb3VyY2VQb3J0ID0gbzIuc291cmNlUG9ydCksIHZvaWQgMCAhPT0gbzIuc291cmNlQ2hhbm5lbCAmJiAocjYuc291cmNlQ2hhbm5lbCA9IG8yLnNvdXJjZUNoYW5uZWwpLCB2b2lkIDAgIT09IG8yLnRva2VuICYmIChyNi50b2tlbiA9IG8yLnRva2VuID8gQ29pbi50b0pTT04obzIudG9rZW4pIDogdm9pZCAwKSwgdm9pZCAwICE9PSBvMi5zZW5kZXIgJiYgKHI2LnNlbmRlciA9IG8yLnNlbmRlciksIHZvaWQgMCAhPT0gbzIucmVjZWl2ZXIgJiYgKHI2LnJlY2VpdmVyID0gbzIucmVjZWl2ZXIpLCB2b2lkIDAgIT09IG8yLnRpbWVvdXRIZWlnaHQgJiYgKHI2LnRpbWVvdXRIZWlnaHQgPSBvMi50aW1lb3V0SGVpZ2h0ID8gSGVpZ2h0LnRvSlNPTihvMi50aW1lb3V0SGVpZ2h0KSA6IHZvaWQgMCksIHZvaWQgMCAhPT0gbzIudGltZW91dFRpbWVzdGFtcCAmJiAocjYudGltZW91dFRpbWVzdGFtcCA9IChvMi50aW1lb3V0VGltZXN0YW1wIHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gbzIubWVtbyAmJiAocjYubWVtbyA9IG8yLm1lbW8pLCByNjtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHI2ID0gaSgpO1xuICByZXR1cm4gcjYuc291cmNlUG9ydCA9IG8yLnNvdXJjZVBvcnQgPz8gXCJcIiwgcjYuc291cmNlQ2hhbm5lbCA9IG8yLnNvdXJjZUNoYW5uZWwgPz8gXCJcIiwgcjYudG9rZW4gPSB2b2lkIDAgIT09IG8yLnRva2VuICYmIG51bGwgIT09IG8yLnRva2VuID8gQ29pbi5mcm9tUGFydGlhbChvMi50b2tlbikgOiB2b2lkIDAsIHI2LnNlbmRlciA9IG8yLnNlbmRlciA/PyBcIlwiLCByNi5yZWNlaXZlciA9IG8yLnJlY2VpdmVyID8/IFwiXCIsIHI2LnRpbWVvdXRIZWlnaHQgPSB2b2lkIDAgIT09IG8yLnRpbWVvdXRIZWlnaHQgJiYgbnVsbCAhPT0gbzIudGltZW91dEhlaWdodCA/IEhlaWdodC5mcm9tUGFydGlhbChvMi50aW1lb3V0SGVpZ2h0KSA6IHZvaWQgMCwgcjYudGltZW91dFRpbWVzdGFtcCA9IHZvaWQgMCAhPT0gbzIudGltZW91dFRpbWVzdGFtcCAmJiBudWxsICE9PSBvMi50aW1lb3V0VGltZXN0YW1wID8gQmlnSW50KG8yLnRpbWVvdXRUaW1lc3RhbXAudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIHI2Lm1lbW8gPSBvMi5tZW1vID8/IFwiXCIsIHI2O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IE1zZ1RyYW5zZmVyLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gTXNnVHJhbnNmZXIuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9pYmMuYXBwbGljYXRpb25zLnRyYW5zZmVyLnYxLk1zZ1RyYW5zZmVyXCIsIHZhbHVlOiBNc2dUcmFuc2Zlci5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgQnJpZGdlSWQyID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgQkFOSzogXCJiYW5rXCIsXG4gICAgQ09SRTogXCJjb3JlXCIsXG4gICAgRElCQzogXCJkaWJjXCIsXG4gICAgU1RPUkFHRTogXCJzdG9yYWdlXCIsXG4gICAgUFJPVklTSU9OOiBcInByb3Zpc2lvblwiLFxuICAgIFBST1ZJU0lPTl9TTUFSVF9XQUxMRVQ6IFwicHJvdmlzaW9uV2FsbGV0XCIsXG4gICAgVkxPQ0FMQ0hBSU46IFwidmxvY2FsY2hhaW5cIixcbiAgICBWVFJBTlNGRVI6IFwidnRyYW5zZmVyXCIsXG4gICAgV0FMTEVUOiBcIndhbGxldFwiXG4gIH1cbik7XG5oYXJkZW4oQnJpZGdlSWQyKTtcbnZhciBDb3Ntb3NJbml0S2V5VG9CcmlkZ2VJZDIgPSB7XG4gIHZiYW5rUG9ydDogXCJiYW5rXCIsXG4gIHZpYmNQb3J0OiBcImRpYmNcIlxufTtcbmhhcmRlbihDb3Ntb3NJbml0S2V5VG9CcmlkZ2VJZDIpO1xudmFyIFdhbGxldE5hbWUyID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgZGVwb3NpdEZhY2V0OiBcImRlcG9zaXRGYWNldFwiXG4gIH1cbik7XG5oYXJkZW4oV2FsbGV0TmFtZTIpO1xudmFyIFZCYW5rQWNjb3VudDIgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICByZXNlcnZlOiB7XG4gICAgICBtb2R1bGU6IFwidmJhbmsvcmVzZXJ2ZVwiLFxuICAgICAgYWRkcmVzczogXCJhZ29yaWMxYWUwbG10emxncmNubGE5eGprcGFhcnE1ZDVkZmV6NjNoM251Y2xcIlxuICAgIH0sXG4gICAgcHJvdmlzaW9uOiB7XG4gICAgICBtb2R1bGU6IFwidmJhbmsvcHJvdmlzaW9uXCIsXG4gICAgICBhZGRyZXNzOiBcImFnb3JpYzFtZWd6eXRnNjVjeXJnenM2ZnZ6eGdyY3F2d3dsN3VncHQ2MjM0NlwiXG4gICAgfVxuICB9XG4pO1xuaGFyZGVuKFZCYW5rQWNjb3VudDIpO1xuXG4vL1xudmFyIGRlYnVnSW5zdGFuY2UyID0gMTtcbnZhciBtYWtlVHJhY2VyMiA9IChuYW1lLCBlbmFibGUgPSB0cnVlKSA9PiB7XG4gIGRlYnVnSW5zdGFuY2UyICs9IDE7XG4gIGxldCBkZWJ1Z0NvdW50ID0gMTtcbiAgY29uc3Qga2V5ID0gYC0tLS0tICR7bmFtZX0uJHtkZWJ1Z0luc3RhbmNlMn0gYDtcbiAgc3dpdGNoIChlbmFibGUpIHtcbiAgICBjYXNlIGZhbHNlOiB7XG4gICAgICBjb25zdCBsb2dEaXNhYmxlZCA9ICguLi5fYXJncykgPT4ge1xuICAgICAgfTtcbiAgICAgIHJldHVybiBsb2dEaXNhYmxlZDtcbiAgICB9XG4gICAgY2FzZSBcInZlcmJvc2VcIjoge1xuICAgICAgY29uc3QgaW5mb1RpY2sgPSAob3B0TG9nLCAuLi5hcmdzKSA9PiB7XG4gICAgICAgIGlmIChvcHRMb2cubG9nKSB7XG4gICAgICAgICAgY29uc29sZS5pbmZvKGtleSwgZGVidWdDb3VudCArPSAxLCAuLi5hcmdzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmluZm8oa2V5LCBkZWJ1Z0NvdW50ICs9IDEsIG9wdExvZywgLi4uYXJncyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4gaW5mb1RpY2s7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIGNvbnN0IGRlYnVnVGljayA9IChvcHRMb2csIC4uLmFyZ3MpID0+IHtcbiAgICAgICAgaWYgKG9wdExvZy5sb2cpIHtcbiAgICAgICAgICBvcHRMb2cubG9nKGtleSwgZGVidWdDb3VudCArPSAxLCAuLi5hcmdzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmluZm8oa2V5LCBkZWJ1Z0NvdW50ICs9IDEsIG9wdExvZywgLi4uYXJncyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4gZGVidWdUaWNrO1xuICAgIH1cbiAgfVxufTtcbmhhcmRlbihtYWtlVHJhY2VyMik7XG5cbi8vXG52YXIgTm9uTnVsbGlzaDIgPSAodmFsLCBvcHREZXRhaWxzID0gYHVuZXhwZWN0ZWQgJHtxdW90ZSh2YWwpfWApID0+IHtcbiAgaWYgKHZhbCAhPSBudWxsKSB7XG4gICAgcmV0dXJuIHZhbDtcbiAgfVxuICBhc3NlcnQuZmFpbChvcHREZXRhaWxzKTtcbn07XG5oYXJkZW4oTm9uTnVsbGlzaDIpO1xuXG4vL1xudmFyIHsgZGVmaW5lUHJvcGVydHk6IGRlZmluZVByb3BlcnR5NCB9ID0gT2JqZWN0O1xudmFyIHR5cGVkRW50cmllcyA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICovXG4gIE9iamVjdC5lbnRyaWVzXG4pO1xudmFyIGZyb21UeXBlZEVudHJpZXMgPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgT2JqZWN0LmZyb21FbnRyaWVzXG4pO1xudmFyIHR5cGVkTWFwMyA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgKi9cbiAgRnVuY3Rpb24ucHJvdG90eXBlLmNhbGwuYmluZChBcnJheS5wcm90b3R5cGUubWFwKVxuKTtcbnZhciBsb2dMZXZlbHMzID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBbXG4gICAgXCJkZWJ1Z1wiLFxuICAgIFwibG9nXCIsXG4gICAgXCJpbmZvXCIsXG4gICAgXCJ3YXJuXCIsXG4gICAgXCJlcnJvclwiXG4gIF1cbik7XG5PYmplY3QuZnJlZXplKGxvZ0xldmVsczMpO1xudmFyIGRlZXBNYXBPYmplY3RJbnRlcm5hbCA9ICh2YWx1ZSwgbmFtZSwgY29udGFpbmVyLCBtYXBwZXIpID0+IHtcbiAgaWYgKGNvbnRhaW5lciAmJiB0eXBlb2YgbmFtZSA9PT0gXCJzdHJpbmdcIikge1xuICAgIGNvbnN0IG1hcHBlZCA9IG1hcHBlcih2YWx1ZSwgbmFtZSwgY29udGFpbmVyKTtcbiAgICBpZiAobWFwcGVkICE9PSB2YWx1ZSkge1xuICAgICAgcmV0dXJuIG1hcHBlZDtcbiAgICB9XG4gIH1cbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJvYmplY3RcIiB8fCAhdmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgbGV0IHdhc01hcHBlZCA9IGZhbHNlO1xuICBjb25zdCB2YWx1ZU9iaiA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHZhbHVlXG4gICk7XG4gIGNvbnN0IG1hcEVudHJ5ID0gKFtpbm5lck5hbWUsIGlubmVyVmFsdWVdKSA9PiB7XG4gICAgY29uc3QgbWFwcGVkSW5uZXJWYWx1ZSA9IGRlZXBNYXBPYmplY3RJbnRlcm5hbChcbiAgICAgIGlubmVyVmFsdWUsXG4gICAgICBpbm5lck5hbWUsXG4gICAgICB2YWx1ZU9iaixcbiAgICAgIG1hcHBlclxuICAgICk7XG4gICAgd2FzTWFwcGVkIHx8PSBtYXBwZWRJbm5lclZhbHVlICE9PSBpbm5lclZhbHVlO1xuICAgIHJldHVybiBbXG4gICAgICBpbm5lck5hbWUsXG4gICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgIG1hcHBlZElubmVyVmFsdWVcbiAgICBdO1xuICB9O1xuICBjb25zdCBtYXBwZWRFbnRyaWVzID0gdHlwZWRFbnRyaWVzKHZhbHVlT2JqKS5tYXAobWFwRW50cnkpO1xuICBpZiAoIXdhc01hcHBlZCkge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICBjb25zdCBtYXBwZWRPYmogPSBmcm9tVHlwZWRFbnRyaWVzKG1hcHBlZEVudHJpZXMpO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAqL1xuICAgIG1hcHBlZE9ialxuICApO1xufTtcbnZhciBkZWVwTWFwT2JqZWN0ID0gKG9iaiwgbWFwcGVyKSA9PiAoXG4gIC8qICAgICAgICAgICAgICAqL1xuICBkZWVwTWFwT2JqZWN0SW50ZXJuYWwob2JqLCB2b2lkIDAsIHZvaWQgMCwgbWFwcGVyKVxuKTtcblxuLy9cbnZhciB7IGZyb21FbnRyaWVzOiBmcm9tRW50cmllczE1IH0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiByYXdPd25LZXlzMiB9ID0gUmVmbGVjdDtcbnZhciBvd25LZXlzMjMgPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gIHJhd093bktleXMyXG4pO1xudmFyIGlzUHJvcGVydHlLZXkyID0gKGtleSkgPT4ge1xuICBzd2l0Y2ggKHR5cGVvZiBrZXkpIHtcbiAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgY2FzZSBcIm51bWJlclwiOlxuICAgIGNhc2UgXCJzeW1ib2xcIjpcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG52YXIgY2FsbFN5bmMyID0gKGNhbGxiYWNrLCAuLi5hcmdzKSA9PiB7XG4gIGNvbnN0IHsgdGFyZ2V0LCBtZXRob2ROYW1lLCBib3VuZCB9ID0gY2FsbGJhY2s7XG4gIGlmIChtZXRob2ROYW1lID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdGFyZ2V0KC4uLmJvdW5kLCAuLi5hcmdzKTtcbiAgfVxuICByZXR1cm4gdGFyZ2V0W21ldGhvZE5hbWVdKC4uLmJvdW5kLCAuLi5hcmdzKTtcbn07XG5oYXJkZW4oY2FsbFN5bmMyKTtcbnZhciBjYWxsRTIgPSAoY2FsbGJhY2ssIC4uLmFyZ3MpID0+IHtcbiAgY29uc3QgeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kIH0gPSBjYWxsYmFjaztcbiAgaWYgKG1ldGhvZE5hbWUgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiBFKHRhcmdldCkoLi4uYm91bmQsIC4uLmFyZ3MpO1xuICB9XG4gIHJldHVybiBFKHRhcmdldClbbWV0aG9kTmFtZV0oLi4uYm91bmQsIC4uLmFyZ3MpO1xufTtcbmhhcmRlbihjYWxsRTIpO1xudmFyIG1ha2VTeW5jRnVuY3Rpb25DYWxsYmFjazIgPSAodGFyZ2V0LCAuLi5ib3VuZCkgPT4ge1xuICB0eXBlb2YgdGFyZ2V0ID09PSBcImZ1bmN0aW9uXCIgfHwgdGhyb3dSZWRhY3RlZGBzeW5jIGZ1bmN0aW9uIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGEgZnVuY3Rpb246ICR7dGFyZ2V0fWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBib3VuZCwgaXNTeW5jOiB0cnVlIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VTeW5jRnVuY3Rpb25DYWxsYmFjazIpO1xudmFyIG1ha2VGdW5jdGlvbkNhbGxiYWNrMiA9ICh0YXJnZXQsIC4uLmJvdW5kKSA9PiB7XG4gICFpc1ByaW1pdGl2ZTIodGFyZ2V0KSB8fCB0aHJvd1JlZGFjdGVkYGZ1bmN0aW9uIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGEgZnVuY3Rpb24gcHJlc2VuY2U6ICR7dGFyZ2V0fWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBib3VuZCB9KTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VGdW5jdGlvbkNhbGxiYWNrMik7XG52YXIgbWFrZVN5bmNNZXRob2RDYWxsYmFjazIgPSAodGFyZ2V0LCBtZXRob2ROYW1lLCAuLi5ib3VuZCkgPT4ge1xuICAhaXNQcmltaXRpdmUyKHRhcmdldCkgfHwgdGhyb3dSZWRhY3RlZGBzeW5jIG1ldGhvZCBjYWxsYmFjayB0YXJnZXQgbXVzdCBiZSBhbiBvYmplY3Q6ICR7dGFyZ2V0fWA7XG4gIHR5cGVvZiBtZXRob2ROYW1lID09PSBcInN0cmluZ1wiIHx8IGlzUGFzc2FibGVTeW1ib2wobWV0aG9kTmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBtZXRob2QgbmFtZSBtdXN0IGJlIGEgc3RyaW5nIG9yIHBhc3NhYmxlIHN5bWJvbDogJHttZXRob2ROYW1lfWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBtZXRob2ROYW1lLCBib3VuZCwgaXNTeW5jOiB0cnVlIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VTeW5jTWV0aG9kQ2FsbGJhY2syKTtcbnZhciBtYWtlTWV0aG9kQ2FsbGJhY2syID0gKHRhcmdldCwgbWV0aG9kTmFtZSwgLi4uYm91bmQpID0+IHtcbiAgIWlzUHJpbWl0aXZlMih0YXJnZXQpIHx8IHRocm93UmVkYWN0ZWRgbWV0aG9kIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGFuIG9iamVjdDogJHt0YXJnZXR9YDtcbiAgdHlwZW9mIG1ldGhvZE5hbWUgPT09IFwic3RyaW5nXCIgfHwgaXNQYXNzYWJsZVN5bWJvbChtZXRob2ROYW1lKSB8fCB0aHJvd1JlZGFjdGVkYG1ldGhvZCBuYW1lIG11c3QgYmUgYSBzdHJpbmcgb3IgcGFzc2FibGUgc3ltYm9sOiAke21ldGhvZE5hbWV9YDtcbiAgY29uc3QgY2IgPSBoYXJkZW4oeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgY2JcbiAgKTtcbn07XG5oYXJkZW4obWFrZU1ldGhvZENhbGxiYWNrMik7XG52YXIgaXNDYWxsYmFjazIgPSAoY2FsbGJhY2spID0+IHtcbiAgaWYgKGlzUHJpbWl0aXZlMihjYWxsYmFjaykpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3QgeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kIH0gPSBjYWxsYmFjaztcbiAgcmV0dXJuICFpc1ByaW1pdGl2ZTIodGFyZ2V0KSAmJiAobWV0aG9kTmFtZSA9PT0gdm9pZCAwIHx8IHR5cGVvZiBtZXRob2ROYW1lID09PSBcInN0cmluZ1wiIHx8IGlzUGFzc2FibGVTeW1ib2wobWV0aG9kTmFtZSkpICYmIEFycmF5LmlzQXJyYXkoYm91bmQpO1xufTtcbmhhcmRlbihpc0NhbGxiYWNrMik7XG52YXIgcHJlcGFyZUF0dGVudWF0b3IyID0gKHpvbmUsIG1ldGhvZE5hbWVzLCB7IGludGVyZmFjZUd1YXJkLCB0YWcgPSBcIkF0dGVudWF0b3JcIiB9ID0ge30pID0+IHtcbiAgY29uc3QgbWV0aG9kcyA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgZnJvbUVudHJpZXMxNShcbiAgICAgIG1ldGhvZE5hbWVzLm1hcCgoa2V5KSA9PiB7XG4gICAgICAgIGlmICghaXNQcm9wZXJ0eUtleTIoa2V5KSkge1xuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRga2V5ICR7cXVvdGUoa2V5KX0gaXMgbm90IGEgUHJvcGVydHlLZXlgO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG0yID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICB7XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgW2tleV0oLi4uYXJncykge1xuICAgICAgICAgICAgICBjb25zdCBjYiA9IHRoaXMuc3RhdGUuY2JzW2tleV07XG4gICAgICAgICAgICAgIGlmICghY2IpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnIgPSBtYWtlRXJyb3IoYHVuaW1wbGVtZW50ZWQgJHtxdW90ZSh0YWcpfSBtZXRob2QgJHtxdW90ZShrZXkpfWApO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmlzU3luYykge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoY2IuaXNTeW5jKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxTeW5jMihjYiwgLi4uYXJncyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxFMihjYiwgLi4uYXJncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVtrZXldXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBba2V5LCBtMl1cbiAgICAgICAgKTtcbiAgICAgIH0pXG4gICAgKVxuICApO1xuICBjb25zdCBtYWtlQXR0ZW51YXRvciA9IHpvbmUuZXhvQ2xhc3MoXG4gICAgdGFnLFxuICAgIGludGVyZmFjZUd1YXJkLFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICAoe1xuICAgICAgdGFyZ2V0ID0gbnVsbCxcbiAgICAgIGlzU3luYyA9IGZhbHNlLFxuICAgICAgb3ZlcnJpZGVzID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAge31cbiAgICAgIClcbiAgICB9KSA9PiB7XG4gICAgICBjb25zdCBjYnMgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB7fVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHJlbWFpbmluZyA9IG5ldyBTZXQobWV0aG9kTmFtZXMpO1xuICAgICAgZm9yIChjb25zdCBrZXkgb2Ygb3duS2V5czIzKG92ZXJyaWRlcykpIHtcbiAgICAgICAgcmVtYWluaW5nLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBvdmVycmlkZXNbJHtxdW90ZShrZXkpfV0gbm90IGFsbG93ZWQgYnkgbWV0aG9kTmFtZXNgO1xuICAgICAgICByZW1haW5pbmcuZGVsZXRlKGtleSk7XG4gICAgICAgIGNvbnN0IGNiID0gb3ZlcnJpZGVzW2tleV07XG4gICAgICAgIGNiID09IG51bGwgfHwgaXNDYWxsYmFjazIoY2IpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBvdmVycmlkZXNbJHtxdW90ZShrZXkpfV0gaXMgbm90IGEgY2FsbGJhY2s7IGdvdCAke2NifWA7XG4gICAgICAgIGNic1trZXldID0gY2I7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiByZW1haW5pbmcpIHtcbiAgICAgICAgaWYgKGlzU3luYykge1xuICAgICAgICAgIGNic1trZXldID0gbWFrZVN5bmNNZXRob2RDYWxsYmFjazIodGFyZ2V0LCBrZXkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNic1trZXldID0gbWFrZU1ldGhvZENhbGxiYWNrMih0YXJnZXQsIGtleSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBoYXJkZW4oeyBjYnMsIGlzU3luYyB9KTtcbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICBtZXRob2RzXG4gICk7XG4gIHJldHVybiBtYWtlQXR0ZW51YXRvcjtcbn07XG5oYXJkZW4ocHJlcGFyZUF0dGVudWF0b3IyKTtcbnZhciBwcmVwYXJlR3VhcmRlZEF0dGVudWF0b3IyID0gKHpvbmUsIGludGVyZmFjZUd1YXJkLCBvcHRzID0ge30pID0+IHtcbiAgY29uc3QgbWV0aG9kTmFtZXMgPSBnZXRJbnRlcmZhY2VNZXRob2RLZXlzKGludGVyZmFjZUd1YXJkKTtcbiAgY29uc3QgbWFrZUF0dGVudWF0b3IgPSBwcmVwYXJlQXR0ZW51YXRvcjIoem9uZSwgbWV0aG9kTmFtZXMsIHtcbiAgICAuLi5vcHRzLFxuICAgIGludGVyZmFjZUd1YXJkXG4gIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBtYWtlQXR0ZW51YXRvclxuICApO1xufTtcbmhhcmRlbihwcmVwYXJlR3VhcmRlZEF0dGVudWF0b3IyKTtcblxuLy9cbnZhciBTdHJlYW1DZWxsU2hhcGUyID0gaGFyZGVuKHtcbiAgYmxvY2tIZWlnaHQ6IE0uc3RyaW5nKCksXG4gIHZhbHVlczogTS5hcnJheSgpXG59KTtcbnZhciBDaGFpblN0b3JhZ2VOb2RlSTIgPSBNLmludGVyZmFjZShcIlN0b3JhZ2VOb2RlXCIsIHtcbiAgc2V0VmFsdWU6IE0uY2FsbFdoZW4oTS5zdHJpbmcoKSkucmV0dXJucygpLFxuICBnZXRQYXRoOiBNLmNhbGwoKS5yZXR1cm5zKE0uc3RyaW5nKCkpLFxuICBnZXRTdG9yZUtleTogTS5jYWxsV2hlbigpLnJldHVybnMoTS5yZWNvcmQoKSksXG4gIG1ha2VDaGlsZE5vZGU6IE0uY2FsbChNLnN0cmluZygpKS5vcHRpb25hbChNLnNwbGl0UmVjb3JkKHt9LCB7IHNlcXVlbmNlOiBNLmJvb2xlYW4oKSB9LCB7fSkpLnJldHVybnMoTS5yZW1vdGFibGUoXCJTdG9yYWdlTm9kZVwiKSlcbn0pO1xudmFyIGlzU3RyZWFtQ2VsbDIgPSAoY2VsbCkgPT4gY2VsbCAmJiB0eXBlb2YgY2VsbCA9PT0gXCJvYmplY3RcIiAmJiBBcnJheS5pc0FycmF5KGNlbGwudmFsdWVzKSAmJiB0eXBlb2YgY2VsbC5ibG9ja0hlaWdodCA9PT0gXCJzdHJpbmdcIiAmJiAvXjAkfF5bMS05XVswLTldKiQvLnRlc3QoY2VsbC5ibG9ja0hlaWdodCk7XG5oYXJkZW4oaXNTdHJlYW1DZWxsMik7XG52YXIgcGF0aFNlZ21lbnRQYXR0ZXJuMiA9IC9eW2EtekEtWjAtOV8tXXsxLDEwMH0kLztcbnZhciBhc3NlcnRQYXRoU2VnbWVudDIgPSAobmFtZSkgPT4ge1xuICBwYXRoU2VnbWVudFBhdHRlcm4yLnRlc3QobmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBQYXRoIHNlZ21lbnQgbmFtZXMgbXVzdCBjb25zaXN0IG9mIDEgdG8gMTAwIGNoYXJhY3RlcnMgbGltaXRlZCB0byBBU0NJSSBhbHBoYW51bWVyaWNzLCB1bmRlcnNjb3JlcywgYW5kL29yIGRhc2hlczogJHtuYW1lfWA7XG59O1xuaGFyZGVuKGFzc2VydFBhdGhTZWdtZW50Mik7XG52YXIgcHJlcGFyZUNoYWluU3RvcmFnZU5vZGUyID0gKHpvbmUpID0+IHtcbiAgY29uc3QgbWFrZUNoYWluU3RvcmFnZU5vZGUgPSB6b25lLmV4b0NsYXNzKFxuICAgIFwiQ2hhaW5TdG9yYWdlTm9kZVwiLFxuICAgIENoYWluU3RvcmFnZU5vZGVJMixcbiAgICAvKlxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIChtZXNzZW5nZXIsIHBhdGgsIHsgc2VxdWVuY2UgPSBmYWxzZSB9ID0ge30pID0+IHtcbiAgICAgIGFzc2VydC50eXBlb2YocGF0aCwgXCJzdHJpbmdcIik7XG4gICAgICBhc3NlcnQudHlwZW9mKHNlcXVlbmNlLCBcImJvb2xlYW5cIik7XG4gICAgICByZXR1cm4gaGFyZGVuKHsgcGF0aCwgbWVzc2VuZ2VyLCBzZXF1ZW5jZSB9KTtcbiAgICB9LFxuICAgIHtcbiAgICAgIGdldFBhdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnBhdGg7XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIGFzeW5jIGdldFN0b3JlS2V5KCkge1xuICAgICAgICBjb25zdCB7IHBhdGgsIG1lc3NlbmdlciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgcmV0dXJuIGNhbGxFMihtZXNzZW5nZXIsIHtcbiAgICAgICAgICBtZXRob2Q6IFwiZ2V0U3RvcmVLZXlcIixcbiAgICAgICAgICBhcmdzOiBbcGF0aF1cbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuICAgICAgICovXG4gICAgICBtYWtlQ2hpbGROb2RlKG5hbWUsIGNoaWxkTm9kZU9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCB7IHNlcXVlbmNlLCBwYXRoLCBtZXNzZW5nZXIgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGFzc2VydFBhdGhTZWdtZW50MihuYW1lKTtcbiAgICAgICAgY29uc3QgbWVyZ2VkT3B0aW9ucyA9IHsgc2VxdWVuY2UsIC4uLmNoaWxkTm9kZU9wdGlvbnMgfTtcbiAgICAgICAgcmV0dXJuIG1ha2VDaGFpblN0b3JhZ2VOb2RlKFxuICAgICAgICAgIG1lc3NlbmdlcixcbiAgICAgICAgICBgJHtwYXRofS4ke25hbWV9YCxcbiAgICAgICAgICBtZXJnZWRPcHRpb25zXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGFzeW5jIHNldFZhbHVlKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHsgc2VxdWVuY2UsIHBhdGgsIG1lc3NlbmdlciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgYXNzZXJ0LnR5cGVvZih2YWx1ZSwgXCJzdHJpbmdcIik7XG4gICAgICAgIGxldCBlbnRyeTtcbiAgICAgICAgaWYgKCFzZXF1ZW5jZSAmJiAhdmFsdWUpIHtcbiAgICAgICAgICBlbnRyeSA9IFtwYXRoXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlbnRyeSA9IFtwYXRoLCB2YWx1ZV07XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgY2FsbEUyKG1lc3Nlbmdlciwge1xuICAgICAgICAgIG1ldGhvZDogc2VxdWVuY2UgPyBcImFwcGVuZFwiIDogXCJzZXRcIixcbiAgICAgICAgICBhcmdzOiBbZW50cnldXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLy9cbiAgICB9XG4gICk7XG4gIHJldHVybiBtYWtlQ2hhaW5TdG9yYWdlTm9kZTtcbn07XG52YXIgbWFrZUhlYXBDaGFpblN0b3JhZ2VOb2RlMiA9IHByZXBhcmVDaGFpblN0b3JhZ2VOb2RlMihtYWtlSGVhcFpvbmUoKSk7XG5mdW5jdGlvbiBtYWtlQ2hhaW5TdG9yYWdlUm9vdDIoaGFuZGxlU3RvcmFnZU1lc3NhZ2UsIHJvb3RQYXRoLCByb290T3B0aW9ucyA9IHt9KSB7XG4gIGNvbnN0IG1lc3NlbmdlciA9IG1ha2VGdW5jdGlvbkNhbGxiYWNrMihoYW5kbGVTdG9yYWdlTWVzc2FnZSk7XG4gIGNvbnN0IHJvb3ROb2RlID0gbWFrZUhlYXBDaGFpblN0b3JhZ2VOb2RlMihtZXNzZW5nZXIsIHJvb3RQYXRoLCByb290T3B0aW9ucyk7XG4gIHJldHVybiByb290Tm9kZTtcbn1cbnZhciBtYWtlTnVsbFN0b3JhZ2VOb2RlMiA9ICgpID0+IHtcbiAgcmV0dXJuIG1ha2VDaGFpblN0b3JhZ2VSb290MihcbiAgICBGYXIoXCJOdWxsTWVzc2VuZ2VyXCIsICgpID0+IG51bGwpLFxuICAgIFwibnVsbFwiXG4gICk7XG59O1xuYXN5bmMgZnVuY3Rpb24gbWFrZVN0b3JhZ2VOb2RlQ2hpbGQyKHN0b3JhZ2VOb2RlUmVmLCBjaGlsZE5hbWUpIHtcbiAgY29uc3QgZXhpc3RpbmdTdG9yYWdlTm9kZSA9IGF3YWl0IHN0b3JhZ2VOb2RlUmVmO1xuICBjb25zdCBzdG9yYWdlTm9kZSA9IGV4aXN0aW5nU3RvcmFnZU5vZGUgfHwgbWFrZU51bGxTdG9yYWdlTm9kZTIoKTtcbiAgcmV0dXJuIEUoc3RvcmFnZU5vZGUpLm1ha2VDaGlsZE5vZGUoY2hpbGROYW1lKTtcbn1cbmhhcmRlbihtYWtlU3RvcmFnZU5vZGVDaGlsZDIpO1xudmFyIG1ha2VTZXJpYWxpemVUb1N0b3JhZ2UyID0gKHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyKSA9PiB7XG4gIHJldHVybiBhc3luYyAodmFsdWUpID0+IHtcbiAgICBjb25zdCBtYXJzaGFsbGVkID0gYXdhaXQgRShtYXJzaGFsbGVyKS50b0NhcERhdGEodmFsdWUpO1xuICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSBKU09OLnN0cmluZ2lmeShtYXJzaGFsbGVkKTtcbiAgICByZXR1cm4gRShzdG9yYWdlTm9kZSkuc2V0VmFsdWUoc2VyaWFsaXplZCk7XG4gIH07XG59O1xuXG4vL1xudmFyIENhcERhdGFTaGFwZTIgPSB7IGJvZHk6IE0uc3RyaW5nKCksIHNsb3RzOiBNLmFycmF5KCkgfTtcbmhhcmRlbihDYXBEYXRhU2hhcGUyKTtcbnZhciBhc3NlcnRDYXBEYXRhMiA9IChkYXRhKSA9PiB7XG4gIGFzc2VydC50eXBlb2YoZGF0YSwgXCJvYmplY3RcIik7XG4gIGFzc2VydChkYXRhKTtcbiAgdHlwZW9mIGRhdGEuYm9keSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYGRhdGEgaGFzIG5vbi1zdHJpbmcgLmJvZHkgJHtkYXRhLmJvZHl9YDtcbiAgQXJyYXkuaXNBcnJheShkYXRhLnNsb3RzKSB8fCB0aHJvd1JlZGFjdGVkYGRhdGEgaGFzIG5vbi1BcnJheSBzbG90cyAke2RhdGEuc2xvdHN9YDtcbn07XG5oYXJkZW4oYXNzZXJ0Q2FwRGF0YTIpO1xudmFyIHVubWFyc2hhbEZyb21Wc3RvcmFnZTIgPSAoZGF0YSwga2V5LCBmcm9tQ2FwRGF0YSwgaW5kZXgpID0+IHtcbiAgY29uc3Qgc2VyaWFsaXplZCA9IGRhdGEuZ2V0KGtleSkgfHwgdGhyb3dSZWRhY3RlZGBubyBkYXRhIGZvciAke2tleX1gO1xuICBhc3NlcnQudHlwZW9mKHNlcmlhbGl6ZWQsIFwic3RyaW5nXCIpO1xuICBhc3NlcnQudHlwZW9mKGluZGV4LCBcIm51bWJlclwiKTtcbiAgY29uc3Qgc3RyZWFtQ2VsbCA9IEpTT04ucGFyc2Uoc2VyaWFsaXplZCk7XG4gIGlmICghaXNTdHJlYW1DZWxsMihzdHJlYW1DZWxsKSkge1xuICAgIHRocm93IHRocm93UmVkYWN0ZWRgbm90IGEgU3RyZWFtQ2VsbDogJHtzdHJlYW1DZWxsfWA7XG4gIH1cbiAgY29uc3QgeyB2YWx1ZXM6IHZhbHVlczggfSA9IHN0cmVhbUNlbGw7XG4gIHZhbHVlczgubGVuZ3RoID4gMCB8fCB0aHJvd1JlZGFjdGVkYG5vIFN0cmVhbUNlbGwgdmFsdWVzOiAke3N0cmVhbUNlbGx9YDtcbiAgY29uc3QgbWFyc2hhbGxlZCA9IHZhbHVlczguYXQoaW5kZXgpO1xuICBhc3NlcnQudHlwZW9mKG1hcnNoYWxsZWQsIFwic3RyaW5nXCIpO1xuICBjb25zdCBjYXBEYXRhID0gaGFyZGVuKEpTT04ucGFyc2UobWFyc2hhbGxlZCkpO1xuICBhc3NlcnRDYXBEYXRhMihjYXBEYXRhKTtcbiAgY29uc3QgdW5tYXJzaGFsbGVkID0gZnJvbUNhcERhdGEoY2FwRGF0YSk7XG4gIHJldHVybiB1bm1hcnNoYWxsZWQ7XG59O1xuaGFyZGVuKHVubWFyc2hhbEZyb21Wc3RvcmFnZTIpO1xudmFyIHJlamVjdE9DYXAyID0gKGNhcCkgPT4gdGhyb3dSZWRhY3RlZGAke2NhcH0gaXMgbm90IHB1cmUgZGF0YWA7XG52YXIgcHVyZURhdGFNYXJzaGFsbGVyMiA9IG1ha2VNYXJzaGFsKHJlamVjdE9DYXAyLCByZWplY3RPQ2FwMiwge1xuICBzZXJpYWxpemVCb2R5Rm9ybWF0OiBcInNtYWxsY2Fwc1wiXG59KTtcbmhhcmRlbihwdXJlRGF0YU1hcnNoYWxsZXIyKTtcblxuLy9cbnZhciB7IGNyZWF0ZTogY3JlYXRlOCwgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMTYgfSA9IE9iamVjdDtcbnZhciB7IGFwcGx5OiBhcHBseTkgfSA9IFJlZmxlY3Q7XG52YXIgZ2V0TWV0aG9kTmFtZXMzID0gKHZhbCkgPT4gKFxuICAvKiAgICAgICAgICAgICAgKi9cbiAgZ2V0TWV0aG9kTmFtZXModmFsKVxuKTtcbmhhcmRlbihnZXRNZXRob2ROYW1lczMpO1xudmFyIGJpbmRBbGxNZXRob2RzMiA9IChvYmopID0+IGhhcmRlbihcbiAgY3JlYXRlOChcbiAgICBvYmosXG4gICAgZnJvbUVudHJpZXMxNihcbiAgICAgIGdldE1ldGhvZE5hbWVzKG9iaikubWFwKChuYW1lKSA9PiBbXG4gICAgICAgIG5hbWUsXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogKC4uLmFyZ3MpID0+IGFwcGx5OShvYmpbbmFtZV0sIG9iaiwgYXJncyksXG4gICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgICAgICB9XG4gICAgICBdKVxuICAgIClcbiAgKVxuKTtcbmhhcmRlbihiaW5kQWxsTWV0aG9kczIpO1xuXG4vL1xudmFyIEhJU1RPR1JBTV9NU19MQVRFTkNZX0JPVU5EQVJJRVMyID0gW1xuICA1LFxuICAxMCxcbiAgMjUsXG4gIDUwLFxuICAxMDAsXG4gIDI1MCxcbiAgNTAwLFxuICAxZTMsXG4gIDI1MDAsXG4gIDVlMyxcbiAgMWU0LFxuICBJbmZpbml0eVxuXTtcbnZhciBISVNUT0dSQU1fU0VDT05EU19MQVRFTkNZX0JPVU5EQVJJRVMyID0gSElTVE9HUkFNX01TX0xBVEVOQ1lfQk9VTkRBUklFUzIubWFwKChtcykgPT4gbXMgLyAxZTMpO1xudmFyIEhJU1RPR1JBTV9NRVRSSUNTMiA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIHN3aW5nc2V0X2NyYW5rX3Byb2Nlc3NpbmdfdGltZToge1xuICAgICAgZGVzY3JpcHRpb246IFwiUHJvY2Vzc2luZyB0aW1lIHBlciBjcmFuayAobXMpXCIsXG4gICAgICB1bml0OiBcIm1zXCIsXG4gICAgICBib3VuZGFyaWVzOiBBcnJheS5vZigxLCAxMSwgMjEsIDMxLCA0MSwgNTEsIDYxLCA3MSwgODEsIDkxLCBJbmZpbml0eSlcbiAgICB9LFxuICAgIHN3aW5nc2V0X2Jsb2NrX3Byb2Nlc3Npbmdfc2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUHJvY2Vzc2luZyB0aW1lIHBlciBibG9ja1wiLFxuICAgICAgdW5pdDogXCJzXCIsXG4gICAgICBib3VuZGFyaWVzOiBISVNUT0dSQU1fU0VDT05EU19MQVRFTkNZX0JPVU5EQVJJRVMyXG4gICAgfSxcbiAgICBzd2luZ3NldF92YXRfc3RhcnR1cDoge1xuICAgICAgZGVzY3JpcHRpb246IFwiVmF0IHN0YXJ0dXAgdGltZSAobXMpXCIsXG4gICAgICB1bml0OiBcIm1zXCIsXG4gICAgICBib3VuZGFyaWVzOiBISVNUT0dSQU1fTVNfTEFURU5DWV9CT1VOREFSSUVTMlxuICAgIH0sXG4gICAgc3dpbmdzZXRfdmF0X2RlbGl2ZXJ5OiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJWYXQgZGVsaXZlcnkgdGltZSAobXMpXCIsXG4gICAgICB1bml0OiBcIm1zXCIsXG4gICAgICBib3VuZGFyaWVzOiBISVNUT0dSQU1fTVNfTEFURU5DWV9CT1VOREFSSUVTMlxuICAgIH0sXG4gICAgc3dpbmdzZXRfbWV0ZXJfdXNhZ2U6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlZhdCBtZXRlciB1c2FnZVwiLFxuICAgICAgdW5pdDogXCJtc1wiLFxuICAgICAgYm91bmRhcmllczogSElTVE9HUkFNX01TX0xBVEVOQ1lfQk9VTkRBUklFUzJcbiAgICB9XG4gIH1cbik7XG52YXIgYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjMiA9IHtcbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgdW5pdDogXCJzXCIsXG4gIGFkdmljZToge1xuICAgIGV4cGxpY2l0QnVja2V0Qm91bmRhcmllczogW1xuICAgICAgMC4xLFxuICAgICAgMC4yLFxuICAgICAgMC4zLFxuICAgICAgMC40LFxuICAgICAgMC41LFxuICAgICAgMSxcbiAgICAgIDIsXG4gICAgICAzLFxuICAgICAgNCxcbiAgICAgIDUsXG4gICAgICA2LFxuICAgICAgNyxcbiAgICAgIDEwLFxuICAgICAgMTUsXG4gICAgICAzMFxuICAgIF1cbiAgfVxufTtcbnZhciBCTE9DS19ISVNUT0dSQU1fTUVUUklDUzIgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBzd2luZ3NldFJ1blNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IGV4ZWN1dGluZyBTd2luZ1NldFwiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjMlxuICAgIH0sXG4gICAgc3dpbmdzZXRDaGFpblNhdmVTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQZXItYmxvY2sgdGltZSBzcGVudCBwcm9wYWdhdGluZyBTd2luZ1NldCBzdGF0ZSBpbnRvIGNvc21vc1wiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjMlxuICAgIH0sXG4gICAgc3dpbmdzZXRDb21taXRTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQZXItYmxvY2sgdGltZSBzcGVudCBjb21taXR0aW5nIFN3aW5nU2V0IHN0YXRlIHRvIGhvc3Qgc3RvcmFnZVwiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjMlxuICAgIH0sXG4gICAgY29zbW9zQ29tbWl0U2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgY29tbWl0dGluZyBjb3Ntb3Mgc3RhdGVcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzYzJcbiAgICB9LFxuICAgIGZ1bGxDb21taXRTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQZXItYmxvY2sgdGltZSBzcGVudCBjb21taXR0aW5nIHN0YXRlLCBpbmNsdXNpdmUgb2YgQ09NTUlUX0JMT0NLIHByb2Nlc3NpbmcgcGx1cyB0aW1lIHNwZW50IFtvdXRzaWRlIG9mIGNvc21pYy1zd2luZ3NldF0gYmVmb3JlIGFuZCBhZnRlciBpdFwiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjMlxuICAgIH0sXG4gICAgaW50ZXJCbG9ja1NlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlRpbWUgc3BlbnQgaWRsZSBiZXR3ZWVuIGJsb2Nrc1wiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjMlxuICAgIH0sXG4gICAgYWZ0ZXJDb21taXRIYW5nb3ZlclNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IHdhaXRpbmcgZm9yIHByZXZpb3VzLWJsb2NrIGFmdGVyQ29tbWl0IHdvcmtcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzYzJcbiAgICB9LFxuICAgIGJsb2NrTGFnU2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiVGhlIGRlbGF5IG9mIGVhY2ggYmxvY2sgZnJvbSBpdHMgZXhwZWN0ZWQgYmVnaW4gdGltZVwiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjMixcbiAgICAgIC8vXG4gICAgICBhZHZpY2U6IHtcbiAgICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjMi5hZHZpY2UsXG4gICAgICAgIGV4cGxpY2l0QnVja2V0Qm91bmRhcmllczogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgW1xuICAgICAgICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjMi5hZHZpY2UuZXhwbGljaXRCdWNrZXRCb3VuZGFyaWVzLFxuICAgICAgICAgICAgLi4uWzYwLCAxMjAsIDE4MCwgMjQwLCAzMDAsIDYwMCwgMzYwMF1cbiAgICAgICAgICBdXG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9XG4gIH1cbik7XG52YXIgTWV0cmljVHlwZTIgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBDb3VudGVyOiBcImNvdW50ZXJcIixcbiAgICBHYXVnZTogXCJnYXVnZVwiXG4gIH1cbik7XG52YXIgS0VSTkVMX1NUQVRTX1NVTV9NRVRSSUNTMiA9IFtcbiAge1xuICAgIGtleTogXCJzeXNjYWxsc1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfYWxsX3N5c2NhbGxfdG90YWxcIixcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsU2VuZFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJzZW5kXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgbWVzc2FnZSBzZW5kIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbENhbGxOb3dcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwiY2FsbE5vd1wiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHN5bmNocm9ub3VzIGRldmljZSBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxTdWJzY3JpYmVcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwic3Vic2NyaWJlXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgcHJvbWlzZSBzdWJzY3JpcHRpb24ga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsUmVzb2x2ZVwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJyZXNvbHZlXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgcHJvbWlzZSByZXNvbHV0aW9uIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbEV4aXRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwiZXhpdFwiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHZhdCBleGl0IGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFZhdHN0b3JlR2V0XCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInZhdHN0b3JlR2V0XCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0c3RvcmUgZ2V0IGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFZhdHN0b3JlU2V0XCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInZhdHN0b3JlU2V0XCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0c3RvcmUgc2V0IGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFZhdHN0b3JlR2V0TmV4dEtleVwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJ2YXRzdG9yZUdldE5leHRcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXRzdG9yZSBnZXROZXh0S2V5IGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFZhdHN0b3JlRGVsZXRlXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInZhdHN0b3JlRGVsZXRlXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0c3RvcmUgZGVsZXRlIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbERyb3BJbXBvcnRzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcImRyb3BJbXBvcnRzXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgZHJvcCBpbXBvcnRzIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwiZGlzcGF0Y2hlc1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfZGlzcGF0Y2hfdG90YWxcIixcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0IGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJkaXNwYXRjaERlbGl2ZXJcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2Rpc3BhdGNoX2RlbGl2ZXJfdG90YWxcIixcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0IG1lc3NhZ2UgZGVsaXZlcmllc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwiZGlzcGF0Y2hOb3RpZnlcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2Rpc3BhdGNoX25vdGlmeV90b3RhbFwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXQgcHJvbWlzZSBub3RpZmljYXRpb25zXCJcbiAgfVxuXTtcbnZhciBLRVJORUxfU1RBVFNfVVBET1dOX01FVFJJQ1MyID0gW1xuICB7XG4gICAga2V5OiBcImtlcm5lbE9iamVjdHNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2tlcm5lbF9vYmplY3RzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiQWN0aXZlIGtlcm5lbCBvYmplY3RzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJrZXJuZWxEZXZpY2VzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9rZXJuZWxfZGV2aWNlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIkFjdGl2ZSBrZXJuZWwgZGV2aWNlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwia2VybmVsUHJvbWlzZXNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2tlcm5lbF9wcm9taXNlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIkFjdGl2ZSBrZXJuZWwgcHJvbWlzZXNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImtwVW5yZXNvbHZlZFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfdW5yZXNvbHZlZF9rZXJuZWxfcHJvbWlzZXNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJVbnJlc29sdmVkIGtlcm5lbCBwcm9taXNlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwia3BGdWxmaWxsZWRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2Z1bGZpbGxlZF9rZXJuZWxfcHJvbWlzZXNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJGdWxmaWxsZWQga2VybmVsIHByb21pc2VzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJrcFJlamVjdGVkXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9yZWplY3RlZF9rZXJuZWxfcHJvbWlzZXNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJSZWplY3RlZCBrZXJuZWwgcHJvbWlzZXNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInJ1blF1ZXVlTGVuZ3RoXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9ydW5fcXVldWVfbGVuZ3RoXCIsXG4gICAgY29uc2Vuc3VzOiB0cnVlLFxuICAgIGRlc2NyaXB0aW9uOiBcIkxlbmd0aCBvZiB0aGUga2VybmVsIHJ1biBxdWV1ZVwiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwiYWNjZXB0YW5jZVF1ZXVlTGVuZ3RoXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9hY2NlcHRhbmNlX3F1ZXVlX2xlbmd0aFwiLFxuICAgIGNvbnNlbnN1czogdHJ1ZSxcbiAgICBkZXNjcmlwdGlvbjogXCJMZW5ndGggb2YgdGhlIGtlcm5lbCBhY2NlcHRhbmNlIHF1ZXVlXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJwcm9taXNlUXVldWVzTGVuZ3RoXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9wcm9taXNlX3F1ZXVlc19sZW5ndGhcIixcbiAgICBjb25zZW5zdXM6IHRydWUsXG4gICAgZGVzY3JpcHRpb246IFwiQ29tYmluZWQgbGVuZ3RoIG9mIGFsbCBrZXJuZWwgcHJvbWlzZSBxdWV1ZXNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImNsaXN0RW50cmllc1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfY2xpc3RfZW50cmllc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIk51bWJlciBvZiBlbnRyaWVzIGluIHRoZSBrZXJuZWwgYy1saXN0XCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJ2YXRzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF92YXRzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiTnVtYmVyIG9mIGFjdGl2ZSB2YXRzXCJcbiAgfVxuXTtcbnZhciB7IENvdW50ZXI6IENvdW50ZXIyLCBHYXVnZTogR2F1Z2UyIH0gPSBNZXRyaWNUeXBlMjtcbnZhciBLRVJORUxfU1RBVFNfTUVUUklDUzIgPSBoYXJkZW4oW1xuICAuLi5LRVJORUxfU1RBVFNfU1VNX01FVFJJQ1MyLm1hcCgobTIpID0+ICh7IC4uLm0yLCBtZXRyaWNUeXBlOiBDb3VudGVyMiB9KSksXG4gIC4uLktFUk5FTF9TVEFUU19VUERPV05fTUVUUklDUzIubWFwKChtMikgPT4gKHsgLi4ubTIsIG1ldHJpY1R5cGU6IEdhdWdlMiB9KSlcbl0pO1xudmFyIGtlcm5lbFN0YXRzS2V5czIgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuZm9yIChjb25zdCB7IGtleSB9IG9mIEtFUk5FTF9TVEFUU19NRVRSSUNTMikge1xuICBrZXJuZWxTdGF0c0tleXMyLnNldChrZXksIChrZXJuZWxTdGF0c0tleXMyLmdldChrZXkpIHx8IDApICsgMSk7XG59XG52YXIgZHVwbGljYXRlS2VybmVsU3RhdHNLZXlzMiA9IFsuLi5rZXJuZWxTdGF0c0tleXMyLmVudHJpZXMoKV0uZmxhdE1hcChcbiAgKFtrZXksIHZhbHVlXSkgPT4gdmFsdWUgPiAxID8gW2tleV0gOiBbXVxuKTtcbmlmIChkdXBsaWNhdGVLZXJuZWxTdGF0c0tleXMyLmxlbmd0aCA+IDApIHtcbiAgY29uc3QgbXNnID0gYER1cGxpY2F0ZSBrZXJuZWwgc3RhdHMga2V5cyAke0pTT04uc3RyaW5naWZ5KGR1cGxpY2F0ZUtlcm5lbFN0YXRzS2V5czIpfWA7XG4gIHRocm93IEVycm9yKG1zZyk7XG59XG5cbi8vXG52YXIgY29tcGFyZU5hdHMyID0gKGEyLCBiMykgPT4ge1xuICBjb25zdCBkaWZmID0gK2EyIC0gK2IzO1xuICBjb25zdCBmaW5pdGVEaWZmID0gTnVtYmVyLmlzRmluaXRlKGRpZmYpICYmIGRpZmYgfHwgKGEyID09PSBiMyA/IDAgOiBOdW1iZXIoQmlnSW50KGEyKSAtIEJpZ0ludChiMykpIHx8IGEyLmxlbmd0aCAtIGIzLmxlbmd0aCk7XG4gIHJldHVybiBNYXRoLnNpZ24oZmluaXRlRGlmZik7XG59O1xudmFyIGNvbXBhcmVTdHJpbmdzMiA9IChhMiwgYjMpID0+IGEyID4gYjMgPyAxIDogYTIgPCBiMyA/IC0xIDogMDtcbnZhciByUHJlZml4ZWREaWdpdHMyID0gL14oXFxEKikoXFxkKykoXFxELip8KS9zO1xudmFyIG5hdHVyYWxDb21wYXJlMiA9IChhMiwgYjMpID0+IHtcbiAgY29uc3QgW19hLCBhUHJlZml4LCBhRGlnaXRzLCBhU3VmZml4XSA9IHJQcmVmaXhlZERpZ2l0czIuZXhlYyhhMikgfHwgW107XG4gIGlmIChhUHJlZml4ICE9PSB2b2lkIDApIHtcbiAgICBjb25zdCBbX2IsIGJQcmVmaXgsIGJEaWdpdHMsIGJTdWZmaXhdID0gclByZWZpeGVkRGlnaXRzMi5leGVjKGIzKSB8fCBbXTtcbiAgICBpZiAoYlByZWZpeCA9PT0gYVByZWZpeCkge1xuICAgICAgcmV0dXJuIGNvbXBhcmVOYXRzMihhRGlnaXRzLCBiRGlnaXRzKSB8fCBjb21wYXJlU3RyaW5nczIoYVN1ZmZpeCwgYlN1ZmZpeCk7XG4gICAgfVxuICB9XG4gIHJldHVybiBjb21wYXJlU3RyaW5nczIoYTIsIGIzKTtcbn07XG5oYXJkZW4obmF0dXJhbENvbXBhcmUyKTtcblxuLy9cbnZhciB7IGZyb21FbnRyaWVzOiBmcm9tRW50cmllczE3LCBrZXlzOiBrZXlzMiwgdmFsdWVzOiB2YWx1ZXM1IH0gPSBPYmplY3Q7XG52YXIgbWFrZUxpbWl0ZWRDb25zb2xlMiA9IChtYWtlTG9nZ2VyKSA9PiB7XG4gIGNvbnN0IGxpbWl0ZWRDb25zb2xlID0gKFxuICAgIC8qICAgICAgICAgICAgICAqL1xuICAgIGZyb21FbnRyaWVzMTcobG9nTGV2ZWxzMy5tYXAoKGxldmVsKSA9PiBbbGV2ZWwsIG1ha2VMb2dnZXIobGV2ZWwpXSkpXG4gICk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBoYXJkZW4obGltaXRlZENvbnNvbGUpXG4gICk7XG59O1xuaGFyZGVuKG1ha2VMaW1pdGVkQ29uc29sZTIpO1xudmFyIGFzc2VydEFsbERlZmluZWQyID0gKG9iaikgPT4ge1xuICBjb25zdCBtaXNzaW5nMiA9IFtdO1xuICBmb3IgKGNvbnN0IFtrZXksIHZhbF0gb2YgT2JqZWN0LmVudHJpZXMob2JqKSkge1xuICAgIGlmICh2YWwgPT09IHZvaWQgMCkge1xuICAgICAgbWlzc2luZzIucHVzaChrZXkpO1xuICAgIH1cbiAgfVxuICBpZiAobWlzc2luZzIubGVuZ3RoID4gMCkge1xuICAgIHRocm93UmVkYWN0ZWRgbWlzc2luZyAke3F1b3RlKG1pc3NpbmcyKX1gO1xuICB9XG59O1xudmFyIG5vdERvbmUyID0gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlOiB2b2lkIDAgfSk7XG52YXIgYWx3YXlzRG9uZTIgPSBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZTogdm9pZCAwIH0pO1xudmFyIGZvcmV2ZXIyID0gYXN5bmNHZW5lcmF0ZSgoKSA9PiBub3REb25lMik7XG5cbi8vXG52YXIgU3RvcmFnZU5vZGVTaGFwZTIgPSBNLnJlbW90YWJsZShcIlN0b3JhZ2VOb2RlXCIpO1xudmFyIFVuZ3VhcmRlZEhlbHBlckkyID0gTS5pbnRlcmZhY2UoXG4gIFwiaGVscGVyXCIsXG4gIHt9LFxuICAvL1xuICB7IHNsb3BweTogdHJ1ZSB9XG4pO1xudmFyIEJyaWRnZUJpZ0ludFNoYXBlMiA9IE0ub3IoTS5udW1iZXIoKSwgTS5zdHJpbmcoKSk7XG5cbi8vXG52YXIgbWFrZVdlYWtTZXRTdG9yZU1ldGhvZHM1ID0gKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCBrZXlOYW1lID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiBqc3NldC5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUoa2V5TmFtZSl9IG5vdCBmb3VuZDogJHtrZXl9YDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgaGFzOiAoa2V5KSA9PiB7XG4gICAgICByZXR1cm4ganNzZXQuaGFzKGtleSk7XG4gICAgfSxcbiAgICBhZGQ6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleU9rVG9BZGQoa2V5KTtcbiAgICAgIGpzc2V0LmFkZChrZXkpO1xuICAgIH0sXG4gICAgZGVsZXRlOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIGlmIChhc3NlcnRLZXlPa1RvRGVsZXRlICE9PSB2b2lkIDApIHtcbiAgICAgICAgYXNzZXJ0S2V5T2tUb0RlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgICAganNzZXQuZGVsZXRlKGtleSk7XG4gICAgfSxcbiAgICBhZGRBbGw6IChrZXlzNSkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBrZXlzNVtTeW1ib2wuaXRlcmF0b3JdICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgaWYgKE9iamVjdC5pc0Zyb3plbihrZXlzNSkgJiYgaXNDb3B5U2V0KGtleXM1KSkge1xuICAgICAgICAgIGtleXM1ID0gZ2V0Q29weVNldEtleXMoa2V5czUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93UmVkYWN0ZWRgcHJvdmlkZWQgZGF0YSBzb3VyY2UgaXMgbm90IGl0ZXJhYmxlOiAke2tleXM1fWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoXG4gICAgICAgIGNvbnN0IGtleSBvZlxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBrZXlzNVxuICAgICAgKSB7XG4gICAgICAgIGFzc2VydEtleU9rVG9BZGQoa2V5KTtcbiAgICAgICAganNzZXQuYWRkKGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgbWFrZVNjYWxhcldlYWtTZXRTdG9yZTUgPSAodGFnID0gXCJrZXlcIiwgeyBsb25nTGl2ZWQgPSB0cnVlLCBrZXlTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNzZXQgPSBuZXcgKGxvbmdMaXZlZCA/IFdlYWtTZXQgOiBTZXQpKCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S2V5T2tUb0FkZCA9IChrZXkpID0+IHtcbiAgICBoYXJkZW4oa2V5KTtcbiAgICBwYXNzU3R5bGVPZihrZXkpID09PSBcInJlbW90YWJsZVwiIHx8IHRocm93UmVkYWN0ZWRgT25seSByZW1vdGFibGVzIGNhbiBiZSBrZXlzIG9mIHNjYWxhciBXZWFrU3RvcmVzOiAke2tleX1gO1xuICAgIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2goa2V5LCBrZXlTaGFwZSwgXCJ3ZWFrU2V0U3RvcmUga2V5XCIpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIEZhcihgc2NhbGFyIFdlYWtTZXRTdG9yZSBvZiAke3F1b3RlKHRhZyl9YCwge1xuICAgIC4uLm1ha2VXZWFrU2V0U3RvcmVNZXRob2RzNShqc3NldCwgYXNzZXJ0S2V5T2tUb0FkZCwgdm9pZCAwLCB0YWcpXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU2NhbGFyV2Vha1NldFN0b3JlNSk7XG5cbi8vXG52YXIgbWFrZUN1cnJlbnRLZXlzS2l0NSA9IChnZXRSYXdLZXlzLCBjaGVja0hhcywgY29tcGFyZSwgYXNzZXJ0T2tUb0FkZCwgYXNzZXJ0T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgbGV0IHVwZGF0ZUNvdW50ID0gMDtcbiAgbGV0IHNvcnRlZEtleXNNZW1vO1xuICBjb25zdCBhc3NlcnRVcGRhdGVPbkFkZCA9IChrLCB2MiA9IHZvaWQgMCkgPT4ge1xuICAgIGFzc2VydE9rVG9BZGQoaywgdjIpO1xuICAgIHVwZGF0ZUNvdW50ICs9IDE7XG4gICAgc29ydGVkS2V5c01lbW8gPSB2b2lkIDA7XG4gIH07XG4gIGNvbnN0IGFzc2VydFVwZGF0ZU9uRGVsZXRlID0gKGspID0+IGFzc2VydE9rVG9EZWxldGUgJiYgYXNzZXJ0T2tUb0RlbGV0ZShrKTtcbiAgY29uc3QgZ2V0U29ydGVkS2V5cyA9ICgpID0+IHtcbiAgICBpZiAoc29ydGVkS2V5c01lbW8gPT09IHZvaWQgMCkge1xuICAgICAgc29ydGVkS2V5c01lbW8gPSBoYXJkZW4oWy4uLmdldFJhd0tleXMoKV0uc29ydChjb21wYXJlKSk7XG4gICAgfVxuICAgIHJldHVybiBzb3J0ZWRLZXlzTWVtbztcbiAgfTtcbiAgY29uc3QgaXRlcmFibGVLZXlzID0gRmFyKFwiSXRlcmFibGUgb2Yga2V5c1wiLCB7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGNvbnN0IGdlbmVyYXRpb24gPSB1cGRhdGVDb3VudDtcbiAgICAgIGdldFNvcnRlZEtleXMoKTtcbiAgICAgIGNvbnN0IGxlbiA9IHNvcnRlZEtleXNNZW1vLmxlbmd0aDtcbiAgICAgIGxldCBpMiA9IDA7XG4gICAgICByZXR1cm4gRmFyKFwiSXRlcmF0b3Igb2Yga2V5c1wiLCB7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBnZW5lcmF0aW9uID09PSB1cGRhdGVDb3VudCB8fCB0aHJvd1JlZGFjdGVkYFN0b3JlICR7cXVvdGUoa2V5TmFtZSl9IGN1cnNvciBzdGFsZWA7XG4gICAgICAgICAgZm9yICg7IDsgKSB7XG4gICAgICAgICAgICBpZiAoaTIgPCBsZW4pIHtcbiAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBzb3J0ZWRLZXlzTWVtb1tpMl07XG4gICAgICAgICAgICAgIGkyICs9IDE7XG4gICAgICAgICAgICAgIGlmIChjaGVja0hhcyh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHZvaWQgMCB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGFzc2VydFVwZGF0ZU9uQWRkLFxuICAgIGFzc2VydFVwZGF0ZU9uRGVsZXRlLFxuICAgIGl0ZXJhYmxlS2V5c1xuICB9KTtcbn07XG5oYXJkZW4obWFrZUN1cnJlbnRLZXlzS2l0NSk7XG52YXIgcHJvdmlkZUxhenk1ID0gKG1hcFN0b3JlLCBrZXksIG1ha2VWYWx1ZSkgPT4ge1xuICBpZiAoIW1hcFN0b3JlLmhhcyhrZXkpKSB7XG4gICAgbWFwU3RvcmUuaW5pdChrZXksIG1ha2VWYWx1ZShrZXkpKTtcbiAgfVxuICByZXR1cm4gbWFwU3RvcmUuZ2V0KGtleSk7XG59O1xuaGFyZGVuKHByb3ZpZGVMYXp5NSk7XG52YXIgbWFrZUF0b21pY1Byb3ZpZGVyNSA9IChzdG9yZSkgPT4ge1xuICBjb25zdCBwZW5kaW5nID0gLyogICAgICAgICAgICovIG5ldyBNYXAoKTtcbiAgY29uc3QgcHJvdmlkZUFzeW5jID0gKGtleSwgbWFrZVZhbHVlLCBmaW5pc2hWYWx1ZSkgPT4ge1xuICAgIGlmIChzdG9yZS5oYXMoa2V5KSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShzdG9yZS5nZXQoa2V5KSk7XG4gICAgfVxuICAgIGlmICghcGVuZGluZy5oYXMoa2V5KSkge1xuICAgICAgY29uc3QgdmFsUDIgPSBtYWtlVmFsdWUoa2V5KS50aGVuKCh2MikgPT4ge1xuICAgICAgICBzdG9yZS5pbml0KGtleSwgdjIpO1xuICAgICAgICByZXR1cm4gdjI7XG4gICAgICB9KS50aGVuKCh2MikgPT4ge1xuICAgICAgICBpZiAoZmluaXNoVmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gZmluaXNoVmFsdWUoa2V5LCB2MikudGhlbigoKSA9PiB2Mik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHYyO1xuICAgICAgfSkuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIHBlbmRpbmcuZGVsZXRlKGtleSk7XG4gICAgICB9KTtcbiAgICAgIHBlbmRpbmcuc2V0KGtleSwgdmFsUDIpO1xuICAgIH1cbiAgICBjb25zdCB2YWxQID0gcGVuZGluZy5nZXQoa2V5KTtcbiAgICBhc3NlcnQodmFsUCk7XG4gICAgcmV0dXJuIHZhbFA7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oeyBwcm92aWRlQXN5bmMgfSk7XG59O1xuaGFyZGVuKG1ha2VBdG9taWNQcm92aWRlcjUpO1xudmFyIGFwcGVuZFRvU3RvcmVkQXJyYXk1ID0gKG1hcFN0b3JlLCBrZXksIGl0ZW0pID0+IHtcbiAgaWYgKG1hcFN0b3JlLmhhcyhrZXkpKSB7XG4gICAgY29uc3QgZXh0YW50ID0gbWFwU3RvcmUuZ2V0KGtleSk7XG4gICAgbWFwU3RvcmUuc2V0KGtleSwgaGFyZGVuKFsuLi5leHRhbnQsIGl0ZW1dKSk7XG4gIH0gZWxzZSB7XG4gICAgbWFwU3RvcmUuaW5pdChrZXksIGhhcmRlbihbaXRlbV0pKTtcbiAgfVxufTtcbmhhcmRlbihhcHBlbmRUb1N0b3JlZEFycmF5NSk7XG5cbi8vXG52YXIgbWFrZVNldFN0b3JlTWV0aG9kczUgPSAoanNzZXQsIGFzc2VydEtleU9rVG9BZGQsIGFzc2VydEtleU9rVG9EZWxldGUgPSB2b2lkIDAsIGtleU5hbWUgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IHsgYXNzZXJ0VXBkYXRlT25BZGQsIGFzc2VydFVwZGF0ZU9uRGVsZXRlLCBpdGVyYWJsZUtleXMgfSA9IG1ha2VDdXJyZW50S2V5c0tpdDUoXG4gICAgKCkgPT4ganNzZXQua2V5cygpLFxuICAgIChrKSA9PiBqc3NldC5oYXMoayksXG4gICAgY29tcGFyZVJhbmssXG4gICAgYXNzZXJ0S2V5T2tUb0FkZCxcbiAgICBhc3NlcnRLZXlPa1RvRGVsZXRlLFxuICAgIGtleU5hbWVcbiAgKTtcbiAgY29uc3Qga2V5czUgPSAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ga2V5UGF0dCA9PT0gdm9pZCAwID8gaXRlcmFibGVLZXlzIDogZmlsdGVySXRlcmFibGUoaXRlcmFibGVLZXlzLCAoaykgPT4gbWF0Y2hlcyhrLCBrZXlQYXR0KSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIC4uLm1ha2VXZWFrU2V0U3RvcmVNZXRob2RzNShcbiAgICAgIGpzc2V0LFxuICAgICAgYXNzZXJ0VXBkYXRlT25BZGQsXG4gICAgICBhc3NlcnRVcGRhdGVPbkRlbGV0ZSxcbiAgICAgIGtleU5hbWVcbiAgICApLFxuICAgIGtleXM6IGtleXM1LFxuICAgIHZhbHVlczoga2V5czUsXG4gICAgc25hcHNob3Q6IChrZXlQYXR0ID0gdm9pZCAwKSA9PiBtYWtlQ29weVNldChrZXlzNShrZXlQYXR0KSksXG4gICAgZ2V0U2l6ZTogKGtleVBhdHQgPSB2b2lkIDApID0+IGtleVBhdHQgPT09IHZvaWQgMCA/IGpzc2V0LnNpemUgOiBbLi4ua2V5czUoa2V5UGF0dCldLmxlbmd0aCxcbiAgICBjbGVhcjogKGtleVBhdHQgPSB2b2lkIDApID0+IHtcbiAgICAgIGlmIChrZXlQYXR0ID09PSB2b2lkIDApIHtcbiAgICAgICAganNzZXQuY2xlYXIoKTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXM1KGtleVBhdHQpKSB7XG4gICAgICAgIGpzc2V0LmRlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xudmFyIG1ha2VTY2FsYXJTZXRTdG9yZTUgPSAodGFnID0gXCJrZXlcIiwgeyBrZXlTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNzZXQgPSAvKiAgICAgICAgICAgKi8gbmV3IFNldCgpO1xuICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oa2V5U2hhcGUpO1xuICB9XG4gIGNvbnN0IGFzc2VydEtleU9rVG9BZGQgPSAoa2V5KSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgYXNzZXJ0U2NhbGFyS2V5KGtleSk7XG4gICAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaChrZXksIGtleVNoYXBlLCBcInNldFN0b3JlIGtleVwiKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBGYXIoYHNjYWxhciBTZXRTdG9yZSBvZiAke3F1b3RlKHRhZyl9YCwge1xuICAgIC4uLm1ha2VTZXRTdG9yZU1ldGhvZHM1KGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCB2b2lkIDAsIHRhZylcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJTZXRTdG9yZTUpO1xuXG4vL1xudmFyIG1ha2VXZWFrTWFwU3RvcmVNZXRob2RzNSA9IChqc21hcCwgYXNzZXJ0S1ZPa1RvQWRkLCBhc3NlcnRLVk9rVG9TZXQsIGFzc2VydEtleU9rVG9EZWxldGUgPSB2b2lkIDAsIGtleU5hbWUgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IGFzc2VydEtleURvZXNOb3RFeGlzdCA9IChrZXkpID0+ICFqc21hcC5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUoa2V5TmFtZSl9IGFscmVhZHkgcmVnaXN0ZXJlZDogJHtrZXl9YDtcbiAgY29uc3QgYXNzZXJ0S2V5RXhpc3RzID0gKGtleSkgPT4ganNtYXAuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKGtleU5hbWUpfSBub3QgZm91bmQ6ICR7a2V5fWA7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGhhczogKGtleSkgPT4ge1xuICAgICAgcmV0dXJuIGpzbWFwLmhhcyhrZXkpO1xuICAgIH0sXG4gICAgZ2V0OiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgICAganNtYXAuZ2V0KGtleSlcbiAgICAgICk7XG4gICAgfSxcbiAgICBpbml0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RG9lc05vdEV4aXN0KGtleSk7XG4gICAgICBhc3NlcnRLVk9rVG9BZGQoa2V5LCB2YWx1ZSk7XG4gICAgICBqc21hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBzZXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIGFzc2VydEtWT2tUb1NldChrZXksIHZhbHVlKTtcbiAgICAgIGpzbWFwLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBpZiAoYXNzZXJ0S2V5T2tUb0RlbGV0ZSAhPT0gdm9pZCAwKSB7XG4gICAgICAgIGFzc2VydEtleU9rVG9EZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICAgIGpzbWFwLmRlbGV0ZShrZXkpO1xuICAgIH0sXG4gICAgYWRkQWxsOiAoZW50cmllczExKSA9PiB7XG4gICAgICBpZiAodHlwZW9mIGVudHJpZXMxMVtTeW1ib2wuaXRlcmF0b3JdICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgaWYgKE9iamVjdC5pc0Zyb3plbihlbnRyaWVzMTEpICYmIGlzQ29weU1hcChlbnRyaWVzMTEpKSB7XG4gICAgICAgICAgZW50cmllczExID0gZ2V0Q29weU1hcEVudHJpZXMoZW50cmllczExKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvd1JlZGFjdGVkYHByb3ZpZGVkIGRhdGEgc291cmNlIGlzIG5vdCBpdGVyYWJsZTogJHtlbnRyaWVzMTF9YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChcbiAgICAgICAgY29uc3QgW2tleSwgdmFsdWVdIG9mXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZW50cmllczExXG4gICAgICApIHtcbiAgICAgICAgYXNzZXJ0S1ZPa1RvQWRkKGtleSwgdmFsdWUpO1xuICAgICAgICBqc21hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgbWFrZVNjYWxhcldlYWtNYXBTdG9yZTUgPSAodGFnID0gXCJrZXlcIiwgeyBsb25nTGl2ZWQgPSB0cnVlLCBrZXlTaGFwZSA9IHZvaWQgMCwgdmFsdWVTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNtYXAgPSBuZXcgKGxvbmdMaXZlZCA/IFdlYWtNYXAgOiBNYXApKCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4odmFsdWVTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S1ZPa1RvU2V0ID0gKF9rZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKHZhbHVlKTtcbiAgICBhc3NlcnRQYXNzYWJsZSh2YWx1ZSk7XG4gICAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKHZhbHVlLCB2YWx1ZVNoYXBlLCBcIndlYWtNYXBTdG9yZSB2YWx1ZVwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFzc2VydEtWT2tUb0FkZCA9IChrZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgcGFzc1N0eWxlT2Yoa2V5KSA9PT0gXCJyZW1vdGFibGVcIiB8fCB0aHJvd1JlZGFjdGVkYE9ubHkgcmVtb3RhYmxlcyBjYW4gYmUga2V5cyBvZiBzY2FsYXIgV2Vha01hcFN0b3JlczogJHtrZXl9YDtcbiAgICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKGtleSwga2V5U2hhcGUsIFwid2Vha01hcFN0b3JlIGtleVwiKTtcbiAgICB9XG4gICAgYXNzZXJ0S1ZPa1RvU2V0KGtleSwgdmFsdWUpO1xuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgV2Vha01hcFN0b3JlIG9mICR7cXVvdGUodGFnKX1gLCB7XG4gICAgLi4ubWFrZVdlYWtNYXBTdG9yZU1ldGhvZHM1KFxuICAgICAganNtYXAsXG4gICAgICBhc3NlcnRLVk9rVG9BZGQsXG4gICAgICBhc3NlcnRLVk9rVG9TZXQsXG4gICAgICB2b2lkIDAsXG4gICAgICB0YWdcbiAgICApXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU2NhbGFyV2Vha01hcFN0b3JlNSk7XG5cbi8vXG52YXIgbWFrZU1hcFN0b3JlTWV0aG9kczUgPSAoanNtYXAsIGFzc2VydEtWT2tUb0FkZCwgYXNzZXJ0S1ZPa1RvU2V0LCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCB0YWcgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IHsgYXNzZXJ0VXBkYXRlT25BZGQsIGFzc2VydFVwZGF0ZU9uRGVsZXRlLCBpdGVyYWJsZUtleXMgfSA9IG1ha2VDdXJyZW50S2V5c0tpdDUoXG4gICAgKCkgPT4ganNtYXAua2V5cygpLFxuICAgIChrKSA9PiBqc21hcC5oYXMoayksXG4gICAgY29tcGFyZVJhbmssXG4gICAgYXNzZXJ0S1ZPa1RvQWRkLFxuICAgIGFzc2VydEtleU9rVG9EZWxldGUsXG4gICAgdGFnXG4gICk7XG4gIGNvbnN0IGtleXM1ID0gKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4ge1xuICAgIGlmIChrZXlQYXR0ID09PSB2b2lkIDAgJiYgdmFsdWVQYXR0ID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBpdGVyYWJsZUtleXM7XG4gICAgfVxuICAgIGNvbnN0IGZpbHRlciA9IChrKSA9PiB7XG4gICAgICBpZiAoa2V5UGF0dCAhPT0gdm9pZCAwICYmICFtYXRjaGVzKGssIGtleVBhdHQpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmICh2YWx1ZVBhdHQgIT09IHZvaWQgMCAmJiAhbWF0Y2hlcyhqc21hcC5nZXQoayksIHZhbHVlUGF0dCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcbiAgICByZXR1cm4gZmlsdGVySXRlcmFibGUoaXRlcmFibGVLZXlzLCBmaWx0ZXIpO1xuICB9O1xuICBjb25zdCB2YWx1ZXM4ID0gKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4gbWFwSXRlcmFibGUoa2V5czUoa2V5UGF0dCwgdmFsdWVQYXR0KSwgKGspID0+IChcbiAgICAvKiAgICAgICAgICAgICovXG4gICAganNtYXAuZ2V0KGspXG4gICkpO1xuICBjb25zdCBlbnRyaWVzMTEgPSAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBtYXBJdGVyYWJsZShrZXlzNShrZXlQYXR0LCB2YWx1ZVBhdHQpLCAoaykgPT4gW1xuICAgIGssXG4gICAgLyogICAgICAgICAgICAqL1xuICAgIGpzbWFwLmdldChrKVxuICBdKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgLi4ubWFrZVdlYWtNYXBTdG9yZU1ldGhvZHM1KFxuICAgICAganNtYXAsXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgYXNzZXJ0VXBkYXRlT25BZGQsXG4gICAgICBhc3NlcnRLVk9rVG9TZXQsXG4gICAgICBhc3NlcnRVcGRhdGVPbkRlbGV0ZSxcbiAgICAgIHRhZ1xuICAgICksXG4gICAga2V5czoga2V5czUsXG4gICAgdmFsdWVzOiB2YWx1ZXM4LFxuICAgIGVudHJpZXM6IGVudHJpZXMxMSxcbiAgICBzbmFwc2hvdDogKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4gbWFrZUNvcHlNYXAoZW50cmllczExKGtleVBhdHQsIHZhbHVlUGF0dCkpLFxuICAgIGdldFNpemU6IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IGtleVBhdHQgPT09IHZvaWQgMCAmJiB2YWx1ZVBhdHQgPT09IHZvaWQgMCA/IGpzbWFwLnNpemUgOiBbLi4ua2V5czUoa2V5UGF0dCwgdmFsdWVQYXR0KV0ubGVuZ3RoLFxuICAgIGNsZWFyOiAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiB7XG4gICAgICBpZiAoa2V5UGF0dCA9PT0gdm9pZCAwICYmIHZhbHVlUGF0dCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGpzbWFwLmNsZWFyKCk7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzNShrZXlQYXR0LCB2YWx1ZVBhdHQpKSB7XG4gICAgICAgIGpzbWFwLmRlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xudmFyIG1ha2VTY2FsYXJNYXBTdG9yZTUgPSAodGFnID0gXCJrZXlcIiwgeyBrZXlTaGFwZSA9IHZvaWQgMCwgdmFsdWVTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNtYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oa2V5U2hhcGUpO1xuICB9XG4gIGlmICh2YWx1ZVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKHZhbHVlU2hhcGUpO1xuICB9XG4gIGNvbnN0IGFzc2VydEtWT2tUb1NldCA9IChfa2V5LCB2YWx1ZSkgPT4ge1xuICAgIGhhcmRlbih2YWx1ZSk7XG4gICAgYXNzZXJ0UGFzc2FibGUodmFsdWUpO1xuICAgIGlmICh2YWx1ZVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaCh2YWx1ZSwgdmFsdWVTaGFwZSwgXCJtYXBTdG9yZSB2YWx1ZVwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFzc2VydEtWT2tUb0FkZCA9IChrZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgYXNzZXJ0U2NhbGFyS2V5KGtleSk7XG4gICAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaChrZXksIGtleVNoYXBlLCBcIm1hcFN0b3JlIGtleVwiKTtcbiAgICB9XG4gICAgYXNzZXJ0S1ZPa1RvU2V0KGtleSwgdmFsdWUpO1xuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgTWFwU3RvcmUgb2YgJHtxdW90ZSh0YWcpfWAsIHtcbiAgICAuLi5tYWtlTWFwU3RvcmVNZXRob2RzNShcbiAgICAgIGpzbWFwLFxuICAgICAgYXNzZXJ0S1ZPa1RvQWRkLFxuICAgICAgYXNzZXJ0S1ZPa1RvU2V0LFxuICAgICAgdm9pZCAwLFxuICAgICAgdGFnXG4gICAgKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZVNjYWxhck1hcFN0b3JlNSk7XG5cbi8vXG52YXIgbWFrZUxlZ2FjeU1hcDUgPSAodGFnID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCBtMiA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIGNvbnN0IGFzc2VydEtleURvZXNOb3RFeGlzdCA9IChrZXkpID0+ICFtMi5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gYWxyZWFkeSByZWdpc3RlcmVkOiAke2tleX1gO1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiBtMi5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiBtMi5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGluaXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlEb2VzTm90RXhpc3Qoa2V5KTtcbiAgICAgIG0yLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICByZXR1cm4gbTIuZ2V0KGtleSk7XG4gICAgfSxcbiAgICBzZXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIG0yLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBtMi5kZWxldGUoa2V5KTtcbiAgICB9LFxuICAgIGtleXM6ICgpID0+IG0yLmtleXMoKSxcbiAgICB2YWx1ZXM6ICgpID0+IG0yLnZhbHVlcygpLFxuICAgIGVudHJpZXM6ICgpID0+IG0yLmVudHJpZXMoKSxcbiAgICBnZXRTaXplOiAoKSA9PiBtMi5zaXplLFxuICAgIGNsZWFyOiAoKSA9PiBtMi5jbGVhcigpXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlTGVnYWN5TWFwNSk7XG5cbi8vXG52YXIgbWFrZUxlZ2FjeVdlYWtNYXA1ID0gKHRhZyA9IFwia2V5XCIpID0+IHtcbiAgY29uc3Qgd20gPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgYXNzZXJ0S2V5RG9lc05vdEV4aXN0ID0gKGtleSkgPT4gIXdtLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBhbHJlYWR5IHJlZ2lzdGVyZWQ6ICR7a2V5fWA7XG4gIGNvbnN0IGFzc2VydEtleUV4aXN0cyA9IChrZXkpID0+IHdtLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBub3QgZm91bmQ6ICR7a2V5fWA7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGhhczogKGtleSkgPT4ge1xuICAgICAgcmV0dXJuIHdtLmhhcyhrZXkpO1xuICAgIH0sXG4gICAgaW5pdDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleURvZXNOb3RFeGlzdChrZXkpO1xuICAgICAgd20uc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZ2V0OiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgICAgd20uZ2V0KGtleSlcbiAgICAgICk7XG4gICAgfSxcbiAgICBzZXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHdtLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICB3bS5kZWxldGUoa2V5KTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihtYWtlTGVnYWN5V2Vha01hcDUpO1xuXG4vL1xudmFyIG11c3RNYXRjaDMgPSBtdXN0TWF0Y2g7XG5cbi8vXG52YXIgVmF0RGF0YUdsb2JhbDM7XG5pZiAoXCJWYXREYXRhXCIgaW4gZ2xvYmFsVGhpcykge1xuICBnbG9iYWxUaGlzLlZhdERhdGEgfHwgdGhyb3dSZWRhY3RlZGBWYXREYXRhIGRlZmluZWQgaW4gZ2xvYmFsIGFzIG51bGwgb3IgdW5kZWZpbmVkYDtcbiAgVmF0RGF0YUdsb2JhbDMgPSAvKiAgICAgICAgICAgICAgKi9cbiAgZ2xvYmFsVGhpcy5WYXREYXRhO1xufSBlbHNlIHtcbiAgY29uc3QgdW5hdmFpbGFibGUgPSAoKSA9PiB0aHJvd1JlZGFjdGVkYFZhdERhdGEgdW5hdmFpbGFibGVgO1xuICBWYXREYXRhR2xvYmFsMyA9IHtcbiAgICBkZWZpbmVLaW5kOiB1bmF2YWlsYWJsZSxcbiAgICBkZWZpbmVLaW5kTXVsdGk6IHVuYXZhaWxhYmxlLFxuICAgIGRlZmluZUR1cmFibGVLaW5kOiB1bmF2YWlsYWJsZSxcbiAgICBkZWZpbmVEdXJhYmxlS2luZE11bHRpOiB1bmF2YWlsYWJsZSxcbiAgICBtYWtlS2luZEhhbmRsZTogdW5hdmFpbGFibGUsXG4gICAgcHJvdmlkZVByb21pc2VXYXRjaGVyOiB1bmF2YWlsYWJsZSxcbiAgICB3YXRjaFByb21pc2U6IHVuYXZhaWxhYmxlLFxuICAgIG1ha2VTY2FsYXJCaWdNYXBTdG9yZTogdW5hdmFpbGFibGUsXG4gICAgbWFrZVNjYWxhckJpZ1dlYWtNYXBTdG9yZTogdW5hdmFpbGFibGUsXG4gICAgbWFrZVNjYWxhckJpZ1NldFN0b3JlOiB1bmF2YWlsYWJsZSxcbiAgICBtYWtlU2NhbGFyQmlnV2Vha1NldFN0b3JlOiB1bmF2YWlsYWJsZSxcbiAgICBjYW5CZUR1cmFibGU6IHVuYXZhaWxhYmxlXG4gIH07XG59XG52YXIgVmF0RGF0YUV4cG9ydDMgPSBWYXREYXRhR2xvYmFsMztcbnZhciB7XG4gIGRlZmluZUtpbmQ6IGRlZmluZUtpbmQzLFxuICBkZWZpbmVLaW5kTXVsdGk6IGRlZmluZUtpbmRNdWx0aTMsXG4gIGRlZmluZUR1cmFibGVLaW5kOiBkZWZpbmVEdXJhYmxlS2luZDMsXG4gIGRlZmluZUR1cmFibGVLaW5kTXVsdGk6IGRlZmluZUR1cmFibGVLaW5kTXVsdGkzXG59ID0gVmF0RGF0YUdsb2JhbDM7XG52YXIge1xuICBtYWtlS2luZEhhbmRsZTogbWFrZUtpbmRIYW5kbGUzLFxuICBwcm92aWRlUHJvbWlzZVdhdGNoZXI6IHByb3ZpZGVQcm9taXNlV2F0Y2hlcjMsXG4gIHdhdGNoUHJvbWlzZTogd2F0Y2hQcm9taXNlNCxcbiAgbWFrZVNjYWxhckJpZ01hcFN0b3JlOiBtYWtlU2NhbGFyQmlnTWFwU3RvcmUzLFxuICBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlOiBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlMyxcbiAgbWFrZVNjYWxhckJpZ1NldFN0b3JlOiBtYWtlU2NhbGFyQmlnU2V0U3RvcmUzLFxuICBtYWtlU2NhbGFyQmlnV2Vha1NldFN0b3JlOiBtYWtlU2NhbGFyQmlnV2Vha1NldFN0b3JlMyxcbiAgY2FuQmVEdXJhYmxlOiBjYW5CZUR1cmFibGUzXG59ID0gVmF0RGF0YUdsb2JhbDM7XG52YXIgcGlja0ZhY2V0MyA9IChtYWtlciwgZmFjZXROYW1lKSA9PiAoLi4uYXJncykgPT4gbWFrZXIoLi4uYXJncylbZmFjZXROYW1lXTtcbmhhcmRlbihwaWNrRmFjZXQzKTtcbnZhciBwYXJ0aWFsQXNzaWduMyA9ICh0YXJnZXQsIHNvdXJjZSkgPT4ge1xuICBPYmplY3QuYXNzaWduKHRhcmdldCwgc291cmNlKTtcbn07XG5oYXJkZW4ocGFydGlhbEFzc2lnbjMpO1xudmFyIHByb3ZpZGUzID0gKFxuICAvL1xuICAvKlxuXG5cblxuXG5cbiAgICovXG4gIHByb3ZpZGVMYXp5NVxuKTtcbnZhciBtYWtlU3RvcmVVdGlsczMgPSAoVmF0RGF0YSkgPT4ge1xuICBjb25zdCB7XG4gICAgLy9cbiAgICBtYWtlU2NhbGFyQmlnTWFwU3RvcmU6IG1ha2VTY2FsYXJCaWdNYXBTdG9yZTQsXG4gICAgLy9cbiAgICBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlOiBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlNCxcbiAgICAvL1xuICAgIG1ha2VTY2FsYXJCaWdTZXRTdG9yZTogbWFrZVNjYWxhckJpZ1NldFN0b3JlNCxcbiAgICAvL1xuICAgIG1ha2VTY2FsYXJCaWdXZWFrU2V0U3RvcmU6IG1ha2VTY2FsYXJCaWdXZWFrU2V0U3RvcmU0XG4gIH0gPSBWYXREYXRhO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZU1hcFN0b3JlNCA9IChiYWdnYWdlLCBuYW1lLCBvcHRpb25zID0ge30pID0+IHByb3ZpZGUzKFxuICAgIGJhZ2dhZ2UsXG4gICAgbmFtZSxcbiAgICAoKSA9PiBtYWtlU2NhbGFyQmlnTWFwU3RvcmU0KG5hbWUsIHsgZHVyYWJsZTogdHJ1ZSwgLi4ub3B0aW9ucyB9KVxuICApO1xuICBoYXJkZW4ocHJvdmlkZUR1cmFibGVNYXBTdG9yZTQpO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZTQgPSAoYmFnZ2FnZSwgbmFtZSwgb3B0aW9ucyA9IHt9KSA9PiBwcm92aWRlMyhcbiAgICBiYWdnYWdlLFxuICAgIG5hbWUsXG4gICAgKCkgPT4gbWFrZVNjYWxhckJpZ1dlYWtNYXBTdG9yZTQobmFtZSwgeyBkdXJhYmxlOiB0cnVlLCAuLi5vcHRpb25zIH0pXG4gICk7XG4gIGhhcmRlbihwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZTQpO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZVNldFN0b3JlNCA9IChiYWdnYWdlLCBuYW1lLCBvcHRpb25zID0ge30pID0+IHByb3ZpZGUzKFxuICAgIGJhZ2dhZ2UsXG4gICAgbmFtZSxcbiAgICAoKSA9PiBtYWtlU2NhbGFyQmlnU2V0U3RvcmU0KG5hbWUsIHsgZHVyYWJsZTogdHJ1ZSwgLi4ub3B0aW9ucyB9KVxuICApO1xuICBoYXJkZW4ocHJvdmlkZUR1cmFibGVTZXRTdG9yZTQpO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZTQgPSAoYmFnZ2FnZSwgbmFtZSwgb3B0aW9ucyA9IHt9KSA9PiBwcm92aWRlMyhcbiAgICBiYWdnYWdlLFxuICAgIG5hbWUsXG4gICAgKCkgPT4gbWFrZVNjYWxhckJpZ1dlYWtTZXRTdG9yZTQobmFtZSwgeyBkdXJhYmxlOiB0cnVlLCAuLi5vcHRpb25zIH0pXG4gICk7XG4gIGhhcmRlbihwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZTQpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBwcm92aWRlRHVyYWJsZU1hcFN0b3JlOiBwcm92aWRlRHVyYWJsZU1hcFN0b3JlNCxcbiAgICBwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZTogcHJvdmlkZUR1cmFibGVXZWFrTWFwU3RvcmU0LFxuICAgIHByb3ZpZGVEdXJhYmxlU2V0U3RvcmU6IHByb3ZpZGVEdXJhYmxlU2V0U3RvcmU0LFxuICAgIHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlOiBwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZTRcbiAgfSk7XG59O1xudmFyIGdsb2JhbFN0b3JlVXRpbHMzID0gbWFrZVN0b3JlVXRpbHMzKFZhdERhdGFHbG9iYWwzKTtcbnZhciB7XG4gIHByb3ZpZGVEdXJhYmxlTWFwU3RvcmU6IHByb3ZpZGVEdXJhYmxlTWFwU3RvcmUzLFxuICBwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZTogcHJvdmlkZUR1cmFibGVXZWFrTWFwU3RvcmUzLFxuICBwcm92aWRlRHVyYWJsZVNldFN0b3JlOiBwcm92aWRlRHVyYWJsZVNldFN0b3JlMyxcbiAgcHJvdmlkZUR1cmFibGVXZWFrU2V0U3RvcmU6IHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlM1xufSA9IGdsb2JhbFN0b3JlVXRpbHMzO1xuXG4vL1xudmFyIGlnbm9yZUNvbnRleHQzID0gKGZuKSA9PiAoX2NvbnRleHQsIC4uLmFyZ3MpID0+IGZuKC4uLmFyZ3MpO1xuaGFyZGVuKGlnbm9yZUNvbnRleHQzKTtcbnZhciBtYWtlRXhvVXRpbHMzID0gKFZhdERhdGEpID0+IHtcbiAgY29uc3Qge1xuICAgIGRlZmluZUtpbmQ6IGRlZmluZUtpbmQ0LFxuICAgIGRlZmluZUtpbmRNdWx0aTogZGVmaW5lS2luZE11bHRpNCxcbiAgICBkZWZpbmVEdXJhYmxlS2luZDogZGVmaW5lRHVyYWJsZUtpbmQ0LFxuICAgIGRlZmluZUR1cmFibGVLaW5kTXVsdGk6IGRlZmluZUR1cmFibGVLaW5kTXVsdGk0LFxuICAgIG1ha2VLaW5kSGFuZGxlOiBtYWtlS2luZEhhbmRsZTRcbiAgfSA9IFZhdERhdGE7XG4gIGNvbnN0IHByb3ZpZGVLaW5kSGFuZGxlNCA9IChiYWdnYWdlLCBraW5kTmFtZSkgPT4gcHJvdmlkZTMoYmFnZ2FnZSwgYCR7a2luZE5hbWV9X2tpbmRIYW5kbGVgLCAoKSA9PiBtYWtlS2luZEhhbmRsZTQoa2luZE5hbWUpKTtcbiAgaGFyZGVuKHByb3ZpZGVLaW5kSGFuZGxlNCk7XG4gIGNvbnN0IHByZXBhcmVLaW5kNCA9IChiYWdnYWdlLCBraW5kTmFtZSwgaW5pdCwgYmVoYXZpb3IsIG9wdGlvbnMgPSB2b2lkIDApID0+IGRlZmluZUR1cmFibGVLaW5kNChcbiAgICBwcm92aWRlS2luZEhhbmRsZTQoYmFnZ2FnZSwga2luZE5hbWUpLFxuICAgIGluaXQsXG4gICAgYmVoYXZpb3IsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUtpbmQ0KTtcbiAgY29uc3QgcHJlcGFyZUtpbmRNdWx0aTQgPSAoYmFnZ2FnZSwga2luZE5hbWUsIGluaXQsIGJlaGF2aW9yLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlS2luZE11bHRpNChcbiAgICBwcm92aWRlS2luZEhhbmRsZTQoYmFnZ2FnZSwga2luZE5hbWUpLFxuICAgIGluaXQsXG4gICAgYmVoYXZpb3IsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUtpbmRNdWx0aTQpO1xuICBjb25zdCBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3M0ID0gKHRhZywgaW50ZXJmYWNlR3VhcmQsIGluaXQsIG1ldGhvZHMsIG9wdGlvbnMpID0+IChcbiAgICAvL1xuICAgIGRlZmluZUtpbmQ0KHRhZywgaW5pdCwgbWV0aG9kcywge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIHRoaXNmdWxNZXRob2RzOiB0cnVlLFxuICAgICAgaW50ZXJmYWNlR3VhcmRcbiAgICB9KVxuICApO1xuICBoYXJkZW4oZGVmaW5lVmlydHVhbEV4b0NsYXNzNCk7XG4gIGNvbnN0IGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdDQgPSAodGFnLCBpbnRlcmZhY2VHdWFyZEtpdCwgaW5pdCwgZmFjZXRzLCBvcHRpb25zKSA9PiAoXG4gICAgLy9cbiAgICBkZWZpbmVLaW5kTXVsdGk0KHRhZywgaW5pdCwgZmFjZXRzLCB7XG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgdGhpc2Z1bE1ldGhvZHM6IHRydWUsXG4gICAgICBpbnRlcmZhY2VHdWFyZEtpdFxuICAgIH0pXG4gICk7XG4gIGhhcmRlbihkZWZpbmVWaXJ0dWFsRXhvQ2xhc3NLaXQ0KTtcbiAgY29uc3QgZGVmaW5lRHVyYWJsZUV4b0NsYXNzNCA9IChraW5kSGFuZGxlLCBpbnRlcmZhY2VHdWFyZCwgaW5pdCwgbWV0aG9kcywgb3B0aW9ucykgPT4gKFxuICAgIC8vXG4gICAgZGVmaW5lRHVyYWJsZUtpbmQ0KGtpbmRIYW5kbGUsIGluaXQsIG1ldGhvZHMsIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICB0aGlzZnVsTWV0aG9kczogdHJ1ZSxcbiAgICAgIGludGVyZmFjZUd1YXJkXG4gICAgfSlcbiAgKTtcbiAgaGFyZGVuKGRlZmluZUR1cmFibGVFeG9DbGFzczQpO1xuICBjb25zdCBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQ0ID0gKGtpbmRIYW5kbGUsIGludGVyZmFjZUd1YXJkS2l0LCBpbml0LCBmYWNldHMsIG9wdGlvbnMpID0+IChcbiAgICAvL1xuICAgIGRlZmluZUR1cmFibGVLaW5kTXVsdGk0KGtpbmRIYW5kbGUsIGluaXQsIGZhY2V0cywge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIHRoaXNmdWxNZXRob2RzOiB0cnVlLFxuICAgICAgaW50ZXJmYWNlR3VhcmRLaXRcbiAgICB9KVxuICApO1xuICBoYXJkZW4oZGVmaW5lRHVyYWJsZUV4b0NsYXNzS2l0NCk7XG4gIGNvbnN0IHByZXBhcmVFeG9DbGFzczQgPSAoYmFnZ2FnZSwga2luZE5hbWUsIGludGVyZmFjZUd1YXJkLCBpbml0LCBtZXRob2RzLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3M0KFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlNChiYWdnYWdlLCBraW5kTmFtZSksXG4gICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgaW5pdCxcbiAgICBtZXRob2RzLFxuICAgIG9wdGlvbnNcbiAgKTtcbiAgaGFyZGVuKHByZXBhcmVFeG9DbGFzczQpO1xuICBjb25zdCBwcmVwYXJlRXhvQ2xhc3NLaXQ0ID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBpbnRlcmZhY2VHdWFyZEtpdCwgaW5pdCwgZmFjZXRzLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQ0KFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlNChiYWdnYWdlLCBraW5kTmFtZSksXG4gICAgaW50ZXJmYWNlR3VhcmRLaXQsXG4gICAgaW5pdCxcbiAgICBmYWNldHMsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUV4b0NsYXNzS2l0NCk7XG4gIGNvbnN0IHByZXBhcmVFeG80ID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBpbnRlcmZhY2VHdWFyZCwgbWV0aG9kcywgb3B0aW9ucyA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IG1ha2VTaW5nbGV0b24gPSBwcmVwYXJlRXhvQ2xhc3M0KFxuICAgICAgYmFnZ2FnZSxcbiAgICAgIGtpbmROYW1lLFxuICAgICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgICBpbml0RW1wdHksXG4gICAgICBtZXRob2RzLFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gICAgcmV0dXJuIHByb3ZpZGUzKGJhZ2dhZ2UsIGAke2tpbmROYW1lfV9zaW5nbGV0b25gLCAoKSA9PiBtYWtlU2luZ2xldG9uKCkpO1xuICB9O1xuICBoYXJkZW4ocHJlcGFyZUV4bzQpO1xuICBjb25zdCBwcmVwYXJlU2luZ2xldG9uNCA9IChiYWdnYWdlLCBraW5kTmFtZSwgbWV0aG9kcywgb3B0aW9ucyA9IHZvaWQgMCkgPT4gcHJlcGFyZUV4bzQoYmFnZ2FnZSwga2luZE5hbWUsIHZvaWQgMCwgbWV0aG9kcywgb3B0aW9ucyk7XG4gIGhhcmRlbihwcmVwYXJlU2luZ2xldG9uNCk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGRlZmluZVZpcnR1YWxFeG9DbGFzczogZGVmaW5lVmlydHVhbEV4b0NsYXNzNCxcbiAgICBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3NLaXQ6IGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdDQsXG4gICAgZGVmaW5lRHVyYWJsZUV4b0NsYXNzOiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3M0LFxuICAgIGRlZmluZUR1cmFibGVFeG9DbGFzc0tpdDogZGVmaW5lRHVyYWJsZUV4b0NsYXNzS2l0NCxcbiAgICBwcmVwYXJlRXhvQ2xhc3M6IHByZXBhcmVFeG9DbGFzczQsXG4gICAgcHJlcGFyZUV4b0NsYXNzS2l0OiBwcmVwYXJlRXhvQ2xhc3NLaXQ0LFxuICAgIHByZXBhcmVFeG86IHByZXBhcmVFeG80LFxuICAgIHByZXBhcmVTaW5nbGV0b246IHByZXBhcmVTaW5nbGV0b240LFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlOiBwcm92aWRlS2luZEhhbmRsZTQsXG4gICAgcHJlcGFyZUtpbmQ6IHByZXBhcmVLaW5kNCxcbiAgICBwcmVwYXJlS2luZE11bHRpOiBwcmVwYXJlS2luZE11bHRpNFxuICB9KTtcbn07XG52YXIgZ2xvYmFsRXhvVXRpbHMzID0gbWFrZUV4b1V0aWxzMyhWYXREYXRhRXhwb3J0Myk7XG52YXIge1xuICBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3M6IGRlZmluZVZpcnR1YWxFeG9DbGFzczMsXG4gIGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdDogZGVmaW5lVmlydHVhbEV4b0NsYXNzS2l0MyxcbiAgZGVmaW5lRHVyYWJsZUV4b0NsYXNzOiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3MzLFxuICBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQ6IGRlZmluZUR1cmFibGVFeG9DbGFzc0tpdDMsXG4gIHByZXBhcmVFeG9DbGFzczogcHJlcGFyZUV4b0NsYXNzMyxcbiAgcHJlcGFyZUV4b0NsYXNzS2l0OiBwcmVwYXJlRXhvQ2xhc3NLaXQzLFxuICBwcmVwYXJlRXhvOiBwcmVwYXJlRXhvMyxcbiAgcHJlcGFyZVNpbmdsZXRvbjogcHJlcGFyZVNpbmdsZXRvbjNcbn0gPSBnbG9iYWxFeG9VdGlsczM7XG52YXIgeyBwcm92aWRlS2luZEhhbmRsZTogcHJvdmlkZUtpbmRIYW5kbGUzLCBwcmVwYXJlS2luZDogcHJlcGFyZUtpbmQzLCBwcmVwYXJlS2luZE11bHRpOiBwcmVwYXJlS2luZE11bHRpMyB9ID0gZ2xvYmFsRXhvVXRpbHMzO1xuXG4vL1xudmFyIGNvZXJjZURlbm9tID0gKGNoYWluSHViLCBkZW5vbUFyZykgPT4ge1xuICBpZiAodHlwZW9mIGRlbm9tQXJnID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIGRlbm9tQXJnO1xuICB9XG4gIGNvbnN0IGRlbm9tID0gY2hhaW5IdWIuZ2V0RGVub20oZGVub21BcmcpO1xuICBpZiAoIWRlbm9tKSB7XG4gICAgdGhyb3cgbWFrZUVycm9yKGBObyBkZW5vbSBmb3IgYnJhbmQgJHtkZW5vbUFyZ31gKTtcbiAgfVxuICByZXR1cm4gZGVub207XG59O1xudmFyIGNvZXJjZURlbm9tQW1vdW50ID0gKGNoYWluSHViLCBhbW91bnQpID0+IHtcbiAgaWYgKFwiZGVub21cIiBpbiBhbW91bnQpIHtcbiAgICByZXR1cm4gYW1vdW50O1xuICB9XG4gIGNvbnN0IGRlbm9tID0gY29lcmNlRGVub20oY2hhaW5IdWIsIGFtb3VudC5icmFuZCk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGRlbm9tLFxuICAgIHZhbHVlOiBhbW91bnQudmFsdWVcbiAgfSk7XG59O1xudmFyIGNvZXJjZUNvaW4gPSAoY2hhaW5IdWIsIGFtb3VudCkgPT4ge1xuICBjb25zdCBkZW5vbSA9IFwiZGVub21cIiBpbiBhbW91bnQgPyBhbW91bnQuZGVub20gOiBjb2VyY2VEZW5vbShjaGFpbkh1YiwgYW1vdW50LmJyYW5kKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgZGVub20sXG4gICAgYW1vdW50OiBTdHJpbmcoYW1vdW50LnZhbHVlKVxuICB9KTtcbn07XG5cbi8vXG52YXIgbWF4Q2xvY2tTa2V3ID0gMTBuICogNjBuO1xudmFyIHRyeURlY29kZVJlc3BvbnNlID0gKGFja1N0ciwgZnJvbVByb3RvTXNnKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgYW55ID0gQW55LmRlY29kZShkZWNvZGVCYXNlNjQoYWNrU3RyKSk7XG4gICAgY29uc3QgcHJvdG9Nc2cgPSBBbnkuZGVjb2RlKGFueS52YWx1ZSk7XG4gICAgY29uc3QgbXNnID0gZnJvbVByb3RvTXNnKHByb3RvTXNnKTtcbiAgICByZXR1cm4gbXNnO1xuICB9IGNhdGNoIChjYXVzZSkge1xuICAgIHRocm93IG1ha2VFcnJvcihgYmFkIHJlc3BvbnNlOiAke2Fja1N0cn1gLCB2b2lkIDAsIHsgY2F1c2UgfSk7XG4gIH1cbn07XG52YXIgdG9EZW5vbUFtb3VudCA9IChjMikgPT4gKHsgZGVub206IGMyLmRlbm9tLCB2YWx1ZTogQmlnSW50KGMyLmFtb3VudCkgfSk7XG52YXIgdG9UcnVuY2F0ZWREZW5vbUFtb3VudCA9IChjMikgPT4gKHtcbiAgZGVub206IGMyLmRlbm9tLFxuICB2YWx1ZTogQmlnSW50KGMyLmFtb3VudC5zcGxpdChcIi5cIilbMF0pXG59KTtcbnZhciB0b0Nvc21vc1ZhbGlkYXRvckFkZHJlc3MgPSAocjYsIGNoYWluSWQpID0+ICh7XG4gIGVuY29kaW5nOiBcImJlY2gzMlwiLFxuICB2YWx1ZTogKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICByNi52YWxpZGF0b3JBZGRyZXNzXG4gICksXG4gIGNoYWluSWRcbn0pO1xudmFyIHRvQ29zbW9zRGVsZWdhdGlvblJlc3BvbnNlID0gKHsgY2hhaW5JZCB9LCByNikgPT4gKHtcbiAgZGVsZWdhdG9yOiB7XG4gICAgY2hhaW5JZCxcbiAgICBlbmNvZGluZzogXCJiZWNoMzJcIixcbiAgICB2YWx1ZTogKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgcjYuZGVsZWdhdGlvbi5kZWxlZ2F0b3JBZGRyZXNzXG4gICAgKVxuICB9LFxuICB2YWxpZGF0b3I6IHRvQ29zbW9zVmFsaWRhdG9yQWRkcmVzcyhyNi5kZWxlZ2F0aW9uLCBjaGFpbklkKSxcbiAgYW1vdW50OiB0b0Rlbm9tQW1vdW50KHI2LmJhbGFuY2UpXG59KTtcblxuLy9cbnZhciBlbXB0eSA9IDBuO1xudmFyIG5hdE1hdGhIZWxwZXJzID0gaGFyZGVuKHtcbiAgZG9Db2VyY2U6IChuYXQpID0+IHtcbiAgICBhc3NlcnQudHlwZW9mKG5hdCwgXCJiaWdpbnRcIik7XG4gICAgaXNOYXQobmF0KSB8fCB0aHJvd1JlZGFjdGVkYHZhbHVlICR7bmF0fSBtdXN0IGJlIGEgbmF0dXJhbCBudW1iZXJgO1xuICAgIHJldHVybiBOYXQobmF0KTtcbiAgfSxcbiAgZG9NYWtlRW1wdHk6ICgpID0+IGVtcHR5LFxuICBkb0lzRW1wdHk6IChuYXQpID0+IG5hdCA9PT0gZW1wdHksXG4gIGRvSXNHVEU6IChsZWZ0LCByaWdodCkgPT4gbGVmdCA+PSByaWdodCxcbiAgZG9Jc0VxdWFsOiAobGVmdCwgcmlnaHQpID0+IGxlZnQgPT09IHJpZ2h0LFxuICAvL1xuICBkb0FkZDogKGxlZnQsIHJpZ2h0KSA9PiBsZWZ0ICsgcmlnaHQsXG4gIGRvU3VidHJhY3Q6IChsZWZ0LCByaWdodCkgPT4gTmF0KGxlZnQgLSByaWdodClcbn0pO1xuXG4vL1xudmFyIGVtcHR5MiA9IGhhcmRlbihbXSk7XG52YXIgc2V0TWF0aEhlbHBlcnMgPSBoYXJkZW4oe1xuICBkb0NvZXJjZTogKGxpc3QpID0+IHtcbiAgICBsaXN0ID0gY29lcmNlVG9FbGVtZW50cyhsaXN0KTtcbiAgICBhc3NlcnRLZXkobGlzdCk7XG4gICAgcmV0dXJuIGxpc3Q7XG4gIH0sXG4gIGRvTWFrZUVtcHR5OiAoKSA9PiBlbXB0eTIsXG4gIGRvSXNFbXB0eTogKGxpc3QpID0+IHBhc3NTdHlsZU9mKGxpc3QpID09PSBcImNvcHlBcnJheVwiICYmIGxpc3QubGVuZ3RoID09PSAwLFxuICBkb0lzR1RFOiBlbGVtZW50c0lzU3VwZXJzZXQsXG4gIGRvSXNFcXVhbDogKHgsIHkpID0+IGVsZW1lbnRzQ29tcGFyZSh4LCB5KSA9PT0gMCxcbiAgZG9BZGQ6IGVsZW1lbnRzRGlzam9pbnRVbmlvbixcbiAgZG9TdWJ0cmFjdDogZWxlbWVudHNEaXNqb2ludFN1YnRyYWN0XG59KTtcblxuLy9cbnZhciBlbXB0eTMgPSBtYWtlQ29weVNldChbXSk7XG52YXIgY29weVNldE1hdGhIZWxwZXJzID0gaGFyZGVuKHtcbiAgZG9Db2VyY2U6IChzZXQpID0+IHtcbiAgICBtdXN0TWF0Y2gzKHNldCwgTS5zZXQoKSwgXCJzZXQgb2YgYW1vdW50XCIpO1xuICAgIHJldHVybiBzZXQ7XG4gIH0sXG4gIGRvTWFrZUVtcHR5OiAoKSA9PiBlbXB0eTMsXG4gIGRvSXNFbXB0eTogKHNldCkgPT4gZ2V0Q29weVNldEtleXMoc2V0KS5sZW5ndGggPT09IDAsXG4gIGRvSXNHVEU6IHNldElzU3VwZXJzZXQsXG4gIGRvSXNFcXVhbDoga2V5RVEsXG4gIGRvQWRkOiBzZXREaXNqb2ludFVuaW9uLFxuICBkb1N1YnRyYWN0OiBzZXREaXNqb2ludFN1YnRyYWN0XG59KTtcblxuLy9cbnZhciBlbXB0eTQgPSBtYWtlQ29weUJhZyhbXSk7XG52YXIgY29weUJhZ01hdGhIZWxwZXJzID0gaGFyZGVuKHtcbiAgZG9Db2VyY2U6IChiYWcpID0+IHtcbiAgICBtdXN0TWF0Y2gzKGJhZywgTS5iYWcoKSwgXCJiYWcgb2YgYW1vdW50XCIpO1xuICAgIHJldHVybiBiYWc7XG4gIH0sXG4gIGRvTWFrZUVtcHR5OiAoKSA9PiBlbXB0eTQsXG4gIGRvSXNFbXB0eTogKGJhZykgPT4gZ2V0Q29weUJhZ0VudHJpZXMoYmFnKS5sZW5ndGggPT09IDAsXG4gIGRvSXNHVEU6IGJhZ0lzU3VwZXJiYWcsXG4gIGRvSXNFcXVhbDoga2V5RVEsXG4gIGRvQWRkOiBiYWdVbmlvbixcbiAgZG9TdWJ0cmFjdDogYmFnRGlzam9pbnRTdWJ0cmFjdFxufSk7XG5cbi8vXG52YXIgQXNzZXRLaW5kID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgTkFUOiBcIm5hdFwiLFxuICAgIFNFVDogXCJzZXRcIixcbiAgICBDT1BZX1NFVDogXCJjb3B5U2V0XCIsXG4gICAgQ09QWV9CQUc6IFwiY29weUJhZ1wiXG4gIH1cbik7XG5oYXJkZW4oQXNzZXRLaW5kKTtcbnZhciBhc3NldEtpbmROYW1lcyA9IGhhcmRlbihPYmplY3QudmFsdWVzKEFzc2V0S2luZCkuc29ydCgpKTtcbnZhciBhc3NlcnRBc3NldEtpbmQgPSAoYWxsZWdlZEFLKSA9PiB7XG4gIGFzc2V0S2luZE5hbWVzLmluY2x1ZGVzKGFsbGVnZWRBSykgfHwgdGhyb3dSZWRhY3RlZGBUaGUgYXNzZXRLaW5kICR7YWxsZWdlZEFLfSBtdXN0IGJlIG9uZSBvZiAke3F1b3RlKGFzc2V0S2luZE5hbWVzKX1gO1xufTtcbmhhcmRlbihhc3NlcnRBc3NldEtpbmQpO1xudmFyIGhlbHBlcnMgPSB7XG4gIG5hdDogbmF0TWF0aEhlbHBlcnMsXG4gIHNldDogc2V0TWF0aEhlbHBlcnMsXG4gIGNvcHlTZXQ6IGNvcHlTZXRNYXRoSGVscGVycyxcbiAgY29weUJhZzogY29weUJhZ01hdGhIZWxwZXJzXG59O1xudmFyIGFzc2VydFZhbHVlR2V0QXNzZXRLaW5kID0gKHZhbHVlKSA9PiB7XG4gIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHZhbHVlKTtcbiAgaWYgKHBhc3NTdHlsZSA9PT0gXCJiaWdpbnRcIikge1xuICAgIHJldHVybiBcIm5hdFwiO1xuICB9XG4gIGlmIChwYXNzU3R5bGUgPT09IFwiY29weUFycmF5XCIpIHtcbiAgICByZXR1cm4gXCJzZXRcIjtcbiAgfVxuICBpZiAobWF0Y2hlcyh2YWx1ZSwgTS5zZXQoKSkpIHtcbiAgICByZXR1cm4gXCJjb3B5U2V0XCI7XG4gIH1cbiAgaWYgKG1hdGNoZXModmFsdWUsIE0uYmFnKCkpKSB7XG4gICAgcmV0dXJuIFwiY29weUJhZ1wiO1xuICB9XG4gIHRocm93IHRocm93UmVkYWN0ZWRgdmFsdWUgJHt2YWx1ZX0gbXVzdCBiZSBhIGJpZ2ludCwgY29weVNldCwgY29weUJhZywgb3IgYW4gYXJyYXksIG5vdCAke3F1b3RlKFxuICAgIHBhc3NTdHlsZVxuICApfWA7XG59O1xudmFyIGFzc2VydFZhbHVlR2V0SGVscGVycyA9ICh2YWx1ZSkgPT4gKFxuICAvL1xuICBoZWxwZXJzW2Fzc2VydFZhbHVlR2V0QXNzZXRLaW5kKHZhbHVlKV1cbik7XG52YXIgb3B0aW9uYWxCcmFuZENoZWNrID0gKGFsbGVnZWRCcmFuZCwgYnJhbmQpID0+IHtcbiAgaWYgKGJyYW5kICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRSZW1vdGFibGUoYnJhbmQsIFwiYnJhbmRcIik7XG4gICAgYWxsZWdlZEJyYW5kID09PSBicmFuZCB8fCB0aHJvd1JlZGFjdGVkYGFtb3VudCdzIGJyYW5kICR7cXVvdGUoYWxsZWdlZEJyYW5kKX0gZGlkIG5vdCBtYXRjaCBleHBlY3RlZCBicmFuZCAke3F1b3RlKFxuICAgICAgYnJhbmRcbiAgICApfWA7XG4gIH1cbn07XG52YXIgY2hlY2tMUkFuZEdldEhlbHBlcnMgPSAobGVmdEFtb3VudCwgcmlnaHRBbW91bnQsIGJyYW5kID0gdm9pZCAwKSA9PiB7XG4gIGFzc2VydFJlY29yZChsZWZ0QW1vdW50LCBcImxlZnRBbW91bnRcIik7XG4gIGFzc2VydFJlY29yZChyaWdodEFtb3VudCwgXCJyaWdodEFtb3VudFwiKTtcbiAgY29uc3QgeyB2YWx1ZTogbGVmdFZhbHVlLCBicmFuZDogbGVmdEJyYW5kIH0gPSBsZWZ0QW1vdW50O1xuICBjb25zdCB7IHZhbHVlOiByaWdodFZhbHVlLCBicmFuZDogcmlnaHRCcmFuZCB9ID0gcmlnaHRBbW91bnQ7XG4gIGFzc2VydFJlbW90YWJsZShsZWZ0QnJhbmQsIFwibGVmdEJyYW5kXCIpO1xuICBhc3NlcnRSZW1vdGFibGUocmlnaHRCcmFuZCwgXCJyaWdodEJyYW5kXCIpO1xuICBvcHRpb25hbEJyYW5kQ2hlY2sobGVmdEJyYW5kLCBicmFuZCk7XG4gIG9wdGlvbmFsQnJhbmRDaGVjayhyaWdodEJyYW5kLCBicmFuZCk7XG4gIGxlZnRCcmFuZCA9PT0gcmlnaHRCcmFuZCB8fCB0aHJvd1JlZGFjdGVkYEJyYW5kcyBpbiBsZWZ0ICR7cXVvdGUobGVmdEJyYW5kKX0gYW5kIHJpZ2h0ICR7cXVvdGUoXG4gICAgcmlnaHRCcmFuZFxuICApfSBzaG91bGQgbWF0Y2ggYnV0IGRvIG5vdGA7XG4gIGNvbnN0IGxlZnRIZWxwZXJzID0gYXNzZXJ0VmFsdWVHZXRIZWxwZXJzKGxlZnRWYWx1ZSk7XG4gIGNvbnN0IHJpZ2h0SGVscGVycyA9IGFzc2VydFZhbHVlR2V0SGVscGVycyhyaWdodFZhbHVlKTtcbiAgbGVmdEhlbHBlcnMgPT09IHJpZ2h0SGVscGVycyB8fCB0aHJvd1JlZGFjdGVkYFRoZSBsZWZ0ICR7bGVmdEFtb3VudH0gYW5kIHJpZ2h0IGFtb3VudCAke3JpZ2h0QW1vdW50fSBoYWQgZGlmZmVyZW50IGFzc2V0S2luZHNgO1xuICByZXR1cm4gbGVmdEhlbHBlcnM7XG59O1xudmFyIGNvZXJjZUxSID0gKGgsIGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50KSA9PiB7XG4gIHJldHVybiBbaC5kb0NvZXJjZShsZWZ0QW1vdW50LnZhbHVlKSwgaC5kb0NvZXJjZShyaWdodEFtb3VudC52YWx1ZSldO1xufTtcbnZhciBpc0dURSA9IChsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQgPSB2b2lkIDApID0+IHtcbiAgY29uc3QgaCA9IGNoZWNrTFJBbmRHZXRIZWxwZXJzKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCk7XG4gIHJldHVybiBoLmRvSXNHVEUoLi4uY29lcmNlTFIoaCwgbGVmdEFtb3VudCwgcmlnaHRBbW91bnQpKTtcbn07XG52YXIgQW1vdW50TWF0aCA9IHtcbiAgLy9cbiAgLy9cbiAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgKi9cbiAgbWFrZTogKGJyYW5kLCBhbGxlZ2VkVmFsdWUpID0+IHtcbiAgICBhc3NlcnRSZW1vdGFibGUoYnJhbmQsIFwiYnJhbmRcIik7XG4gICAgY29uc3QgaCA9IGFzc2VydFZhbHVlR2V0SGVscGVycyhhbGxlZ2VkVmFsdWUpO1xuICAgIGNvbnN0IHZhbHVlID0gaC5kb0NvZXJjZShhbGxlZ2VkVmFsdWUpO1xuICAgIHJldHVybiBoYXJkZW4oeyBicmFuZCwgdmFsdWUgfSk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuXG5cbiAgICovXG4gIGNvZXJjZTogKGJyYW5kLCBhbGxlZ2VkQW1vdW50KSA9PiB7XG4gICAgYXNzZXJ0UmVtb3RhYmxlKGJyYW5kLCBcImJyYW5kXCIpO1xuICAgIGFzc2VydFJlY29yZChhbGxlZ2VkQW1vdW50LCBcImFtb3VudFwiKTtcbiAgICBjb25zdCB7IGJyYW5kOiBhbGxlZ2VkQnJhbmQsIHZhbHVlOiBhbGxlZ2VkVmFsdWUgfSA9IGFsbGVnZWRBbW91bnQ7XG4gICAgYnJhbmQgPT09IGFsbGVnZWRCcmFuZCB8fCB0aHJvd1JlZGFjdGVkYFRoZSBicmFuZCBpbiB0aGUgYWxsZWdlZEFtb3VudCAke2FsbGVnZWRBbW91bnR9IGluICdjb2VyY2UnIGRpZG4ndCBtYXRjaCB0aGUgc3BlY2lmaWVkIGJyYW5kICR7YnJhbmR9LmA7XG4gICAgcmV0dXJuIEFtb3VudE1hdGgubWFrZShicmFuZCwgYWxsZWdlZFZhbHVlKTtcbiAgfSxcbiAgLypcblxuXG5cblxuXG5cbiAgICovXG4gIGdldFZhbHVlOiAoYnJhbmQsIGFtb3VudCkgPT4gQW1vdW50TWF0aC5jb2VyY2UoYnJhbmQsIGFtb3VudCkudmFsdWUsXG4gIC8qXG5cblxuXG5cblxuXG5cbiAgICovXG4gIG1ha2VFbXB0eTogKGJyYW5kLCBhc3NldEtpbmQgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICBcIm5hdFwiXG4gICkpID0+IHtcbiAgICBhc3NlcnRSZW1vdGFibGUoYnJhbmQsIFwiYnJhbmRcIik7XG4gICAgYXNzZXJ0QXNzZXRLaW5kKGFzc2V0S2luZCk7XG4gICAgY29uc3QgdmFsdWUgPSBoZWxwZXJzW2Fzc2V0S2luZF0uZG9NYWtlRW1wdHkoKTtcbiAgICByZXR1cm4gaGFyZGVuKHsgYnJhbmQsIHZhbHVlIH0pO1xuICB9LFxuICAvKlxuXG5cblxuXG5cblxuICAgKi9cbiAgbWFrZUVtcHR5RnJvbUFtb3VudDogKGFtb3VudCkgPT4ge1xuICAgIGFzc2VydFJlY29yZChhbW91bnQsIFwiYW1vdW50XCIpO1xuICAgIGNvbnN0IHsgYnJhbmQsIHZhbHVlIH0gPSBhbW91bnQ7XG4gICAgY29uc3QgYXNzZXRLaW5kID0gYXNzZXJ0VmFsdWVHZXRBc3NldEtpbmQodmFsdWUpO1xuICAgIHJldHVybiBBbW91bnRNYXRoLm1ha2VFbXB0eShicmFuZCwgYXNzZXRLaW5kKTtcbiAgfSxcbiAgLypcblxuXG5cblxuXG4gICAqL1xuICBpc0VtcHR5OiAoYW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICAgIGFzc2VydFJlY29yZChhbW91bnQsIFwiYW1vdW50XCIpO1xuICAgIGNvbnN0IHsgYnJhbmQ6IGFsbGVnZWRCcmFuZCwgdmFsdWUgfSA9IGFtb3VudDtcbiAgICBhc3NlcnRSZW1vdGFibGUoYWxsZWdlZEJyYW5kLCBcImJyYW5kXCIpO1xuICAgIG9wdGlvbmFsQnJhbmRDaGVjayhhbGxlZ2VkQnJhbmQsIGJyYW5kKTtcbiAgICBjb25zdCBoID0gYXNzZXJ0VmFsdWVHZXRIZWxwZXJzKHZhbHVlKTtcbiAgICByZXR1cm4gaC5kb0lzRW1wdHkoaC5kb0NvZXJjZSh2YWx1ZSkpO1xuICB9LFxuICBpc0dURSxcbiAgLypcblxuXG5cblxuXG5cblxuXG4gICAqL1xuICBpc0VxdWFsOiAobGVmdEFtb3VudCwgcmlnaHRBbW91bnQsIGJyYW5kID0gdm9pZCAwKSA9PiB7XG4gICAgY29uc3QgaCA9IGNoZWNrTFJBbmRHZXRIZWxwZXJzKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCk7XG4gICAgcmV0dXJuIGguZG9Jc0VxdWFsKC4uLmNvZXJjZUxSKGgsIGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50KSk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgKi9cbiAgYWRkOiAobGVmdEFtb3VudCwgcmlnaHRBbW91bnQsIGJyYW5kID0gdm9pZCAwKSA9PiB7XG4gICAgY29uc3QgaCA9IGNoZWNrTFJBbmRHZXRIZWxwZXJzKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCk7XG4gICAgY29uc3QgdmFsdWUgPSBoLmRvQWRkKC4uLmNvZXJjZUxSKGgsIGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50KSk7XG4gICAgcmV0dXJuIGhhcmRlbih7IGJyYW5kOiBsZWZ0QW1vdW50LmJyYW5kLCB2YWx1ZSB9KTtcbiAgfSxcbiAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICovXG4gIHN1YnRyYWN0OiAobGVmdEFtb3VudCwgcmlnaHRBbW91bnQsIGJyYW5kID0gdm9pZCAwKSA9PiB7XG4gICAgY29uc3QgaCA9IGNoZWNrTFJBbmRHZXRIZWxwZXJzKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCk7XG4gICAgY29uc3QgdmFsdWUgPSBoLmRvU3VidHJhY3QoLi4uY29lcmNlTFIoaCwgbGVmdEFtb3VudCwgcmlnaHRBbW91bnQpKTtcbiAgICByZXR1cm4gaGFyZGVuKHsgYnJhbmQ6IGxlZnRBbW91bnQuYnJhbmQsIHZhbHVlIH0pO1xuICB9LFxuICAvKlxuXG5cblxuXG5cblxuXG4gICAqL1xuICBtaW46ICh4LCB5LCBicmFuZCA9IHZvaWQgMCkgPT4gKFxuICAgIC8vXG4gICAgaXNHVEUoeCwgeSwgYnJhbmQpID8geSA6IGlzR1RFKHksIHgsIGJyYW5kKSA/IHggOiB0aHJvd1JlZGFjdGVkYCR7eH0gYW5kICR7eX0gYXJlIGluY29tcGFyYWJsZWBcbiAgKSxcbiAgLypcblxuXG5cblxuXG5cblxuICAgKi9cbiAgbWF4OiAoeCwgeSwgYnJhbmQgPSB2b2lkIDApID0+IChcbiAgICAvL1xuICAgIGlzR1RFKHgsIHksIGJyYW5kKSA/IHggOiBpc0dURSh5LCB4KSA/IHkgOiB0aHJvd1JlZGFjdGVkYCR7eH0gYW5kICR7eX0gYXJlIGluY29tcGFyYWJsZWBcbiAgKVxufTtcbmhhcmRlbihBbW91bnRNYXRoKTtcbnZhciBnZXRBc3NldEtpbmQgPSAoYW1vdW50KSA9PiB7XG4gIGFzc2VydFJlY29yZChhbW91bnQsIFwiYW1vdW50XCIpO1xuICBjb25zdCB7IHZhbHVlIH0gPSBhbW91bnQ7XG4gIHJldHVybiBhc3NlcnRWYWx1ZUdldEFzc2V0S2luZCh2YWx1ZSk7XG59O1xuaGFyZGVuKGdldEFzc2V0S2luZCk7XG5cbi8vXG52YXIgY29lcmNlRGlzcGxheUluZm8gPSAoYWxsZWdlZERpc3BsYXlJbmZvLCBhc3NldEtpbmQpID0+IHtcbiAgbXVzdE1hdGNoMyhhbGxlZ2VkRGlzcGxheUluZm8sIERpc3BsYXlJbmZvU2hhcGUsIFwiZGlzcGxheUluZm9cIik7XG4gIGlmIChhbGxlZ2VkRGlzcGxheUluZm8uYXNzZXRLaW5kICE9PSB2b2lkIDApIHtcbiAgICBhbGxlZ2VkRGlzcGxheUluZm8uYXNzZXRLaW5kID09PSBhc3NldEtpbmQgfHwgdGhyb3dSZWRhY3RlZGBkaXNwbGF5SW5mby5hc3NldEtpbmQgd2FzIHByZXNlbnQgKCR7YWxsZWdlZERpc3BsYXlJbmZvLmFzc2V0S2luZH0pIGFuZCBkaWQgbm90IG1hdGNoIHRoZSBhc3NldEtpbmQgYXJndW1lbnQgKCR7YXNzZXRLaW5kfSlgO1xuICB9XG4gIGNvbnN0IGRpc3BsYXlJbmZvID0gaGFyZGVuKHsgLi4uYWxsZWdlZERpc3BsYXlJbmZvLCBhc3NldEtpbmQgfSk7XG4gIGlmIChkaXNwbGF5SW5mby5kZWNpbWFsUGxhY2VzICE9PSB2b2lkIDApIHtcbiAgICBOdW1iZXIuaXNTYWZlSW50ZWdlcihkaXNwbGF5SW5mby5kZWNpbWFsUGxhY2VzKSB8fCB0aHJvd1JlZGFjdGVkYGRlY2ltYWxQbGFjZXMgJHtkaXNwbGF5SW5mby5kZWNpbWFsUGxhY2VzfSBpcyBub3QgYSBzYWZlIGludGVnZXJgO1xuICB9XG4gIHJldHVybiBkaXNwbGF5SW5mbztcbn07XG5cbi8vXG52YXIgcHJlcGFyZVBheW1lbnRLaW5kID0gKGlzc3VlclpvbmUsIG5hbWUsIGJyYW5kLCBQYXltZW50SSkgPT4ge1xuICBjb25zdCBtYWtlUGF5bWVudCA9IGlzc3VlclpvbmUuZXhvQ2xhc3MoXG4gICAgYCR7bmFtZX0gcGF5bWVudGAsXG4gICAgUGF5bWVudEksXG4gICAgaW5pdEVtcHR5LFxuICAgIHtcbiAgICAgIGdldEFsbGVnZWRCcmFuZCgpIHtcbiAgICAgICAgcmV0dXJuIGJyYW5kO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuIG1ha2VQYXltZW50O1xufTtcbmhhcmRlbihwcmVwYXJlUGF5bWVudEtpbmQpO1xuXG4vL1xudmFyIHNpbms1ID0gKCkgPT4ge1xufTtcbnZhciBtYWtlUXVpZXRSZWplY3Rpb24yID0gKHJlYXNvbikgPT4ge1xuICBjb25zdCByZWplY3Rpb24gPSBoYXJkZW4oUHJvbWlzZS5yZWplY3QocmVhc29uKSk7XG4gIHZvaWQgRS53aGVuKHJlamVjdGlvbiwgc2luazUsIHNpbms1KTtcbiAgcmV0dXJuIHJlamVjdGlvbjtcbn07XG52YXIgdG9vRmFyUmVqZWN0aW9uMiA9IG1ha2VRdWlldFJlamVjdGlvbjIoXG4gIGhhcmRlbihFcnJvcihcIkNhbm5vdCByZWFkIHBhc3QgZW5kIG9mIGl0ZXJhdGlvbi5cIikpXG4pO1xudmFyIFB1Ymxpc2hlckkyID0gTS5pbnRlcmZhY2UoXCJQdWJsaXNoZXJcIiwge1xuICBwdWJsaXNoOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucygpLFxuICBmaW5pc2g6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKCksXG4gIGZhaWw6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKClcbn0pO1xudmFyIFVwZGF0ZUNvdW50U2hhcGUyID0gTS5vcihNLmJpZ2ludCgpLCBNLm51bWJlcigpKTtcbnZhciBTdWJzY3JpYmVySTIgPSBNLmludGVyZmFjZShcIlN1YnNjcmliZXJcIiwge1xuICBzdWJzY3JpYmVBZnRlcjogTS5jYWxsKCkub3B0aW9uYWwoTS5iaWdpbnQoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldFVwZGF0ZVNpbmNlOiBNLmNhbGwoKS5vcHRpb25hbChVcGRhdGVDb3VudFNoYXBlMikucmV0dXJucyhNLnByb21pc2UoKSlcbn0pO1xudmFyIHB1Ymxpc2hLaXRJS2l0MiA9IGhhcmRlbih7XG4gIHB1Ymxpc2hlcjogUHVibGlzaGVySTIsXG4gIHN1YnNjcmliZXI6IFN1YnNjcmliZXJJMlxufSk7XG52YXIgRm9ya2FibGVBc3luY0l0ZXJhYmxlSXRlcmF0b3JTaGFwZTIgPSBNLmludGVyZmFjZShcbiAgXCJGb3JrYWJsZUFzeW5jSXRlcmFibGVJdGVyYXRvclwiLFxuICB7XG4gICAgZm9yazogTS5jYWxsKCkucmV0dXJucyhNLmFueSgpKSxcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiBNLmNhbGwoKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgIC8vXG4gICAgbmV4dDogTS5jYWxsV2hlbigpLnJldHVybnMoTS5hbnkoKSlcbiAgfVxuKTtcbnZhciBJdGVyYWJsZUVhY2hUb3BpY0kyID0gTS5pbnRlcmZhY2UoXCJJdGVyYWJsZUVhY2hUb3BpY1wiLCB7XG4gIHN1YnNjcmliZUFmdGVyOiBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQoU3Vic2NyaWJlckkyKS5tZXRob2RHdWFyZHMuc3Vic2NyaWJlQWZ0ZXIsXG4gIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06IE0uY2FsbCgpLnJldHVybnMoXG4gICAgTS5yZW1vdGFibGUoXCJGb3JrYWJsZUFzeW5jSXRlcmFibGVJdGVyYXRvclwiKVxuICApXG59KTtcbnZhciBJdGVyYWJsZUxhdGVzdFRvcGljSTIgPSBNLmludGVyZmFjZShcIkl0ZXJhYmxlTGF0ZXN0VG9waWNcIiwge1xuICBnZXRVcGRhdGVTaW5jZTogZ2V0SW50ZXJmYWNlR3VhcmRQYXlsb2FkKFN1YnNjcmliZXJJMikubWV0aG9kR3VhcmRzLmdldFVwZGF0ZVNpbmNlLFxuICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiBNLmNhbGwoKS5yZXR1cm5zKFxuICAgIE0ucmVtb3RhYmxlKFwiRm9ya2FibGVBc3luY0l0ZXJhYmxlSXRlcmF0b3JcIilcbiAgKVxufSk7XG52YXIgd2Vha01lbW9pemVVbmFyeTIgPSAoZm4pID0+IHtcbiAgY29uc3QgY2FjaGUgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgcmV0dXJuIChhcmcpID0+IHtcbiAgICBjb25zdCBvYXJnID0gYXJnO1xuICAgIGlmIChjYWNoZS5oYXMob2FyZykpIHtcbiAgICAgIHJldHVybiBjYWNoZS5nZXQob2FyZyk7XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdCA9IGZuKGFyZyk7XG4gICAgY2FjaGUuc2V0KG9hcmcsIHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbn07XG52YXIgbWFrZVVwZGF0ZVJlY29yZEZyb21QdWJsaWNhdGlvblJlY29yZDIgPSAocmVjb3JkKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBoZWFkOiB7IHZhbHVlLCBkb25lIH0sXG4gICAgcHVibGlzaENvdW50XG4gIH0gPSByZWNvcmQ7XG4gIGlmIChkb25lKSB7XG4gICAgcmV0dXJuIGhhcmRlbih7IHZhbHVlLCB1cGRhdGVDb3VudDogdm9pZCAwIH0pO1xuICB9XG4gIHJldHVybiBoYXJkZW4oeyB2YWx1ZSwgdXBkYXRlQ291bnQ6IHB1Ymxpc2hDb3VudCB9KTtcbn07XG52YXIgbWFrZVB1Ymxpc2hLaXQyID0gKCkgPT4ge1xuICBsZXQgdGFpbFA7XG4gIGxldCB0YWlsUjtcbiAgKHsgcHJvbWlzZTogdGFpbFAsIHJlc29sdmU6IHRhaWxSIH0gPSBtYWtlUHJvbWlzZUtpdCgpKTtcbiAgbGV0IGN1cnJlbnRQdWJsaXNoQ291bnQgPSAwbjtcbiAgbGV0IGN1cnJlbnRQID0gdGFpbFA7XG4gIGNvbnN0IGFkdmFuY2VDdXJyZW50ID0gKGRvbmUsIHZhbHVlLCByZWplY3Rpb24pID0+IHtcbiAgICBpZiAodGFpbFIgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgRXJyb3IoXCJDYW5ub3QgdXBkYXRlIHN0YXRlIGFmdGVyIHRlcm1pbmF0aW9uLlwiKTtcbiAgICB9XG4gICAgY3VycmVudFB1Ymxpc2hDb3VudCArPSAxbjtcbiAgICBjdXJyZW50UCA9IHRhaWxQO1xuICAgIGNvbnN0IHJlc29sdmVDdXJyZW50ID0gdGFpbFI7XG4gICAgaWYgKGRvbmUpIHtcbiAgICAgIHRhaWxQID0gdG9vRmFyUmVqZWN0aW9uMjtcbiAgICAgIHRhaWxSID0gdm9pZCAwO1xuICAgIH0gZWxzZSB7XG4gICAgICAoeyBwcm9taXNlOiB0YWlsUCwgcmVzb2x2ZTogdGFpbFIgfSA9IG1ha2VQcm9taXNlS2l0KCkpO1xuICAgIH1cbiAgICBpZiAocmVqZWN0aW9uKSB7XG4gICAgICByZXNvbHZlQ3VycmVudChyZWplY3Rpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNvbHZlQ3VycmVudChcbiAgICAgICAgaGFyZGVuKHtcbiAgICAgICAgICBoZWFkOiB7IHZhbHVlLCBkb25lIH0sXG4gICAgICAgICAgcHVibGlzaENvdW50OiBjdXJyZW50UHVibGlzaENvdW50LFxuICAgICAgICAgIHRhaWw6IHRhaWxQXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgbWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkID0gd2Vha01lbW9pemVVbmFyeTIoXG4gICAgbWFrZVVwZGF0ZVJlY29yZEZyb21QdWJsaWNhdGlvblJlY29yZDJcbiAgKTtcbiAgY29uc3Qgc3Vic2NyaWJlciA9IEZhcihcIlN1YnNjcmliZXJcIiwge1xuICAgIHN1YnNjcmliZUFmdGVyOiAocHVibGlzaENvdW50ID0gLTFuKSA9PiB7XG4gICAgICBhc3NlcnQudHlwZW9mKHB1Ymxpc2hDb3VudCwgXCJiaWdpbnRcIik7XG4gICAgICBpZiAocHVibGlzaENvdW50ID09PSBjdXJyZW50UHVibGlzaENvdW50KSB7XG4gICAgICAgIHJldHVybiB0YWlsUDtcbiAgICAgIH0gZWxzZSBpZiAocHVibGlzaENvdW50IDwgY3VycmVudFB1Ymxpc2hDb3VudCkge1xuICAgICAgICByZXR1cm4gY3VycmVudFA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICBcInN1YnNjcmliZUFmdGVyIGFyZ3VtZW50IG11c3QgYmUgYSBwcmV2aW91c2x5LWlzc3VlZCBwdWJsaXNoQ291bnQuXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGdldFVwZGF0ZVNpbmNlOiAodXBkYXRlQ291bnQpID0+IHtcbiAgICAgIGlmICh1cGRhdGVDb3VudCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybiBzdWJzY3JpYmVyLnN1YnNjcmliZUFmdGVyKCkudGhlbihtYWtlTWVtb2l6ZWRVcGRhdGVSZWNvcmQpO1xuICAgICAgfVxuICAgICAgdXBkYXRlQ291bnQgPSBCaWdJbnQodXBkYXRlQ291bnQpO1xuICAgICAgcmV0dXJuIHN1YnNjcmliZXIuc3Vic2NyaWJlQWZ0ZXIodXBkYXRlQ291bnQpLnRoZW4oKCkgPT4gc3Vic2NyaWJlci5nZXRVcGRhdGVTaW5jZSgpKTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBwdWJsaXNoZXIgPSBGYXIoXCJQdWJsaXNoZXJcIiwge1xuICAgIHB1Ymxpc2g6ICh2YWx1ZSkgPT4ge1xuICAgICAgYWR2YW5jZUN1cnJlbnQoZmFsc2UsIHZhbHVlKTtcbiAgICB9LFxuICAgIGZpbmlzaDogKGZpbmFsVmFsdWUpID0+IHtcbiAgICAgIGFkdmFuY2VDdXJyZW50KHRydWUsIGZpbmFsVmFsdWUpO1xuICAgIH0sXG4gICAgZmFpbDogKHJlYXNvbikgPT4ge1xuICAgICAgYWR2YW5jZUN1cnJlbnQodHJ1ZSwgdm9pZCAwLCBtYWtlUXVpZXRSZWplY3Rpb24yKHJlYXNvbikpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oeyBwdWJsaXNoZXIsIHN1YnNjcmliZXIgfSk7XG59O1xuaGFyZGVuKG1ha2VQdWJsaXNoS2l0Mik7XG52YXIgRHVyYWJsZVB1Ymxpc2hLaXRTdGF0ZVNoYXBlMiA9IGhhcmRlbih7XG4gIHZhbHVlRHVyYWJpbGl0eTogTS5hbnkoKSxcbiAgcHVibGlzaENvdW50OiBNLmFueSgpLFxuICBzdGF0dXM6IE0uYW55KCksXG4gIGhhc1ZhbHVlOiBNLmFueSgpLFxuICB2YWx1ZTogTS5hbnkoKVxufSk7XG52YXIgaW5pdER1cmFibGVQdWJsaXNoS2l0U3RhdGUyID0gKG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7IHZhbHVlRHVyYWJpbGl0eSA9IFwibWFuZGF0b3J5XCIgfSA9IG9wdGlvbnM7XG4gIGFzc2VydC5lcXVhbCh2YWx1ZUR1cmFiaWxpdHksIFwibWFuZGF0b3J5XCIpO1xuICByZXR1cm4ge1xuICAgIC8vXG4gICAgdmFsdWVEdXJhYmlsaXR5LFxuICAgIC8vXG4gICAgcHVibGlzaENvdW50OiAwbixcbiAgICBzdGF0dXM6IFwibGl2ZVwiLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgaGFzVmFsdWU6IGZhbHNlLFxuICAgIHZhbHVlOiB2b2lkIDBcbiAgfTtcbn07XG52YXIgZ2V0RXBoZW1lcmFsS2V5MiA9IChmYWNldHMpID0+IGZhY2V0cy5wdWJsaXNoZXI7XG52YXIgZHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhMiA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xudmFyIHByb3ZpZGVDdXJyZW50UDIgPSAoc3RhdGUsIGZhY2V0cywgdGFpbCkgPT4ge1xuICBjb25zdCBlcGhlbWVyYWxLZXkgPSBnZXRFcGhlbWVyYWxLZXkyKGZhY2V0cyk7XG4gIGNvbnN0IGZvdW5kRGF0YSA9IGR1cmFibGVQdWJsaXNoS2l0RXBoZW1lcmFsRGF0YTIuZ2V0KGVwaGVtZXJhbEtleSk7XG4gIGNvbnN0IGN1cnJlbnRQID0gZm91bmREYXRhICYmIGZvdW5kRGF0YS5jdXJyZW50UDtcbiAgaWYgKGN1cnJlbnRQKSB7XG4gICAgcmV0dXJuIGN1cnJlbnRQO1xuICB9XG4gIGNvbnN0IHsgcHVibGlzaENvdW50LCBzdGF0dXMsIGhhc1ZhbHVlLCB2YWx1ZSB9ID0gc3RhdGU7XG4gIGlmICghaGFzVmFsdWUpIHtcbiAgICBhc3NlcnQoc3RhdHVzID09PSBcImxpdmVcIik7XG4gICAgcmV0dXJuIHRhaWw7XG4gIH1cbiAgaWYgKHN0YXR1cyA9PT0gXCJsaXZlXCIgfHwgc3RhdHVzID09PSBcImZpbmlzaGVkXCIpIHtcbiAgICBjb25zdCBjZWxsID0gaGFyZGVuKHtcbiAgICAgIGhlYWQ6IHsgdmFsdWUsIGRvbmU6IHN0YXR1cyAhPT0gXCJsaXZlXCIgfSxcbiAgICAgIHB1Ymxpc2hDb3VudCxcbiAgICAgIHRhaWxcbiAgICB9KTtcbiAgICByZXR1cm4gRS5yZXNvbHZlKGNlbGwpO1xuICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gXCJmYWlsZWRcIikge1xuICAgIHJldHVybiBtYWtlUXVpZXRSZWplY3Rpb24yKHZhbHVlKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEludmFsaWQgZHVyYWJsZSBwcm9taXNlIGtpdCBzdGF0dXM6ICR7cXVvdGUoc3RhdHVzKX1gO1xuICB9XG59O1xudmFyIHByb3ZpZGVEdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEyID0gKHN0YXRlLCBmYWNldHMpID0+IHtcbiAgY29uc3QgZXBoZW1lcmFsS2V5ID0gZ2V0RXBoZW1lcmFsS2V5MihmYWNldHMpO1xuICBjb25zdCBmb3VuZERhdGEgPSBkdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEyLmdldChlcGhlbWVyYWxLZXkpO1xuICBpZiAoZm91bmREYXRhKSB7XG4gICAgcmV0dXJuIGZvdW5kRGF0YTtcbiAgfVxuICBjb25zdCB7IHN0YXR1cyB9ID0gc3RhdGU7XG4gIGxldCB0YWlsUDtcbiAgbGV0IHRhaWxSO1xuICBpZiAoc3RhdHVzID09PSBcImxpdmVcIikge1xuICAgICh7IHByb21pc2U6IHRhaWxQLCByZXNvbHZlOiB0YWlsUiB9ID0gbWFrZVByb21pc2VLaXQoKSk7XG4gICAgdm9pZCBFLndoZW4odGFpbFAsIHNpbms1LCBzaW5rNSk7XG4gIH0gZWxzZSBpZiAoc3RhdHVzID09PSBcImZpbmlzaGVkXCIgfHwgc3RhdHVzID09PSBcImZhaWxlZFwiKSB7XG4gICAgdGFpbFAgPSB0b29GYXJSZWplY3Rpb24yO1xuICB9IGVsc2Uge1xuICAgIHRocm93IHRocm93UmVkYWN0ZWRgSW52YWxpZCBkdXJhYmxlIHByb21pc2Uga2l0IHN0YXR1czogJHtxdW90ZShzdGF0dXMpfWA7XG4gIH1cbiAgY29uc3Qgb2JqID0gaGFyZGVuKHsgY3VycmVudFA6IHZvaWQgMCwgdGFpbFAsIHRhaWxSIH0pO1xuICBkdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEyLnNldChlcGhlbWVyYWxLZXksIG9iaik7XG4gIHJldHVybiBvYmo7XG59O1xudmFyIGFkdmFuY2VEdXJhYmxlUHVibGlzaEtpdDIgPSAoY29udGV4dCwgdmFsdWUsIHRhcmdldFN0YXR1cyA9IFwibGl2ZVwiKSA9PiB7XG4gIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gY29udGV4dDtcbiAgY29uc3QgeyB2YWx1ZUR1cmFiaWxpdHksIHN0YXR1cyB9ID0gc3RhdGU7XG4gIGlmIChzdGF0dXMgIT09IFwibGl2ZVwiKSB7XG4gICAgdGhyb3cgRXJyb3IoXCJDYW5ub3QgdXBkYXRlIHN0YXRlIGFmdGVyIHRlcm1pbmF0aW9uLlwiKTtcbiAgfVxuICBjb25zdCBkb25lID0gdGFyZ2V0U3RhdHVzICE9PSBcImxpdmVcIjtcbiAgaWYgKGRvbmUgfHwgdmFsdWVEdXJhYmlsaXR5ID09PSBcIm1hbmRhdG9yeVwiKSB7XG4gICAgY2FuQmVEdXJhYmxlMyh2YWx1ZSkgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgYWNjZXB0IG5vbi1kdXJhYmxlIHZhbHVlOiAke3ZhbHVlfWA7XG4gIH1cbiAgY29uc3QgeyB0YWlsUDogb2xkVGFpbFAsIHRhaWxSOiByZXNvbHZlT2xkVGFpbCB9ID0gcHJvdmlkZUR1cmFibGVQdWJsaXNoS2l0RXBoZW1lcmFsRGF0YTIoc3RhdGUsIGZhY2V0cyk7XG4gIGFzc2VydC50eXBlb2YocmVzb2x2ZU9sZFRhaWwsIFwiZnVuY3Rpb25cIik7XG4gIGNvbnN0IHB1Ymxpc2hDb3VudCA9IHN0YXRlLnB1Ymxpc2hDb3VudCArIDFuO1xuICBzdGF0ZS5wdWJsaXNoQ291bnQgPSBwdWJsaXNoQ291bnQ7XG4gIGxldCB0YWlsUDtcbiAgbGV0IHRhaWxSO1xuICBpZiAoZG9uZSkge1xuICAgIHN0YXRlLnN0YXR1cyA9IHRhcmdldFN0YXR1cztcbiAgICB0YWlsUCA9IHRvb0ZhclJlamVjdGlvbjI7XG4gICAgdGFpbFIgPSB2b2lkIDA7XG4gIH0gZWxzZSB7XG4gICAgKHsgcHJvbWlzZTogdGFpbFAsIHJlc29sdmU6IHRhaWxSIH0gPSBtYWtlUHJvbWlzZUtpdCgpKTtcbiAgICB2b2lkIEUud2hlbih0YWlsUCwgc2luazUsIHNpbms1KTtcbiAgfVxuICBsZXQgY3VycmVudFA7XG4gIGlmICh0YXJnZXRTdGF0dXMgPT09IFwiZmFpbGVkXCIpIHtcbiAgICBzdGF0ZS5oYXNWYWx1ZSA9IHRydWU7XG4gICAgc3RhdGUudmFsdWUgPSB2YWx1ZTtcbiAgICBjb25zdCByZWplY3Rpb24gPSBtYWtlUXVpZXRSZWplY3Rpb24yKHZhbHVlKTtcbiAgICByZXNvbHZlT2xkVGFpbChyZWplY3Rpb24pO1xuICB9IGVsc2Uge1xuICAgIGlmIChkb25lIHx8IHZhbHVlRHVyYWJpbGl0eSAhPT0gXCJpZ25vcmVkXCIgJiYgY2FuQmVEdXJhYmxlMyh2YWx1ZSkpIHtcbiAgICAgIHN0YXRlLmhhc1ZhbHVlID0gdHJ1ZTtcbiAgICAgIHN0YXRlLnZhbHVlID0gdmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0YXRlLmhhc1ZhbHVlID0gZmFsc2U7XG4gICAgICBzdGF0ZS52YWx1ZSA9IHZvaWQgMDtcbiAgICAgIGN1cnJlbnRQID0gb2xkVGFpbFA7XG4gICAgfVxuICAgIHJlc29sdmVPbGRUYWlsKFxuICAgICAgaGFyZGVuKHtcbiAgICAgICAgaGVhZDogeyB2YWx1ZSwgZG9uZSB9LFxuICAgICAgICBwdWJsaXNoQ291bnQsXG4gICAgICAgIHRhaWw6IHRhaWxQXG4gICAgICB9KVxuICAgICk7XG4gIH1cbiAgZHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhMi5zZXQoXG4gICAgZ2V0RXBoZW1lcmFsS2V5MihmYWNldHMpLFxuICAgIGhhcmRlbih7IGN1cnJlbnRQLCB0YWlsUCwgdGFpbFIgfSlcbiAgKTtcbn07XG52YXIgcHJlcGFyZUR1cmFibGVQdWJsaXNoS2l0MiA9IChiYWdnYWdlLCBraW5kTmFtZSkgPT4ge1xuICBjb25zdCBtYWtlTWVtb2l6ZWRVcGRhdGVSZWNvcmQgPSBtYWtlVXBkYXRlUmVjb3JkRnJvbVB1YmxpY2F0aW9uUmVjb3JkMjtcbiAgcmV0dXJuIHByZXBhcmVFeG9DbGFzc0tpdDMoXG4gICAgYmFnZ2FnZSxcbiAgICBraW5kTmFtZSxcbiAgICBwdWJsaXNoS2l0SUtpdDIsXG4gICAgaW5pdER1cmFibGVQdWJsaXNoS2l0U3RhdGUyLFxuICAgIHtcbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgcHVibGlzaGVyOiB7XG4gICAgICAgIHB1Ymxpc2godmFsdWUpIHtcbiAgICAgICAgICBhZHZhbmNlRHVyYWJsZVB1Ymxpc2hLaXQyKHRoaXMsIHZhbHVlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZmluaXNoKGZpbmFsVmFsdWUpIHtcbiAgICAgICAgICBhZHZhbmNlRHVyYWJsZVB1Ymxpc2hLaXQyKHRoaXMsIGZpbmFsVmFsdWUsIFwiZmluaXNoZWRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIGZhaWwocmVhc29uKSB7XG4gICAgICAgICAgYWR2YW5jZUR1cmFibGVQdWJsaXNoS2l0Mih0aGlzLCByZWFzb24sIFwiZmFpbGVkXCIpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICBzdWJzY3JpYmVyOiB7XG4gICAgICAgIHN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudCA9IC0xbikge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICBjb25zdCB7IHB1Ymxpc2hDb3VudDogY3VycmVudFB1Ymxpc2hDb3VudCB9ID0gc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyBjdXJyZW50UCwgdGFpbFAgfSA9IHByb3ZpZGVEdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEyKFxuICAgICAgICAgICAgc3RhdGUsXG4gICAgICAgICAgICBmYWNldHNcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChwdWJsaXNoQ291bnQgPT09IGN1cnJlbnRQdWJsaXNoQ291bnQpIHtcbiAgICAgICAgICAgIHJldHVybiB0YWlsUDtcbiAgICAgICAgICB9IGVsc2UgaWYgKHB1Ymxpc2hDb3VudCA8IGN1cnJlbnRQdWJsaXNoQ291bnQpIHtcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50UCB8fCBwcm92aWRlQ3VycmVudFAyKHN0YXRlLCBmYWNldHMsIHRhaWxQKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgICAgIFwic3Vic2NyaWJlQWZ0ZXIgYXJndW1lbnQgbXVzdCBiZSBhIHByZXZpb3VzbHktaXNzdWVkIHB1Ymxpc2hDb3VudC5cIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50KSB7XG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgZmFjZXRzOiB7IHN1YnNjcmliZXIgfVxuICAgICAgICAgIH0gPSB0aGlzO1xuICAgICAgICAgIGlmICh1cGRhdGVDb3VudCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gc3Vic2NyaWJlci5zdWJzY3JpYmVBZnRlcigpLnRoZW4obWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdXBkYXRlQ291bnQgPSBCaWdJbnQodXBkYXRlQ291bnQpO1xuICAgICAgICAgIHJldHVybiBzdWJzY3JpYmVyLnN1YnNjcmliZUFmdGVyKHVwZGF0ZUNvdW50KS50aGVuKCgpID0+IHN1YnNjcmliZXIuZ2V0VXBkYXRlU2luY2UoKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIHN0YXRlU2hhcGU6IER1cmFibGVQdWJsaXNoS2l0U3RhdGVTaGFwZTJcbiAgICB9XG4gICk7XG59O1xuaGFyZGVuKHByZXBhcmVEdXJhYmxlUHVibGlzaEtpdDIpO1xudmFyIFN1YnNjcmliZXJTaGFwZTIgPSBNLnJlbW90YWJsZShcIlN1YnNjcmliZXJcIik7XG5cbi8vXG52YXIgeyBpc0Zyb3plbjogaXNGcm96ZW45IH0gPSBPYmplY3Q7XG52YXIgVXBncmFkZURpc2Nvbm5lY3Rpb25TaGFwZTQgPSBoYXJkZW4oe1xuICBuYW1lOiBcInZhdFVwZ3JhZGVkXCIsXG4gIHVwZ3JhZGVNZXNzYWdlOiBNLnN0cmluZygpLFxuICBpbmNhcm5hdGlvbk51bWJlcjogTS5udW1iZXIoKVxufSk7XG52YXIgbWFrZVVwZ3JhZGVEaXNjb25uZWN0aW9uNCA9ICh1cGdyYWRlTWVzc2FnZSwgdG9JbmNhcm5hdGlvbk51bWJlcikgPT4gaGFyZGVuKHtcbiAgbmFtZTogXCJ2YXRVcGdyYWRlZFwiLFxuICB1cGdyYWRlTWVzc2FnZSxcbiAgaW5jYXJuYXRpb25OdW1iZXI6IHRvSW5jYXJuYXRpb25OdW1iZXJcbn0pO1xuaGFyZGVuKG1ha2VVcGdyYWRlRGlzY29ubmVjdGlvbjQpO1xudmFyIGlzVXBncmFkZURpc2Nvbm5lY3Rpb240ID0gKHJlYXNvbikgPT4gcmVhc29uICE9IG51bGwgJiYgLy9cbmlzRnJvemVuOShyZWFzb24pICYmIG1hdGNoZXMocmVhc29uLCBVcGdyYWRlRGlzY29ubmVjdGlvblNoYXBlNCk7XG5oYXJkZW4oaXNVcGdyYWRlRGlzY29ubmVjdGlvbjQpO1xudmFyIGlzQWJhbmRvbmVkRXJyb3I0ID0gKHJlYXNvbikgPT4gcmVhc29uICE9IG51bGwgJiYgLy9cbmlzRnJvemVuOShyZWFzb24pICYmIG1hdGNoZXMocmVhc29uLCBNLmVycm9yKCkpICYmIC8vXG4vL1xucmVhc29uLm1lc3NhZ2UgPT09IFwidmF0IHRlcm1pbmF0ZWRcIjtcbmhhcmRlbihpc0FiYW5kb25lZEVycm9yNCk7XG5cbi8vXG52YXIgc2luazYgPSAoKSA9PiB7XG59O1xudmFyIHJlY29ubmVjdEFzTmVlZGVkMiA9IGFzeW5jIChnZXR0ZXIsIHNlZWQgPSBbXSkgPT4ge1xuICBsZXQgZGlzY29ubmVjdGlvbjtcbiAgbGV0IGxhc3RWZXJzaW9uID0gLUluZmluaXR5O1xuICBhd2FpdCBudWxsO1xuICBmb3IgKGxldCBpMiA9IDA7IDsgaTIgKz0gMSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHRQID0gaTIgPCBzZWVkLmxlbmd0aCA/IHNlZWRbaTJdIDogZ2V0dGVyKCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXN1bHRQO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChpc1VwZ3JhZGVEaXNjb25uZWN0aW9uNChlcnIpKSB7XG4gICAgICAgIGlmICghZGlzY29ubmVjdGlvbikge1xuICAgICAgICAgIGRpc2Nvbm5lY3Rpb24gPSBlcnI7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBpbmNhcm5hdGlvbk51bWJlcjogdmVyc2lvbiB9ID0gZXJyO1xuICAgICAgICBpZiAodmVyc2lvbiA+IGxhc3RWZXJzaW9uKSB7XG4gICAgICAgICAgbGFzdFZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIWlzUHJpbWl0aXZlMihlcnIpICYmIGRpc2Nvbm5lY3Rpb24gJiYgZGlzY29ubmVjdGlvbiAhPT0gZXJyKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgbm90ZShcbiAgICAgICAgICAgIGVycixcbiAgICAgICAgICAgIHJlZGFjdGVkYEF0dGVtcHRpbmcgdG8gcmVjb3ZlciBmcm9tIGRpc2Nvbm5lY3Rpb246ICR7ZGlzY29ubmVjdGlvbn1gXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBjYXRjaCAoX2Vycikge1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG59O1xudmFyIG1ha2VFYWNoSXRlcmF0b3IyID0gKHRvcGljLCBuZXh0Q2VsbFApID0+IHtcbiAgY29uc3Qgc2VsZiA9IEZhcihcIkVhY2hJdGVyYXRvclwiLCB7XG4gICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogKCkgPT4gc2VsZixcbiAgICBuZXh0OiAoKSA9PiB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGhlYWQ6IHJlc3VsdFAsXG4gICAgICAgIHB1Ymxpc2hDb3VudDogcHVibGlzaENvdW50UCxcbiAgICAgICAgdGFpbDogdGFpbFBcbiAgICAgIH0gPSBFLmdldChuZXh0Q2VsbFApO1xuICAgICAgY29uc3QgZ2V0U3VjY2Vzc29yID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBwdWJsaXNoQ291bnQgPSBhd2FpdCBwdWJsaXNoQ291bnRQO1xuICAgICAgICBhc3NlcnQudHlwZW9mKHB1Ymxpc2hDb3VudCwgXCJiaWdpbnRcIik7XG4gICAgICAgIGNvbnN0IHN1Y2Nlc3NvciA9IGF3YWl0IEUodG9waWMpLnN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudCk7XG4gICAgICAgIGNvbnN0IG5ld1B1Ymxpc2hDb3VudCA9IHN1Y2Nlc3Nvci5wdWJsaXNoQ291bnQ7XG4gICAgICAgIGlmIChuZXdQdWJsaXNoQ291bnQgIT09IHB1Ymxpc2hDb3VudCArIDFuKSB7XG4gICAgICAgICAgdGhyb3dSZWRhY3RlZGBlYWNoSXRlcmF0b3IgYnJva2VuIGJ5IGdhcCBmcm9tIHB1Ymxpc2hDb3VudCAke3B1Ymxpc2hDb3VudH0gdG8gJHtuZXdQdWJsaXNoQ291bnR9YDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3VjY2Vzc29yO1xuICAgICAgfTtcbiAgICAgIG5leHRDZWxsUCA9IHJlY29ubmVjdEFzTmVlZGVkMihnZXRTdWNjZXNzb3IsIFt0YWlsUF0pO1xuICAgICAgdm9pZCBFLndoZW4ocHVibGlzaENvdW50UCwgc2luazYsIHNpbms2KTtcbiAgICAgIHZvaWQgRS53aGVuKG5leHRDZWxsUCwgc2luazYsIHNpbms2KTtcbiAgICAgIHJldHVybiByZXN1bHRQO1xuICAgIH0sXG4gICAgZm9yazogKCkgPT4gbWFrZUVhY2hJdGVyYXRvcjIodG9waWMsIG5leHRDZWxsUClcbiAgfSk7XG4gIHJldHVybiBzZWxmO1xufTtcbnZhciBzdWJzY3JpYmVFYWNoMiA9ICh0b3BpYykgPT4ge1xuICBjb25zdCBpdGVyYWJsZSA9IEZhcihcIkVhY2hJdGVyYWJsZVwiLCB7XG4gICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgY29uc3QgZmlyc3RDZWxsUCA9IHJlY29ubmVjdEFzTmVlZGVkMigoKSA9PiBFKHRvcGljKS5zdWJzY3JpYmVBZnRlcigpKTtcbiAgICAgIHJldHVybiBtYWtlRWFjaEl0ZXJhdG9yMih0b3BpYywgZmlyc3RDZWxsUCk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGl0ZXJhYmxlO1xufTtcbmhhcmRlbihzdWJzY3JpYmVFYWNoMik7XG52YXIgY2xvbmVMYXRlc3RJdGVyYXRvcjIgPSAodG9waWMsIGxvY2FsVXBkYXRlQ291bnQsIHRlcm1pbmFsUmVzdWx0KSA9PiB7XG4gIGxldCBtdXRleCA9IFByb21pc2UucmVzb2x2ZSgpO1xuICBjb25zdCBtYXliZVJlcXVlc3ROZXh0UmVzdWx0ID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICh0ZXJtaW5hbFJlc3VsdCkge1xuICAgICAgcmV0dXJuIHRlcm1pbmFsUmVzdWx0O1xuICAgIH1cbiAgICBjb25zdCB7IHZhbHVlLCB1cGRhdGVDb3VudCB9ID0gYXdhaXQgcmVjb25uZWN0QXNOZWVkZWQyKFxuICAgICAgKCkgPT4gRSh0b3BpYykuZ2V0VXBkYXRlU2luY2UobG9jYWxVcGRhdGVDb3VudClcbiAgICApO1xuICAgIGxvY2FsVXBkYXRlQ291bnQgPSB1cGRhdGVDb3VudDtcbiAgICBpZiAodXBkYXRlQ291bnQgPT09IHZvaWQgMCkge1xuICAgICAgdGVybWluYWxSZXN1bHQgPSBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZSB9KTtcbiAgICAgIHJldHVybiB0ZXJtaW5hbFJlc3VsdDtcbiAgICB9XG4gICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IGZhbHNlLCB2YWx1ZSB9KTtcbiAgfTtcbiAgY29uc3Qgc2VsZiA9IEZhcihcIkxhdGVzdEl0ZXJhdG9yXCIsIHtcbiAgICBmb3JrOiAoKSA9PiBjbG9uZUxhdGVzdEl0ZXJhdG9yMih0b3BpYywgbG9jYWxVcGRhdGVDb3VudCwgdGVybWluYWxSZXN1bHQpLFxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06ICgpID0+IHNlbGYsXG4gICAgbmV4dDogYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKHRlcm1pbmFsUmVzdWx0KSB7XG4gICAgICAgIHJldHVybiB0ZXJtaW5hbFJlc3VsdDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG5leHRSZXN1bHQgPSBtdXRleC50aGVuKG1heWJlUmVxdWVzdE5leHRSZXN1bHQpO1xuICAgICAgbXV0ZXggPSBuZXh0UmVzdWx0LnRoZW4oc2luazYsIHNpbms2KTtcbiAgICAgIHJldHVybiBuZXh0UmVzdWx0O1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBzZWxmO1xufTtcbnZhciBtYWtlTGF0ZXN0SXRlcmF0b3IyID0gKHRvcGljKSA9PiBjbG9uZUxhdGVzdEl0ZXJhdG9yMih0b3BpYyk7XG52YXIgc3Vic2NyaWJlTGF0ZXN0MiA9ICh0b3BpYykgPT4ge1xuICBjb25zdCBpdGVyYWJsZSA9IEZhcihcIkxhdGVzdEl0ZXJhYmxlXCIsIHtcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiAoKSA9PiBtYWtlTGF0ZXN0SXRlcmF0b3IyKHRvcGljKVxuICB9KTtcbiAgcmV0dXJuIGl0ZXJhYmxlO1xufTtcbmhhcmRlbihzdWJzY3JpYmVMYXRlc3QyKTtcblxuLy9cbnZhciBtYWtlTm90aWZpZXIyID0gKHNoYXJhYmxlSW50ZXJuYWxzUCkgPT4ge1xuICBjb25zdCBub3RpZmllciA9IEZhcihcIm5vdGlmaWVyXCIsIHtcbiAgICAuLi5zdWJzY3JpYmVMYXRlc3QyKHNoYXJhYmxlSW50ZXJuYWxzUCksXG4gICAgZ2V0VXBkYXRlU2luY2U6IGFzeW5jICh1cGRhdGVDb3VudCkgPT4gRShzaGFyYWJsZUludGVybmFsc1ApLmdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50KSxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgZ2V0U2hhcmFibGVOb3RpZmllckludGVybmFsczogYXN5bmMgKCkgPT4gc2hhcmFibGVJbnRlcm5hbHNQLFxuICAgIC8qXG5cblxuXG4gICAgICovXG4gICAgZ2V0U3RvcmVLZXk6ICgpID0+IGhhcmRlbih7IG5vdGlmaWVyIH0pXG4gIH0pO1xuICByZXR1cm4gbm90aWZpZXI7XG59O1xudmFyIG1ha2VOb3RpZmllckZyb21TdWJzY3JpYmVyMiA9IChzdWJzY3JpYmVyKSA9PiB7XG4gIGNvbnN0IGJhc2VOb3RpZmllciA9IGhhcmRlbih7XG4gICAgZ2V0VXBkYXRlU2luY2U6ICh1cGRhdGVDb3VudCA9IHZvaWQgMCkgPT4gRShzdWJzY3JpYmVyKS5nZXRVcGRhdGVTaW5jZSh1cGRhdGVDb3VudClcbiAgfSk7XG4gIGNvbnN0IG5vdGlmaWVyID0gRmFyKFwibm90aWZpZXJcIiwge1xuICAgIC4uLm1ha2VOb3RpZmllcjIoYmFzZU5vdGlmaWVyKSxcbiAgICAuLi5iYXNlTm90aWZpZXJcbiAgfSk7XG4gIHJldHVybiBub3RpZmllcjtcbn07XG5oYXJkZW4obWFrZU5vdGlmaWVyRnJvbVN1YnNjcmliZXIyKTtcbnZhciBtYWtlTm90aWZpZXJLaXQyID0gKC4uLmluaXRpYWxTdGF0ZUFycikgPT4ge1xuICBjb25zdCB7IHB1Ymxpc2hlciwgc3Vic2NyaWJlciB9ID0gbWFrZVB1Ymxpc2hLaXQyKCk7XG4gIGNvbnN0IG5vdGlmaWVyID0gbWFrZU5vdGlmaWVyRnJvbVN1YnNjcmliZXIyKHN1YnNjcmliZXIpO1xuICBjb25zdCB1cGRhdGVyID0gRmFyKFwidXBkYXRlclwiLCB7XG4gICAgdXBkYXRlU3RhdGU6IChzdGF0ZSkgPT4gcHVibGlzaGVyLnB1Ymxpc2goc3RhdGUpLFxuICAgIGZpbmlzaDogKGNvbXBsZXRpb24pID0+IHB1Ymxpc2hlci5maW5pc2goY29tcGxldGlvbiksXG4gICAgZmFpbDogKHJlYXNvbikgPT4gcHVibGlzaGVyLmZhaWwocmVhc29uKVxuICB9KTtcbiAgYXNzZXJ0Mihpbml0aWFsU3RhdGVBcnIubGVuZ3RoIDw9IDEsIFwidG9vIG1hbnkgYXJndW1lbnRzXCIpO1xuICBpZiAoaW5pdGlhbFN0YXRlQXJyLmxlbmd0aCA9PT0gMSkge1xuICAgIHVwZGF0ZXIudXBkYXRlU3RhdGUoaW5pdGlhbFN0YXRlQXJyWzBdKTtcbiAgfVxuICByZXR1cm4gaGFyZGVuKHsgbm90aWZpZXIsIHVwZGF0ZXIgfSk7XG59O1xudmFyIG1ha2VOb3RpZmllckZyb21Bc3luY0l0ZXJhYmxlMiA9IChhc3luY0l0ZXJhYmxlUCkgPT4ge1xuICBjb25zdCBpdGVyYXRvclAgPSBFKGFzeW5jSXRlcmFibGVQKVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKTtcbiAgbGV0IG9wdE5leHRQcm9taXNlO1xuICBsZXQgY3VycmVudFVwZGF0ZUNvdW50ID0gMG47XG4gIGxldCBjdXJyZW50UmVzcG9uc2U7XG4gIGxldCBmaW5hbCA9IGZhbHNlO1xuICBjb25zdCBiYXNlTm90aWZpZXIgPSBGYXIoXCJiYXNlTm90aWZpZXJcIiwge1xuICAgIGdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50ID0gLTFuKSB7XG4gICAgICBpZiAodXBkYXRlQ291bnQgPCBjdXJyZW50VXBkYXRlQ291bnQpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRSZXNwb25zZSkge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY3VycmVudFJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh1cGRhdGVDb3VudCAhPT0gY3VycmVudFVwZGF0ZUNvdW50KSB7XG4gICAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgIFwiZ2V0VXBkYXRlU2luY2UgYXJndW1lbnQgbXVzdCBiZSBhIHByZXZpb3VzbHktaXNzdWVkIHVwZGF0ZUNvdW50LlwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoZmluYWwpIHtcbiAgICAgICAgYXNzZXJ0MihjdXJyZW50UmVzcG9uc2UgIT09IHZvaWQgMCk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY3VycmVudFJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICAgIGlmICghb3B0TmV4dFByb21pc2UpIHtcbiAgICAgICAgY29uc3QgbmV4dEl0ZXJSZXN1bHRQID0gRShpdGVyYXRvclApLm5leHQoKTtcbiAgICAgICAgb3B0TmV4dFByb21pc2UgPSBFLndoZW4oXG4gICAgICAgICAgbmV4dEl0ZXJSZXN1bHRQLFxuICAgICAgICAgICh7IGRvbmUsIHZhbHVlIH0pID0+IHtcbiAgICAgICAgICAgIGFzc2VydDIoIWZpbmFsKTtcbiAgICAgICAgICAgIGlmIChkb25lKSB7XG4gICAgICAgICAgICAgIGZpbmFsID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1cnJlbnRVcGRhdGVDb3VudCArPSAxbjtcbiAgICAgICAgICAgIGN1cnJlbnRSZXNwb25zZSA9IGhhcmRlbih7XG4gICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICB1cGRhdGVDb3VudDogZG9uZSA/IHZvaWQgMCA6IGN1cnJlbnRVcGRhdGVDb3VudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBvcHROZXh0UHJvbWlzZSA9IHZvaWQgMDtcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50UmVzcG9uc2U7XG4gICAgICAgICAgfSxcbiAgICAgICAgICAoX3JlYXNvbikgPT4ge1xuICAgICAgICAgICAgZmluYWwgPSB0cnVlO1xuICAgICAgICAgICAgY3VycmVudFJlc3BvbnNlID0gLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICBuZXh0SXRlclJlc3VsdFA7XG4gICAgICAgICAgICBvcHROZXh0UHJvbWlzZSA9IHZvaWQgMDtcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50UmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG9wdE5leHRQcm9taXNlO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IG5vdGlmaWVyID0gRmFyKFwibm90aWZpZXJcIiwge1xuICAgIC8vXG4gICAgLy9cbiAgICAuLi5tYWtlTm90aWZpZXIyKGJhc2VOb3RpZmllciksXG4gICAgLi4uYmFzZU5vdGlmaWVyXG4gIH0pO1xuICByZXR1cm4gbm90aWZpZXI7XG59O1xuaGFyZGVuKG1ha2VOb3RpZmllckZyb21Bc3luY0l0ZXJhYmxlMik7XG5cbi8vXG52YXIgbWFrZVBpbm5lZEhpc3RvcnlUb3BpYzIgPSAodG9waWMpID0+IHtcbiAgY29uc3QgcGlubmVkUHViTGlzdCA9IHRvcGljLnN1YnNjcmliZUFmdGVyKCk7XG4gIHJldHVybiBGYXIoXCJQaW5uZWRIaXN0b3J5VG9waWNcIiwge1xuICAgIHN1YnNjcmliZUFmdGVyOiBhc3luYyAocHVibGlzaENvdW50ID0gLTFuKSA9PiB7XG4gICAgICBpZiAocHVibGlzaENvdW50ID09PSAtMW4pIHtcbiAgICAgICAgcmV0dXJuIHBpbm5lZFB1Ykxpc3Q7XG4gICAgICB9XG4gICAgICByZXR1cm4gdG9waWMuc3Vic2NyaWJlQWZ0ZXIocHVibGlzaENvdW50KTtcbiAgICB9LFxuICAgIGdldFVwZGF0ZVNpbmNlOiBhc3luYyAodXBkYXRlQ291bnQgPSB2b2lkIDApID0+IHtcbiAgICAgIHJldHVybiB0b3BpYy5nZXRVcGRhdGVTaW5jZSh1cGRhdGVDb3VudCk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4obWFrZVBpbm5lZEhpc3RvcnlUb3BpYzIpO1xuXG4vL1xudmFyIG1ha2VTdWJzY3JpcHRpb24yID0gKHRvcGljKSA9PiB7XG4gIGNvbnN0IHN1YnNjcmlwdGlvbiA9IEZhcihcIlN1YnNjcmlwdGlvblwiLCB7XG4gICAgLi4uc3Vic2NyaWJlRWFjaDIodG9waWMpLFxuICAgIHN1YnNjcmliZUFmdGVyOiBhc3luYyAocHVibGlzaENvdW50KSA9PiBFKHRvcGljKS5zdWJzY3JpYmVBZnRlcihwdWJsaXNoQ291bnQpLFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICBnZXRTaGFyYWJsZVN1YnNjcmlwdGlvbkludGVybmFsczogYXN5bmMgKCkgPT4gdG9waWMsXG4gICAgZ2V0U3RvcmVLZXk6ICgpID0+IGhhcmRlbih7IHN1YnNjcmlwdGlvbiB9KVxuICB9KTtcbiAgcmV0dXJuIHN1YnNjcmlwdGlvbjtcbn07XG5oYXJkZW4obWFrZVN1YnNjcmlwdGlvbjIpO1xudmFyIG1ha2VTdWJzY3JpcHRpb25LaXQyID0gKCkgPT4ge1xuICBjb25zdCB7IHB1Ymxpc2hlciwgc3Vic2NyaWJlciB9ID0gbWFrZVB1Ymxpc2hLaXQyKCk7XG4gIGNvbnN0IHBpbm5lZEhpc3RvcnlUb3BpYyA9IG1ha2VQaW5uZWRIaXN0b3J5VG9waWMyKHN1YnNjcmliZXIpO1xuICBjb25zdCBzdWJzY3JpcHRpb24gPSBtYWtlU3Vic2NyaXB0aW9uMihwaW5uZWRIaXN0b3J5VG9waWMpO1xuICBjb25zdCBwdWJsaWNhdGlvbiA9IEZhcihcInB1YmxpY2F0aW9uXCIsIHtcbiAgICB1cGRhdGVTdGF0ZTogKG5vbkZpbmFsVmFsdWUpID0+IHB1Ymxpc2hlci5wdWJsaXNoKG5vbkZpbmFsVmFsdWUpLFxuICAgIGZpbmlzaDogKGNvbXBsZXRpb24pID0+IHB1Ymxpc2hlci5maW5pc2goY29tcGxldGlvbiksXG4gICAgZmFpbDogKHJlYXNvbikgPT4gcHVibGlzaGVyLmZhaWwocmVhc29uKVxuICB9KTtcbiAgcmV0dXJuIGhhcmRlbih7IHB1YmxpY2F0aW9uLCBzdWJzY3JpcHRpb24gfSk7XG59O1xuaGFyZGVuKG1ha2VTdWJzY3JpcHRpb25LaXQyKTtcblxuLy9cbnZhciBvYnNlcnZlSXRlcmF0b3IyID0gKGFzeW5jSXRlcmF0b3JQLCBpdGVyYXRpb25PYnNlcnZlcikgPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKGFjaywgb2JzZXJ2ZXJFcnJvcikgPT4ge1xuICAgIGNvbnN0IHJlY3VyID0gKCkgPT4ge1xuICAgICAgRS53aGVuKFxuICAgICAgICBFKGFzeW5jSXRlcmF0b3JQKS5uZXh0KCksXG4gICAgICAgICh7IHZhbHVlLCBkb25lIH0pID0+IHtcbiAgICAgICAgICBpZiAoZG9uZSkge1xuICAgICAgICAgICAgaXRlcmF0aW9uT2JzZXJ2ZXIuZmluaXNoICYmIGl0ZXJhdGlvbk9ic2VydmVyLmZpbmlzaCh2YWx1ZSk7XG4gICAgICAgICAgICBhY2sodm9pZCAwKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaXRlcmF0aW9uT2JzZXJ2ZXIudXBkYXRlU3RhdGUgJiYgaXRlcmF0aW9uT2JzZXJ2ZXIudXBkYXRlU3RhdGUodmFsdWUpO1xuICAgICAgICAgICAgcmVjdXIoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIChyZWFzb24pID0+IHtcbiAgICAgICAgICBpdGVyYXRpb25PYnNlcnZlci5mYWlsICYmIGl0ZXJhdGlvbk9ic2VydmVyLmZhaWwocmVhc29uKTtcbiAgICAgICAgICBhY2sodm9pZCAwKTtcbiAgICAgICAgfVxuICAgICAgKS5jYXRjaChvYnNlcnZlckVycm9yKTtcbiAgICB9O1xuICAgIHJlY3VyKCk7XG4gIH0pO1xufTtcbnZhciBvYnNlcnZlSXRlcmF0aW9uMiA9IChhc3luY0l0ZXJhYmxlUCwgaXRlcmF0aW9uT2JzZXJ2ZXIpID0+IHtcbiAgY29uc3QgaXRlcmF0b3JQID0gRShhc3luY0l0ZXJhYmxlUClbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCk7XG4gIHJldHVybiBvYnNlcnZlSXRlcmF0b3IyKGl0ZXJhdG9yUCwgaXRlcmF0aW9uT2JzZXJ2ZXIpO1xufTtcblxuLy9cbnZhciBmb3JFYWNoUHVibGljYXRpb25SZWNvcmQyID0gYXN5bmMgKHN1YnNjcmliZXIsIGNvbnN1bWVWYWx1ZSkgPT4ge1xuICBjb25zdCBpdGVyYXRvciA9IHN1YnNjcmliZUVhY2gyKHN1YnNjcmliZXIpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpO1xuICBsZXQgZmluaXNoZWQgPSBmYWxzZTtcbiAgYXdhaXQgbnVsbDtcbiAgd2hpbGUgKCFmaW5pc2hlZCkge1xuICAgIGNvbnN0IHsgdmFsdWUsIGRvbmUgfSA9IGF3YWl0IGl0ZXJhdG9yLm5leHQoKTtcbiAgICBhd2FpdCBjb25zdW1lVmFsdWUodmFsdWUpO1xuICAgIGZpbmlzaGVkID0gISFkb25lO1xuICB9XG59O1xudmFyIG1ha2VTdG9yZWRTdWJzY3JpYmVyMiA9IChzdWJzY3JpYmVyLCBzdG9yYWdlTm9kZSwgbWFyc2hhbGxlcikgPT4ge1xuICBhc3NlcnRBbGxEZWZpbmVkMih7IHN1YnNjcmliZXIsIHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyIH0pO1xuICBjb25zdCBtYXJzaGFsbFRvU3RvcmFnZSA9IG1ha2VTZXJpYWxpemVUb1N0b3JhZ2UyKHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyKTtcbiAgZm9yRWFjaFB1YmxpY2F0aW9uUmVjb3JkMihzdWJzY3JpYmVyLCBtYXJzaGFsbFRvU3RvcmFnZSkuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJTdG9yZWRTdWJzY3JpYmVyIGZhaWxlZCB0byBpdGVyYXRlXCIsIGVycik7XG4gIH0pO1xuICBjb25zdCB1bnNlcmlhbGl6ZXIgPSBGYXIoXCJ1bnNlcmlhbGl6ZXJcIiwge1xuICAgIGZyb21DYXBEYXRhOiAoZGF0YSkgPT4gRShtYXJzaGFsbGVyKS5mcm9tQ2FwRGF0YShkYXRhKSxcbiAgICB1bnNlcmlhbGl6ZTogKGRhdGEpID0+IEUobWFyc2hhbGxlcikuZnJvbUNhcERhdGEoZGF0YSlcbiAgfSk7XG4gIGNvbnN0IHN0b3Jlc3ViID0gRmFyKFwiU3RvcmVkU3Vic2NyaWJlclwiLCB7XG4gICAgc3Vic2NyaWJlQWZ0ZXI6IChwdWJsaXNoQ291bnQpID0+IHN1YnNjcmliZXIuc3Vic2NyaWJlQWZ0ZXIocHVibGlzaENvdW50KSxcbiAgICBnZXRVcGRhdGVTaW5jZTogKHVwZGF0ZUNvdW50KSA9PiBzdWJzY3JpYmVyLmdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50KSxcbiAgICBnZXRQYXRoOiAoKSA9PiBFKHN0b3JhZ2VOb2RlKS5nZXRQYXRoKCksXG4gICAgZ2V0U3RvcmVLZXk6ICgpID0+IEUoc3RvcmFnZU5vZGUpLmdldFN0b3JlS2V5KCksXG4gICAgZ2V0VW5zZXJpYWxpemVyOiAoKSA9PiB1bnNlcmlhbGl6ZXJcbiAgfSk7XG4gIHJldHVybiBzdG9yZXN1Yjtcbn07XG52YXIgbWFrZVN0b3JlZFN1YnNjcmlwdGlvbjIgPSAoc3Vic2NyaXB0aW9uLCBzdG9yYWdlTm9kZSwgbWFyc2hhbGxlciA9IG1ha2VNYXJzaGFsKHZvaWQgMCwgdm9pZCAwLCB7XG4gIG1hcnNoYWxTYXZlRXJyb3I6ICgpID0+IHtcbiAgfSxcbiAgc2VyaWFsaXplQm9keUZvcm1hdDogXCJzbWFsbGNhcHNcIlxufSkpID0+IHtcbiAgY29uc3QgdW5zZXJpYWxpemVyID0gRmFyKFwidW5zZXJpYWxpemVyXCIsIHtcbiAgICBmcm9tQ2FwRGF0YTogKGRhdGEpID0+IEUobWFyc2hhbGxlcikuZnJvbUNhcERhdGEoZGF0YSksXG4gICAgdW5zZXJpYWxpemU6IChkYXRhKSA9PiBFKG1hcnNoYWxsZXIpLmZyb21DYXBEYXRhKGRhdGEpXG4gIH0pO1xuICBsZXQgcHVibGlzaEZhaWxlZCA9IGZhbHNlO1xuICBsZXQgcHVibGlzaEV4Y2VwdGlvbjtcbiAgY29uc3QgZmFpbCA9IChlcnIpID0+IHtcbiAgICBwdWJsaXNoRmFpbGVkID0gdHJ1ZTtcbiAgICBwdWJsaXNoRXhjZXB0aW9uID0gZXJyO1xuICB9O1xuICBjb25zdCBwdWJsaXNoVmFsdWUgPSAob2JqKSA9PiB7XG4gICAgYXNzZXJ0KHN0b3JhZ2VOb2RlKTtcbiAgICBpZiAocHVibGlzaEZhaWxlZCkge1xuICAgICAgdGhyb3cgcHVibGlzaEV4Y2VwdGlvbjtcbiAgICB9XG4gICAgRShtYXJzaGFsbGVyKS50b0NhcERhdGEob2JqKS50aGVuKChzZXJpYWxpemVkKSA9PiB7XG4gICAgICBjb25zdCBlbmNvZGVkID0gSlNPTi5zdHJpbmdpZnkoc2VyaWFsaXplZCk7XG4gICAgICByZXR1cm4gRShzdG9yYWdlTm9kZSkuc2V0VmFsdWUoZW5jb2RlZCk7XG4gICAgfSkuY2F0Y2goZmFpbCk7XG4gIH07XG4gIGlmIChzdG9yYWdlTm9kZSkge1xuICAgIG9ic2VydmVJdGVyYXRpb24yKHN1YnNjcmlwdGlvbiwge1xuICAgICAgdXBkYXRlU3RhdGU6IHB1Ymxpc2hWYWx1ZSxcbiAgICAgIGZpbmlzaDogcHVibGlzaFZhbHVlXG4gICAgfSkuY2F0Y2goZmFpbCk7XG4gIH1cbiAgY29uc3Qgc3RvcmVzdWIgPSBGYXIoXCJTdG9yZWRTdWJzY3JpcHRpb25cIiwge1xuICAgIC8vXG4gICAgZ2V0U3RvcmVLZXk6IGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghc3RvcmFnZU5vZGUpIHtcbiAgICAgICAgcmV0dXJuIGhhcmRlbih7IHN1YnNjcmlwdGlvbiB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHN0b3JlS2V5ID0gYXdhaXQgRShzdG9yYWdlTm9kZSkuZ2V0U3RvcmVLZXkoKTtcbiAgICAgIHJldHVybiBoYXJkZW4oeyAuLi5zdG9yZUtleSwgc3Vic2NyaXB0aW9uIH0pO1xuICAgIH0sXG4gICAgZ2V0VW5zZXJpYWxpemVyOiAoKSA9PiB1bnNlcmlhbGl6ZXIsXG4gICAgZ2V0U2hhcmFibGVTdWJzY3JpcHRpb25JbnRlcm5hbHM6ICgpID0+IHN1YnNjcmlwdGlvbi5nZXRTaGFyYWJsZVN1YnNjcmlwdGlvbkludGVybmFscygpLFxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06ICgpID0+IHN1YnNjcmlwdGlvbltTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSxcbiAgICBzdWJzY3JpYmVBZnRlcjogKHB1Ymxpc2hDb3VudCkgPT4gc3Vic2NyaXB0aW9uLnN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudClcbiAgfSk7XG4gIHJldHVybiBzdG9yZXN1Yjtcbn07XG5oYXJkZW4obWFrZVN0b3JlZFN1YnNjcmlwdGlvbjIpO1xudmFyIG1ha2VTdG9yZWRQdWJsaXNoS2l0MiA9IChzdG9yYWdlTm9kZSwgbWFyc2hhbGxlcikgPT4ge1xuICBjb25zdCB7IHB1Ymxpc2hlciwgc3Vic2NyaWJlciB9ID0gbWFrZVB1Ymxpc2hLaXQyKCk7XG4gIHJldHVybiB7XG4gICAgcHVibGlzaGVyLFxuICAgIC8vXG4gICAgc3Vic2NyaWJlcjogbWFrZVN0b3JlZFN1YnNjcmliZXIyKHN1YnNjcmliZXIsIHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyKVxuICB9O1xufTtcbmhhcmRlbihtYWtlU3RvcmVkUHVibGlzaEtpdDIpO1xuXG4vL1xudmFyIG1ha2VUcmFuc2llbnROb3RpZmllcktpdCA9ICgpID0+IHtcbiAgY29uc3QgdHJhbnNpZW50Tm90aWZlcktpdHMgPSBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlMyhcbiAgICBcInRyYW5zaWVudE5vdGlmZXJLaXRzXCJcbiAgKTtcbiAgY29uc3QgcHJvdmlkZU5vdGlmaWVyS2l0ID0gKGtleSkgPT4gcHJvdmlkZUxhenk1KFxuICAgIHRyYW5zaWVudE5vdGlmZXJLaXRzLFxuICAgIGtleSxcbiAgICAoKSA9PiBtYWtlTm90aWZpZXJLaXQyKGtleS5nZXRDdXJyZW50QW1vdW50KCkpXG4gICk7XG4gIGNvbnN0IHByb3ZpZGVOb3RpZmllciA9IChrZXkpID0+IHByb3ZpZGVOb3RpZmllcktpdChrZXkpLm5vdGlmaWVyO1xuICBjb25zdCB1cGRhdGUgPSAoa2V5LCBuZXdWYWx1ZSkgPT4ge1xuICAgIGlmICh0cmFuc2llbnROb3RpZmVyS2l0cy5oYXMoa2V5KSkge1xuICAgICAgY29uc3QgeyB1cGRhdGVyIH0gPSB0cmFuc2llbnROb3RpZmVyS2l0cy5nZXQoa2V5KTtcbiAgICAgIHVwZGF0ZXIudXBkYXRlU3RhdGUobmV3VmFsdWUpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIHsgcHJvdmlkZU5vdGlmaWVyLCB1cGRhdGUgfTtcbn07XG5oYXJkZW4obWFrZVRyYW5zaWVudE5vdGlmaWVyS2l0KTtcblxuLy9cbnZhciBtYWtlQW1vdW50U3RvcmUgPSAoc3RhdGUsIGtleSkgPT4ge1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBnZXRBbW91bnQ6ICgpID0+IHN0YXRlW2tleV0sXG4gICAgaW5jcmVtZW50OiAoZGVsdGEpID0+IHtcbiAgICAgIHN0YXRlW2tleV0gPSBBbW91bnRNYXRoLmFkZChzdGF0ZVtrZXldLCBkZWx0YSk7XG4gICAgfSxcbiAgICBkZWNyZW1lbnQ6IChkZWx0YSkgPT4ge1xuICAgICAgaWYgKEFtb3VudE1hdGguaXNHVEUoc3RhdGVba2V5XSwgZGVsdGEpKSB7XG4gICAgICAgIHN0YXRlW2tleV0gPSBBbW91bnRNYXRoLnN1YnRyYWN0KHN0YXRlW2tleV0sIGRlbHRhKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUFtb3VudFN0b3JlKTtcblxuLy9cbnZhciBFTVBUWV9DT1BZX1NFVCA9IG1ha2VDb3B5U2V0KFtdKTtcbnZhciBwcmVwYXJlUHVyc2VLaW5kID0gKGlzc3VlclpvbmUsIG5hbWUsIGFzc2V0S2luZCwgYnJhbmQsIFB1cnNlSUtpdCwgcHVyc2VNZXRob2RzLCByZWNvdmVyeVNldHNTdGF0ZSwgcGF5bWVudFJlY292ZXJ5U2V0cykgPT4ge1xuICBjb25zdCBhbW91bnRTaGFwZSA9IGJyYW5kLmdldEFtb3VudFNoYXBlKCk7XG4gIGNvbnN0IHsgcHJvdmlkZU5vdGlmaWVyLCB1cGRhdGU6IHVwZGF0ZUJhbGFuY2UgfSA9IG1ha2VUcmFuc2llbnROb3RpZmllcktpdCgpO1xuICBjb25zdCBtYXliZVJlY292ZXJ5U2V0ID0gKHN0YXRlKSA9PiB7XG4gICAgY29uc3QgeyByZWNvdmVyeVNldCB9ID0gc3RhdGU7XG4gICAgaWYgKHJlY292ZXJ5U2V0c1N0YXRlID09PSBcImhhc1JlY292ZXJ5U2V0c1wiKSB7XG4gICAgICByZXR1cm4gcmVjb3ZlcnlTZXQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlY292ZXJ5U2V0c1N0YXRlID09PSBcIm5vUmVjb3ZlcnlTZXRzXCIgfHwgdGhyb3dSZWRhY3RlZGByZWNvdmVyU2V0c1N0YXRlIG11c3QgYmUgbm9SZWNvdmVyeVNldHMgaWYgaXQgaXNuJ3QgaGFzUmVjb3ZlclNldHNgO1xuICAgICAgcGF5bWVudFJlY292ZXJ5U2V0cyAhPT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgcGF5bWVudFJlY292ZXJ5U2V0cyBtdXN0IGFsd2F5cyBiZSBkZWZpbmVkYDtcbiAgICAgIHJlY292ZXJ5U2V0LmdldFNpemUoKSA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYFdpdGggbm9SZWNvdmVyeVNldHMsIHJlY292ZXJ5U2V0IG11c3QgYmUgZW1wdHlgO1xuICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHsgZGVwb3NpdEludGVybmFsLCB3aXRoZHJhd0ludGVybmFsIH0gPSBwdXJzZU1ldGhvZHM7XG4gIGNvbnN0IG1ha2VQdXJzZUtpdCA9IGlzc3VlclpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgYCR7bmFtZX0gUHVyc2VgLFxuICAgIFB1cnNlSUtpdCxcbiAgICAoKSA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50QmFsYW5jZSA9IEFtb3VudE1hdGgubWFrZUVtcHR5KGJyYW5kLCBhc3NldEtpbmQpO1xuICAgICAgY29uc3QgcmVjb3ZlcnlTZXQgPSBpc3N1ZXJab25lLmRldGFjaGVkKCkuc2V0U3RvcmUoXCJyZWNvdmVyeSBzZXRcIik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjdXJyZW50QmFsYW5jZSxcbiAgICAgICAgcmVjb3ZlcnlTZXRcbiAgICAgIH07XG4gICAgfSxcbiAgICB7XG4gICAgICBwdXJzZToge1xuICAgICAgICBkZXBvc2l0KHNyY1BheW1lbnQsIG9wdEFtb3VudFNoYXBlID0gdm9pZCAwKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICBjb25zdCB7IHB1cnNlIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCBiYWxhbmNlU3RvcmUgPSBtYWtlQW1vdW50U3RvcmUoc3RhdGUsIFwiY3VycmVudEJhbGFuY2VcIik7XG4gICAgICAgICAgY29uc3Qgc3JjUGF5bWVudEJhbGFuY2UgPSBkZXBvc2l0SW50ZXJuYWwoXG4gICAgICAgICAgICBiYWxhbmNlU3RvcmUsXG4gICAgICAgICAgICBzcmNQYXltZW50LFxuICAgICAgICAgICAgb3B0QW1vdW50U2hhcGVcbiAgICAgICAgICApO1xuICAgICAgICAgIHVwZGF0ZUJhbGFuY2UocHVyc2UsIGJhbGFuY2VTdG9yZS5nZXRBbW91bnQoKSk7XG4gICAgICAgICAgcmV0dXJuIHNyY1BheW1lbnRCYWxhbmNlO1xuICAgICAgICB9LFxuICAgICAgICB3aXRoZHJhdyhhbW91bnQpIHtcbiAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgIGNvbnN0IHsgcHVyc2UgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IG9wdFJlY292ZXJ5U2V0ID0gbWF5YmVSZWNvdmVyeVNldChzdGF0ZSk7XG4gICAgICAgICAgY29uc3QgYmFsYW5jZVN0b3JlID0gbWFrZUFtb3VudFN0b3JlKHN0YXRlLCBcImN1cnJlbnRCYWxhbmNlXCIpO1xuICAgICAgICAgIGNvbnN0IHBheW1lbnQgPSB3aXRoZHJhd0ludGVybmFsKFxuICAgICAgICAgICAgYmFsYW5jZVN0b3JlLFxuICAgICAgICAgICAgYW1vdW50LFxuICAgICAgICAgICAgb3B0UmVjb3ZlcnlTZXRcbiAgICAgICAgICApO1xuICAgICAgICAgIHVwZGF0ZUJhbGFuY2UocHVyc2UsIGJhbGFuY2VTdG9yZS5nZXRBbW91bnQoKSk7XG4gICAgICAgICAgcmV0dXJuIHBheW1lbnQ7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEN1cnJlbnRBbW91bnQoKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICBjb25zdCBiYWxhbmNlU3RvcmUgPSBtYWtlQW1vdW50U3RvcmUoc3RhdGUsIFwiY3VycmVudEJhbGFuY2VcIik7XG4gICAgICAgICAgcmV0dXJuIGJhbGFuY2VTdG9yZS5nZXRBbW91bnQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0Q3VycmVudEFtb3VudE5vdGlmaWVyKCkge1xuICAgICAgICAgIHJldHVybiBwcm92aWRlTm90aWZpZXIodGhpcy5mYWNldHMucHVyc2UpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRBbGxlZ2VkQnJhbmQoKSB7XG4gICAgICAgICAgcmV0dXJuIGJyYW5kO1xuICAgICAgICB9LFxuICAgICAgICBnZXREZXBvc2l0RmFjZXQoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmFjZXRzLmRlcG9zaXRGYWNldDtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0UmVjb3ZlcnlTZXQoKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICBjb25zdCBvcHRSZWNvdmVyeVNldCA9IG1heWJlUmVjb3ZlcnlTZXQoc3RhdGUpO1xuICAgICAgICAgIGlmIChvcHRSZWNvdmVyeVNldCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gRU1QVFlfQ09QWV9TRVQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBvcHRSZWNvdmVyeVNldC5zbmFwc2hvdCgpO1xuICAgICAgICB9LFxuICAgICAgICByZWNvdmVyQWxsKCkge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICBsZXQgYW1vdW50ID0gQW1vdW50TWF0aC5tYWtlRW1wdHkoYnJhbmQsIGFzc2V0S2luZCk7XG4gICAgICAgICAgY29uc3Qgb3B0UmVjb3ZlcnlTZXQgPSBtYXliZVJlY292ZXJ5U2V0KHN0YXRlKTtcbiAgICAgICAgICBpZiAob3B0UmVjb3ZlcnlTZXQgPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgcmV0dXJuIGFtb3VudDtcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9yIChjb25zdCBwYXltZW50IG9mIG9wdFJlY292ZXJ5U2V0LmtleXMoKSkge1xuICAgICAgICAgICAgY29uc3QgZGVsdGEgPSBmYWNldHMucHVyc2UuZGVwb3NpdChwYXltZW50KTtcbiAgICAgICAgICAgIGFtb3VudCA9IEFtb3VudE1hdGguYWRkKGFtb3VudCwgZGVsdGEsIGJyYW5kKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgb3B0UmVjb3ZlcnlTZXQuZ2V0U2l6ZSgpID09PSAwIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IFJlbWFpbmluZyB1bnJlY292ZXJlZCBwYXltZW50czogJHtmYWNldHMucHVyc2UuZ2V0UmVjb3ZlcnlTZXQoKX1gO1xuICAgICAgICAgIHJldHVybiBhbW91bnQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBkZXBvc2l0RmFjZXQ6IHtcbiAgICAgICAgcmVjZWl2ZSguLi5hcmdzKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmFjZXRzLnB1cnNlLmRlcG9zaXQoLi4uYXJncyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIHN0YXRlU2hhcGU6IHtcbiAgICAgICAgY3VycmVudEJhbGFuY2U6IGFtb3VudFNoYXBlLFxuICAgICAgICByZWNvdmVyeVNldDogTS5yZW1vdGFibGUoXCJyZWNvdmVyeVNldFwiKVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuICgpID0+IG1ha2VQdXJzZUtpdCgpLnB1cnNlO1xufTtcbmhhcmRlbihwcmVwYXJlUHVyc2VLaW5kKTtcblxuLy9cbnZhciBhbW91bnRTaGFwZUZyb21FbGVtZW50U2hhcGUgPSAoYnJhbmQsIGFzc2V0S2luZCwgZWxlbWVudFNoYXBlKSA9PiB7XG4gIGxldCB2YWx1ZVNoYXBlO1xuICBzd2l0Y2ggKGFzc2V0S2luZCkge1xuICAgIGNhc2UgXCJuYXRcIjoge1xuICAgICAgdmFsdWVTaGFwZSA9IE0ubmF0KCk7XG4gICAgICBlbGVtZW50U2hhcGUgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYEZ1bmdpYmxlIGFzc2V0cyBjYW5ub3QgaGF2ZSBhbiBlbGVtZW50U2hhcGU6ICR7cXVvdGUoZWxlbWVudFNoYXBlKX1gO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgXCJzZXRcIjoge1xuICAgICAgaWYgKGVsZW1lbnRTaGFwZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHZhbHVlU2hhcGUgPSBNLmFycmF5T2YoTS5rZXkoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZVNoYXBlID0gTS5hcnJheU9mKE0uYW5kKE0ua2V5KCksIGVsZW1lbnRTaGFwZSkpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgXCJjb3B5U2V0XCI6IHtcbiAgICAgIGlmIChlbGVtZW50U2hhcGUgPT09IHZvaWQgMCkge1xuICAgICAgICB2YWx1ZVNoYXBlID0gTS5zZXQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlU2hhcGUgPSBNLnNldE9mKGVsZW1lbnRTaGFwZSk7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSBcImNvcHlCYWdcIjoge1xuICAgICAgaWYgKGVsZW1lbnRTaGFwZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHZhbHVlU2hhcGUgPSBNLmJhZygpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWVTaGFwZSA9IE0uYmFnT2YoZWxlbWVudFNoYXBlKTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgYXNzZXQga2luZCAke3F1b3RlKGFzc2V0S2luZCl9YDtcbiAgICB9XG4gIH1cbiAgY29uc3QgYW1vdW50U2hhcGUgPSBoYXJkZW4oe1xuICAgIGJyYW5kLFxuICAgIC8vXG4gICAgdmFsdWU6IHZhbHVlU2hhcGVcbiAgfSk7XG4gIHJldHVybiBhbW91bnRTaGFwZTtcbn07XG52YXIgcHJlcGFyZVBheW1lbnRMZWRnZXIgPSAoaXNzdWVyWm9uZSwgbmFtZSwgYXNzZXRLaW5kLCBkaXNwbGF5SW5mbywgZWxlbWVudFNoYXBlLCByZWNvdmVyeVNldHNTdGF0ZSwgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCBicmFuZCA9IGlzc3VlclpvbmUuZXhvKGAke25hbWV9IGJyYW5kYCwgQnJhbmRJLCB7XG4gICAgaXNNeUlzc3VlcihhbGxlZ2VkSXNzdWVyKSB7XG4gICAgICByZXR1cm4gYWxsZWdlZElzc3VlciA9PT0gaXNzdWVyO1xuICAgIH0sXG4gICAgZ2V0QWxsZWdlZE5hbWUoKSB7XG4gICAgICByZXR1cm4gbmFtZTtcbiAgICB9LFxuICAgIC8vXG4gICAgZ2V0RGlzcGxheUluZm8oKSB7XG4gICAgICByZXR1cm4gZGlzcGxheUluZm87XG4gICAgfSxcbiAgICBnZXRBbW91bnRTaGFwZSgpIHtcbiAgICAgIHJldHVybiBhbW91bnRTaGFwZTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBhbW91bnRTaGFwZSA9IGFtb3VudFNoYXBlRnJvbUVsZW1lbnRTaGFwZShcbiAgICBicmFuZCxcbiAgICBhc3NldEtpbmQsXG4gICAgZWxlbWVudFNoYXBlXG4gICk7XG4gIGNvbnN0IHsgSXNzdWVySSwgTWludEksIFBheW1lbnRJLCBQdXJzZUlLaXQgfSA9IG1ha2VJc3N1ZXJJbnRlcmZhY2VzKFxuICAgIGJyYW5kLFxuICAgIGFzc2V0S2luZCxcbiAgICBhbW91bnRTaGFwZVxuICApO1xuICBjb25zdCBtYWtlUGF5bWVudCA9IHByZXBhcmVQYXltZW50S2luZChpc3N1ZXJab25lLCBuYW1lLCBicmFuZCwgUGF5bWVudEkpO1xuICBjb25zdCBzaHV0ZG93bkxlZGdlcldpdGhGYWlsdXJlID0gKHJlYXNvbikgPT4ge1xuICAgIGlmIChvcHRTaHV0ZG93bldpdGhGYWlsdXJlICE9PSB2b2lkIDApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmUocmVhc29uKTtcbiAgICAgIH0gY2F0Y2ggKGVyckluU2h1dGRvd24pIHtcbiAgICAgICAgbm90ZShlcnJJblNodXRkb3duLCByZWRhY3RlZGBDYXVzZWQgYnk6ICR7cmVhc29ufWApO1xuICAgICAgICB0aHJvdyBlcnJJblNodXRkb3duO1xuICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyByZWFzb247XG4gIH07XG4gIGNvbnN0IHBheW1lbnRMZWRnZXIgPSBpc3N1ZXJab25lLndlYWtNYXBTdG9yZShcInBheW1lbnRMZWRnZXJcIiwge1xuICAgIHZhbHVlU2hhcGU6IGFtb3VudFNoYXBlXG4gIH0pO1xuICBjb25zdCBwYXltZW50UmVjb3ZlcnlTZXRzID0gaXNzdWVyWm9uZS53ZWFrTWFwU3RvcmUoXCJwYXltZW50UmVjb3ZlcnlTZXRzXCIpO1xuICBjb25zdCBpbml0UGF5bWVudCA9IChwYXltZW50LCBhbW91bnQsIG9wdFJlY292ZXJ5U2V0ID0gdm9pZCAwKSA9PiB7XG4gICAgaWYgKHJlY292ZXJ5U2V0c1N0YXRlID09PSBcIm5vUmVjb3ZlcnlTZXRzXCIpIHtcbiAgICAgIG9wdFJlY292ZXJ5U2V0ID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGB3aGVuIHJlY292ZXJTZXRzU3RhdGUgPT09ICdub1JlY292ZXJ5U2V0cycsIG9wdFJlY292ZXJ5U2V0IG11c3QgYmUgZW1wdHlgO1xuICAgIH1cbiAgICBpZiAob3B0UmVjb3ZlcnlTZXQgIT09IHZvaWQgMCAmJiAhQW1vdW50TWF0aC5pc0VtcHR5KGFtb3VudCkpIHtcbiAgICAgIG9wdFJlY292ZXJ5U2V0LmFkZChwYXltZW50KTtcbiAgICAgIHBheW1lbnRSZWNvdmVyeVNldHMuaW5pdChwYXltZW50LCBvcHRSZWNvdmVyeVNldCk7XG4gICAgfVxuICAgIHBheW1lbnRMZWRnZXIuaW5pdChwYXltZW50LCBhbW91bnQpO1xuICB9O1xuICBjb25zdCBkZWxldGVQYXltZW50ID0gKHBheW1lbnQpID0+IHtcbiAgICBwYXltZW50TGVkZ2VyLmRlbGV0ZShwYXltZW50KTtcbiAgICBpZiAocGF5bWVudFJlY292ZXJ5U2V0cy5oYXMocGF5bWVudCkpIHtcbiAgICAgIGNvbnN0IHJlY292ZXJ5U2V0ID0gcGF5bWVudFJlY292ZXJ5U2V0cy5nZXQocGF5bWVudCk7XG4gICAgICBwYXltZW50UmVjb3ZlcnlTZXRzLmRlbGV0ZShwYXltZW50KTtcbiAgICAgIHJlY292ZXJ5U2V0LmRlbGV0ZShwYXltZW50KTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGNvZXJjZSA9IChhbGxlZ2VkQW1vdW50KSA9PiBBbW91bnRNYXRoLmNvZXJjZShicmFuZCwgYWxsZWdlZEFtb3VudCk7XG4gIGNvbnN0IGFzc2VydEFtb3VudENvbnNpc3RlbnQgPSAocGF5bWVudEJhbGFuY2UsIG9wdEFtb3VudFNoYXBlKSA9PiB7XG4gICAgaWYgKG9wdEFtb3VudFNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaChwYXltZW50QmFsYW5jZSwgb3B0QW1vdW50U2hhcGUsIFwiYW1vdW50XCIpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgYXNzZXJ0TGl2ZVBheW1lbnQgPSAocGF5bWVudCkgPT4ge1xuICAgIHBheW1lbnRMZWRnZXIuaGFzKHBheW1lbnQpIHx8IHRocm93UmVkYWN0ZWRgJHtwYXltZW50fSB3YXMgbm90IGEgbGl2ZSBwYXltZW50IGZvciBicmFuZCAke3F1b3RlKFxuICAgICAgYnJhbmRcbiAgICApfS4gSXQgY291bGQgYmUgYSB1c2VkLXVwIHBheW1lbnQsIGEgcGF5bWVudCBmb3IgYW5vdGhlciBicmFuZCwgb3IgaXQgbWlnaHQgbm90IGJlIGEgcGF5bWVudCBhdCBhbGwuYDtcbiAgfTtcbiAgY29uc3QgZGVwb3NpdEludGVybmFsID0gKGJhbGFuY2VTdG9yZSwgc3JjUGF5bWVudCwgb3B0QW1vdW50U2hhcGUgPSB2b2lkIDApID0+IHtcbiAgICAhaXNQcm9taXNlKHNyY1BheW1lbnQpIHx8IGFzc2VydC5mYWlsKFxuICAgICAgYGRlcG9zaXQgZG9lcyBub3QgYWNjZXB0IHByb21pc2VzIGFzIGZpcnN0IGFyZ3VtZW50LiBJbnN0ZWFkIG9mIHBhc3NpbmcgdGhlIHByb21pc2UgKGRlcG9zaXQocGF5bWVudFByb21pc2UpKSwgY29uc2lkZXIgdW53cmFwcGluZyB0aGUgcHJvbWlzZSBmaXJzdDogRS53aGVuKHBheW1lbnRQcm9taXNlLCAoYWN0dWFsUGF5bWVudCA9PiBkZXBvc2l0KGFjdHVhbFBheW1lbnQpKWAsXG4gICAgICBUeXBlRXJyb3JcbiAgICApO1xuICAgIGFzc2VydExpdmVQYXltZW50KHNyY1BheW1lbnQpO1xuICAgIGNvbnN0IHNyY1BheW1lbnRCYWxhbmNlID0gcGF5bWVudExlZGdlci5nZXQoc3JjUGF5bWVudCk7XG4gICAgYXNzZXJ0QW1vdW50Q29uc2lzdGVudChzcmNQYXltZW50QmFsYW5jZSwgb3B0QW1vdW50U2hhcGUpO1xuICAgIHRyeSB7XG4gICAgICBkZWxldGVQYXltZW50KHNyY1BheW1lbnQpO1xuICAgICAgYmFsYW5jZVN0b3JlLmluY3JlbWVudChzcmNQYXltZW50QmFsYW5jZSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBzaHV0ZG93bkxlZGdlcldpdGhGYWlsdXJlKGVycik7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIHJldHVybiBzcmNQYXltZW50QmFsYW5jZTtcbiAgfTtcbiAgY29uc3Qgd2l0aGRyYXdJbnRlcm5hbCA9IChiYWxhbmNlU3RvcmUsIGFtb3VudCwgcmVjb3ZlcnlTZXQgPSB2b2lkIDApID0+IHtcbiAgICBhbW91bnQgPSBjb2VyY2UoYW1vdW50KTtcbiAgICBjb25zdCBwYXltZW50ID0gbWFrZVBheW1lbnQoKTtcbiAgICBiYWxhbmNlU3RvcmUuZGVjcmVtZW50KGFtb3VudCkgfHwgdGhyb3dSZWRhY3RlZGBXaXRoZHJhd2FsIG9mICR7YW1vdW50fSBmYWlsZWQgYmVjYXVzZSB0aGUgcHVyc2Ugb25seSBjb250YWluZWQgJHtiYWxhbmNlU3RvcmUuZ2V0QW1vdW50KCl9YDtcbiAgICB0cnkge1xuICAgICAgaW5pdFBheW1lbnQocGF5bWVudCwgYW1vdW50LCByZWNvdmVyeVNldCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBzaHV0ZG93bkxlZGdlcldpdGhGYWlsdXJlKGVycik7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIHJldHVybiBwYXltZW50O1xuICB9O1xuICBjb25zdCBtYWtlRW1wdHlQdXJzZSA9IHByZXBhcmVQdXJzZUtpbmQoXG4gICAgaXNzdWVyWm9uZSxcbiAgICBuYW1lLFxuICAgIGFzc2V0S2luZCxcbiAgICBicmFuZCxcbiAgICBQdXJzZUlLaXQsXG4gICAgaGFyZGVuKHtcbiAgICAgIGRlcG9zaXRJbnRlcm5hbCxcbiAgICAgIHdpdGhkcmF3SW50ZXJuYWxcbiAgICB9KSxcbiAgICByZWNvdmVyeVNldHNTdGF0ZSxcbiAgICBwYXltZW50UmVjb3ZlcnlTZXRzXG4gICk7XG4gIGNvbnN0IGlzc3VlciA9IGlzc3VlclpvbmUuZXhvKGAke25hbWV9IGlzc3VlcmAsIElzc3VlckksIHtcbiAgICBnZXRCcmFuZCgpIHtcbiAgICAgIHJldHVybiBicmFuZDtcbiAgICB9LFxuICAgIGdldEFsbGVnZWROYW1lKCkge1xuICAgICAgcmV0dXJuIG5hbWU7XG4gICAgfSxcbiAgICBnZXRBc3NldEtpbmQoKSB7XG4gICAgICByZXR1cm4gYXNzZXRLaW5kO1xuICAgIH0sXG4gICAgZ2V0RGlzcGxheUluZm8oKSB7XG4gICAgICByZXR1cm4gZGlzcGxheUluZm87XG4gICAgfSxcbiAgICBtYWtlRW1wdHlQdXJzZSgpIHtcbiAgICAgIHJldHVybiBtYWtlRW1wdHlQdXJzZSgpO1xuICAgIH0sXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgaXNMaXZlKHBheW1lbnQpIHtcbiAgICAgIHJldHVybiBwYXltZW50TGVkZ2VyLmhhcyhwYXltZW50KTtcbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGdldEFtb3VudE9mKHBheW1lbnQpIHtcbiAgICAgIGFzc2VydExpdmVQYXltZW50KHBheW1lbnQpO1xuICAgICAgcmV0dXJuIHBheW1lbnRMZWRnZXIuZ2V0KHBheW1lbnQpO1xuICAgIH0sXG4gICAgLypcblxuXG4gICAgICovXG4gICAgYnVybihwYXltZW50LCBvcHRBbW91bnRTaGFwZSA9IHZvaWQgMCkge1xuICAgICAgYXNzZXJ0TGl2ZVBheW1lbnQocGF5bWVudCk7XG4gICAgICBjb25zdCBwYXltZW50QmFsYW5jZSA9IHBheW1lbnRMZWRnZXIuZ2V0KHBheW1lbnQpO1xuICAgICAgYXNzZXJ0QW1vdW50Q29uc2lzdGVudChwYXltZW50QmFsYW5jZSwgb3B0QW1vdW50U2hhcGUpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgZGVsZXRlUGF5bWVudChwYXltZW50KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBzaHV0ZG93bkxlZGdlcldpdGhGYWlsdXJlKGVycik7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwYXltZW50QmFsYW5jZTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBtaW50UmVjb3ZlcnlQdXJzZSA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICAgIGlzc3VlclpvbmUubWFrZU9uY2UoXCJtaW50UmVjb3ZlcnlQdXJzZVwiLCAoKSA9PiBtYWtlRW1wdHlQdXJzZSgpKVxuICApO1xuICBjb25zdCBtaW50ID0gaXNzdWVyWm9uZS5leG8oYCR7bmFtZX0gbWludGAsIE1pbnRJLCB7XG4gICAgZ2V0SXNzdWVyKCkge1xuICAgICAgcmV0dXJuIGlzc3VlcjtcbiAgICB9LFxuICAgIG1pbnRQYXltZW50KG5ld0Ftb3VudCkge1xuICAgICAgbmV3QW1vdW50ID0gY29lcmNlKG5ld0Ftb3VudCk7XG4gICAgICBtdXN0TWF0Y2gobmV3QW1vdW50LCBhbW91bnRTaGFwZSwgXCJtaW50ZWQgYW1vdW50XCIpO1xuICAgICAgY29uc3QgcmF3UGF5bWVudCA9IG1ha2VQYXltZW50KCk7XG4gICAgICBpbml0UGF5bWVudChyYXdQYXltZW50LCBuZXdBbW91bnQsIHZvaWQgMCk7XG4gICAgICBjb25zdCBtaW50UmVjb3ZlcnlQdXJzZUJlZm9yZSA9IG1pbnRSZWNvdmVyeVB1cnNlLmdldEN1cnJlbnRBbW91bnQoKTtcbiAgICAgIG1pbnRSZWNvdmVyeVB1cnNlLmRlcG9zaXQocmF3UGF5bWVudCwgbmV3QW1vdW50KTtcbiAgICAgIGNvbnN0IHBheW1lbnQgPSBtaW50UmVjb3ZlcnlQdXJzZS53aXRoZHJhdyhuZXdBbW91bnQpO1xuICAgICAgY29uc3QgbWludFJlY292ZXJ5UHVyc2VBZnRlciA9IG1pbnRSZWNvdmVyeVB1cnNlLmdldEN1cnJlbnRBbW91bnQoKTtcbiAgICAgIGFzc2VydChrZXlFUShtaW50UmVjb3ZlcnlQdXJzZUJlZm9yZSwgbWludFJlY292ZXJ5UHVyc2VBZnRlcikpO1xuICAgICAgcmV0dXJuIHBheW1lbnQ7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgaXNzdWVyS2l0ID0gaGFyZGVuKHsgaXNzdWVyLCBtaW50LCBicmFuZCwgbWludFJlY292ZXJ5UHVyc2UgfSk7XG4gIHJldHVybiBpc3N1ZXJLaXQ7XG59O1xuaGFyZGVuKHByZXBhcmVQYXltZW50TGVkZ2VyKTtcblxuLy9cbnZhciBzZXR1cElzc3VlcktpdCA9ICh7IG5hbWUsIGFzc2V0S2luZCwgZGlzcGxheUluZm8sIGVsZW1lbnRTaGFwZSB9LCBpc3N1ZXJab25lLCByZWNvdmVyeVNldHNTdGF0ZSwgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSA9IHZvaWQgMCkgPT4ge1xuICBhc3NlcnQyLnR5cGVvZihuYW1lLCBcInN0cmluZ1wiKTtcbiAgYXNzZXJ0QXNzZXRLaW5kKGFzc2V0S2luZCk7XG4gIGNvbnN0IGNsZWFuRGlzcGxheUluZm8gPSBjb2VyY2VEaXNwbGF5SW5mbyhkaXNwbGF5SW5mbywgYXNzZXRLaW5kKTtcbiAgaWYgKG9wdFNodXRkb3duV2l0aEZhaWx1cmUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydDIudHlwZW9mKG9wdFNodXRkb3duV2l0aEZhaWx1cmUsIFwiZnVuY3Rpb25cIik7XG4gIH1cbiAgaWYgKGVsZW1lbnRTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihlbGVtZW50U2hhcGUpO1xuICB9XG4gIGNvbnN0IHsgaXNzdWVyLCBtaW50LCBicmFuZCwgbWludFJlY292ZXJ5UHVyc2UgfSA9IHByZXBhcmVQYXltZW50TGVkZ2VyKFxuICAgIGlzc3VlclpvbmUsXG4gICAgbmFtZSxcbiAgICBhc3NldEtpbmQsXG4gICAgY2xlYW5EaXNwbGF5SW5mbyxcbiAgICBlbGVtZW50U2hhcGUsXG4gICAgcmVjb3ZlcnlTZXRzU3RhdGUsXG4gICAgb3B0U2h1dGRvd25XaXRoRmFpbHVyZVxuICApO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBicmFuZCxcbiAgICBpc3N1ZXIsXG4gICAgbWludCxcbiAgICBtaW50UmVjb3ZlcnlQdXJzZSxcbiAgICBkaXNwbGF5SW5mbzogY2xlYW5EaXNwbGF5SW5mb1xuICB9KTtcbn07XG5oYXJkZW4oc2V0dXBJc3N1ZXJLaXQpO1xudmFyIElOU1RBTkNFX0tFWSA9IFwiaXNzdWVyXCI7XG52YXIgUkVDT1ZFUllfU0VUU19TVEFURSA9IFwicmVjb3ZlcnlTZXRzU3RhdGVcIjtcbnZhciB1cGdyYWRlSXNzdWVyS2l0ID0gKGlzc3VlckJhZ2dhZ2UsIG9wdFNodXRkb3duV2l0aEZhaWx1cmUgPSB2b2lkIDAsIHJlY292ZXJ5U2V0c09wdGlvbiA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCBpc3N1ZXJSZWNvcmQgPSBpc3N1ZXJCYWdnYWdlLmdldChJTlNUQU5DRV9LRVkpO1xuICBjb25zdCBpc3N1ZXJab25lID0gbWFrZUR1cmFibGVab25lKGlzc3VlckJhZ2dhZ2UpO1xuICBjb25zdCBvbGRSZWNvdmVyeVNldHNTdGF0ZSA9IGlzc3VlckJhZ2dhZ2UuaGFzKFJFQ09WRVJZX1NFVFNfU1RBVEUpID8gaXNzdWVyQmFnZ2FnZS5nZXQoUkVDT1ZFUllfU0VUU19TVEFURSkgOiBcImhhc1JlY292ZXJ5U2V0c1wiO1xuICBpZiAob2xkUmVjb3ZlcnlTZXRzU3RhdGUgPT09IFwibm9SZWNvdmVyeVNldHNcIiAmJiByZWNvdmVyeVNldHNPcHRpb24gPT09IFwiaGFzUmVjb3ZlcnlTZXRzXCIpIHtcbiAgICB0aHJvd1JlZGFjdGVkYENhbm5vdCAoeWV0PykgdXBncmFkZSBmcm9tICdub1JlY292ZXJ5U2V0cycgdG8gJ2hhc1JlY292ZXJ5U2V0cydgO1xuICB9XG4gIGNvbnN0IHJlY292ZXJ5U2V0c1N0YXRlID0gcmVjb3ZlcnlTZXRzT3B0aW9uIHx8IG9sZFJlY292ZXJ5U2V0c1N0YXRlO1xuICByZXR1cm4gc2V0dXBJc3N1ZXJLaXQoXG4gICAgaXNzdWVyUmVjb3JkLFxuICAgIGlzc3VlclpvbmUsXG4gICAgcmVjb3ZlcnlTZXRzU3RhdGUsXG4gICAgb3B0U2h1dGRvd25XaXRoRmFpbHVyZVxuICApO1xufTtcbmhhcmRlbih1cGdyYWRlSXNzdWVyS2l0KTtcbnZhciBoYXNJc3N1ZXIgPSAoYmFnZ2FnZSkgPT4gYmFnZ2FnZS5oYXMoSU5TVEFOQ0VfS0VZKTtcbnZhciBtYWtlRHVyYWJsZUlzc3VlcktpdCA9IChpc3N1ZXJCYWdnYWdlLCBuYW1lLCBhc3NldEtpbmQgPSBBc3NldEtpbmQuTkFULCBkaXNwbGF5SW5mbyA9IGhhcmRlbih7fSksIG9wdFNodXRkb3duV2l0aEZhaWx1cmUgPSB2b2lkIDAsIHsgZWxlbWVudFNoYXBlID0gdm9pZCAwLCByZWNvdmVyeVNldHNPcHRpb24gPSB2b2lkIDAgfSA9IHt9KSA9PiB7XG4gIGNvbnN0IGlzc3VlckRhdGEgPSBoYXJkZW4oe1xuICAgIG5hbWUsXG4gICAgYXNzZXRLaW5kLFxuICAgIGRpc3BsYXlJbmZvLFxuICAgIGVsZW1lbnRTaGFwZVxuICB9KTtcbiAgaXNzdWVyQmFnZ2FnZS5pbml0KElOU1RBTkNFX0tFWSwgaXNzdWVyRGF0YSk7XG4gIGNvbnN0IGlzc3VlclpvbmUgPSBtYWtlRHVyYWJsZVpvbmUoaXNzdWVyQmFnZ2FnZSk7XG4gIGNvbnN0IHJlY292ZXJ5U2V0c1N0YXRlID0gcmVjb3ZlcnlTZXRzT3B0aW9uIHx8IFwiaGFzUmVjb3ZlcnlTZXRzXCI7XG4gIGlzc3VlckJhZ2dhZ2UuaW5pdChSRUNPVkVSWV9TRVRTX1NUQVRFLCByZWNvdmVyeVNldHNTdGF0ZSk7XG4gIHJldHVybiBzZXR1cElzc3VlcktpdChcbiAgICBpc3N1ZXJEYXRhLFxuICAgIGlzc3VlclpvbmUsXG4gICAgcmVjb3ZlcnlTZXRzU3RhdGUsXG4gICAgb3B0U2h1dGRvd25XaXRoRmFpbHVyZVxuICApO1xufTtcbmhhcmRlbihtYWtlRHVyYWJsZUlzc3VlcktpdCk7XG52YXIgcHJlcGFyZUlzc3VlcktpdCA9IChpc3N1ZXJCYWdnYWdlLCBuYW1lLCBhc3NldEtpbmQgPSBBc3NldEtpbmQuTkFULCBkaXNwbGF5SW5mbyA9IGhhcmRlbih7fSksIG9wdFNodXRkb3duV2l0aEZhaWx1cmUgPSB2b2lkIDAsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICBpZiAoaGFzSXNzdWVyKGlzc3VlckJhZ2dhZ2UpKSB7XG4gICAgY29uc3QgeyBlbGVtZW50U2hhcGU6IF8gPSB2b2lkIDAsIHJlY292ZXJ5U2V0c09wdGlvbiA9IHZvaWQgMCB9ID0gb3B0aW9ucztcbiAgICBjb25zdCBpc3N1ZXJLaXQgPSB1cGdyYWRlSXNzdWVyS2l0KFxuICAgICAgaXNzdWVyQmFnZ2FnZSxcbiAgICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmUsXG4gICAgICByZWNvdmVyeVNldHNPcHRpb25cbiAgICApO1xuICAgIHJldHVybiBpc3N1ZXJLaXQ7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgaXNzdWVyS2l0ID0gbWFrZUR1cmFibGVJc3N1ZXJLaXQoXG4gICAgICBpc3N1ZXJCYWdnYWdlLFxuICAgICAgbmFtZSxcbiAgICAgIGFzc2V0S2luZCxcbiAgICAgIGRpc3BsYXlJbmZvLFxuICAgICAgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSxcbiAgICAgIG9wdGlvbnNcbiAgICApO1xuICAgIHJldHVybiBpc3N1ZXJLaXQ7XG4gIH1cbn07XG5oYXJkZW4ocHJlcGFyZUlzc3VlcktpdCk7XG52YXIgbWFrZUlzc3VlcktpdCA9IChuYW1lLCBhc3NldEtpbmQgPSBBc3NldEtpbmQuTkFULCBkaXNwbGF5SW5mbyA9IGhhcmRlbih7fSksIG9wdFNodXRkb3duV2l0aEZhaWx1cmUgPSB2b2lkIDAsIHsgZWxlbWVudFNoYXBlID0gdm9pZCAwLCByZWNvdmVyeVNldHNPcHRpb24gPSB2b2lkIDAgfSA9IHt9KSA9PiAoXG4gIC8vXG4gIG1ha2VEdXJhYmxlSXNzdWVyS2l0KFxuICAgIG1ha2VTY2FsYXJCaWdNYXBTdG9yZTMoXCJkcm9wcGVkIGlzc3VlciBraXRcIiwgeyBkdXJhYmxlOiB0cnVlIH0pLFxuICAgIG5hbWUsXG4gICAgYXNzZXRLaW5kLFxuICAgIGRpc3BsYXlJbmZvLFxuICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmUsXG4gICAgeyBlbGVtZW50U2hhcGUsIHJlY292ZXJ5U2V0c09wdGlvbiB9XG4gIClcbik7XG5oYXJkZW4obWFrZUlzc3VlcktpdCk7XG5cbi8vXG52YXIgUHVibGljVG9waWNTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBzdWJzY3JpYmVyOiBTdWJzY3JpYmVyU2hhcGUsXG4gICAgc3RvcmFnZVBhdGg6IE0ub3IoTS5wcm9taXNlKFxuICAgICAgLyogICAgICAgICovXG4gICAgKSwgTS5zdHJpbmcoKSlcbiAgfSxcbiAgeyBkZXNjcmlwdGlvbjogTS5zdHJpbmcoKSB9XG4pO1xudmFyIFRvcGljc1JlY29yZFNoYXBlID0gTS5yZWNvcmRPZihNLnN0cmluZygpLCBQdWJsaWNUb3BpY1NoYXBlKTtcblxuLy9cbnZhciB7IFZvdyQgfSA9IFNoYXBlO1xudmFyIG9yY2hlc3RyYXRpb25BY2NvdW50TWV0aG9kcyA9IHtcbiAgZ2V0QWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSksXG4gIGdldEJhbGFuY2U6IE0uY2FsbChNLm9yKEJyYW5kU2hhcGUsIE0uc3RyaW5nKCkpKS5yZXR1cm5zKFxuICAgIFZvdyQoRGVub21BbW91bnRTaGFwZSlcbiAgKSxcbiAgZ2V0QmFsYW5jZXM6IE0uY2FsbCgpLnJldHVybnMoVm93JChNLmFycmF5T2YoRGVub21BbW91bnRTaGFwZSkpKSxcbiAgc2VuZDogTS5jYWxsKEFjY291bnRJZEFyZ1NoYXBlLCBBbW91bnRBcmdTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIHNlbmRBbGw6IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSwgTS5hcnJheU9mKEFtb3VudEFyZ1NoYXBlKSkucmV0dXJucyhcbiAgICBWb3dTaGFwZVxuICApLFxuICB0cmFuc2ZlcjogTS5jYWxsKEFjY291bnRJZEFyZ1NoYXBlLCBBbW91bnRBcmdTaGFwZSkub3B0aW9uYWwoSUJDVHJhbnNmZXJPcHRpb25zU2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICB0cmFuc2ZlclN0ZXBzOiBNLmNhbGwoQW1vdW50QXJnU2hhcGUsIE0uYW55KCkpLnJldHVybnMoVm93U2hhcGUpLFxuICBhc0NvbnRpbnVpbmdPZmZlcjogTS5jYWxsKCkucmV0dXJucyhcbiAgICBWb3ckKHtcbiAgICAgIHB1YmxpY1N1YnNjcmliZXJzOiBUb3BpY3NSZWNvcmRTaGFwZSxcbiAgICAgIGludml0YXRpb25NYWtlcnM6IE0uYW55KCksXG4gICAgICBob2xkZXI6IE0ucmVtb3RhYmxlKClcbiAgICB9KVxuICApLFxuICBnZXRQdWJsaWNUb3BpY3M6IE0uY2FsbCgpLnJldHVybnMoVm93JChUb3BpY3NSZWNvcmRTaGFwZSkpXG59O1xuXG4vL1xudmFyIG1ha2VXZWFrU2V0U3RvcmVNZXRob2RzNiA9IChqc3NldCwgYXNzZXJ0S2V5T2tUb0FkZCwgYXNzZXJ0S2V5T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgYXNzZXJ0S2V5RXhpc3RzID0gKGtleSkgPT4ganNzZXQuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKGtleU5hbWUpfSBub3QgZm91bmQ6ICR7a2V5fWA7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGhhczogKGtleSkgPT4ge1xuICAgICAgcmV0dXJuIGpzc2V0LmhhcyhrZXkpO1xuICAgIH0sXG4gICAgYWRkOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlPa1RvQWRkKGtleSk7XG4gICAgICBqc3NldC5hZGQoa2V5KTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBpZiAoYXNzZXJ0S2V5T2tUb0RlbGV0ZSAhPT0gdm9pZCAwKSB7XG4gICAgICAgIGFzc2VydEtleU9rVG9EZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICAgIGpzc2V0LmRlbGV0ZShrZXkpO1xuICAgIH0sXG4gICAgYWRkQWxsOiAoa2V5czUpID0+IHtcbiAgICAgIGlmICh0eXBlb2Yga2V5czVbU3ltYm9sLml0ZXJhdG9yXSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGlmIChPYmplY3QuaXNGcm96ZW4oa2V5czUpICYmIGlzQ29weVNldChrZXlzNSkpIHtcbiAgICAgICAgICBrZXlzNSA9IGdldENvcHlTZXRLZXlzKGtleXM1KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvd1JlZGFjdGVkYHByb3ZpZGVkIGRhdGEgc291cmNlIGlzIG5vdCBpdGVyYWJsZTogJHtrZXlzNX1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKFxuICAgICAgICBjb25zdCBrZXkgb2ZcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAga2V5czVcbiAgICAgICkge1xuICAgICAgICBhc3NlcnRLZXlPa1RvQWRkKGtleSk7XG4gICAgICAgIGpzc2V0LmFkZChrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xudmFyIG1ha2VTY2FsYXJXZWFrU2V0U3RvcmU2ID0gKHRhZyA9IFwia2V5XCIsIHsgbG9uZ0xpdmVkID0gdHJ1ZSwga2V5U2hhcGUgPSB2b2lkIDAgfSA9IHt9KSA9PiB7XG4gIGNvbnN0IGpzc2V0ID0gbmV3IChsb25nTGl2ZWQgPyBXZWFrU2V0IDogU2V0KSgpO1xuICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oa2V5U2hhcGUpO1xuICB9XG4gIGNvbnN0IGFzc2VydEtleU9rVG9BZGQgPSAoa2V5KSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgcGFzc1N0eWxlT2Yoa2V5KSA9PT0gXCJyZW1vdGFibGVcIiB8fCB0aHJvd1JlZGFjdGVkYE9ubHkgcmVtb3RhYmxlcyBjYW4gYmUga2V5cyBvZiBzY2FsYXIgV2Vha1N0b3JlczogJHtrZXl9YDtcbiAgICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKGtleSwga2V5U2hhcGUsIFwid2Vha1NldFN0b3JlIGtleVwiKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBGYXIoYHNjYWxhciBXZWFrU2V0U3RvcmUgb2YgJHtxdW90ZSh0YWcpfWAsIHtcbiAgICAuLi5tYWtlV2Vha1NldFN0b3JlTWV0aG9kczYoanNzZXQsIGFzc2VydEtleU9rVG9BZGQsIHZvaWQgMCwgdGFnKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZVNjYWxhcldlYWtTZXRTdG9yZTYpO1xuXG4vL1xudmFyIG1ha2VDdXJyZW50S2V5c0tpdDYgPSAoZ2V0UmF3S2V5cywgY2hlY2tIYXMsIGNvbXBhcmUsIGFzc2VydE9rVG9BZGQsIGFzc2VydE9rVG9EZWxldGUgPSB2b2lkIDAsIGtleU5hbWUgPSBcImtleVwiKSA9PiB7XG4gIGxldCB1cGRhdGVDb3VudCA9IDA7XG4gIGxldCBzb3J0ZWRLZXlzTWVtbztcbiAgY29uc3QgYXNzZXJ0VXBkYXRlT25BZGQgPSAoaywgdjIgPSB2b2lkIDApID0+IHtcbiAgICBhc3NlcnRPa1RvQWRkKGssIHYyKTtcbiAgICB1cGRhdGVDb3VudCArPSAxO1xuICAgIHNvcnRlZEtleXNNZW1vID0gdm9pZCAwO1xuICB9O1xuICBjb25zdCBhc3NlcnRVcGRhdGVPbkRlbGV0ZSA9IChrKSA9PiBhc3NlcnRPa1RvRGVsZXRlICYmIGFzc2VydE9rVG9EZWxldGUoayk7XG4gIGNvbnN0IGdldFNvcnRlZEtleXMgPSAoKSA9PiB7XG4gICAgaWYgKHNvcnRlZEtleXNNZW1vID09PSB2b2lkIDApIHtcbiAgICAgIHNvcnRlZEtleXNNZW1vID0gaGFyZGVuKFsuLi5nZXRSYXdLZXlzKCldLnNvcnQoY29tcGFyZSkpO1xuICAgIH1cbiAgICByZXR1cm4gc29ydGVkS2V5c01lbW87XG4gIH07XG4gIGNvbnN0IGl0ZXJhYmxlS2V5cyA9IEZhcihcIkl0ZXJhYmxlIG9mIGtleXNcIiwge1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBjb25zdCBnZW5lcmF0aW9uID0gdXBkYXRlQ291bnQ7XG4gICAgICBnZXRTb3J0ZWRLZXlzKCk7XG4gICAgICBjb25zdCBsZW4gPSBzb3J0ZWRLZXlzTWVtby5sZW5ndGg7XG4gICAgICBsZXQgaTIgPSAwO1xuICAgICAgcmV0dXJuIEZhcihcIkl0ZXJhdG9yIG9mIGtleXNcIiwge1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgZ2VuZXJhdGlvbiA9PT0gdXBkYXRlQ291bnQgfHwgdGhyb3dSZWRhY3RlZGBTdG9yZSAke3F1b3RlKGtleU5hbWUpfSBjdXJzb3Igc3RhbGVgO1xuICAgICAgICAgIGZvciAoOyA7ICkge1xuICAgICAgICAgICAgaWYgKGkyIDwgbGVuKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gc29ydGVkS2V5c01lbW9baTJdO1xuICAgICAgICAgICAgICBpMiArPSAxO1xuICAgICAgICAgICAgICBpZiAoY2hlY2tIYXModmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IGZhbHNlLCB2YWx1ZSB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IHRydWUsIHZhbHVlOiB2b2lkIDAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBhc3NlcnRVcGRhdGVPbkFkZCxcbiAgICBhc3NlcnRVcGRhdGVPbkRlbGV0ZSxcbiAgICBpdGVyYWJsZUtleXNcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VDdXJyZW50S2V5c0tpdDYpO1xudmFyIHByb3ZpZGVMYXp5NiA9IChtYXBTdG9yZSwga2V5LCBtYWtlVmFsdWUpID0+IHtcbiAgaWYgKCFtYXBTdG9yZS5oYXMoa2V5KSkge1xuICAgIG1hcFN0b3JlLmluaXQoa2V5LCBtYWtlVmFsdWUoa2V5KSk7XG4gIH1cbiAgcmV0dXJuIG1hcFN0b3JlLmdldChrZXkpO1xufTtcbmhhcmRlbihwcm92aWRlTGF6eTYpO1xudmFyIG1ha2VBdG9taWNQcm92aWRlcjYgPSAoc3RvcmUpID0+IHtcbiAgY29uc3QgcGVuZGluZyA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIGNvbnN0IHByb3ZpZGVBc3luYyA9IChrZXksIG1ha2VWYWx1ZSwgZmluaXNoVmFsdWUpID0+IHtcbiAgICBpZiAoc3RvcmUuaGFzKGtleSkpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoc3RvcmUuZ2V0KGtleSkpO1xuICAgIH1cbiAgICBpZiAoIXBlbmRpbmcuaGFzKGtleSkpIHtcbiAgICAgIGNvbnN0IHZhbFAyID0gbWFrZVZhbHVlKGtleSkudGhlbigodjIpID0+IHtcbiAgICAgICAgc3RvcmUuaW5pdChrZXksIHYyKTtcbiAgICAgICAgcmV0dXJuIHYyO1xuICAgICAgfSkudGhlbigodjIpID0+IHtcbiAgICAgICAgaWYgKGZpbmlzaFZhbHVlKSB7XG4gICAgICAgICAgcmV0dXJuIGZpbmlzaFZhbHVlKGtleSwgdjIpLnRoZW4oKCkgPT4gdjIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2MjtcbiAgICAgIH0pLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICBwZW5kaW5nLmRlbGV0ZShrZXkpO1xuICAgICAgfSk7XG4gICAgICBwZW5kaW5nLnNldChrZXksIHZhbFAyKTtcbiAgICB9XG4gICAgY29uc3QgdmFsUCA9IHBlbmRpbmcuZ2V0KGtleSk7XG4gICAgYXNzZXJ0KHZhbFApO1xuICAgIHJldHVybiB2YWxQO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHsgcHJvdmlkZUFzeW5jIH0pO1xufTtcbmhhcmRlbihtYWtlQXRvbWljUHJvdmlkZXI2KTtcbnZhciBhcHBlbmRUb1N0b3JlZEFycmF5NiA9IChtYXBTdG9yZSwga2V5LCBpdGVtKSA9PiB7XG4gIGlmIChtYXBTdG9yZS5oYXMoa2V5KSkge1xuICAgIGNvbnN0IGV4dGFudCA9IG1hcFN0b3JlLmdldChrZXkpO1xuICAgIG1hcFN0b3JlLnNldChrZXksIGhhcmRlbihbLi4uZXh0YW50LCBpdGVtXSkpO1xuICB9IGVsc2Uge1xuICAgIG1hcFN0b3JlLmluaXQoa2V5LCBoYXJkZW4oW2l0ZW1dKSk7XG4gIH1cbn07XG5oYXJkZW4oYXBwZW5kVG9TdG9yZWRBcnJheTYpO1xuXG4vL1xudmFyIG1ha2VTZXRTdG9yZU1ldGhvZHM2ID0gKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCBrZXlOYW1lID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCB7IGFzc2VydFVwZGF0ZU9uQWRkLCBhc3NlcnRVcGRhdGVPbkRlbGV0ZSwgaXRlcmFibGVLZXlzIH0gPSBtYWtlQ3VycmVudEtleXNLaXQ2KFxuICAgICgpID0+IGpzc2V0LmtleXMoKSxcbiAgICAoaykgPT4ganNzZXQuaGFzKGspLFxuICAgIGNvbXBhcmVSYW5rLFxuICAgIGFzc2VydEtleU9rVG9BZGQsXG4gICAgYXNzZXJ0S2V5T2tUb0RlbGV0ZSxcbiAgICBrZXlOYW1lXG4gICk7XG4gIGNvbnN0IGtleXM1ID0gKGtleVBhdHQgPSB2b2lkIDApID0+IGtleVBhdHQgPT09IHZvaWQgMCA/IGl0ZXJhYmxlS2V5cyA6IGZpbHRlckl0ZXJhYmxlKGl0ZXJhYmxlS2V5cywgKGspID0+IG1hdGNoZXMoaywga2V5UGF0dCkpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICAuLi5tYWtlV2Vha1NldFN0b3JlTWV0aG9kczYoXG4gICAgICBqc3NldCxcbiAgICAgIGFzc2VydFVwZGF0ZU9uQWRkLFxuICAgICAgYXNzZXJ0VXBkYXRlT25EZWxldGUsXG4gICAgICBrZXlOYW1lXG4gICAgKSxcbiAgICBrZXlzOiBrZXlzNSxcbiAgICB2YWx1ZXM6IGtleXM1LFxuICAgIHNuYXBzaG90OiAoa2V5UGF0dCA9IHZvaWQgMCkgPT4gbWFrZUNvcHlTZXQoa2V5czUoa2V5UGF0dCkpLFxuICAgIGdldFNpemU6IChrZXlQYXR0ID0gdm9pZCAwKSA9PiBrZXlQYXR0ID09PSB2b2lkIDAgPyBqc3NldC5zaXplIDogWy4uLmtleXM1KGtleVBhdHQpXS5sZW5ndGgsXG4gICAgY2xlYXI6IChrZXlQYXR0ID0gdm9pZCAwKSA9PiB7XG4gICAgICBpZiAoa2V5UGF0dCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGpzc2V0LmNsZWFyKCk7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzNShrZXlQYXR0KSkge1xuICAgICAgICBqc3NldC5kZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBtYWtlU2NhbGFyU2V0U3RvcmU2ID0gKHRhZyA9IFwia2V5XCIsIHsga2V5U2hhcGUgPSB2b2lkIDAgfSA9IHt9KSA9PiB7XG4gIGNvbnN0IGpzc2V0ID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKGtleVNoYXBlKTtcbiAgfVxuICBjb25zdCBhc3NlcnRLZXlPa1RvQWRkID0gKGtleSkgPT4ge1xuICAgIGhhcmRlbihrZXkpO1xuICAgIGFzc2VydFNjYWxhcktleShrZXkpO1xuICAgIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2goa2V5LCBrZXlTaGFwZSwgXCJzZXRTdG9yZSBrZXlcIik7XG4gICAgfVxuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgU2V0U3RvcmUgb2YgJHtxdW90ZSh0YWcpfWAsIHtcbiAgICAuLi5tYWtlU2V0U3RvcmVNZXRob2RzNihqc3NldCwgYXNzZXJ0S2V5T2tUb0FkZCwgdm9pZCAwLCB0YWcpXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU2NhbGFyU2V0U3RvcmU2KTtcblxuLy9cbnZhciBtYWtlV2Vha01hcFN0b3JlTWV0aG9kczYgPSAoanNtYXAsIGFzc2VydEtWT2tUb0FkZCwgYXNzZXJ0S1ZPa1RvU2V0LCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCBrZXlOYW1lID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCBhc3NlcnRLZXlEb2VzTm90RXhpc3QgPSAoa2V5KSA9PiAhanNtYXAuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKGtleU5hbWUpfSBhbHJlYWR5IHJlZ2lzdGVyZWQ6ICR7a2V5fWA7XG4gIGNvbnN0IGFzc2VydEtleUV4aXN0cyA9IChrZXkpID0+IGpzbWFwLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShrZXlOYW1lKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiBqc21hcC5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGdldDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKiAgICAgICAgICAgICovXG4gICAgICAgIGpzbWFwLmdldChrZXkpXG4gICAgICApO1xuICAgIH0sXG4gICAgaW5pdDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleURvZXNOb3RFeGlzdChrZXkpO1xuICAgICAgYXNzZXJ0S1ZPa1RvQWRkKGtleSwgdmFsdWUpO1xuICAgICAganNtYXAuc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgc2V0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBhc3NlcnRLVk9rVG9TZXQoa2V5LCB2YWx1ZSk7XG4gICAgICBqc21hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBkZWxldGU6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgaWYgKGFzc2VydEtleU9rVG9EZWxldGUgIT09IHZvaWQgMCkge1xuICAgICAgICBhc3NlcnRLZXlPa1RvRGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgICBqc21hcC5kZWxldGUoa2V5KTtcbiAgICB9LFxuICAgIGFkZEFsbDogKGVudHJpZXMxMSkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBlbnRyaWVzMTFbU3ltYm9sLml0ZXJhdG9yXSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGlmIChPYmplY3QuaXNGcm96ZW4oZW50cmllczExKSAmJiBpc0NvcHlNYXAoZW50cmllczExKSkge1xuICAgICAgICAgIGVudHJpZXMxMSA9IGdldENvcHlNYXBFbnRyaWVzKGVudHJpZXMxMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3dSZWRhY3RlZGBwcm92aWRlZCBkYXRhIHNvdXJjZSBpcyBub3QgaXRlcmFibGU6ICR7ZW50cmllczExfWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoXG4gICAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSBvZlxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGVudHJpZXMxMVxuICAgICAgKSB7XG4gICAgICAgIGFzc2VydEtWT2tUb0FkZChrZXksIHZhbHVlKTtcbiAgICAgICAganNtYXAuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xudmFyIG1ha2VTY2FsYXJXZWFrTWFwU3RvcmU2ID0gKHRhZyA9IFwia2V5XCIsIHsgbG9uZ0xpdmVkID0gdHJ1ZSwga2V5U2hhcGUgPSB2b2lkIDAsIHZhbHVlU2hhcGUgPSB2b2lkIDAgfSA9IHt9KSA9PiB7XG4gIGNvbnN0IGpzbWFwID0gbmV3IChsb25nTGl2ZWQgPyBXZWFrTWFwIDogTWFwKSgpO1xuICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oa2V5U2hhcGUpO1xuICB9XG4gIGlmICh2YWx1ZVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKHZhbHVlU2hhcGUpO1xuICB9XG4gIGNvbnN0IGFzc2VydEtWT2tUb1NldCA9IChfa2V5LCB2YWx1ZSkgPT4ge1xuICAgIGhhcmRlbih2YWx1ZSk7XG4gICAgYXNzZXJ0UGFzc2FibGUodmFsdWUpO1xuICAgIGlmICh2YWx1ZVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaCh2YWx1ZSwgdmFsdWVTaGFwZSwgXCJ3ZWFrTWFwU3RvcmUgdmFsdWVcIik7XG4gICAgfVxuICB9O1xuICBjb25zdCBhc3NlcnRLVk9rVG9BZGQgPSAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgIGhhcmRlbihrZXkpO1xuICAgIHBhc3NTdHlsZU9mKGtleSkgPT09IFwicmVtb3RhYmxlXCIgfHwgdGhyb3dSZWRhY3RlZGBPbmx5IHJlbW90YWJsZXMgY2FuIGJlIGtleXMgb2Ygc2NhbGFyIFdlYWtNYXBTdG9yZXM6ICR7a2V5fWA7XG4gICAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaChrZXksIGtleVNoYXBlLCBcIndlYWtNYXBTdG9yZSBrZXlcIik7XG4gICAgfVxuICAgIGFzc2VydEtWT2tUb1NldChrZXksIHZhbHVlKTtcbiAgfTtcbiAgcmV0dXJuIEZhcihgc2NhbGFyIFdlYWtNYXBTdG9yZSBvZiAke3F1b3RlKHRhZyl9YCwge1xuICAgIC4uLm1ha2VXZWFrTWFwU3RvcmVNZXRob2RzNihcbiAgICAgIGpzbWFwLFxuICAgICAgYXNzZXJ0S1ZPa1RvQWRkLFxuICAgICAgYXNzZXJ0S1ZPa1RvU2V0LFxuICAgICAgdm9pZCAwLFxuICAgICAgdGFnXG4gICAgKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZVNjYWxhcldlYWtNYXBTdG9yZTYpO1xuXG4vL1xudmFyIG1ha2VNYXBTdG9yZU1ldGhvZHM2ID0gKGpzbWFwLCBhc3NlcnRLVk9rVG9BZGQsIGFzc2VydEtWT2tUb1NldCwgYXNzZXJ0S2V5T2tUb0RlbGV0ZSA9IHZvaWQgMCwgdGFnID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCB7IGFzc2VydFVwZGF0ZU9uQWRkLCBhc3NlcnRVcGRhdGVPbkRlbGV0ZSwgaXRlcmFibGVLZXlzIH0gPSBtYWtlQ3VycmVudEtleXNLaXQ2KFxuICAgICgpID0+IGpzbWFwLmtleXMoKSxcbiAgICAoaykgPT4ganNtYXAuaGFzKGspLFxuICAgIGNvbXBhcmVSYW5rLFxuICAgIGFzc2VydEtWT2tUb0FkZCxcbiAgICBhc3NlcnRLZXlPa1RvRGVsZXRlLFxuICAgIHRhZ1xuICApO1xuICBjb25zdCBrZXlzNSA9IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IHtcbiAgICBpZiAoa2V5UGF0dCA9PT0gdm9pZCAwICYmIHZhbHVlUGF0dCA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gaXRlcmFibGVLZXlzO1xuICAgIH1cbiAgICBjb25zdCBmaWx0ZXIgPSAoaykgPT4ge1xuICAgICAgaWYgKGtleVBhdHQgIT09IHZvaWQgMCAmJiAhbWF0Y2hlcyhrLCBrZXlQYXR0KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAodmFsdWVQYXR0ICE9PSB2b2lkIDAgJiYgIW1hdGNoZXMoanNtYXAuZ2V0KGspLCB2YWx1ZVBhdHQpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG4gICAgcmV0dXJuIGZpbHRlckl0ZXJhYmxlKGl0ZXJhYmxlS2V5cywgZmlsdGVyKTtcbiAgfTtcbiAgY29uc3QgdmFsdWVzOCA9IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IG1hcEl0ZXJhYmxlKGtleXM1KGtleVBhdHQsIHZhbHVlUGF0dCksIChrKSA9PiAoXG4gICAgLyogICAgICAgICAgICAqL1xuICAgIGpzbWFwLmdldChrKVxuICApKTtcbiAgY29uc3QgZW50cmllczExID0gKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4gbWFwSXRlcmFibGUoa2V5czUoa2V5UGF0dCwgdmFsdWVQYXR0KSwgKGspID0+IFtcbiAgICBrLFxuICAgIC8qICAgICAgICAgICAgKi9cbiAgICBqc21hcC5nZXQoaylcbiAgXSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIC4uLm1ha2VXZWFrTWFwU3RvcmVNZXRob2RzNihcbiAgICAgIGpzbWFwLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGFzc2VydFVwZGF0ZU9uQWRkLFxuICAgICAgYXNzZXJ0S1ZPa1RvU2V0LFxuICAgICAgYXNzZXJ0VXBkYXRlT25EZWxldGUsXG4gICAgICB0YWdcbiAgICApLFxuICAgIGtleXM6IGtleXM1LFxuICAgIHZhbHVlczogdmFsdWVzOCxcbiAgICBlbnRyaWVzOiBlbnRyaWVzMTEsXG4gICAgc25hcHNob3Q6IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IG1ha2VDb3B5TWFwKGVudHJpZXMxMShrZXlQYXR0LCB2YWx1ZVBhdHQpKSxcbiAgICBnZXRTaXplOiAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBrZXlQYXR0ID09PSB2b2lkIDAgJiYgdmFsdWVQYXR0ID09PSB2b2lkIDAgPyBqc21hcC5zaXplIDogWy4uLmtleXM1KGtleVBhdHQsIHZhbHVlUGF0dCldLmxlbmd0aCxcbiAgICBjbGVhcjogKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4ge1xuICAgICAgaWYgKGtleVBhdHQgPT09IHZvaWQgMCAmJiB2YWx1ZVBhdHQgPT09IHZvaWQgMCkge1xuICAgICAgICBqc21hcC5jbGVhcigpO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5czUoa2V5UGF0dCwgdmFsdWVQYXR0KSkge1xuICAgICAgICBqc21hcC5kZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBtYWtlU2NhbGFyTWFwU3RvcmU2ID0gKHRhZyA9IFwia2V5XCIsIHsga2V5U2hhcGUgPSB2b2lkIDAsIHZhbHVlU2hhcGUgPSB2b2lkIDAgfSA9IHt9KSA9PiB7XG4gIGNvbnN0IGpzbWFwID0gLyogICAgICAgICAgICovIG5ldyBNYXAoKTtcbiAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKGtleVNoYXBlKTtcbiAgfVxuICBpZiAodmFsdWVTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybih2YWx1ZVNoYXBlKTtcbiAgfVxuICBjb25zdCBhc3NlcnRLVk9rVG9TZXQgPSAoX2tleSwgdmFsdWUpID0+IHtcbiAgICBoYXJkZW4odmFsdWUpO1xuICAgIGFzc2VydFBhc3NhYmxlKHZhbHVlKTtcbiAgICBpZiAodmFsdWVTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2godmFsdWUsIHZhbHVlU2hhcGUsIFwibWFwU3RvcmUgdmFsdWVcIik7XG4gICAgfVxuICB9O1xuICBjb25zdCBhc3NlcnRLVk9rVG9BZGQgPSAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgIGhhcmRlbihrZXkpO1xuICAgIGFzc2VydFNjYWxhcktleShrZXkpO1xuICAgIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2goa2V5LCBrZXlTaGFwZSwgXCJtYXBTdG9yZSBrZXlcIik7XG4gICAgfVxuICAgIGFzc2VydEtWT2tUb1NldChrZXksIHZhbHVlKTtcbiAgfTtcbiAgcmV0dXJuIEZhcihgc2NhbGFyIE1hcFN0b3JlIG9mICR7cXVvdGUodGFnKX1gLCB7XG4gICAgLi4ubWFrZU1hcFN0b3JlTWV0aG9kczYoXG4gICAgICBqc21hcCxcbiAgICAgIGFzc2VydEtWT2tUb0FkZCxcbiAgICAgIGFzc2VydEtWT2tUb1NldCxcbiAgICAgIHZvaWQgMCxcbiAgICAgIHRhZ1xuICAgIClcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJNYXBTdG9yZTYpO1xuXG4vL1xudmFyIG1ha2VMZWdhY3lNYXA2ID0gKHRhZyA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgbTIgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICBjb25zdCBhc3NlcnRLZXlEb2VzTm90RXhpc3QgPSAoa2V5KSA9PiAhbTIuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKHRhZyl9IGFscmVhZHkgcmVnaXN0ZXJlZDogJHtrZXl9YDtcbiAgY29uc3QgYXNzZXJ0S2V5RXhpc3RzID0gKGtleSkgPT4gbTIuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKHRhZyl9IG5vdCBmb3VuZDogJHtrZXl9YDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgaGFzOiAoa2V5KSA9PiB7XG4gICAgICByZXR1cm4gbTIuaGFzKGtleSk7XG4gICAgfSxcbiAgICBpbml0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RG9lc05vdEV4aXN0KGtleSk7XG4gICAgICBtMi5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBnZXQ6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgcmV0dXJuIG0yLmdldChrZXkpO1xuICAgIH0sXG4gICAgc2V0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBtMi5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBkZWxldGU6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgbTIuZGVsZXRlKGtleSk7XG4gICAgfSxcbiAgICBrZXlzOiAoKSA9PiBtMi5rZXlzKCksXG4gICAgdmFsdWVzOiAoKSA9PiBtMi52YWx1ZXMoKSxcbiAgICBlbnRyaWVzOiAoKSA9PiBtMi5lbnRyaWVzKCksXG4gICAgZ2V0U2l6ZTogKCkgPT4gbTIuc2l6ZSxcbiAgICBjbGVhcjogKCkgPT4gbTIuY2xlYXIoKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUxlZ2FjeU1hcDYpO1xuXG4vL1xudmFyIG1ha2VMZWdhY3lXZWFrTWFwNiA9ICh0YWcgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IHdtID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IGFzc2VydEtleURvZXNOb3RFeGlzdCA9IChrZXkpID0+ICF3bS5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gYWxyZWFkeSByZWdpc3RlcmVkOiAke2tleX1gO1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiB3bS5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiB3bS5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGluaXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlEb2VzTm90RXhpc3Qoa2V5KTtcbiAgICAgIHdtLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKiAgICAgICAgICAgICovXG4gICAgICAgIHdtLmdldChrZXkpXG4gICAgICApO1xuICAgIH0sXG4gICAgc2V0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICB3bS5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBkZWxldGU6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgd20uZGVsZXRlKGtleSk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUxlZ2FjeVdlYWtNYXA2KTtcblxuLy9cbnZhciBtdXN0TWF0Y2g0ID0gbXVzdE1hdGNoO1xuXG4vL1xudmFyIFRpbWVyQnJhbmRTaGFwZSA9IE0ucmVtb3RhYmxlKFwiVGltZXJCcmFuZFwiKTtcbnZhciBUaW1lc3RhbXBWYWx1ZVNoYXBlID0gTS5uYXQoKTtcbnZhciBSZWxhdGl2ZVRpbWVWYWx1ZVNoYXBlID0gTS5uYXQoKTtcbnZhciBUaW1lc3RhbXBSZWNvcmRTaGFwZSA9IHtcbiAgdGltZXJCcmFuZDogVGltZXJCcmFuZFNoYXBlLFxuICBhYnNWYWx1ZTogVGltZXN0YW1wVmFsdWVTaGFwZVxufTtcbmhhcmRlbihUaW1lc3RhbXBSZWNvcmRTaGFwZSk7XG52YXIgUmVsYXRpdmVUaW1lUmVjb3JkU2hhcGUgPSB7XG4gIHRpbWVyQnJhbmQ6IFRpbWVyQnJhbmRTaGFwZSxcbiAgcmVsVmFsdWU6IFJlbGF0aXZlVGltZVZhbHVlU2hhcGVcbn07XG5oYXJkZW4oUmVsYXRpdmVUaW1lUmVjb3JkU2hhcGUpO1xudmFyIFRpbWVzdGFtcFNoYXBlID0gTS5vcihUaW1lc3RhbXBSZWNvcmRTaGFwZSwgVGltZXN0YW1wVmFsdWVTaGFwZSk7XG52YXIgUmVsYXRpdmVUaW1lU2hhcGUgPSBNLm9yKFxuICBSZWxhdGl2ZVRpbWVSZWNvcmRTaGFwZSxcbiAgUmVsYXRpdmVUaW1lVmFsdWVTaGFwZVxuKTtcbnZhciBUaW1lclNlcnZpY2VTaGFwZSA9IE0ucmVtb3RhYmxlKFwiVGltZXJTZXJ2aWNlXCIpO1xuXG4vL1xudmFyIGFncmVlZFRpbWVyQnJhbmQgPSAobGVmdEJyYW5kLCByaWdodEJyYW5kKSA9PiB7XG4gIGlmIChsZWZ0QnJhbmQgPT09IHZvaWQgMCkge1xuICAgIGlmIChyaWdodEJyYW5kID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiByaWdodEJyYW5kO1xuICAgIH1cbiAgfSBlbHNlIGlmIChyaWdodEJyYW5kID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gbGVmdEJyYW5kO1xuICB9IGVsc2Uge1xuICAgIGxlZnRCcmFuZCA9PT0gcmlnaHRCcmFuZCB8fCB0aHJvd1JlZGFjdGVkYFRpbWVyQnJhbmRzIG11c3QgbWF0Y2g6ICR7cXVvdGUobGVmdEJyYW5kKX0gdnMgJHtxdW90ZShyaWdodEJyYW5kKX1gO1xuICAgIHJldHVybiBsZWZ0QnJhbmQ7XG4gIH1cbn07XG52YXIgc2hhcmVkVGltZXJCcmFuZCA9IChsZWZ0LCByaWdodCkgPT4ge1xuICBjb25zdCBsZWZ0QnJhbmQgPSB0eXBlb2YgbGVmdCA9PT0gXCJiaWdpbnRcIiA/IHZvaWQgMCA6IGxlZnQudGltZXJCcmFuZDtcbiAgY29uc3QgcmlnaHRCcmFuZCA9IHR5cGVvZiByaWdodCA9PT0gXCJiaWdpbnRcIiA/IHZvaWQgMCA6IHJpZ2h0LnRpbWVyQnJhbmQ7XG4gIHJldHVybiBhZ3JlZWRUaW1lckJyYW5kKGxlZnRCcmFuZCwgcmlnaHRCcmFuZCk7XG59O1xudmFyIGFic0xpa2UgPSAobGVmdCwgcmlnaHQsIGFic1ZhbHVlMikgPT4ge1xuICBOYXQoYWJzVmFsdWUyKTtcbiAgY29uc3QgdGltZXJCcmFuZCA9IHNoYXJlZFRpbWVyQnJhbmQobGVmdCwgcmlnaHQpO1xuICBpZiAodGltZXJCcmFuZCkge1xuICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgdGltZXJCcmFuZCxcbiAgICAgIGFic1ZhbHVlOiBhYnNWYWx1ZTJcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYWJzVmFsdWUyO1xuICB9XG59O1xudmFyIHJlbExpa2UgPSAobGVmdCwgcmlnaHQsIHJlbFZhbHVlMikgPT4ge1xuICBOYXQocmVsVmFsdWUyKTtcbiAgY29uc3QgdGltZXJCcmFuZCA9IHNoYXJlZFRpbWVyQnJhbmQobGVmdCwgcmlnaHQpO1xuICBpZiAodGltZXJCcmFuZCkge1xuICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgdGltZXJCcmFuZCxcbiAgICAgIHJlbFZhbHVlOiByZWxWYWx1ZTJcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcmVsVmFsdWUyO1xuICB9XG59O1xudmFyIGFic1ZhbHVlID0gKGFicykgPT4ge1xuICBpZiAodHlwZW9mIGFicyA9PT0gXCJiaWdpbnRcIikge1xuICAgIHJldHVybiBOYXQoYWJzKTtcbiAgfVxuICBtdXN0TWF0Y2g0KGFicywgVGltZXN0YW1wUmVjb3JkU2hhcGUsIFwidGltZXN0YW1wXCIpO1xuICByZXR1cm4gTmF0KGFicy5hYnNWYWx1ZSk7XG59O1xudmFyIHJlbFZhbHVlID0gKHJlbCkgPT4ge1xuICBpZiAodHlwZW9mIHJlbCA9PT0gXCJiaWdpbnRcIikge1xuICAgIHJldHVybiBOYXQocmVsKTtcbiAgfVxuICBtdXN0TWF0Y2g0KHJlbCwgUmVsYXRpdmVUaW1lUmVjb3JkU2hhcGUsIFwicmVsYXRpdmVcIik7XG4gIHJldHVybiBOYXQocmVsLnJlbFZhbHVlKTtcbn07XG52YXIgbWFrZVRpbWVzdGFtcFJlY29yZCA9IChhYnMsIHRpbWVyQnJhbmQpID0+IGhhcmRlbih7IGFic1ZhbHVlOiBhYnMsIHRpbWVyQnJhbmQgfSk7XG52YXIgbWFrZVJlbGF0aXZlVGltZVJlY29yZCA9IChyZWwsIHRpbWVyQnJhbmQpID0+IGhhcmRlbih7IHJlbFZhbHVlOiByZWwsIHRpbWVyQnJhbmQgfSk7XG52YXIgY29lcmNlVGltZXN0YW1wUmVjb3JkID0gKHRzLCBicmFuZCkgPT4ge1xuICBicmFuZCB8fCB0aHJvd1JlZGFjdGVkYG11c3QgaGF2ZSBhIGJyYW5kYDtcbiAgaWYgKHR5cGVvZiB0cyA9PT0gXCJudW1iZXJcIikge1xuICAgIHRzID0gTmF0KHRzKTtcbiAgfVxuICBpZiAodHlwZW9mIHRzID09PSBcImJpZ2ludFwiKSB7XG4gICAgcmV0dXJuIG1ha2VUaW1lc3RhbXBSZWNvcmQodHMsIGJyYW5kKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCB7IHRpbWVyQnJhbmQgfSA9IHRzO1xuICAgIG11c3RNYXRjaDQodHMsIFRpbWVzdGFtcFJlY29yZFNoYXBlLCBcInRpbWVzdGFtcFwiKTtcbiAgICBhZ3JlZWRUaW1lckJyYW5kKHRpbWVyQnJhbmQsIGJyYW5kKTtcbiAgICByZXR1cm4gdHM7XG4gIH1cbn07XG52YXIgY29lcmNlUmVsYXRpdmVUaW1lUmVjb3JkID0gKHJ0LCBicmFuZCkgPT4ge1xuICBicmFuZCB8fCB0aHJvd1JlZGFjdGVkYG11c3QgaGF2ZSBhIGJyYW5kYDtcbiAgaWYgKHR5cGVvZiBydCA9PT0gXCJudW1iZXJcIikge1xuICAgIHJ0ID0gTmF0KHJ0KTtcbiAgfVxuICBpZiAodHlwZW9mIHJ0ID09PSBcImJpZ2ludFwiKSB7XG4gICAgcmV0dXJuIG1ha2VSZWxhdGl2ZVRpbWVSZWNvcmQocnQsIGJyYW5kKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCB7IHRpbWVyQnJhbmQgfSA9IHJ0O1xuICAgIG11c3RNYXRjaDQocnQsIFJlbGF0aXZlVGltZVJlY29yZFNoYXBlLCBcInJlbGF0aXZlVGltZVwiKTtcbiAgICBhZ3JlZWRUaW1lckJyYW5kKHRpbWVyQnJhbmQsIGJyYW5kKTtcbiAgICByZXR1cm4gcnQ7XG4gIH1cbn07XG52YXIgYWRkQWJzUmVsID0gKGFicywgcmVsKSA9PiBhYnNMaWtlKGFicywgcmVsLCBhYnNWYWx1ZShhYnMpICsgcmVsVmFsdWUocmVsKSk7XG52YXIgYWRkUmVsUmVsID0gKHJlbDEsIHJlbDIpID0+IHJlbExpa2UocmVsMSwgcmVsMiwgcmVsVmFsdWUocmVsMSkgKyByZWxWYWx1ZShyZWwyKSk7XG52YXIgc3VidHJhY3RBYnNBYnMgPSAoYWJzMSwgYWJzMikgPT4gcmVsTGlrZShhYnMxLCBhYnMyLCBhYnNWYWx1ZShhYnMxKSAtIGFic1ZhbHVlKGFiczIpKTtcbnZhciBjbGFtcGVkU3VidHJhY3RBYnNBYnMgPSAoYWJzMSwgYWJzMikgPT4ge1xuICBjb25zdCB2YWwxID0gYWJzVmFsdWUoYWJzMSk7XG4gIGNvbnN0IHZhbDIgPSBhYnNWYWx1ZShhYnMyKTtcbiAgcmV0dXJuIHJlbExpa2UoYWJzMSwgYWJzMiwgdmFsMSA+IHZhbDIgPyB2YWwxIC0gdmFsMiA6IDBuKTtcbn07XG52YXIgc3VidHJhY3RBYnNSZWwgPSAoYWJzLCByZWwpID0+IGFic0xpa2UoYWJzLCByZWwsIGFic1ZhbHVlKGFicykgLSByZWxWYWx1ZShyZWwpKTtcbnZhciBzdWJ0cmFjdFJlbFJlbCA9IChyZWwxLCByZWwyKSA9PiByZWxMaWtlKHJlbDEsIHJlbDIsIHJlbFZhbHVlKHJlbDEpIC0gcmVsVmFsdWUocmVsMikpO1xudmFyIGlzUmVsWmVybyA9IChyZWwpID0+IHJlbFZhbHVlKHJlbCkgPT09IDBuO1xudmFyIG11bHRpcGx5UmVsTmF0ID0gKHJlbCwgbmF0KSA9PiByZWxMaWtlKHJlbCwgbmF0LCByZWxWYWx1ZShyZWwpICogbmF0KTtcbnZhciBkaXZpZGVSZWxOYXQgPSAocmVsLCBuYXQpID0+IHJlbExpa2UocmVsLCBuYXQsIHJlbFZhbHVlKHJlbCkgLyBuYXQpO1xudmFyIGRpdmlkZVJlbFJlbCA9IChyZWwxLCByZWwyKSA9PiB7XG4gIHNoYXJlZFRpbWVyQnJhbmQocmVsMSwgcmVsMik7XG4gIHJldHVybiByZWxWYWx1ZShyZWwxKSAvIHJlbFZhbHVlKHJlbDIpO1xufTtcbnZhciBtb2RBYnNSZWwgPSAoYWJzLCBzdGVwKSA9PiByZWxMaWtlKGFicywgc3RlcCwgYWJzVmFsdWUoYWJzKSAlIHJlbFZhbHVlKHN0ZXApKTtcbnZhciBtb2RSZWxSZWwgPSAocmVsLCBzdGVwKSA9PiByZWxMaWtlKHJlbCwgc3RlcCwgcmVsVmFsdWUocmVsKSAlIHJlbFZhbHVlKHN0ZXApKTtcbnZhciBjb21wYXJlVmFsdWVzID0gKGxlZnQsIHJpZ2h0LCB2MSwgdjIpID0+IHtcbiAgc2hhcmVkVGltZXJCcmFuZChsZWZ0LCByaWdodCk7XG4gIGlmICh2MSA8IHYyKSB7XG4gICAgcmV0dXJuIC0xO1xuICB9IGVsc2UgaWYgKHYxID09PSB2Mikge1xuICAgIHJldHVybiAwO1xuICB9IGVsc2Uge1xuICAgIGFzc2VydCh2MSA+IHYyKTtcbiAgICByZXR1cm4gMTtcbiAgfVxufTtcbnZhciBUaW1lTWF0aCA9IGhhcmRlbih7XG4gIGFic1ZhbHVlLFxuICByZWxWYWx1ZSxcbiAgY29lcmNlVGltZXN0YW1wUmVjb3JkLFxuICBjb2VyY2VSZWxhdGl2ZVRpbWVSZWNvcmQsXG4gIC8vXG4gIGFkZEFic1JlbCxcbiAgLy9cbiAgYWRkUmVsUmVsLFxuICBzdWJ0cmFjdEFic0FicyxcbiAgY2xhbXBlZFN1YnRyYWN0QWJzQWJzLFxuICBzdWJ0cmFjdEFic1JlbCxcbiAgc3VidHJhY3RSZWxSZWwsXG4gIGlzUmVsWmVybyxcbiAgbXVsdGlwbHlSZWxOYXQsXG4gIGRpdmlkZVJlbE5hdCxcbiAgZGl2aWRlUmVsUmVsLFxuICBtb2RBYnNSZWwsXG4gIG1vZFJlbFJlbCxcbiAgY29tcGFyZUFiczogKGFiczEsIGFiczIpID0+IGNvbXBhcmVWYWx1ZXMoYWJzMSwgYWJzMiwgYWJzVmFsdWUoYWJzMSksIGFic1ZhbHVlKGFiczIpKSxcbiAgY29tcGFyZVJlbDogKHJlbDEsIHJlbDIpID0+IGNvbXBhcmVWYWx1ZXMocmVsMSwgcmVsMiwgcmVsVmFsdWUocmVsMSksIHJlbFZhbHVlKHJlbDIpKVxufSk7XG5cbi8vXG52YXIgU0VDT05EU19QRVJfTUlOVVRFID0gNjBuO1xudmFyIE5BTk9TRUNPTkRTX1BFUl9TRUNPTkQgPSAxMDAwMDAwMDAwbjtcbmZ1bmN0aW9uIG1ha2VUaW1lc3RhbXBIZWxwZXIodGltZXIpIHtcbiAgY29uc3Qgc2VsZiA9IGhhcmRlbih7XG4gICAgLypcblxuXG5cblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICBhc3luYyBnZXRUaW1lb3V0VGltZXN0YW1wTlMoc2Vjb25kc0luRnV0dXJlID0gU0VDT05EU19QRVJfTUlOVVRFICogNW4pIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRUaW1lID0gYXdhaXQgRSh0aW1lcikuZ2V0Q3VycmVudFRpbWVzdGFtcCgpO1xuICAgICAgY29uc3QgdGltZW91dCA9IFRpbWVNYXRoLmNvZXJjZVJlbGF0aXZlVGltZVJlY29yZChcbiAgICAgICAgc2Vjb25kc0luRnV0dXJlLFxuICAgICAgICBjdXJyZW50VGltZS50aW1lckJyYW5kXG4gICAgICApO1xuICAgICAgcmV0dXJuIFRpbWVNYXRoLmFkZEFic1JlbChjdXJyZW50VGltZSwgdGltZW91dCkuYWJzVmFsdWUgKiBOQU5PU0VDT05EU19QRVJfU0VDT05EO1xuICAgIH0sXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICB2b3dPclZhbHVlRnJvbU9wdHMob3B0cykge1xuICAgICAgaWYgKG9wdHMgJiYgXCJ0aW1lb3V0VGltZXN0YW1wXCIgaW4gb3B0cykgcmV0dXJuIG9wdHMudGltZW91dFRpbWVzdGFtcDtcbiAgICAgIGlmIChvcHRzICYmIFwidGltZW91dEhlaWdodFwiIGluIG9wdHMpIHJldHVybiAwbjtcbiAgICAgIHJldHVybiBzZWxmLmdldFRpbWVvdXRUaW1lc3RhbXBOUyhcbiAgICAgICAgb3B0cyAmJiBcInRpbWVvdXRSZWxhdGl2ZVNlY29uZHNcIiBpbiBvcHRzID8gb3B0cy50aW1lb3V0UmVsYXRpdmVTZWNvbmRzIDogdm9pZCAwXG4gICAgICApO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBzZWxmO1xufVxuXG4vL1xudmFyIE1zZ0RlcG9zaXRGb3JCdXJuMiA9IENvZGVjSGVscGVyKE1zZ0RlcG9zaXRGb3JCdXJuKTtcbnZhciBNc2dEZXBvc2l0Rm9yQnVybldpdGhDYWxsZXIyID0gQ29kZWNIZWxwZXIoXG4gIE1zZ0RlcG9zaXRGb3JCdXJuV2l0aENhbGxlclxuKTtcbnZhciBRdWVyeUFsbEJhbGFuY2VzUmVxdWVzdDIgPSBDb2RlY0hlbHBlcihRdWVyeUFsbEJhbGFuY2VzUmVxdWVzdCk7XG52YXIgUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlMiA9IENvZGVjSGVscGVyKFF1ZXJ5QWxsQmFsYW5jZXNSZXNwb25zZSk7XG52YXIgUXVlcnlCYWxhbmNlUmVxdWVzdDIgPSBDb2RlY0hlbHBlcihRdWVyeUJhbGFuY2VSZXF1ZXN0KTtcbnZhciBRdWVyeUJhbGFuY2VSZXNwb25zZTIgPSBDb2RlY0hlbHBlcihRdWVyeUJhbGFuY2VSZXNwb25zZSk7XG52YXIgTXNnU2VuZDIgPSBDb2RlY0hlbHBlcihNc2dTZW5kKTtcbnZhciBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVxdWVzdDIgPSBDb2RlY0hlbHBlcihcbiAgUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1JlcXVlc3Rcbik7XG52YXIgUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1Jlc3BvbnNlMiA9IENvZGVjSGVscGVyKFxuICBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2Vcbik7XG52YXIgUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVxdWVzdDIgPSBDb2RlY0hlbHBlcihcbiAgUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVxdWVzdFxuKTtcbnZhciBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXNwb25zZTIgPSBDb2RlY0hlbHBlcihcbiAgUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVzcG9uc2Vcbik7XG52YXIgTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmQyID0gQ29kZWNIZWxwZXIoTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmQpO1xudmFyIE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkUmVzcG9uc2UyID0gQ29kZWNIZWxwZXIoXG4gIE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkUmVzcG9uc2Vcbik7XG52YXIgUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdDIgPSBDb2RlY0hlbHBlcihRdWVyeURlbGVnYXRpb25SZXF1ZXN0KTtcbnZhciBRdWVyeURlbGVnYXRpb25SZXNwb25zZTIgPSBDb2RlY0hlbHBlcihRdWVyeURlbGVnYXRpb25SZXNwb25zZSk7XG52YXIgUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1JlcXVlc3QyID0gQ29kZWNIZWxwZXIoXG4gIFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXF1ZXN0XG4pO1xudmFyIFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXNwb25zZTIgPSBDb2RlY0hlbHBlcihcbiAgUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1Jlc3BvbnNlXG4pO1xudmFyIFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXF1ZXN0MiA9IENvZGVjSGVscGVyKFxuICBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdFxuKTtcbnZhciBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVzcG9uc2UyID0gQ29kZWNIZWxwZXIoXG4gIFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXNwb25zZVxuKTtcbnZhciBRdWVyeVJlZGVsZWdhdGlvbnNSZXF1ZXN0MiA9IENvZGVjSGVscGVyKFF1ZXJ5UmVkZWxlZ2F0aW9uc1JlcXVlc3QpO1xudmFyIFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlMiA9IENvZGVjSGVscGVyKFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlKTtcbnZhciBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0MiA9IENvZGVjSGVscGVyKFxuICBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0XG4pO1xudmFyIFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlc3BvbnNlMiA9IENvZGVjSGVscGVyKFxuICBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXNwb25zZVxuKTtcbnZhciBNc2dCZWdpblJlZGVsZWdhdGUyID0gQ29kZWNIZWxwZXIoTXNnQmVnaW5SZWRlbGVnYXRlKTtcbnZhciBNc2dEZWxlZ2F0ZTIgPSBDb2RlY0hlbHBlcihNc2dEZWxlZ2F0ZSk7XG52YXIgTXNnVW5kZWxlZ2F0ZTIgPSBDb2RlY0hlbHBlcihNc2dVbmRlbGVnYXRlKTtcbnZhciBNc2dVbmRlbGVnYXRlUmVzcG9uc2UyID0gQ29kZWNIZWxwZXIoTXNnVW5kZWxlZ2F0ZVJlc3BvbnNlKTtcbnZhciBBbnkyID0gQ29kZWNIZWxwZXIoQW55KTtcbnZhciBNc2dUcmFuc2ZlcjIgPSBDb2RlY0hlbHBlcihNc2dUcmFuc2Zlcik7XG52YXIgdHJhY2UgPSBtYWtlVHJhY2VyMihcIkNvc21vc09yY2hBY2NvdW50XCIpO1xudmFyIHsgVm93JDogVm93JDIgfSA9IFNoYXBlO1xudmFyIGRlY29kZUljcVJlc3VsdCA9IChjb2RlYywgcmVzdWx0KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgYnl0ZXMgPSBkZWNvZGVCYXNlNjQocmVzdWx0LmtleSB8fCByZXN1bHQudmFsdWUpO1xuICAgIHJldHVybiBjb2RlYy5kZWNvZGUoYnl0ZXMpO1xuICB9IGNhdGNoIChjYXVzZSkge1xuICAgIHRocm93IG1ha2VFcnJvcihcbiAgICAgIGBGYWlsZWQgdG8gcGFyc2UgJHtjb2RlYy50eXBlVXJsfSBmcm9tIHJlc3VsdCAke3F1b3RlKHJlc3VsdCl9YCxcbiAgICAgIHZvaWQgMCxcbiAgICAgIHsgY2F1c2UgfVxuICAgICk7XG4gIH1cbn07XG52YXIgc3Rha2luZ0FjY291bnRBY3Rpb25zTWV0aG9kcyA9IHtcbiAgZGVsZWdhdGU6IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSwgQW1vdW50QXJnU2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICByZWRlbGVnYXRlOiBNLmNhbGwoXG4gICAgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUsXG4gICAgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUsXG4gICAgQW1vdW50QXJnU2hhcGVcbiAgKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgdW5kZWxlZ2F0ZTogTS5jYWxsKE0uYXJyYXlPZihEZWxlZ2F0aW9uU2hhcGUpKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgd2l0aGRyYXdSZXdhcmQ6IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSkucmV0dXJucyhcbiAgICBWb3ckMihNLmFycmF5T2YoRGVub21BbW91bnRTaGFwZSkpXG4gICksXG4gIHdpdGhkcmF3UmV3YXJkczogTS5jYWxsKCkucmV0dXJucyhWb3ckMihNLmFycmF5T2YoRGVub21BbW91bnRTaGFwZSkpKVxufTtcbnZhciBzdGFraW5nQWNjb3VudFF1ZXJpZXNNZXRob2RzID0ge1xuICBnZXREZWxlZ2F0aW9uOiBNLmNhbGwoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICBnZXREZWxlZ2F0aW9uczogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldFVuYm9uZGluZ0RlbGVnYXRpb246IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldFVuYm9uZGluZ0RlbGVnYXRpb25zOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZ2V0UmVkZWxlZ2F0aW9uczogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldFJld2FyZDogTS5jYWxsKENvc21vc0NoYWluQWRkcmVzc1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZ2V0UmV3YXJkczogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSlcbn07XG52YXIgbm9ibGVNZXRob2RzID0ge1xuICBkZXBvc2l0Rm9yQnVybjogTS5jYWxsKE0uc3RyaW5nKCksIEFtb3VudEFyZ1NoYXBlKS5vcHRpb25hbChNLnN0cmluZygpKS5yZXR1cm5zKFZvd1NoYXBlKVxufTtcbnZhciBJY2FBY2NvdW50SG9sZGVySSA9IE0uaW50ZXJmYWNlKFwiSWNhQWNjb3VudEhvbGRlclwiLCB7XG4gIC4uLm5vYmxlTWV0aG9kcyxcbiAgLi4ub3JjaGVzdHJhdGlvbkFjY291bnRNZXRob2RzLFxuICAuLi5zdGFraW5nQWNjb3VudEFjdGlvbnNNZXRob2RzLFxuICAuLi5zdGFraW5nQWNjb3VudFF1ZXJpZXNNZXRob2RzLFxuICBkZWFjdGl2YXRlOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgcmVhY3RpdmF0ZTogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIGV4ZWN1dGVFbmNvZGVkVHg6IE0uY2FsbChNLmFycmF5T2YoUHJvdG8zU2hhcGUpKS5vcHRpb25hbChFeGVjdXRlSUNBVHhPcHRzU2hhcGUpLnJldHVybnMoVm93U2hhcGUpXG59KTtcbnZhciBQVUJMSUNfVE9QSUNTID0ge1xuICBhY2NvdW50OiBbXCJTdGFraW5nIEFjY291bnQgaG9sZGVyIHN0YXR1c1wiLCBNLmFueSgpXVxufTtcbnZhciBDb3Ntb3NPcmNoZXN0cmF0aW9uSW52aXRhdGlvbk1ha2Vyc0kgPSBNLmludGVyZmFjZShcbiAgXCJpbnZpdGF0aW9uTWFrZXJzXCIsXG4gIHtcbiAgICBEZWxlZ2F0ZTogTS5jYWxsKENvc21vc0NoYWluQWRkcmVzc1NoYXBlLCBBbW91bnRBcmdTaGFwZSkucmV0dXJucyhcbiAgICAgIE0ucHJvbWlzZSgpXG4gICAgKSxcbiAgICBSZWRlbGVnYXRlOiBNLmNhbGwoXG4gICAgICBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSxcbiAgICAgIENvc21vc0NoYWluQWRkcmVzc1NoYXBlLFxuICAgICAgQW1vdW50QXJnU2hhcGVcbiAgICApLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFdpdGhkcmF3UmV3YXJkOiBNLmNhbGwoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFVuZGVsZWdhdGU6IE0uY2FsbChNLmFycmF5T2YoRGVsZWdhdGlvblNoYXBlKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgRGVhY3RpdmF0ZUFjY291bnQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFJlYWN0aXZhdGVBY2NvdW50OiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICBUcmFuc2ZlckFjY291bnQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFNlbmQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFNlbmRBbGw6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFRyYW5zZmVyOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICB9XG4pO1xuaGFyZGVuKENvc21vc09yY2hlc3RyYXRpb25JbnZpdGF0aW9uTWFrZXJzSSk7XG52YXIgcHJlcGFyZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50S2l0ID0gKHpvbmUsIHtcbiAgY2hhaW5IdWIsXG4gIG1ha2VSZWNvcmRlcktpdCxcbiAgdGltZXJTZXJ2aWNlLFxuICB2b3dUb29sczogeyB3YXRjaCwgYXNWb3csIHdoZW4sIGFsbFZvd3MgfSxcbiAgemNmXG59KSA9PiB7XG4gIGNvbnN0IHRpbWVzdGFtcEhlbHBlciA9IG1ha2VUaW1lc3RhbXBIZWxwZXIodGltZXJTZXJ2aWNlKTtcbiAgY29uc3QgbWFrZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50S2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIkNvc21vcyBPcmNoZXN0cmF0aW9uIEFjY291bnQgSG9sZGVyXCIsXG4gICAge1xuICAgICAgaGVscGVyOiBNLmludGVyZmFjZShcImhlbHBlclwiLCB7XG4gICAgICAgIG93bmVkOiBNLmNhbGwoKS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpLFxuICAgICAgICBnZXRVcGRhdGVyOiBNLmNhbGwoKS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpLFxuICAgICAgICBhbW91bnRUb0NvaW46IE0uY2FsbChBbW91bnRBcmdTaGFwZSkucmV0dXJucyhNLnJlY29yZCgpKVxuICAgICAgfSksXG4gICAgICByZXR1cm5Wb2lkV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZXR1cm5Wb2lkV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpXG4gICAgICB9KSxcbiAgICAgIGJhbGFuY2VRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiYmFsYW5jZVF1ZXJ5V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoTS5vcihNLnJlY29yZCgpLCBNLnVuZGVmaW5lZCgpKSlcbiAgICAgIH0pLFxuICAgICAgYWxsQmFsYW5jZXNRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiYWxsQmFsYW5jZXNRdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoTS5yZWNvcmQoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICB1bmRlbGVnYXRlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJ1bmRlbGVnYXRlV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKFZvdyQyKE0ucHJvbWlzZSgpKSlcbiAgICAgIH0pLFxuICAgICAgd2l0aGRyYXdSZXdhcmRXYXRjaGVyOiBNLmludGVyZmFjZShcIndpdGhkcmF3UmV3YXJkV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKE0uYXJyYXlPZihEZW5vbUFtb3VudFNoYXBlKSlcbiAgICAgIH0pLFxuICAgICAgdHJhbnNmZXJXYXRjaGVyOiBNLmludGVyZmFjZShcInRyYW5zZmVyV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoW00ucmVjb3JkKCksIE0ubmF0KCldKS5vcHRpb25hbCh7XG4gICAgICAgICAgZGVzdGluYXRpb246IENvc21vc0NoYWluQWRkcmVzc1NoYXBlLFxuICAgICAgICAgIG9wdHM6IE0ub3IoTS51bmRlZmluZWQoKSwgSUJDVHJhbnNmZXJPcHRpb25zU2hhcGUpLFxuICAgICAgICAgIHRva2VuOiB7XG4gICAgICAgICAgICBkZW5vbTogTS5zdHJpbmcoKSxcbiAgICAgICAgICAgIGFtb3VudDogTS5zdHJpbmcoKVxuICAgICAgICAgIH1cbiAgICAgICAgfSkucmV0dXJucyhWb3ckMihNLnJlY29yZCgpKSlcbiAgICAgIH0pLFxuICAgICAgZGVsZWdhdGlvblF1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJkZWxlZ2F0aW9uUXVlcnlXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoTS5yZWNvcmQoKSlcbiAgICAgIH0pLFxuICAgICAgZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoTS5yZWNvcmQoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICB1bmJvbmRpbmdEZWxlZ2F0aW9uUXVlcnlXYXRjaGVyOiBNLmludGVyZmFjZShcbiAgICAgICAgXCJ1bmJvbmRpbmdEZWxlZ2F0aW9uUXVlcnlXYXRjaGVyXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhNLnJlY29yZCgpKVxuICAgICAgICB9XG4gICAgICApLFxuICAgICAgdW5ib25kaW5nRGVsZWdhdGlvbnNRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFxuICAgICAgICBcInVuYm9uZGluZ0RlbGVnYXRpb25zUXVlcnlXYXRjaGVyXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICAgIE0uYXJyYXlPZihNLnJlY29yZCgpKVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHJlZGVsZWdhdGlvblF1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZWRlbGVnYXRpb25RdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoTS5yZWNvcmQoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICByZWRlbGVnYXRpb25zUXVlcnlXYXRjaGVyOiBNLmludGVyZmFjZShcInJlZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoTS5yZWNvcmQoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICByZXdhcmRRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicmV3YXJkUXVlcnlXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoXG4gICAgICAgICAgTS5hcnJheU9mKE0ucmVjb3JkKCkpXG4gICAgICAgIClcbiAgICAgIH0pLFxuICAgICAgcmV3YXJkc1F1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZXdhcmRzUXVlcnlXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoTS5yZWNvcmQoKSlcbiAgICAgIH0pLFxuICAgICAgaG9sZGVyOiBJY2FBY2NvdW50SG9sZGVySSxcbiAgICAgIGludml0YXRpb25NYWtlcnM6IENvc21vc09yY2hlc3RyYXRpb25JbnZpdGF0aW9uTWFrZXJzSVxuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgICh7IGNoYWluQWRkcmVzcywgbG9jYWxBZGRyZXNzLCByZW1vdGVBZGRyZXNzIH0sIGlvKSA9PiB7XG4gICAgICB0cmFjZShcImNvc21vcyBvcmNoIGFjY3QgaW5pdFwiLCB7XG4gICAgICAgIGNoYWluQWRkcmVzcyxcbiAgICAgICAgbG9jYWxBZGRyZXNzLFxuICAgICAgICByZW1vdGVBZGRyZXNzXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHsgc3RvcmFnZU5vZGUgfSA9IGlvO1xuICAgICAgY29uc3QgdG9waWNLaXQgPSBzdG9yYWdlTm9kZSA/IG1ha2VSZWNvcmRlcktpdChzdG9yYWdlTm9kZSwgUFVCTElDX1RPUElDUy5hY2NvdW50WzFdKSA6IHZvaWQgMDtcbiAgICAgIGlmICh0b3BpY0tpdCkge1xuICAgICAgICB2b2lkIEUodG9waWNLaXQucmVjb3JkZXIpLndyaXRlKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAge1xuICAgICAgICAgICAgbG9jYWxBZGRyZXNzLFxuICAgICAgICAgICAgcmVtb3RlQWRkcmVzc1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgYWNjb3VudCwgaWNxQ29ubmVjdGlvbiwgdGltZXIgfSA9IGlvO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWNjb3VudCxcbiAgICAgICAgY2hhaW5BZGRyZXNzLFxuICAgICAgICBpY3FDb25uZWN0aW9uLFxuICAgICAgICBsb2NhbEFkZHJlc3MsXG4gICAgICAgIHJlbW90ZUFkZHJlc3MsXG4gICAgICAgIHRpbWVyLFxuICAgICAgICB0b3BpY0tpdFxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIGhlbHBlcjoge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBvd25lZCgpIHtcbiAgICAgICAgICBjb25zdCB7IGFjY291bnQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKCFhY2NvdW50KSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFVzaW5nIGFjY291bnQgaG9sZGVyIGFmdGVyIHRyYW5zZmVyYDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGFjY291bnQ7XG4gICAgICAgIH0sXG4gICAgICAgIGdldFVwZGF0ZXIoKSB7XG4gICAgICAgICAgaWYgKCF0aGlzLnN0YXRlLnRvcGljS2l0KSB0aHJvdyB0aHJvd1JlZGFjdGVkYG5vIHRvcGljS2l0YDtcbiAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS50b3BpY0tpdC5yZWNvcmRlcjtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBhbW91bnRUb0NvaW4oYW1vdW50KSB7XG4gICAgICAgICAgIShcImJyYW5kXCIgaW4gYW1vdW50KSB8fCB0aHJvd1JlZGFjdGVkYCdhbW91bnRUb0NvaW4nIG5vdCB3b3JraW5nIGZvciAke3F1b3RlKGFtb3VudC5icmFuZCl9IHVudGlsICMxMDQ0OTsgdXNlICdEZW5vbUFtb3VudCcgZm9yIG5vd2A7XG4gICAgICAgICAgcmV0dXJuIGNvZXJjZUNvaW4oY2hhaW5IdWIsIGFtb3VudCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBiYWxhbmNlUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgY29uc3QgeyBiYWxhbmNlIH0gPSBkZWNvZGVJY3FSZXN1bHQoUXVlcnlCYWxhbmNlUmVzcG9uc2UyLCByZXN1bHQpO1xuICAgICAgICAgIGlmICghYmFsYW5jZSkgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIGJhbGFuY2Uga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4odG9EZW5vbUFtb3VudChiYWxhbmNlKSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBkZWxlZ2F0aW9uUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBjb25zdCB7IGRlbGVnYXRpb25SZXNwb25zZSB9ID0gZGVjb2RlSWNxUmVzdWx0KFxuICAgICAgICAgICAgUXVlcnlEZWxlZ2F0aW9uUmVzcG9uc2UyLFxuICAgICAgICAgICAgcmVzdWx0XG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIWRlbGVnYXRpb25SZXNwb25zZSlcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCBkZWxlZ2F0aW9uUmVzcG9uc2Uga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oXG4gICAgICAgICAgICB0b0Nvc21vc0RlbGVnYXRpb25SZXNwb25zZShjaGFpbkFkZHJlc3MsIGRlbGVnYXRpb25SZXNwb25zZSlcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGNvbnN0IHsgZGVsZWdhdGlvblJlc3BvbnNlcyB9ID0gZGVjb2RlSWNxUmVzdWx0KFxuICAgICAgICAgICAgUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1Jlc3BvbnNlMixcbiAgICAgICAgICAgIHJlc3VsdFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFkZWxlZ2F0aW9uUmVzcG9uc2VzKVxuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIGRlbGVnYXRpb25SZXNwb25zZXMga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oXG4gICAgICAgICAgICBkZWxlZ2F0aW9uUmVzcG9uc2VzLm1hcChcbiAgICAgICAgICAgICAgKHI2KSA9PiB0b0Nvc21vc0RlbGVnYXRpb25SZXNwb25zZShjaGFpbkFkZHJlc3MsIHI2KVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB1bmJvbmRpbmdEZWxlZ2F0aW9uUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgY29uc3QgeyB1bmJvbmQgfSA9IGRlY29kZUljcVJlc3VsdChcbiAgICAgICAgICAgIFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlc3BvbnNlMixcbiAgICAgICAgICAgIHJlc3VsdFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCF1bmJvbmQpIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCB1bmJvbmQga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4odW5ib25kKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHVuYm9uZGluZ0RlbGVnYXRpb25zUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgY29uc3QgeyB1bmJvbmRpbmdSZXNwb25zZXMgfSA9IGRlY29kZUljcVJlc3VsdChcbiAgICAgICAgICAgIFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXNwb25zZTIsXG4gICAgICAgICAgICByZXN1bHRcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICghdW5ib25kaW5nUmVzcG9uc2VzKVxuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIHVuYm9uZGluZ1Jlc3BvbnNlcyBrZXk6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih1bmJvbmRpbmdSZXNwb25zZXMpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmVkZWxlZ2F0aW9uUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgY29uc3QgeyByZWRlbGVnYXRpb25SZXNwb25zZXMgfSA9IGRlY29kZUljcVJlc3VsdChcbiAgICAgICAgICAgIFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlMixcbiAgICAgICAgICAgIHJlc3VsdFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFyZWRlbGVnYXRpb25SZXNwb25zZXMpXG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgcmVkZWxlZ2F0aW9uUmVzcG9uc2VzIGtleTogJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHJlZGVsZWdhdGlvblJlc3BvbnNlcyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZWRlbGVnYXRpb25zUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgY29uc3QgeyByZWRlbGVnYXRpb25SZXNwb25zZXMgfSA9IGRlY29kZUljcVJlc3VsdChcbiAgICAgICAgICAgIFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlMixcbiAgICAgICAgICAgIHJlc3VsdFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFyZWRlbGVnYXRpb25SZXNwb25zZXMpXG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgcmVkZWxlZ2F0aW9uUmVzcG9uc2VzIGtleTogJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHJlZGVsZWdhdGlvblJlc3BvbnNlcyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXdhcmRRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBjb25zdCB7IHJld2FyZHMgfSA9IGRlY29kZUljcVJlc3VsdChcbiAgICAgICAgICAgIFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXNwb25zZTIsXG4gICAgICAgICAgICByZXN1bHRcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICghcmV3YXJkcykgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIHJld2FyZHMga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4ocmV3YXJkcy5tYXAodG9UcnVuY2F0ZWREZW5vbUFtb3VudCkpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmV3YXJkc1F1ZXJ5V2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgY29uc3QgeyByZXdhcmRzLCB0b3RhbCB9ID0gZGVjb2RlSWNxUmVzdWx0KFxuICAgICAgICAgICAgUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVzcG9uc2UyLFxuICAgICAgICAgICAgcmVzdWx0XG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXJld2FyZHMgfHwgIXRvdGFsKVxuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIHJld2FyZHMgb3IgdG90YWwga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgICAgcmV3YXJkczogcmV3YXJkcy5tYXAoKHJld2FyZCkgPT4gKHtcbiAgICAgICAgICAgICAgdmFsaWRhdG9yOiB0b0Nvc21vc1ZhbGlkYXRvckFkZHJlc3MocmV3YXJkLCBjaGFpbkFkZHJlc3MuY2hhaW5JZCksXG4gICAgICAgICAgICAgIHJld2FyZDogcmV3YXJkLnJld2FyZC5tYXAodG9UcnVuY2F0ZWREZW5vbUFtb3VudClcbiAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgIHRvdGFsOiB0b3RhbC5tYXAodG9UcnVuY2F0ZWREZW5vbUFtb3VudClcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGFsbEJhbGFuY2VzUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgY29uc3QgeyBiYWxhbmNlcyB9ID0gZGVjb2RlSWNxUmVzdWx0KFxuICAgICAgICAgICAgUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlMixcbiAgICAgICAgICAgIHJlc3VsdFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFiYWxhbmNlcykgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIGJhbGFuY2VzIGtleTogJHtxdW90ZShyZXN1bHQpfWA7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbihiYWxhbmNlcy5tYXAoKGNvaW4pID0+IHRvRGVub21BbW91bnQoY29pbikpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHVuZGVsZWdhdGVXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdCkge1xuICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gdHJ5RGVjb2RlUmVzcG9uc2UoXG4gICAgICAgICAgICByZXN1bHQsXG4gICAgICAgICAgICBNc2dVbmRlbGVnYXRlUmVzcG9uc2UyLmZyb21Qcm90b01zZ1xuICAgICAgICAgICk7XG4gICAgICAgICAgdHJhY2UoXCJ1bmRlbGVnYXRlIHJlc3BvbnNlXCIsIHJlc3BvbnNlKTtcbiAgICAgICAgICBjb25zdCB7IGNvbXBsZXRpb25UaW1lIH0gPSByZXNwb25zZTtcbiAgICAgICAgICBjb21wbGV0aW9uVGltZSB8fCB0aHJvd1JlZGFjdGVkYE5vIGNvbXBsZXRpb24gdGltZSByZXN1bHQgJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgRSh0aGlzLnN0YXRlLnRpbWVyKS53YWtlQXQoY29tcGxldGlvblRpbWUuc2Vjb25kcyArIG1heENsb2NrU2tldylcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIHJldHVyblZvaWRXYXRjaGVyOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0KSB7XG4gICAgICAgICAgdHJhY2UoXCJSZXN1bHRcIiwgcmVzdWx0KTtcbiAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2l0aGRyYXdSZXdhcmRXYXRjaGVyOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdCkge1xuICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gdHJ5RGVjb2RlUmVzcG9uc2UoXG4gICAgICAgICAgICByZXN1bHQsXG4gICAgICAgICAgICBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFJlc3BvbnNlMi5mcm9tUHJvdG9Nc2dcbiAgICAgICAgICApO1xuICAgICAgICAgIHRyYWNlKFwid2l0aGRyYXdSZXdhcmQgcmVzcG9uc2VcIiwgcmVzcG9uc2UpO1xuICAgICAgICAgIGNvbnN0IHsgYW1vdW50OiBjb2lucyB9ID0gcmVzcG9uc2U7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbihjb2lucy5tYXAodG9EZW5vbUFtb3VudCkpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdHJhbnNmZXJXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbeyB0cmFuc2ZlckNoYW5uZWwgfSwgdGltZW91dFRpbWVzdGFtcF0sIHsgb3B0cywgdG9rZW4sIGRlc3RpbmF0aW9uIH0pIHtcbiAgICAgICAgICBjb25zdCByZXN1bHRzID0gRSh0aGlzLmZhY2V0cy5oZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChbXG4gICAgICAgICAgICBBbnkyLnRvSlNPTihcbiAgICAgICAgICAgICAgTXNnVHJhbnNmZXIyLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgIHNvdXJjZVBvcnQ6IHRyYW5zZmVyQ2hhbm5lbC5wb3J0SWQsXG4gICAgICAgICAgICAgICAgc291cmNlQ2hhbm5lbDogdHJhbnNmZXJDaGFubmVsLmNoYW5uZWxJZCxcbiAgICAgICAgICAgICAgICB0b2tlbixcbiAgICAgICAgICAgICAgICBzZW5kZXI6IHRoaXMuc3RhdGUuY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgIHJlY2VpdmVyOiBkZXN0aW5hdGlvbi52YWx1ZSxcbiAgICAgICAgICAgICAgICB0aW1lb3V0SGVpZ2h0OiBvcHRzPy50aW1lb3V0SGVpZ2h0LFxuICAgICAgICAgICAgICAgIHRpbWVvdXRUaW1lc3RhbXAsXG4gICAgICAgICAgICAgICAgbWVtbzogb3B0cz8ubWVtb1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICAgIF0pO1xuICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlcik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBpbnZpdGF0aW9uTWFrZXJzOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgRGVsZWdhdGUodmFsaWRhdG9yLCBhbW91bnQpIHtcbiAgICAgICAgICB0cmFjZShcIkRlbGVnYXRlXCIsIHZhbGlkYXRvciwgYW1vdW50KTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKChzZWF0KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy5ob2xkZXIuZGVsZWdhdGUodmFsaWRhdG9yLCBhbW91bnQpKTtcbiAgICAgICAgICB9LCBcIkRlbGVnYXRlXCIpO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgUmVkZWxlZ2F0ZShzcmNWYWxpZGF0b3IsIGRzdFZhbGlkYXRvciwgYW1vdW50KSB7XG4gICAgICAgICAgdHJhY2UoXCJSZWRlbGVnYXRlXCIsIHNyY1ZhbGlkYXRvciwgZHN0VmFsaWRhdG9yLCBhbW91bnQpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5ob2xkZXIucmVkZWxlZ2F0ZShzcmNWYWxpZGF0b3IsIGRzdFZhbGlkYXRvciwgYW1vdW50KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCBcIlJlZGVsZWdhdGVcIik7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBXaXRoZHJhd1Jld2FyZCh2YWxpZGF0b3IpIHtcbiAgICAgICAgICB0cmFjZShcIldpdGhkcmF3UmV3YXJkXCIsIHZhbGlkYXRvcik7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbigoc2VhdCkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMuaG9sZGVyLndpdGhkcmF3UmV3YXJkKHZhbGlkYXRvcikpO1xuICAgICAgICAgIH0sIFwiV2l0aGRyYXdSZXdhcmRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIFVuZGVsZWdhdGUoZGVsZWdhdGlvbnMpIHtcbiAgICAgICAgICB0cmFjZShcIlVuZGVsZWdhdGVcIiwgZGVsZWdhdGlvbnMpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci51bmRlbGVnYXRlKGRlbGVnYXRpb25zKSk7XG4gICAgICAgICAgfSwgXCJVbmRlbGVnYXRlXCIpO1xuICAgICAgICB9LFxuICAgICAgICBEZWFjdGl2YXRlQWNjb3VudCgpIHtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKChzZWF0KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy5ob2xkZXIuZGVhY3RpdmF0ZSgpKTtcbiAgICAgICAgICB9LCBcIkRlYWN0aXZhdGVBY2NvdW50XCIpO1xuICAgICAgICB9LFxuICAgICAgICBSZWFjdGl2YXRlQWNjb3VudCgpIHtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKChzZWF0KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy5ob2xkZXIucmVhY3RpdmF0ZSgpKTtcbiAgICAgICAgICB9LCBcIlJlYWN0aXZhdGVBY2NvdW50XCIpO1xuICAgICAgICB9LFxuICAgICAgICBTZW5kKCkge1xuICAgICAgICAgIGNvbnN0IG9mZmVySGFuZGxlciA9IChzZWF0LCB7IHRvQWNjb3VudCwgYW1vdW50IH0pID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci5zZW5kKHRvQWNjb3VudCwgYW1vdW50KSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKG9mZmVySGFuZGxlciwgXCJTZW5kXCIpO1xuICAgICAgICB9LFxuICAgICAgICBTZW5kQWxsKCkge1xuICAgICAgICAgIGNvbnN0IG9mZmVySGFuZGxlciA9IChzZWF0LCB7IHRvQWNjb3VudCwgYW1vdW50cyB9KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy5ob2xkZXIuc2VuZEFsbCh0b0FjY291bnQsIGFtb3VudHMpKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24ob2ZmZXJIYW5kbGVyLCBcIlNlbmRBbGxcIik7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBUcmFuc2ZlckFjY291bnQoKSB7XG4gICAgICAgICAgdGhyb3cgRXJyb3IoXCJub3QgeWV0IGltcGxlbWVudGVkXCIpO1xuICAgICAgICB9LFxuICAgICAgICBUcmFuc2ZlcigpIHtcbiAgICAgICAgICBjb25zdCBvZmZlckhhbmRsZXIgPSAoc2VhdCwgeyBhbW91bnQsIGRlc3RpbmF0aW9uLCBvcHRzIH0pID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5ob2xkZXIudHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwgb3B0cylcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKG9mZmVySGFuZGxlciwgXCJUcmFuc2ZlclwiKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGhvbGRlcjoge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGFzQ29udGludWluZ09mZmVyKCkge1xuICAgICAgICAgIHJldHVybiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBudWxsO1xuICAgICAgICAgICAgY29uc3QgeyBob2xkZXIsIGludml0YXRpb25NYWtlcnM6IGltIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IGludml0YXRpb25NYWtlcnMgPSAoXG4gICAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICBpbVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICBwdWJsaWNTdWJzY3JpYmVyczogYXdhaXQgd2hlbihob2xkZXIuZ2V0UHVibGljVG9waWNzKCkpLFxuICAgICAgICAgICAgICBpbnZpdGF0aW9uTWFrZXJzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0UHVibGljVG9waWNzKCkge1xuICAgICAgICAgIHJldHVybiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBudWxsO1xuICAgICAgICAgICAgY29uc3QgeyB0b3BpY0tpdCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghdG9waWNLaXQpIHRocm93IHRocm93UmVkYWN0ZWRgTm8gdG9waWNLaXQ7IHN0b3JhZ2VOb2RlIG5vdCBwcm92aWRlZGA7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgICAgICAgYWNjb3VudDoge1xuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBQVUJMSUNfVE9QSUNTLmFjY291bnRbMF0sXG4gICAgICAgICAgICAgICAgc3Vic2NyaWJlcjogdG9waWNLaXQuc3Vic2NyaWJlcixcbiAgICAgICAgICAgICAgICBzdG9yYWdlUGF0aDogYXdhaXQgdG9waWNLaXQucmVjb3JkZXIuZ2V0U3RvcmFnZVBhdGgoKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldEFkZHJlc3MoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuY2hhaW5BZGRyZXNzO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBkZWxlZ2F0ZSh2YWxpZGF0b3IsIGFtb3VudCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZShcImRlbGVnYXRlXCIsIHZhbGlkYXRvciwgYW1vdW50KTtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgY29uc3QgYW1vdW50QXNDb2luID0gaGVscGVyLmFtb3VudFRvQ29pbihhbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaGVscGVyLm93bmVkKCkpLmV4ZWN1dGVFbmNvZGVkVHgoW1xuICAgICAgICAgICAgICBBbnkyLnRvSlNPTihcbiAgICAgICAgICAgICAgICBNc2dEZWxlZ2F0ZTIudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0b3JBZGRyZXNzOiB2YWxpZGF0b3IudmFsdWUsXG4gICAgICAgICAgICAgICAgICBhbW91bnQ6IGFtb3VudEFzQ29pblxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICByZWRlbGVnYXRlKHNyY1ZhbGlkYXRvciwgZHN0VmFsaWRhdG9yLCBhbW91bnQpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UoXCJyZWRlbGVnYXRlXCIsIHNyY1ZhbGlkYXRvciwgZHN0VmFsaWRhdG9yLCBhbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgeyBoZWxwZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShoZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChbXG4gICAgICAgICAgICAgIEFueTIudG9KU09OKFxuICAgICAgICAgICAgICAgIE1zZ0JlZ2luUmVkZWxlZ2F0ZTIudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0b3JTcmNBZGRyZXNzOiBzcmNWYWxpZGF0b3IudmFsdWUsXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0b3JEc3RBZGRyZXNzOiBkc3RWYWxpZGF0b3IudmFsdWUsXG4gICAgICAgICAgICAgICAgICBhbW91bnQ6IGhlbHBlci5hbW91bnRUb0NvaW4oYW1vdW50KVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICByZXN1bHRzLFxuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgd2l0aGRyYXdSZXdhcmQodmFsaWRhdG9yKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlKFwid2l0aGRyYXdSZXdhcmRcIiwgdmFsaWRhdG9yKTtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgY29uc3QgbXNnID0gTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmQyLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgIHZhbGlkYXRvckFkZHJlc3M6IHZhbGlkYXRvci52YWx1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBhY2NvdW50ID0gaGVscGVyLm93bmVkKCk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShhY2NvdW50KS5leGVjdXRlRW5jb2RlZFR4KFtBbnkyLnRvSlNPTihtc2cpXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMud2l0aGRyYXdSZXdhcmRXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldEJhbGFuY2UoZGVub20pIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeUJhbGFuY2VSZXF1ZXN0Mi50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIGRlbm9tOiBjb2VyY2VEZW5vbShjaGFpbkh1YiwgZGVub20pXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMuYmFsYW5jZVF1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0QmFsYW5jZXMoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzLCBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCFpY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluQWRkcmVzcy5jaGFpbklkKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaWNxQ29ubmVjdGlvbikucXVlcnkoW1xuICAgICAgICAgICAgICB0b1JlcXVlc3RRdWVyeUpzb24oXG4gICAgICAgICAgICAgICAgUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3QyLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgYWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMuYWxsQmFsYW5jZXNRdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgc2VuZCh0b0FjY291bnQsIGFtb3VudCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZShcInNlbmRcIiwgdG9BY2NvdW50LCBhbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgY29zbW9zRGVzdCA9IGNoYWluSHViLmNvZXJjZUNvc21vc0FkZHJlc3ModG9BY2NvdW50KTtcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgY29zbW9zRGVzdC5jaGFpbklkID09PSBjaGFpbkFkZHJlc3MuY2hhaW5JZCB8fCB0aHJvd1JlZGFjdGVkYGJhbmsvc2VuZCBjYW5ub3Qgc2VuZCB0byBhIGRpZmZlcmVudCBjaGFpbiAke3F1b3RlKGNvc21vc0Rlc3QuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRShoZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChbXG4gICAgICAgICAgICAgICAgQW55Mi50b0pTT04oXG4gICAgICAgICAgICAgICAgICBNc2dTZW5kMi50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgICAgZnJvbUFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgdG9BZGRyZXNzOiBjb3Ntb3NEZXN0LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IFtoZWxwZXIuYW1vdW50VG9Db2luKGFtb3VudCldXG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgc2VuZEFsbCh0b0FjY291bnQsIGFtb3VudHMpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UoXCJzZW5kQWxsXCIsIHRvQWNjb3VudCwgYW1vdW50cyk7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRShoZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChbXG4gICAgICAgICAgICAgICAgQW55Mi50b0pTT04oXG4gICAgICAgICAgICAgICAgICBNc2dTZW5kMi50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgICAgZnJvbUFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgdG9BZGRyZXNzOiB0b0FjY291bnQudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGFtb3VudDogYW1vdW50cy5tYXAoKHgpID0+IGhlbHBlci5hbW91bnRUb0NvaW4oeCkpXG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHRyYW5zZmVyKGRlc3RpbmF0aW9uLCBhbW91bnQsIG9wdHMpIHtcbiAgICAgICAgICB0cmFjZShcInRyYW5zZmVyXCIsIGRlc3RpbmF0aW9uLCBhbW91bnQsIG9wdHMpO1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb3Ntb3NEZXN0ID0gY2hhaW5IdWIuY29lcmNlQ29zbW9zQWRkcmVzcyhkZXN0aW5hdGlvbik7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB0b2tlbiA9IGhlbHBlci5hbW91bnRUb0NvaW4oYW1vdW50KTtcbiAgICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb25JbmZvViA9IHdhdGNoKFxuICAgICAgICAgICAgICBjaGFpbkh1Yi5nZXRDb25uZWN0aW9uSW5mbyhcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLmNoYWluQWRkcmVzcy5jaGFpbklkLFxuICAgICAgICAgICAgICAgIGNvc21vc0Rlc3QuY2hhaW5JZFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICBhbGxWb3dzKFtcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uSW5mb1YsXG4gICAgICAgICAgICAgICAgdGltZXN0YW1wSGVscGVyLnZvd09yVmFsdWVGcm9tT3B0cyhvcHRzKVxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMudHJhbnNmZXJXYXRjaGVyLFxuICAgICAgICAgICAgICB7IG9wdHMsIHRva2VuLCBkZXN0aW5hdGlvbjogY29zbW9zRGVzdCB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdHJhbnNmZXJTdGVwcyhhbW91bnQsIG1zZykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwidHJhbnNmZXJTdGVwcyBnb3RcIiwgYW1vdW50LCBtc2cpO1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB0aHJvd1JlZGFjdGVkYG5vdCB5ZXQgaW1wbGVtZW50ZWRgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHdpdGhkcmF3UmV3YXJkcygpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4gdGhyb3dSZWRhY3RlZGBOb3QgSW1wbGVtZW50ZWQuIFRyeSB1c2luZyB3aXRoZHJhd1Jld2FyZC5gKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB1bmRlbGVnYXRlKGRlbGVnYXRpb25zKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlKFwidW5kZWxlZ2F0ZVwiLCBkZWxlZ2F0aW9ucyk7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGRlbGVnYXRpb25zLmV2ZXJ5KFxuICAgICAgICAgICAgICAoZCkgPT4gZC5kZWxlZ2F0b3IgPyBkLmRlbGVnYXRvci52YWx1ZSA9PT0gY2hhaW5BZGRyZXNzLnZhbHVlIDogdHJ1ZVxuICAgICAgICAgICAgKSB8fCB0aHJvd1JlZGFjdGVkYFNvbWUgZGVsZWdhdGlvbiByZWNvcmQgaXMgZm9yIGFub3RoZXIgZGVsZWdhdG9yYDtcbiAgICAgICAgICAgIGNvbnN0IHVuZGVsZWdhdGVWID0gd2F0Y2goXG4gICAgICAgICAgICAgIEUoaGVscGVyLm93bmVkKCkpLmV4ZWN1dGVFbmNvZGVkVHgoXG4gICAgICAgICAgICAgICAgZGVsZWdhdGlvbnMubWFwKFxuICAgICAgICAgICAgICAgICAgKHsgdmFsaWRhdG9yLCBhbW91bnQgfSkgPT4gQW55Mi50b0pTT04oXG4gICAgICAgICAgICAgICAgICAgIE1zZ1VuZGVsZWdhdGUyLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0b3JBZGRyZXNzOiB2YWxpZGF0b3IudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBjb2VyY2VDb2luKGNoYWluSHViLCBhbW91bnQpXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy51bmRlbGVnYXRlV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh1bmRlbGVnYXRlViwgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBkZWFjdGl2YXRlKCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB3YXRjaChFKHRoaXMuZmFjZXRzLmhlbHBlci5vd25lZCgpKS5kZWFjdGl2YXRlKCkpKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgcmVhY3RpdmF0ZSgpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4gd2F0Y2goRSh0aGlzLmZhY2V0cy5oZWxwZXIub3duZWQoKSkucmVhY3RpdmF0ZSgpKSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0RGVsZWdhdGlvbih2YWxpZGF0b3IpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UoXCJnZXREZWxlZ2F0aW9uXCIsIHZhbGlkYXRvcik7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5RGVsZWdhdGlvblJlcXVlc3QyLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcjogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgdmFsaWRhdG9yQWRkcjogdmFsaWRhdG9yLnZhbHVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMuZGVsZWdhdGlvblF1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldERlbGVnYXRpb25zKCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZShcImdldERlbGVnYXRpb25zXCIpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVxdWVzdDIudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyOiBjaGFpbkFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5kZWxlZ2F0aW9uc1F1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0VW5ib25kaW5nRGVsZWdhdGlvbih2YWxpZGF0b3IpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UoXCJnZXRVbmJvbmRpbmdEZWxlZ2F0aW9uXCIsIHZhbGlkYXRvcik7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlcXVlc3QyLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcjogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgdmFsaWRhdG9yQWRkcjogdmFsaWRhdG9yLnZhbHVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMudW5ib25kaW5nRGVsZWdhdGlvblF1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldFVuYm9uZGluZ0RlbGVnYXRpb25zKCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZShcImdldFVuYm9uZGluZ0RlbGVnYXRpb25zXCIpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdDIudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyOiBjaGFpbkFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy51bmJvbmRpbmdEZWxlZ2F0aW9uc1F1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0UmVkZWxlZ2F0aW9ucygpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UoXCJnZXRSZWRlbGVnYXRpb25zXCIpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeVJlZGVsZWdhdGlvbnNSZXF1ZXN0Mi50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHI6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICBkc3RWYWxpZGF0b3JBZGRyOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgc3JjVmFsaWRhdG9yQWRkcjogXCJcIlxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLnJlZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0UmV3YXJkKHZhbGlkYXRvcikge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZShcImdldFJld2FyZFwiLCB2YWxpZGF0b3IpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVxdWVzdDIudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0b3JBZGRyZXNzOiB2YWxpZGF0b3IudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5yZXdhcmRRdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldFJld2FyZHMoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlKFwiZ2V0UmV3YXJkc1wiKTtcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzLCBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCFpY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluQWRkcmVzcy5jaGFpbklkKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaWNxQ29ubmVjdGlvbikucXVlcnkoW1xuICAgICAgICAgICAgICB0b1JlcXVlc3RRdWVyeUpzb24oXG4gICAgICAgICAgICAgICAgUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVxdWVzdDIudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5yZXdhcmRzUXVlcnlXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZXhlY3V0ZUVuY29kZWRUeChtc2dzLCBvcHRzKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KFxuICAgICAgICAgICAgKCkgPT4gd2F0Y2goRSh0aGlzLmZhY2V0cy5oZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChtc2dzLCBvcHRzKSlcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICBkZXBvc2l0Rm9yQnVybihkZXN0aW5hdGlvbiwgYW1vdW50LCBjYWxsZXIpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UoXCJkZXBvc2l0Rm9yQnVyblwiLCB7IGRlc3RpbmF0aW9uLCBhbW91bnQgfSk7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IGRlc3RQYXJ0cyA9IHBhcnNlQWNjb3VudElkKGRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgIGNvbnN0IGNoYWluSWQgPSBgJHtkZXN0UGFydHMubmFtZXNwYWNlfToke2Rlc3RQYXJ0cy5yZWZlcmVuY2V9YDtcbiAgICAgICAgICAgIGNvbnN0IHsgY2N0cERlc3RpbmF0aW9uRG9tYWluIH0gPSBjaGFpbkh1Yi5nZXRDaGFpbkluZm9CeUNoYWluSWQoY2hhaW5JZCk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNjdHBEZXN0aW5hdGlvbkRvbWFpbiAhPT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYCR7cXVvdGUoY2hhaW5JZCl9IGRvZXMgbm90IGhhdmUgXCJjY3RwRGVzdGluYXRpb25Eb21haW5cIiBzZXQgaW4gQ2hhaW5JbmZvYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGRlcG9zaXRGb3JCdXJuID0ge1xuICAgICAgICAgICAgICBhbW91bnQ6IGhlbHBlci5hbW91bnRUb0NvaW4oYW1vdW50KT8uYW1vdW50LFxuICAgICAgICAgICAgICBmcm9tOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgIGRlc3RpbmF0aW9uRG9tYWluOiBjY3RwRGVzdGluYXRpb25Eb21haW4sXG4gICAgICAgICAgICAgIG1pbnRSZWNpcGllbnQ6IGFjY291bnRJZFRvMzJCeXRlcyhkZXN0aW5hdGlvbiksXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIGJ1cm5Ub2tlbjogXCJ1dXNkY1wiXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25DYWxsZXIgPSAoKCkgPT4ge1xuICAgICAgICAgICAgICBpZiAoIWNhbGxlcikgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgICAgICAgY29uc3QgY2FsbGVyUGFydHMgPSBwYXJzZUFjY291bnRJZChjYWxsZXIpO1xuICAgICAgICAgICAgICBjYWxsZXJQYXJ0cy5uYW1lc3BhY2UgPT09IGRlc3RQYXJ0cy5uYW1lc3BhY2UgfHwgdGhyb3dSZWRhY3RlZGBjYWxsZXIgJHtxdW90ZShjYWxsZXIpfSBtdXN0IGJlIGluIHNhbWUgbmFtZXNwYWNlIGFzIGRlc3RpbmF0aW9uICR7cXVvdGUoZGVzdGluYXRpb24pfWA7XG4gICAgICAgICAgICAgIHJldHVybiBhY2NvdW50SWRUbzMyQnl0ZXMoY2FsbGVyKTtcbiAgICAgICAgICAgIH0pKCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUoaGVscGVyLm93bmVkKCkpLmV4ZWN1dGVFbmNvZGVkVHgoW1xuICAgICAgICAgICAgICAgIEFueTIudG9KU09OKFxuICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb25DYWxsZXIgPyBNc2dEZXBvc2l0Rm9yQnVybldpdGhDYWxsZXIyLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgICAuLi5kZXBvc2l0Rm9yQnVybixcbiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb25DYWxsZXJcbiAgICAgICAgICAgICAgICAgIH0pIDogTXNnRGVwb3NpdEZvckJ1cm4yLnRvUHJvdG9Nc2coZGVwb3NpdEZvckJ1cm4pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnRLaXQ7XG59O1xudmFyIHByZXBhcmVDb3Ntb3NPcmNoZXN0cmF0aW9uQWNjb3VudCA9ICh6b25lLCB7IGNoYWluSHViLCBtYWtlUmVjb3JkZXJLaXQsIHRpbWVyU2VydmljZSwgdm93VG9vbHMsIHpjZiB9KSA9PiB7XG4gIGNvbnN0IG1ha2VLaXQgPSBwcmVwYXJlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnRLaXQoem9uZSwge1xuICAgIGNoYWluSHViLFxuICAgIG1ha2VSZWNvcmRlcktpdCxcbiAgICB0aW1lclNlcnZpY2UsXG4gICAgdm93VG9vbHMsXG4gICAgemNmXG4gIH0pO1xuICByZXR1cm4gKC4uLmFyZ3MpID0+IG1ha2VLaXQoLi4uYXJncykuaG9sZGVyO1xufTtcblxuLy9cbnZhciBwcmVwYXJlTG9jYWxDaGFpbkZhY2FkZUtpdCA9ICh6b25lLCB7XG4gIG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0LFxuICBhZ29yaWNOYW1lcyxcbiAgbG9jYWxjaGFpbixcbiAgLy9cbiAgLy9cbiAgc3RvcmFnZU5vZGUsXG4gIHZvd1Rvb2xzOiB7IGFsbFZvd3MsIHdhdGNoLCBhc1ZvdyB9XG59KSA9PiB6b25lLmV4b0NsYXNzS2l0KFxuICBcIkxvY2FsQ2hhaW5GYWNhZGVcIixcbiAge1xuICAgIHB1YmxpYzogTS5pbnRlcmZhY2UoXCJMb2NhbENoYWluRmFjYWRlXCIsIHtcbiAgICAgIC4uLmNoYWluRmFjYWRlTWV0aG9kcyxcbiAgICAgIHF1ZXJ5OiBNLmNhbGwoTS5hcnJheU9mKFR5cGVkSnNvblNoYXBlKSkucmV0dXJucyhWb3dTaGFwZSksXG4gICAgICBnZXRWQmFua0Fzc2V0SW5mbzogTS5jYWxsKCkub3B0aW9uYWwoTS5ib29sZWFuKCkpLnJldHVybnMoVm93U2hhcGUpXG4gICAgfSksXG4gICAgdmJhbmtBc3NldFZhbHVlc1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwidmJhbmtBc3NldFZhbHVlc1dhdGNoZXJcIiwge1xuICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhWb3dTaGFwZSlcbiAgICB9KSxcbiAgICBtYWtlQWNjb3VudFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwibWFrZUFjY291bnRXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoW00ucmVtb3RhYmxlKFwiTENBIEFjY291bnRcIiksIE0uc3RyaW5nKCldKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoVm93U2hhcGUpXG4gICAgfSksXG4gICAgbWFrZUNoaWxkTm9kZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwibWFrZUNoaWxkTm9kZVdhdGNoZXJcIiwge1xuICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLm9yKE0ucmVtb3RhYmxlKCksIE0udW5kZWZpbmVkKCkpKS5vcHRpb25hbCh7IGFjY291bnQ6IE0ucmVtb3RhYmxlKCksIGFkZHJlc3M6IE0uc3RyaW5nKCkgfSkucmV0dXJucyhNLnJlbW90YWJsZSgpKVxuICAgIH0pXG4gIH0sXG4gIC8qXG5cbiAgICovXG4gIChsb2NhbENoYWluSW5mbykgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICBsb2NhbENoYWluSW5mbyxcbiAgICAgIHZiYW5rQXNzZXRzOiAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHZvaWQgMFxuICAgICAgKVxuICAgIH07XG4gIH0sXG4gIHtcbiAgICBwdWJsaWM6IHtcbiAgICAgIGdldENoYWluSW5mbygpIHtcbiAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuc3RhdGUubG9jYWxDaGFpbkluZm8pO1xuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIG1ha2VBY2NvdW50KCkge1xuICAgICAgICBjb25zdCBsY2FQID0gRShsb2NhbGNoYWluKS5tYWtlQWNjb3VudCgpO1xuICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgLy9cbiAgICAgICAgICAvL1xuICAgICAgICAgIC8vXG4gICAgICAgICAgYWxsVm93cyhbbGNhUCwgaGVhcFZvd0UobGNhUCkuZ2V0QWRkcmVzcygpXSksXG4gICAgICAgICAgdGhpcy5mYWNldHMubWFrZUFjY291bnRXYXRjaGVyXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHF1ZXJ5KHJlcXVlc3RzKSB7XG4gICAgICAgIHJldHVybiB3YXRjaChFKGxvY2FsY2hhaW4pLnF1ZXJ5TWFueShyZXF1ZXN0cykpO1xuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBnZXRWQmFua0Fzc2V0SW5mbygpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICBjb25zdCB7IHZiYW5rQXNzZXRzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmICh2YmFua0Fzc2V0cykge1xuICAgICAgICAgICAgcmV0dXJuIHZiYW5rQXNzZXRzO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCB2YmFua0Fzc2V0TmFtZUh1YlAgPSBFKGFnb3JpY05hbWVzKS5sb29rdXAoXCJ2YmFua0Fzc2V0XCIpO1xuICAgICAgICAgIGNvbnN0IHZiYW5rQXNzZXRWYWx1ZXNQID0gRSh2YmFua0Fzc2V0TmFtZUh1YlApLnZhbHVlcygpO1xuICAgICAgICAgIGNvbnN0IHsgdmJhbmtBc3NldFZhbHVlc1dhdGNoZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIHJldHVybiB3YXRjaCh2YmFua0Fzc2V0VmFsdWVzUCwgdmJhbmtBc3NldFZhbHVlc1dhdGNoZXIpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHZiYW5rQXNzZXRWYWx1ZXNXYXRjaGVyOiB7XG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKGFzc2V0cykge1xuICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgIHN0YXRlLnZiYW5rQXNzZXRzID0gYXNzZXRzO1xuICAgICAgICAgIHJldHVybiBhc3NldHM7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFrZUFjY291bnRXYXRjaGVyOiB7XG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKFthY2NvdW50LCBhZGRyZXNzXSkge1xuICAgICAgICBjb25zdCBvcHRpb25hbFN0b3JhZ2VOb2RlID0gc3RvcmFnZU5vZGUgPyBFKHN0b3JhZ2VOb2RlKS5tYWtlQ2hpbGROb2RlKGFkZHJlc3MpIDogdm9pZCAwO1xuICAgICAgICByZXR1cm4gd2F0Y2gob3B0aW9uYWxTdG9yYWdlTm9kZSwgdGhpcy5mYWNldHMubWFrZUNoaWxkTm9kZVdhdGNoZXIsIHtcbiAgICAgICAgICBhY2NvdW50LFxuICAgICAgICAgIGFkZHJlc3NcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBtYWtlQ2hpbGROb2RlV2F0Y2hlcjoge1xuICAgICAgLypcblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKGNoaWxkTm9kZSwgeyBhY2NvdW50LCBhZGRyZXNzIH0pIHtcbiAgICAgICAgY29uc3QgeyBsb2NhbENoYWluSW5mbyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgeyBob2xkZXIgfSA9IG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0KHtcbiAgICAgICAgICBhY2NvdW50LFxuICAgICAgICAgIGFkZHJlc3M6IGhhcmRlbih7XG4gICAgICAgICAgICB2YWx1ZTogYWRkcmVzcyxcbiAgICAgICAgICAgIGVuY29kaW5nOiBcImJlY2gzMlwiLFxuICAgICAgICAgICAgY2hhaW5JZDogbG9jYWxDaGFpbkluZm8uY2hhaW5JZFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgc3RvcmFnZU5vZGU6IGNoaWxkTm9kZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGhvbGRlcjtcbiAgICAgIH1cbiAgICB9XG4gIH1cbik7XG5oYXJkZW4ocHJlcGFyZUxvY2FsQ2hhaW5GYWNhZGVLaXQpO1xudmFyIHByZXBhcmVMb2NhbENoYWluRmFjYWRlID0gKHpvbmUsIHBvd2VycykgPT4ge1xuICBjb25zdCBtYWtlTG9jYWxDaGFpbkZhY2FkZUtpdCA9IHByZXBhcmVMb2NhbENoYWluRmFjYWRlS2l0KHpvbmUsIHBvd2Vycyk7XG4gIHJldHVybiBwaWNrRmFjZXQzKG1ha2VMb2NhbENoYWluRmFjYWRlS2l0LCBcInB1YmxpY1wiKTtcbn07XG5oYXJkZW4ocHJlcGFyZUxvY2FsQ2hhaW5GYWNhZGUpO1xuXG4vL1xudmFyIFF1ZXJ5RGVub21IYXNoUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvaWJjLmFwcGxpY2F0aW9ucy50cmFuc2Zlci52MS5RdWVyeURlbm9tSGFzaFJlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIudHJhY2UgJiYgbzIudWludDMyKDEwKS5zdHJpbmcoZTIudHJhY2UpLCBvMiksIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgcjYgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gbzIgPyByNi5sZW4gOiByNi5wb3MgKyBvMjtcbiAgY29uc3QgczIgPSB7IHRyYWNlOiBcIlwiIH07XG4gIGZvciAoOyByNi5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgZTMgPSByNi51aW50MzIoKTtcbiAgICBpZiAoZTMgPj4+IDMgPT0gMSkgczIudHJhY2UgPSByNi5zdHJpbmcoKTtcbiAgICBlbHNlIHI2LnNraXBUeXBlKDcgJiBlMyk7XG4gIH1cbiAgcmV0dXJuIHMyO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgdHJhY2U6IGlzU2V0KGUyLnRyYWNlKSA/IFN0cmluZyhlMi50cmFjZSkgOiBcIlwiIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIudHJhY2UgJiYgKG8yLnRyYWNlID0gZTIudHJhY2UpLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0geyB0cmFjZTogXCJcIiB9O1xuICByZXR1cm4gbzIudHJhY2UgPSBlMi50cmFjZSA/PyBcIlwiLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBRdWVyeURlbm9tSGFzaFJlcXVlc3QuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeURlbm9tSGFzaFJlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9pYmMuYXBwbGljYXRpb25zLnRyYW5zZmVyLnYxLlF1ZXJ5RGVub21IYXNoUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlEZW5vbUhhc2hSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciB0cmFjZTIgPSBtYWtlVHJhY2VyMihcIlBhY2tldFRvb2xzXCIpO1xudmFyIHsgdG9DYXBEYXRhIH0gPSBtYWtlTWFyc2hhbCh2b2lkIDAsIHZvaWQgMCwge1xuICBtYXJzaGFsTmFtZTogXCJKdXN0RW5jb2RlclwiLFxuICBzZXJpYWxpemVCb2R5Rm9ybWF0OiBcImNhcGRhdGFcIlxufSk7XG52YXIganVzdCA9IChvYmopID0+IHtcbiAgY29uc3QgeyBib2R5IH0gPSB0b0NhcERhdGEob2JqKTtcbiAgcmV0dXJuIGRlY29kZVRvSnVzdGluKEpTT04ucGFyc2UoYm9keSksIGZhbHNlKTtcbn07XG52YXIgeyBWb3ckOiBWb3ckMyB9ID0gU2hhcGU7XG52YXIgRVZvdyQgPSAoc2hhcGUpID0+IE0ub3IoVm93JDMoc2hhcGUpLCBNLnByb21pc2UoXG4gIC8qICAgICAgICovXG4pKTtcbnZhciBzaW5rNyA9ICgpID0+IHtcbn07XG5oYXJkZW4oc2luazcpO1xudmFyIHByZXBhcmVQYWNrZXRUb29scyA9ICh6b25lLCB2b3dUb29scykgPT4ge1xuICBjb25zdCB7IGFsbFZvd3MsIG1ha2VWb3dLaXQsIHdhdGNoLCB3aGVuIH0gPSB2b3dUb29scztcbiAgY29uc3QgbWFrZVBhY2tldFRvb2xzS2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIlBhY2tldFRvb2xzS2l0XCIsXG4gICAge1xuICAgICAgcHVibGljOiBNLmludGVyZmFjZShcIlBhY2tldFRvb2xzXCIsIHtcbiAgICAgICAgc2VuZFRoZW5XYWl0Rm9yQWNrOiBNLmNhbGwoRVZvdyQoTS5yZW1vdGFibGUoXCJQYWNrZXRTZW5kZXJcIikpKS5vcHRpb25hbChNLmFueSgpKS5yZXR1cm5zKEVWb3ckKE0uYW55KCkpKSxcbiAgICAgICAgbWF0Y2hGaXJzdFBhY2tldDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoRVZvdyQoTS5hbnkoKSkpLFxuICAgICAgICBtb25pdG9yVHJhbnNmZXJzOiBNLmNhbGwoTS5yZW1vdGFibGUoXCJUYXJnZXRBcHBcIikpLnJldHVybnMoXG4gICAgICAgICAgRVZvdyQoTS5hbnkoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICB0YXA6IE0uaW50ZXJmYWNlKFwidGFwXCIsIHtcbiAgICAgICAgLy9cbiAgICAgICAgcmVjZWl2ZVVwY2FsbDogTS5jYWxsV2hlbihNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIG1vbml0b3JSZWdpc3RyYXRpb246IE0uaW50ZXJmYWNlKFwibW9uaXRvclJlZ2lzdHJhdGlvblwiLCB7XG4gICAgICAgIC8vXG4gICAgICAgIHVwZGF0ZVRhcmdldEFwcDogTS5jYWxsV2hlbihcbiAgICAgICAgICBNLmF3YWl0KE0ucmVtb3RhYmxlKFwiVGFyZ2V0QXBwXCIpKVxuICAgICAgICApLnJldHVybnMoKSxcbiAgICAgICAgLy9cbiAgICAgICAgcmV2b2tlOiBNLmNhbGxXaGVuKCkucmV0dXJucygpXG4gICAgICB9KSxcbiAgICAgIHdhdGNoUGFja2V0TWF0Y2g6IE0uaW50ZXJmYWNlKFwid2F0Y2hQYWNrZXRNYXRjaFwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSwgTS5yZWNvcmQoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICB3YXRjaFBhY2tldFBhdHRlcm46IE0uaW50ZXJmYWNlKFwid2F0Y2hQYWNrZXRQYXR0ZXJuXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpLCBNLnJlY29yZCgpKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSwgTS5yZWNvcmQoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICB3YXRjaERlY3JQZW5kaW5nUGF0dGVybnM6IE0uaW50ZXJmYWNlKFwid2F0Y2hEZWNyUGVuZGluZ1BhdHRlcm5zXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBzZW5kUGFja2V0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJzZW5kUGFja2V0V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoXG4gICAgICAgICAgW00ucmVjb3JkKCksIE0ucmVtb3RhYmxlKFwiUGFja2V0U2VuZGVyXCIpXSxcbiAgICAgICAgICBNLnJlY29yZCgpXG4gICAgICAgICkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBwYWNrZXRXYXNTZW50V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJwYWNrZXRXYXNTZW50V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoXG4gICAgICAgICAgeyBldmVudFBhdHRlcm46IE0ucGF0dGVybigpLCByZXN1bHRWOiBWb3ckMyhNLmFueSgpKSB9LFxuICAgICAgICAgIE0ucmVjb3JkKClcbiAgICAgICAgKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHV0aWxzOiBNLmludGVyZmFjZShcInV0aWxzXCIsIHtcbiAgICAgICAgc3Vic2NyaWJlVG9UcmFuc2ZlcnM6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICB1bnN1YnNjcmliZUZyb21UcmFuc2ZlcnM6IE0uY2FsbCgpLnJldHVybnMoTS51bmRlZmluZWQoKSksXG4gICAgICAgIGluY3JQZW5kaW5nUGF0dGVybnM6IE0uY2FsbCgpLnJldHVybnMoVm93JDMoTS51bmRlZmluZWQoKSkpLFxuICAgICAgICBkZWNyUGVuZGluZ1BhdHRlcm5zOiBNLmNhbGwoKS5yZXR1cm5zKFZvdyQzKE0udW5kZWZpbmVkKCkpKVxuICAgICAgfSksXG4gICAgICByZWplY3RSZXNvbHZlckFuZFJldGhyb3dXYXRjaGVyOiBNLmludGVyZmFjZShcInJlamVjdFJlc29sdmVyV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpLCB7XG4gICAgICAgICAgcmVzb2x2ZXI6IE0ucmVtb3RhYmxlKFwicmVzb2x2ZXJcIilcbiAgICAgICAgfSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSlcbiAgICB9LFxuICAgIC8qXG5cbiAgICAgKi9cbiAgICAobGNhKSA9PiB7XG4gICAgICBjb25zdCByZXNvbHZlclRvUGF0dGVybiA9IHpvbmUuZGV0YWNoZWQoKS5tYXBTdG9yZShcInJlc29sdmVyVG9QYXR0ZXJuXCIpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbGNhLFxuICAgICAgICByZWc6IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBudWxsXG4gICAgICAgICksXG4gICAgICAgIHJlc29sdmVyVG9QYXR0ZXJuLFxuICAgICAgICB1cGNhbGxRdWV1ZTogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIG51bGxcbiAgICAgICAgKSxcbiAgICAgICAgcGVuZGluZzogMCxcbiAgICAgICAgZXh0cmE6IG51bGwsXG4gICAgICAgIG1vbml0b3I6IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBudWxsXG4gICAgICAgIClcbiAgICAgIH07XG4gICAgfSxcbiAgICB7XG4gICAgICBwdWJsaWM6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgLy9cbiAgICAgICAgYXN5bmMgbW9uaXRvclRyYW5zZmVycyhtb25pdG9yKSB7XG4gICAgICAgICAgY29uc3QgbXJlZyA9IHRoaXMuZmFjZXRzLm1vbml0b3JSZWdpc3RyYXRpb247XG4gICAgICAgICAgYXdhaXQgbXJlZy51cGRhdGVUYXJnZXRBcHAobW9uaXRvcik7XG4gICAgICAgICAgcmV0dXJuIG1yZWc7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG1hdGNoRmlyc3RQYWNrZXQocGF0dGVyblApIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy51dGlscy5pbmNyUGVuZGluZ1BhdHRlcm5zKCksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy53YXRjaFBhY2tldE1hdGNoLFxuICAgICAgICAgICAgeyBwYXR0ZXJuUCB9XG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHNlbmRUaGVuV2FpdEZvckFjayhwYWNrZXRTZW5kZXIsIG9wdHMgPSB7fSkge1xuICAgICAgICAgIGNvbnN0IHBhdHRlcm4gPSBtYWtlVm93S2l0KCk7XG4gICAgICAgICAgY29uc3QgbWF0Y2hWID0gd2F0Y2goXG4gICAgICAgICAgICBhbGxWb3dzKFtcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucHVibGljLm1hdGNoRmlyc3RQYWNrZXQocGF0dGVybi52b3cpLFxuICAgICAgICAgICAgICBwYWNrZXRTZW5kZXJcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMuc2VuZFBhY2tldFdhdGNoZXIsXG4gICAgICAgICAgICB7IG9wdHMgfVxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ViA9IHdhdGNoKG1hdGNoViwgdGhpcy5mYWNldHMucGFja2V0V2FzU2VudFdhdGNoZXIsIHtcbiAgICAgICAgICAgIG9wdHMsXG4gICAgICAgICAgICBwYXR0ZXJuUmVzb2x2ZXI6IHBhdHRlcm4ucmVzb2x2ZXJcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0ViwgdGhpcy5mYWNldHMucmVqZWN0UmVzb2x2ZXJBbmRSZXRocm93V2F0Y2hlciwge1xuICAgICAgICAgICAgcmVzb2x2ZXI6IHBhdHRlcm4ucmVzb2x2ZXJcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG1vbml0b3JSZWdpc3RyYXRpb246IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAvL1xuICAgICAgICBhc3luYyB1cGRhdGVUYXJnZXRBcHAodGFwKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5tb25pdG9yID0gYXdhaXQgdGFwO1xuICAgICAgICAgIGF3YWl0IHRoaXMuZmFjZXRzLnV0aWxzLnN1YnNjcmliZVRvVHJhbnNmZXJzKCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgLy9cbiAgICAgICAgYXN5bmMgcmV2b2tlKCkge1xuICAgICAgICAgIHRoaXMuc3RhdGUubW9uaXRvciA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0YXA6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgYXN5bmMgcmVjZWl2ZVVwY2FsbChvYmopIHtcbiAgICAgICAgICBjb25zdCB7IG1vbml0b3IsIHJlc29sdmVyVG9QYXR0ZXJuLCB1cGNhbGxRdWV1ZSwgcGVuZGluZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICB0cmFjZTIoXG4gICAgICAgICAgICBgVHJ5aW5nICR7cmVzb2x2ZXJUb1BhdHRlcm4uZ2V0U2l6ZSgpfSBjdXJyZW50IHBhdHRlcm5zIGFuZCAke3BlbmRpbmd9IHBlbmRpbmcgcGF0dGVybnMgYWdhaW5zdGAsXG4gICAgICAgICAgICBqdXN0KG9iailcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChtb25pdG9yKSB7XG4gICAgICAgICAgICB2b2lkIEUobW9uaXRvcikucmVjZWl2ZVVwY2FsbChvYmopO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmb3IgKGNvbnN0IFtyZXNvbHZlciwgcGF0dGVybl0gb2YgcmVzb2x2ZXJUb1BhdHRlcm4uZW50cmllcygpKSB7XG4gICAgICAgICAgICBpZiAobWF0Y2hlcyhvYmosIHBhdHRlcm4pKSB7XG4gICAgICAgICAgICAgIHRyYWNlMihcIk1hdGNoZWQgcGF0dGVybjpcIiwganVzdChwYXR0ZXJuKSk7XG4gICAgICAgICAgICAgIHJlc29sdmVyLnJlc29sdmUob2JqKTtcbiAgICAgICAgICAgICAgcmVzb2x2ZXJUb1BhdHRlcm4uZGVsZXRlKHJlc29sdmVyKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodXBjYWxsUXVldWUpIHtcbiAgICAgICAgICAgIHRyYWNlMihcIlN0YXNoaW5nIG9iamVjdCBpbiB1cGNhbGxRdWV1ZVwiKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUudXBjYWxsUXVldWUgPSBoYXJkZW4odXBjYWxsUXVldWUuY29uY2F0KG9iaikpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0cmFjZTIoXCJObyBtYXRjaCB5ZXQuXCIpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgc2VuZFBhY2tldFdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3sgbWF0Y2ggfSwgc2VuZGVyXSwgY3R4KSB7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKEUoc2VuZGVyKS5zZW5kUGFja2V0KG1hdGNoLCBjdHgub3B0cykpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcGFja2V0V2FzU2VudFdhdGNoZXI6IHtcbiAgICAgICAgb25GdWxmaWxsZWQoeyBldmVudFBhdHRlcm4sIHJlc3VsdFYgfSwgY3R4KSB7XG4gICAgICAgICAgY29uc3QgeyBwYXR0ZXJuUmVzb2x2ZXIgfSA9IGN0eDtcbiAgICAgICAgICBwYXR0ZXJuUmVzb2x2ZXIucmVzb2x2ZShldmVudFBhdHRlcm4pO1xuICAgICAgICAgIHJldHVybiByZXN1bHRWO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmVqZWN0UmVzb2x2ZXJBbmRSZXRocm93V2F0Y2hlcjoge1xuICAgICAgICBvblJlamVjdGVkKHJlaiwgeyByZXNvbHZlciB9KSB7XG4gICAgICAgICAgcmVzb2x2ZXIucmVqZWN0KHJlaik7XG4gICAgICAgICAgdGhyb3cgcmVqO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2F0Y2hQYWNrZXRNYXRjaDoge1xuICAgICAgICBvbkZ1bGZpbGxlZChfLCB7IHBhdHRlcm5QIH0pIHtcbiAgICAgICAgICBjb25zdCB7IHZvdywgcmVzb2x2ZXIgfSA9IG1ha2VWb3dLaXQoKTtcbiAgICAgICAgICBjb25zdCBwYXR0ZXJuViA9IHdhdGNoKFxuICAgICAgICAgICAgcGF0dGVyblAsXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy53YXRjaFBhY2tldFBhdHRlcm4sXG4gICAgICAgICAgICBoYXJkZW4oeyByZXNvbHZlciB9KVxuICAgICAgICAgICk7XG4gICAgICAgICAgd2F0Y2gocGF0dGVyblYsIHRoaXMuZmFjZXRzLndhdGNoRGVjclBlbmRpbmdQYXR0ZXJucyk7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IG1hdGNoOiB2b3csIHJlc29sdmVyIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2F0Y2hEZWNyUGVuZGluZ1BhdHRlcm5zOiB7XG4gICAgICAgIG9uRnVsZmlsbGVkKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmZhY2V0cy51dGlscy5kZWNyUGVuZGluZ1BhdHRlcm5zKCk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uUmVqZWN0ZWQoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmFjZXRzLnV0aWxzLmRlY3JQZW5kaW5nUGF0dGVybnMoKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHdhdGNoUGFja2V0UGF0dGVybjoge1xuICAgICAgICBvbkZ1bGZpbGxlZChwYXR0ZXJuLCB7IHJlc29sdmVyIH0pIHtcbiAgICAgICAgICBjb25zdCB7IHJlc29sdmVyVG9QYXR0ZXJuLCB1cGNhbGxRdWV1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICB0cmFjZTIoXCJ3YXRjaFBhY2tldFBhdHRlcm4gb25GdWxmaWxsZWRcIiwganVzdChwYXR0ZXJuKSk7XG4gICAgICAgICAgaWYgKCF1cGNhbGxRdWV1ZSkge1xuICAgICAgICAgICAgdHJhY2UyKFwiTm8gdXBjYWxsIHF1ZXVlIHlldC4gIFNhdmUgdGhlIHBhdHRlcm4gZm9yIGxhdGVyLlwiKTtcbiAgICAgICAgICAgIHJlc29sdmVyVG9QYXR0ZXJuLmluaXQocmVzb2x2ZXIsIHBhdHRlcm4pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBpMiA9IHVwY2FsbFF1ZXVlLmZpbmRJbmRleCgob2JqKSA9PiBtYXRjaGVzKG9iaiwgcGF0dGVybikpO1xuICAgICAgICAgIGlmIChpMiA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRyYWNlMihcIk5vIG1hdGNoIHlldC4gU2F2ZSB0aGUgcGF0dGVybiBmb3IgbGF0ZXIuXCIpO1xuICAgICAgICAgICAgcmVzb2x2ZXJUb1BhdHRlcm4uaW5pdChyZXNvbHZlciwgcGF0dGVybik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHRyYWNlMihcbiAgICAgICAgICAgIFwiU3VjY2VzcyEgUmVtb3ZlIHRoZSBtYXRjaGVkIG9iamVjdCBmcm9tIHRoZSBxdWV1ZS5cIixcbiAgICAgICAgICAgIGp1c3QodXBjYWxsUXVldWVbaTJdKVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmVzb2x2ZXIucmVzb2x2ZSh1cGNhbGxRdWV1ZVtpMl0pO1xuICAgICAgICAgIHRoaXMuc3RhdGUudXBjYWxsUXVldWUgPSBoYXJkZW4oXG4gICAgICAgICAgICB1cGNhbGxRdWV1ZS5zbGljZSgwLCBpMikuY29uY2F0KHVwY2FsbFF1ZXVlLnNsaWNlKGkyICsgMSkpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25SZWplY3RlZChyZWFzb24sIHsgcmVzb2x2ZXIgfSkge1xuICAgICAgICAgIHJlc29sdmVyLnJlamVjdChyZWFzb24pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdXRpbHM6IHtcbiAgICAgICAgaW5jclBlbmRpbmdQYXR0ZXJucygpIHtcbiAgICAgICAgICBjb25zdCB7IHBlbmRpbmcsIHJlZywgdXBjYWxsUXVldWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5wZW5kaW5nICs9IDE7XG4gICAgICAgICAgaWYgKCF1cGNhbGxRdWV1ZSkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS51cGNhbGxRdWV1ZSA9IGhhcmRlbihbXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChyZWcgfHwgcGVuZGluZyA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh2b2lkIDApO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMudXRpbHMuc3Vic2NyaWJlVG9UcmFuc2ZlcnMoKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGRlY3JQZW5kaW5nUGF0dGVybnMoKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5wZW5kaW5nIC09IDE7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdGUucGVuZGluZyA+IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5zdGF0ZS5wZW5kaW5nID0gMDtcbiAgICAgICAgICB0aGlzLnN0YXRlLnVwY2FsbFF1ZXVlID0gbnVsbDtcbiAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMudXRpbHMudW5zdWJzY3JpYmVGcm9tVHJhbnNmZXJzKCkpO1xuICAgICAgICB9LFxuICAgICAgICBzdWJzY3JpYmVUb1RyYW5zZmVycygpIHtcbiAgICAgICAgICBjb25zdCB7IGxjYSwgcmVnOiBjYWNoZWRSZWcgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKGNhY2hlZFJlZykge1xuICAgICAgICAgICAgcmV0dXJuIHdoZW4oY2FjaGVkUmVnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgeyB0YXAgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IHJlZyA9IHdhdGNoKEUobGNhKS5tb25pdG9yVHJhbnNmZXJzKHRhcCkpO1xuICAgICAgICAgIHRoaXMuc3RhdGUucmVnID0gcmVnO1xuICAgICAgICAgIHJldHVybiB3aGVuKHJlZyk7XG4gICAgICAgIH0sXG4gICAgICAgIHVuc3Vic2NyaWJlRnJvbVRyYW5zZmVycygpIHtcbiAgICAgICAgICBjb25zdCB7IHJlZywgbW9uaXRvciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoIXJlZyB8fCBtb25pdG9yKSB7XG4gICAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgZmluaXNoKGNvbnRleHQpIHtcbiAgICAgICAgdm9pZCBjb250ZXh0LmZhY2V0cy51dGlscy5zdWJzY3JpYmVUb1RyYW5zZmVycygpO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgbWFrZVBhY2tldFRvb2xzID0gcGlja0ZhY2V0MyhtYWtlUGFja2V0VG9vbHNLaXQsIFwicHVibGljXCIpO1xuICByZXR1cm4gbWFrZVBhY2tldFRvb2xzO1xufTtcbmhhcmRlbihwcmVwYXJlUGFja2V0VG9vbHMpO1xuXG4vL1xudmFyIElDUzIwX1RSQU5TRkVSX1NVQ0NFU1NfUkVTVUxUID0gXCJBUT09XCI7XG52YXIgdHJhY2UzID0gbWFrZVRyYWNlcjIoXCJJQkNQXCIpO1xudmFyIHsgRmFpbDogRmFpbDYsIGJhcmU6IGJhcmUzIH0gPSBhc3NlcnQ7XG52YXIgeyBWb3ckOiBWb3ckNCB9ID0gU2hhcGU7XG52YXIgY3JlYXRlU2VxdWVuY2VQYXR0ZXJuID0gKHNlcXVlbmNlKSA9PiB7XG4gIGNvbnN0IHNlcXVlbmNlUGF0dGVybnMgPSBbXTtcbiAgdHJ5IHtcbiAgICBjb25zdCBiaW50U2VxdWVuY2UgPSBCaWdJbnQoc2VxdWVuY2UpO1xuICAgIGJpbnRTZXF1ZW5jZSA+IDBuICYmIHNlcXVlbmNlUGF0dGVybnMucHVzaChiaW50U2VxdWVuY2UpO1xuICB9IGNhdGNoIChlMikge1xuICB9XG4gIGNvbnN0IG51bVNlcXVlbmNlID0gTnVtYmVyKHNlcXVlbmNlKTtcbiAgbnVtU2VxdWVuY2UgPiAwICYmIE51bWJlci5pc1NhZmVJbnRlZ2VyKG51bVNlcXVlbmNlKSAmJiBzZXF1ZW5jZVBhdHRlcm5zLnB1c2gobnVtU2VxdWVuY2UpO1xuICBjb25zdCBzdHJTZXF1ZW5jZSA9IFN0cmluZyhzZXF1ZW5jZSk7XG4gIHN0clNlcXVlbmNlICYmIHNlcXVlbmNlUGF0dGVybnMucHVzaChzdHJTZXF1ZW5jZSk7XG4gIGlmICghc2VxdWVuY2VQYXR0ZXJucy5maW5kKChzZXEpID0+IHNlcSA9PT0gc2VxdWVuY2UpKSB7XG4gICAgc2VxdWVuY2VQYXR0ZXJucy5wdXNoKHNlcXVlbmNlKTtcbiAgfVxuICBzd2l0Y2ggKHNlcXVlbmNlUGF0dGVybnMubGVuZ3RoKSB7XG4gICAgY2FzZSAwOlxuICAgICAgdGhyb3cgRmFpbDZgc2VxdWVuY2UgJHtzZXF1ZW5jZX0gaXMgbm90IHZhbGlkYDtcbiAgICBjYXNlIDE6XG4gICAgICByZXR1cm4gc2VxdWVuY2VQYXR0ZXJuc1swXTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIE0ub3IoLi4uc2VxdWVuY2VQYXR0ZXJucyk7XG4gIH1cbn07XG5oYXJkZW4oY3JlYXRlU2VxdWVuY2VQYXR0ZXJuKTtcbnZhciBwcmVwYXJlSUJDVHJhbnNmZXJTZW5kZXIgPSAoem9uZSwgeyB3YXRjaCwgbWFrZUlCQ1JlcGx5S2l0IH0pID0+IHtcbiAgY29uc3QgbWFrZUlCQ1RyYW5zZmVyU2VuZGVyS2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIklCQ1RyYW5zZmVyU2VuZGVyS2l0XCIsXG4gICAge1xuICAgICAgcHVibGljOiBNLmludGVyZmFjZShcIklCQ1RyYW5zZmVyU2VuZGVyXCIsIHtcbiAgICAgICAgc2VuZFBhY2tldDogTS5jYWxsKFZvdyQ0KE0uYW55KCkpLCBNLmFueSgpKS5yZXR1cm5zKFZvdyQ0KE0ucmVjb3JkKCkpKVxuICAgICAgfSksXG4gICAgICByZXNwb25zZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicmVzcG9uc2VXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChbTS5yZWNvcmQoKV0sIE0ucmVjb3JkKCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgdmVyaWZ5VHJhbnNmZXJTdWNjZXNzOiBNLmludGVyZmFjZShcInZlcmlmeVRyYW5zZmVyU3VjY2Vzc1wiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucygpXG4gICAgICB9KVxuICAgIH0sXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgICh0eEV4ZWN1dG9yLCB0cmFuc2Zlck1zZykgPT4gKHtcbiAgICAgIHR4RXhlY3V0b3IsXG4gICAgICB0cmFuc2Zlck1zZzogaGFyZGVuKHRyYW5zZmVyTXNnKVxuICAgIH0pLFxuICAgIHtcbiAgICAgIHB1YmxpYzoge1xuICAgICAgICAvKlxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBzZW5kUGFja2V0KG1hdGNoLCBvcHRzKSB7XG4gICAgICAgICAgY29uc3QgeyB0eEV4ZWN1dG9yLCB0cmFuc2Zlck1zZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKHR4RXhlY3V0b3IpLmV4ZWN1dGVUeChbdHJhbnNmZXJNc2ddKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJlc3BvbnNlV2F0Y2hlcixcbiAgICAgICAgICAgIHsgb3B0cywgbWF0Y2ggfVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXNwb25zZVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFt7IHNlcXVlbmNlIH1dLCBjdHgpIHtcbiAgICAgICAgICBjb25zdCB7IG1hdGNoLCBvcHRzIH0gPSBjdHg7XG4gICAgICAgICAgY29uc3QgeyB0cmFuc2Zlck1zZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICB0cmFjZTMoXCJzZXF1ZW5jZVwiLCBzZXF1ZW5jZSwgdHJhbnNmZXJNc2cpO1xuICAgICAgICAgIGNvbnN0IHJlcGx5UGFja2V0UGF0dGVybiA9IE0uc3BsaXRSZWNvcmQoe1xuICAgICAgICAgICAgc291cmNlX3BvcnQ6IHRyYW5zZmVyTXNnLnNvdXJjZVBvcnQsXG4gICAgICAgICAgICBzb3VyY2VfY2hhbm5lbDogdHJhbnNmZXJNc2cuc291cmNlQ2hhbm5lbCxcbiAgICAgICAgICAgIHNlcXVlbmNlOiBjcmVhdGVTZXF1ZW5jZVBhdHRlcm4oc2VxdWVuY2UpXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3QgeyByZXN1bHRWOiBhY2tEYXRhViwgLi4ucmVzdCB9ID0gbWFrZUlCQ1JlcGx5S2l0KFxuICAgICAgICAgICAgcmVwbHlQYWNrZXRQYXR0ZXJuLFxuICAgICAgICAgICAgbWF0Y2gsXG4gICAgICAgICAgICB7IG9wTmFtZTogXCJ0cmFuc2ZlclwiLCAuLi5vcHRzIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdFYgPSB3YXRjaChhY2tEYXRhViwgdGhpcy5mYWNldHMudmVyaWZ5VHJhbnNmZXJTdWNjZXNzKTtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgcmVzdWx0ViwgLi4ucmVzdCB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHZlcmlmeVRyYW5zZmVyU3VjY2Vzczoge1xuICAgICAgICBvbkZ1bGZpbGxlZChhY2tEYXRhKSB7XG4gICAgICAgICAgbGV0IG9iajtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2JqID0gSlNPTi5wYXJzZShhY2tEYXRhKTtcbiAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgIEZhaWw2YElDUzIwLTEgdHJhbnNmZXIgYWNrIGRhdGEgaXMgbm90IEpTT046ICR7YWNrRGF0YX1gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCB7IHJlc3VsdCwgZXJyb3IgfSA9IG9iajtcbiAgICAgICAgICBlcnJvciA9PT0gdm9pZCAwIHx8IEZhaWw2YElDUzIwLTEgdHJhbnNmZXIgZXJyb3IgJHtlcnJvcn1gO1xuICAgICAgICAgIHJlc3VsdCA/PyBGYWlsNmBNaXNzaW5nIHJlc3VsdCBpbiBJQ1MyMC0xIHRyYW5zZmVyIGFjayAke29ian1gO1xuICAgICAgICAgIGlmIChyZXN1bHQgPT09IElDUzIwX1RSQU5TRkVSX1NVQ0NFU1NfUkVTVUxUKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGRlY29kZUFuZFBhcnNlID0gKGI2NCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoYXRvYihiNjQpKTtcbiAgICAgICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgICAgICBGYWlsNmBEZWNvZGluZyBvZiBiYXNlNjQtZW5jb2RlZCBhY2sgb2JqIG9iamVjdCBmYWlsZWQ6ICR7SlNPTi5zdHJpbmdpZnkoYjY0KX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgICAgY29uc3Qgb3V0ZXJEZWNvZGVkID0gZGVjb2RlQW5kUGFyc2UocmVzdWx0KTtcbiAgICAgICAgICBjb25zdCBpYmNBY2sgPSBvdXRlckRlY29kZWQ/LmliY19hY2sgJiYgZGVjb2RlQW5kUGFyc2Uob3V0ZXJEZWNvZGVkLmliY19hY2spO1xuICAgICAgICAgIGliY0Fjaz8ucmVzdWx0ID09PSBJQ1MyMF9UUkFOU0ZFUl9TVUNDRVNTX1JFU1VMVCB8fCBGYWlsNmBJQ1MyMC0xIHRyYW5zZmVyIHVuc3VjY2Vzc2Z1bCB3aXRoIGFjayByZXN1bHQ6ICR7b3V0ZXJEZWNvZGVkfWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiAoLi4uYXJncykgPT4gbWFrZUlCQ1RyYW5zZmVyU2VuZGVyS2l0KC4uLmFyZ3MpLnB1YmxpYztcbn07XG5oYXJkZW4ocHJlcGFyZUlCQ1RyYW5zZmVyU2VuZGVyKTtcbnZhciBwcmVwYXJlSUJDUmVwbHlLaXQgPSAoem9uZSwgdm93VG9vbHMpID0+IHtcbiAgY29uc3QgeyB3YXRjaCB9ID0gdm93VG9vbHM7XG4gIGNvbnN0IGliY1dhdGNoZXIgPSB6b25lLmV4byhcbiAgICBcImliY1Jlc3VsdFdhdGNoZXJcIixcbiAgICBNLmludGVyZmFjZShcInByb2Nlc3NJQkNXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoXG4gICAgICAgIE0uc3BsaXRSZWNvcmQoeyBldmVudDogTS5zdHJpbmcoKSB9LCB7IGFja25vd2xlZGdlbWVudDogTS5zdHJpbmcoKSB9KSxcbiAgICAgICAgTS5zcGxpdFJlY29yZCh7fSwgeyBvcE5hbWU6IE0uc3RyaW5nKCksIHRpbWVvdXQ6IE0ucmVjb3JkKCkgfSlcbiAgICAgICkucmV0dXJucyhWb3ckNChNLnN0cmluZygpKSlcbiAgICB9KSxcbiAgICB7XG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChpYmNFdmVudCwgeyBvcE5hbWUgPSBcInVua25vd25cIiB9KSB7XG4gICAgICAgIGNvbnN0IHsgZXZlbnQgfSA9IGliY0V2ZW50O1xuICAgICAgICBzd2l0Y2ggKGV2ZW50KSB7XG4gICAgICAgICAgY2FzZSBcImFja25vd2xlZGdlbWVudFBhY2tldFwiOiB7XG4gICAgICAgICAgICBjb25zdCB7IGFja25vd2xlZGdlbWVudCB9ID0gaWJjRXZlbnQ7XG4gICAgICAgICAgICBhY2tub3dsZWRnZW1lbnQgfHwgRmFpbDZgYWNrbm93bGVkZ2VtZW50UGFja2V0IG1pc3NpbmcgJ2Fja25vd2xlZGdlbWVudCdgO1xuICAgICAgICAgICAgcmV0dXJuIGJhc2U2NFRvQnl0ZXMoYWNrbm93bGVkZ2VtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBcInRpbWVvdXRQYWNrZXRcIjpcbiAgICAgICAgICAgIHRocm93IEZhaWw2YCR7YmFyZTMob3BOYW1lKX0gb3BlcmF0aW9uIHJlY2VpdmVkIHRpbWVvdXQgcGFja2V0YDtcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhyb3cgRmFpbDZgVW5leHBlY3RlZCBldmVudDogJHtldmVudH1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlSUJDUmVwbHlLaXQgPSAocmVwbHlQYWNrZXRQYXR0ZXJuLCBtYXRjaFYsIG9wdHMpID0+IHtcbiAgICBjb25zdCBldmVudFBhdHRlcm4gPSBNLm9yKFxuICAgICAgTS5zcGxpdFJlY29yZCh7XG4gICAgICAgIGV2ZW50OiBcImFja25vd2xlZGdlbWVudFBhY2tldFwiLFxuICAgICAgICBwYWNrZXQ6IHJlcGx5UGFja2V0UGF0dGVybixcbiAgICAgICAgYWNrbm93bGVkZ2VtZW50OiBNLnN0cmluZygpXG4gICAgICB9KSxcbiAgICAgIE0uc3BsaXRSZWNvcmQoe1xuICAgICAgICBldmVudDogXCJ0aW1lb3V0UGFja2V0XCIsXG4gICAgICAgIHBhY2tldDogcmVwbHlQYWNrZXRQYXR0ZXJuXG4gICAgICB9KVxuICAgICk7XG4gICAgY29uc3QgcmVzdWx0ViA9IHdhdGNoKG1hdGNoViwgaWJjV2F0Y2hlciwgb3B0cyk7XG4gICAgcmV0dXJuIGhhcmRlbih7IGV2ZW50UGF0dGVybiwgcmVzdWx0ViB9KTtcbiAgfTtcbiAgcmV0dXJuIG1ha2VJQkNSZXBseUtpdDtcbn07XG5oYXJkZW4ocHJlcGFyZUlCQ1JlcGx5S2l0KTtcbnZhciBwcmVwYXJlSUJDVG9vbHMgPSAoem9uZSwgdm93VG9vbHMpID0+IHtcbiAgY29uc3QgbWFrZUlCQ1JlcGx5S2l0ID0gcHJlcGFyZUlCQ1JlcGx5S2l0KHpvbmUsIHZvd1Rvb2xzKTtcbiAgY29uc3QgbWFrZUlCQ1RyYW5zZmVyU2VuZGVyID0gcHJlcGFyZUlCQ1RyYW5zZmVyU2VuZGVyKHpvbmUsIHtcbiAgICBtYWtlSUJDUmVwbHlLaXQsXG4gICAgLi4udm93VG9vbHNcbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oeyBtYWtlSUJDVHJhbnNmZXJTZW5kZXIsIG1ha2VJQkNSZXBseUtpdCB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZUlCQ1Rvb2xzKTtcblxuLy9cbnZhciBNc2dUcmFuc2ZlcjMgPSBDb2RlY0hlbHBlcihNc2dUcmFuc2Zlcik7XG52YXIgUXVlcnlEZW5vbUhhc2hSZXF1ZXN0MiA9IENvZGVjSGVscGVyKFF1ZXJ5RGVub21IYXNoUmVxdWVzdCk7XG52YXIgUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3QzID0gQ29kZWNIZWxwZXIoUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3QpO1xudmFyIFF1ZXJ5QmFsYW5jZVJlcXVlc3QzID0gQ29kZWNIZWxwZXIoUXVlcnlCYWxhbmNlUmVxdWVzdCk7XG52YXIgTXNnRGVsZWdhdGUzID0gQ29kZWNIZWxwZXIoTXNnRGVsZWdhdGUpO1xudmFyIE1zZ1VuZGVsZWdhdGUzID0gQ29kZWNIZWxwZXIoTXNnVW5kZWxlZ2F0ZSk7XG52YXIgTXNnU2VuZDMgPSBDb2RlY0hlbHBlcihNc2dTZW5kKTtcbnZhciB0cmFjZTQgPSBtYWtlVHJhY2VyMihcIkxvY2FsT3JjaEFjY291bnRcIik7XG52YXIgeyBWb3ckOiBWb3ckNSB9ID0gU2hhcGU7XG52YXIgRVZvdyQyID0gKHNoYXBlKSA9PiBNLm9yKFZvdyQ1KHNoYXBlKSwgTS5wcm9taXNlKFxuICAvKiAgICAgICAqL1xuKSk7XG52YXIgSG9sZGVySSA9IE0uaW50ZXJmYWNlKFwiaG9sZGVyXCIsIHtcbiAgLi4ub3JjaGVzdHJhdGlvbkFjY291bnRNZXRob2RzLFxuICBkZWxlZ2F0ZTogTS5jYWxsKE0uc3RyaW5nKCksIEFtb3VudFNoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgdW5kZWxlZ2F0ZTogTS5jYWxsKE0uc3RyaW5nKCksIEFtb3VudFNoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZGVwb3NpdDogTS5jYWxsKFBheW1lbnRTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIHdpdGhkcmF3OiBNLmNhbGwoQW1vdW50U2hhcGUpLnJldHVybnMoVm93JDUoUGF5bWVudFNoYXBlKSksXG4gIGV4ZWN1dGVUeDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhWb3ckNShNLnJlY29yZCgpKSksXG4gIHNlbmRUaGVuV2FpdEZvckFjazogTS5jYWxsKEVWb3ckMihNLnJlbW90YWJsZShcIlBhY2tldFNlbmRlclwiKSkpLm9wdGlvbmFsKE0uYW55KCkpLnJldHVybnMoRVZvdyQyKE0uc3RyaW5nKCkpKSxcbiAgbWF0Y2hGaXJzdFBhY2tldDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoRVZvdyQyKE0uYW55KCkpKSxcbiAgbW9uaXRvclRyYW5zZmVyczogTS5jYWxsKE0ucmVtb3RhYmxlKFwiVGFyZ2V0QXBwXCIpKS5yZXR1cm5zKEVWb3ckMihNLmFueSgpKSksXG4gIHBhcnNlSW5ib3VuZFRyYW5zZmVyOiBNLmNhbGwoTS5yZWNvcmRPZihNLnN0cmluZygpLCBNLmFueSgpKSkucmV0dXJucyhcbiAgICBWb3ckNSh7XG4gICAgICBhbW91bnQ6IERlbm9tQW1vdW50U2hhcGUsXG4gICAgICBmcm9tQWNjb3VudDogTS5zdHJpbmcoKSxcbiAgICAgIHRvQWNjb3VudDogTS5zdHJpbmcoKSxcbiAgICAgIGV4dHJhOiBNLnJlY29yZE9mKE0uc3RyaW5nKCksIE0uYW55KCkpXG4gICAgfSlcbiAgKVxufSk7XG52YXIgUFVCTElDX1RPUElDUzIgPSB7XG4gIGFjY291bnQ6IFtcIkFjY291bnQgaG9sZGVyIHN0YXR1c1wiLCBNLmFueSgpXVxufTtcbnZhciBwcmVwYXJlTG9jYWxPcmNoZXN0cmF0aW9uQWNjb3VudEtpdCA9ICh6b25lLCB7XG4gIG1ha2VSZWNvcmRlcktpdCxcbiAgemNmLFxuICB0aW1lclNlcnZpY2UsXG4gIHZvd1Rvb2xzLFxuICBjaGFpbkh1YixcbiAgbG9jYWxjaGFpbixcbiAgem9lVG9vbHNcbn0pID0+IHtcbiAgY29uc3QgeyB3YXRjaCwgYXNWb3csIHdoZW4gfSA9IHZvd1Rvb2xzO1xuICBjb25zdCB7IG1ha2VJQkNUcmFuc2ZlclNlbmRlciB9ID0gcHJlcGFyZUlCQ1Rvb2xzKFxuICAgIHpvbmUuc3ViWm9uZShcImliY1Rvb2xzXCIpLFxuICAgIHZvd1Rvb2xzXG4gICk7XG4gIGNvbnN0IG1ha2VQYWNrZXRUb29scyA9IHByZXBhcmVQYWNrZXRUb29scyhcbiAgICB6b25lLnN1YlpvbmUoXCJwYWNrZXRUb29sc1wiKSxcbiAgICB2b3dUb29sc1xuICApO1xuICBjb25zdCB0aW1lc3RhbXBIZWxwZXIgPSBtYWtlVGltZXN0YW1wSGVscGVyKHRpbWVyU2VydmljZSk7XG4gIGNvbnN0IG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIkxvY2FsIE9yY2hlc3RyYXRpb24gQWNjb3VudCBLaXRcIixcbiAgICB7XG4gICAgICBoZWxwZXI6IE0uaW50ZXJmYWNlKFwiaGVscGVyXCIsIHtcbiAgICAgICAgYW1vdW50VG9Db2luOiBNLmNhbGwoQW1vdW50QXJnU2hhcGUpLnJldHVybnMoTS5yZWNvcmQoKSlcbiAgICAgIH0pLFxuICAgICAgaG9sZGVyOiBIb2xkZXJJLFxuICAgICAgdW5kZWxlZ2F0ZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwidW5kZWxlZ2F0ZVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKFtcbiAgICAgICAgICBNLnNwbGl0UmVjb3JkKHsgY29tcGxldGlvblRpbWU6IFRpbWVzdGFtcFByb3RvU2hhcGUgfSlcbiAgICAgICAgXSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKFZvd1NoYXBlKVxuICAgICAgfSksXG4gICAgICB0cmFuc2ZlcldhdGNoZXI6IE0uaW50ZXJmYWNlKFwidHJhbnNmZXJXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLm5hdCgpKS5vcHRpb25hbCh7XG4gICAgICAgICAgb3B0czogTS5vcihNLnVuZGVmaW5lZCgpLCBJQkNUcmFuc2Zlck9wdGlvbnNTaGFwZSksXG4gICAgICAgICAgcm91dGU6IFRyYW5zZmVyUm91dGVTaGFwZVxuICAgICAgICB9KS5yZXR1cm5zKFZvdyQ1KE0ucmVjb3JkKCkpKVxuICAgICAgfSksXG4gICAgICBleHRyYWN0Rmlyc3RSZXN1bHRXYXRjaGVyOiBNLmludGVyZmFjZShcImV4dHJhY3RGaXJzdFJlc3VsdFdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKFtNLnJlY29yZCgpXSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHJldHVyblZvaWRXYXRjaGVyOiBNLmludGVyZmFjZShcInJldHVyblZvaWRXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5vcHRpb25hbChNLmFueSgpKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpXG4gICAgICB9KSxcbiAgICAgIHNlYXRFeGl0ZXJIYW5kbGVyOiBNLmludGVyZmFjZShcInNlYXRFeGl0ZXJIYW5kbGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnVuZGVmaW5lZCgpLCBNLnJlbW90YWJsZSgpKS5yZXR1cm5zKFxuICAgICAgICAgIE0udW5kZWZpbmVkKClcbiAgICAgICAgKSxcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uZXJyb3IoKSwgTS5yZW1vdGFibGUoKSkucmV0dXJucyhNLnVuZGVmaW5lZCgpKVxuICAgICAgfSksXG4gICAgICBnZXRCYWxhbmNlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJnZXRCYWxhbmNlV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoQW1vdW50U2hhcGUsIERlbm9tU2hhcGUpLnJldHVybnMoRGVub21BbW91bnRTaGFwZSlcbiAgICAgIH0pLFxuICAgICAgcXVlcnlCYWxhbmNlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJxdWVyeUJhbGFuY2VXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChUeXBlZEpzb25TaGFwZSkucmV0dXJucyhEZW5vbUFtb3VudFNoYXBlKVxuICAgICAgfSksXG4gICAgICBxdWVyeUJhbGFuY2VzV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJxdWVyeUJhbGFuY2VzV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoVHlwZWRKc29uU2hhcGUpLnJldHVybnMoXG4gICAgICAgICAgTS5hcnJheU9mKERlbm9tQW1vdW50U2hhcGUpXG4gICAgICAgIClcbiAgICAgIH0pLFxuICAgICAgcGFyc2VJbmJvdW5kVHJhbnNmZXJXYXRjaGVyOiBNLmludGVyZmFjZShcInBhcnNlSW5ib3VuZFRyYW5zZmVyV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5yZWNvcmQoKSwgTS5yZWNvcmQoKSkucmV0dXJucyhNLnJlY29yZCgpKSxcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uYW55KCksIE0ucmVjb3JkKCkpLnJldHVybnMoTS5yZWNvcmQoKSlcbiAgICAgIH0pLFxuICAgICAgaW52aXRhdGlvbk1ha2VyczogTS5pbnRlcmZhY2UoXCJpbnZpdGF0aW9uTWFrZXJzXCIsIHtcbiAgICAgICAgQ2xvc2VBY2NvdW50OiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgICAgRGVsZWdhdGU6IE0uY2FsbChNLnN0cmluZygpLCBBbW91bnRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIERlcG9zaXQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICBTZW5kOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgICAgU2VuZEFsbDogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIFRyYW5zZmVyOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgICAgVW5kZWxlZ2F0ZTogTS5jYWxsKE0uc3RyaW5nKCksIEFtb3VudFNoYXBlKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgICAgV2l0aGRyYXc6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpXG4gICAgICB9KVxuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG4gICAgICovXG4gICAgKHsgYWNjb3VudCwgYWRkcmVzcywgc3RvcmFnZU5vZGUgfSkgPT4ge1xuICAgICAgY29uc3QgdG9waWNLaXQgPSBzdG9yYWdlTm9kZSA/IG1ha2VSZWNvcmRlcktpdChzdG9yYWdlTm9kZSwgUFVCTElDX1RPUElDUzIuYWNjb3VudFsxXSkgOiB2b2lkIDA7XG4gICAgICBpZiAodG9waWNLaXQpIHtcbiAgICAgICAgdm9pZCBFKHRvcGljS2l0LnJlY29yZGVyKS53cml0ZShcIlwiKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHBhY2tldFRvb2xzID0gbWFrZVBhY2tldFRvb2xzKGFjY291bnQpO1xuICAgICAgcmV0dXJuIHsgYWNjb3VudCwgYWRkcmVzcywgcGFja2V0VG9vbHMsIHRvcGljS2l0IH07XG4gICAgfSxcbiAgICB7XG4gICAgICBoZWxwZXI6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBhbW91bnRUb0NvaW4oYW1vdW50KSB7XG4gICAgICAgICAgcmV0dXJuIGNvZXJjZUNvaW4oY2hhaW5IdWIsIGFtb3VudCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBpbnZpdGF0aW9uTWFrZXJzOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgRGVsZWdhdGUodmFsaWRhdG9yQWRkcmVzcywgZXJ0cEFtb3VudCkge1xuICAgICAgICAgIHRyYWNlNChcIkRlbGVnYXRlXCIsIHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5ob2xkZXIuZGVsZWdhdGUodmFsaWRhdG9yQWRkcmVzcywgZXJ0cEFtb3VudClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSwgXCJEZWxlZ2F0ZVwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgRGVwb3NpdCgpIHtcbiAgICAgICAgICB0cmFjZTQoXCJEZXBvc2l0XCIpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oXG4gICAgICAgICAgICAoc2VhdCkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCB7IGdpdmUgfSA9IHNlYXQuZ2V0UHJvcG9zYWwoKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICAgIHpvZVRvb2xzLmxvY2FsVHJhbnNmZXIoXG4gICAgICAgICAgICAgICAgICBzZWF0LFxuICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUuYWNjb3VudCxcbiAgICAgICAgICAgICAgICAgIGdpdmVcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnNlYXRFeGl0ZXJIYW5kbGVyLFxuICAgICAgICAgICAgICAgIHNlYXRcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIkRlcG9zaXRcIixcbiAgICAgICAgICAgIHZvaWQgMCxcbiAgICAgICAgICAgIE0uc3BsaXRSZWNvcmQoeyBnaXZlOiBBbnlOYXRBbW91bnRzUmVjb3JkLCB3YW50OiB7fSB9KVxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgVW5kZWxlZ2F0ZSh2YWxpZGF0b3JBZGRyZXNzLCBlcnRwQW1vdW50KSB7XG4gICAgICAgICAgdHJhY2U0KFwiVW5kZWxlZ2F0ZVwiLCB2YWxpZGF0b3JBZGRyZXNzLCBlcnRwQW1vdW50KTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKChzZWF0KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMuaG9sZGVyLnVuZGVsZWdhdGUodmFsaWRhdG9yQWRkcmVzcywgZXJ0cEFtb3VudClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSwgXCJVbmRlbGVnYXRlXCIpO1xuICAgICAgICB9LFxuICAgICAgICBDbG9zZUFjY291bnQoKSB7XG4gICAgICAgICAgdGhyb3cgRXJyb3IoXCJub3QgeWV0IGltcGxlbWVudGVkXCIpO1xuICAgICAgICB9LFxuICAgICAgICBTZW5kKCkge1xuICAgICAgICAgIGNvbnN0IG9mZmVySGFuZGxlciA9IChzZWF0LCB7IHRvQWNjb3VudCwgYW1vdW50IH0pID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci5zZW5kKHRvQWNjb3VudCwgYW1vdW50KSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKG9mZmVySGFuZGxlciwgXCJTZW5kXCIpO1xuICAgICAgICB9LFxuICAgICAgICBTZW5kQWxsKCkge1xuICAgICAgICAgIGNvbnN0IG9mZmVySGFuZGxlciA9IChzZWF0LCB7IHRvQWNjb3VudCwgYW1vdW50cyB9KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy5ob2xkZXIuc2VuZEFsbCh0b0FjY291bnQsIGFtb3VudHMpKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24ob2ZmZXJIYW5kbGVyLCBcIlNlbmRBbGxcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFRyYW5zZmVyKCkge1xuICAgICAgICAgIGNvbnN0IG9mZmVySGFuZGxlciA9IChzZWF0LCB7IGFtb3VudCwgZGVzdGluYXRpb24sIG9wdHMgfSkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLmhvbGRlci50cmFuc2ZlcihkZXN0aW5hdGlvbiwgYW1vdW50LCBvcHRzKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24ob2ZmZXJIYW5kbGVyLCBcIlRyYW5zZmVyXCIpO1xuICAgICAgICB9LFxuICAgICAgICBXaXRoZHJhdygpIHtcbiAgICAgICAgICB0cmFjZTQoXCJXaXRoZHJhd1wiKTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKFxuICAgICAgICAgICAgKHNlYXQpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgeyB3YW50IH0gPSBzZWF0LmdldFByb3Bvc2FsKCk7XG4gICAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgICB6b2VUb29scy53aXRoZHJhd1RvU2VhdChcbiAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLmFjY291bnQsXG4gICAgICAgICAgICAgICAgICBzZWF0LFxuICAgICAgICAgICAgICAgICAgd2FudFxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgdGhpcy5mYWNldHMuc2VhdEV4aXRlckhhbmRsZXIsXG4gICAgICAgICAgICAgICAgc2VhdFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiV2l0aGRyYXdcIixcbiAgICAgICAgICAgIHZvaWQgMCxcbiAgICAgICAgICAgIE0uc3BsaXRSZWNvcmQoeyBnaXZlOiB7fSwgd2FudDogQW55TmF0QW1vdW50c1JlY29yZCB9KVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB1bmRlbGVnYXRlV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3BvbnNlKSB7XG4gICAgICAgICAgY29uc3QgeyBjb21wbGV0aW9uVGltZSB9ID0gcmVzcG9uc2VbMF07XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgRSh0aW1lclNlcnZpY2UpLndha2VBdChcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgQmlnSW50KGNvbXBsZXRpb25UaW1lLnNlY29uZHMpICsgbWF4Q2xvY2tTa2V3XG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXJcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdHJhbnNmZXJXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQodGltZW91dFRpbWVzdGFtcCwgeyBvcHRzLCByb3V0ZSB9KSB7XG4gICAgICAgICAgY29uc3QgeyBmb3J3YXJkSW5mbywgLi4udHJhbnNmZXJEZXRhaWxzIH0gPSByb3V0ZTtcbiAgICAgICAgICBsZXQgbWVtbztcbiAgICAgICAgICBpZiAob3B0cyAmJiBcIm1lbW9cIiBpbiBvcHRzKSB7XG4gICAgICAgICAgICBtZW1vID0gb3B0cy5tZW1vO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZm9yd2FyZEluZm8pIHtcbiAgICAgICAgICAgIG1lbW8gPSBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIGZvcndhcmQ6IHtcbiAgICAgICAgICAgICAgICAuLi5mb3J3YXJkSW5mby5mb3J3YXJkLFxuICAgICAgICAgICAgICAgIG5leHQ6IG1lbW9cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHRyYW5zZmVyTXNnID0gTXNnVHJhbnNmZXIzLnR5cGVkSnNvbih7XG4gICAgICAgICAgICAuLi50cmFuc2ZlckRldGFpbHMsXG4gICAgICAgICAgICBzZW5kZXI6IHRoaXMuc3RhdGUuYWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgIHRpbWVvdXRIZWlnaHQ6IG9wdHM/LnRpbWVvdXRIZWlnaHQsXG4gICAgICAgICAgICB0aW1lb3V0VGltZXN0YW1wLFxuICAgICAgICAgICAgbWVtb1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IHsgaG9sZGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCBzZW5kZXIgPSBtYWtlSUJDVHJhbnNmZXJTZW5kZXIoXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGhvbGRlcixcbiAgICAgICAgICAgIHRyYW5zZmVyTXNnXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gaG9sZGVyLnNlbmRUaGVuV2FpdEZvckFjayhzZW5kZXIpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIGV4dHJhY3RGaXJzdFJlc3VsdFdhdGNoZXI6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0cykge1xuICAgICAgICAgIHJlc3VsdHMubGVuZ3RoID09PSAxIHx8IHRocm93UmVkYWN0ZWRgZXhwZWN0ZWQgZXhhY3RseSBvbmUgcmVzdWx0OyBnb3QgJHtyZXN1bHRzfWA7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdHNbMF07XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXR1cm5Wb2lkV2F0Y2hlcjoge1xuICAgICAgICBvbkZ1bGZpbGxlZCgpIHtcbiAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIGdldEJhbGFuY2VXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChuYXRBbW91bnQsIGRlbm9tKSB7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRlbm9tLCB2YWx1ZTogbmF0QW1vdW50LnZhbHVlIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHNlYXRFeGl0ZXJIYW5kbGVyOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoXywgc2VhdCkge1xuICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uUmVqZWN0ZWQocmVhc29uLCBzZWF0KSB7XG4gICAgICAgICAgc2VhdC5leGl0KHJlYXNvbik7XG4gICAgICAgICAgdGhyb3cgcmVhc29uO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIHF1ZXJ5QmFsYW5jZVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0KSB7XG4gICAgICAgICAgY29uc3QgeyBiYWxhbmNlIH0gPSByZXN1bHQ7XG4gICAgICAgICAgaWYgKCFiYWxhbmNlIHx8ICFiYWxhbmNlPy5kZW5vbSkge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCBiYWxhbmNlICR7cXVvdGUocmVzdWx0KX07YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih0b0Rlbm9tQW1vdW50KGJhbGFuY2UpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICBxdWVyeUJhbGFuY2VzV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0KSB7XG4gICAgICAgICAgY29uc3QgeyBiYWxhbmNlcyB9ID0gcmVzdWx0O1xuICAgICAgICAgIGlmICghYmFsYW5jZXMgfHwgIUFycmF5LmlzQXJyYXkoYmFsYW5jZXMpKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkIGJhbGFuY2VzICR7cXVvdGUocmVzdWx0KX07YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbihiYWxhbmNlcy5tYXAodG9EZW5vbUFtb3VudCkpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcGFyc2VJbmJvdW5kVHJhbnNmZXJXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKGxvY2FsRGVub21IYXNoLCBuYWl2ZVJlc3VsdCkge1xuICAgICAgICAgIGNvbnN0IGxvY2FsRGVub20gPSBgaWJjLyR7bG9jYWxEZW5vbUhhc2guaGFzaH1gO1xuICAgICAgICAgIGNvbnN0IHsgYW1vdW50LCAuLi5yZXN0IH0gPSBuYWl2ZVJlc3VsdDtcbiAgICAgICAgICBjb25zdCB7IGRlbm9tOiBfLCAuLi5hbW91bnRSZXN0IH0gPSBhbW91bnQ7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgYW1vdW50OiB7IC4uLmFtb3VudFJlc3QsIGRlbm9tOiBsb2NhbERlbm9tIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25SZWplY3RlZChyZWFzb24sIG5haXZlUmVzdWx0KSB7XG4gICAgICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEVycm9yICYmIFN0cmluZyhyZWFzb24ubWVzc2FnZSkuaW5jbHVkZXMoXCJkZW5vbWluYXRpb24gdHJhY2Ugbm90IGZvdW5kXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmFpdmVSZXN1bHQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRocm93IHJlYXNvbjtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGhvbGRlcjoge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGFzQ29udGludWluZ09mZmVyKCkge1xuICAgICAgICAgIHJldHVybiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBudWxsO1xuICAgICAgICAgICAgY29uc3QgeyBob2xkZXIsIGludml0YXRpb25NYWtlcnM6IGltIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IGludml0YXRpb25NYWtlcnMgPSAoXG4gICAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICBpbVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICBwdWJsaWNTdWJzY3JpYmVyczogYXdhaXQgd2hlbihob2xkZXIuZ2V0UHVibGljVG9waWNzKCkpLFxuICAgICAgICAgICAgICBpbnZpdGF0aW9uTWFrZXJzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldEJhbGFuY2UoZGVub21BcmcpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgW2JyYW5kLCBkZW5vbV0gPSB0eXBlb2YgZGVub21BcmcgPT09IFwic3RyaW5nXCIgPyBbY2hhaW5IdWIuZ2V0QXNzZXQoZGVub21BcmcsIFwiYWdvcmljXCIpPy5icmFuZCwgZGVub21BcmddIDogW2Rlbm9tQXJnLCBjaGFpbkh1Yi5nZXREZW5vbShkZW5vbUFyZyldO1xuICAgICAgICAgICAgaWYgKCFkZW5vbSkge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYE5vIGRlbm9tIGZvciBicmFuZDogJHtkZW5vbUFyZ31gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGJyYW5kKSB7XG4gICAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgICBFKHRoaXMuc3RhdGUuYWNjb3VudCkuZ2V0QmFsYW5jZShicmFuZCksXG4gICAgICAgICAgICAgICAgdGhpcy5mYWNldHMuZ2V0QmFsYW5jZVdhdGNoZXIsXG4gICAgICAgICAgICAgICAgZGVub21cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRShsb2NhbGNoYWluKS5xdWVyeShcbiAgICAgICAgICAgICAgICBRdWVyeUJhbGFuY2VSZXF1ZXN0My50eXBlZEpzb24oe1xuICAgICAgICAgICAgICAgICAgYWRkcmVzczogdGhpcy5zdGF0ZS5hZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgZGVub21cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5xdWVyeUJhbGFuY2VXYXRjaGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldEJhbGFuY2VzKCkge1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIEUobG9jYWxjaGFpbikucXVlcnkoXG4gICAgICAgICAgICAgIFF1ZXJ5QWxsQmFsYW5jZXNSZXF1ZXN0My50eXBlZEpzb24oe1xuICAgICAgICAgICAgICAgIGFkZHJlc3M6IHRoaXMuc3RhdGUuYWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnF1ZXJ5QmFsYW5jZXNXYXRjaGVyXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0UHVibGljVG9waWNzKCkge1xuICAgICAgICAgIHJldHVybiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBudWxsO1xuICAgICAgICAgICAgY29uc3QgeyB0b3BpY0tpdCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghdG9waWNLaXQpIHRocm93IHRocm93UmVkYWN0ZWRgTm8gdG9waWNLaXQ7IHN0b3JhZ2VOb2RlIG5vdCBwcm92aWRlZGA7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgICAgICAgYWNjb3VudDoge1xuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBQVUJMSUNfVE9QSUNTMi5hY2NvdW50WzBdLFxuICAgICAgICAgICAgICAgIHN1YnNjcmliZXI6IHRvcGljS2l0LnN1YnNjcmliZXIsXG4gICAgICAgICAgICAgICAgc3RvcmFnZVBhdGg6IGF3YWl0IHRvcGljS2l0LnJlY29yZGVyLmdldFN0b3JhZ2VQYXRoKClcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vXG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgZGVsZWdhdGUodmFsaWRhdG9yQWRkcmVzcywgZXJ0cEFtb3VudCkge1xuICAgICAgICAgIGNvbnN0IHsgYWNjb3VudDogbGNhIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGNvbnN0IGFtb3VudCA9IGNvZXJjZUNvaW4oY2hhaW5IdWIsIGVydHBBbW91bnQpO1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIEUobGNhKS5leGVjdXRlVHgoW1xuICAgICAgICAgICAgICBNc2dEZWxlZ2F0ZTMudHlwZWRKc29uKHtcbiAgICAgICAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgICAgICAgdmFsaWRhdG9yQWRkcmVzcyxcbiAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiB0aGlzLnN0YXRlLmFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMuZXh0cmFjdEZpcnN0UmVzdWx0V2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vXG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICB1bmRlbGVnYXRlKHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpIHtcbiAgICAgICAgICBjb25zdCBhbW91bnQgPSBjb2VyY2VDb2luKGNoYWluSHViLCBlcnRwQW1vdW50KTtcbiAgICAgICAgICBjb25zdCB7IGFjY291bnQ6IGxjYSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKGxjYSkuZXhlY3V0ZVR4KFtcbiAgICAgICAgICAgICAgTXNnVW5kZWxlZ2F0ZTMudHlwZWRKc29uKHtcbiAgICAgICAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgICAgICAgdmFsaWRhdG9yQWRkcmVzcyxcbiAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiB0aGlzLnN0YXRlLmFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMudW5kZWxlZ2F0ZVdhdGNoZXJcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZGVwb3NpdChwYXltZW50KSB7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgRSh0aGlzLnN0YXRlLmFjY291bnQpLmRlcG9zaXQocGF5bWVudCksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB3aXRoZHJhdyhhbW91bnQpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goRSh0aGlzLnN0YXRlLmFjY291bnQpLndpdGhkcmF3KGFtb3VudCkpO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBleGVjdXRlVHgobWVzc2FnZXMpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goRSh0aGlzLnN0YXRlLmFjY291bnQpLmV4ZWN1dGVUeChtZXNzYWdlcykpO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldEFkZHJlc3MoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuYWRkcmVzcztcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHNlbmQodG9BY2NvdW50LCBhbW91bnQpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2U0KFwic2VuZFwiLCB0b0FjY291bnQsIGFtb3VudCk7XG4gICAgICAgICAgICBjb25zdCBjb3Ntb3NEZXN0ID0gY2hhaW5IdWIuY29lcmNlQ29zbW9zQWRkcmVzcyh0b0FjY291bnQpO1xuICAgICAgICAgICAgY29zbW9zRGVzdC5jaGFpbklkID09PSB0aGlzLnN0YXRlLmFkZHJlc3MuY2hhaW5JZCB8fCB0aHJvd1JlZGFjdGVkYGJhbmsvc2VuZCBjYW5ub3Qgc2VuZCB0byBhIGRpZmZlcmVudCBjaGFpbiAke3F1b3RlKGNvc21vc0Rlc3QuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRSh0aGlzLnN0YXRlLmFjY291bnQpLmV4ZWN1dGVUeChbXG4gICAgICAgICAgICAgICAgTXNnU2VuZDMudHlwZWRKc29uKHtcbiAgICAgICAgICAgICAgICAgIGFtb3VudDogW2hlbHBlci5hbW91bnRUb0NvaW4oYW1vdW50KV0sXG4gICAgICAgICAgICAgICAgICB0b0FkZHJlc3M6IGNvc21vc0Rlc3QudmFsdWUsXG4gICAgICAgICAgICAgICAgICBmcm9tQWRkcmVzczogdGhpcy5zdGF0ZS5hZGRyZXNzLnZhbHVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgc2VuZEFsbCh0b0FjY291bnQsIGFtb3VudHMpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2U0KFwic2VuZEFsbFwiLCB0b0FjY291bnQsIGFtb3VudHMpO1xuICAgICAgICAgICAgY29uc3QgeyBoZWxwZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICBFKHRoaXMuc3RhdGUuYWNjb3VudCkuZXhlY3V0ZVR4KFtcbiAgICAgICAgICAgICAgICBNc2dTZW5kMy50eXBlZEpzb24oe1xuICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnRzLm1hcCgoYTIpID0+IGhlbHBlci5hbW91bnRUb0NvaW4oYTIpKSxcbiAgICAgICAgICAgICAgICAgIHRvQWRkcmVzczogdG9BY2NvdW50LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgZnJvbUFkZHJlc3M6IHRoaXMuc3RhdGUuYWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgdHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwgb3B0cykge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTQoXCJUcmFuc2ZlcnJpbmcgZnVuZHMgb3ZlciBJQkNcIik7XG4gICAgICAgICAgICBjb25zdCBkZW5vbUFtb3VudCA9IGNvZXJjZURlbm9tQW1vdW50KGNoYWluSHViLCBhbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgeyBmb3J3YXJkT3B0cywgLi4ucmVzdCB9ID0gb3B0cyA/PyB7fTtcbiAgICAgICAgICAgIGNvbnN0IHJvdXRlID0gY2hhaW5IdWIubWFrZVRyYW5zZmVyUm91dGUoXG4gICAgICAgICAgICAgIGRlc3RpbmF0aW9uLFxuICAgICAgICAgICAgICBkZW5vbUFtb3VudCxcbiAgICAgICAgICAgICAgXCJhZ29yaWNcIixcbiAgICAgICAgICAgICAgZm9yd2FyZE9wdHNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0cmFjZTQoXCJnb3QgdHJhbnNmZXIgcm91dGVcIiwgcm91dGUpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ViA9IHdhdGNoKFxuICAgICAgICAgICAgICB0aW1lc3RhbXBIZWxwZXIudm93T3JWYWx1ZUZyb21PcHRzKG9wdHMpLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy50cmFuc2ZlcldhdGNoZXIsXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBvcHRzOiByZXN0LFxuICAgICAgICAgICAgICAgIHJvdXRlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0VjtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgcGFyc2VJbmJvdW5kVHJhbnNmZXIocmVjb3JkKSB7XG4gICAgICAgICAgdHJhY2U0KFwicGFyc2VJbmJvdW5kVHJhbnNmZXJcIiwgcmVjb3JkKTtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcGFja2V0ID0gKFxuICAgICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgcmVjb3JkXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgZnRQYWNrZXREYXRhID0gSlNPTi5wYXJzZShhdG9iKHBhY2tldC5kYXRhKSk7XG4gICAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICAgIGRlbm9tOiB0cmFuc2ZlckRlbm9tLFxuICAgICAgICAgICAgICBzZW5kZXIsXG4gICAgICAgICAgICAgIHJlY2VpdmVyLFxuICAgICAgICAgICAgICBhbW91bnRcbiAgICAgICAgICAgIH0gPSBmdFBhY2tldERhdGE7XG4gICAgICAgICAgICBjb25zdCBidWlsZFJldHVyblZhbHVlID0gKGxvY2FsRGVub20pID0+IGhhcmRlbih7XG4gICAgICAgICAgICAgIGFtb3VudDogKFxuICAgICAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgdmFsdWU6IEJpZ0ludChhbW91bnQpLFxuICAgICAgICAgICAgICAgICAgZGVub206IGxvY2FsRGVub21cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIGZyb21BY2NvdW50OiBzZW5kZXIsXG4gICAgICAgICAgICAgIHRvQWNjb3VudDogcmVjZWl2ZXIsXG4gICAgICAgICAgICAgIGV4dHJhOiB7XG4gICAgICAgICAgICAgICAgLi4uZnRQYWNrZXREYXRhXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGV0IGRlbm9tT3JUcmFjZTtcbiAgICAgICAgICAgIGNvbnN0IHByZWZpeCA9IGAke3BhY2tldC5zb3VyY2VfcG9ydH0vJHtwYWNrZXQuc291cmNlX2NoYW5uZWx9L2A7XG4gICAgICAgICAgICB0cmFjZTQoeyB0cmFuc2ZlckRlbm9tLCBwcmVmaXggfSk7XG4gICAgICAgICAgICBpZiAodHJhbnNmZXJEZW5vbS5zdGFydHNXaXRoKHByZWZpeCkpIHtcbiAgICAgICAgICAgICAgZGVub21PclRyYWNlID0gdHJhbnNmZXJEZW5vbS5zbGljZShwcmVmaXgubGVuZ3RoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGRlbm9tT3JUcmFjZSA9IGAke3BhY2tldC5kZXN0aW5hdGlvbl9wb3J0fS8ke3BhY2tldC5kZXN0aW5hdGlvbl9jaGFubmVsfS8ke3RyYW5zZmVyRGVub219YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRShsb2NhbGNoYWluKS5xdWVyeShcbiAgICAgICAgICAgICAgICBRdWVyeURlbm9tSGFzaFJlcXVlc3QyLnR5cGVkSnNvbih7XG4gICAgICAgICAgICAgICAgICB0cmFjZTogZGVub21PclRyYWNlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucGFyc2VJbmJvdW5kVHJhbnNmZXJXYXRjaGVyLFxuICAgICAgICAgICAgICBidWlsZFJldHVyblZhbHVlKGRlbm9tT3JUcmFjZSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB0cmFuc2ZlclN0ZXBzKGFtb3VudCwgbXNnKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidHJhbnNmZXJTdGVwcyBnb3RcIiwgYW1vdW50LCBtc2cpO1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBub3QgeWV0IGltcGxlbWVudGVkYDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgc2VuZFRoZW5XYWl0Rm9yQWNrKHNlbmRlciwgb3B0cykge1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIEUodGhpcy5zdGF0ZS5wYWNrZXRUb29scykuc2VuZFRoZW5XYWl0Rm9yQWNrKHNlbmRlciwgb3B0cylcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgbWF0Y2hGaXJzdFBhY2tldChwYXR0ZXJuVikge1xuICAgICAgICAgIHJldHVybiB3YXRjaChFKHRoaXMuc3RhdGUucGFja2V0VG9vbHMpLm1hdGNoRmlyc3RQYWNrZXQocGF0dGVyblYpKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgbW9uaXRvclRyYW5zZmVycyh0YXApIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goRSh0aGlzLnN0YXRlLnBhY2tldFRvb2xzKS5tb25pdG9yVHJhbnNmZXJzKHRhcCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICApO1xuICByZXR1cm4gbWFrZUxvY2FsT3JjaGVzdHJhdGlvbkFjY291bnRLaXQ7XG59O1xuXG4vL1xudmFyIHsgVm93JDogVm93JDYgfSA9IFNoYXBlO1xudmFyIHRyYWNlNSA9IG1ha2VUcmFjZXIyKFwiT3JjaGVzdHJhdG9yXCIpO1xudmFyIE9yY2hlc3RyYXRvckkgPSBNLmludGVyZmFjZShcIk9yY2hlc3RyYXRvclwiLCB7XG4gIGdldENoYWluOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhWb3ckNihNLnJlbW90YWJsZShcIkNoYWluRmFjYWRlXCIpKSksXG4gIGdldERlbm9tSW5mbzogTS5jYWxsKERlbm9tU2hhcGUsIE0uc3RyaW5nKCkpLnJldHVybnMoRGVub21JbmZvU2hhcGUpLFxuICBhc0Ftb3VudDogTS5jYWxsKERlbm9tQW1vdW50U2hhcGUpLnJldHVybnMoQW1vdW50U2hhcGUpXG59KTtcbnZhciBwcmVwYXJlT3JjaGVzdHJhdG9yS2l0ID0gKHpvbmUsIHtcbiAgY2hhaW5IdWIsXG4gIG1ha2VMb2NhbENoYWluRmFjYWRlLFxuICBtYWtlUmVtb3RlQ2hhaW5GYWNhZGUsXG4gIHZvd1Rvb2xzOiB7IHdhdGNoLCBhc1ZvdyB9XG59KSA9PiB7XG4gIGNvbnN0IGNoYWluQnlOYW1lID0gbWFrZVNjYWxhck1hcFN0b3JlNShcImNoYWluTmFtZVwiKTtcbiAgcmV0dXJuIHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJPcmNoZXN0cmF0b3JcIixcbiAgICB7XG4gICAgICBvcmNoZXN0cmF0b3I6IE9yY2hlc3RyYXRvckksXG4gICAgICBtYWtlTG9jYWxDaGFpbkZhY2FkZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwibWFrZUxvY2FsQ2hhaW5GYWNhZGVXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnJlY29yZCgpKS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpXG4gICAgICB9KSxcbiAgICAgIG1ha2VSZW1vdGVDaGFpbkZhY2FkZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFxuICAgICAgICBcIm1ha2VSZW1vdGVDaGFpbkZhY2FkZVdhdGNoZXJcIixcbiAgICAgICAge1xuICAgICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSwgTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpXG4gICAgICAgIH1cbiAgICAgIClcbiAgICB9LFxuICAgICgpID0+IHtcbiAgICAgIHRyYWNlNShcIm1ha2luZyBhbiBPcmNoZXN0cmF0b3JcIik7XG4gICAgICByZXR1cm4ge307XG4gICAgfSxcbiAgICB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgbWFrZUxvY2FsQ2hhaW5GYWNhZGVXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKGFnb3JpY0NoYWluSW5mbykge1xuICAgICAgICAgIGNvbnN0IGl0ID0gbWFrZUxvY2FsQ2hhaW5GYWNhZGUoYWdvcmljQ2hhaW5JbmZvKTtcbiAgICAgICAgICBjaGFpbkJ5TmFtZS5zZXQoXCJhZ29yaWNcIiwgaGFyZGVuKHsgdmFsdWU6IGl0LCBwZW5kaW5nOiBmYWxzZSB9KSk7XG4gICAgICAgICAgcmV0dXJuIGl0O1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIG1ha2VSZW1vdGVDaGFpbkZhY2FkZVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbX2Fnb3JpY0NoYWluSW5mbywgcmVtb3RlQ2hhaW5JbmZvLCBjb25uZWN0aW9uSW5mb10sIG5hbWUpIHtcbiAgICAgICAgICBjb25zdCBpdCA9IG1ha2VSZW1vdGVDaGFpbkZhY2FkZShyZW1vdGVDaGFpbkluZm8sIGNvbm5lY3Rpb25JbmZvKTtcbiAgICAgICAgICBjaGFpbkJ5TmFtZS5zZXQobmFtZSwgaGFyZGVuKHsgdmFsdWU6IGl0LCBwZW5kaW5nOiBmYWxzZSB9KSk7XG4gICAgICAgICAgcmV0dXJuIGl0O1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgb3JjaGVzdHJhdG9yOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldENoYWluKG5hbWUpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGNoYWluQnlOYW1lLmhhcyhuYW1lKSkge1xuICAgICAgICAgICAgICBjb25zdCBtYXliZUNoYWluID0gY2hhaW5CeU5hbWUuZ2V0KG5hbWUpO1xuICAgICAgICAgICAgICByZXR1cm4gbWF5YmVDaGFpbi5wZW5kaW5nID8gbWF5YmVDaGFpbi52b3cgOiBtYXliZUNoYWluLnZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgdm93ID0gbmFtZSA9PT0gXCJhZ29yaWNcIiA/IHdhdGNoKFxuICAgICAgICAgICAgICBjaGFpbkh1Yi5nZXRDaGFpbkluZm8oXCJhZ29yaWNcIiksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLm1ha2VMb2NhbENoYWluRmFjYWRlV2F0Y2hlclxuICAgICAgICAgICAgKSA6IHdhdGNoKFxuICAgICAgICAgICAgICBjaGFpbkh1Yi5nZXRDaGFpbnNBbmRDb25uZWN0aW9uKFwiYWdvcmljXCIsIG5hbWUpLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5tYWtlUmVtb3RlQ2hhaW5GYWNhZGVXYXRjaGVyLFxuICAgICAgICAgICAgICBuYW1lXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY2hhaW5CeU5hbWUuaW5pdChuYW1lLCBoYXJkZW4oeyB2b3csIHBlbmRpbmc6IHRydWUgfSkpO1xuICAgICAgICAgICAgcmV0dXJuIHZvdztcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldERlbm9tSW5mbyhkZW5vbSwgaG9sZGluZ0NoYWluTmFtZSkge1xuICAgICAgICAgIGNvbnN0IGRlbm9tRGV0YWlsID0gY2hhaW5IdWIuZ2V0QXNzZXQoZGVub20sIGhvbGRpbmdDaGFpbk5hbWUpO1xuICAgICAgICAgIGlmICghZGVub21EZXRhaWwpIHRocm93IHRocm93UmVkYWN0ZWRgTm8gZGVub20gZGV0YWlsIGZvciAke3F1b3RlKGRlbm9tKX1gO1xuICAgICAgICAgIGNvbnN0IHsgY2hhaW5OYW1lLCBiYXNlTmFtZSwgYmFzZURlbm9tLCBicmFuZCB9ID0gZGVub21EZXRhaWw7XG4gICAgICAgICAgY2hhaW5CeU5hbWUuaGFzKGNoYWluTmFtZSkgfHwgdGhyb3dSZWRhY3RlZGB1c2UgZ2V0Q2hhaW4oJHtxdW90ZShjaGFpbk5hbWUpfSkgYmVmb3JlIGdldERlbm9tSW5mbygke3F1b3RlKGRlbm9tKX0pYDtcbiAgICAgICAgICBjb25zdCBtYXliZUNoYWluID0gY2hhaW5CeU5hbWUuZ2V0KGNoYWluTmFtZSk7XG4gICAgICAgICAgaWYgKG1heWJlQ2hhaW4ucGVuZGluZykge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB3YWl0IHVudGlsIGdldENoYWluKCR7cXVvdGUoY2hhaW5OYW1lKX0pIGNvbXBsZXRlcyBiZWZvcmUgZ2V0RGVub21JbmZvKCR7cXVvdGUoZGVub20pfSlgO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBjaGFpbiA9IChcbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG1heWJlQ2hhaW4udmFsdWVcbiAgICAgICAgICApO1xuICAgICAgICAgIGNoYWluQnlOYW1lLmhhcyhiYXNlTmFtZSkgfHwgdGhyb3dSZWRhY3RlZGB1c2UgZ2V0Q2hhaW4oJHtxdW90ZShiYXNlTmFtZSl9KSBiZWZvcmUgZ2V0RGVub21JbmZvKCR7cXVvdGUoZGVub20pfSlgO1xuICAgICAgICAgIGNvbnN0IG1heWJlQmFzZSA9IGNoYWluQnlOYW1lLmdldChiYXNlTmFtZSk7XG4gICAgICAgICAgaWYgKG1heWJlQmFzZS5wZW5kaW5nKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHdhaXQgdW50aWwgZ2V0Q2hhaW4oJHtxdW90ZShiYXNlTmFtZSl9KSBjb21wbGV0ZXMgYmVmb3JlIGdldERlbm9tSW5mbygke3F1b3RlKGRlbm9tKX0pYDtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgYmFzZTIgPSAoXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICBtYXliZUJhc2UudmFsdWVcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBjaGFpbiwgYmFzZTogYmFzZTIsIGJyYW5kLCBiYXNlRGVub20gfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGFzQW1vdW50OiAoKSA9PiB0aHJvd1JlZGFjdGVkYG5vdCB5ZXQgaW1wbGVtZW50ZWRgXG4gICAgICB9XG4gICAgfVxuICApO1xufTtcbmhhcmRlbihwcmVwYXJlT3JjaGVzdHJhdG9yS2l0KTtcbnZhciBwcmVwYXJlT3JjaGVzdHJhdG9yID0gKHpvbmUsIHBvd2VycykgPT4ge1xuICBjb25zdCBtYWtlT3JjaGVzdHJhdG9yS2l0ID0gcHJlcGFyZU9yY2hlc3RyYXRvcktpdCh6b25lLCBwb3dlcnMpO1xuICByZXR1cm4gcGlja0ZhY2V0MyhtYWtlT3JjaGVzdHJhdG9yS2l0LCBcIm9yY2hlc3RyYXRvclwiKTtcbn07XG5cbi8vXG52YXIgdHJhY2U2ID0gbWFrZVRyYWNlcjIoXCJSZW1vdGVDaGFpbkZhY2FkZVwiKTtcbnZhciBwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGVLaXQgPSAoem9uZSwge1xuICBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnQsXG4gIG9yY2hlc3RyYXRpb24sXG4gIC8vXG4gIC8vXG4gIHN0b3JhZ2VOb2RlLFxuICB0aW1lcixcbiAgdm93VG9vbHM6IHsgYWxsVm93cywgYXNWb3csIHdhdGNoIH1cbn0pID0+IHpvbmUuZXhvQ2xhc3NLaXQoXG4gIFwiUmVtb3RlQ2hhaW5GYWNhZGVcIixcbiAge1xuICAgIHB1YmxpYzogTS5pbnRlcmZhY2UoXCJSZW1vdGVDaGFpbkZhY2FkZVwiLCB7XG4gICAgICAuLi5jaGFpbkZhY2FkZU1ldGhvZHMsXG4gICAgICBxdWVyeTogTS5jYWxsKE0uYXJyYXlPZihJQ1FNc2dTaGFwZSkpLnJldHVybnMoVm93U2hhcGUpXG4gICAgfSksXG4gICAgbWFrZUlDUUNvbm5lY3Rpb25RdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFxuICAgICAgXCJtYWtlSUNRQ29ubmVjdGlvblF1ZXJ5V2F0Y2hlclwiLFxuICAgICAge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ucmVtb3RhYmxlKCksIE0uYXJyYXlPZihJQ1FNc2dTaGFwZSkpLnJldHVybnMoXG4gICAgICAgICAgVm93U2hhcGVcbiAgICAgICAgKVxuICAgICAgfVxuICAgICksXG4gICAgbWFrZUFjY291bnRBbmRQcm92aWRlUXVlcnlDb25uV2F0Y2hlcjogTS5pbnRlcmZhY2UoXG4gICAgICBcIm1ha2VBY2NvdW50QW5kUHJvdmlkZVF1ZXJ5Q29ubldhdGNoZXJcIixcbiAgICAgIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChbXG4gICAgICAgICAgTS5yZW1vdGFibGUoKSxcbiAgICAgICAgICBNLm9yKE0ucmVtb3RhYmxlKCksIE0udW5kZWZpbmVkKCkpXG4gICAgICAgIF0pLnJldHVybnMoVm93U2hhcGUpXG4gICAgICB9XG4gICAgKSxcbiAgICBnZXRBZGRyZXNzZXNXYXRjaGVyOiBNLmludGVyZmFjZShcImdldEFkZHJlc3NXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoXG4gICAgICAgIFtDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSwgTS5zdHJpbmcoKSwgTS5zdHJpbmcoKV0sXG4gICAgICAgIE0ucmVtb3RhYmxlKClcbiAgICAgICkucmV0dXJucyhWb3dTaGFwZSlcbiAgICB9KSxcbiAgICBtYWtlQ2hpbGROb2RlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJtYWtlQ2hpbGROb2RlV2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ub3IoTS5yZW1vdGFibGUoKSwgTS51bmRlZmluZWQoKSksIHtcbiAgICAgICAgYWNjb3VudDogTS5yZW1vdGFibGUoKSxcbiAgICAgICAgY2hhaW5BZGRyZXNzOiBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSxcbiAgICAgICAgbG9jYWxBZGRyZXNzOiBNLnN0cmluZygpLFxuICAgICAgICByZW1vdGVBZGRyZXNzOiBNLnN0cmluZygpXG4gICAgICB9KS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpXG4gICAgfSlcbiAgfSxcbiAgLypcblxuXG4gICAqL1xuICAocmVtb3RlQ2hhaW5JbmZvLCBjb25uZWN0aW9uSW5mbykgPT4ge1xuICAgIHRyYWNlNihcIm1ha2luZyBhIFJlbW90ZUNoYWluRmFjYWRlXCIpO1xuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICB7XG4gICAgICAgIHJlbW90ZUNoYWluSW5mbyxcbiAgICAgICAgY29ubmVjdGlvbkluZm8sXG4gICAgICAgIGljcUNvbm5lY3Rpb246IHZvaWQgMFxuICAgICAgfVxuICAgICk7XG4gIH0sXG4gIHtcbiAgICBwdWJsaWM6IHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBnZXRDaGFpbkluZm8oKSB7XG4gICAgICAgIHJldHVybiB3YXRjaCh0aGlzLnN0YXRlLnJlbW90ZUNoYWluSW5mbyk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgbWFrZUFjY291bnQoKSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyByZW1vdGVDaGFpbkluZm8sIGNvbm5lY3Rpb25JbmZvIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChyZW1vdGVDaGFpbkluZm8ubmFtZXNwYWNlICE9PSBcImNvc21vc1wiKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYG9ubHkgc3VwcG9ydGVkIG9uICdjb3Ntb3MnIGNoYWlucywgbm90ICR7cmVtb3RlQ2hhaW5JbmZvLm5hbWVzcGFjZX1gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWNvbm5lY3Rpb25JbmZvKSB0aHJvdyB0aHJvd1JlZGFjdGVkYElCQyBjb25uZWN0aW9uIGluZm8gbm90IGZvdW5kYDtcbiAgICAgICAgICBjb25zdCBpY3FDb25uT3JVbmRlZmluZWRWID0gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICByZW1vdGVDaGFpbkluZm8/LmljcUVuYWJsZWQgJiYgIXRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbiA/IEUob3JjaGVzdHJhdGlvbikucHJvdmlkZUlDUUNvbm5lY3Rpb24oY29ubmVjdGlvbkluZm8uaWQpIDogdm9pZCAwXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCBtYWtlQWNjb3VudFYgPSBFKG9yY2hlc3RyYXRpb24pLm1ha2VBY2NvdW50KFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICByZW1vdGVDaGFpbkluZm8uY2hhaW5JZCxcbiAgICAgICAgICAgIGNvbm5lY3Rpb25JbmZvLmNvdW50ZXJwYXJ0eS5jb25uZWN0aW9uX2lkLFxuICAgICAgICAgICAgY29ubmVjdGlvbkluZm8uaWRcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIGFsbFZvd3MoW21ha2VBY2NvdW50ViwgaWNxQ29ubk9yVW5kZWZpbmVkVl0pLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMubWFrZUFjY291bnRBbmRQcm92aWRlUXVlcnlDb25uV2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIHF1ZXJ5KG1zZ3MpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHJlbW90ZUNoYWluSW5mbzogeyBpY3FFbmFibGVkLCBjaGFpbklkIH0sXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgY29ubmVjdGlvbkluZm9cbiAgICAgICAgICB9ID0gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLnN0YXRlXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIWljcUVuYWJsZWQpIHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluSWQpfWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghY29ubmVjdGlvbkluZm8pIHRocm93IHRocm93UmVkYWN0ZWRgSUJDIGNvbm5lY3Rpb24gaW5mbyBub3QgZm91bmRgO1xuICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUob3JjaGVzdHJhdGlvbikucHJvdmlkZUlDUUNvbm5lY3Rpb24oY29ubmVjdGlvbkluZm8uaWQpLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5tYWtlSUNRQ29ubmVjdGlvblF1ZXJ5V2F0Y2hlcixcbiAgICAgICAgICAgICAgbXNnc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKEUodGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uKS5xdWVyeShtc2dzKSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFrZUFjY291bnRBbmRQcm92aWRlUXVlcnlDb25uV2F0Y2hlcjoge1xuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChbYWNjb3VudCwgaWNxQ29ubmVjdGlvbl0pIHtcbiAgICAgICAgaWYgKGljcUNvbm5lY3Rpb24gJiYgIXRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgIHRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbiA9IGljcUNvbm5lY3Rpb247XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgIGFsbFZvd3MoW1xuICAgICAgICAgICAgRShhY2NvdW50KS5nZXRBZGRyZXNzKCksXG4gICAgICAgICAgICBFKGFjY291bnQpLmdldExvY2FsQWRkcmVzcygpLFxuICAgICAgICAgICAgRShhY2NvdW50KS5nZXRSZW1vdGVBZGRyZXNzKClcbiAgICAgICAgICBdKSxcbiAgICAgICAgICB0aGlzLmZhY2V0cy5nZXRBZGRyZXNzZXNXYXRjaGVyLFxuICAgICAgICAgIGFjY291bnRcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1ha2VJQ1FDb25uZWN0aW9uUXVlcnlXYXRjaGVyOiB7XG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChpY3FDb25uZWN0aW9uLCBtc2dzKSB7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uID0gaWNxQ29ubmVjdGlvbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gd2F0Y2goRShpY3FDb25uZWN0aW9uKS5xdWVyeShtc2dzKSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBnZXRBZGRyZXNzZXNXYXRjaGVyOiB7XG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoW2NoYWluQWRkcmVzcywgbG9jYWxBZGRyZXNzLCByZW1vdGVBZGRyZXNzXSwgYWNjb3VudCkge1xuICAgICAgICBjb25zdCBvcHRpb25hbFN0b3JhZ2VOb2RlID0gc3RvcmFnZU5vZGUgPyBFKHN0b3JhZ2VOb2RlKS5tYWtlQ2hpbGROb2RlKGNoYWluQWRkcmVzcy52YWx1ZSkgOiB2b2lkIDA7XG4gICAgICAgIHJldHVybiB3YXRjaChvcHRpb25hbFN0b3JhZ2VOb2RlLCB0aGlzLmZhY2V0cy5tYWtlQ2hpbGROb2RlV2F0Y2hlciwge1xuICAgICAgICAgIGFjY291bnQsXG4gICAgICAgICAgY2hhaW5BZGRyZXNzLFxuICAgICAgICAgIGxvY2FsQWRkcmVzcyxcbiAgICAgICAgICByZW1vdGVBZGRyZXNzXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFrZUNoaWxkTm9kZVdhdGNoZXI6IHtcbiAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoY2hpbGROb2RlLCB7IGFjY291bnQsIGNoYWluQWRkcmVzcywgbG9jYWxBZGRyZXNzLCByZW1vdGVBZGRyZXNzIH0pIHtcbiAgICAgICAgY29uc3QgeyBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICByZXR1cm4gbWFrZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50KFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGNoYWluQWRkcmVzcyxcbiAgICAgICAgICAgIGxvY2FsQWRkcmVzcyxcbiAgICAgICAgICAgIHJlbW90ZUFkZHJlc3NcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGFjY291bnQsXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgc3RvcmFnZU5vZGU6IGNoaWxkTm9kZSxcbiAgICAgICAgICAgIGljcUNvbm5lY3Rpb24sXG4gICAgICAgICAgICB0aW1lclxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbik7XG5oYXJkZW4ocHJlcGFyZVJlbW90ZUNoYWluRmFjYWRlS2l0KTtcbnZhciBwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGUgPSAoem9uZSwgcG93ZXJzKSA9PiB7XG4gIGNvbnN0IG1ha2VMb2NhbENoYWluRmFjYWRlS2l0ID0gcHJlcGFyZVJlbW90ZUNoYWluRmFjYWRlS2l0KHpvbmUsIHBvd2Vycyk7XG4gIHJldHVybiBwaWNrRmFjZXQzKG1ha2VMb2NhbENoYWluRmFjYWRlS2l0LCBcInB1YmxpY1wiKTtcbn07XG5oYXJkZW4ocHJlcGFyZVJlbW90ZUNoYWluRmFjYWRlKTtcblxuLy9cbnZhciBtYWtlT3JjaGVzdHJhdGlvbkZhY2FkZSA9ICh7XG4gIHpvbmUsXG4gIHRpbWVyU2VydmljZSxcbiAgemNmLFxuICBvcmNoZXN0cmF0aW9uU2VydmljZSxcbiAgbWFrZU9yY2hlc3RyYXRvcixcbiAgdm93VG9vbHMsXG4gIGFzeW5jRmxvd1Rvb2xzXG59KSA9PiB7XG4gIGFzc2VydEFsbERlZmluZWQyKHtcbiAgICB6b25lLFxuICAgIHRpbWVyU2VydmljZSxcbiAgICB6Y2YsXG4gICAgb3JjaGVzdHJhdGlvblNlcnZpY2UsXG4gICAgbWFrZU9yY2hlc3RyYXRvcixcbiAgICB2b3dUb29scyxcbiAgICBhc3luY0Zsb3dUb29sc1xuICB9KTtcbiAgY29uc3QgeyBwcmVwYXJlRW5kb3dtZW50LCBhc3luY0Zsb3cgfSA9IGFzeW5jRmxvd1Rvb2xzO1xuICBjb25zdCBvcmNoZXN0cmF0ZSA9IChkdXJhYmxlTmFtZSwgaG9zdEN0eCwgZ3Vlc3RGbikgPT4ge1xuICAgIGNvbnN0IHN1YlpvbmUgPSB6b25lLnN1YlpvbmUoZHVyYWJsZU5hbWUpO1xuICAgIGNvbnN0IFt3cmFwcGVkQ3R4XSA9IHByZXBhcmVFbmRvd21lbnQoc3ViWm9uZSwgXCJlbmRvd21lbnRzXCIsIFtob3N0Q3R4XSk7XG4gICAgY29uc3QgaG9zdEZuID0gYXN5bmNGbG93KHN1YlpvbmUsIFwiYXN5bmNGbG93XCIsIGd1ZXN0Rm4pO1xuICAgIGRlZXBNYXBPYmplY3QoXG4gICAgICB3cmFwcGVkQ3R4LFxuICAgICAgKHZhbCkgPT4gdmFsID09PSB6Y2YgJiYgYXNzZXJ0LmZhaWwoXCJkbyBub3QgdXNlIHpjZiBpbiBvcmNoZXN0cmF0aW9uIGNvbnRleHQ7IHRyeSB6Y2ZUb29sc1wiKVxuICAgICk7XG4gICAgY29uc3Qgb3JjRm4gPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAoKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgY29uc3QgaG9zdE9yYyA9IG1ha2VPcmNoZXN0cmF0b3IoKTtcbiAgICAgICAgcmV0dXJuIGhvc3RGbihob3N0T3JjLCB3cmFwcGVkQ3R4LCAuLi5hcmdzKTtcbiAgICAgIH0pXG4gICAgKTtcbiAgICByZXR1cm4gaGFyZGVuKG9yY0ZuKTtcbiAgfTtcbiAgY29uc3Qgb3JjaGVzdHJhdGVBbGwgPSAoZ3Vlc3RGbnMsIGhvc3RDdHgpID0+IHtcbiAgICBjb25zdCBtYXBwZWRGbG93cyA9IG5ldyBNYXAoXG4gICAgICBPYmplY3QuZW50cmllcyhndWVzdEZucykubWFwKChbbmFtZSwgZ3Vlc3RGbl0pID0+IFtcbiAgICAgICAgZ3Vlc3RGbixcbiAgICAgICAgKC4uLmFyZ3MpID0+IG9yY0Zuc1tuYW1lXSguLi5hcmdzKVxuICAgICAgXSlcbiAgICApO1xuICAgIGNvbnN0IG1hcHBlZENvbnRleHQgPSBkZWVwTWFwT2JqZWN0KFxuICAgICAgaG9zdEN0eCxcbiAgICAgICh2YWwpID0+IG1hcHBlZEZsb3dzLmdldChcbiAgICAgICAgLyogICAgICAgICAgICAgICovXG4gICAgICAgIHZhbFxuICAgICAgKSB8fCB2YWxcbiAgICApO1xuICAgIGNvbnN0IG9yY0ZucyA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBPYmplY3QuZW50cmllcyhndWVzdEZucykubWFwKChbbmFtZSwgZ3Vlc3RGbl0pID0+IFtcbiAgICAgICAgICBuYW1lLFxuICAgICAgICAgIG9yY2hlc3RyYXRlKG5hbWUsIG1hcHBlZENvbnRleHQsIGd1ZXN0Rm4pXG4gICAgICAgIF0pXG4gICAgICApXG4gICAgKTtcbiAgICByZXR1cm4geyAuLi5vcmNGbnMgfTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgb3JjaGVzdHJhdGUsXG4gICAgb3JjaGVzdHJhdGVBbGxcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VPcmNoZXN0cmF0aW9uRmFjYWRlKTtcblxuLy9cbnZhciBuYXRTYWZlTWF0aCA9IGhhcmRlbih7XG4gIC8qICAgICAgICAgICAgICAgICovXG4gIC8vXG4gIGFkZDogKHgsIHkpID0+IE5hdCh4KSArIE5hdCh5KSxcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgc3VidHJhY3Q6ICh4LCB5KSA9PiBOYXQoTmF0KHgpIC0gTmF0KHkpKSxcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgbXVsdGlwbHk6ICh4LCB5KSA9PiBOYXQoeCkgKiBOYXQoeSksXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIGZsb29yRGl2aWRlOiAoeCwgeSkgPT4gTmF0KHgpIC8gTmF0KHkpLFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBjZWlsRGl2aWRlOiAoeCwgeSkgPT4ge1xuICAgIHkgPSBOYXQoeSk7XG4gICAgcmV0dXJuIE5hdChOYXQoeCkgKyB5IC0gMW4pIC8geTtcbiAgfSxcbiAgLypcblxuXG5cblxuICAgKi9cbiAgYmFua2Vyc0RpdmlkZTogKGEyLCBiMykgPT4ge1xuICAgIGEyID0gTmF0KGEyKTtcbiAgICBiMyA9IE5hdChiMyk7XG4gICAgY29uc3QgZGl2ID0gYTIgLyBiMztcbiAgICBjb25zdCByZW0gPSBhMiAlIGIzO1xuICAgIGlmIChyZW0gKiAybiA+IGIzKSB7XG4gICAgICByZXR1cm4gZGl2ICsgMW47XG4gICAgfSBlbHNlIGlmIChyZW0gKiAybiA9PT0gYjMpIHtcbiAgICAgIGlmIChkaXYgJSAybiA9PT0gMW4pIHJldHVybiBkaXYgKyAxbjtcbiAgICB9XG4gICAgcmV0dXJuIGRpdjtcbiAgfSxcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gIGlzR1RFOiAoeCwgeSkgPT4gTmF0KHgpID49IE5hdCh5KVxufSk7XG5cbi8vXG52YXIgeyBzdWJ0cmFjdCwgYWRkLCBtdWx0aXBseSwgZmxvb3JEaXZpZGUgfSA9IG5hdFNhZmVNYXRoO1xuXG4vL1xudmFyIG1ha2VTdGF0ZU1hY2hpbmUgPSAoaW5pdGlhbFN0YXRlLCBhbGxvd2VkVHJhbnNpdGlvbnNBcnJheSkgPT4ge1xuICBsZXQgc3RhdGUgPSBpbml0aWFsU3RhdGU7XG4gIGNvbnN0IGFsbG93ZWRUcmFuc2l0aW9ucyA9IG5ldyBNYXAoYWxsb3dlZFRyYW5zaXRpb25zQXJyYXkpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBjYW5UcmFuc2l0aW9uVG86IChuZXh0U3RhdGUpID0+IGFsbG93ZWRUcmFuc2l0aW9ucy5nZXQoc3RhdGUpLmluY2x1ZGVzKG5leHRTdGF0ZSksXG4gICAgdHJhbnNpdGlvblRvOiAobmV4dFN0YXRlKSA9PiB7XG4gICAgICBhc3NlcnQyKGFsbG93ZWRUcmFuc2l0aW9ucy5nZXQoc3RhdGUpLmluY2x1ZGVzKG5leHRTdGF0ZSkpO1xuICAgICAgc3RhdGUgPSBuZXh0U3RhdGU7XG4gICAgfSxcbiAgICBnZXRTdGF0dXM6IChfKSA9PiBzdGF0ZVxuICB9KTtcbn07XG5oYXJkZW4obWFrZVN0YXRlTWFjaGluZSk7XG5cbi8vXG52YXIgZW1wdHk1ID0gMG47XG52YXIgbmF0TWF0aEhlbHBlcnMyID0gaGFyZGVuKHtcbiAgZG9Db2VyY2U6IChuYXQpID0+IHtcbiAgICBhc3NlcnQudHlwZW9mKG5hdCwgXCJiaWdpbnRcIik7XG4gICAgaXNOYXQobmF0KSB8fCB0aHJvd1JlZGFjdGVkYHZhbHVlICR7bmF0fSBtdXN0IGJlIGEgbmF0dXJhbCBudW1iZXJgO1xuICAgIHJldHVybiBOYXQobmF0KTtcbiAgfSxcbiAgZG9NYWtlRW1wdHk6ICgpID0+IGVtcHR5NSxcbiAgZG9Jc0VtcHR5OiAobmF0KSA9PiBuYXQgPT09IGVtcHR5NSxcbiAgZG9Jc0dURTogKGxlZnQsIHJpZ2h0KSA9PiBsZWZ0ID49IHJpZ2h0LFxuICBkb0lzRXF1YWw6IChsZWZ0LCByaWdodCkgPT4gbGVmdCA9PT0gcmlnaHQsXG4gIC8vXG4gIGRvQWRkOiAobGVmdCwgcmlnaHQpID0+IGxlZnQgKyByaWdodCxcbiAgZG9TdWJ0cmFjdDogKGxlZnQsIHJpZ2h0KSA9PiBOYXQobGVmdCAtIHJpZ2h0KVxufSk7XG5cbi8vXG52YXIgZW1wdHk2ID0gaGFyZGVuKFtdKTtcbnZhciBzZXRNYXRoSGVscGVyczIgPSBoYXJkZW4oe1xuICBkb0NvZXJjZTogKGxpc3QpID0+IHtcbiAgICBsaXN0ID0gY29lcmNlVG9FbGVtZW50cyhsaXN0KTtcbiAgICBhc3NlcnRLZXkobGlzdCk7XG4gICAgcmV0dXJuIGxpc3Q7XG4gIH0sXG4gIGRvTWFrZUVtcHR5OiAoKSA9PiBlbXB0eTYsXG4gIGRvSXNFbXB0eTogKGxpc3QpID0+IHBhc3NTdHlsZU9mKGxpc3QpID09PSBcImNvcHlBcnJheVwiICYmIGxpc3QubGVuZ3RoID09PSAwLFxuICBkb0lzR1RFOiBlbGVtZW50c0lzU3VwZXJzZXQsXG4gIGRvSXNFcXVhbDogKHgsIHkpID0+IGVsZW1lbnRzQ29tcGFyZSh4LCB5KSA9PT0gMCxcbiAgZG9BZGQ6IGVsZW1lbnRzRGlzam9pbnRVbmlvbixcbiAgZG9TdWJ0cmFjdDogZWxlbWVudHNEaXNqb2ludFN1YnRyYWN0XG59KTtcblxuLy9cbnZhciBlbXB0eTcgPSBtYWtlQ29weVNldChbXSk7XG52YXIgY29weVNldE1hdGhIZWxwZXJzMiA9IGhhcmRlbih7XG4gIGRvQ29lcmNlOiAoc2V0KSA9PiB7XG4gICAgbXVzdE1hdGNoMihzZXQsIE0uc2V0KCksIFwic2V0IG9mIGFtb3VudFwiKTtcbiAgICByZXR1cm4gc2V0O1xuICB9LFxuICBkb01ha2VFbXB0eTogKCkgPT4gZW1wdHk3LFxuICBkb0lzRW1wdHk6IChzZXQpID0+IGdldENvcHlTZXRLZXlzKHNldCkubGVuZ3RoID09PSAwLFxuICBkb0lzR1RFOiBzZXRJc1N1cGVyc2V0LFxuICBkb0lzRXF1YWw6IGtleUVRLFxuICBkb0FkZDogc2V0RGlzam9pbnRVbmlvbixcbiAgZG9TdWJ0cmFjdDogc2V0RGlzam9pbnRTdWJ0cmFjdFxufSk7XG5cbi8vXG52YXIgZW1wdHk4ID0gbWFrZUNvcHlCYWcoW10pO1xudmFyIGNvcHlCYWdNYXRoSGVscGVyczIgPSBoYXJkZW4oe1xuICBkb0NvZXJjZTogKGJhZykgPT4ge1xuICAgIG11c3RNYXRjaDIoYmFnLCBNLmJhZygpLCBcImJhZyBvZiBhbW91bnRcIik7XG4gICAgcmV0dXJuIGJhZztcbiAgfSxcbiAgZG9NYWtlRW1wdHk6ICgpID0+IGVtcHR5OCxcbiAgZG9Jc0VtcHR5OiAoYmFnKSA9PiBnZXRDb3B5QmFnRW50cmllcyhiYWcpLmxlbmd0aCA9PT0gMCxcbiAgZG9Jc0dURTogYmFnSXNTdXBlcmJhZyxcbiAgZG9Jc0VxdWFsOiBrZXlFUSxcbiAgZG9BZGQ6IGJhZ1VuaW9uLFxuICBkb1N1YnRyYWN0OiBiYWdEaXNqb2ludFN1YnRyYWN0XG59KTtcblxuLy9cbnZhciBBc3NldEtpbmQyID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgTkFUOiBcIm5hdFwiLFxuICAgIFNFVDogXCJzZXRcIixcbiAgICBDT1BZX1NFVDogXCJjb3B5U2V0XCIsXG4gICAgQ09QWV9CQUc6IFwiY29weUJhZ1wiXG4gIH1cbik7XG5oYXJkZW4oQXNzZXRLaW5kMik7XG52YXIgYXNzZXRLaW5kTmFtZXMyID0gaGFyZGVuKE9iamVjdC52YWx1ZXMoQXNzZXRLaW5kMikuc29ydCgpKTtcbnZhciBhc3NlcnRBc3NldEtpbmQyID0gKGFsbGVnZWRBSykgPT4ge1xuICBhc3NldEtpbmROYW1lczIuaW5jbHVkZXMoYWxsZWdlZEFLKSB8fCB0aHJvd1JlZGFjdGVkYFRoZSBhc3NldEtpbmQgJHthbGxlZ2VkQUt9IG11c3QgYmUgb25lIG9mICR7cXVvdGUoYXNzZXRLaW5kTmFtZXMyKX1gO1xufTtcbmhhcmRlbihhc3NlcnRBc3NldEtpbmQyKTtcbnZhciBoZWxwZXJzMiA9IHtcbiAgbmF0OiBuYXRNYXRoSGVscGVyczIsXG4gIHNldDogc2V0TWF0aEhlbHBlcnMyLFxuICBjb3B5U2V0OiBjb3B5U2V0TWF0aEhlbHBlcnMyLFxuICBjb3B5QmFnOiBjb3B5QmFnTWF0aEhlbHBlcnMyXG59O1xudmFyIGFzc2VydFZhbHVlR2V0QXNzZXRLaW5kMiA9ICh2YWx1ZSkgPT4ge1xuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZih2YWx1ZSk7XG4gIGlmIChwYXNzU3R5bGUgPT09IFwiYmlnaW50XCIpIHtcbiAgICByZXR1cm4gXCJuYXRcIjtcbiAgfVxuICBpZiAocGFzc1N0eWxlID09PSBcImNvcHlBcnJheVwiKSB7XG4gICAgcmV0dXJuIFwic2V0XCI7XG4gIH1cbiAgaWYgKG1hdGNoZXModmFsdWUsIE0uc2V0KCkpKSB7XG4gICAgcmV0dXJuIFwiY29weVNldFwiO1xuICB9XG4gIGlmIChtYXRjaGVzKHZhbHVlLCBNLmJhZygpKSkge1xuICAgIHJldHVybiBcImNvcHlCYWdcIjtcbiAgfVxuICB0aHJvdyB0aHJvd1JlZGFjdGVkYHZhbHVlICR7dmFsdWV9IG11c3QgYmUgYSBiaWdpbnQsIGNvcHlTZXQsIGNvcHlCYWcsIG9yIGFuIGFycmF5LCBub3QgJHtxdW90ZShcbiAgICBwYXNzU3R5bGVcbiAgKX1gO1xufTtcbnZhciBhc3NlcnRWYWx1ZUdldEhlbHBlcnMyID0gKHZhbHVlKSA9PiAoXG4gIC8vXG4gIGhlbHBlcnMyW2Fzc2VydFZhbHVlR2V0QXNzZXRLaW5kMih2YWx1ZSldXG4pO1xudmFyIG9wdGlvbmFsQnJhbmRDaGVjazIgPSAoYWxsZWdlZEJyYW5kLCBicmFuZCkgPT4ge1xuICBpZiAoYnJhbmQgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFJlbW90YWJsZShicmFuZCwgXCJicmFuZFwiKTtcbiAgICBhbGxlZ2VkQnJhbmQgPT09IGJyYW5kIHx8IHRocm93UmVkYWN0ZWRgYW1vdW50J3MgYnJhbmQgJHtxdW90ZShhbGxlZ2VkQnJhbmQpfSBkaWQgbm90IG1hdGNoIGV4cGVjdGVkIGJyYW5kICR7cXVvdGUoXG4gICAgICBicmFuZFxuICAgICl9YDtcbiAgfVxufTtcbnZhciBjaGVja0xSQW5kR2V0SGVscGVyczIgPSAobGVmdEFtb3VudCwgcmlnaHRBbW91bnQsIGJyYW5kID0gdm9pZCAwKSA9PiB7XG4gIGFzc2VydFJlY29yZChsZWZ0QW1vdW50LCBcImxlZnRBbW91bnRcIik7XG4gIGFzc2VydFJlY29yZChyaWdodEFtb3VudCwgXCJyaWdodEFtb3VudFwiKTtcbiAgY29uc3QgeyB2YWx1ZTogbGVmdFZhbHVlLCBicmFuZDogbGVmdEJyYW5kIH0gPSBsZWZ0QW1vdW50O1xuICBjb25zdCB7IHZhbHVlOiByaWdodFZhbHVlLCBicmFuZDogcmlnaHRCcmFuZCB9ID0gcmlnaHRBbW91bnQ7XG4gIGFzc2VydFJlbW90YWJsZShsZWZ0QnJhbmQsIFwibGVmdEJyYW5kXCIpO1xuICBhc3NlcnRSZW1vdGFibGUocmlnaHRCcmFuZCwgXCJyaWdodEJyYW5kXCIpO1xuICBvcHRpb25hbEJyYW5kQ2hlY2syKGxlZnRCcmFuZCwgYnJhbmQpO1xuICBvcHRpb25hbEJyYW5kQ2hlY2syKHJpZ2h0QnJhbmQsIGJyYW5kKTtcbiAgbGVmdEJyYW5kID09PSByaWdodEJyYW5kIHx8IHRocm93UmVkYWN0ZWRgQnJhbmRzIGluIGxlZnQgJHtxdW90ZShsZWZ0QnJhbmQpfSBhbmQgcmlnaHQgJHtxdW90ZShcbiAgICByaWdodEJyYW5kXG4gICl9IHNob3VsZCBtYXRjaCBidXQgZG8gbm90YDtcbiAgY29uc3QgbGVmdEhlbHBlcnMgPSBhc3NlcnRWYWx1ZUdldEhlbHBlcnMyKGxlZnRWYWx1ZSk7XG4gIGNvbnN0IHJpZ2h0SGVscGVycyA9IGFzc2VydFZhbHVlR2V0SGVscGVyczIocmlnaHRWYWx1ZSk7XG4gIGxlZnRIZWxwZXJzID09PSByaWdodEhlbHBlcnMgfHwgdGhyb3dSZWRhY3RlZGBUaGUgbGVmdCAke2xlZnRBbW91bnR9IGFuZCByaWdodCBhbW91bnQgJHtyaWdodEFtb3VudH0gaGFkIGRpZmZlcmVudCBhc3NldEtpbmRzYDtcbiAgcmV0dXJuIGxlZnRIZWxwZXJzO1xufTtcbnZhciBjb2VyY2VMUjIgPSAoaCwgbGVmdEFtb3VudCwgcmlnaHRBbW91bnQpID0+IHtcbiAgcmV0dXJuIFtoLmRvQ29lcmNlKGxlZnRBbW91bnQudmFsdWUpLCBoLmRvQ29lcmNlKHJpZ2h0QW1vdW50LnZhbHVlKV07XG59O1xudmFyIGlzR1RFMiA9IChsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQgPSB2b2lkIDApID0+IHtcbiAgY29uc3QgaCA9IGNoZWNrTFJBbmRHZXRIZWxwZXJzMihsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQpO1xuICByZXR1cm4gaC5kb0lzR1RFKC4uLmNvZXJjZUxSMihoLCBsZWZ0QW1vdW50LCByaWdodEFtb3VudCkpO1xufTtcbnZhciBBbW91bnRNYXRoMiA9IHtcbiAgLy9cbiAgLy9cbiAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgKi9cbiAgbWFrZTogKGJyYW5kLCBhbGxlZ2VkVmFsdWUpID0+IHtcbiAgICBhc3NlcnRSZW1vdGFibGUoYnJhbmQsIFwiYnJhbmRcIik7XG4gICAgY29uc3QgaCA9IGFzc2VydFZhbHVlR2V0SGVscGVyczIoYWxsZWdlZFZhbHVlKTtcbiAgICBjb25zdCB2YWx1ZSA9IGguZG9Db2VyY2UoYWxsZWdlZFZhbHVlKTtcbiAgICByZXR1cm4gaGFyZGVuKHsgYnJhbmQsIHZhbHVlIH0pO1xuICB9LFxuICAvKlxuXG5cblxuXG5cblxuXG4gICAqL1xuICBjb2VyY2U6IChicmFuZCwgYWxsZWdlZEFtb3VudCkgPT4ge1xuICAgIGFzc2VydFJlbW90YWJsZShicmFuZCwgXCJicmFuZFwiKTtcbiAgICBhc3NlcnRSZWNvcmQoYWxsZWdlZEFtb3VudCwgXCJhbW91bnRcIik7XG4gICAgY29uc3QgeyBicmFuZDogYWxsZWdlZEJyYW5kLCB2YWx1ZTogYWxsZWdlZFZhbHVlIH0gPSBhbGxlZ2VkQW1vdW50O1xuICAgIGJyYW5kID09PSBhbGxlZ2VkQnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBUaGUgYnJhbmQgaW4gdGhlIGFsbGVnZWRBbW91bnQgJHthbGxlZ2VkQW1vdW50fSBpbiAnY29lcmNlJyBkaWRuJ3QgbWF0Y2ggdGhlIHNwZWNpZmllZCBicmFuZCAke2JyYW5kfS5gO1xuICAgIHJldHVybiBBbW91bnRNYXRoMi5tYWtlKGJyYW5kLCBhbGxlZ2VkVmFsdWUpO1xuICB9LFxuICAvKlxuXG5cblxuXG5cblxuICAgKi9cbiAgZ2V0VmFsdWU6IChicmFuZCwgYW1vdW50KSA9PiBBbW91bnRNYXRoMi5jb2VyY2UoYnJhbmQsIGFtb3VudCkudmFsdWUsXG4gIC8qXG5cblxuXG5cblxuXG5cbiAgICovXG4gIG1ha2VFbXB0eTogKGJyYW5kLCBhc3NldEtpbmQgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICBcIm5hdFwiXG4gICkpID0+IHtcbiAgICBhc3NlcnRSZW1vdGFibGUoYnJhbmQsIFwiYnJhbmRcIik7XG4gICAgYXNzZXJ0QXNzZXRLaW5kMihhc3NldEtpbmQpO1xuICAgIGNvbnN0IHZhbHVlID0gaGVscGVyczJbYXNzZXRLaW5kXS5kb01ha2VFbXB0eSgpO1xuICAgIHJldHVybiBoYXJkZW4oeyBicmFuZCwgdmFsdWUgfSk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuXG4gICAqL1xuICBtYWtlRW1wdHlGcm9tQW1vdW50OiAoYW1vdW50KSA9PiB7XG4gICAgYXNzZXJ0UmVjb3JkKGFtb3VudCwgXCJhbW91bnRcIik7XG4gICAgY29uc3QgeyBicmFuZCwgdmFsdWUgfSA9IGFtb3VudDtcbiAgICBjb25zdCBhc3NldEtpbmQgPSBhc3NlcnRWYWx1ZUdldEFzc2V0S2luZDIodmFsdWUpO1xuICAgIHJldHVybiBBbW91bnRNYXRoMi5tYWtlRW1wdHkoYnJhbmQsIGFzc2V0S2luZCk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuICAgKi9cbiAgaXNFbXB0eTogKGFtb3VudCwgYnJhbmQgPSB2b2lkIDApID0+IHtcbiAgICBhc3NlcnRSZWNvcmQoYW1vdW50LCBcImFtb3VudFwiKTtcbiAgICBjb25zdCB7IGJyYW5kOiBhbGxlZ2VkQnJhbmQsIHZhbHVlIH0gPSBhbW91bnQ7XG4gICAgYXNzZXJ0UmVtb3RhYmxlKGFsbGVnZWRCcmFuZCwgXCJicmFuZFwiKTtcbiAgICBvcHRpb25hbEJyYW5kQ2hlY2syKGFsbGVnZWRCcmFuZCwgYnJhbmQpO1xuICAgIGNvbnN0IGggPSBhc3NlcnRWYWx1ZUdldEhlbHBlcnMyKHZhbHVlKTtcbiAgICByZXR1cm4gaC5kb0lzRW1wdHkoaC5kb0NvZXJjZSh2YWx1ZSkpO1xuICB9LFxuICBpc0dURTogaXNHVEUyLFxuICAvKlxuXG5cblxuXG5cblxuXG5cbiAgICovXG4gIGlzRXF1YWw6IChsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQgPSB2b2lkIDApID0+IHtcbiAgICBjb25zdCBoID0gY2hlY2tMUkFuZEdldEhlbHBlcnMyKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCk7XG4gICAgcmV0dXJuIGguZG9Jc0VxdWFsKC4uLmNvZXJjZUxSMihoLCBsZWZ0QW1vdW50LCByaWdodEFtb3VudCkpO1xuICB9LFxuICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICovXG4gIGFkZDogKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IGggPSBjaGVja0xSQW5kR2V0SGVscGVyczIobGVmdEFtb3VudCwgcmlnaHRBbW91bnQsIGJyYW5kKTtcbiAgICBjb25zdCB2YWx1ZSA9IGguZG9BZGQoLi4uY29lcmNlTFIyKGgsIGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50KSk7XG4gICAgcmV0dXJuIGhhcmRlbih7IGJyYW5kOiBsZWZ0QW1vdW50LmJyYW5kLCB2YWx1ZSB9KTtcbiAgfSxcbiAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICovXG4gIHN1YnRyYWN0OiAobGVmdEFtb3VudCwgcmlnaHRBbW91bnQsIGJyYW5kID0gdm9pZCAwKSA9PiB7XG4gICAgY29uc3QgaCA9IGNoZWNrTFJBbmRHZXRIZWxwZXJzMihsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQpO1xuICAgIGNvbnN0IHZhbHVlID0gaC5kb1N1YnRyYWN0KC4uLmNvZXJjZUxSMihoLCBsZWZ0QW1vdW50LCByaWdodEFtb3VudCkpO1xuICAgIHJldHVybiBoYXJkZW4oeyBicmFuZDogbGVmdEFtb3VudC5icmFuZCwgdmFsdWUgfSk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuXG5cbiAgICovXG4gIG1pbjogKHgsIHksIGJyYW5kID0gdm9pZCAwKSA9PiAoXG4gICAgLy9cbiAgICBpc0dURTIoeCwgeSwgYnJhbmQpID8geSA6IGlzR1RFMih5LCB4LCBicmFuZCkgPyB4IDogdGhyb3dSZWRhY3RlZGAke3h9IGFuZCAke3l9IGFyZSBpbmNvbXBhcmFibGVgXG4gICksXG4gIC8qXG5cblxuXG5cblxuXG5cbiAgICovXG4gIG1heDogKHgsIHksIGJyYW5kID0gdm9pZCAwKSA9PiAoXG4gICAgLy9cbiAgICBpc0dURTIoeCwgeSwgYnJhbmQpID8geCA6IGlzR1RFMih5LCB4KSA/IHkgOiB0aHJvd1JlZGFjdGVkYCR7eH0gYW5kICR7eX0gYXJlIGluY29tcGFyYWJsZWBcbiAgKVxufTtcbmhhcmRlbihBbW91bnRNYXRoMik7XG52YXIgZ2V0QXNzZXRLaW5kMiA9IChhbW91bnQpID0+IHtcbiAgYXNzZXJ0UmVjb3JkKGFtb3VudCwgXCJhbW91bnRcIik7XG4gIGNvbnN0IHsgdmFsdWUgfSA9IGFtb3VudDtcbiAgcmV0dXJuIGFzc2VydFZhbHVlR2V0QXNzZXRLaW5kMih2YWx1ZSk7XG59O1xuaGFyZGVuKGdldEFzc2V0S2luZDIpO1xuXG4vL1xudmFyIEJyYW5kU2hhcGUyID0gTS5yZW1vdGFibGUoXCJCcmFuZFwiKTtcbnZhciBJc3N1ZXJTaGFwZTIgPSBNLnJlbW90YWJsZShcIklzc3VlclwiKTtcbnZhciBQYXltZW50U2hhcGUyID0gTS5yZW1vdGFibGUoXCJQYXltZW50XCIpO1xudmFyIFB1cnNlU2hhcGUyID0gTS5yZW1vdGFibGUoXCJQdXJzZVwiKTtcbnZhciBEZXBvc2l0RmFjZXRTaGFwZTIgPSBNLnJlbW90YWJsZShcIkRlcG9zaXRGYWNldFwiKTtcbnZhciBOb3RpZmllclNoYXBlMiA9IE0ucmVtb3RhYmxlKFwiTm90aWZpZXJcIik7XG52YXIgTWludFNoYXBlMiA9IE0ucmVtb3RhYmxlKFwiTWludFwiKTtcbnZhciBOYXRWYWx1ZVNoYXBlMiA9IE0ubmF0KCk7XG52YXIgQ29weVNldFZhbHVlU2hhcGUyID0gTS5zZXQoKTtcbnZhciBTZXRWYWx1ZVNoYXBlMiA9IE0uYXJyYXlPZihNLmtleSgpKTtcbnZhciBDb3B5QmFnVmFsdWVTaGFwZTIgPSBNLmJhZygpO1xudmFyIEFtb3VudFZhbHVlU2hhcGUyID0gTS5vcihcbiAgTmF0VmFsdWVTaGFwZTIsXG4gIENvcHlTZXRWYWx1ZVNoYXBlMixcbiAgU2V0VmFsdWVTaGFwZTIsXG4gIENvcHlCYWdWYWx1ZVNoYXBlMlxuKTtcbnZhciBBbW91bnRTaGFwZTIgPSB7IGJyYW5kOiBCcmFuZFNoYXBlMiwgdmFsdWU6IEFtb3VudFZhbHVlU2hhcGUyIH07XG5oYXJkZW4oQW1vdW50U2hhcGUyKTtcbnZhciBBbW91bnRQYXR0ZXJuU2hhcGUyID0gTS5wYXR0ZXJuKCk7XG52YXIgUmF0aW9TaGFwZTIgPSB7IG51bWVyYXRvcjogQW1vdW50U2hhcGUyLCBkZW5vbWluYXRvcjogQW1vdW50U2hhcGUyIH07XG5oYXJkZW4oUmF0aW9TaGFwZTIpO1xudmFyIGlzTmF0VmFsdWUyID0gKHZhbHVlKSA9PiBtYXRjaGVzKHZhbHVlLCBOYXRWYWx1ZVNoYXBlMik7XG5oYXJkZW4oaXNOYXRWYWx1ZTIpO1xudmFyIGlzQ29weVNldFZhbHVlMiA9ICh2YWx1ZSkgPT4gbWF0Y2hlcyh2YWx1ZSwgQ29weVNldFZhbHVlU2hhcGUyKTtcbmhhcmRlbihpc0NvcHlTZXRWYWx1ZTIpO1xudmFyIGlzU2V0VmFsdWUyID0gKHZhbHVlKSA9PiBtYXRjaGVzKHZhbHVlLCBTZXRWYWx1ZVNoYXBlMik7XG5oYXJkZW4oaXNTZXRWYWx1ZTIpO1xudmFyIGlzQ29weUJhZ1ZhbHVlMiA9ICh2YWx1ZSkgPT4gbWF0Y2hlcyh2YWx1ZSwgQ29weUJhZ1ZhbHVlU2hhcGUyKTtcbmhhcmRlbihpc0NvcHlCYWdWYWx1ZTIpO1xudmFyIE1BWF9BQlNPTFVURV9ERUNJTUFMX1BMQUNFUzIgPSAxMDA7XG52YXIgQXNzZXRLaW5kU2hhcGUyID0gTS5vcihcIm5hdFwiLCBcInNldFwiLCBcImNvcHlTZXRcIiwgXCJjb3B5QmFnXCIpO1xudmFyIERpc3BsYXlJbmZvU2hhcGUyID0gTS5zcGxpdFJlY29yZChcbiAge30sXG4gIHtcbiAgICBkZWNpbWFsUGxhY2VzOiBNLmFuZChcbiAgICAgIE0uZ3RlKC1NQVhfQUJTT0xVVEVfREVDSU1BTF9QTEFDRVMyKSxcbiAgICAgIE0ubHRlKE1BWF9BQlNPTFVURV9ERUNJTUFMX1BMQUNFUzIpXG4gICAgKSxcbiAgICBhc3NldEtpbmQ6IEFzc2V0S2luZFNoYXBlMlxuICB9LFxuICB7XG4gICAgLy9cbiAgICAvL1xuICB9XG4pO1xudmFyIElzc3VlcktpdFNoYXBlMiA9IHtcbiAgYnJhbmQ6IEJyYW5kU2hhcGUyLFxuICBtaW50OiBNaW50U2hhcGUyLFxuICBtaW50UmVjb3ZlcnlQdXJzZTogUHVyc2VTaGFwZTIsXG4gIGlzc3VlcjogSXNzdWVyU2hhcGUyLFxuICBkaXNwbGF5SW5mbzogRGlzcGxheUluZm9TaGFwZTJcbn07XG5oYXJkZW4oSXNzdWVyS2l0U2hhcGUyKTtcbnZhciBCcmFuZEkyID0gTS5pbnRlcmZhY2UoXCJCcmFuZFwiLCB7XG4gIGlzTXlJc3N1ZXI6IE0uY2FsbFdoZW4oTS5hd2FpdChJc3N1ZXJTaGFwZTIpKS5yZXR1cm5zKE0uYm9vbGVhbigpKSxcbiAgZ2V0QWxsZWdlZE5hbWU6IE0uY2FsbCgpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gIGdldERpc3BsYXlJbmZvOiBNLmNhbGwoKS5yZXR1cm5zKERpc3BsYXlJbmZvU2hhcGUyKSxcbiAgZ2V0QW1vdW50U2hhcGU6IE0uY2FsbCgpLnJldHVybnMoTS5wYXR0ZXJuKCkpXG59KTtcbnZhciBtYWtlSXNzdWVySW50ZXJmYWNlczIgPSAoYnJhbmRTaGFwZSA9IEJyYW5kU2hhcGUyLCBhc3NldEtpbmRTaGFwZSA9IEFzc2V0S2luZFNoYXBlMiwgYW1vdW50U2hhcGUgPSBBbW91bnRTaGFwZTIpID0+IHtcbiAgY29uc3QgSXNzdWVySSA9IE0uaW50ZXJmYWNlKFwiSXNzdWVyXCIsIHtcbiAgICBnZXRCcmFuZDogTS5jYWxsKCkucmV0dXJucyhicmFuZFNoYXBlKSxcbiAgICBnZXRBbGxlZ2VkTmFtZTogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgICBnZXRBc3NldEtpbmQ6IE0uY2FsbCgpLnJldHVybnMoYXNzZXRLaW5kU2hhcGUpLFxuICAgIGdldERpc3BsYXlJbmZvOiBNLmNhbGwoKS5yZXR1cm5zKERpc3BsYXlJbmZvU2hhcGUyKSxcbiAgICBtYWtlRW1wdHlQdXJzZTogTS5jYWxsKCkucmV0dXJucyhQdXJzZVNoYXBlMiksXG4gICAgaXNMaXZlOiBNLmNhbGxXaGVuKE0uYXdhaXQoUGF5bWVudFNoYXBlMikpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICAgIGdldEFtb3VudE9mOiBNLmNhbGxXaGVuKE0uYXdhaXQoUGF5bWVudFNoYXBlMikpLnJldHVybnMoYW1vdW50U2hhcGUpLFxuICAgIGJ1cm46IE0uY2FsbFdoZW4oTS5hd2FpdChQYXltZW50U2hhcGUyKSkub3B0aW9uYWwoQW1vdW50UGF0dGVyblNoYXBlMikucmV0dXJucyhhbW91bnRTaGFwZSlcbiAgfSk7XG4gIGNvbnN0IE1pbnRJID0gTS5pbnRlcmZhY2UoXCJNaW50XCIsIHtcbiAgICBnZXRJc3N1ZXI6IE0uY2FsbCgpLnJldHVybnMoSXNzdWVyU2hhcGUyKSxcbiAgICBtaW50UGF5bWVudDogTS5jYWxsKGFtb3VudFNoYXBlKS5yZXR1cm5zKFBheW1lbnRTaGFwZTIpXG4gIH0pO1xuICBjb25zdCBQYXltZW50SSA9IE0uaW50ZXJmYWNlKFwiUGF5bWVudFwiLCB7XG4gICAgZ2V0QWxsZWdlZEJyYW5kOiBNLmNhbGwoKS5yZXR1cm5zKGJyYW5kU2hhcGUpXG4gIH0pO1xuICBjb25zdCBQdXJzZUkgPSBNLmludGVyZmFjZShcIlB1cnNlXCIsIHtcbiAgICBnZXRBbGxlZ2VkQnJhbmQ6IE0uY2FsbCgpLnJldHVybnMoYnJhbmRTaGFwZSksXG4gICAgZ2V0Q3VycmVudEFtb3VudDogTS5jYWxsKCkucmV0dXJucyhhbW91bnRTaGFwZSksXG4gICAgZ2V0Q3VycmVudEFtb3VudE5vdGlmaWVyOiBNLmNhbGwoKS5yZXR1cm5zKE5vdGlmaWVyU2hhcGUyKSxcbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIGRlcG9zaXQ6IE0uY2FsbChQYXltZW50U2hhcGUyKS5vcHRpb25hbChBbW91bnRQYXR0ZXJuU2hhcGUyKS5yZXR1cm5zKGFtb3VudFNoYXBlKSxcbiAgICBnZXREZXBvc2l0RmFjZXQ6IE0uY2FsbCgpLnJldHVybnMoRGVwb3NpdEZhY2V0U2hhcGUyKSxcbiAgICB3aXRoZHJhdzogTS5jYWxsKGFtb3VudFNoYXBlKS5yZXR1cm5zKFBheW1lbnRTaGFwZTIpLFxuICAgIGdldFJlY292ZXJ5U2V0OiBNLmNhbGwoKS5yZXR1cm5zKE0uc2V0T2YoUGF5bWVudFNoYXBlMikpLFxuICAgIHJlY292ZXJBbGw6IE0uY2FsbCgpLnJldHVybnMoYW1vdW50U2hhcGUpXG4gIH0pO1xuICBjb25zdCBEZXBvc2l0RmFjZXRJID0gTS5pbnRlcmZhY2UoXCJEZXBvc2l0RmFjZXRcIiwge1xuICAgIHJlY2VpdmU6IGdldEludGVyZmFjZUd1YXJkUGF5bG9hZChQdXJzZUkpLm1ldGhvZEd1YXJkcy5kZXBvc2l0XG4gIH0pO1xuICBjb25zdCBQdXJzZUlLaXQgPSB7XG4gICAgcHVyc2U6IFB1cnNlSSxcbiAgICBkZXBvc2l0RmFjZXQ6IERlcG9zaXRGYWNldElcbiAgfTtcbiAgaGFyZGVuKFB1cnNlSUtpdCk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIElzc3VlckksXG4gICAgTWludEksXG4gICAgUGF5bWVudEksXG4gICAgUHVyc2VJS2l0XG4gIH0pO1xufTtcbmhhcmRlbihtYWtlSXNzdWVySW50ZXJmYWNlczIpO1xuXG4vL1xudmFyIGNvZXJjZURpc3BsYXlJbmZvMiA9IChhbGxlZ2VkRGlzcGxheUluZm8sIGFzc2V0S2luZCkgPT4ge1xuICBtdXN0TWF0Y2gyKGFsbGVnZWREaXNwbGF5SW5mbywgRGlzcGxheUluZm9TaGFwZTIsIFwiZGlzcGxheUluZm9cIik7XG4gIGlmIChhbGxlZ2VkRGlzcGxheUluZm8uYXNzZXRLaW5kICE9PSB2b2lkIDApIHtcbiAgICBhbGxlZ2VkRGlzcGxheUluZm8uYXNzZXRLaW5kID09PSBhc3NldEtpbmQgfHwgdGhyb3dSZWRhY3RlZGBkaXNwbGF5SW5mby5hc3NldEtpbmQgd2FzIHByZXNlbnQgKCR7YWxsZWdlZERpc3BsYXlJbmZvLmFzc2V0S2luZH0pIGFuZCBkaWQgbm90IG1hdGNoIHRoZSBhc3NldEtpbmQgYXJndW1lbnQgKCR7YXNzZXRLaW5kfSlgO1xuICB9XG4gIGNvbnN0IGRpc3BsYXlJbmZvID0gaGFyZGVuKHsgLi4uYWxsZWdlZERpc3BsYXlJbmZvLCBhc3NldEtpbmQgfSk7XG4gIGlmIChkaXNwbGF5SW5mby5kZWNpbWFsUGxhY2VzICE9PSB2b2lkIDApIHtcbiAgICBOdW1iZXIuaXNTYWZlSW50ZWdlcihkaXNwbGF5SW5mby5kZWNpbWFsUGxhY2VzKSB8fCB0aHJvd1JlZGFjdGVkYGRlY2ltYWxQbGFjZXMgJHtkaXNwbGF5SW5mby5kZWNpbWFsUGxhY2VzfSBpcyBub3QgYSBzYWZlIGludGVnZXJgO1xuICB9XG4gIHJldHVybiBkaXNwbGF5SW5mbztcbn07XG5cbi8vXG52YXIgcHJlcGFyZVBheW1lbnRLaW5kMiA9IChpc3N1ZXJab25lLCBuYW1lLCBicmFuZCwgUGF5bWVudEkpID0+IHtcbiAgY29uc3QgbWFrZVBheW1lbnQgPSBpc3N1ZXJab25lLmV4b0NsYXNzKFxuICAgIGAke25hbWV9IHBheW1lbnRgLFxuICAgIFBheW1lbnRJLFxuICAgIGluaXRFbXB0eSxcbiAgICB7XG4gICAgICBnZXRBbGxlZ2VkQnJhbmQoKSB7XG4gICAgICAgIHJldHVybiBicmFuZDtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiBtYWtlUGF5bWVudDtcbn07XG5oYXJkZW4ocHJlcGFyZVBheW1lbnRLaW5kMik7XG5cbi8vXG52YXIgbWFrZVRyYW5zaWVudE5vdGlmaWVyS2l0MiA9ICgpID0+IHtcbiAgY29uc3QgdHJhbnNpZW50Tm90aWZlcktpdHMgPSBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlKFxuICAgIFwidHJhbnNpZW50Tm90aWZlcktpdHNcIlxuICApO1xuICBjb25zdCBwcm92aWRlTm90aWZpZXJLaXQgPSAoa2V5KSA9PiBwcm92aWRlTGF6eTMoXG4gICAgdHJhbnNpZW50Tm90aWZlcktpdHMsXG4gICAga2V5LFxuICAgICgpID0+IG1ha2VOb3RpZmllcktpdChrZXkuZ2V0Q3VycmVudEFtb3VudCgpKVxuICApO1xuICBjb25zdCBwcm92aWRlTm90aWZpZXIgPSAoa2V5KSA9PiBwcm92aWRlTm90aWZpZXJLaXQoa2V5KS5ub3RpZmllcjtcbiAgY29uc3QgdXBkYXRlID0gKGtleSwgbmV3VmFsdWUpID0+IHtcbiAgICBpZiAodHJhbnNpZW50Tm90aWZlcktpdHMuaGFzKGtleSkpIHtcbiAgICAgIGNvbnN0IHsgdXBkYXRlciB9ID0gdHJhbnNpZW50Tm90aWZlcktpdHMuZ2V0KGtleSk7XG4gICAgICB1cGRhdGVyLnVwZGF0ZVN0YXRlKG5ld1ZhbHVlKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiB7IHByb3ZpZGVOb3RpZmllciwgdXBkYXRlIH07XG59O1xuaGFyZGVuKG1ha2VUcmFuc2llbnROb3RpZmllcktpdDIpO1xuXG4vL1xudmFyIG1ha2VBbW91bnRTdG9yZTIgPSAoc3RhdGUsIGtleSkgPT4ge1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBnZXRBbW91bnQ6ICgpID0+IHN0YXRlW2tleV0sXG4gICAgaW5jcmVtZW50OiAoZGVsdGEpID0+IHtcbiAgICAgIHN0YXRlW2tleV0gPSBBbW91bnRNYXRoMi5hZGQoc3RhdGVba2V5XSwgZGVsdGEpO1xuICAgIH0sXG4gICAgZGVjcmVtZW50OiAoZGVsdGEpID0+IHtcbiAgICAgIGlmIChBbW91bnRNYXRoMi5pc0dURShzdGF0ZVtrZXldLCBkZWx0YSkpIHtcbiAgICAgICAgc3RhdGVba2V5XSA9IEFtb3VudE1hdGgyLnN1YnRyYWN0KHN0YXRlW2tleV0sIGRlbHRhKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUFtb3VudFN0b3JlMik7XG5cbi8vXG52YXIgRU1QVFlfQ09QWV9TRVQyID0gbWFrZUNvcHlTZXQoW10pO1xudmFyIHByZXBhcmVQdXJzZUtpbmQyID0gKGlzc3VlclpvbmUsIG5hbWUsIGFzc2V0S2luZCwgYnJhbmQsIFB1cnNlSUtpdCwgcHVyc2VNZXRob2RzLCByZWNvdmVyeVNldHNTdGF0ZSwgcGF5bWVudFJlY292ZXJ5U2V0cykgPT4ge1xuICBjb25zdCBhbW91bnRTaGFwZSA9IGJyYW5kLmdldEFtb3VudFNoYXBlKCk7XG4gIGNvbnN0IHsgcHJvdmlkZU5vdGlmaWVyLCB1cGRhdGU6IHVwZGF0ZUJhbGFuY2UgfSA9IG1ha2VUcmFuc2llbnROb3RpZmllcktpdDIoKTtcbiAgY29uc3QgbWF5YmVSZWNvdmVyeVNldCA9IChzdGF0ZSkgPT4ge1xuICAgIGNvbnN0IHsgcmVjb3ZlcnlTZXQgfSA9IHN0YXRlO1xuICAgIGlmIChyZWNvdmVyeVNldHNTdGF0ZSA9PT0gXCJoYXNSZWNvdmVyeVNldHNcIikge1xuICAgICAgcmV0dXJuIHJlY292ZXJ5U2V0O1xuICAgIH0gZWxzZSB7XG4gICAgICByZWNvdmVyeVNldHNTdGF0ZSA9PT0gXCJub1JlY292ZXJ5U2V0c1wiIHx8IHRocm93UmVkYWN0ZWRgcmVjb3ZlclNldHNTdGF0ZSBtdXN0IGJlIG5vUmVjb3ZlcnlTZXRzIGlmIGl0IGlzbid0IGhhc1JlY292ZXJTZXRzYDtcbiAgICAgIHBheW1lbnRSZWNvdmVyeVNldHMgIT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYHBheW1lbnRSZWNvdmVyeVNldHMgbXVzdCBhbHdheXMgYmUgZGVmaW5lZGA7XG4gICAgICByZWNvdmVyeVNldC5nZXRTaXplKCkgPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBXaXRoIG5vUmVjb3ZlcnlTZXRzLCByZWNvdmVyeVNldCBtdXN0IGJlIGVtcHR5YDtcbiAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgfVxuICB9O1xuICBjb25zdCB7IGRlcG9zaXRJbnRlcm5hbCwgd2l0aGRyYXdJbnRlcm5hbCB9ID0gcHVyc2VNZXRob2RzO1xuICBjb25zdCBtYWtlUHVyc2VLaXQgPSBpc3N1ZXJab25lLmV4b0NsYXNzS2l0KFxuICAgIGAke25hbWV9IFB1cnNlYCxcbiAgICBQdXJzZUlLaXQsXG4gICAgKCkgPT4ge1xuICAgICAgY29uc3QgY3VycmVudEJhbGFuY2UgPSBBbW91bnRNYXRoMi5tYWtlRW1wdHkoYnJhbmQsIGFzc2V0S2luZCk7XG4gICAgICBjb25zdCByZWNvdmVyeVNldCA9IGlzc3VlclpvbmUuZGV0YWNoZWQoKS5zZXRTdG9yZShcInJlY292ZXJ5IHNldFwiKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGN1cnJlbnRCYWxhbmNlLFxuICAgICAgICByZWNvdmVyeVNldFxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIHB1cnNlOiB7XG4gICAgICAgIGRlcG9zaXQoc3JjUGF5bWVudCwgb3B0QW1vdW50U2hhcGUgPSB2b2lkIDApIHtcbiAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgIGNvbnN0IHsgcHVyc2UgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IGJhbGFuY2VTdG9yZSA9IG1ha2VBbW91bnRTdG9yZTIoc3RhdGUsIFwiY3VycmVudEJhbGFuY2VcIik7XG4gICAgICAgICAgY29uc3Qgc3JjUGF5bWVudEJhbGFuY2UgPSBkZXBvc2l0SW50ZXJuYWwoXG4gICAgICAgICAgICBiYWxhbmNlU3RvcmUsXG4gICAgICAgICAgICBzcmNQYXltZW50LFxuICAgICAgICAgICAgb3B0QW1vdW50U2hhcGVcbiAgICAgICAgICApO1xuICAgICAgICAgIHVwZGF0ZUJhbGFuY2UocHVyc2UsIGJhbGFuY2VTdG9yZS5nZXRBbW91bnQoKSk7XG4gICAgICAgICAgcmV0dXJuIHNyY1BheW1lbnRCYWxhbmNlO1xuICAgICAgICB9LFxuICAgICAgICB3aXRoZHJhdyhhbW91bnQpIHtcbiAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgIGNvbnN0IHsgcHVyc2UgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IG9wdFJlY292ZXJ5U2V0ID0gbWF5YmVSZWNvdmVyeVNldChzdGF0ZSk7XG4gICAgICAgICAgY29uc3QgYmFsYW5jZVN0b3JlID0gbWFrZUFtb3VudFN0b3JlMihzdGF0ZSwgXCJjdXJyZW50QmFsYW5jZVwiKTtcbiAgICAgICAgICBjb25zdCBwYXltZW50ID0gd2l0aGRyYXdJbnRlcm5hbChcbiAgICAgICAgICAgIGJhbGFuY2VTdG9yZSxcbiAgICAgICAgICAgIGFtb3VudCxcbiAgICAgICAgICAgIG9wdFJlY292ZXJ5U2V0XG4gICAgICAgICAgKTtcbiAgICAgICAgICB1cGRhdGVCYWxhbmNlKHB1cnNlLCBiYWxhbmNlU3RvcmUuZ2V0QW1vdW50KCkpO1xuICAgICAgICAgIHJldHVybiBwYXltZW50O1xuICAgICAgICB9LFxuICAgICAgICBnZXRDdXJyZW50QW1vdW50KCkge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgY29uc3QgYmFsYW5jZVN0b3JlID0gbWFrZUFtb3VudFN0b3JlMihzdGF0ZSwgXCJjdXJyZW50QmFsYW5jZVwiKTtcbiAgICAgICAgICByZXR1cm4gYmFsYW5jZVN0b3JlLmdldEFtb3VudCgpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRDdXJyZW50QW1vdW50Tm90aWZpZXIoKSB7XG4gICAgICAgICAgcmV0dXJuIHByb3ZpZGVOb3RpZmllcih0aGlzLmZhY2V0cy5wdXJzZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEFsbGVnZWRCcmFuZCgpIHtcbiAgICAgICAgICByZXR1cm4gYnJhbmQ7XG4gICAgICAgIH0sXG4gICAgICAgIGdldERlcG9zaXRGYWNldCgpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5mYWNldHMuZGVwb3NpdEZhY2V0O1xuICAgICAgICB9LFxuICAgICAgICBnZXRSZWNvdmVyeVNldCgpIHtcbiAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgIGNvbnN0IG9wdFJlY292ZXJ5U2V0ID0gbWF5YmVSZWNvdmVyeVNldChzdGF0ZSk7XG4gICAgICAgICAgaWYgKG9wdFJlY292ZXJ5U2V0ID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgIHJldHVybiBFTVBUWV9DT1BZX1NFVDI7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBvcHRSZWNvdmVyeVNldC5zbmFwc2hvdCgpO1xuICAgICAgICB9LFxuICAgICAgICByZWNvdmVyQWxsKCkge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICBsZXQgYW1vdW50ID0gQW1vdW50TWF0aDIubWFrZUVtcHR5KGJyYW5kLCBhc3NldEtpbmQpO1xuICAgICAgICAgIGNvbnN0IG9wdFJlY292ZXJ5U2V0ID0gbWF5YmVSZWNvdmVyeVNldChzdGF0ZSk7XG4gICAgICAgICAgaWYgKG9wdFJlY292ZXJ5U2V0ID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgIHJldHVybiBhbW91bnQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvciAoY29uc3QgcGF5bWVudCBvZiBvcHRSZWNvdmVyeVNldC5rZXlzKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGRlbHRhID0gZmFjZXRzLnB1cnNlLmRlcG9zaXQocGF5bWVudCk7XG4gICAgICAgICAgICBhbW91bnQgPSBBbW91bnRNYXRoMi5hZGQoYW1vdW50LCBkZWx0YSwgYnJhbmQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBvcHRSZWNvdmVyeVNldC5nZXRTaXplKCkgPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogUmVtYWluaW5nIHVucmVjb3ZlcmVkIHBheW1lbnRzOiAke2ZhY2V0cy5wdXJzZS5nZXRSZWNvdmVyeVNldCgpfWA7XG4gICAgICAgICAgcmV0dXJuIGFtb3VudDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlcG9zaXRGYWNldDoge1xuICAgICAgICByZWNlaXZlKC4uLmFyZ3MpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5mYWNldHMucHVyc2UuZGVwb3NpdCguLi5hcmdzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgc3RhdGVTaGFwZToge1xuICAgICAgICBjdXJyZW50QmFsYW5jZTogYW1vdW50U2hhcGUsXG4gICAgICAgIHJlY292ZXJ5U2V0OiBNLnJlbW90YWJsZShcInJlY292ZXJ5U2V0XCIpXG4gICAgICB9XG4gICAgfVxuICApO1xuICByZXR1cm4gKCkgPT4gbWFrZVB1cnNlS2l0KCkucHVyc2U7XG59O1xuaGFyZGVuKHByZXBhcmVQdXJzZUtpbmQyKTtcblxuLy9cbnZhciBhbW91bnRTaGFwZUZyb21FbGVtZW50U2hhcGUyID0gKGJyYW5kLCBhc3NldEtpbmQsIGVsZW1lbnRTaGFwZSkgPT4ge1xuICBsZXQgdmFsdWVTaGFwZTtcbiAgc3dpdGNoIChhc3NldEtpbmQpIHtcbiAgICBjYXNlIFwibmF0XCI6IHtcbiAgICAgIHZhbHVlU2hhcGUgPSBNLm5hdCgpO1xuICAgICAgZWxlbWVudFNoYXBlID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBGdW5naWJsZSBhc3NldHMgY2Fubm90IGhhdmUgYW4gZWxlbWVudFNoYXBlOiAke3F1b3RlKGVsZW1lbnRTaGFwZSl9YDtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIFwic2V0XCI6IHtcbiAgICAgIGlmIChlbGVtZW50U2hhcGUgPT09IHZvaWQgMCkge1xuICAgICAgICB2YWx1ZVNoYXBlID0gTS5hcnJheU9mKE0ua2V5KCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWVTaGFwZSA9IE0uYXJyYXlPZihNLmFuZChNLmtleSgpLCBlbGVtZW50U2hhcGUpKTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIFwiY29weVNldFwiOiB7XG4gICAgICBpZiAoZWxlbWVudFNoYXBlID09PSB2b2lkIDApIHtcbiAgICAgICAgdmFsdWVTaGFwZSA9IE0uc2V0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZVNoYXBlID0gTS5zZXRPZihlbGVtZW50U2hhcGUpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgXCJjb3B5QmFnXCI6IHtcbiAgICAgIGlmIChlbGVtZW50U2hhcGUgPT09IHZvaWQgMCkge1xuICAgICAgICB2YWx1ZVNoYXBlID0gTS5iYWcoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlU2hhcGUgPSBNLmJhZ09mKGVsZW1lbnRTaGFwZSk7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIGFzc2V0IGtpbmQgJHtxdW90ZShhc3NldEtpbmQpfWA7XG4gICAgfVxuICB9XG4gIGNvbnN0IGFtb3VudFNoYXBlID0gaGFyZGVuKHtcbiAgICBicmFuZCxcbiAgICAvL1xuICAgIHZhbHVlOiB2YWx1ZVNoYXBlXG4gIH0pO1xuICByZXR1cm4gYW1vdW50U2hhcGU7XG59O1xudmFyIHByZXBhcmVQYXltZW50TGVkZ2VyMiA9IChpc3N1ZXJab25lLCBuYW1lLCBhc3NldEtpbmQsIGRpc3BsYXlJbmZvLCBlbGVtZW50U2hhcGUsIHJlY292ZXJ5U2V0c1N0YXRlLCBvcHRTaHV0ZG93bldpdGhGYWlsdXJlID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IGJyYW5kID0gaXNzdWVyWm9uZS5leG8oYCR7bmFtZX0gYnJhbmRgLCBCcmFuZEkyLCB7XG4gICAgaXNNeUlzc3VlcihhbGxlZ2VkSXNzdWVyKSB7XG4gICAgICByZXR1cm4gYWxsZWdlZElzc3VlciA9PT0gaXNzdWVyO1xuICAgIH0sXG4gICAgZ2V0QWxsZWdlZE5hbWUoKSB7XG4gICAgICByZXR1cm4gbmFtZTtcbiAgICB9LFxuICAgIC8vXG4gICAgZ2V0RGlzcGxheUluZm8oKSB7XG4gICAgICByZXR1cm4gZGlzcGxheUluZm87XG4gICAgfSxcbiAgICBnZXRBbW91bnRTaGFwZSgpIHtcbiAgICAgIHJldHVybiBhbW91bnRTaGFwZTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBhbW91bnRTaGFwZSA9IGFtb3VudFNoYXBlRnJvbUVsZW1lbnRTaGFwZTIoXG4gICAgYnJhbmQsXG4gICAgYXNzZXRLaW5kLFxuICAgIGVsZW1lbnRTaGFwZVxuICApO1xuICBjb25zdCB7IElzc3VlckksIE1pbnRJLCBQYXltZW50SSwgUHVyc2VJS2l0IH0gPSBtYWtlSXNzdWVySW50ZXJmYWNlczIoXG4gICAgYnJhbmQsXG4gICAgYXNzZXRLaW5kLFxuICAgIGFtb3VudFNoYXBlXG4gICk7XG4gIGNvbnN0IG1ha2VQYXltZW50ID0gcHJlcGFyZVBheW1lbnRLaW5kMihpc3N1ZXJab25lLCBuYW1lLCBicmFuZCwgUGF5bWVudEkpO1xuICBjb25zdCBzaHV0ZG93bkxlZGdlcldpdGhGYWlsdXJlID0gKHJlYXNvbikgPT4ge1xuICAgIGlmIChvcHRTaHV0ZG93bldpdGhGYWlsdXJlICE9PSB2b2lkIDApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmUocmVhc29uKTtcbiAgICAgIH0gY2F0Y2ggKGVyckluU2h1dGRvd24pIHtcbiAgICAgICAgbm90ZShlcnJJblNodXRkb3duLCByZWRhY3RlZGBDYXVzZWQgYnk6ICR7cmVhc29ufWApO1xuICAgICAgICB0aHJvdyBlcnJJblNodXRkb3duO1xuICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyByZWFzb247XG4gIH07XG4gIGNvbnN0IHBheW1lbnRMZWRnZXIgPSBpc3N1ZXJab25lLndlYWtNYXBTdG9yZShcInBheW1lbnRMZWRnZXJcIiwge1xuICAgIHZhbHVlU2hhcGU6IGFtb3VudFNoYXBlXG4gIH0pO1xuICBjb25zdCBwYXltZW50UmVjb3ZlcnlTZXRzID0gaXNzdWVyWm9uZS53ZWFrTWFwU3RvcmUoXCJwYXltZW50UmVjb3ZlcnlTZXRzXCIpO1xuICBjb25zdCBpbml0UGF5bWVudCA9IChwYXltZW50LCBhbW91bnQsIG9wdFJlY292ZXJ5U2V0ID0gdm9pZCAwKSA9PiB7XG4gICAgaWYgKHJlY292ZXJ5U2V0c1N0YXRlID09PSBcIm5vUmVjb3ZlcnlTZXRzXCIpIHtcbiAgICAgIG9wdFJlY292ZXJ5U2V0ID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGB3aGVuIHJlY292ZXJTZXRzU3RhdGUgPT09ICdub1JlY292ZXJ5U2V0cycsIG9wdFJlY292ZXJ5U2V0IG11c3QgYmUgZW1wdHlgO1xuICAgIH1cbiAgICBpZiAob3B0UmVjb3ZlcnlTZXQgIT09IHZvaWQgMCAmJiAhQW1vdW50TWF0aDIuaXNFbXB0eShhbW91bnQpKSB7XG4gICAgICBvcHRSZWNvdmVyeVNldC5hZGQocGF5bWVudCk7XG4gICAgICBwYXltZW50UmVjb3ZlcnlTZXRzLmluaXQocGF5bWVudCwgb3B0UmVjb3ZlcnlTZXQpO1xuICAgIH1cbiAgICBwYXltZW50TGVkZ2VyLmluaXQocGF5bWVudCwgYW1vdW50KTtcbiAgfTtcbiAgY29uc3QgZGVsZXRlUGF5bWVudCA9IChwYXltZW50KSA9PiB7XG4gICAgcGF5bWVudExlZGdlci5kZWxldGUocGF5bWVudCk7XG4gICAgaWYgKHBheW1lbnRSZWNvdmVyeVNldHMuaGFzKHBheW1lbnQpKSB7XG4gICAgICBjb25zdCByZWNvdmVyeVNldCA9IHBheW1lbnRSZWNvdmVyeVNldHMuZ2V0KHBheW1lbnQpO1xuICAgICAgcGF5bWVudFJlY292ZXJ5U2V0cy5kZWxldGUocGF5bWVudCk7XG4gICAgICByZWNvdmVyeVNldC5kZWxldGUocGF5bWVudCk7XG4gICAgfVxuICB9O1xuICBjb25zdCBjb2VyY2UgPSAoYWxsZWdlZEFtb3VudCkgPT4gQW1vdW50TWF0aDIuY29lcmNlKGJyYW5kLCBhbGxlZ2VkQW1vdW50KTtcbiAgY29uc3QgYXNzZXJ0QW1vdW50Q29uc2lzdGVudCA9IChwYXltZW50QmFsYW5jZSwgb3B0QW1vdW50U2hhcGUpID0+IHtcbiAgICBpZiAob3B0QW1vdW50U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKHBheW1lbnRCYWxhbmNlLCBvcHRBbW91bnRTaGFwZSwgXCJhbW91bnRcIik7XG4gICAgfVxuICB9O1xuICBjb25zdCBhc3NlcnRMaXZlUGF5bWVudCA9IChwYXltZW50KSA9PiB7XG4gICAgcGF5bWVudExlZGdlci5oYXMocGF5bWVudCkgfHwgdGhyb3dSZWRhY3RlZGAke3BheW1lbnR9IHdhcyBub3QgYSBsaXZlIHBheW1lbnQgZm9yIGJyYW5kICR7cXVvdGUoXG4gICAgICBicmFuZFxuICAgICl9LiBJdCBjb3VsZCBiZSBhIHVzZWQtdXAgcGF5bWVudCwgYSBwYXltZW50IGZvciBhbm90aGVyIGJyYW5kLCBvciBpdCBtaWdodCBub3QgYmUgYSBwYXltZW50IGF0IGFsbC5gO1xuICB9O1xuICBjb25zdCBkZXBvc2l0SW50ZXJuYWwgPSAoYmFsYW5jZVN0b3JlLCBzcmNQYXltZW50LCBvcHRBbW91bnRTaGFwZSA9IHZvaWQgMCkgPT4ge1xuICAgICFpc1Byb21pc2Uoc3JjUGF5bWVudCkgfHwgYXNzZXJ0LmZhaWwoXG4gICAgICBgZGVwb3NpdCBkb2VzIG5vdCBhY2NlcHQgcHJvbWlzZXMgYXMgZmlyc3QgYXJndW1lbnQuIEluc3RlYWQgb2YgcGFzc2luZyB0aGUgcHJvbWlzZSAoZGVwb3NpdChwYXltZW50UHJvbWlzZSkpLCBjb25zaWRlciB1bndyYXBwaW5nIHRoZSBwcm9taXNlIGZpcnN0OiBFLndoZW4ocGF5bWVudFByb21pc2UsIChhY3R1YWxQYXltZW50ID0+IGRlcG9zaXQoYWN0dWFsUGF5bWVudCkpYCxcbiAgICAgIFR5cGVFcnJvclxuICAgICk7XG4gICAgYXNzZXJ0TGl2ZVBheW1lbnQoc3JjUGF5bWVudCk7XG4gICAgY29uc3Qgc3JjUGF5bWVudEJhbGFuY2UgPSBwYXltZW50TGVkZ2VyLmdldChzcmNQYXltZW50KTtcbiAgICBhc3NlcnRBbW91bnRDb25zaXN0ZW50KHNyY1BheW1lbnRCYWxhbmNlLCBvcHRBbW91bnRTaGFwZSk7XG4gICAgdHJ5IHtcbiAgICAgIGRlbGV0ZVBheW1lbnQoc3JjUGF5bWVudCk7XG4gICAgICBiYWxhbmNlU3RvcmUuaW5jcmVtZW50KHNyY1BheW1lbnRCYWxhbmNlKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHNodXRkb3duTGVkZ2VyV2l0aEZhaWx1cmUoZXJyKTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgcmV0dXJuIHNyY1BheW1lbnRCYWxhbmNlO1xuICB9O1xuICBjb25zdCB3aXRoZHJhd0ludGVybmFsID0gKGJhbGFuY2VTdG9yZSwgYW1vdW50LCByZWNvdmVyeVNldCA9IHZvaWQgMCkgPT4ge1xuICAgIGFtb3VudCA9IGNvZXJjZShhbW91bnQpO1xuICAgIGNvbnN0IHBheW1lbnQgPSBtYWtlUGF5bWVudCgpO1xuICAgIGJhbGFuY2VTdG9yZS5kZWNyZW1lbnQoYW1vdW50KSB8fCB0aHJvd1JlZGFjdGVkYFdpdGhkcmF3YWwgb2YgJHthbW91bnR9IGZhaWxlZCBiZWNhdXNlIHRoZSBwdXJzZSBvbmx5IGNvbnRhaW5lZCAke2JhbGFuY2VTdG9yZS5nZXRBbW91bnQoKX1gO1xuICAgIHRyeSB7XG4gICAgICBpbml0UGF5bWVudChwYXltZW50LCBhbW91bnQsIHJlY292ZXJ5U2V0KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHNodXRkb3duTGVkZ2VyV2l0aEZhaWx1cmUoZXJyKTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgcmV0dXJuIHBheW1lbnQ7XG4gIH07XG4gIGNvbnN0IG1ha2VFbXB0eVB1cnNlID0gcHJlcGFyZVB1cnNlS2luZDIoXG4gICAgaXNzdWVyWm9uZSxcbiAgICBuYW1lLFxuICAgIGFzc2V0S2luZCxcbiAgICBicmFuZCxcbiAgICBQdXJzZUlLaXQsXG4gICAgaGFyZGVuKHtcbiAgICAgIGRlcG9zaXRJbnRlcm5hbCxcbiAgICAgIHdpdGhkcmF3SW50ZXJuYWxcbiAgICB9KSxcbiAgICByZWNvdmVyeVNldHNTdGF0ZSxcbiAgICBwYXltZW50UmVjb3ZlcnlTZXRzXG4gICk7XG4gIGNvbnN0IGlzc3VlciA9IGlzc3VlclpvbmUuZXhvKGAke25hbWV9IGlzc3VlcmAsIElzc3VlckksIHtcbiAgICBnZXRCcmFuZCgpIHtcbiAgICAgIHJldHVybiBicmFuZDtcbiAgICB9LFxuICAgIGdldEFsbGVnZWROYW1lKCkge1xuICAgICAgcmV0dXJuIG5hbWU7XG4gICAgfSxcbiAgICBnZXRBc3NldEtpbmQoKSB7XG4gICAgICByZXR1cm4gYXNzZXRLaW5kO1xuICAgIH0sXG4gICAgZ2V0RGlzcGxheUluZm8oKSB7XG4gICAgICByZXR1cm4gZGlzcGxheUluZm87XG4gICAgfSxcbiAgICBtYWtlRW1wdHlQdXJzZSgpIHtcbiAgICAgIHJldHVybiBtYWtlRW1wdHlQdXJzZSgpO1xuICAgIH0sXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgaXNMaXZlKHBheW1lbnQpIHtcbiAgICAgIHJldHVybiBwYXltZW50TGVkZ2VyLmhhcyhwYXltZW50KTtcbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGdldEFtb3VudE9mKHBheW1lbnQpIHtcbiAgICAgIGFzc2VydExpdmVQYXltZW50KHBheW1lbnQpO1xuICAgICAgcmV0dXJuIHBheW1lbnRMZWRnZXIuZ2V0KHBheW1lbnQpO1xuICAgIH0sXG4gICAgLypcblxuXG4gICAgICovXG4gICAgYnVybihwYXltZW50LCBvcHRBbW91bnRTaGFwZSA9IHZvaWQgMCkge1xuICAgICAgYXNzZXJ0TGl2ZVBheW1lbnQocGF5bWVudCk7XG4gICAgICBjb25zdCBwYXltZW50QmFsYW5jZSA9IHBheW1lbnRMZWRnZXIuZ2V0KHBheW1lbnQpO1xuICAgICAgYXNzZXJ0QW1vdW50Q29uc2lzdGVudChwYXltZW50QmFsYW5jZSwgb3B0QW1vdW50U2hhcGUpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgZGVsZXRlUGF5bWVudChwYXltZW50KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBzaHV0ZG93bkxlZGdlcldpdGhGYWlsdXJlKGVycik7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwYXltZW50QmFsYW5jZTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBtaW50UmVjb3ZlcnlQdXJzZSA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICAgIGlzc3VlclpvbmUubWFrZU9uY2UoXCJtaW50UmVjb3ZlcnlQdXJzZVwiLCAoKSA9PiBtYWtlRW1wdHlQdXJzZSgpKVxuICApO1xuICBjb25zdCBtaW50ID0gaXNzdWVyWm9uZS5leG8oYCR7bmFtZX0gbWludGAsIE1pbnRJLCB7XG4gICAgZ2V0SXNzdWVyKCkge1xuICAgICAgcmV0dXJuIGlzc3VlcjtcbiAgICB9LFxuICAgIG1pbnRQYXltZW50KG5ld0Ftb3VudCkge1xuICAgICAgbmV3QW1vdW50ID0gY29lcmNlKG5ld0Ftb3VudCk7XG4gICAgICBtdXN0TWF0Y2gobmV3QW1vdW50LCBhbW91bnRTaGFwZSwgXCJtaW50ZWQgYW1vdW50XCIpO1xuICAgICAgY29uc3QgcmF3UGF5bWVudCA9IG1ha2VQYXltZW50KCk7XG4gICAgICBpbml0UGF5bWVudChyYXdQYXltZW50LCBuZXdBbW91bnQsIHZvaWQgMCk7XG4gICAgICBjb25zdCBtaW50UmVjb3ZlcnlQdXJzZUJlZm9yZSA9IG1pbnRSZWNvdmVyeVB1cnNlLmdldEN1cnJlbnRBbW91bnQoKTtcbiAgICAgIG1pbnRSZWNvdmVyeVB1cnNlLmRlcG9zaXQocmF3UGF5bWVudCwgbmV3QW1vdW50KTtcbiAgICAgIGNvbnN0IHBheW1lbnQgPSBtaW50UmVjb3ZlcnlQdXJzZS53aXRoZHJhdyhuZXdBbW91bnQpO1xuICAgICAgY29uc3QgbWludFJlY292ZXJ5UHVyc2VBZnRlciA9IG1pbnRSZWNvdmVyeVB1cnNlLmdldEN1cnJlbnRBbW91bnQoKTtcbiAgICAgIGFzc2VydChrZXlFUShtaW50UmVjb3ZlcnlQdXJzZUJlZm9yZSwgbWludFJlY292ZXJ5UHVyc2VBZnRlcikpO1xuICAgICAgcmV0dXJuIHBheW1lbnQ7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgaXNzdWVyS2l0ID0gaGFyZGVuKHsgaXNzdWVyLCBtaW50LCBicmFuZCwgbWludFJlY292ZXJ5UHVyc2UgfSk7XG4gIHJldHVybiBpc3N1ZXJLaXQ7XG59O1xuaGFyZGVuKHByZXBhcmVQYXltZW50TGVkZ2VyMik7XG5cbi8vXG52YXIgc2V0dXBJc3N1ZXJLaXQyID0gKHsgbmFtZSwgYXNzZXRLaW5kLCBkaXNwbGF5SW5mbywgZWxlbWVudFNoYXBlIH0sIGlzc3VlclpvbmUsIHJlY292ZXJ5U2V0c1N0YXRlLCBvcHRTaHV0ZG93bldpdGhGYWlsdXJlID0gdm9pZCAwKSA9PiB7XG4gIGFzc2VydDIudHlwZW9mKG5hbWUsIFwic3RyaW5nXCIpO1xuICBhc3NlcnRBc3NldEtpbmQyKGFzc2V0S2luZCk7XG4gIGNvbnN0IGNsZWFuRGlzcGxheUluZm8gPSBjb2VyY2VEaXNwbGF5SW5mbzIoZGlzcGxheUluZm8sIGFzc2V0S2luZCk7XG4gIGlmIChvcHRTaHV0ZG93bldpdGhGYWlsdXJlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnQyLnR5cGVvZihvcHRTaHV0ZG93bldpdGhGYWlsdXJlLCBcImZ1bmN0aW9uXCIpO1xuICB9XG4gIGlmIChlbGVtZW50U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oZWxlbWVudFNoYXBlKTtcbiAgfVxuICBjb25zdCB7IGlzc3VlciwgbWludCwgYnJhbmQsIG1pbnRSZWNvdmVyeVB1cnNlIH0gPSBwcmVwYXJlUGF5bWVudExlZGdlcjIoXG4gICAgaXNzdWVyWm9uZSxcbiAgICBuYW1lLFxuICAgIGFzc2V0S2luZCxcbiAgICBjbGVhbkRpc3BsYXlJbmZvLFxuICAgIGVsZW1lbnRTaGFwZSxcbiAgICByZWNvdmVyeVNldHNTdGF0ZSxcbiAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlXG4gICk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGJyYW5kLFxuICAgIGlzc3VlcixcbiAgICBtaW50LFxuICAgIG1pbnRSZWNvdmVyeVB1cnNlLFxuICAgIGRpc3BsYXlJbmZvOiBjbGVhbkRpc3BsYXlJbmZvXG4gIH0pO1xufTtcbmhhcmRlbihzZXR1cElzc3VlcktpdDIpO1xudmFyIElOU1RBTkNFX0tFWTIgPSBcImlzc3VlclwiO1xudmFyIFJFQ09WRVJZX1NFVFNfU1RBVEUyID0gXCJyZWNvdmVyeVNldHNTdGF0ZVwiO1xudmFyIHVwZ3JhZGVJc3N1ZXJLaXQyID0gKGlzc3VlckJhZ2dhZ2UsIG9wdFNodXRkb3duV2l0aEZhaWx1cmUgPSB2b2lkIDAsIHJlY292ZXJ5U2V0c09wdGlvbiA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCBpc3N1ZXJSZWNvcmQgPSBpc3N1ZXJCYWdnYWdlLmdldChJTlNUQU5DRV9LRVkyKTtcbiAgY29uc3QgaXNzdWVyWm9uZSA9IG1ha2VEdXJhYmxlWm9uZShpc3N1ZXJCYWdnYWdlKTtcbiAgY29uc3Qgb2xkUmVjb3ZlcnlTZXRzU3RhdGUgPSBpc3N1ZXJCYWdnYWdlLmhhcyhSRUNPVkVSWV9TRVRTX1NUQVRFMikgPyBpc3N1ZXJCYWdnYWdlLmdldChSRUNPVkVSWV9TRVRTX1NUQVRFMikgOiBcImhhc1JlY292ZXJ5U2V0c1wiO1xuICBpZiAob2xkUmVjb3ZlcnlTZXRzU3RhdGUgPT09IFwibm9SZWNvdmVyeVNldHNcIiAmJiByZWNvdmVyeVNldHNPcHRpb24gPT09IFwiaGFzUmVjb3ZlcnlTZXRzXCIpIHtcbiAgICB0aHJvd1JlZGFjdGVkYENhbm5vdCAoeWV0PykgdXBncmFkZSBmcm9tICdub1JlY292ZXJ5U2V0cycgdG8gJ2hhc1JlY292ZXJ5U2V0cydgO1xuICB9XG4gIGNvbnN0IHJlY292ZXJ5U2V0c1N0YXRlID0gcmVjb3ZlcnlTZXRzT3B0aW9uIHx8IG9sZFJlY292ZXJ5U2V0c1N0YXRlO1xuICByZXR1cm4gc2V0dXBJc3N1ZXJLaXQyKFxuICAgIGlzc3VlclJlY29yZCxcbiAgICBpc3N1ZXJab25lLFxuICAgIHJlY292ZXJ5U2V0c1N0YXRlLFxuICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmVcbiAgKTtcbn07XG5oYXJkZW4odXBncmFkZUlzc3VlcktpdDIpO1xudmFyIGhhc0lzc3VlcjIgPSAoYmFnZ2FnZSkgPT4gYmFnZ2FnZS5oYXMoSU5TVEFOQ0VfS0VZMik7XG52YXIgbWFrZUR1cmFibGVJc3N1ZXJLaXQyID0gKGlzc3VlckJhZ2dhZ2UsIG5hbWUsIGFzc2V0S2luZCA9IEFzc2V0S2luZDIuTkFULCBkaXNwbGF5SW5mbyA9IGhhcmRlbih7fSksIG9wdFNodXRkb3duV2l0aEZhaWx1cmUgPSB2b2lkIDAsIHsgZWxlbWVudFNoYXBlID0gdm9pZCAwLCByZWNvdmVyeVNldHNPcHRpb24gPSB2b2lkIDAgfSA9IHt9KSA9PiB7XG4gIGNvbnN0IGlzc3VlckRhdGEgPSBoYXJkZW4oe1xuICAgIG5hbWUsXG4gICAgYXNzZXRLaW5kLFxuICAgIGRpc3BsYXlJbmZvLFxuICAgIGVsZW1lbnRTaGFwZVxuICB9KTtcbiAgaXNzdWVyQmFnZ2FnZS5pbml0KElOU1RBTkNFX0tFWTIsIGlzc3VlckRhdGEpO1xuICBjb25zdCBpc3N1ZXJab25lID0gbWFrZUR1cmFibGVab25lKGlzc3VlckJhZ2dhZ2UpO1xuICBjb25zdCByZWNvdmVyeVNldHNTdGF0ZSA9IHJlY292ZXJ5U2V0c09wdGlvbiB8fCBcImhhc1JlY292ZXJ5U2V0c1wiO1xuICBpc3N1ZXJCYWdnYWdlLmluaXQoUkVDT1ZFUllfU0VUU19TVEFURTIsIHJlY292ZXJ5U2V0c1N0YXRlKTtcbiAgcmV0dXJuIHNldHVwSXNzdWVyS2l0MihcbiAgICBpc3N1ZXJEYXRhLFxuICAgIGlzc3VlclpvbmUsXG4gICAgcmVjb3ZlcnlTZXRzU3RhdGUsXG4gICAgb3B0U2h1dGRvd25XaXRoRmFpbHVyZVxuICApO1xufTtcbmhhcmRlbihtYWtlRHVyYWJsZUlzc3VlcktpdDIpO1xudmFyIHByZXBhcmVJc3N1ZXJLaXQyID0gKGlzc3VlckJhZ2dhZ2UsIG5hbWUsIGFzc2V0S2luZCA9IEFzc2V0S2luZDIuTkFULCBkaXNwbGF5SW5mbyA9IGhhcmRlbih7fSksIG9wdFNodXRkb3duV2l0aEZhaWx1cmUgPSB2b2lkIDAsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICBpZiAoaGFzSXNzdWVyMihpc3N1ZXJCYWdnYWdlKSkge1xuICAgIGNvbnN0IHsgZWxlbWVudFNoYXBlOiBfID0gdm9pZCAwLCByZWNvdmVyeVNldHNPcHRpb24gPSB2b2lkIDAgfSA9IG9wdGlvbnM7XG4gICAgY29uc3QgaXNzdWVyS2l0ID0gdXBncmFkZUlzc3VlcktpdDIoXG4gICAgICBpc3N1ZXJCYWdnYWdlLFxuICAgICAgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSxcbiAgICAgIHJlY292ZXJ5U2V0c09wdGlvblxuICAgICk7XG4gICAgcmV0dXJuIGlzc3VlcktpdDtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBpc3N1ZXJLaXQgPSBtYWtlRHVyYWJsZUlzc3VlcktpdDIoXG4gICAgICBpc3N1ZXJCYWdnYWdlLFxuICAgICAgbmFtZSxcbiAgICAgIGFzc2V0S2luZCxcbiAgICAgIGRpc3BsYXlJbmZvLFxuICAgICAgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSxcbiAgICAgIG9wdGlvbnNcbiAgICApO1xuICAgIHJldHVybiBpc3N1ZXJLaXQ7XG4gIH1cbn07XG5oYXJkZW4ocHJlcGFyZUlzc3VlcktpdDIpO1xudmFyIG1ha2VJc3N1ZXJLaXQyID0gKG5hbWUsIGFzc2V0S2luZCA9IEFzc2V0S2luZDIuTkFULCBkaXNwbGF5SW5mbyA9IGhhcmRlbih7fSksIG9wdFNodXRkb3duV2l0aEZhaWx1cmUgPSB2b2lkIDAsIHsgZWxlbWVudFNoYXBlID0gdm9pZCAwLCByZWNvdmVyeVNldHNPcHRpb24gPSB2b2lkIDAgfSA9IHt9KSA9PiAoXG4gIC8vXG4gIG1ha2VEdXJhYmxlSXNzdWVyS2l0MihcbiAgICBtYWtlU2NhbGFyQmlnTWFwU3RvcmUoXCJkcm9wcGVkIGlzc3VlciBraXRcIiwgeyBkdXJhYmxlOiB0cnVlIH0pLFxuICAgIG5hbWUsXG4gICAgYXNzZXRLaW5kLFxuICAgIGRpc3BsYXlJbmZvLFxuICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmUsXG4gICAgeyBlbGVtZW50U2hhcGUsIHJlY292ZXJ5U2V0c09wdGlvbiB9XG4gIClcbik7XG5oYXJkZW4obWFrZUlzc3VlcktpdDIpO1xuXG4vL1xudmFyIEtleXdvcmRTaGFwZSA9IE0uc3RyaW5nKCk7XG52YXIgSW52aXRhdGlvbkhhbmRsZVNoYXBlID0gTS5yZW1vdGFibGUoXCJJbnZpdGF0aW9uSGFuZGxlXCIpO1xudmFyIEludml0YXRpb25TaGFwZSA9IE0ucmVtb3RhYmxlKFwiSW52aXRhdGlvblwiKTtcbnZhciBJbnN0YW5jZUhhbmRsZVNoYXBlID0gTS5yZW1vdGFibGUoXCJJbnN0YW5jZUhhbmRsZVwiKTtcbnZhciBJbnN0YWxsYXRpb25TaGFwZSA9IE0ucmVtb3RhYmxlKFwiSW5zdGFsbGF0aW9uXCIpO1xudmFyIFNlYXRTaGFwZSA9IE0ucmVtb3RhYmxlKFwiU2VhdFwiKTtcbnZhciBBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGUgPSBNLnJlY29yZE9mKEtleXdvcmRTaGFwZSwgQW1vdW50U2hhcGUyKTtcbnZhciBBbW91bnRQYXR0ZXJuS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihcbiAgS2V5d29yZFNoYXBlLFxuICBNLnBhdHRlcm4oKVxuKTtcbnZhciBQYXltZW50UEtleXdvcmRSZWNvcmRTaGFwZSA9IE0ucmVjb3JkT2YoXG4gIEtleXdvcmRTaGFwZSxcbiAgTS5lcmVmKFBheW1lbnRTaGFwZTIpXG4pO1xudmFyIElzc3VlcktleXdvcmRSZWNvcmRTaGFwZSA9IE0ucmVjb3JkT2YoS2V5d29yZFNoYXBlLCBJc3N1ZXJTaGFwZTIpO1xudmFyIElzc3VlclBLZXl3b3JkUmVjb3JkU2hhcGUgPSBNLnJlY29yZE9mKFxuICBLZXl3b3JkU2hhcGUsXG4gIE0uZXJlZihJc3N1ZXJTaGFwZTIpXG4pO1xudmFyIEJyYW5kS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihLZXl3b3JkU2hhcGUsIEJyYW5kU2hhcGUyKTtcbnZhciBJc3N1ZXJSZWNvcmRTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBicmFuZDogQnJhbmRTaGFwZTIsXG4gICAgaXNzdWVyOiBJc3N1ZXJTaGFwZTIsXG4gICAgYXNzZXRLaW5kOiBBc3NldEtpbmRTaGFwZTJcbiAgfSxcbiAgeyBkaXNwbGF5SW5mbzogRGlzcGxheUluZm9TaGFwZTIgfVxuKTtcbnZhciBUZXJtc1NoYXBlID0ge1xuICBpc3N1ZXJzOiBJc3N1ZXJLZXl3b3JkUmVjb3JkU2hhcGUsXG4gIGJyYW5kczogQnJhbmRLZXl3b3JkUmVjb3JkU2hhcGVcbn07XG5oYXJkZW4oVGVybXNTaGFwZSk7XG52YXIgSW5zdGFuY2VSZWNvcmRTaGFwZSA9IHtcbiAgaW5zdGFsbGF0aW9uOiBJbnN0YWxsYXRpb25TaGFwZSxcbiAgaW5zdGFuY2U6IEluc3RhbmNlSGFuZGxlU2hhcGUsXG4gIHRlcm1zOiBNLnNwbGl0UmVjb3JkKFRlcm1zU2hhcGUpXG59O1xuaGFyZGVuKEluc3RhbmNlUmVjb3JkU2hhcGUpO1xudmFyIEhhbmRsZUkgPSBNLmludGVyZmFjZShcIkhhbmRsZVwiLCB7fSk7XG52YXIgbWFrZUhhbmRsZVNoYXBlID0gKG5hbWUpID0+IE0ucmVtb3RhYmxlKGAke25hbWV9SGFuZGxlYCk7XG52YXIgVGltZXJTaGFwZSA9IG1ha2VIYW5kbGVTaGFwZShcInRpbWVyXCIpO1xudmFyIEZ1bGxQcm9wb3NhbFNoYXBlID0ge1xuICB3YW50OiBBbW91bnRQYXR0ZXJuS2V5d29yZFJlY29yZFNoYXBlLFxuICBnaXZlOiBBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGUsXG4gIC8vXG4gIC8vXG4gIC8vXG4gIGV4aXQ6IE0uc3BsaXRSZWNvcmQoXG4gICAge30sXG4gICAge1xuICAgICAgb25EZW1hbmQ6IG51bGwsXG4gICAgICB3YWl2ZWQ6IG51bGwsXG4gICAgICBhZnRlckRlYWRsaW5lOiB7XG4gICAgICAgIHRpbWVyOiBNLmVyZWYoVGltZXJTaGFwZSksXG4gICAgICAgIGRlYWRsaW5lOiBUaW1lc3RhbXBTaGFwZVxuICAgICAgfVxuICAgIH0sXG4gICAge31cbiAgKVxufTtcbmhhcmRlbihGdWxsUHJvcG9zYWxTaGFwZSk7XG52YXIgUHJvcG9zYWxTaGFwZSA9IE0uc3BsaXRSZWNvcmQoe30sIEZ1bGxQcm9wb3NhbFNoYXBlLCB7fSk7XG52YXIgRW1wdHlQcm9wb3NhbFNoYXBlID0gTS5zcGxpdFJlY29yZCh7XG4gIGdpdmU6IHt9LFxuICB3YW50OiB7fSxcbiAgZXhpdDogeyBvbkRlbWFuZDogbnVsbCB9XG59KTtcbnZhciBpc09uRGVtYW5kRXhpdFJ1bGUgPSAoZXhpdCkgPT4ge1xuICBjb25zdCBbZXhpdEtleV0gPSBPYmplY3Qua2V5cyhleGl0KTtcbiAgcmV0dXJuIGV4aXRLZXkgPT09IFwib25EZW1hbmRcIjtcbn07XG5oYXJkZW4oaXNPbkRlbWFuZEV4aXRSdWxlKTtcbnZhciBpc1dhaXZlZEV4aXRSdWxlID0gKGV4aXQpID0+IHtcbiAgY29uc3QgW2V4aXRLZXldID0gT2JqZWN0LmtleXMoZXhpdCk7XG4gIHJldHVybiBleGl0S2V5ID09PSBcIndhaXZlZFwiO1xufTtcbmhhcmRlbihpc1dhaXZlZEV4aXRSdWxlKTtcbnZhciBpc0FmdGVyRGVhZGxpbmVFeGl0UnVsZSA9IChleGl0KSA9PiB7XG4gIGNvbnN0IFtleGl0S2V5XSA9IE9iamVjdC5rZXlzKGV4aXQpO1xuICByZXR1cm4gZXhpdEtleSA9PT0gXCJhZnRlckRlYWRsaW5lXCI7XG59O1xuaGFyZGVuKGlzQWZ0ZXJEZWFkbGluZUV4aXRSdWxlKTtcbnZhciBJbnZpdGF0aW9uRWxlbWVudFNoYXBlID0gTS5zcGxpdFJlY29yZCh7XG4gIGRlc2NyaXB0aW9uOiBNLnN0cmluZygpLFxuICBoYW5kbGU6IEludml0YXRpb25IYW5kbGVTaGFwZSxcbiAgaW5zdGFuY2U6IEluc3RhbmNlSGFuZGxlU2hhcGUsXG4gIGluc3RhbGxhdGlvbjogSW5zdGFsbGF0aW9uU2hhcGVcbn0pO1xudmFyIE9mZmVySGFuZGxlckkgPSBNLmludGVyZmFjZShcIk9mZmVySGFuZGxlclwiLCB7XG4gIGhhbmRsZTogTS5jYWxsKFNlYXRTaGFwZSkub3B0aW9uYWwoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxufSk7XG52YXIgU2VhdEhhbmRsZUFsbG9jYXRpb25zU2hhcGUgPSBNLmFycmF5T2Yoe1xuICBzZWF0SGFuZGxlOiBTZWF0U2hhcGUsXG4gIGFsbG9jYXRpb246IEFtb3VudEtleXdvcmRSZWNvcmRTaGFwZVxufSk7XG52YXIgWm9lTWludFNoYXBlID0gTS5yZW1vdGFibGUoXCJab2VNaW50XCIpO1xudmFyIFpvZU1pbnRJID0gTS5pbnRlcmZhY2UoXCJab2VNaW50XCIsIHtcbiAgZ2V0SXNzdWVyUmVjb3JkOiBNLmNhbGwoKS5yZXR1cm5zKElzc3VlclJlY29yZFNoYXBlKSxcbiAgbWludEFuZEVzY3JvdzogTS5jYWxsKEFtb3VudFNoYXBlMikucmV0dXJucygpLFxuICB3aXRoZHJhd0FuZEJ1cm46IE0uY2FsbChBbW91bnRTaGFwZTIpLnJldHVybnMoKVxufSk7XG52YXIgRmVlTWludEFjY2Vzc1NoYXBlID0gTS5yZW1vdGFibGUoXCJGZWVNaW50QWNjZXNzXCIpO1xudmFyIEV4aXRPYmplY3RJID0gTS5pbnRlcmZhY2UoXCJFeGl0IE9iamVjdFwiLCB7XG4gIGV4aXQ6IE0uY2FsbCgpLnJldHVybnMoKVxufSk7XG52YXIgRXhpdE9iamVjdFNoYXBlID0gTS5yZW1vdGFibGUoXCJFeGl0T2JqXCIpO1xudmFyIEluc3RhbmNlQWRtaW5TaGFwZSA9IE0ucmVtb3RhYmxlKFwiSW5zdGFuY2VBZG1pblwiKTtcbnZhciBJbnN0YW5jZUFkbWluSSA9IE0uaW50ZXJmYWNlKFwiSW5zdGFuY2VBZG1pblwiLCB7XG4gIG1ha2VJbnZpdGF0aW9uOiBNLmNhbGwoSW52aXRhdGlvbkhhbmRsZVNoYXBlLCBNLnN0cmluZygpKS5vcHRpb25hbChNLnJlY29yZCgpLCBNLnBhdHRlcm4oKSkucmV0dXJucyhJbnZpdGF0aW9uU2hhcGUpLFxuICBzYXZlSXNzdWVyOiBNLmNhbGxXaGVuKE0uYXdhaXQoSXNzdWVyU2hhcGUyKSwgS2V5d29yZFNoYXBlKS5yZXR1cm5zKFxuICAgIElzc3VlclJlY29yZFNoYXBlXG4gICksXG4gIG1ha2VOb0VzY3Jvd1NlYXQ6IE0uY2FsbChcbiAgICBBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGUsXG4gICAgUHJvcG9zYWxTaGFwZSxcbiAgICBFeGl0T2JqZWN0U2hhcGUsXG4gICAgU2VhdFNoYXBlXG4gICkucmV0dXJucyhTZWF0U2hhcGUpLFxuICBleGl0QWxsU2VhdHM6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKCksXG4gIGZhaWxBbGxTZWF0czogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoKSxcbiAgZXhpdFNlYXQ6IE0uY2FsbChTZWF0U2hhcGUsIE0uYW55KCkpLnJldHVybnMoKSxcbiAgZmFpbFNlYXQ6IE0uY2FsbChTZWF0U2hhcGUsIE0uYW55KCkpLnJldHVybnMoKSxcbiAgbWFrZVpvZU1pbnQ6IE0uY2FsbChLZXl3b3JkU2hhcGUpLm9wdGlvbmFsKFxuICAgIEFzc2V0S2luZFNoYXBlMixcbiAgICBEaXNwbGF5SW5mb1NoYXBlMixcbiAgICBNLnNwbGl0UmVjb3JkKHt9LCB7IGVsZW1lbnRTaGFwZTogTS5wYXR0ZXJuKCkgfSlcbiAgKS5yZXR1cm5zKE0ucmVtb3RhYmxlKFwiem9lTWludFwiKSksXG4gIHJlZ2lzdGVyRmVlTWludDogTS5jYWxsKEtleXdvcmRTaGFwZSwgRmVlTWludEFjY2Vzc1NoYXBlKS5yZXR1cm5zKFxuICAgIE0ucmVtb3RhYmxlKFwiZmVlTWludFwiKVxuICApLFxuICByZXBsYWNlQWxsb2NhdGlvbnM6IE0uY2FsbChTZWF0SGFuZGxlQWxsb2NhdGlvbnNTaGFwZSkucmV0dXJucygpLFxuICBzdG9wQWNjZXB0aW5nT2ZmZXJzOiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gIHNldE9mZmVyRmlsdGVyOiBNLmNhbGwoTS5hcnJheU9mKE0uc3RyaW5nKCkpKS5yZXR1cm5zKCksXG4gIGdldE9mZmVyRmlsdGVyOiBNLmNhbGwoKS5yZXR1cm5zKE0uYXJyYXlPZihNLnN0cmluZygpKSksXG4gIGdldEV4aXRTdWJzY3JpYmVyOiBNLmNhbGwoU2VhdFNoYXBlKS5yZXR1cm5zKFN1YnNjcmliZXJTaGFwZSksXG4gIGlzQmxvY2tlZDogTS5jYWxsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICByZXBhaXJDb250cmFjdENvbXBsZXRpb25XYXRjaGVyOiBNLmNhbGwoKS5yZXR1cm5zKClcbn0pO1xudmFyIEluc3RhbmNlU3RvcmFnZU1hbmFnZXJJS2l0ID0ge1xuICBpbnN0YW5jZVN0b3JhZ2VNYW5hZ2VyOiBNLmludGVyZmFjZShcIkluc3RhbmNlU3RvcmFnZU1hbmFnZXJcIiwge1xuICAgIGdldFRlcm1zOiBNLmNhbGwoKS5yZXR1cm5zKE0uc3BsaXRSZWNvcmQoVGVybXNTaGFwZSkpLFxuICAgIGdldElzc3VlcnM6IE0uY2FsbCgpLnJldHVybnMoSXNzdWVyS2V5d29yZFJlY29yZFNoYXBlKSxcbiAgICBnZXRCcmFuZHM6IE0uY2FsbCgpLnJldHVybnMoQnJhbmRLZXl3b3JkUmVjb3JkU2hhcGUpLFxuICAgIGdldEluc3RhbGxhdGlvbjogTS5jYWxsKCkucmV0dXJucyhJbnN0YWxsYXRpb25TaGFwZSksXG4gICAgZ2V0SW52aXRhdGlvbklzc3VlcjogTS5jYWxsKCkucmV0dXJucyhJc3N1ZXJTaGFwZTIpLFxuICAgIHNhdmVJc3N1ZXI6IE0uY2FsbChJc3N1ZXJTaGFwZTIsIEtleXdvcmRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgbWFrZVpvZU1pbnQ6IE0uY2FsbChLZXl3b3JkU2hhcGUpLm9wdGlvbmFsKFxuICAgICAgQXNzZXRLaW5kU2hhcGUyLFxuICAgICAgRGlzcGxheUluZm9TaGFwZTIsXG4gICAgICBNLnNwbGl0UmVjb3JkKHt9LCB7IGVsZW1lbnRTaGFwZTogTS5wYXR0ZXJuKCkgfSlcbiAgICApLnJldHVybnMoTS5lcmVmKFpvZU1pbnRTaGFwZSkpLFxuICAgIHJlZ2lzdGVyRmVlTWludDogTS5jYWxsKEtleXdvcmRTaGFwZSwgRmVlTWludEFjY2Vzc1NoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5yZW1vdGFibGUoXCJmZWVNaW50XCIpXG4gICAgKSxcbiAgICBnZXRJbnN0YW5jZVJlY29yZDogTS5jYWxsKCkucmV0dXJucyhJbnN0YW5jZVJlY29yZFNoYXBlKSxcbiAgICBnZXRJc3N1ZXJSZWNvcmRzOiBNLmNhbGwoKS5yZXR1cm5zKE0uYXJyYXlPZihJc3N1ZXJSZWNvcmRTaGFwZSkpLFxuICAgIGdldFdpdGhkcmF3RmFjZXQ6IE0uY2FsbCgpLnJldHVybnMoTS5yZW1vdGFibGUoXCJXaXRoZHJhd0ZhY2V0XCIpKSxcbiAgICBpbml0SW5zdGFuY2VBZG1pbjogTS5jYWxsKFxuICAgICAgSW5zdGFuY2VIYW5kbGVTaGFwZSxcbiAgICAgIE0ucmVtb3RhYmxlKFwiaW5zdGFuY2VBZG1pblwiKVxuICAgICkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgZGVsZXRlSW5zdGFuY2VBZG1pbjogTS5jYWxsKEluc3RhbmNlQWRtaW5TaGFwZSkucmV0dXJucygpLFxuICAgIG1ha2VJbnZpdGF0aW9uOiBNLmNhbGwoSW52aXRhdGlvbkhhbmRsZVNoYXBlLCBNLnN0cmluZygpKS5vcHRpb25hbChNLnJlY29yZCgpLCBNLnBhdHRlcm4oKSkucmV0dXJucyhQYXltZW50U2hhcGUyKSxcbiAgICBnZXRSb290OiBNLmNhbGwoKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgIGdldEFkbWluTm9kZTogTS5jYWxsKCkucmV0dXJucyhNLnJlbW90YWJsZShcImFkbWluTm9kZVwiKSlcbiAgfSksXG4gIHdpdGhkcmF3RmFjZXQ6IE0uaW50ZXJmYWNlKFwiV2l0aGRyYXdGYWNldFwiLCB7XG4gICAgd2l0aGRyYXdQYXltZW50czogTS5jYWxsKEFtb3VudEtleXdvcmRSZWNvcmRTaGFwZSkucmV0dXJucyhcbiAgICAgIFBheW1lbnRQS2V5d29yZFJlY29yZFNoYXBlXG4gICAgKVxuICB9KSxcbiAgaGVscGVyczogTS5pbnRlcmZhY2UoXCJJbnN0YW5jZVN0b3JhZ2VNYW5hZ2VyIGhlbHBlclwiLCB7XG4gICAgd3JhcElzc3VlcktpdFdpdGhab2VNaW50OiBNLmNhbGwoXG4gICAgICBLZXl3b3JkU2hhcGUsXG4gICAgICBJc3N1ZXJLaXRTaGFwZTIsXG4gICAgICBNLnJlbW90YWJsZShcImFkbWluTm9kZVwiKVxuICAgICkucmV0dXJucyhab2VNaW50U2hhcGUpXG4gIH0pXG59O1xuaGFyZGVuKEluc3RhbmNlU3RvcmFnZU1hbmFnZXJJS2l0KTtcbnZhciBCdW5kbGVDYXBTaGFwZSA9IE0ucmVtb3RhYmxlKFwiYnVuZGxlQ2FwXCIpO1xudmFyIEJ1bmRsZVNoYXBlID0gTS5hbmQoXG4gIE0uc3BsaXRSZWNvcmQoeyBtb2R1bGVGb3JtYXQ6IE0uYW55KCkgfSksXG4gIE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgTS5zdHJpbmcoeyBzdHJpbmdMZW5ndGhMaW1pdDogSW5maW5pdHkgfSkpXG4pO1xudmFyIFVud3JhcHBlZEluc3RhbGxhdGlvblNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAgeyBpbnN0YWxsYXRpb246IEluc3RhbGxhdGlvblNoYXBlIH0sXG4gIHtcbiAgICBidW5kbGU6IE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgTS5zdHJpbmcoeyBzdHJpbmdMZW5ndGhMaW1pdDogSW5maW5pdHkgfSkpLFxuICAgIGJ1bmRsZUNhcDogQnVuZGxlQ2FwU2hhcGUsXG4gICAgYnVuZGxlSUQ6IE0uc3RyaW5nKClcbiAgfSxcbiAge31cbik7XG52YXIgWm9lU3RvcmFnZU1hbmFnZXJJS2l0ID0ge1xuICB6b2VTZXJ2aWNlRGF0YUFjY2VzczogTS5pbnRlcmZhY2UoXCJab2VTZXJ2aWNlIGRhdGFBY2Nlc3NcIiwge1xuICAgIGdldFRlcm1zOiBNLmNhbGwoSW5zdGFuY2VIYW5kbGVTaGFwZSkucmV0dXJucyhNLnNwbGl0UmVjb3JkKFRlcm1zU2hhcGUpKSxcbiAgICBnZXRJc3N1ZXJzOiBNLmNhbGwoSW5zdGFuY2VIYW5kbGVTaGFwZSkucmV0dXJucyhJc3N1ZXJLZXl3b3JkUmVjb3JkU2hhcGUpLFxuICAgIGdldEJyYW5kczogTS5jYWxsKEluc3RhbmNlSGFuZGxlU2hhcGUpLnJldHVybnMoQnJhbmRLZXl3b3JkUmVjb3JkU2hhcGUpLFxuICAgIGdldEluc3RhbGxhdGlvbjogTS5jYWxsKEluc3RhbmNlSGFuZGxlU2hhcGUpLnJldHVybnMoXG4gICAgICBNLmVyZWYoTS5yZW1vdGFibGUoXCJJbnN0YWxsYXRpb25cIikpXG4gICAgKSxcbiAgICBnZXRJbnZpdGF0aW9uSXNzdWVyOiBNLmNhbGwoKS5yZXR1cm5zKElzc3VlclNoYXBlMiksXG4gICAgZ2V0QnVuZGxlSURGcm9tSW5zdGFsbGF0aW9uOiBNLmNhbGwoSW5zdGFsbGF0aW9uU2hhcGUpLnJldHVybnMoXG4gICAgICBNLmVyZWYoTS5zdHJpbmcoKSlcbiAgICApLFxuICAgIGluc3RhbGxCdW5kbGU6IE0uY2FsbChCdW5kbGVTaGFwZSkub3B0aW9uYWwoTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgaW5zdGFsbEJ1bmRsZUlEOiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgZ2V0UHVibGljRmFjZXQ6IE0uY2FsbChJbnN0YW5jZUhhbmRsZVNoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5lcmVmKE0ucmVtb3RhYmxlKFwiUHVibGljRmFjZXRcIikpXG4gICAgKSxcbiAgICBnZXRPZmZlckZpbHRlcjogTS5jYWxsKEluc3RhbmNlSGFuZGxlU2hhcGUpLnJldHVybnMoTS5hcnJheU9mKE0uc3RyaW5nKCkpKSxcbiAgICBnZXRQcm9wb3NhbFNoYXBlRm9ySW52aXRhdGlvbjogTS5jYWxsKEludml0YXRpb25IYW5kbGVTaGFwZSkucmV0dXJucyhcbiAgICAgIE0ub3B0KE0ucGF0dGVybigpKVxuICAgIClcbiAgfSksXG4gIG1ha2VPZmZlckFjY2VzczogTS5pbnRlcmZhY2UoXCJab2VTdG9yYWdlIG1ha2VPZmZlciBhY2Nlc3NcIiwge1xuICAgIGdldEFzc2V0S2luZEJ5QnJhbmQ6IE0uY2FsbChCcmFuZFNoYXBlMikucmV0dXJucyhBc3NldEtpbmRTaGFwZTIpLFxuICAgIGdldEluc3RhbmNlQWRtaW46IE0uY2FsbChJbnN0YW5jZUhhbmRsZVNoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5yZW1vdGFibGUoXCJpbnN0YW5jZUFkbWluXCIpXG4gICAgKSxcbiAgICBnZXRQcm9wb3NhbFNoYXBlRm9ySW52aXRhdGlvbjogTS5jYWxsKEludml0YXRpb25IYW5kbGVTaGFwZSkucmV0dXJucyhcbiAgICAgIE0ub3B0KE0ucGF0dGVybigpKVxuICAgICksXG4gICAgZ2V0SW52aXRhdGlvbklzc3VlcjogTS5jYWxsKCkucmV0dXJucyhJc3N1ZXJTaGFwZTIpLFxuICAgIGRlcG9zaXRQYXltZW50czogTS5jYWxsKFByb3Bvc2FsU2hhcGUsIFBheW1lbnRQS2V5d29yZFJlY29yZFNoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5wcm9taXNlKClcbiAgICApXG4gIH0pLFxuICBzdGFydEluc3RhbmNlQWNjZXNzOiBNLmludGVyZmFjZShcIlpvZVN0b3JhZ2Ugc3RhcnRJbnN0YW5jZSBhY2Nlc3NcIiwge1xuICAgIG1ha2Vab2VJbnN0YW5jZVN0b3JhZ2VNYW5hZ2VyOiBNLmNhbGwoXG4gICAgICBJbnN0YWxsYXRpb25TaGFwZSxcbiAgICAgIE0uYW55KCksXG4gICAgICBJc3N1ZXJQS2V5d29yZFJlY29yZFNoYXBlLFxuICAgICAgSW5zdGFuY2VIYW5kbGVTaGFwZSxcbiAgICAgIE0ub3IoQnVuZGxlQ2FwU2hhcGUsIEJ1bmRsZVNoYXBlKSxcbiAgICAgIE0uc3RyaW5nKClcbiAgICApLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIHVud3JhcEluc3RhbGxhdGlvbjogTS5jYWxsV2hlbihNLmVyZWYoSW5zdGFsbGF0aW9uU2hhcGUpKS5yZXR1cm5zKFxuICAgICAgVW53cmFwcGVkSW5zdGFsbGF0aW9uU2hhcGVcbiAgICApXG4gIH0pLFxuICBpbnZpdGF0aW9uSXNzdWVyQWNjZXNzOiBNLmludGVyZmFjZShcIlpvZVN0b3JhZ2UgaW52aXRhdGlvbklzc3VlclwiLCB7XG4gICAgZ2V0SW52aXRhdGlvbklzc3VlcjogTS5jYWxsKCkucmV0dXJucyhJc3N1ZXJTaGFwZTIpXG4gIH0pXG59O1xuaGFyZGVuKFpvZVN0b3JhZ2VNYW5hZ2VySUtpdCk7XG52YXIgWm9lU2VydmljZUkgPSBNLmludGVyZmFjZShcIlpvZVNlcnZpY2VcIiwge1xuICBpbnN0YWxsOiBNLmNhbGwoTS5hbnkoKSkub3B0aW9uYWwoTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGluc3RhbGxCdW5kbGVJRDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBzdGFydEluc3RhbmNlOiBNLmNhbGwoTS5lcmVmKEluc3RhbGxhdGlvblNoYXBlKSkub3B0aW9uYWwoSXNzdWVyUEtleXdvcmRSZWNvcmRTaGFwZSwgTS5yZWNvcmQoKSwgTS5yZWNvcmQoKSwgTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIG9mZmVyOiBNLmNhbGwoTS5lcmVmKEludml0YXRpb25TaGFwZSkpLm9wdGlvbmFsKFByb3Bvc2FsU2hhcGUsIFBheW1lbnRQS2V5d29yZFJlY29yZFNoYXBlLCBNLmFueSgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgZ2V0T2ZmZXJGaWx0ZXI6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBNLmFycmF5T2YoTS5zdHJpbmcoKSlcbiAgKSxcbiAgZ2V0SW52aXRhdGlvbklzc3VlcjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldEZlZUlzc3VlcjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldEJyYW5kczogTS5jYWxsV2hlbihNLmF3YWl0KEluc3RhbmNlSGFuZGxlU2hhcGUpKS5yZXR1cm5zKFxuICAgIEJyYW5kS2V5d29yZFJlY29yZFNoYXBlXG4gICksXG4gIGdldElzc3VlcnM6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBJc3N1ZXJLZXl3b3JkUmVjb3JkU2hhcGVcbiAgKSxcbiAgZ2V0UHVibGljRmFjZXQ6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBNLnJlbW90YWJsZShcIlB1YmxpY0ZhY2V0XCIpXG4gICksXG4gIGdldFRlcm1zOiBNLmNhbGxXaGVuKE0uYXdhaXQoSW5zdGFuY2VIYW5kbGVTaGFwZSkpLnJldHVybnMoTS5hbnkoKSksXG4gIGdldEluc3RhbGxhdGlvbkZvckluc3RhbmNlOiBNLmNhbGxXaGVuKE0uYXdhaXQoSW5zdGFuY2VIYW5kbGVTaGFwZSkpLnJldHVybnMoXG4gICAgTS5lcmVmKE0ucmVtb3RhYmxlKFwiSW5zdGFsbGF0aW9uXCIpKVxuICApLFxuICBnZXRCdW5kbGVJREZyb21JbnN0YWxsYXRpb246IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YWxsYXRpb25TaGFwZSkpLnJldHVybnMoXG4gICAgTS5lcmVmKE0uc3RyaW5nKCkpXG4gICksXG4gIGdldEluc3RhbGxhdGlvbjogTS5jYWxsKE0uZXJlZihJbnZpdGF0aW9uU2hhcGUpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgZ2V0SW5zdGFuY2U6IE0uY2FsbChNLmVyZWYoSW52aXRhdGlvblNoYXBlKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldENvbmZpZ3VyYXRpb246IE0uY2FsbCgpLnJldHVybnMoe1xuICAgIGZlZUlzc3VlckNvbmZpZzoge1xuICAgICAgbmFtZTogTS5zdHJpbmcoKSxcbiAgICAgIGFzc2V0S2luZDogXCJuYXRcIixcbiAgICAgIGRpc3BsYXlJbmZvOiBEaXNwbGF5SW5mb1NoYXBlMlxuICAgIH1cbiAgfSksXG4gIGdldEludml0YXRpb25EZXRhaWxzOiBNLmNhbGwoTS5lcmVmKEludml0YXRpb25TaGFwZSkpLnJldHVybnMoTS5hbnkoKSksXG4gIGdldFByb3Bvc2FsU2hhcGVGb3JJbnZpdGF0aW9uOiBNLmNhbGwoSW52aXRhdGlvbkhhbmRsZVNoYXBlKS5yZXR1cm5zKFxuICAgIE0ub3B0KE0ucGF0dGVybigpKVxuICApXG59KTtcbnZhciBBZG1pbkZhY2V0SSA9IE0uaW50ZXJmYWNlKFwiWmNmQWRtaW5GYWNldFwiLCB7XG4gIGdldFZhdFNodXRkb3duUHJvbWlzZTogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIHJlc3RhcnRDb250cmFjdDogTS5jYWxsKCkub3B0aW9uYWwoTS5hbnkoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIHVwZ3JhZGVDb250cmFjdDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uYW55KCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICB0ZXJtaW5hdGVDb250cmFjdDogTS5jYWxsKE0uZXJyb3IoKSkucmV0dXJucyhNLnByb21pc2UoKSlcbn0pO1xudmFyIFNlYXREYXRhU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAgcHJvcG9zYWw6IFByb3Bvc2FsU2hhcGUsXG4gICAgaW5pdGlhbEFsbG9jYXRpb246IEFtb3VudEtleXdvcmRSZWNvcmRTaGFwZSxcbiAgICBzZWF0SGFuZGxlOiBTZWF0U2hhcGVcbiAgfSxcbiAge1xuICAgIG9mZmVyQXJnczogTS5hbnkoKVxuICB9XG4pO1xudmFyIEhhbmRsZU9mZmVySSA9IE0uaW50ZXJmYWNlKFwiSGFuZGxlT2ZmZXJcIiwge1xuICBoYW5kbGVPZmZlcjogTS5jYWxsKEludml0YXRpb25IYW5kbGVTaGFwZSwgU2VhdERhdGFTaGFwZSkucmV0dXJucyh7XG4gICAgb2ZmZXJSZXN1bHRQcm9taXNlOiBNLnByb21pc2UoKSxcbiAgICBleGl0T2JqOiBFeGl0T2JqZWN0U2hhcGVcbiAgfSlcbn0pO1xudmFyIFByaWNlUXVvdGVTaGFwZSA9IHtcbiAgcXVvdGVBbW91bnQ6IEFtb3VudFNoYXBlMixcbiAgcXVvdGVQYXltZW50OiBNLmVyZWYoUGF5bWVudFNoYXBlMilcbn07XG5oYXJkZW4oUHJpY2VRdW90ZVNoYXBlKTtcblxuLy9cbnZhciBUcmFuc2ZlclBhcnRTaGFwZSA9IE0uc3BsaXRBcnJheShcbiAgaGFyZGVuKFtNLm9wdChTZWF0U2hhcGUpLCBNLm9wdChTZWF0U2hhcGUpLCBNLm9wdChBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGUpXSksXG4gIGhhcmRlbihbTS5vcHQoQW1vdW50S2V5d29yZFJlY29yZFNoYXBlKV0pXG4pO1xudmFyIGF0b21pY1RyYW5zZmVyID0gKHpjZiwgZnJvbVNlYXQgPSB2b2lkIDAsIHRvU2VhdCA9IHZvaWQgMCwgZnJvbUFtb3VudHMgPSB2b2lkIDAsIHRvQW1vdW50cyA9IHZvaWQgMCkgPT4gemNmLmF0b21pY1JlYXJyYW5nZShoYXJkZW4oW1tmcm9tU2VhdCwgdG9TZWF0LCBmcm9tQW1vdW50cywgdG9BbW91bnRzXV0pKTtcblxuLy9cbnZhciBzYXRpc2ZpZXNJbnRlcm5hbCA9IChnaXZlT3JXYW50ID0ge30sIGFsbG9jYXRpb24pID0+IHtcbiAgY29uc3QgaXNHVEVCeUtleXdvcmQgPSAoW2tleXdvcmQsIHJlcXVpcmVkQW1vdW50XSkgPT4ge1xuICAgIGlmIChhbGxvY2F0aW9uW2tleXdvcmRdID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBjb25zdCBhbGxvY2F0aW9uQW1vdW50ID0gYWxsb2NhdGlvbltrZXl3b3JkXTtcbiAgICByZXR1cm4gQW1vdW50TWF0aDIuaXNHVEUoYWxsb2NhdGlvbkFtb3VudCwgcmVxdWlyZWRBbW91bnQpID8gMSA6IDA7XG4gIH07XG4gIHJldHVybiBPYmplY3QuZW50cmllcyhnaXZlT3JXYW50KS5ldmVyeShpc0dURUJ5S2V5d29yZCkgPyAxIDogMDtcbn07XG52YXIgc2F0aXNmaWVzV2FudCA9IChwcm9wb3NhbCwgYWxsb2NhdGlvbikgPT4gc2F0aXNmaWVzSW50ZXJuYWwocHJvcG9zYWwud2FudCwgYWxsb2NhdGlvbik7XG52YXIgc2F0aXNmaWVzR2l2ZSA9IChwcm9wb3NhbCwgYWxsb2NhdGlvbikgPT4gc2F0aXNmaWVzSW50ZXJuYWwocHJvcG9zYWwuZ2l2ZSwgYWxsb2NhdGlvbik7XG5mdW5jdGlvbiBpc09mZmVyU2FmZShwcm9wb3NhbCwgYWxsb2NhdGlvbikge1xuICByZXR1cm4gc2F0aXNmaWVzR2l2ZShwcm9wb3NhbCwgYWxsb2NhdGlvbikgPiAwIHx8IHNhdGlzZmllc1dhbnQocHJvcG9zYWwsIGFsbG9jYXRpb24pID4gMDtcbn1cbmhhcmRlbihpc09mZmVyU2FmZSk7XG5oYXJkZW4oc2F0aXNmaWVzV2FudCk7XG5cbi8vXG52YXIgZGVwb3NpdFRvU2VhdFN1Y2Nlc3NNc2cgPSBgRGVwb3NpdCBhbmQgcmVhbGxvY2F0aW9uIHN1Y2Nlc3NmdWwuYDtcbnZhciBkZXBvc2l0VG9TZWF0ID0gYXN5bmMgKHpjZiwgcmVjaXBpZW50U2VhdCwgYW1vdW50cywgcGF5bWVudHMpID0+IHtcbiAgIXJlY2lwaWVudFNlYXQuaGFzRXhpdGVkKCkgfHwgdGhyb3dSZWRhY3RlZGBUaGUgcmVjaXBpZW50U2VhdCBjYW5ub3QgaGF2ZSBleGl0ZWQuYDtcbiAgY29uc3QgcmVhbGxvY2F0ZUFmdGVyRGVwb3NpdCA9ICh0ZW1wU2VhdCkgPT4ge1xuICAgIGF0b21pY1RyYW5zZmVyKHpjZiwgdGVtcFNlYXQsIHJlY2lwaWVudFNlYXQsIGFtb3VudHMpO1xuICAgIHRlbXBTZWF0LmV4aXQoKTtcbiAgICByZXR1cm4gZGVwb3NpdFRvU2VhdFN1Y2Nlc3NNc2c7XG4gIH07XG4gIGNvbnN0IGludml0YXRpb24gPSB6Y2YubWFrZUludml0YXRpb24oXG4gICAgcmVhbGxvY2F0ZUFmdGVyRGVwb3NpdCxcbiAgICBcInRlbXBvcmFyeSBzZWF0IGZvciBkZXBvc2l0XCJcbiAgKTtcbiAgY29uc3QgcHJvcG9zYWwgPSBoYXJkZW4oeyBnaXZlOiBhbW91bnRzIH0pO1xuICBoYXJkZW4ocGF5bWVudHMpO1xuICBjb25zdCB6b2UgPSB6Y2YuZ2V0Wm9lU2VydmljZSgpO1xuICBjb25zdCB0ZW1wVXNlclNlYXQgPSBFKHpvZSkub2ZmZXIoaW52aXRhdGlvbiwgcHJvcG9zYWwsIHBheW1lbnRzKTtcbiAgcmV0dXJuIEUodGVtcFVzZXJTZWF0KS5nZXRPZmZlclJlc3VsdCgpO1xufTtcblxuLy9cbnZhciB7IG11bHRpcGx5OiBtdWx0aXBseTIsIGZsb29yRGl2aWRlOiBmbG9vckRpdmlkZTIsIGNlaWxEaXZpZGUsIGJhbmtlcnNEaXZpZGUsIGFkZDogYWRkMiwgc3VidHJhY3Q6IHN1YnRyYWN0MiB9ID0gbmF0U2FmZU1hdGg7XG5cbi8vXG52YXIgbWFrZUVwaGVtZXJhUHJvdmlkZXIgPSAoaW5pdCkgPT4ge1xuICBjb25zdCBleHRhbnQgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgcmV0dXJuIChrZXkpID0+IHtcbiAgICBpZiAoZXh0YW50LmhhcyhrZXkpKSB7XG4gICAgICByZXR1cm4gZXh0YW50LmdldChrZXkpO1xuICAgIH1cbiAgICBjb25zdCBuZXdFcGggPSBpbml0KGtleSk7XG4gICAgZXh0YW50LnNldChrZXksIG5ld0VwaCk7XG4gICAgcmV0dXJuIG5ld0VwaDtcbiAgfTtcbn07XG5oYXJkZW4obWFrZUVwaGVtZXJhUHJvdmlkZXIpO1xudmFyIHByb3ZpZGVFbXB0eVNlYXQgPSAoemNmLCBiYWdnYWdlLCBuYW1lKSA9PiB7XG4gIHJldHVybiBwcm92aWRlKGJhZ2dhZ2UsIG5hbWUsICgpID0+IHpjZi5tYWtlRW1wdHlTZWF0S2l0KCkuemNmU2VhdCk7XG59O1xuaGFyZGVuKHByb3ZpZGVFbXB0eVNlYXQpO1xudmFyIHByb3ZpZGVBbGwgPSAoYmFnZ2FnZSwgdGh1bmtzKSA9PiB7XG4gIGNvbnN0IGtleXM1ID0gT2JqZWN0LmtleXModGh1bmtzKTtcbiAgY29uc3QgaW5CYWdnYWdlID0gYmFnZ2FnZS5oYXMoa2V5czVbMF0pO1xuICBpZiAoaW5CYWdnYWdlKSB7XG4gICAgY29uc3Qgb2JqID0gb2JqZWN0TWFwKFxuICAgICAgdGh1bmtzLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIChfLCBrKSA9PiBiYWdnYWdlLmdldChrKVxuICAgICk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShoYXJkZW4ob2JqKSk7XG4gIH1cbiAgY29uc3Qga2V5ZWRQcm9taXNlcyA9IG9iamVjdE1hcCh0aHVua3MsIChmbikgPT4gZm4oKSk7XG4gIHJldHVybiBhbGxWYWx1ZXMoa2V5ZWRQcm9taXNlcykudGhlbigoa2V5ZWRWYWxzKSA9PiB7XG4gICAgZm9yIChjb25zdCBbaywgdjJdIG9mIE9iamVjdC5lbnRyaWVzKGtleWVkVmFscykpIHtcbiAgICAgIGJhZ2dhZ2UuaW5pdChrLCB2Mik7XG4gICAgfVxuICAgIHJldHVybiBrZXllZFZhbHM7XG4gIH0pO1xufTtcbmhhcmRlbihwcm92aWRlQWxsKTtcblxuLy9cbnZhciB3cmFwcGVyTWV0aG9kcyA9ICh3cmFwcGVyS2luZE5hbWUsIHVNZXRob2ROYW1lcywgZXh0cmFNZXRob2RzID0ge30pID0+IGhhcmRlbih7XG4gIC4uLmZyb21VbmlxdWVFbnRyaWVzKFxuICAgIHVNZXRob2ROYW1lcy5tYXAoKG5hbWUpID0+IFtcbiAgICAgIG5hbWUsXG4gICAgICB7XG4gICAgICAgIC8vXG4gICAgICAgIFtuYW1lXSguLi5hcmdzKSB7XG4gICAgICAgICAgY29uc3QgeyB1bmRlcmx5aW5nIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHVuZGVybHlpbmcgIT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUod3JhcHBlcktpbmROYW1lKX0gcmV2b2tlZGA7XG4gICAgICAgICAgcmV0dXJuIHVuZGVybHlpbmdbbmFtZV0oLi4uYXJncyk7XG4gICAgICAgIH1cbiAgICAgICAgLy9cbiAgICAgIH1bbmFtZV1cbiAgICBdKVxuICApLFxuICAuLi5leHRyYU1ldGhvZHNcbn0pO1xuaGFyZGVuKHdyYXBwZXJNZXRob2RzKTtcbnZhciBwcmVwYXJlQXR0ZW51YXRvck1ha2VyID0gKHpvbmUsIHVLaW5kTmFtZSwgdU1ldGhvZE5hbWVzLCBvcHRpb25zID0ge30pID0+IHtcbiAgY29uc3Qge1xuICAgIHVJbnRlcmZhY2VOYW1lID0gdUtpbmROYW1lLFxuICAgIGV4dHJhTWV0aG9kR3VhcmRzID0ge30sXG4gICAgZXh0cmFNZXRob2RzID0ge31cbiAgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IEF0dGVudWF0b3JJID0gTS5pbnRlcmZhY2UoXG4gICAgYCR7dUludGVyZmFjZU5hbWV9X2F0dGVudWF0b3JgLFxuICAgIGV4dHJhTWV0aG9kR3VhcmRzLFxuICAgIHsgZGVmYXVsdEd1YXJkczogXCJyYXdcIiB9XG4gICk7XG4gIGNvbnN0IGF0dGVudWF0b3JLaW5kTmFtZSA9IGAke3VLaW5kTmFtZX1fYXR0ZW51YXRvcmA7XG4gIHJldHVybiB6b25lLmV4b0NsYXNzKFxuICAgIGF0dGVudWF0b3JLaW5kTmFtZSxcbiAgICBBdHRlbnVhdG9ySSxcbiAgICAodW5kZXJseWluZykgPT4gKHsgdW5kZXJseWluZyB9KSxcbiAgICB3cmFwcGVyTWV0aG9kcyhhdHRlbnVhdG9yS2luZE5hbWUsIHVNZXRob2ROYW1lcywgZXh0cmFNZXRob2RzKSxcbiAgICB7XG4gICAgICBzdGF0ZVNoYXBlOiB7IHVuZGVybHlpbmc6IE0ub3B0KE0ucmVtb3RhYmxlKFwidW5kZXJseWluZ1wiKSkgfVxuICAgIH1cbiAgKTtcbn07XG5oYXJkZW4ocHJlcGFyZUF0dGVudWF0b3JNYWtlcik7XG52YXIgUmVtb3RhYmxlUHJlZml4UkUgPSAvXihBbGxlZ2VkOiB8RGVidWdOYW1lOiApLztcbnZhciBhdHRlbnVhdGVPbmUgPSAodW5kZXJseWluZywgdU1ldGhvZE5hbWVzLCBvcHRpb25zID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IGhlYXBab25lID0gbWFrZUhlYXBab25lKCk7XG4gIGNvbnN0IHVLaW5kTmFtZSA9ICh1bmRlcmx5aW5nW1N5bWJvbC50b1N0cmluZ1RhZ10gfHwgXCJVbmRlcmx5aW5nXCIpLnJlcGxhY2UoXG4gICAgUmVtb3RhYmxlUHJlZml4UkUsXG4gICAgXCJcIlxuICApO1xuICBjb25zdCBtYWtlQXR0ZW51YXRvciA9IHByZXBhcmVBdHRlbnVhdG9yTWFrZXIoXG4gICAgaGVhcFpvbmUsXG4gICAgdUtpbmROYW1lLFxuICAgIHVNZXRob2ROYW1lcyxcbiAgICBvcHRpb25zXG4gICk7XG4gIHJldHVybiBtYWtlQXR0ZW51YXRvcih1bmRlcmx5aW5nKTtcbn07XG5oYXJkZW4oYXR0ZW51YXRlT25lKTtcblxuLy9cbnZhciBwcmVwYXJlUmV2b2NhYmxlTWFrZXJLaXQgPSAoem9uZSwgdUtpbmROYW1lLCB1TWV0aG9kTmFtZXMsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgdUludGVyZmFjZU5hbWUgPSB1S2luZE5hbWUsXG4gICAgZXh0cmFNZXRob2RHdWFyZHMgPSB7fSxcbiAgICBleHRyYU1ldGhvZHMgPSB7fVxuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgUmV2b2NhYmxlSUtpdCA9IGhhcmRlbih7XG4gICAgcmV2b2tlcjogTS5pbnRlcmZhY2UoYCR7dUludGVyZmFjZU5hbWV9X3Jldm9rZXJgLCB7XG4gICAgICByZXZva2U6IE0uY2FsbCgpLnJldHVybnMoTS5ib29sZWFuKCkpXG4gICAgfSksXG4gICAgcmV2b2NhYmxlOiBNLmludGVyZmFjZShgJHt1SW50ZXJmYWNlTmFtZX1fcmV2b2NhYmxlYCwgZXh0cmFNZXRob2RHdWFyZHMsIHtcbiAgICAgIGRlZmF1bHRHdWFyZHM6IFwicmF3XCJcbiAgICB9KVxuICB9KTtcbiAgY29uc3QgcmV2b2NhYmxlS2luZE5hbWUgPSBgJHt1S2luZE5hbWV9X2NhcmV0YWtlcmA7XG4gIGxldCBhbXBsaWZpZXI7XG4gIGNvbnN0IG1ha2VSZXZvY2FibGVLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgIHJldm9jYWJsZUtpbmROYW1lLFxuICAgIFJldm9jYWJsZUlLaXQsXG4gICAgKHVuZGVybHlpbmcpID0+ICh7IHVuZGVybHlpbmcgfSksXG4gICAge1xuICAgICAgcmV2b2tlcjoge1xuICAgICAgICByZXZva2UoKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICBpZiAoc3RhdGUudW5kZXJseWluZyA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHN0YXRlLnVuZGVybHlpbmcgPSB2b2lkIDA7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXZvY2FibGU6IHdyYXBwZXJNZXRob2RzKHJldm9jYWJsZUtpbmROYW1lLCB1TWV0aG9kTmFtZXMsIGV4dHJhTWV0aG9kcylcbiAgICB9LFxuICAgIHtcbiAgICAgIHN0YXRlU2hhcGU6IHsgdW5kZXJseWluZzogTS5vcHQoTS5yZW1vdGFibGUoXCJ1bmRlcmx5aW5nXCIpKSB9LFxuICAgICAgcmVjZWl2ZUFtcGxpZmllcjogKGFtcCkgPT4ge1xuICAgICAgICBhbXBsaWZpZXIgPSBhbXA7XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlUmV2b2NhYmxlID0gKHVuZGVybHlpbmcpID0+IG1ha2VSZXZvY2FibGVLaXQodW5kZXJseWluZykucmV2b2NhYmxlO1xuICBjb25zdCByZXZva2UgPSAocmV2b2NhYmxlKSA9PiB7XG4gICAgY29uc3QgZmFjZXRzID0gYW1wbGlmaWVyKHJldm9jYWJsZSk7XG4gICAgaWYgKGZhY2V0cyA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBmYWNldHMucmV2b2tlci5yZXZva2UoKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgcmV2b2tlLFxuICAgIG1ha2VSZXZvY2FibGUsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIG1ha2VSZXZvY2FibGVLaXRcbiAgfSk7XG59O1xuaGFyZGVuKHByZXBhcmVSZXZvY2FibGVNYWtlcktpdCk7XG5cbi8vXG52YXIgVHJhbnNmZXJQcm9wb3NhbFNoYXBlID0gTS5zcGxpdFJlY29yZCh7XG4gIGdpdmU6IHt9LFxuICB3YW50OiB7fSxcbiAgZXhpdDoge1xuICAgIG9uRGVtYW5kOiBudWxsXG4gIH1cbn0pO1xudmFyIHByZXBhcmVPd25hYmxlID0gKHpvbmUsIG1ha2VJbnZpdGF0aW9uLCB1S2luZE5hbWUsIHVNZXRob2ROYW1lcywgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHsgdUludGVyZmFjZU5hbWUgPSB1S2luZE5hbWUgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IHsgcmV2b2tlLCBtYWtlUmV2b2NhYmxlIH0gPSBwcmVwYXJlUmV2b2NhYmxlTWFrZXJLaXQoXG4gICAgem9uZSxcbiAgICB1S2luZE5hbWUsXG4gICAgdU1ldGhvZE5hbWVzLFxuICAgIHtcbiAgICAgIHVJbnRlcmZhY2VOYW1lLFxuICAgICAgZXh0cmFNZXRob2RHdWFyZHM6IHtcbiAgICAgICAgbWFrZVRyYW5zZmVySW52aXRhdGlvbjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgICAgIH0sXG4gICAgICBleHRyYU1ldGhvZHM6IHtcbiAgICAgICAgbWFrZVRyYW5zZmVySW52aXRhdGlvbigpIHtcbiAgICAgICAgICBjb25zdCB7IHVuZGVybHlpbmcgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyByZXZvY2FibGUgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IGN1c3RvbURldGFpbHMgPSB1bmRlcmx5aW5nLmdldEludml0YXRpb25DdXN0b21EZXRhaWxzKCk7XG4gICAgICAgICAgY29uc3QgdHJhbnNmZXJIYW5kbGVyID0gbWFrZVRyYW5zZmVySGFuZGxlcih1bmRlcmx5aW5nKTtcbiAgICAgICAgICBjb25zdCBpbnZpdGF0aW9uID0gbWFrZUludml0YXRpb24oXG4gICAgICAgICAgICB0cmFuc2ZlckhhbmRsZXIsXG4gICAgICAgICAgICBcInRyYW5zZmVyXCIsXG4gICAgICAgICAgICBjdXN0b21EZXRhaWxzLFxuICAgICAgICAgICAgVHJhbnNmZXJQcm9wb3NhbFNoYXBlXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXZva2UocmV2b2NhYmxlKTtcbiAgICAgICAgICByZXR1cm4gaW52aXRhdGlvbjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgbWFrZVRyYW5zZmVySGFuZGxlciA9IHpvbmUuZXhvQ2xhc3MoXG4gICAgXCJUcmFuc2ZlckhhbmRsZXJcIixcbiAgICBPZmZlckhhbmRsZXJJLFxuICAgICh1bmRlcmx5aW5nKSA9PiAoe1xuICAgICAgdW5kZXJseWluZ1xuICAgIH0pLFxuICAgIHtcbiAgICAgIGhhbmRsZShzZWF0KSB7XG4gICAgICAgIGNvbnN0IHsgdW5kZXJseWluZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgcmV2b2NhYmxlID0gbWFrZVJldm9jYWJsZSh1bmRlcmx5aW5nKTtcbiAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgIHJldHVybiByZXZvY2FibGU7XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlT3duYWJsZSA9ICh1bmRlcmx5aW5nKSA9PiBtYWtlUmV2b2NhYmxlKHVuZGVybHlpbmcpO1xuICByZXR1cm4gaGFyZGVuKG1ha2VPd25hYmxlKTtcbn07XG5oYXJkZW4ocHJlcGFyZU93bmFibGUpO1xuXG4vL1xudmFyIHRyYWNlNyA9IG1ha2VUcmFjZXIoXCJQQVwiLCBmYWxzZSk7XG52YXIgR3VhcmRDYWxsQW1vdW50VHVwbGUgPSBNLmNhbGwoQW1vdW50U2hhcGUyLCBBbW91bnRTaGFwZTIpLnJldHVybnMoXG4gIE0ucHJvbWlzZSgpXG4pO1xudmFyIFByaWNlQXV0aG9yaXR5SSA9IE0uaW50ZXJmYWNlKFwiUHJpY2VBdXRob3JpdHlcIiwge1xuICBnZXRRdW90ZUlzc3VlcjogTS5jYWxsKEJyYW5kU2hhcGUyLCBCcmFuZFNoYXBlMikucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldFRpbWVyU2VydmljZTogTS5jYWxsKEJyYW5kU2hhcGUyLCBCcmFuZFNoYXBlMikucmV0dXJucyhNLnByb21pc2UoKSksXG4gIHF1b3RlR2l2ZW46IE0uY2FsbChBbW91bnRTaGFwZTIsIEJyYW5kU2hhcGUyKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgcXVvdGVXYW50ZWQ6IE0uY2FsbChCcmFuZFNoYXBlMiwgQW1vdW50U2hhcGUyKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgbWFrZVF1b3RlTm90aWZpZXI6IE0uY2FsbChBbW91bnRTaGFwZTIsIEJyYW5kU2hhcGUyKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgcXVvdGVBdFRpbWU6IE0uY2FsbChUaW1lc3RhbXBTaGFwZSwgQW1vdW50U2hhcGUyLCBCcmFuZFNoYXBlMikucmV0dXJucyhcbiAgICBNLnByb21pc2UoKVxuICApLFxuICBxdW90ZVdoZW5MVDogR3VhcmRDYWxsQW1vdW50VHVwbGUsXG4gIHF1b3RlV2hlbkxURTogR3VhcmRDYWxsQW1vdW50VHVwbGUsXG4gIHF1b3RlV2hlbkdURTogR3VhcmRDYWxsQW1vdW50VHVwbGUsXG4gIHF1b3RlV2hlbkdUOiBHdWFyZENhbGxBbW91bnRUdXBsZSxcbiAgbXV0YWJsZVF1b3RlV2hlbkxUOiBHdWFyZENhbGxBbW91bnRUdXBsZSxcbiAgbXV0YWJsZVF1b3RlV2hlbkxURTogR3VhcmRDYWxsQW1vdW50VHVwbGUsXG4gIG11dGFibGVRdW90ZVdoZW5HVEU6IEd1YXJkQ2FsbEFtb3VudFR1cGxlLFxuICBtdXRhYmxlUXVvdGVXaGVuR1Q6IEd1YXJkQ2FsbEFtb3VudFR1cGxlXG59KTtcblxuLy9cbnZhciB1bml0QW1vdW50ID0gYXN5bmMgKGJyYW5kKSA9PiB7XG4gIGNvbnN0IGRpc3BsYXlJbmZvID0gYXdhaXQgRShicmFuZCkuZ2V0RGlzcGxheUluZm8oKTtcbiAgY29uc3QgZGVjaW1hbFBsYWNlcyA9IGRpc3BsYXlJbmZvLmRlY2ltYWxQbGFjZXMgPz8gMDtcbiAgcmV0dXJuIEFtb3VudE1hdGgyLm1ha2UoYnJhbmQsIDEwbiAqKiBOYXQoZGVjaW1hbFBsYWNlcykpO1xufTtcbmhhcmRlbih1bml0QW1vdW50KTtcblxuLy9cbnZhciB0cmFjZTggPSBtYWtlVHJhY2VyMihcIlpvZVRvb2xzXCIpO1xudmFyIHsgYXNzaWduOiBhc3NpZ240LCBrZXlzOiBrZXlzMywgdmFsdWVzOiB2YWx1ZXM2IH0gPSBPYmplY3Q7XG52YXIgbWFrZVpvZVRvb2xzID0gKHpjZiwgeyB3aGVuLCBhbGxWb3dzLCBhbGxTZXR0bGVkLCBhc1ZvdyB9KSA9PiB7XG4gIGNvbnN0IGxvY2FsVHJhbnNmZXIgPSAoc3JjU2VhdCwgbG9jYWxBY2NvdW50LCBhbW91bnRzKSA9PiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgIXNyY1NlYXQuaGFzRXhpdGVkKCkgfHwgdGhyb3dSZWRhY3RlZGBUaGUgc2VhdCBjYW5ub3QgaGF2ZSBleGl0ZWQuYDtcbiAgICBjb25zdCB7IHpjZlNlYXQ6IHRlbXBTZWF0LCB1c2VyU2VhdDogdXNlclNlYXRQIH0gPSB6Y2YubWFrZUVtcHR5U2VhdEtpdCgpO1xuICAgIGNvbnN0IHVzZXJTZWF0ID0gYXdhaXQgdXNlclNlYXRQO1xuICAgIHpjZi5hdG9taWNSZWFycmFuZ2UoaGFyZGVuKFtbc3JjU2VhdCwgdGVtcFNlYXQsIGFtb3VudHNdXSkpO1xuICAgIHRlbXBTZWF0LmV4aXQoKTtcbiAgICBjb25zdCBwYXltZW50cyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAga2V5czMoYW1vdW50cykubWFwKChrdykgPT4gRSh1c2VyU2VhdCkuZ2V0UGF5b3V0KGt3KSlcbiAgICApO1xuICAgIGNvbnN0IHNldHRsZURlcG9zaXRzID0gYXdhaXQgd2hlbihcbiAgICAgIGFsbFNldHRsZWQocGF5bWVudHMubWFwKChwbXQpID0+IEUobG9jYWxBY2NvdW50KS5kZXBvc2l0KHBtdCkpKVxuICAgICk7XG4gICAgaWYgKHNldHRsZURlcG9zaXRzLmZpbmQoKHgpID0+IHguc3RhdHVzID09PSBcInJlamVjdGVkXCIpKSB7XG4gICAgICBjb25zdCBhbXRzID0gdmFsdWVzNihhbW91bnRzKTtcbiAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xuICAgICAgY29uc3QgcGF5bWVudHNPcldpdGhkcmF3VnMgPSBzZXR0bGVEZXBvc2l0cy5tYXAoKHgsIGkyKSA9PiB7XG4gICAgICAgIGlmICh4LnN0YXR1cyA9PT0gXCJyZWplY3RlZFwiKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goeC5yZWFzb24pO1xuICAgICAgICAgIHJldHVybiBwYXltZW50c1tpMl07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIEUobG9jYWxBY2NvdW50KS53aXRoZHJhdyhhbXRzW2kyXSk7XG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHBheW1lbnRzVG9SZXR1cm4gPSBhd2FpdCB3aGVuKGFsbFZvd3MocGF5bWVudHNPcldpdGhkcmF3VnMpKTtcbiAgICAgIGNvbnN0IHBheW1lbnRLd3IgPSBoYXJkZW4oXG4gICAgICAgIGtleXMzKGFtb3VudHMpLnJlZHVjZShcbiAgICAgICAgICAoa3dyLCBrdywgaTIpID0+IGFzc2lnbjQoa3dyLCB7IFtrd106IHBheW1lbnRzVG9SZXR1cm5baTJdIH0pLFxuICAgICAgICAgIHt9XG4gICAgICAgIClcbiAgICAgICk7XG4gICAgICBjb25zdCBkZXBvc2l0UmVzcG9uc2UgPSBhd2FpdCBkZXBvc2l0VG9TZWF0KFxuICAgICAgICB6Y2YsXG4gICAgICAgIHNyY1NlYXQsXG4gICAgICAgIGFtb3VudHMsXG4gICAgICAgIHBheW1lbnRLd3JcbiAgICAgICk7XG4gICAgICB0cmFjZTgoXCJsb2NhbFRyYW5zZmVyIGRlcG9zaXRSZXNwb25zZVwiLCBkZXBvc2l0UmVzcG9uc2UpO1xuICAgICAgdGhyb3cgbWFrZUVycm9yKGBPbmUgb3IgbW9yZSBkZXBvc2l0cyBmYWlsZWQgJHtxdW90ZShlcnJvcnMpfWApO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IHdpdGhkcmF3VG9TZWF0ID0gKGxvY2FsQWNjb3VudCwgZGVzdFNlYXQsIGFtb3VudHMpID0+IGFzVm93KGFzeW5jICgpID0+IHtcbiAgICAhZGVzdFNlYXQuaGFzRXhpdGVkKCkgfHwgdGhyb3dSZWRhY3RlZGBUaGUgc2VhdCBjYW5ub3QgaGF2ZSBleGl0ZWQuYDtcbiAgICBjb25zdCBzZXR0bGVkV2l0aGRyYXdhbHMgPSBhd2FpdCB3aGVuKFxuICAgICAgYWxsU2V0dGxlZCh2YWx1ZXM2KGFtb3VudHMpLm1hcCgoYW10KSA9PiBFKGxvY2FsQWNjb3VudCkud2l0aGRyYXcoYW10KSkpXG4gICAgKTtcbiAgICBpZiAoc2V0dGxlZFdpdGhkcmF3YWxzLmZpbmQoKHgpID0+IHguc3RhdHVzID09PSBcInJlamVjdGVkXCIpKSB7XG4gICAgICBjb25zdCByZXR1cm5QYXltZW50VnMgPSBbXTtcbiAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xuICAgICAgZm9yIChjb25zdCByZXN1bHQgb2Ygc2V0dGxlZFdpdGhkcmF3YWxzKSB7XG4gICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSBcImZ1bGZpbGxlZFwiKSB7XG4gICAgICAgICAgcmV0dXJuUGF5bWVudFZzLnB1c2goRShsb2NhbEFjY291bnQpLmRlcG9zaXQocmVzdWx0LnZhbHVlKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2gocmVzdWx0LnJlYXNvbik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGF3YWl0IHdoZW4oYWxsVm93cyhyZXR1cm5QYXltZW50VnMpKTtcbiAgICAgIHRocm93IG1ha2VFcnJvcihgT25lIG9yIG1vcmUgd2l0aGRyYXdhbHMgZmFpbGVkICR7cXVvdGUoZXJyb3JzKX1gKTtcbiAgICB9XG4gICAgY29uc3QgcGF5bWVudEt3ciA9IGhhcmRlbihcbiAgICAgIGtleXMzKGFtb3VudHMpLnJlZHVjZShcbiAgICAgICAgKGFjYywga3csIGkyKSA9PiBhc3NpZ240KGFjYywge1xuICAgICAgICAgIFtrd106IChcbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHNldHRsZWRXaXRoZHJhd2Fsc1tpMl0udmFsdWVcbiAgICAgICAgICApXG4gICAgICAgIH0pLFxuICAgICAgICB7fVxuICAgICAgKVxuICAgICk7XG4gICAgY29uc3QgZGVwb3NpdFJlc3BvbnNlID0gYXdhaXQgZGVwb3NpdFRvU2VhdChcbiAgICAgIHpjZixcbiAgICAgIGRlc3RTZWF0LFxuICAgICAgYW1vdW50cyxcbiAgICAgIHBheW1lbnRLd3JcbiAgICApO1xuICAgIHRyYWNlOChcIndpdGhkcmF3VG9TZWF0IGRlcG9zaXRSZXNwb25zZVwiLCBkZXBvc2l0UmVzcG9uc2UpO1xuICB9KTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgbG9jYWxUcmFuc2ZlcixcbiAgICB3aXRoZHJhd1RvU2VhdFxuICB9KTtcbn07XG5cbi8vXG52YXIgSGFuZGxlclNoYXBlID0gTS5yZW1vdGFibGUoXCJPZmZlckhhbmRsZXJcIik7XG52YXIgbWFrZVpjZlRvb2xzID0gKHpjZiwgdm93VG9vbHMpID0+IGhhcmRlbih7XG4gIG1ha2VJbnZpdGF0aW9uKG9mZmVySGFuZGxlciwgZGVzY3JpcHRpb24sIGN1c3RvbURldGFpbHMsIHByb3Bvc2FsU2hhcGUpIHtcbiAgICBtdXN0TWF0Y2gob2ZmZXJIYW5kbGVyLCBIYW5kbGVyU2hhcGUpO1xuICAgIHJldHVybiB2b3dUb29scy53YXRjaChcbiAgICAgIHpjZi5tYWtlSW52aXRhdGlvbihcbiAgICAgICAgb2ZmZXJIYW5kbGVyLFxuICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgY3VzdG9tRGV0YWlscyxcbiAgICAgICAgcHJvcG9zYWxTaGFwZVxuICAgICAgKVxuICAgICk7XG4gIH0sXG4gIGF0b21pY1JlYXJyYW5nZSh0cmFuc2ZlcnMpIHtcbiAgICB6Y2YuYXRvbWljUmVhcnJhbmdlKHRyYW5zZmVycyk7XG4gIH0sXG4gIGFzc2VydFVuaXF1ZUtleXdvcmQoa2V5d29yZCkge1xuICAgIHpjZi5hc3NlcnRVbmlxdWVLZXl3b3JkKGtleXdvcmQpO1xuICB9XG59KTtcblxuLy9cbnZhciBwcm92aWRlT3JjaGVzdHJhdGlvbiA9ICh6Y2YsIGJhZ2dhZ2UsIHJlbW90ZVBvd2VycywgbWFyc2hhbGxlciwgb3B0cyA9IHt9KSA9PiB7XG4gIGNvbnN0IHpvbmVzID0gKCgpID0+IHtcbiAgICBjb25zdCB6b25lID0gbWFrZUR1cmFibGVab25lKGJhZ2dhZ2UpO1xuICAgIHJldHVybiB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBhc3luY0Zsb3c6IHpvbmUuc3ViWm9uZShcImFzeW5jRmxvd1wiKSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIG9yY2hlc3RyYXRpb246IHpvbmUuc3ViWm9uZShcIm9yY2hlc3RyYXRpb25cIiksXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgY2hhaW5IdWI6IHpvbmUuc3ViWm9uZShcImNoYWluSHViXCIpLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgdm93czogem9uZS5zdWJab25lKFwidm93c1wiKSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBjb250cmFjdDogem9uZS5zdWJab25lKFwiY29udHJhY3RcIilcbiAgICB9O1xuICB9KSgpO1xuICBjb25zdCB7IGFnb3JpY05hbWVzLCB0aW1lclNlcnZpY2UsIGxvY2FsY2hhaW4gfSA9IHJlbW90ZVBvd2VycztcbiAgY29uc3Qgdm93VG9vbHMgPSBwcmVwYXJlU3dpbmdzZXRWb3dUb29scyh6b25lcy52b3dzKTtcbiAgY29uc3QgY2hhaW5IdWIgPSBtYWtlQ2hhaW5IdWIoem9uZXMuY2hhaW5IdWIsIGFnb3JpY05hbWVzLCB2b3dUb29scywge1xuICAgIGNoYWluSW5mb1ZhbHVlU2hhcGU6IG9wdHMuY2hhaW5JbmZvVmFsdWVTaGFwZVxuICB9KTtcbiAgY29uc3Qgem9lVG9vbHMgPSBtYWtlWm9lVG9vbHMoemNmLCB2b3dUb29scyk7XG4gIGNvbnN0IHpjZlRvb2xzID0gbWFrZVpjZlRvb2xzKHpjZiwgdm93VG9vbHMpO1xuICBjb25zdCB7IG1ha2VSZWNvcmRlcktpdCB9ID0gcHJlcGFyZVJlY29yZGVyS2l0TWFrZXJzKGJhZ2dhZ2UsIG1hcnNoYWxsZXIpO1xuICBjb25zdCBtYWtlTG9jYWxPcmNoZXN0cmF0aW9uQWNjb3VudEtpdCA9IHByZXBhcmVMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0KFxuICAgIHpvbmVzLm9yY2hlc3RyYXRpb24sXG4gICAge1xuICAgICAgbWFrZVJlY29yZGVyS2l0LFxuICAgICAgemNmLFxuICAgICAgdGltZXJTZXJ2aWNlLFxuICAgICAgdm93VG9vbHMsXG4gICAgICBjaGFpbkh1YixcbiAgICAgIGxvY2FsY2hhaW4sXG4gICAgICB6b2VUb29sc1xuICAgIH1cbiAgKTtcbiAgY29uc3QgYXN5bmNGbG93VG9vbHMgPSBwcmVwYXJlQXN5bmNGbG93VG9vbHMoem9uZXMuYXN5bmNGbG93LCB7XG4gICAgdm93VG9vbHNcbiAgfSk7XG4gIGNvbnN0IG1ha2VDb3Ntb3NPcmNoZXN0cmF0aW9uQWNjb3VudCA9IHByZXBhcmVDb3Ntb3NPcmNoZXN0cmF0aW9uQWNjb3VudChcbiAgICB6b25lcy5vcmNoZXN0cmF0aW9uLFxuICAgIHtcbiAgICAgIGNoYWluSHViLFxuICAgICAgbWFrZVJlY29yZGVyS2l0LFxuICAgICAgdGltZXJTZXJ2aWNlLFxuICAgICAgdm93VG9vbHMsXG4gICAgICB6Y2ZcbiAgICB9XG4gICk7XG4gIGNvbnN0IG1ha2VSZW1vdGVDaGFpbkZhY2FkZSA9IHByZXBhcmVSZW1vdGVDaGFpbkZhY2FkZSh6b25lcy5vcmNoZXN0cmF0aW9uLCB7XG4gICAgbWFrZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50LFxuICAgIG9yY2hlc3RyYXRpb246IHJlbW90ZVBvd2Vycy5vcmNoZXN0cmF0aW9uU2VydmljZSxcbiAgICBzdG9yYWdlTm9kZTogcmVtb3RlUG93ZXJzLnN0b3JhZ2VOb2RlLFxuICAgIHRpbWVyOiByZW1vdGVQb3dlcnMudGltZXJTZXJ2aWNlLFxuICAgIHZvd1Rvb2xzXG4gIH0pO1xuICBjb25zdCBtYWtlTG9jYWxDaGFpbkZhY2FkZSA9IHByZXBhcmVMb2NhbENoYWluRmFjYWRlKHpvbmVzLm9yY2hlc3RyYXRpb24sIHtcbiAgICBtYWtlTG9jYWxPcmNoZXN0cmF0aW9uQWNjb3VudEtpdCxcbiAgICBsb2NhbGNoYWluOiByZW1vdGVQb3dlcnMubG9jYWxjaGFpbixcbiAgICAvL1xuICAgIHN0b3JhZ2VOb2RlOiByZW1vdGVQb3dlcnMuc3RvcmFnZU5vZGUsXG4gICAgYWdvcmljTmFtZXMsXG4gICAgb3JjaGVzdHJhdGlvbjogcmVtb3RlUG93ZXJzLm9yY2hlc3RyYXRpb25TZXJ2aWNlLFxuICAgIHRpbWVyOiByZW1vdGVQb3dlcnMudGltZXJTZXJ2aWNlLFxuICAgIHZvd1Rvb2xzXG4gIH0pO1xuICBjb25zdCBtYWtlT3JjaGVzdHJhdG9yID0gcHJlcGFyZU9yY2hlc3RyYXRvcih6b25lcy5vcmNoZXN0cmF0aW9uLCB7XG4gICAgY2hhaW5IdWIsXG4gICAgbWFrZUxvY2FsQ2hhaW5GYWNhZGUsXG4gICAgbWFrZVJlbW90ZUNoYWluRmFjYWRlLFxuICAgIHZvd1Rvb2xzXG4gIH0pO1xuICBjb25zdCBtYWtlT3JjaGVzdHJhdGVLaXQgPSAoem9uZSkgPT4gbWFrZU9yY2hlc3RyYXRpb25GYWNhZGUoe1xuICAgIHpvbmUsXG4gICAgemNmLFxuICAgIG1ha2VPcmNoZXN0cmF0b3IsXG4gICAgYXN5bmNGbG93VG9vbHMsXG4gICAgdm93VG9vbHMsXG4gICAgLi4ucmVtb3RlUG93ZXJzXG4gIH0pO1xuICBjb25zdCBkZWZhdWx0T3JjaGVzdHJhdGVLaXQgPSBtYWtlT3JjaGVzdHJhdGVLaXQoXG4gICAgem9uZXMuY29udHJhY3Quc3ViWm9uZShcIm9yY2hlc3RyYXRpb25cIilcbiAgKTtcbiAgemNmLnNldFRlc3RKaWcoKCkgPT4gKHtcbiAgICBiYWdnYWdlLFxuICAgIGNoYWluSHViXG4gIH0pKTtcbiAgcmV0dXJuIHtcbiAgICAuLi5kZWZhdWx0T3JjaGVzdHJhdGVLaXQsXG4gICAgbWFrZU9yY2hlc3RyYXRlS2l0LFxuICAgIGJhZ2dhZ2UsXG4gICAgY2hhaW5IdWIsXG4gICAgdm93VG9vbHMsXG4gICAgYXN5bmNGbG93VG9vbHMsXG4gICAgemNmVG9vbHMsXG4gICAgem9lVG9vbHMsXG4gICAgem9uZTogem9uZXMuY29udHJhY3RcbiAgfTtcbn07XG5oYXJkZW4ocHJvdmlkZU9yY2hlc3RyYXRpb24pO1xudmFyIHdpdGhPcmNoZXN0cmF0aW9uID0gKGNvbnRyYWN0Rm4sIG9wdHMpID0+IGFzeW5jICh6Y2YsIHByaXZhdGVBcmdzLCBiYWdnYWdlKSA9PiB7XG4gIGNvbnN0IHsgbWFyc2hhbGxlciwgLi4uYWxsT3JjaFBvd2VycyB9ID0gcHJpdmF0ZUFyZ3M7XG4gIGNvbnN0IHsgc3RvcmFnZU5vZGU6IF8sIC4uLnJlcXVpcmVkT3JjaFBvd2VycyB9ID0gYWxsT3JjaFBvd2VycztcbiAgY29uc3QgeyBwdWJsaXNoQWNjb3VudEluZm8sIGNoYWluSW5mb1ZhbHVlU2hhcGUgfSA9IG9wdHMgPz8ge307XG4gIGNvbnN0IHsgem9uZSwgLi4udG9vbHMgfSA9IHByb3ZpZGVPcmNoZXN0cmF0aW9uKFxuICAgIHpjZixcbiAgICBiYWdnYWdlLFxuICAgIHB1Ymxpc2hBY2NvdW50SW5mbyA/IGFsbE9yY2hQb3dlcnMgOiByZXF1aXJlZE9yY2hQb3dlcnMsXG4gICAgbWFyc2hhbGxlcixcbiAgICB7IGNoYWluSW5mb1ZhbHVlU2hhcGUgfVxuICApO1xuICByZXR1cm4gY29udHJhY3RGbih6Y2YsIHByaXZhdGVBcmdzLCB6b25lLCB0b29scyk7XG59O1xuaGFyZGVuKHdpdGhPcmNoZXN0cmF0aW9uKTtcblxuLy9cbnZhciByZWdpc3RlckNoYWluc0FuZEFzc2V0cyA9IChjaGFpbkh1YiwgYnJhbmRzLCBjaGFpbkluZm8sIGFzc2V0SW5mbywgeyBsb2cgPSAoKSA9PiB7XG59IH0gPSB7fSkgPT4ge1xuICBsb2coXCJjaGFpbkh1YjogcmVnaXN0ZXJpbmcgY2hhaW5zXCIsIE9iamVjdC5rZXlzKGNoYWluSW5mbyB8fCB7fSkpO1xuICBpZiAoIWNoYWluSW5mbykge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBjb25ucyA9IHt9O1xuICBmb3IgKGNvbnN0IFtjaGFpbk5hbWUsIGFsbEluZm9dIG9mIE9iamVjdC5lbnRyaWVzKGNoYWluSW5mbykpIHtcbiAgICBpZiAoYWxsSW5mby5uYW1lc3BhY2UgPT09IFwiY29zbW9zXCIpIHtcbiAgICAgIGNvbnN0IHsgY29ubmVjdGlvbnMsIC4uLmluZm8gfSA9IGFsbEluZm87XG4gICAgICBjaGFpbkh1Yi5yZWdpc3RlckNoYWluKGNoYWluTmFtZSwgaW5mbyk7XG4gICAgICBpZiAoY29ubmVjdGlvbnMpIGNvbm5zW2luZm8uY2hhaW5JZF0gPSBjb25uZWN0aW9ucztcbiAgICB9IGVsc2Uge1xuICAgICAgY2hhaW5IdWIucmVnaXN0ZXJDaGFpbihjaGFpbk5hbWUsIGFsbEluZm8pO1xuICAgIH1cbiAgfVxuICBjb25zdCByZWdpc3RlcmVkUGFpcnMgPSAvKiAgICAgICAgICAgKi8gbmV3IFNldCgpO1xuICBmb3IgKGNvbnN0IFtwQ2hhaW5JZCwgY29ubkluZm9zXSBvZiBPYmplY3QuZW50cmllcyhjb25ucykpIHtcbiAgICBmb3IgKGNvbnN0IFtjQ2hhaW5JZCwgY29ubkluZm9dIG9mIE9iamVjdC5lbnRyaWVzKGNvbm5JbmZvcykpIHtcbiAgICAgIGNvbnN0IHBhaXIgPSBbcENoYWluSWQsIGNDaGFpbklkXS5zb3J0KCkuam9pbihcIjwtPlwiKTtcbiAgICAgIGlmICghcmVnaXN0ZXJlZFBhaXJzLmhhcyhwYWlyKSkge1xuICAgICAgICBjaGFpbkh1Yi5yZWdpc3RlckNvbm5lY3Rpb24ocENoYWluSWQsIGNDaGFpbklkLCBjb25uSW5mbyk7XG4gICAgICAgIHJlZ2lzdGVyZWRQYWlycy5hZGQocGFpcik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGxvZyhcImNoYWluSHViOiByZWdpc3RlcmVkIGNvbm5lY3Rpb25zXCIsIFsuLi5yZWdpc3RlcmVkUGFpcnNdLnNvcnQoKSk7XG4gIGxvZyhcbiAgICBcImNoYWluSHViOiByZWdpc3RlcmluZyBhc3NldHNcIixcbiAgICBhc3NldEluZm8/Lm1hcCgoW2Rlbm9tLCB7IGNoYWluTmFtZSB9XSkgPT4gYCR7Y2hhaW5OYW1lfTogJHtkZW5vbX1gKVxuICApO1xuICBpZiAoIWFzc2V0SW5mbykge1xuICAgIHJldHVybjtcbiAgfVxuICBmb3IgKGNvbnN0IFtkZW5vbSwgaW5mb10gb2YgYXNzZXRJbmZvKSB7XG4gICAgY29uc3QgeyBicmFuZEtleSwgLi4ucmVzdCB9ID0gaW5mbztcbiAgICBjb25zdCBpbmZvV2l0aEJyYW5kID0gYnJhbmRLZXkgPyB7IC4uLnJlc3QsIGJyYW5kOiBicmFuZHNbYnJhbmRLZXldIH0gOiByZXN0O1xuICAgIGNoYWluSHViLnJlZ2lzdGVyQXNzZXQoZGVub20sIGluZm9XaXRoQnJhbmQpO1xuICB9XG59O1xuXG4vL1xudmFyIEJyaWRnZUlkMyA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIEJBTks6IFwiYmFua1wiLFxuICAgIENPUkU6IFwiY29yZVwiLFxuICAgIERJQkM6IFwiZGliY1wiLFxuICAgIFNUT1JBR0U6IFwic3RvcmFnZVwiLFxuICAgIFBST1ZJU0lPTjogXCJwcm92aXNpb25cIixcbiAgICBQUk9WSVNJT05fU01BUlRfV0FMTEVUOiBcInByb3Zpc2lvbldhbGxldFwiLFxuICAgIFZMT0NBTENIQUlOOiBcInZsb2NhbGNoYWluXCIsXG4gICAgVlRSQU5TRkVSOiBcInZ0cmFuc2ZlclwiLFxuICAgIFdBTExFVDogXCJ3YWxsZXRcIlxuICB9XG4pO1xuaGFyZGVuKEJyaWRnZUlkMyk7XG52YXIgQ29zbW9zSW5pdEtleVRvQnJpZGdlSWQzID0ge1xuICB2YmFua1BvcnQ6IFwiYmFua1wiLFxuICB2aWJjUG9ydDogXCJkaWJjXCJcbn07XG5oYXJkZW4oQ29zbW9zSW5pdEtleVRvQnJpZGdlSWQzKTtcbnZhciBXYWxsZXROYW1lMyA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIGRlcG9zaXRGYWNldDogXCJkZXBvc2l0RmFjZXRcIlxuICB9XG4pO1xuaGFyZGVuKFdhbGxldE5hbWUzKTtcbnZhciBWQmFua0FjY291bnQzID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgcmVzZXJ2ZToge1xuICAgICAgbW9kdWxlOiBcInZiYW5rL3Jlc2VydmVcIixcbiAgICAgIGFkZHJlc3M6IFwiYWdvcmljMWFlMGxtdHpsZ3JjbmxhOXhqa3BhYXJxNWQ1ZGZlejYzaDNudWNsXCJcbiAgICB9LFxuICAgIHByb3Zpc2lvbjoge1xuICAgICAgbW9kdWxlOiBcInZiYW5rL3Byb3Zpc2lvblwiLFxuICAgICAgYWRkcmVzczogXCJhZ29yaWMxbWVnenl0ZzY1Y3lyZ3pzNmZ2enhncmNxdnd3bDd1Z3B0NjIzNDZcIlxuICAgIH1cbiAgfVxuKTtcbmhhcmRlbihWQmFua0FjY291bnQzKTtcblxuLy9cbnZhciBkZWJ1Z0luc3RhbmNlMyA9IDE7XG52YXIgbWFrZVRyYWNlcjMgPSAobmFtZSwgZW5hYmxlID0gdHJ1ZSkgPT4ge1xuICBkZWJ1Z0luc3RhbmNlMyArPSAxO1xuICBsZXQgZGVidWdDb3VudCA9IDE7XG4gIGNvbnN0IGtleSA9IGAtLS0tLSAke25hbWV9LiR7ZGVidWdJbnN0YW5jZTN9IGA7XG4gIHN3aXRjaCAoZW5hYmxlKSB7XG4gICAgY2FzZSBmYWxzZToge1xuICAgICAgY29uc3QgbG9nRGlzYWJsZWQgPSAoLi4uX2FyZ3MpID0+IHtcbiAgICAgIH07XG4gICAgICByZXR1cm4gbG9nRGlzYWJsZWQ7XG4gICAgfVxuICAgIGNhc2UgXCJ2ZXJib3NlXCI6IHtcbiAgICAgIGNvbnN0IGluZm9UaWNrID0gKG9wdExvZywgLi4uYXJncykgPT4ge1xuICAgICAgICBpZiAob3B0TG9nLmxvZykge1xuICAgICAgICAgIGNvbnNvbGUuaW5mbyhrZXksIGRlYnVnQ291bnQgKz0gMSwgLi4uYXJncyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5pbmZvKGtleSwgZGVidWdDb3VudCArPSAxLCBvcHRMb2csIC4uLmFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGluZm9UaWNrO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICBjb25zdCBkZWJ1Z1RpY2sgPSAob3B0TG9nLCAuLi5hcmdzKSA9PiB7XG4gICAgICAgIGlmIChvcHRMb2cubG9nKSB7XG4gICAgICAgICAgb3B0TG9nLmxvZyhrZXksIGRlYnVnQ291bnQgKz0gMSwgLi4uYXJncyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5pbmZvKGtleSwgZGVidWdDb3VudCArPSAxLCBvcHRMb2csIC4uLmFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGRlYnVnVGljaztcbiAgICB9XG4gIH1cbn07XG5oYXJkZW4obWFrZVRyYWNlcjMpO1xuXG4vL1xudmFyIE5vbk51bGxpc2gzID0gKHZhbCwgb3B0RGV0YWlscyA9IGB1bmV4cGVjdGVkICR7cXVvdGUodmFsKX1gKSA9PiB7XG4gIGlmICh2YWwgIT0gbnVsbCkge1xuICAgIHJldHVybiB2YWw7XG4gIH1cbiAgYXNzZXJ0LmZhaWwob3B0RGV0YWlscyk7XG59O1xuaGFyZGVuKE5vbk51bGxpc2gzKTtcblxuLy9cbnZhciB7IGRlZmluZVByb3BlcnR5OiBkZWZpbmVQcm9wZXJ0eTUgfSA9IE9iamVjdDtcbnZhciB0eXBlZE1hcDQgPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICovXG4gIEZ1bmN0aW9uLnByb3RvdHlwZS5jYWxsLmJpbmQoQXJyYXkucHJvdG90eXBlLm1hcClcbik7XG52YXIgbG9nTGV2ZWxzNCA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgW1xuICAgIFwiZGVidWdcIixcbiAgICBcImxvZ1wiLFxuICAgIFwiaW5mb1wiLFxuICAgIFwid2FyblwiLFxuICAgIFwiZXJyb3JcIlxuICBdXG4pO1xuT2JqZWN0LmZyZWV6ZShsb2dMZXZlbHM0KTtcblxuLy9cbnZhciB7IGZyb21FbnRyaWVzOiBmcm9tRW50cmllczE4IH0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiByYXdPd25LZXlzMyB9ID0gUmVmbGVjdDtcbnZhciBvd25LZXlzMjQgPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gIHJhd093bktleXMzXG4pO1xudmFyIGlzUHJvcGVydHlLZXkzID0gKGtleSkgPT4ge1xuICBzd2l0Y2ggKHR5cGVvZiBrZXkpIHtcbiAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgY2FzZSBcIm51bWJlclwiOlxuICAgIGNhc2UgXCJzeW1ib2xcIjpcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG52YXIgY2FsbFN5bmMzID0gKGNhbGxiYWNrLCAuLi5hcmdzKSA9PiB7XG4gIGNvbnN0IHsgdGFyZ2V0LCBtZXRob2ROYW1lLCBib3VuZCB9ID0gY2FsbGJhY2s7XG4gIGlmIChtZXRob2ROYW1lID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdGFyZ2V0KC4uLmJvdW5kLCAuLi5hcmdzKTtcbiAgfVxuICByZXR1cm4gdGFyZ2V0W21ldGhvZE5hbWVdKC4uLmJvdW5kLCAuLi5hcmdzKTtcbn07XG5oYXJkZW4oY2FsbFN5bmMzKTtcbnZhciBjYWxsRTMgPSAoY2FsbGJhY2ssIC4uLmFyZ3MpID0+IHtcbiAgY29uc3QgeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kIH0gPSBjYWxsYmFjaztcbiAgaWYgKG1ldGhvZE5hbWUgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiBFKHRhcmdldCkoLi4uYm91bmQsIC4uLmFyZ3MpO1xuICB9XG4gIHJldHVybiBFKHRhcmdldClbbWV0aG9kTmFtZV0oLi4uYm91bmQsIC4uLmFyZ3MpO1xufTtcbmhhcmRlbihjYWxsRTMpO1xudmFyIG1ha2VTeW5jRnVuY3Rpb25DYWxsYmFjazMgPSAodGFyZ2V0LCAuLi5ib3VuZCkgPT4ge1xuICB0eXBlb2YgdGFyZ2V0ID09PSBcImZ1bmN0aW9uXCIgfHwgdGhyb3dSZWRhY3RlZGBzeW5jIGZ1bmN0aW9uIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGEgZnVuY3Rpb246ICR7dGFyZ2V0fWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBib3VuZCwgaXNTeW5jOiB0cnVlIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VTeW5jRnVuY3Rpb25DYWxsYmFjazMpO1xudmFyIG1ha2VGdW5jdGlvbkNhbGxiYWNrMyA9ICh0YXJnZXQsIC4uLmJvdW5kKSA9PiB7XG4gICFpc1ByaW1pdGl2ZTIodGFyZ2V0KSB8fCB0aHJvd1JlZGFjdGVkYGZ1bmN0aW9uIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGEgZnVuY3Rpb24gcHJlc2VuY2U6ICR7dGFyZ2V0fWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBib3VuZCB9KTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VGdW5jdGlvbkNhbGxiYWNrMyk7XG52YXIgbWFrZVN5bmNNZXRob2RDYWxsYmFjazMgPSAodGFyZ2V0LCBtZXRob2ROYW1lLCAuLi5ib3VuZCkgPT4ge1xuICAhaXNQcmltaXRpdmUyKHRhcmdldCkgfHwgdGhyb3dSZWRhY3RlZGBzeW5jIG1ldGhvZCBjYWxsYmFjayB0YXJnZXQgbXVzdCBiZSBhbiBvYmplY3Q6ICR7dGFyZ2V0fWA7XG4gIHR5cGVvZiBtZXRob2ROYW1lID09PSBcInN0cmluZ1wiIHx8IGlzUGFzc2FibGVTeW1ib2wobWV0aG9kTmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBtZXRob2QgbmFtZSBtdXN0IGJlIGEgc3RyaW5nIG9yIHBhc3NhYmxlIHN5bWJvbDogJHttZXRob2ROYW1lfWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBtZXRob2ROYW1lLCBib3VuZCwgaXNTeW5jOiB0cnVlIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VTeW5jTWV0aG9kQ2FsbGJhY2szKTtcbnZhciBtYWtlTWV0aG9kQ2FsbGJhY2szID0gKHRhcmdldCwgbWV0aG9kTmFtZSwgLi4uYm91bmQpID0+IHtcbiAgIWlzUHJpbWl0aXZlMih0YXJnZXQpIHx8IHRocm93UmVkYWN0ZWRgbWV0aG9kIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGFuIG9iamVjdDogJHt0YXJnZXR9YDtcbiAgdHlwZW9mIG1ldGhvZE5hbWUgPT09IFwic3RyaW5nXCIgfHwgaXNQYXNzYWJsZVN5bWJvbChtZXRob2ROYW1lKSB8fCB0aHJvd1JlZGFjdGVkYG1ldGhvZCBuYW1lIG11c3QgYmUgYSBzdHJpbmcgb3IgcGFzc2FibGUgc3ltYm9sOiAke21ldGhvZE5hbWV9YDtcbiAgY29uc3QgY2IgPSBoYXJkZW4oeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgY2JcbiAgKTtcbn07XG5oYXJkZW4obWFrZU1ldGhvZENhbGxiYWNrMyk7XG52YXIgaXNDYWxsYmFjazMgPSAoY2FsbGJhY2spID0+IHtcbiAgaWYgKGlzUHJpbWl0aXZlMihjYWxsYmFjaykpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3QgeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kIH0gPSBjYWxsYmFjaztcbiAgcmV0dXJuICFpc1ByaW1pdGl2ZTIodGFyZ2V0KSAmJiAobWV0aG9kTmFtZSA9PT0gdm9pZCAwIHx8IHR5cGVvZiBtZXRob2ROYW1lID09PSBcInN0cmluZ1wiIHx8IGlzUGFzc2FibGVTeW1ib2wobWV0aG9kTmFtZSkpICYmIEFycmF5LmlzQXJyYXkoYm91bmQpO1xufTtcbmhhcmRlbihpc0NhbGxiYWNrMyk7XG52YXIgcHJlcGFyZUF0dGVudWF0b3IzID0gKHpvbmUsIG1ldGhvZE5hbWVzLCB7IGludGVyZmFjZUd1YXJkLCB0YWcgPSBcIkF0dGVudWF0b3JcIiB9ID0ge30pID0+IHtcbiAgY29uc3QgbWV0aG9kcyA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgZnJvbUVudHJpZXMxOChcbiAgICAgIG1ldGhvZE5hbWVzLm1hcCgoa2V5KSA9PiB7XG4gICAgICAgIGlmICghaXNQcm9wZXJ0eUtleTMoa2V5KSkge1xuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRga2V5ICR7cXVvdGUoa2V5KX0gaXMgbm90IGEgUHJvcGVydHlLZXlgO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG0yID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICB7XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgW2tleV0oLi4uYXJncykge1xuICAgICAgICAgICAgICBjb25zdCBjYiA9IHRoaXMuc3RhdGUuY2JzW2tleV07XG4gICAgICAgICAgICAgIGlmICghY2IpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnIgPSBtYWtlRXJyb3IoYHVuaW1wbGVtZW50ZWQgJHtxdW90ZSh0YWcpfSBtZXRob2QgJHtxdW90ZShrZXkpfWApO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmlzU3luYykge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoY2IuaXNTeW5jKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxTeW5jMyhjYiwgLi4uYXJncyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxFMyhjYiwgLi4uYXJncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVtrZXldXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBba2V5LCBtMl1cbiAgICAgICAgKTtcbiAgICAgIH0pXG4gICAgKVxuICApO1xuICBjb25zdCBtYWtlQXR0ZW51YXRvciA9IHpvbmUuZXhvQ2xhc3MoXG4gICAgdGFnLFxuICAgIGludGVyZmFjZUd1YXJkLFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICAoe1xuICAgICAgdGFyZ2V0ID0gbnVsbCxcbiAgICAgIGlzU3luYyA9IGZhbHNlLFxuICAgICAgb3ZlcnJpZGVzID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAge31cbiAgICAgIClcbiAgICB9KSA9PiB7XG4gICAgICBjb25zdCBjYnMgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB7fVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHJlbWFpbmluZyA9IG5ldyBTZXQobWV0aG9kTmFtZXMpO1xuICAgICAgZm9yIChjb25zdCBrZXkgb2Ygb3duS2V5czI0KG92ZXJyaWRlcykpIHtcbiAgICAgICAgcmVtYWluaW5nLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBvdmVycmlkZXNbJHtxdW90ZShrZXkpfV0gbm90IGFsbG93ZWQgYnkgbWV0aG9kTmFtZXNgO1xuICAgICAgICByZW1haW5pbmcuZGVsZXRlKGtleSk7XG4gICAgICAgIGNvbnN0IGNiID0gb3ZlcnJpZGVzW2tleV07XG4gICAgICAgIGNiID09IG51bGwgfHwgaXNDYWxsYmFjazMoY2IpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBvdmVycmlkZXNbJHtxdW90ZShrZXkpfV0gaXMgbm90IGEgY2FsbGJhY2s7IGdvdCAke2NifWA7XG4gICAgICAgIGNic1trZXldID0gY2I7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiByZW1haW5pbmcpIHtcbiAgICAgICAgaWYgKGlzU3luYykge1xuICAgICAgICAgIGNic1trZXldID0gbWFrZVN5bmNNZXRob2RDYWxsYmFjazModGFyZ2V0LCBrZXkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNic1trZXldID0gbWFrZU1ldGhvZENhbGxiYWNrMyh0YXJnZXQsIGtleSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBoYXJkZW4oeyBjYnMsIGlzU3luYyB9KTtcbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICBtZXRob2RzXG4gICk7XG4gIHJldHVybiBtYWtlQXR0ZW51YXRvcjtcbn07XG5oYXJkZW4ocHJlcGFyZUF0dGVudWF0b3IzKTtcbnZhciBwcmVwYXJlR3VhcmRlZEF0dGVudWF0b3IzID0gKHpvbmUsIGludGVyZmFjZUd1YXJkLCBvcHRzID0ge30pID0+IHtcbiAgY29uc3QgbWV0aG9kTmFtZXMgPSBnZXRJbnRlcmZhY2VNZXRob2RLZXlzKGludGVyZmFjZUd1YXJkKTtcbiAgY29uc3QgbWFrZUF0dGVudWF0b3IgPSBwcmVwYXJlQXR0ZW51YXRvcjMoem9uZSwgbWV0aG9kTmFtZXMsIHtcbiAgICAuLi5vcHRzLFxuICAgIGludGVyZmFjZUd1YXJkXG4gIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBtYWtlQXR0ZW51YXRvclxuICApO1xufTtcbmhhcmRlbihwcmVwYXJlR3VhcmRlZEF0dGVudWF0b3IzKTtcblxuLy9cbnZhciBTdHJlYW1DZWxsU2hhcGUzID0gaGFyZGVuKHtcbiAgYmxvY2tIZWlnaHQ6IE0uc3RyaW5nKCksXG4gIHZhbHVlczogTS5hcnJheSgpXG59KTtcbnZhciBDaGFpblN0b3JhZ2VOb2RlSTMgPSBNLmludGVyZmFjZShcIlN0b3JhZ2VOb2RlXCIsIHtcbiAgc2V0VmFsdWU6IE0uY2FsbFdoZW4oTS5zdHJpbmcoKSkucmV0dXJucygpLFxuICBnZXRQYXRoOiBNLmNhbGwoKS5yZXR1cm5zKE0uc3RyaW5nKCkpLFxuICBnZXRTdG9yZUtleTogTS5jYWxsV2hlbigpLnJldHVybnMoTS5yZWNvcmQoKSksXG4gIG1ha2VDaGlsZE5vZGU6IE0uY2FsbChNLnN0cmluZygpKS5vcHRpb25hbChNLnNwbGl0UmVjb3JkKHt9LCB7IHNlcXVlbmNlOiBNLmJvb2xlYW4oKSB9LCB7fSkpLnJldHVybnMoTS5yZW1vdGFibGUoXCJTdG9yYWdlTm9kZVwiKSlcbn0pO1xudmFyIGlzU3RyZWFtQ2VsbDMgPSAoY2VsbCkgPT4gY2VsbCAmJiB0eXBlb2YgY2VsbCA9PT0gXCJvYmplY3RcIiAmJiBBcnJheS5pc0FycmF5KGNlbGwudmFsdWVzKSAmJiB0eXBlb2YgY2VsbC5ibG9ja0hlaWdodCA9PT0gXCJzdHJpbmdcIiAmJiAvXjAkfF5bMS05XVswLTldKiQvLnRlc3QoY2VsbC5ibG9ja0hlaWdodCk7XG5oYXJkZW4oaXNTdHJlYW1DZWxsMyk7XG52YXIgcGF0aFNlZ21lbnRQYXR0ZXJuMyA9IC9eW2EtekEtWjAtOV8tXXsxLDEwMH0kLztcbnZhciBhc3NlcnRQYXRoU2VnbWVudDMgPSAobmFtZSkgPT4ge1xuICBwYXRoU2VnbWVudFBhdHRlcm4zLnRlc3QobmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBQYXRoIHNlZ21lbnQgbmFtZXMgbXVzdCBjb25zaXN0IG9mIDEgdG8gMTAwIGNoYXJhY3RlcnMgbGltaXRlZCB0byBBU0NJSSBhbHBoYW51bWVyaWNzLCB1bmRlcnNjb3JlcywgYW5kL29yIGRhc2hlczogJHtuYW1lfWA7XG59O1xuaGFyZGVuKGFzc2VydFBhdGhTZWdtZW50Myk7XG52YXIgcHJlcGFyZUNoYWluU3RvcmFnZU5vZGUzID0gKHpvbmUpID0+IHtcbiAgY29uc3QgbWFrZUNoYWluU3RvcmFnZU5vZGUgPSB6b25lLmV4b0NsYXNzKFxuICAgIFwiQ2hhaW5TdG9yYWdlTm9kZVwiLFxuICAgIENoYWluU3RvcmFnZU5vZGVJMyxcbiAgICAvKlxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIChtZXNzZW5nZXIsIHBhdGgsIHsgc2VxdWVuY2UgPSBmYWxzZSB9ID0ge30pID0+IHtcbiAgICAgIGFzc2VydC50eXBlb2YocGF0aCwgXCJzdHJpbmdcIik7XG4gICAgICBhc3NlcnQudHlwZW9mKHNlcXVlbmNlLCBcImJvb2xlYW5cIik7XG4gICAgICByZXR1cm4gaGFyZGVuKHsgcGF0aCwgbWVzc2VuZ2VyLCBzZXF1ZW5jZSB9KTtcbiAgICB9LFxuICAgIHtcbiAgICAgIGdldFBhdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnBhdGg7XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIGFzeW5jIGdldFN0b3JlS2V5KCkge1xuICAgICAgICBjb25zdCB7IHBhdGgsIG1lc3NlbmdlciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgcmV0dXJuIGNhbGxFMyhtZXNzZW5nZXIsIHtcbiAgICAgICAgICBtZXRob2Q6IFwiZ2V0U3RvcmVLZXlcIixcbiAgICAgICAgICBhcmdzOiBbcGF0aF1cbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuICAgICAgICovXG4gICAgICBtYWtlQ2hpbGROb2RlKG5hbWUsIGNoaWxkTm9kZU9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCB7IHNlcXVlbmNlLCBwYXRoLCBtZXNzZW5nZXIgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGFzc2VydFBhdGhTZWdtZW50MyhuYW1lKTtcbiAgICAgICAgY29uc3QgbWVyZ2VkT3B0aW9ucyA9IHsgc2VxdWVuY2UsIC4uLmNoaWxkTm9kZU9wdGlvbnMgfTtcbiAgICAgICAgcmV0dXJuIG1ha2VDaGFpblN0b3JhZ2VOb2RlKFxuICAgICAgICAgIG1lc3NlbmdlcixcbiAgICAgICAgICBgJHtwYXRofS4ke25hbWV9YCxcbiAgICAgICAgICBtZXJnZWRPcHRpb25zXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGFzeW5jIHNldFZhbHVlKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHsgc2VxdWVuY2UsIHBhdGgsIG1lc3NlbmdlciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgYXNzZXJ0LnR5cGVvZih2YWx1ZSwgXCJzdHJpbmdcIik7XG4gICAgICAgIGxldCBlbnRyeTtcbiAgICAgICAgaWYgKCFzZXF1ZW5jZSAmJiAhdmFsdWUpIHtcbiAgICAgICAgICBlbnRyeSA9IFtwYXRoXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlbnRyeSA9IFtwYXRoLCB2YWx1ZV07XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgY2FsbEUzKG1lc3Nlbmdlciwge1xuICAgICAgICAgIG1ldGhvZDogc2VxdWVuY2UgPyBcImFwcGVuZFwiIDogXCJzZXRcIixcbiAgICAgICAgICBhcmdzOiBbZW50cnldXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLy9cbiAgICB9XG4gICk7XG4gIHJldHVybiBtYWtlQ2hhaW5TdG9yYWdlTm9kZTtcbn07XG52YXIgbWFrZUhlYXBDaGFpblN0b3JhZ2VOb2RlMyA9IHByZXBhcmVDaGFpblN0b3JhZ2VOb2RlMyhtYWtlSGVhcFpvbmUoKSk7XG5mdW5jdGlvbiBtYWtlQ2hhaW5TdG9yYWdlUm9vdDMoaGFuZGxlU3RvcmFnZU1lc3NhZ2UsIHJvb3RQYXRoLCByb290T3B0aW9ucyA9IHt9KSB7XG4gIGNvbnN0IG1lc3NlbmdlciA9IG1ha2VGdW5jdGlvbkNhbGxiYWNrMyhoYW5kbGVTdG9yYWdlTWVzc2FnZSk7XG4gIGNvbnN0IHJvb3ROb2RlID0gbWFrZUhlYXBDaGFpblN0b3JhZ2VOb2RlMyhtZXNzZW5nZXIsIHJvb3RQYXRoLCByb290T3B0aW9ucyk7XG4gIHJldHVybiByb290Tm9kZTtcbn1cbnZhciBtYWtlTnVsbFN0b3JhZ2VOb2RlMyA9ICgpID0+IHtcbiAgcmV0dXJuIG1ha2VDaGFpblN0b3JhZ2VSb290MyhcbiAgICBGYXIoXCJOdWxsTWVzc2VuZ2VyXCIsICgpID0+IG51bGwpLFxuICAgIFwibnVsbFwiXG4gICk7XG59O1xuYXN5bmMgZnVuY3Rpb24gbWFrZVN0b3JhZ2VOb2RlQ2hpbGQzKHN0b3JhZ2VOb2RlUmVmLCBjaGlsZE5hbWUpIHtcbiAgY29uc3QgZXhpc3RpbmdTdG9yYWdlTm9kZSA9IGF3YWl0IHN0b3JhZ2VOb2RlUmVmO1xuICBjb25zdCBzdG9yYWdlTm9kZSA9IGV4aXN0aW5nU3RvcmFnZU5vZGUgfHwgbWFrZU51bGxTdG9yYWdlTm9kZTMoKTtcbiAgcmV0dXJuIEUoc3RvcmFnZU5vZGUpLm1ha2VDaGlsZE5vZGUoY2hpbGROYW1lKTtcbn1cbmhhcmRlbihtYWtlU3RvcmFnZU5vZGVDaGlsZDMpO1xuXG4vL1xudmFyIENhcERhdGFTaGFwZTMgPSB7IGJvZHk6IE0uc3RyaW5nKCksIHNsb3RzOiBNLmFycmF5KCkgfTtcbmhhcmRlbihDYXBEYXRhU2hhcGUzKTtcbnZhciBhc3NlcnRDYXBEYXRhMyA9IChkYXRhKSA9PiB7XG4gIGFzc2VydC50eXBlb2YoZGF0YSwgXCJvYmplY3RcIik7XG4gIGFzc2VydChkYXRhKTtcbiAgdHlwZW9mIGRhdGEuYm9keSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYGRhdGEgaGFzIG5vbi1zdHJpbmcgLmJvZHkgJHtkYXRhLmJvZHl9YDtcbiAgQXJyYXkuaXNBcnJheShkYXRhLnNsb3RzKSB8fCB0aHJvd1JlZGFjdGVkYGRhdGEgaGFzIG5vbi1BcnJheSBzbG90cyAke2RhdGEuc2xvdHN9YDtcbn07XG5oYXJkZW4oYXNzZXJ0Q2FwRGF0YTMpO1xudmFyIHVubWFyc2hhbEZyb21Wc3RvcmFnZTMgPSAoZGF0YSwga2V5LCBmcm9tQ2FwRGF0YSwgaW5kZXgpID0+IHtcbiAgY29uc3Qgc2VyaWFsaXplZCA9IGRhdGEuZ2V0KGtleSkgfHwgdGhyb3dSZWRhY3RlZGBubyBkYXRhIGZvciAke2tleX1gO1xuICBhc3NlcnQudHlwZW9mKHNlcmlhbGl6ZWQsIFwic3RyaW5nXCIpO1xuICBhc3NlcnQudHlwZW9mKGluZGV4LCBcIm51bWJlclwiKTtcbiAgY29uc3Qgc3RyZWFtQ2VsbCA9IEpTT04ucGFyc2Uoc2VyaWFsaXplZCk7XG4gIGlmICghaXNTdHJlYW1DZWxsMyhzdHJlYW1DZWxsKSkge1xuICAgIHRocm93IHRocm93UmVkYWN0ZWRgbm90IGEgU3RyZWFtQ2VsbDogJHtzdHJlYW1DZWxsfWA7XG4gIH1cbiAgY29uc3QgeyB2YWx1ZXM6IHZhbHVlczggfSA9IHN0cmVhbUNlbGw7XG4gIHZhbHVlczgubGVuZ3RoID4gMCB8fCB0aHJvd1JlZGFjdGVkYG5vIFN0cmVhbUNlbGwgdmFsdWVzOiAke3N0cmVhbUNlbGx9YDtcbiAgY29uc3QgbWFyc2hhbGxlZCA9IHZhbHVlczguYXQoaW5kZXgpO1xuICBhc3NlcnQudHlwZW9mKG1hcnNoYWxsZWQsIFwic3RyaW5nXCIpO1xuICBjb25zdCBjYXBEYXRhID0gaGFyZGVuKEpTT04ucGFyc2UobWFyc2hhbGxlZCkpO1xuICBhc3NlcnRDYXBEYXRhMyhjYXBEYXRhKTtcbiAgY29uc3QgdW5tYXJzaGFsbGVkID0gZnJvbUNhcERhdGEoY2FwRGF0YSk7XG4gIHJldHVybiB1bm1hcnNoYWxsZWQ7XG59O1xuaGFyZGVuKHVubWFyc2hhbEZyb21Wc3RvcmFnZTMpO1xudmFyIHJlamVjdE9DYXAzID0gKGNhcCkgPT4gdGhyb3dSZWRhY3RlZGAke2NhcH0gaXMgbm90IHB1cmUgZGF0YWA7XG52YXIgcHVyZURhdGFNYXJzaGFsbGVyMyA9IG1ha2VNYXJzaGFsKHJlamVjdE9DYXAzLCByZWplY3RPQ2FwMywge1xuICBzZXJpYWxpemVCb2R5Rm9ybWF0OiBcInNtYWxsY2Fwc1wiXG59KTtcbmhhcmRlbihwdXJlRGF0YU1hcnNoYWxsZXIzKTtcblxuLy9cbnZhciB7IGNyZWF0ZTogY3JlYXRlOSwgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMTkgfSA9IE9iamVjdDtcbnZhciB7IGFwcGx5OiBhcHBseTEwIH0gPSBSZWZsZWN0O1xudmFyIGdldE1ldGhvZE5hbWVzNCA9ICh2YWwpID0+IChcbiAgLyogICAgICAgICAgICAgICovXG4gIGdldE1ldGhvZE5hbWVzKHZhbClcbik7XG5oYXJkZW4oZ2V0TWV0aG9kTmFtZXM0KTtcbnZhciBiaW5kQWxsTWV0aG9kczMgPSAob2JqKSA9PiBoYXJkZW4oXG4gIGNyZWF0ZTkoXG4gICAgb2JqLFxuICAgIGZyb21FbnRyaWVzMTkoXG4gICAgICBnZXRNZXRob2ROYW1lcyhvYmopLm1hcCgobmFtZSkgPT4gW1xuICAgICAgICBuYW1lLFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6ICguLi5hcmdzKSA9PiBhcHBseTEwKG9ialtuYW1lXSwgb2JqLCBhcmdzKSxcbiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgICAgIH1cbiAgICAgIF0pXG4gICAgKVxuICApXG4pO1xuaGFyZGVuKGJpbmRBbGxNZXRob2RzMyk7XG5cbi8vXG52YXIgSElTVE9HUkFNX01TX0xBVEVOQ1lfQk9VTkRBUklFUzMgPSBbXG4gIDUsXG4gIDEwLFxuICAyNSxcbiAgNTAsXG4gIDEwMCxcbiAgMjUwLFxuICA1MDAsXG4gIDFlMyxcbiAgMjUwMCxcbiAgNWUzLFxuICAxZTQsXG4gIEluZmluaXR5XG5dO1xudmFyIEhJU1RPR1JBTV9TRUNPTkRTX0xBVEVOQ1lfQk9VTkRBUklFUzMgPSBISVNUT0dSQU1fTVNfTEFURU5DWV9CT1VOREFSSUVTMy5tYXAoKG1zKSA9PiBtcyAvIDFlMyk7XG52YXIgSElTVE9HUkFNX01FVFJJQ1MzID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgc3dpbmdzZXRfY3JhbmtfcHJvY2Vzc2luZ190aW1lOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQcm9jZXNzaW5nIHRpbWUgcGVyIGNyYW5rIChtcylcIixcbiAgICAgIHVuaXQ6IFwibXNcIixcbiAgICAgIGJvdW5kYXJpZXM6IEFycmF5Lm9mKDEsIDExLCAyMSwgMzEsIDQxLCA1MSwgNjEsIDcxLCA4MSwgOTEsIEluZmluaXR5KVxuICAgIH0sXG4gICAgc3dpbmdzZXRfYmxvY2tfcHJvY2Vzc2luZ19zZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQcm9jZXNzaW5nIHRpbWUgcGVyIGJsb2NrXCIsXG4gICAgICB1bml0OiBcInNcIixcbiAgICAgIGJvdW5kYXJpZXM6IEhJU1RPR1JBTV9TRUNPTkRTX0xBVEVOQ1lfQk9VTkRBUklFUzNcbiAgICB9LFxuICAgIHN3aW5nc2V0X3ZhdF9zdGFydHVwOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJWYXQgc3RhcnR1cCB0aW1lIChtcylcIixcbiAgICAgIHVuaXQ6IFwibXNcIixcbiAgICAgIGJvdW5kYXJpZXM6IEhJU1RPR1JBTV9NU19MQVRFTkNZX0JPVU5EQVJJRVMzXG4gICAgfSxcbiAgICBzd2luZ3NldF92YXRfZGVsaXZlcnk6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlZhdCBkZWxpdmVyeSB0aW1lIChtcylcIixcbiAgICAgIHVuaXQ6IFwibXNcIixcbiAgICAgIGJvdW5kYXJpZXM6IEhJU1RPR1JBTV9NU19MQVRFTkNZX0JPVU5EQVJJRVMzXG4gICAgfSxcbiAgICBzd2luZ3NldF9tZXRlcl91c2FnZToge1xuICAgICAgZGVzY3JpcHRpb246IFwiVmF0IG1ldGVyIHVzYWdlXCIsXG4gICAgICB1bml0OiBcIm1zXCIsXG4gICAgICBib3VuZGFyaWVzOiBISVNUT0dSQU1fTVNfTEFURU5DWV9CT1VOREFSSUVTM1xuICAgIH1cbiAgfVxuKTtcbnZhciBibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MzID0ge1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICB1bml0OiBcInNcIixcbiAgYWR2aWNlOiB7XG4gICAgZXhwbGljaXRCdWNrZXRCb3VuZGFyaWVzOiBbXG4gICAgICAwLjEsXG4gICAgICAwLjIsXG4gICAgICAwLjMsXG4gICAgICAwLjQsXG4gICAgICAwLjUsXG4gICAgICAxLFxuICAgICAgMixcbiAgICAgIDMsXG4gICAgICA0LFxuICAgICAgNSxcbiAgICAgIDYsXG4gICAgICA3LFxuICAgICAgMTAsXG4gICAgICAxNSxcbiAgICAgIDMwXG4gICAgXVxuICB9XG59O1xudmFyIEJMT0NLX0hJU1RPR1JBTV9NRVRSSUNTMyA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIHN3aW5nc2V0UnVuU2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgZXhlY3V0aW5nIFN3aW5nU2V0XCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MzXG4gICAgfSxcbiAgICBzd2luZ3NldENoYWluU2F2ZVNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IHByb3BhZ2F0aW5nIFN3aW5nU2V0IHN0YXRlIGludG8gY29zbW9zXCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MzXG4gICAgfSxcbiAgICBzd2luZ3NldENvbW1pdFNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IGNvbW1pdHRpbmcgU3dpbmdTZXQgc3RhdGUgdG8gaG9zdCBzdG9yYWdlXCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MzXG4gICAgfSxcbiAgICBjb3Ntb3NDb21taXRTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQZXItYmxvY2sgdGltZSBzcGVudCBjb21taXR0aW5nIGNvc21vcyBzdGF0ZVwiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjM1xuICAgIH0sXG4gICAgZnVsbENvbW1pdFNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IGNvbW1pdHRpbmcgc3RhdGUsIGluY2x1c2l2ZSBvZiBDT01NSVRfQkxPQ0sgcHJvY2Vzc2luZyBwbHVzIHRpbWUgc3BlbnQgW291dHNpZGUgb2YgY29zbWljLXN3aW5nc2V0XSBiZWZvcmUgYW5kIGFmdGVyIGl0XCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MzXG4gICAgfSxcbiAgICBpbnRlckJsb2NrU2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiVGltZSBzcGVudCBpZGxlIGJldHdlZW4gYmxvY2tzXCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MzXG4gICAgfSxcbiAgICBhZnRlckNvbW1pdEhhbmdvdmVyU2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgd2FpdGluZyBmb3IgcHJldmlvdXMtYmxvY2sgYWZ0ZXJDb21taXQgd29ya1wiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjM1xuICAgIH0sXG4gICAgYmxvY2tMYWdTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJUaGUgZGVsYXkgb2YgZWFjaCBibG9jayBmcm9tIGl0cyBleHBlY3RlZCBiZWdpbiB0aW1lXCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MzLFxuICAgICAgLy9cbiAgICAgIGFkdmljZToge1xuICAgICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MzLmFkdmljZSxcbiAgICAgICAgZXhwbGljaXRCdWNrZXRCb3VuZGFyaWVzOiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBbXG4gICAgICAgICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MzLmFkdmljZS5leHBsaWNpdEJ1Y2tldEJvdW5kYXJpZXMsXG4gICAgICAgICAgICAuLi5bNjAsIDEyMCwgMTgwLCAyNDAsIDMwMCwgNjAwLCAzNjAwXVxuICAgICAgICAgIF1cbiAgICAgICAgKVxuICAgICAgfVxuICAgIH1cbiAgfVxuKTtcbnZhciBNZXRyaWNUeXBlMyA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIENvdW50ZXI6IFwiY291bnRlclwiLFxuICAgIEdhdWdlOiBcImdhdWdlXCJcbiAgfVxuKTtcbnZhciBLRVJORUxfU1RBVFNfU1VNX01FVFJJQ1MzID0gW1xuICB7XG4gICAga2V5OiBcInN5c2NhbGxzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9hbGxfc3lzY2FsbF90b3RhbFwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxTZW5kXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInNlbmRcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBtZXNzYWdlIHNlbmQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsQ2FsbE5vd1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJjYWxsTm93XCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgc3luY2hyb25vdXMgZGV2aWNlIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFN1YnNjcmliZVwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJzdWJzY3JpYmVcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBwcm9taXNlIHN1YnNjcmlwdGlvbiBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxSZXNvbHZlXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInJlc29sdmVcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBwcm9taXNlIHJlc29sdXRpb24ga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsRXhpdFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJleGl0XCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0IGV4aXQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsVmF0c3RvcmVHZXRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwidmF0c3RvcmVHZXRcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXRzdG9yZSBnZXQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsVmF0c3RvcmVTZXRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwidmF0c3RvcmVTZXRcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXRzdG9yZSBzZXQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsVmF0c3RvcmVHZXROZXh0S2V5XCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInZhdHN0b3JlR2V0TmV4dFwiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHZhdHN0b3JlIGdldE5leHRLZXkga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsVmF0c3RvcmVEZWxldGVcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwidmF0c3RvcmVEZWxldGVcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXRzdG9yZSBkZWxldGUga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsRHJvcEltcG9ydHNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwiZHJvcEltcG9ydHNcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBkcm9wIGltcG9ydHMga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJkaXNwYXRjaGVzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9kaXNwYXRjaF90b3RhbFwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXQgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImRpc3BhdGNoRGVsaXZlclwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfZGlzcGF0Y2hfZGVsaXZlcl90b3RhbFwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXQgbWVzc2FnZSBkZWxpdmVyaWVzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJkaXNwYXRjaE5vdGlmeVwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfZGlzcGF0Y2hfbm90aWZ5X3RvdGFsXCIsXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHZhdCBwcm9taXNlIG5vdGlmaWNhdGlvbnNcIlxuICB9XG5dO1xudmFyIEtFUk5FTF9TVEFUU19VUERPV05fTUVUUklDUzMgPSBbXG4gIHtcbiAgICBrZXk6IFwia2VybmVsT2JqZWN0c1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfa2VybmVsX29iamVjdHNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJBY3RpdmUga2VybmVsIG9iamVjdHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImtlcm5lbERldmljZXNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2tlcm5lbF9kZXZpY2VzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiQWN0aXZlIGtlcm5lbCBkZXZpY2VzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJrZXJuZWxQcm9taXNlc1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfa2VybmVsX3Byb21pc2VzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiQWN0aXZlIGtlcm5lbCBwcm9taXNlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwia3BVbnJlc29sdmVkXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF91bnJlc29sdmVkX2tlcm5lbF9wcm9taXNlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlVucmVzb2x2ZWQga2VybmVsIHByb21pc2VzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJrcEZ1bGZpbGxlZFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfZnVsZmlsbGVkX2tlcm5lbF9wcm9taXNlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIkZ1bGZpbGxlZCBrZXJuZWwgcHJvbWlzZXNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImtwUmVqZWN0ZWRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3JlamVjdGVkX2tlcm5lbF9wcm9taXNlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlJlamVjdGVkIGtlcm5lbCBwcm9taXNlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwicnVuUXVldWVMZW5ndGhcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3J1bl9xdWV1ZV9sZW5ndGhcIixcbiAgICBjb25zZW5zdXM6IHRydWUsXG4gICAgZGVzY3JpcHRpb246IFwiTGVuZ3RoIG9mIHRoZSBrZXJuZWwgcnVuIHF1ZXVlXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJhY2NlcHRhbmNlUXVldWVMZW5ndGhcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2FjY2VwdGFuY2VfcXVldWVfbGVuZ3RoXCIsXG4gICAgY29uc2Vuc3VzOiB0cnVlLFxuICAgIGRlc2NyaXB0aW9uOiBcIkxlbmd0aCBvZiB0aGUga2VybmVsIGFjY2VwdGFuY2UgcXVldWVcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInByb21pc2VRdWV1ZXNMZW5ndGhcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3Byb21pc2VfcXVldWVzX2xlbmd0aFwiLFxuICAgIGNvbnNlbnN1czogdHJ1ZSxcbiAgICBkZXNjcmlwdGlvbjogXCJDb21iaW5lZCBsZW5ndGggb2YgYWxsIGtlcm5lbCBwcm9taXNlIHF1ZXVlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwiY2xpc3RFbnRyaWVzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9jbGlzdF9lbnRyaWVzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiTnVtYmVyIG9mIGVudHJpZXMgaW4gdGhlIGtlcm5lbCBjLWxpc3RcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInZhdHNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3ZhdHNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJOdW1iZXIgb2YgYWN0aXZlIHZhdHNcIlxuICB9XG5dO1xudmFyIHsgQ291bnRlcjogQ291bnRlcjMsIEdhdWdlOiBHYXVnZTMgfSA9IE1ldHJpY1R5cGUzO1xudmFyIEtFUk5FTF9TVEFUU19NRVRSSUNTMyA9IGhhcmRlbihbXG4gIC4uLktFUk5FTF9TVEFUU19TVU1fTUVUUklDUzMubWFwKChtMikgPT4gKHsgLi4ubTIsIG1ldHJpY1R5cGU6IENvdW50ZXIzIH0pKSxcbiAgLi4uS0VSTkVMX1NUQVRTX1VQRE9XTl9NRVRSSUNTMy5tYXAoKG0yKSA9PiAoeyAuLi5tMiwgbWV0cmljVHlwZTogR2F1Z2UzIH0pKVxuXSk7XG52YXIga2VybmVsU3RhdHNLZXlzMyA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG5mb3IgKGNvbnN0IHsga2V5IH0gb2YgS0VSTkVMX1NUQVRTX01FVFJJQ1MzKSB7XG4gIGtlcm5lbFN0YXRzS2V5czMuc2V0KGtleSwgKGtlcm5lbFN0YXRzS2V5czMuZ2V0KGtleSkgfHwgMCkgKyAxKTtcbn1cbnZhciBkdXBsaWNhdGVLZXJuZWxTdGF0c0tleXMzID0gWy4uLmtlcm5lbFN0YXRzS2V5czMuZW50cmllcygpXS5mbGF0TWFwKFxuICAoW2tleSwgdmFsdWVdKSA9PiB2YWx1ZSA+IDEgPyBba2V5XSA6IFtdXG4pO1xuaWYgKGR1cGxpY2F0ZUtlcm5lbFN0YXRzS2V5czMubGVuZ3RoID4gMCkge1xuICBjb25zdCBtc2cgPSBgRHVwbGljYXRlIGtlcm5lbCBzdGF0cyBrZXlzICR7SlNPTi5zdHJpbmdpZnkoZHVwbGljYXRlS2VybmVsU3RhdHNLZXlzMyl9YDtcbiAgdGhyb3cgRXJyb3IobXNnKTtcbn1cblxuLy9cbnZhciBjb21wYXJlTmF0czMgPSAoYTIsIGIzKSA9PiB7XG4gIGNvbnN0IGRpZmYgPSArYTIgLSArYjM7XG4gIGNvbnN0IGZpbml0ZURpZmYgPSBOdW1iZXIuaXNGaW5pdGUoZGlmZikgJiYgZGlmZiB8fCAoYTIgPT09IGIzID8gMCA6IE51bWJlcihCaWdJbnQoYTIpIC0gQmlnSW50KGIzKSkgfHwgYTIubGVuZ3RoIC0gYjMubGVuZ3RoKTtcbiAgcmV0dXJuIE1hdGguc2lnbihmaW5pdGVEaWZmKTtcbn07XG52YXIgY29tcGFyZVN0cmluZ3MzID0gKGEyLCBiMykgPT4gYTIgPiBiMyA/IDEgOiBhMiA8IGIzID8gLTEgOiAwO1xudmFyIHJQcmVmaXhlZERpZ2l0czMgPSAvXihcXEQqKShcXGQrKShcXEQuKnwpL3M7XG52YXIgbmF0dXJhbENvbXBhcmUzID0gKGEyLCBiMykgPT4ge1xuICBjb25zdCBbX2EsIGFQcmVmaXgsIGFEaWdpdHMsIGFTdWZmaXhdID0gclByZWZpeGVkRGlnaXRzMy5leGVjKGEyKSB8fCBbXTtcbiAgaWYgKGFQcmVmaXggIT09IHZvaWQgMCkge1xuICAgIGNvbnN0IFtfYiwgYlByZWZpeCwgYkRpZ2l0cywgYlN1ZmZpeF0gPSByUHJlZml4ZWREaWdpdHMzLmV4ZWMoYjMpIHx8IFtdO1xuICAgIGlmIChiUHJlZml4ID09PSBhUHJlZml4KSB7XG4gICAgICByZXR1cm4gY29tcGFyZU5hdHMzKGFEaWdpdHMsIGJEaWdpdHMpIHx8IGNvbXBhcmVTdHJpbmdzMyhhU3VmZml4LCBiU3VmZml4KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGNvbXBhcmVTdHJpbmdzMyhhMiwgYjMpO1xufTtcbmhhcmRlbihuYXR1cmFsQ29tcGFyZTMpO1xuXG4vL1xudmFyIHsgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMjAsIGtleXM6IGtleXM0LCB2YWx1ZXM6IHZhbHVlczcgfSA9IE9iamVjdDtcbnZhciBtYWtlTGltaXRlZENvbnNvbGUzID0gKG1ha2VMb2dnZXIpID0+IHtcbiAgY29uc3QgbGltaXRlZENvbnNvbGUgPSAoXG4gICAgLyogICAgICAgICAgICAgICovXG4gICAgZnJvbUVudHJpZXMyMChsb2dMZXZlbHM0Lm1hcCgobGV2ZWwpID0+IFtsZXZlbCwgbWFrZUxvZ2dlcihsZXZlbCldKSlcbiAgKTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGhhcmRlbihsaW1pdGVkQ29uc29sZSlcbiAgKTtcbn07XG5oYXJkZW4obWFrZUxpbWl0ZWRDb25zb2xlMyk7XG52YXIgbm90RG9uZTMgPSBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWU6IHZvaWQgMCB9KTtcbnZhciBhbHdheXNEb25lMyA9IGhhcmRlbih7IGRvbmU6IHRydWUsIHZhbHVlOiB2b2lkIDAgfSk7XG52YXIgZm9yZXZlcjMgPSBhc3luY0dlbmVyYXRlKCgpID0+IG5vdERvbmUzKTtcblxuLy9cbnZhciBTdG9yYWdlTm9kZVNoYXBlMyA9IE0ucmVtb3RhYmxlKFwiU3RvcmFnZU5vZGVcIik7XG52YXIgVW5ndWFyZGVkSGVscGVySTMgPSBNLmludGVyZmFjZShcbiAgXCJoZWxwZXJcIixcbiAge30sXG4gIC8vXG4gIHsgc2xvcHB5OiB0cnVlIH1cbik7XG52YXIgQnJpZGdlQmlnSW50U2hhcGUzID0gTS5vcihNLm51bWJlcigpLCBNLnN0cmluZygpKTtcblxuLy9cbnZhciBDT1NNT1NfQ0hBSU5TID0ge1xuICBPc21vc2lzOiBcIm9zbW9zaXNcIixcbiAgTmV1dHJvbjogXCJuZXV0cm9uXCIsXG4gIEF4ZWxhcjogXCJheGVsYXJcIlxufTtcblxuLy9cbnZhciBheGVsYXJHbXBNZXNzYWdlVHlwZSA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIE1FU1NBR0VfT05MWTogMSxcbiAgICBNRVNTQUdFX1dJVEhfVE9LRU46IDIsXG4gICAgVE9LRU5fT05MWTogM1xuICB9XG4pO1xuaGFyZGVuKGF4ZWxhckdtcE1lc3NhZ2VUeXBlKTtcbnZhciBnbXBBZGRyZXNzZXMgPSB7XG4gIEFYRUxBUl9HTVA6IFwiYXhlbGFyMWR2NHU1azczcHpxcnhsenVqeGczcXA4a3ZjM3BqZTdqdGR2dTcybnBudDV6aHEwNWVqY3NuNXFtZTVcIixcbiAgQVhFTEFSX0dBUzogXCJheGVsYXIxemwzcnhwcDcwbG10ZTJ4cjZjNGxnc2tlMmZ5dWozaHVwY3N2Y2RcIixcbiAgT1NNT1NJU19SRUNFSVZFUjogXCJvc21vMXloM3JhOGVhZ2U1eHRyOWEzbTV1dGc2bXgwcG1xcmV5dHVkYXFqXCJcbn07XG5cbi8vXG52YXIgdHJhY2U5ID0gbWFrZVRyYWNlcjMoXCJTZW5kVHJhbnNhY3Rpb25cIik7XG52YXIgeyBlbnRyaWVzOiBlbnRyaWVzMTAgfSA9IE9iamVjdDtcbnZhciBzZW5kVHJhbnNhY3Rpb24gPSBhc3luYyAob3JjaCwgeyBjaGFpbkh1YiwgbG9nLCB6b2VUb29sczogeyBsb2NhbFRyYW5zZmVyLCB3aXRoZHJhd1RvU2VhdCB9IH0sIHNlYXQsIG9mZmVyQXJncykgPT4ge1xuICB2b2lkIGxvZyhcIkluc2lkZSBzZW5kVHJhbnNhY3Rpb24gZmxvd1wiKTtcbiAgY29uc3QgeyBtZXNzYWdlcywgZ2FzQW1vdW50IH0gPSBvZmZlckFyZ3M7XG4gIHRyYWNlOShcIk9mZmVyIEFyZ3M6XCIsIEpTT04uc3RyaW5naWZ5KG9mZmVyQXJncykpO1xuICBjb25zdCB7IGdpdmUgfSA9IHNlYXQuZ2V0UHJvcG9zYWwoKTtcbiAgY29uc3QgW1tfa3csIGFtdF1dID0gZW50cmllczEwKGdpdmUpO1xuICBhbXQudmFsdWUgPiAwbiB8fCB0aHJvd1JlZGFjdGVkYElCQyB0cmFuc2ZlciBhbW91bnQgbXVzdCBiZSBncmVhdGVyIHRoYW4gemVyb2A7XG4gIHRyYWNlOShcIl9rdywgYW10XCIsIF9rdywgYW10KTtcbiAgY29uc3QgYWdvcmljID0gYXdhaXQgb3JjaC5nZXRDaGFpbihcImFnb3JpY1wiKTtcbiAgY29uc3QgYWdvcmljQXNzZXRzID0gYXdhaXQgYWdvcmljLmdldFZCYW5rQXNzZXRJbmZvKCk7XG4gIGNvbnN0IHsgZGVub20gfSA9IE5vbk51bGxpc2gzKFxuICAgIGFnb3JpY0Fzc2V0cy5maW5kKChhMikgPT4gYTIuYnJhbmQgPT09IGFtdC5icmFuZCksXG4gICAgYCR7YW10LmJyYW5kfSBub3QgcmVnaXN0ZXJlZCBpbiB2YmFua2BcbiAgKTtcbiAgdHJhY2U5KFwiYW10IGFuZCBicmFuZFwiLCBhbXQuYnJhbmQpO1xuICBjb25zdCBsb2NhbEFjY291bnQgPSBhd2FpdCBhZ29yaWMubWFrZUFjY291bnQoKTtcbiAgYXdhaXQgbG9jYWxUcmFuc2ZlcihzZWF0LCBsb2NhbEFjY291bnQsIGdpdmUpO1xuICBjb25zdCBhbW91bnRQZXJDaGFpbiA9IGFtdC52YWx1ZSAvIEJpZ0ludChtZXNzYWdlcy5sZW5ndGgpO1xuICB0cmFjZTkoXCJBbW91bnQgcGVyIGNoYWluOlwiLCBhbW91bnRQZXJDaGFpbik7XG4gIGZvciAoY29uc3QgbWVzc2FnZSBvZiBtZXNzYWdlcykge1xuICAgIG1lc3NhZ2UuZGVzdGluYXRpb25DaGFpbiAhPSBudWxsIHx8IHRocm93UmVkYWN0ZWRgRGVzdGluYXRpb24gY2hhaW4gbXVzdCBiZSBkZWZpbmVkIGZvciBtZXNzYWdlICR7bWVzc2FnZX1gO1xuICAgIG1lc3NhZ2UuZGVzdGluYXRpb25BZGRyZXNzICE9IG51bGwgfHwgdGhyb3dSZWRhY3RlZGBEZXN0aW5hdGlvbiBhZGRyZXNzIG11c3QgYmUgZGVmaW5lZCBmb3IgbWVzc2FnZSAke21lc3NhZ2V9YDtcbiAgICBjb25zdCB7IGRlc3RpbmF0aW9uQ2hhaW4sIGRlc3RpbmF0aW9uQWRkcmVzcywgdHlwZSwgY2hhaW5UeXBlLCBwYXlsb2FkIH0gPSBtZXNzYWdlO1xuICAgIGNvbnN0IGNoYWluID0gY2hhaW5UeXBlID09PSBcImV2bVwiID8gQ09TTU9TX0NIQUlOU1tcIkF4ZWxhclwiXSA6IENPU01PU19DSEFJTlNbZGVzdGluYXRpb25DaGFpbl07XG4gICAgY29uc3QgcmVtb3RlQ2hhaW4gPSBhd2FpdCBvcmNoLmdldENoYWluKGNoYWluKTtcbiAgICB0cmFjZTkoXCJDb25uZWN0aW9uIENoYWluXCIsIGNoYWluKTtcbiAgICBjb25zdCB7IGNoYWluSWQ6IHJlbW90ZUNoYWluSWQsIHN0YWtpbmdUb2tlbnMgfSA9IGF3YWl0IHJlbW90ZUNoYWluLmdldENoYWluSW5mbygpO1xuICAgIGNvbnN0IHJlbW90ZURlbm9tID0gc3Rha2luZ1Rva2Vuc1swXS5kZW5vbTtcbiAgICByZW1vdGVEZW5vbSB8fCB0aHJvd1JlZGFjdGVkYCR7cmVtb3RlQ2hhaW5JZH0gZG9lcyBub3QgaGF2ZSBzdGFraW5nVG9rZW5zIGluIGNvbmZpZ2A7XG4gICAgdm9pZCBsb2coXG4gICAgICBgQ3JlYXRpbmcgcmVtb3RlIGNoYW5uZWwgdG8gJHtkZXN0aW5hdGlvbkNoYWlufSAoJHtjaGFpbn0pIHdpdGggZGVub20gJHtyZW1vdGVEZW5vbX1gXG4gICAgKTtcbiAgICBjb25zdCBhZ29yaWNDaGFpbklkID0gKGF3YWl0IGFnb3JpYy5nZXRDaGFpbkluZm8oKSkuY2hhaW5JZDtcbiAgICBjb25zdCB7IHRyYW5zZmVyQ2hhbm5lbCB9ID0gYXdhaXQgY2hhaW5IdWIuZ2V0Q29ubmVjdGlvbkluZm8oXG4gICAgICBhZ29yaWNDaGFpbklkLFxuICAgICAgcmVtb3RlQ2hhaW5JZFxuICAgICk7XG4gICAgYXNzZXJ0KFxuICAgICAgdHJhbnNmZXJDaGFubmVsLmNvdW50ZXJQYXJ0eUNoYW5uZWxJZCxcbiAgICAgIFwidW5hYmxlIHRvIGZpbmQgc291cmNlQ2hhbm5lbFwiXG4gICAgKTtcbiAgICB0cmFjZTkoYHRhcmdldHM6IFske2Rlc3RpbmF0aW9uQWRkcmVzc31dYCk7XG4gICAgY29uc3QgcmVjb3ZlckZhaWxlZFRyYW5zZmVyID0gYXN5bmMgKGUyKSA9PiB7XG4gICAgICBhd2FpdCB3aXRoZHJhd1RvU2VhdChsb2NhbEFjY291bnQsIHNlYXQsIGdpdmUpO1xuICAgICAgY29uc3QgZXJyb3JNc2cgPSBgSUJDIFRyYW5zZmVyIGZhaWxlZCAke3F1b3RlKGUyKX1gO1xuICAgICAgdm9pZCBsb2coYEVSUk9SOiAke2Vycm9yTXNnfWApO1xuICAgICAgc2VhdC5mYWlsKGVycm9yTXNnKTtcbiAgICAgIHRocm93IG1ha2VFcnJvcihlcnJvck1zZyk7XG4gICAgfTtcbiAgICBpZiAoY2hhaW5UeXBlID09PSBcImV2bVwiKSB7XG4gICAgICBjb25zdCBtZW1vID0ge1xuICAgICAgICBkZXN0aW5hdGlvbl9jaGFpbjogZGVzdGluYXRpb25DaGFpbixcbiAgICAgICAgZGVzdGluYXRpb25fYWRkcmVzczogZGVzdGluYXRpb25BZGRyZXNzLFxuICAgICAgICBwYXlsb2FkOiBBcnJheS5mcm9tKHBheWxvYWQpLFxuICAgICAgICB0eXBlXG4gICAgICB9O1xuICAgICAgaWYgKHR5cGUgPT09IDEgfHwgdHlwZSA9PSAyKSB7XG4gICAgICAgIG1lbW8uZmVlID0ge1xuICAgICAgICAgIGFtb3VudDogU3RyaW5nKGdhc0Ftb3VudCksXG4gICAgICAgICAgcmVjaXBpZW50OiBnbXBBZGRyZXNzZXMuQVhFTEFSX0dBU1xuICAgICAgICB9O1xuICAgICAgICB2b2lkIGxvZyhgRmVlIG9iamVjdCAke0pTT04uc3RyaW5naWZ5KG1lbW8uZmVlKX1gKTtcbiAgICAgICAgdHJhY2U5KGBGZWUgb2JqZWN0ICR7SlNPTi5zdHJpbmdpZnkobWVtby5mZWUpfWApO1xuICAgICAgfVxuICAgICAgdm9pZCBsb2coYEluaXRpYXRpbmcgR01QIFRyYW5zYWN0aW9uLi4uYCk7XG4gICAgICB2b2lkIGxvZyhgREVOT00gb2YgdG9rZW46JHtkZW5vbX1gKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGxvY2FsQWNjb3VudC50cmFuc2ZlcihcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZ21wQWRkcmVzc2VzLkFYRUxBUl9HTVAsXG4gICAgICAgICAgICBlbmNvZGluZzogXCJiZWNoMzJcIixcbiAgICAgICAgICAgIGNoYWluSWQ6IHJlbW90ZUNoYWluSWRcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGRlbm9tLFxuICAgICAgICAgICAgdmFsdWU6IGFtb3VudFBlckNoYWluXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IG1lbW86IEpTT04uc3RyaW5naWZ5KG1lbW8pIH1cbiAgICAgICAgKTtcbiAgICAgICAgdm9pZCBsb2coYEdNUCBUcmFuc2FjdGlvbiBzZW50IHN1Y2Nlc3NmdWxseWApO1xuICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgcmV0dXJuIHJlY292ZXJGYWlsZWRUcmFuc2ZlcihlMik7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChjaGFpblR5cGUgPT09IFwiY29zbW9zXCIpIHtcbiAgICAgIGNvbnN0IG1lbW8gPSBKU09OLnN0cmluZ2lmeShwYXlsb2FkKTtcbiAgICAgIHZvaWQgbG9nKGBJbml0aWF0aW5nIElCQyBUcmFuc2Zlci4uLmApO1xuICAgICAgdm9pZCBsb2coYERFTk9NIG9mIHRva2VuOiR7ZGVub219YCk7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBsb2NhbEFjY291bnQudHJhbnNmZXIoXG4gICAgICAgICAge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIHZhbHVlOiBgJHtkZXN0aW5hdGlvbkFkZHJlc3N9YCxcbiAgICAgICAgICAgIGVuY29kaW5nOiBcImJlY2gzMlwiLFxuICAgICAgICAgICAgY2hhaW5JZDogcmVtb3RlQ2hhaW5JZFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZGVub20sXG4gICAgICAgICAgICB2YWx1ZTogYW1vdW50UGVyQ2hhaW5cbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgbWVtbyB9XG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChlMikge1xuICAgICAgICByZXR1cm4gcmVjb3ZlckZhaWxlZFRyYW5zZmVyKGUyKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5oYXJkZW4oc2VuZFRyYW5zYWN0aW9uKTtcblxuLy9cbnZhciB0cmFjZTEwID0gbWFrZVRyYWNlcjMoXCJxc3RuUm91dGVyXCIpO1xudmFyICRjzY9fY29udHJhY3Q9YXN5bmMoemNmLHByaXZhdGVBcmdzLCB6b25lLCB7IGNoYWluSHViLCBvcmNoZXN0cmF0ZSwgdm93VG9vbHMsIHpvZVRvb2xzIH0pID0+IHtcbiAgdHJhY2UxMChcIkluc2lkZSBDb250cmFjdFwiKTtcbiAgcmVnaXN0ZXJDaGFpbnNBbmRBc3NldHMoXG4gICAgY2hhaW5IdWIsXG4gICAgemNmLmdldFRlcm1zKCkuYnJhbmRzLFxuICAgIHByaXZhdGVBcmdzLmNoYWluSW5mbyxcbiAgICBwcml2YXRlQXJncy5hc3NldEluZm9cbiAgKTtcbiAgY29uc3QgY3JlYXRvckZhY2V0ID0gcHJlcGFyZUNoYWluSHViQWRtaW4oem9uZSwgY2hhaW5IdWIpO1xuICBjb25zdCBsb2dOb2RlID0gRShwcml2YXRlQXJncy5zdG9yYWdlTm9kZSkubWFrZUNoaWxkTm9kZShcImxvZ1wiKTtcbiAgY29uc3QgbG9nID0gKG1zZykgPT4gdm93VG9vbHMud2F0Y2goRShsb2dOb2RlKS5zZXRWYWx1ZShtc2cpKTtcbiAgY29uc3QgbWFrZVNlbmRUcmFuc2FjdGlvbiA9IG9yY2hlc3RyYXRlKFxuICAgIFwic2VuZFRyYW5zYWN0aW9uXCIsXG4gICAge1xuICAgICAgY2hhaW5IdWIsXG4gICAgICBsb2csXG4gICAgICB6b2VUb29sc1xuICAgIH0sXG4gICAgc2VuZFRyYW5zYWN0aW9uXG4gICk7XG4gIGNvbnN0IHB1YmxpY0ZhY2V0ID0gem9uZS5leG8oXG4gICAgXCJTZW5kIFBGXCIsXG4gICAgTS5pbnRlcmZhY2UoXCJTZW5kIFBGXCIsIHtcbiAgICAgIG1ha2VTZW5kVHJhbnNhY3Rpb25JbnZpdGF0aW9uOiBNLmNhbGxXaGVuKCkucmV0dXJucyhNLmFueSgpKVxuICAgIH0pLFxuICAgIHtcbiAgICAgIG1ha2VTZW5kVHJhbnNhY3Rpb25JbnZpdGF0aW9uKCkge1xuICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKFxuICAgICAgICAgIG1ha2VTZW5kVHJhbnNhY3Rpb24sXG4gICAgICAgICAgXCJzZW5kVHJhbnNhY3Rpb25cIixcbiAgICAgICAgICB2b2lkIDBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiB7IHB1YmxpY0ZhY2V0LCBjcmVhdG9yRmFjZXQgfTtcbn07Y29udHJhY3Q9JGPNj19jb250cmFjdDtcbmhhcmRlbihjb250cmFjdCk7XG52YXIgJGPNj19zdGFydD13aXRoT3JjaGVzdHJhdGlvbihjb250cmFjdCk7c3RhcnQ9JGPNj19zdGFydDtcbmhhcmRlbihzdGFydCk7XG59KSgpXG4iLCJfX2xpdmVFeHBvcnRNYXBfXyI6eyJjb250cmFjdCI6WyJjb250cmFjdCIsdHJ1ZV0sInN0YXJ0IjpbInN0YXJ0Iix0cnVlXX0sIl9fcmVleHBvcnRNYXBfXyI6e30sIl9fZml4ZWRFeHBvcnRNYXBfXyI6e30sIl9fbmVlZHNJbXBvcnRfXyI6ZmFsc2UsIl9fbmVlZHNJbXBvcnRNZXRhX18iOmZhbHNlfVBLAQIeAwoAAAAAAAAAAADuKUXjQgIAAEICAAAUAAAAAAAAAAAAAACkgQAAAABjb21wYXJ0bWVudC1tYXAuanNvblBLAQIeAwoAAAAAAAAAAAAu1oytLxYOAC8WDgAoAAAAAAAAAAAAAACkgXQCAABkZXBsb3ktdjEuMC4wL2Rpc3QvcXN0bi5yb3V0ZXIuYnVuZGxlLmpzUEsFBgAAAAACAAIAmAAAAOkYDgAAAA==",
  "endoZipBase64Sha512": "714510e01f39b58c6982fdca98fd3b050cf2bb84a0944e334fd684015d6a66bf2f9c0700042f6b526dc0d84c2628ba38e1ddd852974655bcfaa8bbcd640a421e"
}